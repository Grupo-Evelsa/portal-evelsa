/*! For license information please see main.29414568.js.LICENSE.txt */
(()=>{"use strict";var e={43:(e,t,n)=>{e.exports=n(202)},153:(e,t,n)=>{var i=n(43),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,r={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,i)&&!l.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===r[i]&&(r[i]=t[i]);return{$$typeof:s,type:e,key:c,ref:u,props:r,_owner:a.current}}t.Fragment=r,t.jsx=c,t.jsxs=c},202:(e,t)=>{var n=Symbol.for("react.element"),i=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}function v(){}function b(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||p}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var x=b.prototype=new v;x.constructor=b,m(x,y.prototype),x.isPureReactComponent=!0;var _=Array.isArray,w=Object.prototype.hasOwnProperty,C={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function k(e,t,i){var s,r={},o=null,a=null;if(null!=t)for(s in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)w.call(t,s)&&!N.hasOwnProperty(s)&&(r[s]=t[s]);var l=arguments.length-2;if(1===l)r.children=i;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];r.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===r[s]&&(r[s]=l[s]);return{$$typeof:n,type:e,key:o,ref:a,props:r,_owner:C.current}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var T=/\/+/g;function S(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function I(e,t,s,r,o){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case i:l=!0}}if(l)return o=o(l=e),e=""===r?"."+S(l,0):r,_(o)?(s="",null!=e&&(s=e.replace(T,"$&/")+"/"),I(o,t,s,"",function(e){return e})):null!=o&&(E(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,s+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(T,"$&/")+"/")+e)),t.push(o)),1;if(l=0,r=""===r?".":r+":",_(e))for(var c=0;c<e.length;c++){var u=r+S(a=e[c],c);l+=I(a,t,s,u,o)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(a=e.next()).done;)l+=I(a=a.value,t,s,u=r+S(a,c++),o);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function P(e,t,n){if(null==e)return e;var i=[],s=0;return I(e,i,"","",function(e){return t.call(n,e,s++)}),i}function j(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var A={current:null},D={transition:null},R={ReactCurrentDispatcher:A,ReactCurrentBatchConfig:D,ReactCurrentOwner:C};function M(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:P,forEach:function(e,t,n){P(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return P(e,function(){t++}),t},toArray:function(e){return P(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=s,t.Profiler=o,t.PureComponent=b,t.StrictMode=r,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,t.act=M,t.cloneElement=function(e,t,i){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=m({},e.props),r=e.key,o=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,a=C.current),void 0!==t.key&&(r=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!N.hasOwnProperty(c)&&(s[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)s.children=i;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];s.children=l}return{$$typeof:n,type:e.type,key:r,ref:o,props:s,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=k,t.createFactory=function(e){var t=k.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:j}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=M,t.useCallback=function(e,t){return A.current.useCallback(e,t)},t.useContext=function(e){return A.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return A.current.useDeferredValue(e)},t.useEffect=function(e,t){return A.current.useEffect(e,t)},t.useId=function(){return A.current.useId()},t.useImperativeHandle=function(e,t,n){return A.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return A.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return A.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return A.current.useMemo(e,t)},t.useReducer=function(e,t,n){return A.current.useReducer(e,t,n)},t.useRef=function(e){return A.current.useRef(e)},t.useState=function(e){return A.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return A.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return A.current.useTransition()},t.version="18.3.1"},234:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var i=n-1>>>1,s=e[i];if(!(0<r(s,t)))break e;e[i]=t,e[n]=s,n=i}}function i(e){return 0===e.length?null:e[0]}function s(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var i=0,s=e.length,o=s>>>1;i<o;){var a=2*(i+1)-1,l=e[a],c=a+1,u=e[c];if(0>r(l,n))c<s&&0>r(u,l)?(e[i]=u,e[c]=n,i=c):(e[i]=l,e[a]=n,i=a);else{if(!(c<s&&0>r(u,n)))break e;e[i]=u,e[c]=n,i=c}}}return t}function r(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],d=1,h=null,f=3,p=!1,m=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=i(u);null!==t;){if(null===t.callback)s(u);else{if(!(t.startTime<=e))break;s(u),t.sortIndex=t.expirationTime,n(c,t)}t=i(u)}}function _(e){if(g=!1,x(e),!m)if(null!==i(c))m=!0,D(w);else{var t=i(u);null!==t&&R(_,t.startTime-e)}}function w(e,n){m=!1,g&&(g=!1,v(E),E=-1),p=!0;var r=f;try{for(x(n),h=i(c);null!==h&&(!(h.expirationTime>n)||e&&!I());){var o=h.callback;if("function"===typeof o){h.callback=null,f=h.priorityLevel;var a=o(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?h.callback=a:h===i(c)&&s(c),x(n)}else s(c);h=i(c)}if(null!==h)var l=!0;else{var d=i(u);null!==d&&R(_,d.startTime-n),l=!1}return l}finally{h=null,f=r,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var C,N=!1,k=null,E=-1,T=5,S=-1;function I(){return!(t.unstable_now()-S<T)}function P(){if(null!==k){var e=t.unstable_now();S=e;var n=!0;try{n=k(!0,e)}finally{n?C():(N=!1,k=null)}}else N=!1}if("function"===typeof b)C=function(){b(P)};else if("undefined"!==typeof MessageChannel){var j=new MessageChannel,A=j.port2;j.port1.onmessage=P,C=function(){A.postMessage(null)}}else C=function(){y(P,0)};function D(e){k=e,N||(N=!0,C())}function R(e,n){E=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,D(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return i(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,s,r){var o=t.unstable_now();switch("object"===typeof r&&null!==r?r="number"===typeof(r=r.delay)&&0<r?o+r:o:r=o,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:d++,callback:s,priorityLevel:e,startTime:r,expirationTime:a=r+a,sortIndex:-1},r>o?(e.sortIndex=r,n(u,e),null===i(c)&&e===i(u)&&(g?(v(E),E=-1):g=!0,R(_,r-o))):(e.sortIndex=a,n(c,e),m||p||(m=!0,D(w))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},391:(e,t,n)=>{var i=n(950);t.createRoot=i.createRoot,t.hydrateRoot=i.hydrateRoot},579:(e,t,n)=>{e.exports=n(153)},730:(e,t,n)=>{var i=n(43),s=n(853);function r(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,a={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(a[e]=t,e=0;e<t.length;e++)o.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function m(e,t,n,i,s,r,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=r,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function b(e,t,n,i){var s=g.hasOwnProperty(t)?g[t]:null;(null!==s?0!==s.type:i||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,i){if(null===t||"undefined"===typeof t||function(e,t,n,i){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!i&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,i))return!0;if(i)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,s,i)&&(n=null),i||null===s?function(e){return!!d.call(p,e)||!d.call(f,e)&&(h.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):s.mustUseProperty?e[s.propertyName]=null===n?3!==s.type&&"":n:(t=s.attributeName,i=s.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(s=s.type)||4===s&&!0===n?"":""+n,i?e.setAttributeNS(i,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(y,v);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});var x=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_=Symbol.for("react.element"),w=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),T=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),A=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var R=Symbol.iterator;function M(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=R&&e[R]||e["@@iterator"])?e:null}var O,L=Object.assign;function F(e){if(void 0===O)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||""}return"\n"+O+e}var z=!1;function U(e,t){if(!e||z)return"";z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(Fs){var i=Fs}Reflect.construct(e,[],t)}else{try{t.call()}catch(Fs){i=Fs}e.call(t.prototype)}else{try{throw Error()}catch(Fs){i=Fs}e()}}catch(Fs){if(Fs&&i&&"string"===typeof Fs.stack){for(var s=Fs.stack.split("\n"),r=i.stack.split("\n"),o=s.length-1,a=r.length-1;1<=o&&0<=a&&s[o]!==r[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==r[a]){if(1!==o||1!==a)do{if(o--,0>--a||s[o]!==r[a]){var l="\n"+s[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=a);break}}}finally{z=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function V(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=U(e.type,!1);case 11:return e=U(e.type.render,!1);case 1:return e=U(e.type,!0);default:return""}}function B(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case C:return"Fragment";case w:return"Portal";case k:return"Profiler";case N:return"StrictMode";case I:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case T:return(e.displayName||"Context")+".Consumer";case E:return(e._context.displayName||"Context")+".Provider";case S:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case j:return null!==(t=e.displayName||null)?t:B(e.type)||"Memo";case A:t=e._payload,e=e._init;try{return B(e(t))}catch(n){}}return null}function H(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return B(t);case 8:return t===N?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function q(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function G(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var s=n.get,r=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){i=""+e,r.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return i},setValue:function(e){i=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),i="";return e&&(i=W(e)?e.checked?"true":"false":e.value),(e=i)!==n&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(tc){return e.body}}function Q(e,t){var n=t.checked;return L({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,i=null!=t.checked?t.checked:t.defaultChecked;n=q(null!=t.value?t.value:n),e._wrapperState={initialChecked:i,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function $(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){$(e,t);var n=q(t.value),i=t.type;if(null!=n)"number"===i?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===i||"reset"===i)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!("submit"!==i&&"reset"!==i||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Y(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,i){if(e=e.options,t){t={};for(var s=0;s<n.length;s++)t["$"+n[s]]=!0;for(n=0;n<e.length;n++)s=t.hasOwnProperty("$"+e[n].value),e[n].selected!==s&&(e[n].selected=s),s&&i&&(e[n].defaultSelected=!0)}else{for(n=""+q(n),t=null,s=0;s<e.length;s++){if(e[s].value===n)return e[s].selected=!0,void(i&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function ie(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(r(91));return L({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function se(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(r(92));if(te(n)){if(1<n.length)throw Error(r(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:q(n)}}function re(e,t){var n=q(t.value),i=q(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=i&&(e.defaultValue=""+i)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var i=0===n.indexOf("--"),s=me(n,t[n],i);"float"===n&&(n="cssFloat"),i?e.setProperty(n,s):e[n]=s}}Object.keys(fe).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]})});var ye=L({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(r(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(r(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(r(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(r(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function _e(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Ce=null,Ne=null;function ke(e){if(e=bs(e)){if("function"!==typeof we)throw Error(r(280));var t=e.stateNode;t&&(t=_s(t),we(e.stateNode,e.type,t))}}function Ee(e){Ce?Ne?Ne.push(e):Ne=[e]:Ce=e}function Te(){if(Ce){var e=Ce,t=Ne;if(Ne=Ce=null,ke(e),t)for(e=0;e<t.length;e++)ke(t[e])}}function Se(e,t){return e(t)}function Ie(){}var Pe=!1;function je(e,t,n){if(Pe)return e(t,n);Pe=!0;try{return Se(e,t,n)}finally{Pe=!1,(null!==Ce||null!==Ne)&&(Ie(),Te())}}function Ae(e,t){var n=e.stateNode;if(null===n)return null;var i=_s(n);if(null===i)return null;n=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(i=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!i;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(r(231,t,typeof n));return n}var De=!1;if(u)try{var Re={};Object.defineProperty(Re,"passive",{get:function(){De=!0}}),window.addEventListener("test",Re,Re),window.removeEventListener("test",Re,Re)}catch(ue){De=!1}function Me(e,t,n,i,s,r,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Oe=!1,Le=null,Fe=!1,ze=null,Ue={onError:function(e){Oe=!0,Le=e}};function Ve(e,t,n,i,s,r,o,a,l){Oe=!1,Le=null,Me.apply(Ue,arguments)}function Be(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function He(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function qe(e){if(Be(e)!==e)throw Error(r(188))}function We(e){return e=function(e){var t=e.alternate;if(!t){if(null===(t=Be(e)))throw Error(r(188));return t!==e?null:e}for(var n=e,i=t;;){var s=n.return;if(null===s)break;var o=s.alternate;if(null===o){if(null!==(i=s.return)){n=i;continue}break}if(s.child===o.child){for(o=s.child;o;){if(o===n)return qe(s),e;if(o===i)return qe(s),t;o=o.sibling}throw Error(r(188))}if(n.return!==i.return)n=s,i=o;else{for(var a=!1,l=s.child;l;){if(l===n){a=!0,n=s,i=o;break}if(l===i){a=!0,i=s,n=o;break}l=l.sibling}if(!a){for(l=o.child;l;){if(l===n){a=!0,n=o,i=s;break}if(l===i){a=!0,i=o,n=s;break}l=l.sibling}if(!a)throw Error(r(189))}}if(n.alternate!==i)throw Error(r(190))}if(3!==n.tag)throw Error(r(188));return n.stateNode.current===n?e:t}(e),null!==e?Ge(e):null}function Ge(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ge(e);if(null!==t)return t;e=e.sibling}return null}var Ke=s.unstable_scheduleCallback,Ye=s.unstable_cancelCallback,Qe=s.unstable_shouldYield,Xe=s.unstable_requestPaint,$e=s.unstable_now,Je=s.unstable_getCurrentPriorityLevel,Ze=s.unstable_ImmediatePriority,et=s.unstable_UserBlockingPriority,tt=s.unstable_NormalPriority,nt=s.unstable_LowPriority,it=s.unstable_IdlePriority,st=null,rt=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/lt|0)|0},at=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var i=0,s=e.suspendedLanes,r=e.pingedLanes,o=268435455&n;if(0!==o){var a=o&~s;0!==a?i=dt(a):0!==(r&=o)&&(i=dt(r))}else 0!==(o=n&~s)?i=dt(o):0!==r&&(i=dt(r));if(0===i)return 0;if(0!==t&&t!==i&&0===(t&s)&&((s=i&-i)>=(r=t&-t)||16===s&&0!==(4194240&r)))return t;if(0!==(4&i)&&(i|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=i;0<t;)s=1<<(n=31-ot(t)),i|=e[n],t&=~s;return i}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var i=31-ot(n),s=1<<i;s&t|e[i]&t&&(e[i]|=t),n&=~s}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var _t,wt,Ct,Nt,kt,Et=!1,Tt=[],St=null,It=null,Pt=null,jt=new Map,At=new Map,Dt=[],Rt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Mt(e,t){switch(e){case"focusin":case"focusout":St=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":jt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":At.delete(t.pointerId)}}function Ot(e,t,n,i,s,r){return null===e||e.nativeEvent!==r?(e={blockedOn:t,domEventName:n,eventSystemFlags:i,nativeEvent:r,targetContainers:[s]},null!==t&&(null!==(t=bs(t))&&wt(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function Lt(e){var t=vs(e.target);if(null!==t){var n=Be(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=He(n)))return e.blockedOn=t,void kt(e.priority,function(){Ct(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bs(n))&&wt(t),e.blockedOn=n,!1;var i=new(n=e.nativeEvent).constructor(n.type,n);xe=i,n.target.dispatchEvent(i),xe=null,t.shift()}return!0}function zt(e,t,n){Ft(e)&&n.delete(t)}function Ut(){Et=!1,null!==St&&Ft(St)&&(St=null),null!==It&&Ft(It)&&(It=null),null!==Pt&&Ft(Pt)&&(Pt=null),jt.forEach(zt),At.forEach(zt)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,Et||(Et=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,Ut)))}function Bt(e){function t(t){return Vt(t,e)}if(0<Tt.length){Vt(Tt[0],e);for(var n=1;n<Tt.length;n++){var i=Tt[n];i.blockedOn===e&&(i.blockedOn=null)}}for(null!==St&&Vt(St,e),null!==It&&Vt(It,e),null!==Pt&&Vt(Pt,e),jt.forEach(t),At.forEach(t),n=0;n<Dt.length;n++)(i=Dt[n]).blockedOn===e&&(i.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Lt(n),null===n.blockedOn&&Dt.shift()}var Ht=x.ReactCurrentBatchConfig,qt=!0;function Wt(e,t,n,i){var s=bt,r=Ht.transition;Ht.transition=null;try{bt=1,Kt(e,t,n,i)}finally{bt=s,Ht.transition=r}}function Gt(e,t,n,i){var s=bt,r=Ht.transition;Ht.transition=null;try{bt=4,Kt(e,t,n,i)}finally{bt=s,Ht.transition=r}}function Kt(e,t,n,i){if(qt){var s=Qt(e,t,n,i);if(null===s)qi(e,t,i,Yt,n),Mt(e,i);else if(function(e,t,n,i,s){switch(t){case"focusin":return St=Ot(St,e,t,n,i,s),!0;case"dragenter":return It=Ot(It,e,t,n,i,s),!0;case"mouseover":return Pt=Ot(Pt,e,t,n,i,s),!0;case"pointerover":var r=s.pointerId;return jt.set(r,Ot(jt.get(r)||null,e,t,n,i,s)),!0;case"gotpointercapture":return r=s.pointerId,At.set(r,Ot(At.get(r)||null,e,t,n,i,s)),!0}return!1}(s,e,t,n,i))i.stopPropagation();else if(Mt(e,i),4&t&&-1<Rt.indexOf(e)){for(;null!==s;){var r=bs(s);if(null!==r&&_t(r),null===(r=Qt(e,t,n,i))&&qi(e,t,i,Yt,n),r===s)break;s=r}null!==s&&i.stopPropagation()}else qi(e,t,i,null,n)}}var Yt=null;function Qt(e,t,n,i){if(Yt=null,null!==(e=vs(e=_e(i))))if(null===(t=Be(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case it:return 536870912;default:return 16}default:return 16}}var $t=null,Jt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Jt,i=n.length,s="value"in $t?$t.value:$t.textContent,r=s.length;for(e=0;e<i&&n[e]===s[e];e++);var o=i-e;for(t=1;t<=o&&n[i-t]===s[r-t];t++);return Zt=s.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function sn(){return!1}function rn(e){function t(t,n,i,s,r){for(var o in this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=s,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?nn:sn,this.isPropagationStopped=sn,this}return L(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,an,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=rn(cn),dn=L({},cn,{view:0,detail:0}),hn=rn(dn),fn=L({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(on=e.screenX-ln.screenX,an=e.screenY-ln.screenY):an=on=0,ln=e),on)},movementY:function(e){return"movementY"in e?e.movementY:an}}),pn=rn(fn),mn=rn(L({},fn,{dataTransfer:0})),gn=rn(L({},dn,{relatedTarget:0})),yn=rn(L({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=L({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=rn(vn),xn=rn(L({},cn,{data:0})),_n={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Cn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Nn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Cn[e])&&!!t[e]}function kn(){return Nn}var En=L({},dn,{key:function(e){if(e.key){var t=_n[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Tn=rn(En),Sn=rn(L({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=rn(L({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kn})),Pn=rn(L({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),jn=L({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),An=rn(jn),Dn=[9,13,27,32],Rn=u&&"CompositionEvent"in window,Mn=null;u&&"documentMode"in document&&(Mn=document.documentMode);var On=u&&"TextEvent"in window&&!Mn,Ln=u&&(!Rn||Mn&&8<Mn&&11>=Mn),Fn=String.fromCharCode(32),zn=!1;function Un(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Bn=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function Wn(e,t,n,i){Ee(i),0<(t=Gi(t,"onChange")).length&&(n=new un("onChange","change",null,n,i),e.push({event:n,listeners:t}))}var Gn=null,Kn=null;function Yn(e){Fi(e,0)}function Qn(e){if(K(xs(e)))return e}function Xn(e,t){if("change"===e)return t}var $n=!1;if(u){var Jn;if(u){var Zn="oninput"in document;if(!Zn){var ei=document.createElement("div");ei.setAttribute("oninput","return;"),Zn="function"===typeof ei.oninput}Jn=Zn}else Jn=!1;$n=Jn&&(!document.documentMode||9<document.documentMode)}function ti(){Gn&&(Gn.detachEvent("onpropertychange",ni),Kn=Gn=null)}function ni(e){if("value"===e.propertyName&&Qn(Kn)){var t=[];Wn(t,Kn,e,_e(e)),je(Yn,t)}}function ii(e,t,n){"focusin"===e?(ti(),Kn=n,(Gn=t).attachEvent("onpropertychange",ni)):"focusout"===e&&ti()}function si(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(Kn)}function ri(e,t){if("click"===e)return Qn(t)}function oi(e,t){if("input"===e||"change"===e)return Qn(t)}var ai="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function li(e,t){if(ai(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var s=n[i];if(!d.call(t,s)||!ai(e[s],t[s]))return!1}return!0}function ci(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ui(e,t){var n,i=ci(e);for(e=0;i;){if(3===i.nodeType){if(n=e+i.textContent.length,e<=t&&n>=t)return{node:i,offset:t-e};e=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=ci(i)}}function di(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?di(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hi(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(i){n=!1}if(!n)break;t=Y((e=t.contentWindow).document)}return t}function fi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pi(e){var t=hi(),n=e.focusedElem,i=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&di(n.ownerDocument.documentElement,n)){if(null!==i&&fi(n))if(t=i.start,void 0===(e=i.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var s=n.textContent.length,r=Math.min(i.start,s);i=void 0===i.end?r:Math.min(i.end,s),!e.extend&&r>i&&(s=i,i=r,r=s),s=ui(n,r);var o=ui(n,i);s&&o&&(1!==e.rangeCount||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(s.node,s.offset),e.removeAllRanges(),r>i?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mi=u&&"documentMode"in document&&11>=document.documentMode,gi=null,yi=null,vi=null,bi=!1;function xi(e,t,n){var i=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;bi||null==gi||gi!==Y(i)||("selectionStart"in(i=gi)&&fi(i)?i={start:i.selectionStart,end:i.selectionEnd}:i={anchorNode:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset},vi&&li(vi,i)||(vi=i,0<(i=Gi(yi,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:i}),t.target=gi)))}function _i(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wi={animationend:_i("Animation","AnimationEnd"),animationiteration:_i("Animation","AnimationIteration"),animationstart:_i("Animation","AnimationStart"),transitionend:_i("Transition","TransitionEnd")},Ci={},Ni={};function ki(e){if(Ci[e])return Ci[e];if(!wi[e])return e;var t,n=wi[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ni)return Ci[e]=n[t];return e}u&&(Ni=document.createElement("div").style,"AnimationEvent"in window||(delete wi.animationend.animation,delete wi.animationiteration.animation,delete wi.animationstart.animation),"TransitionEvent"in window||delete wi.transitionend.transition);var Ei=ki("animationend"),Ti=ki("animationiteration"),Si=ki("animationstart"),Ii=ki("transitionend"),Pi=new Map,ji="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ai(e,t){Pi.set(e,t),l(t,[e])}for(var Di=0;Di<ji.length;Di++){var Ri=ji[Di];Ai(Ri.toLowerCase(),"on"+(Ri[0].toUpperCase()+Ri.slice(1)))}Ai(Ei,"onAnimationEnd"),Ai(Ti,"onAnimationIteration"),Ai(Si,"onAnimationStart"),Ai("dblclick","onDoubleClick"),Ai("focusin","onFocus"),Ai("focusout","onBlur"),Ai(Ii,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oi=new Set("cancel close invalid load scroll toggle".split(" ").concat(Mi));function Li(e,t,n){var i=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,i,s,o,a,l,c){if(Ve.apply(this,arguments),Oe){if(!Oe)throw Error(r(198));var u=Le;Oe=!1,Le=null,Fe||(Fe=!0,ze=u)}}(i,t,void 0,e),e.currentTarget=null}function Fi(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var i=e[n],s=i.event;i=i.listeners;e:{var r=void 0;if(t)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==r&&s.isPropagationStopped())break e;Li(s,a,c),r=l}else for(o=0;o<i.length;o++){if(l=(a=i[o]).instance,c=a.currentTarget,a=a.listener,l!==r&&s.isPropagationStopped())break e;Li(s,a,c),r=l}}}if(Fe)throw e=ze,Fe=!1,ze=null,e}function zi(e,t){var n=t[ms];void 0===n&&(n=t[ms]=new Set);var i=e+"__bubble";n.has(i)||(Hi(t,e,2,!1),n.add(i))}function Ui(e,t,n){var i=0;t&&(i|=4),Hi(n,e,i,t)}var Vi="_reactListening"+Math.random().toString(36).slice(2);function Bi(e){if(!e[Vi]){e[Vi]=!0,o.forEach(function(t){"selectionchange"!==t&&(Oi.has(t)||Ui(t,!1,e),Ui(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vi]||(t[Vi]=!0,Ui("selectionchange",!1,t))}}function Hi(e,t,n,i){switch(Xt(t)){case 1:var s=Wt;break;case 4:s=Gt;break;default:s=Kt}n=s.bind(null,t,n,e),s=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),i?void 0!==s?e.addEventListener(t,n,{capture:!0,passive:s}):e.addEventListener(t,n,!0):void 0!==s?e.addEventListener(t,n,{passive:s}):e.addEventListener(t,n,!1)}function qi(e,t,n,i,s){var r=i;if(0===(1&t)&&0===(2&t)&&null!==i)e:for(;;){if(null===i)return;var o=i.tag;if(3===o||4===o){var a=i.stateNode.containerInfo;if(a===s||8===a.nodeType&&a.parentNode===s)break;if(4===o)for(o=i.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===s||8===l.nodeType&&l.parentNode===s))return;o=o.return}for(;null!==a;){if(null===(o=vs(a)))return;if(5===(l=o.tag)||6===l){i=r=o;continue e}a=a.parentNode}}i=i.return}je(function(){var i=r,s=_e(n),o=[];e:{var a=Pi.get(e);if(void 0!==a){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Tn;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=In;break;case Ei:case Ti:case Si:l=yn;break;case Ii:l=Pn;break;case"scroll":l=hn;break;case"wheel":l=An;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Sn}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==a?a+"Capture":null:a;u=[];for(var f,p=i;null!==p;){var m=(f=p).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==h&&(null!=(m=Ae(p,h))&&u.push(Wi(p,m,f)))),d)break;p=p.return}0<u.length&&(a=new l(a,c,null,n,s),o.push({event:a,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!vs(c)&&!c[ps])&&(l||a)&&(a=s.window===s?s:(a=s.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=i,null!==(c=(c=n.relatedTarget||n.toElement)?vs(c):null)&&(c!==(d=Be(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=i),l!==c)){if(u=pn,m="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(u=Sn,m="onPointerLeave",h="onPointerEnter",p="pointer"),d=null==l?a:xs(l),f=null==c?a:xs(c),(a=new u(m,p+"leave",l,n,s)).target=d,a.relatedTarget=f,m=null,vs(s)===i&&((u=new u(h,p+"enter",c,n,s)).target=f,u.relatedTarget=d,m=u),d=m,l&&c)e:{for(h=c,p=0,f=u=l;f;f=Ki(f))p++;for(f=0,m=h;m;m=Ki(m))f++;for(;0<p-f;)u=Ki(u),p--;for(;0<f-p;)h=Ki(h),f--;for(;p--;){if(u===h||null!==h&&u===h.alternate)break e;u=Ki(u),h=Ki(h)}u=null}else u=null;null!==l&&Yi(o,a,l,u,!1),null!==c&&null!==d&&Yi(o,d,c,u,!0)}if("select"===(l=(a=i?xs(i):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var g=Xn;else if(qn(a))if($n)g=oi;else{g=si;var y=ii}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=ri);switch(g&&(g=g(e,i))?Wn(o,g,n,s):(y&&y(e,a,i),"focusout"===e&&(y=a._wrapperState)&&y.controlled&&"number"===a.type&&ee(a,"number",a.value)),y=i?xs(i):window,e){case"focusin":(qn(y)||"true"===y.contentEditable)&&(gi=y,yi=i,vi=null);break;case"focusout":vi=yi=gi=null;break;case"mousedown":bi=!0;break;case"contextmenu":case"mouseup":case"dragend":bi=!1,xi(o,n,s);break;case"selectionchange":if(mi)break;case"keydown":case"keyup":xi(o,n,s)}var v;if(Rn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Bn?Un(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Ln&&"ko"!==n.locale&&(Bn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Bn&&(v=en()):(Jt="value"in($t=s)?$t.value:$t.textContent,Bn=!0)),0<(y=Gi(i,b)).length&&(b=new xn(b,e,null,n,s),o.push({event:b,listeners:y}),v?b.data=v:null!==(v=Vn(n))&&(b.data=v))),(v=On?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(zn=!0,Fn);case"textInput":return(e=t.data)===Fn&&zn?null:e;default:return null}}(e,n):function(e,t){if(Bn)return"compositionend"===e||!Rn&&Un(e,t)?(e=en(),Zt=Jt=$t=null,Bn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ln&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(i=Gi(i,"onBeforeInput")).length&&(s=new xn("onBeforeInput","beforeinput",null,n,s),o.push({event:s,listeners:i}),s.data=v))}Fi(o,t)})}function Wi(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Gi(e,t){for(var n=t+"Capture",i=[];null!==e;){var s=e,r=s.stateNode;5===s.tag&&null!==r&&(s=r,null!=(r=Ae(e,n))&&i.unshift(Wi(e,r,s)),null!=(r=Ae(e,t))&&i.push(Wi(e,r,s))),e=e.return}return i}function Ki(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Yi(e,t,n,i,s){for(var r=t._reactName,o=[];null!==n&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===i)break;5===a.tag&&null!==c&&(a=c,s?null!=(l=Ae(n,r))&&o.unshift(Wi(n,l,a)):s||null!=(l=Ae(n,r))&&o.push(Wi(n,l,a))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Qi=/\r\n?/g,Xi=/\u0000|\uFFFD/g;function $i(e){return("string"===typeof e?e:""+e).replace(Qi,"\n").replace(Xi,"")}function Ji(e,t,n){if(t=$i(t),$i(e)!==t&&n)throw Error(r(425))}function Zi(){}var es=null,ts=null;function ns(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var is="function"===typeof setTimeout?setTimeout:void 0,ss="function"===typeof clearTimeout?clearTimeout:void 0,rs="function"===typeof Promise?Promise:void 0,os="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof rs?function(e){return rs.resolve(null).then(e).catch(as)}:is;function as(e){setTimeout(function(){throw e})}function ls(e,t){var n=t,i=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&8===s.nodeType)if("/$"===(n=s.data)){if(0===i)return e.removeChild(s),void Bt(t);i--}else"$"!==n&&"$?"!==n&&"$!"!==n||i++;n=s}while(n);Bt(t)}function cs(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function us(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ds=Math.random().toString(36).slice(2),hs="__reactFiber$"+ds,fs="__reactProps$"+ds,ps="__reactContainer$"+ds,ms="__reactEvents$"+ds,gs="__reactListeners$"+ds,ys="__reactHandles$"+ds;function vs(e){var t=e[hs];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ps]||n[hs]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=us(e);null!==e;){if(n=e[hs])return n;e=us(e)}return t}n=(e=n).parentNode}return null}function bs(e){return!(e=e[hs]||e[ps])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xs(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(r(33))}function _s(e){return e[fs]||null}var ws=[],Cs=-1;function Ns(e){return{current:e}}function ks(e){0>Cs||(e.current=ws[Cs],ws[Cs]=null,Cs--)}function Es(e,t){Cs++,ws[Cs]=e.current,e.current=t}var Ts={},Ss=Ns(Ts),Is=Ns(!1),Ps=Ts;function js(e,t){var n=e.type.contextTypes;if(!n)return Ts;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var s,r={};for(s in n)r[s]=t[s];return i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function As(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ds(){ks(Is),ks(Ss)}function Ms(e,t,n){if(Ss.current!==Ts)throw Error(r(168));Es(Ss,t),Es(Is,n)}function Os(e,t,n){var i=e.stateNode;if(t=t.childContextTypes,"function"!==typeof i.getChildContext)return n;for(var s in i=i.getChildContext())if(!(s in t))throw Error(r(108,H(e)||"Unknown",s));return L({},n,i)}function Ls(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ts,Ps=Ss.current,Es(Ss,e),Es(Is,Is.current),!0}function zs(e,t,n){var i=e.stateNode;if(!i)throw Error(r(169));n?(e=Os(e,t,Ps),i.__reactInternalMemoizedMergedChildContext=e,ks(Is),ks(Ss),Es(Ss,e)):ks(Is),Es(Is,n)}var Us=null,Vs=!1,Bs=!1;function Hs(e){null===Us?Us=[e]:Us.push(e)}function qs(){if(!Bs&&null!==Us){Bs=!0;var e=0,t=bt;try{var n=Us;for(bt=1;e<n.length;e++){var i=n[e];do{i=i(!0)}while(null!==i)}Us=null,Vs=!1}catch(s){throw null!==Us&&(Us=Us.slice(e+1)),Ke(Ze,qs),s}finally{bt=t,Bs=!1}}return null}var Ws=[],Gs=0,Ys=null,Qs=0,Xs=[],Js=0,Zs=null,er=1,tr="";function nr(e,t){Ws[Gs++]=Qs,Ws[Gs++]=Ys,Ys=e,Qs=t}function ir(e,t,n){Xs[Js++]=er,Xs[Js++]=tr,Xs[Js++]=Zs,Zs=e;var i=er;e=tr;var s=32-ot(i)-1;i&=~(1<<s),n+=1;var r=32-ot(t)+s;if(30<r){var o=s-s%5;r=(i&(1<<o)-1).toString(32),i>>=o,s-=o,er=1<<32-ot(t)+s|n<<s|i,tr=r+e}else er=1<<r|n<<s|i,tr=e}function sr(e){null!==e.return&&(nr(e,1),ir(e,1,0))}function rr(e){for(;e===Ys;)Ys=Ws[--Gs],Ws[Gs]=null,Qs=Ws[--Gs],Ws[Gs]=null;for(;e===Zs;)Zs=Xs[--Js],Xs[Js]=null,tr=Xs[--Js],Xs[Js]=null,er=Xs[--Js],Xs[Js]=null}var or=null,ar=null,lr=!1,cr=null;function ur(e,t){var n=Lc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function dr(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,or=e,ar=cs(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,or=e,ar=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Zs?{id:er,overflow:tr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Lc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,or=e,ar=null,!0);default:return!1}}function hr(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function fr(e){if(lr){var t=ar;if(t){var n=t;if(!dr(e,t)){if(hr(e))throw Error(r(418));t=cs(n.nextSibling);var i=or;t&&dr(e,t)?ur(i,n):(e.flags=-4097&e.flags|2,lr=!1,or=e)}}else{if(hr(e))throw Error(r(418));e.flags=-4097&e.flags|2,lr=!1,or=e}}}function pr(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;or=e}function mr(e){if(e!==or)return!1;if(!lr)return pr(e),lr=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ns(e.type,e.memoizedProps)),t&&(t=ar)){if(hr(e))throw gr(),Error(r(418));for(;t;)ur(e,t),t=cs(t.nextSibling)}if(pr(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(r(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ar=cs(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ar=null}}else ar=or?cs(e.stateNode.nextSibling):null;return!0}function gr(){for(var e=ar;e;)e=cs(e.nextSibling)}function yr(){ar=or=null,lr=!1}function vr(e){null===cr?cr=[e]:cr.push(e)}var br=x.ReactCurrentBatchConfig;function xr(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(r(309));var i=n.stateNode}if(!i)throw Error(r(147,e));var s=i,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=s.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(r(284));if(!n._owner)throw Error(r(290,e))}return e}function _r(e,t){throw e=Object.prototype.toString.call(t),Error(r(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function wr(e){return(0,e._init)(e._payload)}function Cr(e){function t(t,n){if(e){var i=t.deletions;null===i?(t.deletions=[n],t.flags|=16):i.push(n)}}function n(n,i){if(!e)return null;for(;null!==i;)t(n,i),i=i.sibling;return null}function i(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function s(e,t){return(e=zc(e,t)).index=0,e.sibling=null,e}function o(t,n,i){return t.index=i,e?null!==(i=t.alternate)?(i=i.index)<n?(t.flags|=2,n):i:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,i){return null===t||6!==t.tag?((t=Hc(n,e.mode,i)).return=e,t):((t=s(t,n)).return=e,t)}function c(e,t,n,i){var r=n.type;return r===C?d(e,t,n.props.children,i,n.key):null!==t&&(t.elementType===r||"object"===typeof r&&null!==r&&r.$$typeof===A&&wr(r)===t.type)?((i=s(t,n.props)).ref=xr(e,t,n),i.return=e,i):((i=Uc(n.type,n.key,n.props,null,e.mode,i)).ref=xr(e,t,n),i.return=e,i)}function u(e,t,n,i){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=qc(n,e.mode,i)).return=e,t):((t=s(t,n.children||[])).return=e,t)}function d(e,t,n,i,r){return null===t||7!==t.tag?((t=Vc(n,e.mode,i,r)).return=e,t):((t=s(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Hc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case _:return(n=Uc(t.type,t.key,t.props,null,e.mode,n)).ref=xr(e,null,t),n.return=e,n;case w:return(t=qc(t,e.mode,n)).return=e,t;case A:return h(e,(0,t._init)(t._payload),n)}if(te(t)||M(t))return(t=Vc(t,e.mode,n,null)).return=e,t;_r(e,t)}return null}function f(e,t,n,i){var s=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==s?null:l(e,t,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case _:return n.key===s?c(e,t,n,i):null;case w:return n.key===s?u(e,t,n,i):null;case A:return f(e,t,(s=n._init)(n._payload),i)}if(te(n)||M(n))return null!==s?null:d(e,t,n,i,null);_r(e,n)}return null}function p(e,t,n,i,s){if("string"===typeof i&&""!==i||"number"===typeof i)return l(t,e=e.get(n)||null,""+i,s);if("object"===typeof i&&null!==i){switch(i.$$typeof){case _:return c(t,e=e.get(null===i.key?n:i.key)||null,i,s);case w:return u(t,e=e.get(null===i.key?n:i.key)||null,i,s);case A:return p(e,t,n,(0,i._init)(i._payload),s)}if(te(i)||M(i))return d(t,e=e.get(n)||null,i,s,null);_r(t,i)}return null}function m(s,r,a,l){for(var c=null,u=null,d=r,m=r=0,g=null;null!==d&&m<a.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var y=f(s,d,a[m],l);if(null===y){null===d&&(d=g);break}e&&d&&null===y.alternate&&t(s,d),r=o(y,r,m),null===u?c=y:u.sibling=y,u=y,d=g}if(m===a.length)return n(s,d),lr&&nr(s,m),c;if(null===d){for(;m<a.length;m++)null!==(d=h(s,a[m],l))&&(r=o(d,r,m),null===u?c=d:u.sibling=d,u=d);return lr&&nr(s,m),c}for(d=i(s,d);m<a.length;m++)null!==(g=p(d,s,m,a[m],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),r=o(g,r,m),null===u?c=g:u.sibling=g,u=g);return e&&d.forEach(function(e){return t(s,e)}),lr&&nr(s,m),c}function g(s,a,l,c){var u=M(l);if("function"!==typeof u)throw Error(r(150));if(null==(l=u.call(l)))throw Error(r(151));for(var d=u=null,m=a,g=a=0,y=null,v=l.next();null!==m&&!v.done;g++,v=l.next()){m.index>g?(y=m,m=null):y=m.sibling;var b=f(s,m,v.value,c);if(null===b){null===m&&(m=y);break}e&&m&&null===b.alternate&&t(s,m),a=o(b,a,g),null===d?u=b:d.sibling=b,d=b,m=y}if(v.done)return n(s,m),lr&&nr(s,g),u;if(null===m){for(;!v.done;g++,v=l.next())null!==(v=h(s,v.value,c))&&(a=o(v,a,g),null===d?u=v:d.sibling=v,d=v);return lr&&nr(s,g),u}for(m=i(s,m);!v.done;g++,v=l.next())null!==(v=p(m,s,g,v.value,c))&&(e&&null!==v.alternate&&m.delete(null===v.key?g:v.key),a=o(v,a,g),null===d?u=v:d.sibling=v,d=v);return e&&m.forEach(function(e){return t(s,e)}),lr&&nr(s,g),u}return function e(i,r,o,l){if("object"===typeof o&&null!==o&&o.type===C&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case _:e:{for(var c=o.key,u=r;null!==u;){if(u.key===c){if((c=o.type)===C){if(7===u.tag){n(i,u.sibling),(r=s(u,o.props.children)).return=i,i=r;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===A&&wr(c)===u.type){n(i,u.sibling),(r=s(u,o.props)).ref=xr(i,u,o),r.return=i,i=r;break e}n(i,u);break}t(i,u),u=u.sibling}o.type===C?((r=Vc(o.props.children,i.mode,l,o.key)).return=i,i=r):((l=Uc(o.type,o.key,o.props,null,i.mode,l)).ref=xr(i,r,o),l.return=i,i=l)}return a(i);case w:e:{for(u=o.key;null!==r;){if(r.key===u){if(4===r.tag&&r.stateNode.containerInfo===o.containerInfo&&r.stateNode.implementation===o.implementation){n(i,r.sibling),(r=s(r,o.children||[])).return=i,i=r;break e}n(i,r);break}t(i,r),r=r.sibling}(r=qc(o,i.mode,l)).return=i,i=r}return a(i);case A:return e(i,r,(u=o._init)(o._payload),l)}if(te(o))return m(i,r,o,l);if(M(o))return g(i,r,o,l);_r(i,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==r&&6===r.tag?(n(i,r.sibling),(r=s(r,o)).return=i,i=r):(n(i,r),(r=Hc(o,i.mode,l)).return=i,i=r),a(i)):n(i,r)}}var Nr=Cr(!0),kr=Cr(!1),Er=Ns(null),Tr=null,Sr=null,Ir=null;function Pr(){Ir=Sr=Tr=null}function jr(e){var t=Er.current;ks(Er),e._currentValue=t}function Ar(e,t,n){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==i&&(i.childLanes|=t)):null!==i&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===n)break;e=e.return}}function Dr(e,t){Tr=e,Ir=Sr=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Na=!0),e.firstContext=null)}function Rr(e){var t=e._currentValue;if(Ir!==e)if(e={context:e,memoizedValue:t,next:null},null===Sr){if(null===Tr)throw Error(r(308));Sr=e,Tr.dependencies={lanes:0,firstContext:e}}else Sr=Sr.next=e;return t}var Mr=null;function Or(e){null===Mr?Mr=[e]:Mr.push(e)}function Lr(e,t,n,i){var s=t.interleaved;return null===s?(n.next=n,Or(t)):(n.next=s.next,s.next=n),t.interleaved=n,Fr(e,i)}function Fr(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var zr=!1;function Ur(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Vr(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Br(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Hr(e,t,n){var i=e.updateQueue;if(null===i)return null;if(i=i.shared,0!==(2&Dl)){var s=i.pending;return null===s?t.next=t:(t.next=s.next,s.next=t),i.pending=t,Fr(e,n)}return null===(s=i.interleaved)?(t.next=t,Or(i)):(t.next=s.next,s.next=t),i.interleaved=t,Fr(e,n)}function qr(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,vt(e,n)}}function Wr(e,t){var n=e.updateQueue,i=e.alternate;if(null!==i&&n===(i=i.updateQueue)){var s=null,r=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===r?s=r=o:r=r.next=o,n=n.next}while(null!==n);null===r?s=r=t:r=r.next=t}else s=r=t;return n={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Gr(e,t,n,i){var s=e.updateQueue;zr=!1;var r=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(null!==a){s.shared.pending=null;var l=a,c=l.next;l.next=null,null===o?r=c:o.next=c,o=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==r){var d=s.baseState;for(o=0,u=c=l=null,a=r;;){var h=a.lane,f=a.eventTime;if((i&h)===h){null!==u&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=e,m=a;switch(h=t,f=n,m.tag){case 1:if("function"===typeof(p=m.payload)){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(h="function"===typeof(p=m.payload)?p.call(f,d,h):p)||void 0===h)break e;d=L({},d,h);break e;case 2:zr=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(h=s.effects)?s.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=f,l=d):u=u.next=f,o|=h;if(null===(a=a.next)){if(null===(a=s.shared.pending))break;a=(h=a).next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}if(null===u&&(l=d),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,null!==(t=s.shared.interleaved)){s=t;do{o|=s.lane,s=s.next}while(s!==t)}else null===r&&(s.shared.lanes=0);Vl|=o,e.lanes=o,e.memoizedState=d}}function Kr(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var i=e[t],s=i.callback;if(null!==s){if(i.callback=null,i=n,"function"!==typeof s)throw Error(r(191,s));s.call(i)}}}var Yr={},Qr=Ns(Yr),Xr=Ns(Yr),$r=Ns(Yr);function Jr(e){if(e===Yr)throw Error(r(174));return e}function Zr(e,t){switch(Es($r,t),Es(Xr,e),Es(Qr,Yr),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ks(Qr),Es(Qr,t)}function eo(){ks(Qr),ks(Xr),ks($r)}function to(e){Jr($r.current);var t=Jr(Qr.current),n=le(t,e.type);t!==n&&(Es(Xr,e),Es(Qr,n))}function no(e){Xr.current===e&&(ks(Qr),ks(Xr))}var io=Ns(0);function so(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ro=[];function oo(){for(var e=0;e<ro.length;e++)ro[e]._workInProgressVersionPrimary=null;ro.length=0}var ao=x.ReactCurrentDispatcher,lo=x.ReactCurrentBatchConfig,co=0,uo=null,ho=null,fo=null,po=!1,mo=!1,go=0,yo=0;function vo(){throw Error(r(321))}function bo(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ai(e[n],t[n]))return!1;return!0}function xo(e,t,n,i,s,o){if(co=o,uo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ao.current=null===e||null===e.memoizedState?sa:ra,e=n(i,s),mo){o=0;do{if(mo=!1,go=0,25<=o)throw Error(r(301));o+=1,fo=ho=null,t.updateQueue=null,ao.current=oa,e=n(i,s)}while(mo)}if(ao.current=ia,t=null!==ho&&null!==ho.next,co=0,fo=ho=uo=null,po=!1,t)throw Error(r(300));return e}function wo(){var e=0!==go;return go=0,e}function Co(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===fo?uo.memoizedState=fo=e:fo=fo.next=e,fo}function No(){if(null===ho){var e=uo.alternate;e=null!==e?e.memoizedState:null}else e=ho.next;var t=null===fo?uo.memoizedState:fo.next;if(null!==t)fo=t,ho=e;else{if(null===e)throw Error(r(310));e={memoizedState:(ho=e).memoizedState,baseState:ho.baseState,baseQueue:ho.baseQueue,queue:ho.queue,next:null},null===fo?uo.memoizedState=fo=e:fo=fo.next=e}return fo}function ko(e,t){return"function"===typeof t?t(e):t}function Eo(e){var t=No(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var i=ho,s=i.baseQueue,o=n.pending;if(null!==o){if(null!==s){var a=s.next;s.next=o.next,o.next=a}i.baseQueue=s=o,n.pending=null}if(null!==s){o=s.next,i=i.baseState;var l=a=null,c=null,u=o;do{var d=u.lane;if((co&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),i=u.hasEagerState?u.eagerState:e(i,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,a=i):c=c.next=h,uo.lanes|=d,Vl|=d}u=u.next}while(null!==u&&u!==o);null===c?a=i:c.next=l,ai(i,t.memoizedState)||(Na=!0),t.memoizedState=i,t.baseState=a,t.baseQueue=c,n.lastRenderedState=i}if(null!==(e=n.interleaved)){s=e;do{o=s.lane,uo.lanes|=o,Vl|=o,s=s.next}while(s!==e)}else null===s&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function To(e){var t=No(),n=t.queue;if(null===n)throw Error(r(311));n.lastRenderedReducer=e;var i=n.dispatch,s=n.pending,o=t.memoizedState;if(null!==s){n.pending=null;var a=s=s.next;do{o=e(o,a.action),a=a.next}while(a!==s);ai(o,t.memoizedState)||(Na=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,i]}function So(){}function Io(e,t){var n=uo,i=No(),s=t(),o=!ai(i.memoizedState,s);if(o&&(i.memoizedState=s,Na=!0),i=i.queue,Vo(Ao.bind(null,n,i,e),[e]),i.getSnapshot!==t||o||null!==fo&&1&fo.memoizedState.tag){if(n.flags|=2048,Oo(9,jo.bind(null,n,i,s,t),void 0,null),null===Rl)throw Error(r(349));0!==(30&co)||Po(n,t,s)}return s}function Po(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=uo.updateQueue)?(t={lastEffect:null,stores:null},uo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function jo(e,t,n,i){t.value=n,t.getSnapshot=i,Do(t)&&Ro(e)}function Ao(e,t,n){return n(function(){Do(t)&&Ro(e)})}function Do(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ai(e,n)}catch(i){return!0}}function Ro(e){var t=Fr(e,1);null!==t&&lc(t,e,1,-1)}function Mo(e){var t=Co();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ko,lastRenderedState:e},t.queue=e,e=e.dispatch=Zo.bind(null,uo,e),[t.memoizedState,e]}function Oo(e,t,n,i){return e={tag:e,create:t,destroy:n,deps:i,next:null},null===(t=uo.updateQueue)?(t={lastEffect:null,stores:null},uo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(i=n.next,n.next=e,e.next=i,t.lastEffect=e),e}function Lo(){return No().memoizedState}function Fo(e,t,n,i){var s=Co();uo.flags|=e,s.memoizedState=Oo(1|t,n,void 0,void 0===i?null:i)}function zo(e,t,n,i){var s=No();i=void 0===i?null:i;var r=void 0;if(null!==ho){var o=ho.memoizedState;if(r=o.destroy,null!==i&&bo(i,o.deps))return void(s.memoizedState=Oo(t,n,r,i))}uo.flags|=e,s.memoizedState=Oo(1|t,n,r,i)}function Uo(e,t){return Fo(8390656,8,e,t)}function Vo(e,t){return zo(2048,8,e,t)}function Bo(e,t){return zo(4,2,e,t)}function Ho(e,t){return zo(4,4,e,t)}function qo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Wo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,zo(4,4,qo.bind(null,t,e),n)}function Go(){}function Ko(e,t){var n=No();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&bo(t,i[1])?i[0]:(n.memoizedState=[e,t],e)}function Yo(e,t){var n=No();t=void 0===t?null:t;var i=n.memoizedState;return null!==i&&null!==t&&bo(t,i[1])?i[0]:(e=e(),n.memoizedState=[e,t],e)}function Qo(e,t,n){return 0===(21&co)?(e.baseState&&(e.baseState=!1,Na=!0),e.memoizedState=n):(ai(n,t)||(n=mt(),uo.lanes|=n,Vl|=n,e.baseState=!0),t)}function Xo(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var i=lo.transition;lo.transition={};try{e(!1),t()}finally{bt=n,lo.transition=i}}function $o(){return No().memoizedState}function Jo(e,t,n){var i=ac(e);if(n={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null},ea(e))ta(t,n);else if(null!==(n=Lr(e,t,n,i))){lc(n,e,i,oc()),na(n,t,i)}}function Zo(e,t,n){var i=ac(e),s={lane:i,action:n,hasEagerState:!1,eagerState:null,next:null};if(ea(e))ta(t,s);else{var r=e.alternate;if(0===e.lanes&&(null===r||0===r.lanes)&&null!==(r=t.lastRenderedReducer))try{var o=t.lastRenderedState,a=r(o,n);if(s.hasEagerState=!0,s.eagerState=a,ai(a,o)){var l=t.interleaved;return null===l?(s.next=s,Or(t)):(s.next=l.next,l.next=s),void(t.interleaved=s)}}catch(Fs){}null!==(n=Lr(e,t,s,i))&&(lc(n,e,i,s=oc()),na(n,t,i))}}function ea(e){var t=e.alternate;return e===uo||null!==t&&t===uo}function ta(e,t){mo=po=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function na(e,t,n){if(0!==(4194240&n)){var i=t.lanes;n|=i&=e.pendingLanes,t.lanes=n,vt(e,n)}}var ia={readContext:Rr,useCallback:vo,useContext:vo,useEffect:vo,useImperativeHandle:vo,useInsertionEffect:vo,useLayoutEffect:vo,useMemo:vo,useReducer:vo,useRef:vo,useState:vo,useDebugValue:vo,useDeferredValue:vo,useTransition:vo,useMutableSource:vo,useSyncExternalStore:vo,useId:vo,unstable_isNewReconciler:!1},sa={readContext:Rr,useCallback:function(e,t){return Co().memoizedState=[e,void 0===t?null:t],e},useContext:Rr,useEffect:Uo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Fo(4194308,4,qo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Fo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Fo(4,2,e,t)},useMemo:function(e,t){var n=Co();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var i=Co();return t=void 0!==n?n(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Jo.bind(null,uo,e),[i.memoizedState,e]},useRef:function(e){return e={current:e},Co().memoizedState=e},useState:Mo,useDebugValue:Go,useDeferredValue:function(e){return Co().memoizedState=e},useTransition:function(){var e=Mo(!1),t=e[0];return e=Xo.bind(null,e[1]),Co().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var i=uo,s=Co();if(lr){if(void 0===n)throw Error(r(407));n=n()}else{if(n=t(),null===Rl)throw Error(r(349));0!==(30&co)||Po(i,t,n)}s.memoizedState=n;var o={value:n,getSnapshot:t};return s.queue=o,Uo(Ao.bind(null,i,o,e),[e]),i.flags|=2048,Oo(9,jo.bind(null,i,o,n,t),void 0,null),n},useId:function(){var e=Co(),t=Rl.identifierPrefix;if(lr){var n=tr;t=":"+t+"R"+(n=(er&~(1<<32-ot(er)-1)).toString(32)+n),0<(n=go++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=yo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ra={readContext:Rr,useCallback:Ko,useContext:Rr,useEffect:Vo,useImperativeHandle:Wo,useInsertionEffect:Bo,useLayoutEffect:Ho,useMemo:Yo,useReducer:Eo,useRef:Lo,useState:function(){return Eo(ko)},useDebugValue:Go,useDeferredValue:function(e){return Qo(No(),ho.memoizedState,e)},useTransition:function(){return[Eo(ko)[0],No().memoizedState]},useMutableSource:So,useSyncExternalStore:Io,useId:$o,unstable_isNewReconciler:!1},oa={readContext:Rr,useCallback:Ko,useContext:Rr,useEffect:Vo,useImperativeHandle:Wo,useInsertionEffect:Bo,useLayoutEffect:Ho,useMemo:Yo,useReducer:To,useRef:Lo,useState:function(){return To(ko)},useDebugValue:Go,useDeferredValue:function(e){var t=No();return null===ho?t.memoizedState=e:Qo(t,ho.memoizedState,e)},useTransition:function(){return[To(ko)[0],No().memoizedState]},useMutableSource:So,useSyncExternalStore:Io,useId:$o,unstable_isNewReconciler:!1};function aa(e,t){if(e&&e.defaultProps){for(var n in t=L({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function la(e,t,n,i){n=null===(n=n(i,t=e.memoizedState))||void 0===n?t:L({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ca={isMounted:function(e){return!!(e=e._reactInternals)&&Be(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var i=oc(),s=ac(e),r=Br(i,s);r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=Hr(e,r,s))&&(lc(t,e,s,i),qr(t,e,s))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var i=oc(),s=ac(e),r=Br(i,s);r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),null!==(t=Hr(e,r,s))&&(lc(t,e,s,i),qr(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=oc(),i=ac(e),s=Br(n,i);s.tag=2,void 0!==t&&null!==t&&(s.callback=t),null!==(t=Hr(e,s,i))&&(lc(t,e,i,n),qr(t,e,i))}};function ua(e,t,n,i,s,r,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(i,r,o):!t.prototype||!t.prototype.isPureReactComponent||(!li(n,i)||!li(s,r))}function da(e,t,n){var i=!1,s=Ts,r=t.contextType;return"object"===typeof r&&null!==r?r=Rr(r):(s=As(t)?Ps:Ss.current,r=(i=null!==(i=t.contextTypes)&&void 0!==i)?js(e,s):Ts),t=new t(n,r),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ca,e.stateNode=t,t._reactInternals=e,i&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=r),t}function ha(e,t,n,i){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,i),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,i),t.state!==e&&ca.enqueueReplaceState(t,t.state,null)}function fa(e,t,n,i){var s=e.stateNode;s.props=n,s.state=e.memoizedState,s.refs={},Ur(e);var r=t.contextType;"object"===typeof r&&null!==r?s.context=Rr(r):(r=As(t)?Ps:Ss.current,s.context=js(e,r)),s.state=e.memoizedState,"function"===typeof(r=t.getDerivedStateFromProps)&&(la(e,t,r,n),s.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(t=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),t!==s.state&&ca.enqueueReplaceState(s,s.state,null),Gr(e,n,s,i),s.state=e.memoizedState),"function"===typeof s.componentDidMount&&(e.flags|=4194308)}function pa(e,t){try{var n="",i=t;do{n+=V(i),i=i.return}while(i);var s=n}catch(r){s="\nError generating stack: "+r.message+"\n"+r.stack}return{value:e,source:t,stack:s,digest:null}}function ma(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ga(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ya="function"===typeof WeakMap?WeakMap:Map;function va(e,t,n){(n=Br(-1,n)).tag=3,n.payload={element:null};var i=t.value;return n.callback=function(){Ql||(Ql=!0,Xl=i),ga(0,t)},n}function ba(e,t,n){(n=Br(-1,n)).tag=3;var i=e.type.getDerivedStateFromError;if("function"===typeof i){var s=t.value;n.payload=function(){return i(s)},n.callback=function(){ga(0,t)}}var r=e.stateNode;return null!==r&&"function"===typeof r.componentDidCatch&&(n.callback=function(){ga(0,t),"function"!==typeof i&&(null===$l?$l=new Set([this]):$l.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function xa(e,t,n){var i=e.pingCache;if(null===i){i=e.pingCache=new ya;var s=new Set;i.set(t,s)}else void 0===(s=i.get(t))&&(s=new Set,i.set(t,s));s.has(n)||(s.add(n),e=jc.bind(null,e,t,n),t.then(e,e))}function _a(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function wa(e,t,n,i,s){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Br(-1,1)).tag=2,Hr(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=s,e)}var Ca=x.ReactCurrentOwner,Na=!1;function ka(e,t,n,i){t.child=null===e?kr(t,null,n,i):Nr(t,e.child,n,i)}function Ea(e,t,n,i,s){n=n.render;var r=t.ref;return Dr(t,s),i=xo(e,t,n,i,r,s),n=wo(),null===e||Na?(lr&&n&&sr(t),t.flags|=1,ka(e,t,i,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Qa(e,t,s))}function Ta(e,t,n,i,s){if(null===e){var r=n.type;return"function"!==typeof r||Fc(r)||void 0!==r.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Uc(n.type,null,i,t,t.mode,s)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=r,Sa(e,t,r,i,s))}if(r=e.child,0===(e.lanes&s)){var o=r.memoizedProps;if((n=null!==(n=n.compare)?n:li)(o,i)&&e.ref===t.ref)return Qa(e,t,s)}return t.flags|=1,(e=zc(r,i)).ref=t.ref,e.return=t,t.child=e}function Sa(e,t,n,i,s){if(null!==e){var r=e.memoizedProps;if(li(r,i)&&e.ref===t.ref){if(Na=!1,t.pendingProps=i=r,0===(e.lanes&s))return t.lanes=e.lanes,Qa(e,t,s);0!==(131072&e.flags)&&(Na=!0)}}return ja(e,t,n,i,s)}function Ia(e,t,n){var i=t.pendingProps,s=i.children,r=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Es(Fl,Ll),Ll|=n;else{if(0===(1073741824&n))return e=null!==r?r.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Es(Fl,Ll),Ll|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=null!==r?r.baseLanes:n,Es(Fl,Ll),Ll|=i}else null!==r?(i=r.baseLanes|n,t.memoizedState=null):i=n,Es(Fl,Ll),Ll|=i;return ka(e,t,s,n),t.child}function Pa(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function ja(e,t,n,i,s){var r=As(n)?Ps:Ss.current;return r=js(t,r),Dr(t,s),n=xo(e,t,n,i,r,s),i=wo(),null===e||Na?(lr&&i&&sr(t),t.flags|=1,ka(e,t,n,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Qa(e,t,s))}function Aa(e,t,n,i,s){if(As(n)){var r=!0;Ls(t)}else r=!1;if(Dr(t,s),null===t.stateNode)Ya(e,t),da(t,n,i),fa(t,n,i,s),i=!0;else if(null===e){var o=t.stateNode,a=t.memoizedProps;o.props=a;var l=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=Rr(c):c=js(t,c=As(n)?Ps:Ss.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;d||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==i||l!==c)&&ha(t,o,i,c),zr=!1;var h=t.memoizedState;o.state=h,Gr(t,i,o,s),l=t.memoizedState,a!==i||h!==l||Is.current||zr?("function"===typeof u&&(la(t,n,u,i),l=t.memoizedState),(a=zr||ua(t,n,a,i,h,l,c))?(d||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):("function"===typeof o.componentDidMount&&(t.flags|=4194308),i=!1)}else{o=t.stateNode,Vr(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:aa(t.type,a),o.props=c,d=t.pendingProps,h=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=Rr(l):l=js(t,l=As(n)?Ps:Ss.current);var f=n.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(a!==d||h!==l)&&ha(t,o,i,l),zr=!1,h=t.memoizedState,o.state=h,Gr(t,i,o,s);var p=t.memoizedState;a!==d||h!==p||Is.current||zr?("function"===typeof f&&(la(t,n,f,i),p=t.memoizedState),(c=zr||ua(t,n,c,i,h,p,l)||!1)?(u||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(i,p,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(i,p,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=p),o.props=i,o.state=p,o.context=l,i=c):("function"!==typeof o.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),i=!1)}return Da(e,t,n,i,r,s)}function Da(e,t,n,i,s,r){Pa(e,t);var o=0!==(128&t.flags);if(!i&&!o)return s&&zs(t,n,!1),Qa(e,t,r);i=t.stateNode,Ca.current=t;var a=o&&"function"!==typeof n.getDerivedStateFromError?null:i.render();return t.flags|=1,null!==e&&o?(t.child=Nr(t,e.child,null,r),t.child=Nr(t,null,a,r)):ka(e,t,a,r),t.memoizedState=i.state,s&&zs(t,n,!0),t.child}function Ra(e){var t=e.stateNode;t.pendingContext?Ms(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ms(0,t.context,!1),Zr(e,t.containerInfo)}function Ma(e,t,n,i,s){return yr(),vr(s),t.flags|=256,ka(e,t,n,i),t.child}var Oa,La,Fa,za,Ua={dehydrated:null,treeContext:null,retryLane:0};function Va(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ba(e,t,n){var i,s=t.pendingProps,o=io.current,a=!1,l=0!==(128&t.flags);if((i=l)||(i=(null===e||null!==e.memoizedState)&&0!==(2&o)),i?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Es(io,1&o),null===e)return fr(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=s.children,e=s.fallback,a?(s=t.mode,a=t.child,l={mode:"hidden",children:l},0===(1&s)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=Bc(l,s,0,null),e=Vc(e,s,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Va(n),t.memoizedState=Ua,e):Ha(t,l));if(null!==(o=e.memoizedState)&&null!==(i=o.dehydrated))return function(e,t,n,i,s,o,a){if(n)return 256&t.flags?(t.flags&=-257,qa(e,t,a,i=ma(Error(r(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=i.fallback,s=t.mode,i=Bc({mode:"visible",children:i.children},s,0,null),(o=Vc(o,s,a,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,0!==(1&t.mode)&&Nr(t,e.child,null,a),t.child.memoizedState=Va(a),t.memoizedState=Ua,o);if(0===(1&t.mode))return qa(e,t,a,null);if("$!"===s.data){if(i=s.nextSibling&&s.nextSibling.dataset)var l=i.dgst;return i=l,qa(e,t,a,i=ma(o=Error(r(419)),i,void 0))}if(l=0!==(a&e.childLanes),Na||l){if(null!==(i=Rl)){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(s=0!==(s&(i.suspendedLanes|a))?0:s)&&s!==o.retryLane&&(o.retryLane=s,Fr(e,s),lc(i,e,s,-1))}return _c(),qa(e,t,a,i=ma(Error(r(421))))}return"$?"===s.data?(t.flags|=128,t.child=e.child,t=Dc.bind(null,e),s._reactRetry=t,null):(e=o.treeContext,ar=cs(s.nextSibling),or=t,lr=!0,cr=null,null!==e&&(Xs[Js++]=er,Xs[Js++]=tr,Xs[Js++]=Zs,er=e.id,tr=e.overflow,Zs=t),t=Ha(t,i.children),t.flags|=4096,t)}(e,t,l,s,i,o,n);if(a){a=s.fallback,l=t.mode,i=(o=e.child).sibling;var c={mode:"hidden",children:s.children};return 0===(1&l)&&t.child!==o?((s=t.child).childLanes=0,s.pendingProps=c,t.deletions=null):(s=zc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==i?a=zc(i,a):(a=Vc(a,l,n,null)).flags|=2,a.return=t,s.return=t,s.sibling=a,t.child=s,s=a,a=t.child,l=null===(l=e.child.memoizedState)?Va(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~n,t.memoizedState=Ua,s}return e=(a=e.child).sibling,s=zc(a,{mode:"visible",children:s.children}),0===(1&t.mode)&&(s.lanes=n),s.return=t,s.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Ha(e,t){return(t=Bc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function qa(e,t,n,i){return null!==i&&vr(i),Nr(t,e.child,null,n),(e=Ha(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Wa(e,t,n){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),Ar(e.return,t,n)}function Ga(e,t,n,i,s){var r=e.memoizedState;null===r?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:s}:(r.isBackwards=t,r.rendering=null,r.renderingStartTime=0,r.last=i,r.tail=n,r.tailMode=s)}function Ka(e,t,n){var i=t.pendingProps,s=i.revealOrder,r=i.tail;if(ka(e,t,i.children,n),0!==(2&(i=io.current)))i=1&i|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Wa(e,n,t);else if(19===e.tag)Wa(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Es(io,i),0===(1&t.mode))t.memoizedState=null;else switch(s){case"forwards":for(n=t.child,s=null;null!==n;)null!==(e=n.alternate)&&null===so(e)&&(s=n),n=n.sibling;null===(n=s)?(s=t.child,t.child=null):(s=n.sibling,n.sibling=null),Ga(t,!1,s,n,r);break;case"backwards":for(n=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===so(e)){t.child=s;break}e=s.sibling,s.sibling=n,n=s,s=e}Ga(t,!0,n,null,r);break;case"together":Ga(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ya(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Qa(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Vl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(r(153));if(null!==t.child){for(n=zc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=zc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Xa(e,t){if(!lr)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var i=null;null!==n;)null!==n.alternate&&(i=n),n=n.sibling;null===i?t||null===e.tail?e.tail=null:e.tail.sibling=null:i.sibling=null}}function $a(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,i=0;if(t)for(var s=e.child;null!==s;)n|=s.lanes|s.childLanes,i|=14680064&s.subtreeFlags,i|=14680064&s.flags,s.return=e,s=s.sibling;else for(s=e.child;null!==s;)n|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=i,e.childLanes=n,t}function Ja(e,t,n){var i=t.pendingProps;switch(rr(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $a(t),null;case 1:case 17:return As(t.type)&&Ds(),$a(t),null;case 3:return i=t.stateNode,eo(),ks(Is),ks(Ss),oo(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null!==e&&null!==e.child||(mr(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==cr&&(hc(cr),cr=null))),La(e,t),$a(t),null;case 5:no(t);var s=Jr($r.current);if(n=t.type,null!==e&&null!=t.stateNode)Fa(e,t,n,i,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(null===t.stateNode)throw Error(r(166));return $a(t),null}if(e=Jr(Qr.current),mr(t)){i=t.stateNode,n=t.type;var o=t.memoizedProps;switch(i[hs]=t,i[fs]=o,e=0!==(1&t.mode),n){case"dialog":zi("cancel",i),zi("close",i);break;case"iframe":case"object":case"embed":zi("load",i);break;case"video":case"audio":for(s=0;s<Mi.length;s++)zi(Mi[s],i);break;case"source":zi("error",i);break;case"img":case"image":case"link":zi("error",i),zi("load",i);break;case"details":zi("toggle",i);break;case"input":X(i,o),zi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},zi("invalid",i);break;case"textarea":se(i,o),zi("invalid",i)}for(var l in ve(n,o),s=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"===typeof c?i.textContent!==c&&(!0!==o.suppressHydrationWarning&&Ji(i.textContent,c,e),s=["children",c]):"number"===typeof c&&i.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Ji(i.textContent,c,e),s=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&zi("scroll",i)}switch(n){case"input":G(i),Z(i,o,!0);break;case"textarea":G(i),oe(i);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(i.onclick=Zi)}i=s,t.updateQueue=i,null!==i&&(t.flags|=4)}else{l=9===s.nodeType?s:s.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof i.is?e=l.createElement(n,{is:i.is}):(e=l.createElement(n),"select"===n&&(l=e,i.multiple?l.multiple=!0:i.size&&(l.size=i.size))):e=l.createElementNS(e,n),e[hs]=t,e[fs]=i,Oa(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(n,i),n){case"dialog":zi("cancel",e),zi("close",e),s=i;break;case"iframe":case"object":case"embed":zi("load",e),s=i;break;case"video":case"audio":for(s=0;s<Mi.length;s++)zi(Mi[s],e);s=i;break;case"source":zi("error",e),s=i;break;case"img":case"image":case"link":zi("error",e),zi("load",e),s=i;break;case"details":zi("toggle",e),s=i;break;case"input":X(e,i),s=Q(e,i),zi("invalid",e);break;case"option":default:s=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},s=L({},i,{value:void 0}),zi("invalid",e);break;case"textarea":se(e,i),s=ie(e,i),zi("invalid",e)}for(o in ve(n,s),c=s)if(c.hasOwnProperty(o)){var u=c[o];"style"===o?ge(e,u):"dangerouslySetInnerHTML"===o?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===o?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(a.hasOwnProperty(o)?null!=u&&"onScroll"===o&&zi("scroll",e):null!=u&&b(e,o,u,l))}switch(n){case"input":G(e),Z(e,i,!1);break;case"textarea":G(e),oe(e);break;case"option":null!=i.value&&e.setAttribute("value",""+q(i.value));break;case"select":e.multiple=!!i.multiple,null!=(o=i.value)?ne(e,!!i.multiple,o,!1):null!=i.defaultValue&&ne(e,!!i.multiple,i.defaultValue,!0);break;default:"function"===typeof s.onClick&&(e.onclick=Zi)}switch(n){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return $a(t),null;case 6:if(e&&null!=t.stateNode)za(e,t,e.memoizedProps,i);else{if("string"!==typeof i&&null===t.stateNode)throw Error(r(166));if(n=Jr($r.current),Jr(Qr.current),mr(t)){if(i=t.stateNode,n=t.memoizedProps,i[hs]=t,(o=i.nodeValue!==n)&&null!==(e=or))switch(e.tag){case 3:Ji(i.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Ji(i.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(i=(9===n.nodeType?n:n.ownerDocument).createTextNode(i))[hs]=t,t.stateNode=i}return $a(t),null;case 13:if(ks(io),i=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(lr&&null!==ar&&0!==(1&t.mode)&&0===(128&t.flags))gr(),yr(),t.flags|=98560,o=!1;else if(o=mr(t),null!==i&&null!==i.dehydrated){if(null===e){if(!o)throw Error(r(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(r(317));o[hs]=t}else yr(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;$a(t),o=!1}else null!==cr&&(hc(cr),cr=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((i=null!==i)!==(null!==e&&null!==e.memoizedState)&&i&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&io.current)?0===zl&&(zl=3):_c())),null!==t.updateQueue&&(t.flags|=4),$a(t),null);case 4:return eo(),La(e,t),null===e&&Bi(t.stateNode.containerInfo),$a(t),null;case 10:return jr(t.type._context),$a(t),null;case 19:if(ks(io),null===(o=t.memoizedState))return $a(t),null;if(i=0!==(128&t.flags),null===(l=o.rendering))if(i)Xa(o,!1);else{if(0!==zl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=so(e))){for(t.flags|=128,Xa(o,!1),null!==(i=l.updateQueue)&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=n,n=t.child;null!==n;)e=i,(o=n).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Es(io,1&io.current|2),t.child}e=e.sibling}null!==o.tail&&$e()>Kl&&(t.flags|=128,i=!0,Xa(o,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=so(l))){if(t.flags|=128,i=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Xa(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!lr)return $a(t),null}else 2*$e()-o.renderingStartTime>Kl&&1073741824!==n&&(t.flags|=128,i=!0,Xa(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=o.last)?n.sibling=l:t.child=l,o.last=l)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=$e(),t.sibling=null,n=io.current,Es(io,i?1&n|2:1&n),t):($a(t),null);case 22:case 23:return yc(),i=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==i&&(t.flags|=8192),i&&0!==(1&t.mode)?0!==(1073741824&Ll)&&($a(t),6&t.subtreeFlags&&(t.flags|=8192)):$a(t),null;case 24:case 25:return null}throw Error(r(156,t.tag))}function Za(e,t){switch(rr(t),t.tag){case 1:return As(t.type)&&Ds(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return eo(),ks(Is),ks(Ss),oo(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return no(t),null;case 13:if(ks(io),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(r(340));yr()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return ks(io),null;case 4:return eo(),null;case 10:return jr(t.type._context),null;case 22:case 23:return yc(),null;default:return null}}Oa=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},La=function(){},Fa=function(e,t,n,i){var s=e.memoizedProps;if(s!==i){e=t.stateNode,Jr(Qr.current);var r,o=null;switch(n){case"input":s=Q(e,s),i=Q(e,i),o=[];break;case"select":s=L({},s,{value:void 0}),i=L({},i,{value:void 0}),o=[];break;case"textarea":s=ie(e,s),i=ie(e,i),o=[];break;default:"function"!==typeof s.onClick&&"function"===typeof i.onClick&&(e.onclick=Zi)}for(u in ve(n,i),n=null,s)if(!i.hasOwnProperty(u)&&s.hasOwnProperty(u)&&null!=s[u])if("style"===u){var l=s[u];for(r in l)l.hasOwnProperty(r)&&(n||(n={}),n[r]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in i){var c=i[u];if(l=null!=s?s[u]:void 0,i.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(r in l)!l.hasOwnProperty(r)||c&&c.hasOwnProperty(r)||(n||(n={}),n[r]="");for(r in c)c.hasOwnProperty(r)&&l[r]!==c[r]&&(n||(n={}),n[r]=c[r])}else n||(o||(o=[]),o.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&zi("scroll",e),o||l===c||(o=[])):(o=o||[]).push(u,c))}n&&(o=o||[]).push("style",n);var u=o;(t.updateQueue=u)&&(t.flags|=4)}},za=function(e,t,n,i){n!==i&&(t.flags|=4)};var el=!1,tl=!1,nl="function"===typeof WeakSet?WeakSet:Set,il=null;function sl(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(i){Pc(e,t,i)}else n.current=null}function rl(e,t,n){try{n()}catch(i){Pc(e,t,i)}}var ol=!1;function al(e,t,n){var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var s=i=i.next;do{if((s.tag&e)===e){var r=s.destroy;s.destroy=void 0,void 0!==r&&rl(t,n,r)}s=s.next}while(s!==i)}}function ll(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var i=n.create;n.destroy=i()}n=n.next}while(n!==t)}}function cl(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ul(e){var t=e.alternate;null!==t&&(e.alternate=null,ul(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hs],delete t[fs],delete t[ms],delete t[gs],delete t[ys])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function dl(e){return 5===e.tag||3===e.tag||4===e.tag}function hl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||dl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function fl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zi));else if(4!==i&&null!==(e=e.child))for(fl(e,t,n),e=e.sibling;null!==e;)fl(e,t,n),e=e.sibling}function pl(e,t,n){var i=e.tag;if(5===i||6===i)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==i&&null!==(e=e.child))for(pl(e,t,n),e=e.sibling;null!==e;)pl(e,t,n),e=e.sibling}var ml=null,gl=!1;function yl(e,t,n){for(n=n.child;null!==n;)vl(e,t,n),n=n.sibling}function vl(e,t,n){if(rt&&"function"===typeof rt.onCommitFiberUnmount)try{rt.onCommitFiberUnmount(st,n)}catch(a){}switch(n.tag){case 5:tl||sl(n,t);case 6:var i=ml,s=gl;ml=null,yl(e,t,n),gl=s,null!==(ml=i)&&(gl?(e=ml,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ml.removeChild(n.stateNode));break;case 18:null!==ml&&(gl?(e=ml,n=n.stateNode,8===e.nodeType?ls(e.parentNode,n):1===e.nodeType&&ls(e,n),Bt(e)):ls(ml,n.stateNode));break;case 4:i=ml,s=gl,ml=n.stateNode.containerInfo,gl=!0,yl(e,t,n),ml=i,gl=s;break;case 0:case 11:case 14:case 15:if(!tl&&(null!==(i=n.updateQueue)&&null!==(i=i.lastEffect))){s=i=i.next;do{var r=s,o=r.destroy;r=r.tag,void 0!==o&&(0!==(2&r)||0!==(4&r))&&rl(n,t,o),s=s.next}while(s!==i)}yl(e,t,n);break;case 1:if(!tl&&(sl(n,t),"function"===typeof(i=n.stateNode).componentWillUnmount))try{i.props=n.memoizedProps,i.state=n.memoizedState,i.componentWillUnmount()}catch(a){Pc(n,t,a)}yl(e,t,n);break;case 21:yl(e,t,n);break;case 22:1&n.mode?(tl=(i=tl)||null!==n.memoizedState,yl(e,t,n),tl=i):yl(e,t,n);break;default:yl(e,t,n)}}function bl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new nl),t.forEach(function(t){var i=Rc.bind(null,e,t);n.has(t)||(n.add(t),t.then(i,i))})}}function xl(e,t){var n=t.deletions;if(null!==n)for(var i=0;i<n.length;i++){var s=n[i];try{var o=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:ml=l.stateNode,gl=!1;break e;case 3:case 4:ml=l.stateNode.containerInfo,gl=!0;break e}l=l.return}if(null===ml)throw Error(r(160));vl(o,a,s),ml=null,gl=!1;var c=s.alternate;null!==c&&(c.return=null),s.return=null}catch(Fs){Pc(s,t,Fs)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)_l(t,e),t=t.sibling}function _l(e,t){var n=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(xl(t,e),wl(e),4&i){try{al(3,e,e.return),ll(3,e)}catch(g){Pc(e,e.return,g)}try{al(5,e,e.return)}catch(g){Pc(e,e.return,g)}}break;case 1:xl(t,e),wl(e),512&i&&null!==n&&sl(n,n.return);break;case 5:if(xl(t,e),wl(e),512&i&&null!==n&&sl(n,n.return),32&e.flags){var s=e.stateNode;try{he(s,"")}catch(g){Pc(e,e.return,g)}}if(4&i&&null!=(s=e.stateNode)){var o=e.memoizedProps,a=null!==n?n.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&$(s,o),be(l,a);var u=be(l,o);for(a=0;a<c.length;a+=2){var d=c[a],h=c[a+1];"style"===d?ge(s,h):"dangerouslySetInnerHTML"===d?de(s,h):"children"===d?he(s,h):b(s,d,h,u)}switch(l){case"input":J(s,o);break;case"textarea":re(s,o);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?ne(s,!!o.multiple,p,!1):f!==!!o.multiple&&(null!=o.defaultValue?ne(s,!!o.multiple,o.defaultValue,!0):ne(s,!!o.multiple,o.multiple?[]:"",!1))}s[fs]=o}catch(g){Pc(e,e.return,g)}}break;case 6:if(xl(t,e),wl(e),4&i){if(null===e.stateNode)throw Error(r(162));s=e.stateNode,o=e.memoizedProps;try{s.nodeValue=o}catch(g){Pc(e,e.return,g)}}break;case 3:if(xl(t,e),wl(e),4&i&&null!==n&&n.memoizedState.isDehydrated)try{Bt(t.containerInfo)}catch(g){Pc(e,e.return,g)}break;case 4:default:xl(t,e),wl(e);break;case 13:xl(t,e),wl(e),8192&(s=e.child).flags&&(o=null!==s.memoizedState,s.stateNode.isHidden=o,!o||null!==s.alternate&&null!==s.alternate.memoizedState||(Gl=$e())),4&i&&bl(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(tl=(u=tl)||d,xl(t,e),tl=u):xl(t,e),wl(e),8192&i){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(il=e,d=e.child;null!==d;){for(h=il=d;null!==il;){switch(p=(f=il).child,f.tag){case 0:case 11:case 14:case 15:al(4,f,f.return);break;case 1:sl(f,f.return);var m=f.stateNode;if("function"===typeof m.componentWillUnmount){i=f,n=f.return;try{t=i,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){Pc(i,n,g)}}break;case 5:sl(f,f.return);break;case 22:if(null!==f.memoizedState){El(h);continue}}null!==p?(p.return=f,il=p):El(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{s=h.stateNode,u?"function"===typeof(o=s.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=h.stateNode,a=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",a))}catch(g){Pc(e,e.return,g)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(g){Pc(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:xl(t,e),wl(e),4&i&&bl(e);case 21:}}function wl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(dl(n)){var i=n;break e}n=n.return}throw Error(r(160))}switch(i.tag){case 5:var s=i.stateNode;32&i.flags&&(he(s,""),i.flags&=-33),pl(e,hl(e),s);break;case 3:case 4:var o=i.stateNode.containerInfo;fl(e,hl(e),o);break;default:throw Error(r(161))}}catch(Rs){Pc(e,e.return,Rs)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Cl(e,t,n){il=e,Nl(e,t,n)}function Nl(e,t,n){for(var i=0!==(1&e.mode);null!==il;){var s=il,r=s.child;if(22===s.tag&&i){var o=null!==s.memoizedState||el;if(!o){var a=s.alternate,l=null!==a&&null!==a.memoizedState||tl;a=el;var c=tl;if(el=o,(tl=l)&&!c)for(il=s;null!==il;)l=(o=il).child,22===o.tag&&null!==o.memoizedState?Tl(s):null!==l?(l.return=o,il=l):Tl(s);for(;null!==r;)il=r,Nl(r,t,n),r=r.sibling;il=s,el=a,tl=c}kl(e)}else 0!==(8772&s.subtreeFlags)&&null!==r?(r.return=s,il=r):kl(e)}}function kl(e){for(;null!==il;){var t=il;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:tl||ll(5,t);break;case 1:var i=t.stateNode;if(4&t.flags&&!tl)if(null===n)i.componentDidMount();else{var s=t.elementType===t.type?n.memoizedProps:aa(t.type,n.memoizedProps);i.componentDidUpdate(s,n.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Kr(t,o,i);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Kr(t,a,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Bt(h)}}}break;default:throw Error(r(163))}tl||512&t.flags&&cl(t)}catch(Ks){Pc(t,t.return,Ks)}}if(t===e){il=null;break}if(null!==(n=t.sibling)){n.return=t.return,il=n;break}il=t.return}}function El(e){for(;null!==il;){var t=il;if(t===e){il=null;break}var n=t.sibling;if(null!==n){n.return=t.return,il=n;break}il=t.return}}function Tl(e){for(;null!==il;){var t=il;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ll(4,t)}catch(Rs){Pc(t,n,Rs)}break;case 1:var i=t.stateNode;if("function"===typeof i.componentDidMount){var s=t.return;try{i.componentDidMount()}catch(Rs){Pc(t,s,Rs)}}var r=t.return;try{cl(t)}catch(Rs){Pc(t,r,Rs)}break;case 5:var o=t.return;try{cl(t)}catch(Rs){Pc(t,o,Rs)}}}catch(Rs){Pc(t,t.return,Rs)}if(t===e){il=null;break}var a=t.sibling;if(null!==a){a.return=t.return,il=a;break}il=t.return}}var Sl,Il=Math.ceil,Pl=x.ReactCurrentDispatcher,jl=x.ReactCurrentOwner,Al=x.ReactCurrentBatchConfig,Dl=0,Rl=null,Ml=null,Ol=0,Ll=0,Fl=Ns(0),zl=0,Ul=null,Vl=0,Bl=0,Hl=0,ql=null,Wl=null,Gl=0,Kl=1/0,Yl=null,Ql=!1,Xl=null,$l=null,Jl=!1,Zl=null,ec=0,nc=0,ic=null,sc=-1,rc=0;function oc(){return 0!==(6&Dl)?$e():-1!==sc?sc:sc=$e()}function ac(e){return 0===(1&e.mode)?1:0!==(2&Dl)&&0!==Ol?Ol&-Ol:null!==br.transition?(0===rc&&(rc=mt()),rc):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function lc(e,t,n,i){if(50<nc)throw nc=0,ic=null,Error(r(185));yt(e,n,i),0!==(2&Dl)&&e===Rl||(e===Rl&&(0===(2&Dl)&&(Bl|=n),4===zl&&fc(e,Ol)),cc(e,i),1===n&&0===Dl&&0===(1&t.mode)&&(Kl=$e()+500,Vs&&qs()))}function cc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,i=e.pingedLanes,s=e.expirationTimes,r=e.pendingLanes;0<r;){var o=31-ot(r),a=1<<o,l=s[o];-1===l?0!==(a&n)&&0===(a&i)||(s[o]=ft(a,t)):l<=t&&(e.expiredLanes|=a),r&=~a}}(e,t);var i=ht(e,e===Rl?Ol:0);if(0===i)null!==n&&Ye(n),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(null!=n&&Ye(n),1===t)0===e.tag?function(e){Vs=!0,Hs(e)}(pc.bind(null,e)):Hs(pc.bind(null,e)),os(function(){0===(6&Dl)&&qs()}),n=null;else{switch(xt(i)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=it}n=Mc(n,uc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function uc(e,t){if(sc=-1,rc=0,0!==(6&Dl))throw Error(r(327));var n=e.callbackNode;if(Sc()&&e.callbackNode!==n)return null;var i=ht(e,e===Rl?Ol:0);if(0===i)return null;if(0!==(30&i)||0!==(i&e.expiredLanes)||t)t=wc(e,i);else{t=i;var s=Dl;Dl|=2;var o=xc();for(Rl===e&&Ol===t||(Yl=null,Kl=$e()+500,vc(e,t));;)try{Nc();break}catch(l){bc(e,l)}Pr(),Pl.current=o,Dl=s,null!==Ml?t=0:(Rl=null,Ol=0,t=zl)}if(0!==t){if(2===t&&(0!==(s=pt(e))&&(i=s,t=dc(e,s))),1===t)throw n=Ul,vc(e,0),fc(e,i),cc(e,$e()),n;if(6===t)fc(e,i);else{if(s=e.current.alternate,0===(30&i)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var i=0;i<n.length;i++){var s=n[i],r=s.getSnapshot;s=s.value;try{if(!ai(r(),s))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(s)&&(2===(t=wc(e,i))&&(0!==(o=pt(e))&&(i=o,t=dc(e,o))),1===t))throw n=Ul,vc(e,0),fc(e,i),cc(e,$e()),n;switch(e.finishedWork=s,e.finishedLanes=i,t){case 0:case 1:throw Error(r(345));case 2:case 5:Tc(e,Wl,Yl);break;case 3:if(fc(e,i),(130023424&i)===i&&10<(t=Gl+500-$e())){if(0!==ht(e,0))break;if(((s=e.suspendedLanes)&i)!==i){oc(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=is(Tc.bind(null,e,Wl,Yl),t);break}Tc(e,Wl,Yl);break;case 4:if(fc(e,i),(4194240&i)===i)break;for(t=e.eventTimes,s=-1;0<i;){var a=31-ot(i);o=1<<a,(a=t[a])>s&&(s=a),i&=~o}if(i=s,10<(i=(120>(i=$e()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Il(i/1960))-i)){e.timeoutHandle=is(Tc.bind(null,e,Wl,Yl),i);break}Tc(e,Wl,Yl);break;default:throw Error(r(329))}}}return cc(e,$e()),e.callbackNode===n?uc.bind(null,e):null}function dc(e,t){var n=ql;return e.current.memoizedState.isDehydrated&&(vc(e,t).flags|=256),2!==(e=wc(e,t))&&(t=Wl,Wl=n,null!==t&&hc(t)),e}function hc(e){null===Wl?Wl=e:Wl.push.apply(Wl,e)}function fc(e,t){for(t&=~Hl,t&=~Bl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),i=1<<n;e[n]=-1,t&=~i}}function pc(e){if(0!==(6&Dl))throw Error(r(327));Sc();var t=ht(e,0);if(0===(1&t))return cc(e,$e()),null;var n=wc(e,t);if(0!==e.tag&&2===n){var i=pt(e);0!==i&&(t=i,n=dc(e,i))}if(1===n)throw n=Ul,vc(e,0),fc(e,t),cc(e,$e()),n;if(6===n)throw Error(r(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Tc(e,Wl,Yl),cc(e,$e()),null}function mc(e,t){var n=Dl;Dl|=1;try{return e(t)}finally{0===(Dl=n)&&(Kl=$e()+500,Vs&&qs())}}function gc(e){null!==Zl&&0===Zl.tag&&0===(6&Dl)&&Sc();var t=Dl;Dl|=1;var n=Al.transition,i=bt;try{if(Al.transition=null,bt=1,e)return e()}finally{bt=i,Al.transition=n,0===(6&(Dl=t))&&qs()}}function yc(){Ll=Fl.current,ks(Fl)}function vc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ss(n)),null!==Ml)for(n=Ml.return;null!==n;){var i=n;switch(rr(i),i.tag){case 1:null!==(i=i.type.childContextTypes)&&void 0!==i&&Ds();break;case 3:eo(),ks(Is),ks(Ss),oo();break;case 5:no(i);break;case 4:eo();break;case 13:case 19:ks(io);break;case 10:jr(i.type._context);break;case 22:case 23:yc()}n=n.return}if(Rl=e,Ml=e=zc(e.current,null),Ol=Ll=t,zl=0,Ul=null,Hl=Bl=Vl=0,Wl=ql=null,null!==Mr){for(t=0;t<Mr.length;t++)if(null!==(i=(n=Mr[t]).interleaved)){n.interleaved=null;var s=i.next,r=n.pending;if(null!==r){var o=r.next;r.next=s,i.next=o}n.pending=i}Mr=null}return e}function bc(e,t){for(;;){var n=Ml;try{if(Pr(),ao.current=ia,po){for(var i=uo.memoizedState;null!==i;){var s=i.queue;null!==s&&(s.pending=null),i=i.next}po=!1}if(co=0,fo=ho=uo=null,mo=!1,go=0,jl.current=null,null===n||null===n.return){zl=1,Ul=t,Ml=null;break}e:{var o=e,a=n.return,l=n,c=t;if(t=Ol,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,d=l,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=_a(a);if(null!==p){p.flags&=-257,wa(p,a,l,0,t),1&p.mode&&xa(o,u,t),c=u;var m=(t=p).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){xa(o,u,t),_c();break e}c=Error(r(426))}else if(lr&&1&l.mode){var y=_a(a);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),wa(y,a,l,0,t),vr(pa(c,l));break e}}o=c=pa(c,l),4!==zl&&(zl=2),null===ql?ql=[o]:ql.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Wr(o,va(0,c,t));break e;case 1:l=c;var v=o.type,b=o.stateNode;if(0===(128&o.flags)&&("function"===typeof v.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===$l||!$l.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t,Wr(o,ba(o,l,t));break e}}o=o.return}while(null!==o)}Ec(n)}catch($s){t=$s,Ml===n&&null!==n&&(Ml=n=n.return);continue}break}}function xc(){var e=Pl.current;return Pl.current=ia,null===e?ia:e}function _c(){0!==zl&&3!==zl&&2!==zl||(zl=4),null===Rl||0===(268435455&Vl)&&0===(268435455&Bl)||fc(Rl,Ol)}function wc(e,t){var n=Dl;Dl|=2;var i=xc();for(Rl===e&&Ol===t||(Yl=null,vc(e,t));;)try{Cc();break}catch(s){bc(e,s)}if(Pr(),Dl=n,Pl.current=i,null!==Ml)throw Error(r(261));return Rl=null,Ol=0,zl}function Cc(){for(;null!==Ml;)kc(Ml)}function Nc(){for(;null!==Ml&&!Qe();)kc(Ml)}function kc(e){var t=Sl(e.alternate,e,Ll);e.memoizedProps=e.pendingProps,null===t?Ec(e):Ml=t,jl.current=null}function Ec(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ja(n,t,Ll)))return void(Ml=n)}else{if(null!==(n=Za(n,t)))return n.flags&=32767,void(Ml=n);if(null===e)return zl=6,void(Ml=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ml=t);Ml=t=e}while(null!==t);0===zl&&(zl=5)}function Tc(e,t,n){var i=bt,s=Al.transition;try{Al.transition=null,bt=1,function(e,t,n,i){do{Sc()}while(null!==Zl);if(0!==(6&Dl))throw Error(r(327));n=e.finishedWork;var s=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(r(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<n;){var s=31-ot(n),r=1<<s;t[s]=0,i[s]=-1,e[s]=-1,n&=~r}}(e,o),e===Rl&&(Ml=Rl=null,Ol=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Jl||(Jl=!0,Mc(tt,function(){return Sc(),null})),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Al.transition,Al.transition=null;var a=bt;bt=1;var l=Dl;Dl|=4,jl.current=null,function(e,t){if(es=qt,fi(e=hi())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var i=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(i&&0!==i.rangeCount){n=i.anchorNode;var s=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{n.nodeType,o.nodeType}catch(_o){n=null;break e}var a=0,l=-1,c=-1,u=0,d=0,h=e,f=null;t:for(;;){for(var p;h!==n||0!==s&&3!==h.nodeType||(l=a+s),h!==o||0!==i&&3!==h.nodeType||(c=a+i),3===h.nodeType&&(a+=h.nodeValue.length),null!==(p=h.firstChild);)f=h,h=p;for(;;){if(h===e)break t;if(f===n&&++u===s&&(l=a),f===o&&++d===i&&(c=a),null!==(p=h.nextSibling))break;f=(h=f).parentNode}h=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ts={focusedElem:e,selectionRange:n},qt=!1,il=t;null!==il;)if(e=(t=il).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,il=e;else for(;null!==il;){t=il;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,y=m.memoizedState,v=t.stateNode,b=v.getSnapshotBeforeUpdate(t.elementType===t.type?g:aa(t.type,g),y);v.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(r(163))}}catch(_o){Pc(t,t.return,_o)}if(null!==(e=t.sibling)){e.return=t.return,il=e;break}il=t.return}m=ol,ol=!1}(e,n),_l(n,e),pi(ts),qt=!!es,ts=es=null,e.current=n,Cl(n,e,s),Xe(),Dl=l,bt=a,Al.transition=o}else e.current=n;if(Jl&&(Jl=!1,Zl=e,ec=s),o=e.pendingLanes,0===o&&($l=null),function(e){if(rt&&"function"===typeof rt.onCommitFiberRoot)try{rt.onCommitFiberRoot(st,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),cc(e,$e()),null!==t)for(i=e.onRecoverableError,n=0;n<t.length;n++)s=t[n],i(s.value,{componentStack:s.stack,digest:s.digest});if(Ql)throw Ql=!1,e=Xl,Xl=null,e;0!==(1&ec)&&0!==e.tag&&Sc(),o=e.pendingLanes,0!==(1&o)?e===ic?nc++:(nc=0,ic=e):nc=0,qs()}(e,t,n,i)}finally{Al.transition=s,bt=i}return null}function Sc(){if(null!==Zl){var e=xt(ec),t=Al.transition,n=bt;try{if(Al.transition=null,bt=16>e?16:e,null===Zl)var i=!1;else{if(e=Zl,Zl=null,ec=0,0!==(6&Dl))throw Error(r(331));var s=Dl;for(Dl|=4,il=e.current;null!==il;){var o=il,a=o.child;if(0!==(16&il.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(il=u;null!==il;){var d=il;switch(d.tag){case 0:case 11:case 15:al(8,d,o)}var h=d.child;if(null!==h)h.return=d,il=h;else for(;null!==il;){var f=(d=il).sibling,p=d.return;if(ul(d),d===u){il=null;break}if(null!==f){f.return=p,il=f;break}il=p}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}il=o}}if(0!==(2064&o.subtreeFlags)&&null!==a)a.return=o,il=a;else e:for(;null!==il;){if(0!==(2048&(o=il).flags))switch(o.tag){case 0:case 11:case 15:al(9,o,o.return)}var v=o.sibling;if(null!==v){v.return=o.return,il=v;break e}il=o.return}}var b=e.current;for(il=b;null!==il;){var x=(a=il).child;if(0!==(2064&a.subtreeFlags)&&null!==x)x.return=a,il=x;else e:for(a=b;null!==il;){if(0!==(2048&(l=il).flags))try{switch(l.tag){case 0:case 11:case 15:ll(9,l)}}catch($s){Pc(l,l.return,$s)}if(l===a){il=null;break e}var _=l.sibling;if(null!==_){_.return=l.return,il=_;break e}il=l.return}}if(Dl=s,qs(),rt&&"function"===typeof rt.onPostCommitFiberRoot)try{rt.onPostCommitFiberRoot(st,e)}catch($s){}i=!0}return i}finally{bt=n,Al.transition=t}}return!1}function Ic(e,t,n){e=Hr(e,t=va(0,t=pa(n,t),1),1),t=oc(),null!==e&&(yt(e,1,t),cc(e,t))}function Pc(e,t,n){if(3===e.tag)Ic(e,e,n);else for(;null!==t;){if(3===t.tag){Ic(t,e,n);break}if(1===t.tag){var i=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof i.componentDidCatch&&(null===$l||!$l.has(i))){t=Hr(t,e=ba(t,e=pa(n,e),1),1),e=oc(),null!==t&&(yt(t,1,e),cc(t,e));break}}t=t.return}}function jc(e,t,n){var i=e.pingCache;null!==i&&i.delete(t),t=oc(),e.pingedLanes|=e.suspendedLanes&n,Rl===e&&(Ol&n)===n&&(4===zl||3===zl&&(130023424&Ol)===Ol&&500>$e()-Gl?vc(e,0):Hl|=n),cc(e,t)}function Ac(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=oc();null!==(e=Fr(e,t))&&(yt(e,t,n),cc(e,n))}function Dc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ac(e,n)}function Rc(e,t){var n=0;switch(e.tag){case 13:var i=e.stateNode,s=e.memoizedState;null!==s&&(n=s.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(r(314))}null!==i&&i.delete(t),Ac(e,n)}function Mc(e,t){return Ke(e,t)}function Oc(e,t,n,i){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lc(e,t,n,i){return new Oc(e,t,n,i)}function Fc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function zc(e,t){var n=e.alternate;return null===n?((n=Lc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Uc(e,t,n,i,s,o){var a=2;if(i=e,"function"===typeof e)Fc(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case C:return Vc(n.children,s,o,t);case N:a=8,s|=8;break;case k:return(e=Lc(12,n,t,2|s)).elementType=k,e.lanes=o,e;case I:return(e=Lc(13,n,t,s)).elementType=I,e.lanes=o,e;case P:return(e=Lc(19,n,t,s)).elementType=P,e.lanes=o,e;case D:return Bc(n,s,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case E:a=10;break e;case T:a=9;break e;case S:a=11;break e;case j:a=14;break e;case A:a=16,i=null;break e}throw Error(r(130,null==e?e:typeof e,""))}return(t=Lc(a,n,t,s)).elementType=e,t.type=i,t.lanes=o,t}function Vc(e,t,n,i){return(e=Lc(7,e,i,t)).lanes=n,e}function Bc(e,t,n,i){return(e=Lc(22,e,i,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Hc(e,t,n){return(e=Lc(6,e,null,t)).lanes=n,e}function qc(e,t,n){return(t=Lc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Wc(e,t,n,i,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Gc(e,t,n,i,s,r,o,a,l){return e=new Wc(e,t,n,a,l),1===t?(t=1,!0===r&&(t|=8)):t=0,r=Lc(3,null,null,t),e.current=r,r.stateNode=e,r.memoizedState={element:i,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ur(r),e}function Kc(e){if(!e)return Ts;e:{if(Be(e=e._reactInternals)!==e||1!==e.tag)throw Error(r(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(As(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(r(171))}if(1===e.tag){var n=e.type;if(As(n))return Os(e,n,t)}return t}function Yc(e,t,n,i,s,r,o,a,l){return(e=Gc(n,i,!0,e,0,r,0,a,l)).context=Kc(null),n=e.current,(r=Br(i=oc(),s=ac(n))).callback=void 0!==t&&null!==t?t:null,Hr(n,r,s),e.current.lanes=s,yt(e,s,i),cc(e,i),e}function Qc(e,t,n,i){var s=t.current,r=oc(),o=ac(s);return n=Kc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Br(r,o)).payload={element:e},null!==(i=void 0===i?null:i)&&(t.callback=i),null!==(e=Hr(s,t,o))&&(lc(e,s,o,r),qr(e,s,o)),o}function Xc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function $c(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Jc(e,t){$c(e,t),(e=e.alternate)&&$c(e,t)}Sl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Is.current)Na=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return Na=!1,function(e,t,n){switch(t.tag){case 3:Ra(t),yr();break;case 5:to(t);break;case 1:As(t.type)&&Ls(t);break;case 4:Zr(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,s=t.memoizedProps.value;Es(Er,i._currentValue),i._currentValue=s;break;case 13:if(null!==(i=t.memoizedState))return null!==i.dehydrated?(Es(io,1&io.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ba(e,t,n):(Es(io,1&io.current),null!==(e=Qa(e,t,n))?e.sibling:null);Es(io,1&io.current);break;case 19:if(i=0!==(n&t.childLanes),0!==(128&e.flags)){if(i)return Ka(e,t,n);t.flags|=128}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),Es(io,io.current),i)break;return null;case 22:case 23:return t.lanes=0,Ia(e,t,n)}return Qa(e,t,n)}(e,t,n);Na=0!==(131072&e.flags)}else Na=!1,lr&&0!==(1048576&t.flags)&&ir(t,Qs,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;Ya(e,t),e=t.pendingProps;var s=js(t,Ss.current);Dr(t,n),s=xo(null,t,i,e,s,n);var o=wo();return t.flags|=1,"object"===typeof s&&null!==s&&"function"===typeof s.render&&void 0===s.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,As(i)?(o=!0,Ls(t)):o=!1,t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,Ur(t),s.updater=ca,t.stateNode=s,s._reactInternals=t,fa(t,i,e,n),t=Da(null,t,i,!0,o,n)):(t.tag=0,lr&&o&&sr(t),ka(null,t,s,n),t=t.child),t;case 16:i=t.elementType;e:{switch(Ya(e,t),e=t.pendingProps,i=(s=i._init)(i._payload),t.type=i,s=t.tag=function(e){if("function"===typeof e)return Fc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===S)return 11;if(e===j)return 14}return 2}(i),e=aa(i,e),s){case 0:t=ja(null,t,i,e,n);break e;case 1:t=Aa(null,t,i,e,n);break e;case 11:t=Ea(null,t,i,e,n);break e;case 14:t=Ta(null,t,i,aa(i.type,e),n);break e}throw Error(r(306,i,""))}return t;case 0:return i=t.type,s=t.pendingProps,ja(e,t,i,s=t.elementType===i?s:aa(i,s),n);case 1:return i=t.type,s=t.pendingProps,Aa(e,t,i,s=t.elementType===i?s:aa(i,s),n);case 3:e:{if(Ra(t),null===e)throw Error(r(387));i=t.pendingProps,s=(o=t.memoizedState).element,Vr(e,t),Gr(t,i,null,n);var a=t.memoizedState;if(i=a.element,o.isDehydrated){if(o={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Ma(e,t,i,n,s=pa(Error(r(423)),t));break e}if(i!==s){t=Ma(e,t,i,n,s=pa(Error(r(424)),t));break e}for(ar=cs(t.stateNode.containerInfo.firstChild),or=t,lr=!0,cr=null,n=kr(t,null,i,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(yr(),i===s){t=Qa(e,t,n);break e}ka(e,t,i,n)}t=t.child}return t;case 5:return to(t),null===e&&fr(t),i=t.type,s=t.pendingProps,o=null!==e?e.memoizedProps:null,a=s.children,ns(i,s)?a=null:null!==o&&ns(i,o)&&(t.flags|=32),Pa(e,t),ka(e,t,a,n),t.child;case 6:return null===e&&fr(t),null;case 13:return Ba(e,t,n);case 4:return Zr(t,t.stateNode.containerInfo),i=t.pendingProps,null===e?t.child=Nr(t,null,i,n):ka(e,t,i,n),t.child;case 11:return i=t.type,s=t.pendingProps,Ea(e,t,i,s=t.elementType===i?s:aa(i,s),n);case 7:return ka(e,t,t.pendingProps,n),t.child;case 8:case 12:return ka(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(i=t.type._context,s=t.pendingProps,o=t.memoizedProps,a=s.value,Es(Er,i._currentValue),i._currentValue=a,null!==o)if(ai(o.value,a)){if(o.children===s.children&&!Is.current){t=Qa(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){a=o.child;for(var c=l.firstContext;null!==c;){if(c.context===i){if(1===o.tag){(c=Br(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Ar(o.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===o.tag)a=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(a=o.return))throw Error(r(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Ar(a,n,t),a=o.sibling}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===t){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}ka(e,t,s.children,n),t=t.child}return t;case 9:return s=t.type,i=t.pendingProps.children,Dr(t,n),i=i(s=Rr(s)),t.flags|=1,ka(e,t,i,n),t.child;case 14:return s=aa(i=t.type,t.pendingProps),Ta(e,t,i,s=aa(i.type,s),n);case 15:return Sa(e,t,t.type,t.pendingProps,n);case 17:return i=t.type,s=t.pendingProps,s=t.elementType===i?s:aa(i,s),Ya(e,t),t.tag=1,As(i)?(e=!0,Ls(t)):e=!1,Dr(t,n),da(t,i,s),fa(t,i,s,n),Da(null,t,i,!0,e,n);case 19:return Ka(e,t,n);case 22:return Ia(e,t,n)}throw Error(r(156,t.tag))};var Zc="function"===typeof reportError?reportError:function(e){console.error(e)};function eu(e){this._internalRoot=e}function tu(e){this._internalRoot=e}function nu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function iu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function su(){}function ru(e,t,n,i,s){var r=n._reactRootContainer;if(r){var o=r;if("function"===typeof s){var a=s;s=function(){var e=Xc(o);a.call(e)}}Qc(t,o,e,s)}else o=function(e,t,n,i,s){if(s){if("function"===typeof i){var r=i;i=function(){var e=Xc(o);r.call(e)}}var o=Yc(t,i,e,0,null,!1,0,"",su);return e._reactRootContainer=o,e[ps]=o.current,Bi(8===e.nodeType?e.parentNode:e),gc(),o}for(;s=e.lastChild;)e.removeChild(s);if("function"===typeof i){var a=i;i=function(){var e=Xc(l);a.call(e)}}var l=Gc(e,0,!1,null,0,!1,0,"",su);return e._reactRootContainer=l,e[ps]=l.current,Bi(8===e.nodeType?e.parentNode:e),gc(function(){Qc(t,l,n,i)}),l}(n,t,e,s,i);return Xc(o)}tu.prototype.render=eu.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(r(409));Qc(e,t,null,null)},tu.prototype.unmount=eu.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;gc(function(){Qc(null,e,null,null)}),t[ps]=null}},tu.prototype.unstable_scheduleHydration=function(e){if(e){var t=Nt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Lt(e)}},_t=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(vt(t,1|n),cc(t,$e()),0===(6&Dl)&&(Kl=$e()+500,qs()))}break;case 13:gc(function(){var t=Fr(e,1);if(null!==t){var n=oc();lc(t,e,1,n)}}),Jc(e,1)}},wt=function(e){if(13===e.tag){var t=Fr(e,134217728);if(null!==t)lc(t,e,134217728,oc());Jc(e,134217728)}},Ct=function(e){if(13===e.tag){var t=ac(e),n=Fr(e,t);if(null!==n)lc(n,e,t,oc());Jc(e,t)}},Nt=function(){return bt},kt=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},we=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var i=n[t];if(i!==e&&i.form===e.form){var s=_s(i);if(!s)throw Error(r(90));K(i),J(i,s)}}}break;case"textarea":re(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Se=mc,Ie=gc;var ou={usingClientEntryPoint:!1,Events:[bs,xs,_s,Ee,Te,mc]},au={findFiberByHostInstance:vs,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},lu={bundleType:au.bundleType,version:au.version,rendererPackageName:au.rendererPackageName,rendererConfig:au.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:au.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var cu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cu.isDisabled&&cu.supportsFiber)try{st=cu.inject(lu),rt=cu}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ou,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!nu(t))throw Error(r(200));return function(e,t,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!nu(e))throw Error(r(299));var n=!1,i="",s=Zc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(i=t.identifierPrefix),void 0!==t.onRecoverableError&&(s=t.onRecoverableError)),t=Gc(e,1,!1,null,0,n,0,i,s),e[ps]=t.current,Bi(8===e.nodeType?e.parentNode:e),new eu(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(r(188));throw e=Object.keys(e).join(","),Error(r(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return gc(e)},t.hydrate=function(e,t,n){if(!iu(t))throw Error(r(200));return ru(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!nu(e))throw Error(r(405));var i=null!=n&&n.hydratedSources||null,s=!1,o="",a=Zc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(s=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=Yc(t,null,e,1,null!=n?n:null,s,0,o,a),e[ps]=t.current,Bi(e),i)for(e=0;e<i.length;e++)s=(s=(n=i[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,s]:t.mutableSourceEagerHydrationData.push(n,s);return new tu(t)},t.render=function(e,t,n){if(!iu(t))throw Error(r(200));return ru(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!iu(e))throw Error(r(40));return!!e._reactRootContainer&&(gc(function(){ru(null,null,e,!1,function(){e._reactRootContainer=null,e[ps]=null})}),!0)},t.unstable_batchedUpdates=mc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,i){if(!iu(n))throw Error(r(200));if(null==e||void 0===e._reactInternals)throw Error(r(38));return ru(e,t,n,!1,i)},t.version="18.3.1-next-f1338f8080-20240426"},853:(e,t,n)=>{e.exports=n(234)},950:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}();var i=n(43),s=n(391);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function a(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const u=!1,d=!1,h="${JSCORE_VERSION}",f=function(e,t){if(!e)throw p(t)},p=function(e){return new Error("Firebase Database ("+h+") INTERNAL ASSERT FAILED: "+e)},m=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296===(64512&s)&&i+1<e.length&&56320===(64512&e.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++i)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},g={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<e.length;s+=3){const t=e[s],r=s+1<e.length,o=r?e[s+1]:0,a=s+2<e.length,l=a?e[s+2]:0,c=t>>2,u=(3&t)<<4|o>>4;let d=(15&o)<<2|l>>6,h=63&l;a||(h=64,r||(d=64)),i.push(n[c],n[u],n[d],n[h])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(m(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const s=e[n++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=e[n++];t[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(r>>10)),t[i++]=String.fromCharCode(56320+(1023&r))}else{const r=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<e.length;){const t=n[e.charAt(s++)],r=s<e.length?n[e.charAt(s)]:0;++s;const o=s<e.length?n[e.charAt(s)]:64;++s;const a=s<e.length?n[e.charAt(s)]:64;if(++s,null==t||null==r||null==o||null==a)throw new y;const l=t<<2|r>>4;if(i.push(l),64!==o){const e=r<<4&240|o>>2;if(i.push(e),64!==a){const e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class y extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const v=function(e){const t=m(e);return g.encodeByteArray(t,!0)},b=function(e){return v(e).replace(/\./g,"")},x=function(e){try{return g.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function _(e){return w(void 0,e)}function w(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&C(n)&&(e[n]=w(e[n],t[n]));return e}function C(e){return"__proto__"!==e}const N=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,k=()=>{try{return N()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"/portal",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&x(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},E=e=>{var t,n;return null===(n=null===(t=k())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},T=e=>{const t=E(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},S=()=>{var e;return null===(e=k())||void 0===e?void 0:e.config},I=e=>{var t;return null===(t=k())||void 0===t?void 0:t["_".concat(e)]};class P{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function j(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[b(JSON.stringify({alg:"none",type:"JWT"})),b(JSON.stringify(r)),""].join(".")}function A(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function D(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(A())}function R(){var e;const t=null===(e=k())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(i){return!1}}function M(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function O(){return!0===u||!0===d}function L(){try{return"object"===typeof indexedDB}catch(e){return!1}}class F extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,F.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,z.prototype.create)}}class z{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),i=this.errors[e],s=i?function(e,t){return e.replace(U,(e,n)=>{const i=t[n];return null!=i?String(i):"<".concat(n,"?>")})}(i,t):"Error",r="".concat(this.serviceName,": ").concat(s," (").concat(n,").");return new F(n,r,t)}}const U=/\{\$([^}]+)}/g;function V(e){return JSON.parse(e)}function B(e){return JSON.stringify(e)}const H=function(e){let t={},n={},i={},s="";try{const r=e.split(".");t=V(x(r[0])||""),n=V(x(r[1])||""),s=r[2],i=n.d||{},delete n.d}catch(r){}return{header:t,claims:n,data:i,signature:s}};function q(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function W(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function G(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function K(e,t,n){const i={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=t.call(n,e[s],s,e));return i}function Y(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const s of n){if(!i.includes(s))return!1;const n=e[s],r=t[s];if(Q(n)&&Q(r)){if(!Y(n,r))return!1}else if(n!==r)return!1}for(const s of i)if(!n.includes(s))return!1;return!0}function Q(e){return null!==e&&"object"===typeof e}function X(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function $(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function J(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class Z{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"===typeof e)for(let u=0;u<16;u++)n[u]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let u=0;u<16;u++)n[u]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let u=16;u<80;u++){const e=n[u-3]^n[u-8]^n[u-14]^n[u-16];n[u]=4294967295&(e<<1|e>>>31)}let i,s,r=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let u=0;u<80;u++){u<40?u<20?(i=l^o&(a^l),s=1518500249):(i=o^a^l,s=1859775393):u<60?(i=o&a|l&(o|a),s=2400959708):(i=o^a^l,s=3395469782);const e=(r<<5|r>>>27)+i+c+s+n[u]&4294967295;c=l,l=a,a=4294967295&(o<<30|o>>>2),o=r,r=e}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let i=0;const s=this.buf_;let r=this.inbuf_;for(;i<t;){if(0===r)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"===typeof e){for(;i<t;)if(s[r]=e.charCodeAt(i),++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}else for(;i<t;)if(s[r]=e[i],++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}this.inbuf_=r,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let t=24;t>=0;t-=8)e[n]=this.chain_[i]>>t&255,++n;return e}}class ee{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=te),void 0===i.error&&(i.error=te),void 0===i.complete&&(i.complete=te);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function te(){}function ne(e,t){return"".concat(e," failed: ").concat(t," argument ")}const ie=function(e){let t=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function se(e){return e&&e._delegate?e._delegate:e}class re{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const oe="[DEFAULT]";class ae{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new P;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),i=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(i)return null;throw s}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:oe})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:i});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[s,r]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(s)&&r.resolve(i)}return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&e(r,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch(i){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(s=t,s===oe?void 0:s),options:n}),this.instances.set(t,i),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch(r){}var s;return i||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe;return this.component?this.component.multipleInstances?e:oe:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class le{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new ae(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const ce=[];var ue;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(ue||(ue={}));const de={debug:ue.DEBUG,verbose:ue.VERBOSE,info:ue.INFO,warn:ue.WARN,error:ue.ERROR,silent:ue.SILENT},he=ue.INFO,fe={[ue.DEBUG]:"log",[ue.VERBOSE]:"log",[ue.INFO]:"info",[ue.WARN]:"warn",[ue.ERROR]:"error"},pe=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),i=fe[t];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var s=arguments.length,r=new Array(s>2?s-2:0),o=2;o<s;o++)r[o-2]=arguments[o];console[i]("[".concat(n,"]  ").concat(e.name,":"),...r)};class me{constructor(e){this.name=e,this._logLevel=he,this._logHandler=pe,this._userLogHandler=null,ce.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ue))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?de[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ue.DEBUG,...t),this._logHandler(this,ue.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ue.VERBOSE,...t),this._logHandler(this,ue.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ue.INFO,...t),this._logHandler(this,ue.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ue.WARN,...t),this._logHandler(this,ue.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,ue.ERROR,...t),this._logHandler(this,ue.ERROR,...t)}}let ge,ye;const ve=new WeakMap,be=new WeakMap,xe=new WeakMap,_e=new WeakMap,we=new WeakMap;let Ce={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return be.get(e);if("objectStoreNames"===t)return e.objectStoreNames||xe.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ee(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Ne(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ye||(ye=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e.apply(Te(this),n),Ee(ve.get(this))}:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Ee(e.apply(Te(this),n))}:function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];const r=e.call(Te(this),t,...i);return xe.set(r,t.sort?t.sort():[t]),Ee(r)}}function ke(e){return"function"===typeof e?Ne(e):(e instanceof IDBTransaction&&function(e){if(be.has(e))return;const t=new Promise((t,n)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",r),e.removeEventListener("abort",r)},s=()=>{t(),i()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",r),e.addEventListener("abort",r)});be.set(e,t)}(e),t=e,(ge||(ge=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,Ce):e);var t}function Ee(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",r)},s=()=>{t(Ee(e.result)),i()},r=()=>{n(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",r)});return t.then(t=>{t instanceof IDBCursor&&ve.set(t,e)}).catch(()=>{}),we.set(t,e),t}(e);if(_e.has(e))return _e.get(e);const t=ke(e);return t!==e&&(_e.set(e,t),we.set(t,e)),t}const Te=e=>we.get(e);const Se=["get","getKey","getAll","getAllKeys","count"],Ie=["put","add","delete","clear"],Pe=new Map;function je(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(Pe.get(t))return Pe.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=Ie.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!Se.includes(n))return;const r=async function(e){const t=this.transaction(e,s?"readwrite":"readonly");let r=t.store;for(var o=arguments.length,a=new Array(o>1?o-1:0),l=1;l<o;l++)a[l-1]=arguments[l];return i&&(r=r.index(a.shift())),(await Promise.all([r[n](...a),s&&t.done]))[0]};return Pe.set(t,r),r}!function(e){Ce=e(Ce)}(e=>c(c({},e),{},{get:(t,n,i)=>je(t,n)||e.get(t,n,i),has:(t,n)=>!!je(t,n)||e.has(t,n)}));class Ae{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const De="@firebase/app",Re="0.9.13",Me=new me("@firebase/app"),Oe="@firebase/app-compat",Le="@firebase/analytics-compat",Fe="@firebase/analytics",ze="@firebase/app-check-compat",Ue="@firebase/app-check",Ve="@firebase/auth",Be="@firebase/auth-compat",He="@firebase/database",qe="@firebase/database-compat",We="@firebase/functions",Ge="@firebase/functions-compat",Ke="@firebase/installations",Ye="@firebase/installations-compat",Qe="@firebase/messaging",Xe="@firebase/messaging-compat",$e="@firebase/performance",Je="@firebase/performance-compat",Ze="@firebase/remote-config",et="@firebase/remote-config-compat",tt="@firebase/storage",nt="@firebase/storage-compat",it="@firebase/firestore",st="@firebase/firestore-compat",rt="firebase",ot="[DEFAULT]",at={[De]:"fire-core",[Oe]:"fire-core-compat",[Fe]:"fire-analytics",[Le]:"fire-analytics-compat",[Ue]:"fire-app-check",[ze]:"fire-app-check-compat",[Ve]:"fire-auth",[Be]:"fire-auth-compat",[He]:"fire-rtdb",[qe]:"fire-rtdb-compat",[We]:"fire-fn",[Ge]:"fire-fn-compat",[Ke]:"fire-iid",[Ye]:"fire-iid-compat",[Qe]:"fire-fcm",[Xe]:"fire-fcm-compat",[$e]:"fire-perf",[Je]:"fire-perf-compat",[Ze]:"fire-rc",[et]:"fire-rc-compat",[tt]:"fire-gcs",[nt]:"fire-gcs-compat",[it]:"fire-fst",[st]:"fire-fst-compat","fire-js":"fire-js",[rt]:"fire-js-all"},lt=new Map,ct=new Map;function ut(e,t){try{e.container.addComponent(t)}catch(n){Me.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function dt(e){const t=e.name;if(ct.has(t))return Me.debug("There were multiple attempts to register component ".concat(t,".")),!1;ct.set(t,e);for(const n of lt.values())ut(n,e);return!0}function ht(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const ft=new z("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class pt{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new re("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ft.create("app-deleted",{appName:this._name})}}const mt="9.23.0";function gt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const i=Object.assign({name:ot,automaticDataCollectionEnabled:!1},t),s=i.name;if("string"!==typeof s||!s)throw ft.create("bad-app-name",{appName:String(s)});if(n||(n=S()),!n)throw ft.create("no-options");const r=lt.get(s);if(r){if(Y(n,r.options)&&Y(i,r.config))return r;throw ft.create("duplicate-app",{appName:s})}const o=new le(s);for(const l of ct.values())o.addComponent(l);const a=new pt(n,i,o);return lt.set(s,a),a}function yt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ot;const t=lt.get(e);if(!t&&e===ot&&S())return gt();if(!t)throw ft.create("no-app",{appName:e});return t}function vt(e,t,n){var i;let s=null!==(i=at[e])&&void 0!==i?i:e;n&&(s+="-".concat(n));const r=s.match(/\s|\//),o=t.match(/\s|\//);if(r||o){const e=['Unable to register library "'.concat(s,'" with version "').concat(t,'":')];return r&&e.push('library name "'.concat(s,'" contains illegal characters (whitespace or "/")')),r&&o&&e.push("and"),o&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void Me.warn(e.join(" "))}dt(new re("".concat(s,"-version"),()=>({library:s,version:t}),"VERSION"))}const bt="firebase-heartbeat-store";let xt=null;function _t(){return xt||(xt=function(e,t){let{blocked:n,upgrade:i,blocking:s,terminated:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=indexedDB.open(e,t),a=Ee(o);return i&&o.addEventListener("upgradeneeded",e=>{i(Ee(o.result),e.oldVersion,e.newVersion,Ee(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{r&&e.addEventListener("close",()=>r()),s&&e.addEventListener("versionchange",e=>s(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(bt)}}).catch(e=>{throw ft.create("idb-open",{originalErrorMessage:e.message})})),xt}async function wt(e,t){try{const n=(await _t()).transaction(bt,"readwrite"),i=n.objectStore(bt);await i.put(t,Ct(e)),await n.done}catch(n){if(n instanceof F)Me.warn(n.message);else{const e=ft.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});Me.warn(e.message)}}}function Ct(e){return"".concat(e.name,"!").concat(e.options.appId)}class Nt{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Et(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=kt();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some(e=>e.date===t))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=kt(),{heartbeatsToSend:t,unsentEntries:n}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let i=e.slice();for(const s of e){const e=n.find(e=>e.agent===s.agent);if(e){if(e.dates.push(s.date),Tt(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Tt(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=b(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function kt(){return(new Date).toISOString().substring(0,10)}class Et{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!L()&&new Promise((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(PS){t(PS)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=await _t();return await t.transaction(bt).objectStore(bt).get(Ct(e))}catch(t){if(t instanceof F)Me.warn(t.message);else{const e=ft.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});Me.warn(e.message)}}}(this.app);return e||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return wt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return wt(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Tt(e){return b(JSON.stringify({version:2,heartbeats:e})).length}var St;St="",dt(new re("platform-logger",e=>new Ae(e),"PRIVATE")),dt(new re("heartbeat",e=>new Nt(e),"PRIVATE")),vt(De,Re,St),vt(De,Re,"esm2017"),vt("fire-js","");vt("firebase","9.23.0","app");function It(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;function Pt(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const jt=Pt,At=new z("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Dt=new me("@firebase/auth");function Rt(e){if(Dt.logLevel<=ue.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Dt.error("Auth (".concat(mt,"): ").concat(e),...n)}}function Mt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];throw Ft(e,...n)}function Ot(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ft(e,...n)}function Lt(e,t,n){const i=Object.assign(Object.assign({},jt()),{[t]:n});return new z("auth","Firebase",i).create(t,{appName:e.name})}function Ft(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if("string"!==typeof e){const t=n[0],i=[...n.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(t,...i)}return At.create(e,...n)}function zt(e,t){if(!e){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];throw Ft(t,...i)}}function Ut(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Rt(t),new Error(t)}function Vt(e,t){e||Ut(t)}function Bt(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Ht(){return"http:"===qt()||"https:"===qt()}function qt(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function Wt(){return!("undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(Ht()||function(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class Gt{constructor(e,t){this.shortDelay=e,this.longDelay=t,Vt(t>e,"Short delay should be less than long delay!"),this.isMobile=D()||M()}get(){return Wt()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Kt(e,t){Vt(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class Yt{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:void Ut("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:void Ut("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:void Ut("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Qt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Xt=new Gt(3e4,6e4);function $t(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Jt(e,t,n,i){return Zt(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let s={},r={};i&&("GET"===t?r=i:s={body:JSON.stringify(i)});const o=X(Object.assign({key:e.config.apiKey},r)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),Yt.fetch()(tn(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},s))})}async function Zt(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},Qt),t);try{const t=new nn(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const r=await s.json();if("needConfirmation"in r)throw sn(e,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const t=s.ok?r.errorMessage:r.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw sn(e,"credential-already-in-use",r);if("EMAIL_EXISTS"===n)throw sn(e,"email-already-in-use",r);if("USER_DISABLED"===n)throw sn(e,"user-disabled",r);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw Lt(e,a,o);Mt(e,a)}}catch(s){if(s instanceof F)throw s;Mt(e,"network-request-failed",{message:String(s)})}}async function en(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const r=await Jt(e,t,n,i,s);return"mfaPendingCredential"in r&&Mt(e,"multi-factor-auth-required",{_serverResponse:r}),r}function tn(e,t,n,i){const s="".concat(t).concat(n,"?").concat(i);return e.config.emulator?Kt(e.config,s):"".concat(e.config.apiScheme,"://").concat(s)}class nn{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Ot(this.auth,"network-request-failed")),Xt.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function sn(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=Ot(e,t,i);return s.customData._tokenResponse=n,s}function rn(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function on(e){return 1e3*Number(e)}function an(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return Rt("JWT malformed, contained fewer than 3 sections"),null;try{const e=x(n);return e?JSON.parse(e):(Rt("Failed to decode base64 JWT payload"),null)}catch(s){return Rt("Caught error parsing JWT payload as JSON",null===s||void 0===s?void 0:s.toString()),null}}async function ln(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(n){throw n instanceof F&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class cn{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void((null===e||void 0===e?void 0:e.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class un{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=rn(this.lastLoginAt),this.creationTime=rn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function dn(e){var t;const n=e.auth,i=await e.getIdToken(),s=await ln(e,async function(e,t){return Jt(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:i}));zt(null===s||void 0===s?void 0:s.users.length,n,"internal-error");const r=s.users[0];e._notifyReloadListener(r);const o=(null===(t=r.providerUserInfo)||void 0===t?void 0:t.length)?r.providerUserInfo.map(e=>{var{providerId:t}=e,n=It(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}):[];const a=(l=e.providerData,c=o,[...l.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var l,c;const u=e.isAnonymous,d=!(e.email&&r.passwordHash)&&!(null===a||void 0===a?void 0:a.length),h=!!u&&d,f={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new un(r.createdAt,r.lastLoginAt),isAnonymous:h};Object.assign(e,f)}class hn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){zt(e.idToken,"internal-error"),zt("undefined"!==typeof e.idToken,"internal-error"),zt("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):function(e){const t=an(e);return zt(t,"internal-error"),zt("undefined"!==typeof t.exp,"internal-error"),zt("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return zt(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:s}=await async function(e,t){const n=await Zt(e,{},async()=>{const n=X({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:s}=e.config,r=tn(e,i,"/v1/token","key=".concat(s)),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Yt.fetch()(r,{method:"POST",headers:o,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:s}=t,r=new hn;return n&&(zt("string"===typeof n,"internal-error",{appName:e}),r.refreshToken=n),i&&(zt("string"===typeof i,"internal-error",{appName:e}),r.accessToken=i),s&&(zt("number"===typeof s,"internal-error",{appName:e}),r.expirationTime=s),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new hn,this.toJSON())}_performRefresh(){return Ut("not implemented")}}function fn(e,t){zt("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class pn{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,s=It(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new cn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new un(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await ln(this,this.stsTokenManager.getToken(this.auth,e));return zt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=se(e),i=await n.getIdToken(t),s=an(i);zt(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const r="object"===typeof s.firebase?s.firebase:void 0,o=null===r||void 0===r?void 0:r.sign_in_provider;return{claims:s,token:i,authTime:rn(on(s.auth_time)),issuedAtTime:rn(on(s.iat)),expirationTime:rn(on(s.exp)),signInProvider:o||null,signInSecondFactor:(null===r||void 0===r?void 0:r.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=se(e);await dn(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(zt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new pn(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){zt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await dn(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await ln(this,async function(e,t){return Jt(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,s,r,o,a,l,c;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,d=null!==(i=t.email)&&void 0!==i?i:void 0,h=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,f=null!==(r=t.photoURL)&&void 0!==r?r:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(l=t.createdAt)&&void 0!==l?l:void 0,y=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:v,emailVerified:b,isAnonymous:x,providerData:_,stsTokenManager:w}=t;zt(v&&w,e,"internal-error");const C=hn.fromJSON(this.name,w);zt("string"===typeof v,e,"internal-error"),fn(u,e.name),fn(d,e.name),zt("boolean"===typeof b,e,"internal-error"),zt("boolean"===typeof x,e,"internal-error"),fn(h,e.name),fn(f,e.name),fn(p,e.name),fn(m,e.name),fn(g,e.name),fn(y,e.name);const N=new pn({uid:v,auth:e,email:d,emailVerified:b,displayName:u,isAnonymous:x,photoURL:f,phoneNumber:h,tenantId:p,stsTokenManager:C,createdAt:g,lastLoginAt:y});return _&&Array.isArray(_)&&(N.providerData=_.map(e=>Object.assign({},e))),m&&(N._redirectEventId=m),N}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=new hn;i.updateFromServerResponse(t);const s=new pn({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await dn(s),s}}const mn=new Map;function gn(e){Vt(e instanceof Function,"Expected a class definition");let t=mn.get(e);return t?(Vt(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,mn.set(e,t),t)}class yn{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}yn.type="NONE";const vn=yn;function bn(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class xn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=bn(this.userKey,i.apiKey,s),this.fullPersistenceKey=bn("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?pn._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new xn(gn(vn),e,n);const i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let s=i[0]||gn(vn);const r=bn(n,e.config.apiKey,e.name);let o=null;for(const c of t)try{const t=await c._get(r);if(t){const n=pn._fromJSON(e,t);c!==s&&(o=n),s=c;break}}catch(l){}const a=i.filter(e=>e._shouldAllowMigration);return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(r,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==s)try{await e._remove(r)}catch(l){}})),new xn(s,e,n)):new xn(s,e,n)}}function _n(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(kn(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(wn(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Tn(t))return"Blackberry";if(Sn(t))return"Webos";if(Cn(t))return"Safari";if((t.includes("chrome/")||Nn(t))&&!t.includes("edge/"))return"Chrome";if(En(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function wn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/firefox\//i.test(e)}function Cn(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:A()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Nn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/crios\//i.test(e)}function kn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/iemobile/i.test(e)}function En(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/android/i.test(e)}function Tn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/blackberry/i.test(e)}function Sn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/webos/i.test(e)}function In(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Pn(){return function(){const e=A();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function jn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A();return In(e)||En(e)||Sn(e)||Tn(e)||/windows phone/i.test(e)||kn(e)}function An(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=_n(A());break;case"Worker":t="".concat(_n(A()),"-").concat(e);break;default:t=e}const i=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(mt,"/").concat(i)}async function Dn(e,t){return Jt(e,"GET","/v2/recaptchaConfig",$t(e,t))}function Rn(e){return void 0!==e&&void 0!==e.enterprise}class Mn{constructor(e){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.emailPasswordEnabled=e.recaptchaEnforcementState.some(e=>"EMAIL_PASSWORD_PROVIDER"===e.provider&&"OFF"!==e.enforcementState)}}function On(e){return new Promise((t,n)=>{const i=document.createElement("script");i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=Ot("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(i)})}function Ln(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}class Fn{constructor(e){this.type="recaptcha-enterprise",this.auth=Bn(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,i){const s=window.grecaptcha;Rn(s)?s.enterprise.ready(()=>{s.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n("NO_RECAPTCHA")})}):i(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,i)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{Dn(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0!==i.recaptchaKey){const n=new Mn(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(s=>{if(!t&&Rn(window.grecaptcha))n(s,e,i);else{if("undefined"===typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));On("https://www.google.com/recaptcha/enterprise.js?render="+s).then(()=>{n(s,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function zn(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=new Fn(e);let r;try{r=await s.verify(n)}catch(PS){r=await s.verify(n,!0)}const o=Object.assign({},t);return i?Object.assign(o,{captchaResp:r}):Object.assign(o,{captchaResponse:r}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class Un{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,i)=>{try{n(e(t))}catch(s){i(s)}});n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(i){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===n||void 0===n?void 0:n.message})}}}class Vn{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Hn(this),this.idTokenSubscription=new Hn(this),this.beforeStateQueue=new Un(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=At,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=gn(t)),this._initializationPromise=this.queue(async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await xn.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(s){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let i=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,r=null===i||void 0===i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==r||!(null===o||void 0===o?void 0:o.user)||(i=o.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(r){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(r))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return zt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await dn(e)}catch(t){if((null===t||void 0===t?void 0:t.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?se(e):null;return t&&zt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&zt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(gn(e))})}async initializeRecaptchaConfig(){const e=await Dn(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),t=new Mn(e);if(null==this.tenantId?this._agentRecaptchaConfig=t:this._tenantRecaptchaConfigs[this.tenantId]=t,t.emailPasswordEnabled){new Fn(this).verify()}}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new z("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&gn(e)||this._popupRedirectResolver;zt(t,this,"argument-error"),this.redirectPersistenceManager=await xn.create(this,[gn(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const s="function"===typeof t?t:t.next.bind(t),r=this._isInitialized?Promise.resolve():this._initializationPromise;return zt(r,this,"internal-error"),r.then(()=>s(this.currentUser)),"function"===typeof t?e.addObserver(t,n,i):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return zt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=An(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null===t||void 0===t?void 0:t.error)&&function(e){if(Dt.logLevel<=ue.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Dt.warn("Auth (".concat(mt,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function Bn(e){return se(e)}class Hn{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new ee(e,t);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return zt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function qn(e,t,n){const i=Bn(e);zt(i._canInitEmulator,i,"emulator-config-failed"),zt(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const s=!!(null===n||void 0===n?void 0:n.disableWarnings),r=Wn(t),{host:o,port:a}=function(e){const t=Wn(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const e=s[1];return{host:e,port:Gn(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:Gn(t)}}}(t),l=null===a?"":":".concat(a);i.config.emulator={url:"".concat(r,"//").concat(o).concat(l,"/")},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Wn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Gn(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Kn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ut("not implemented")}_getIdTokenResponse(e){return Ut("not implemented")}_linkToIdToken(e,t){return Ut("not implemented")}_getReauthenticationResolver(e){return Ut("not implemented")}}async function Yn(e,t){return Jt(e,"POST","/v1/accounts:update",t)}async function Qn(e,t){return en(e,"POST","/v1/accounts:signInWithPassword",$t(e,t))}class Xn extends Kn{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Xn(e,t,"password")}static _fromEmailAndCode(e,t){return new Xn(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){var t;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null===(t=e._getRecaptchaConfig())||void 0===t?void 0:t.emailPasswordEnabled){const t=await zn(e,n,"signInWithPassword");return Qn(e,t)}return Qn(e,n).catch(async t=>{if(t.code==="auth/".concat("missing-recaptcha-token")){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const t=await zn(e,n,"signInWithPassword");return Qn(e,t)}return Promise.reject(t)});case"emailLink":return async function(e,t){return en(e,"POST","/v1/accounts:signInWithEmailLink",$t(e,t))}(e,{email:this._email,oobCode:this._password});default:Mt(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Yn(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return en(e,"POST","/v1/accounts:signInWithEmailLink",$t(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Mt(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function $n(e,t){return en(e,"POST","/v1/accounts:signInWithIdp",$t(e,t))}class Jn extends Kn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Jn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Mt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,s=It(t,["providerId","signInMethod"]);if(!n||!i)return null;const r=new Jn(n,i);return r.idToken=s.idToken||void 0,r.accessToken=s.accessToken||void 0,r.secret=s.secret,r.nonce=s.nonce,r.pendingToken=s.pendingToken||null,r}_getIdTokenResponse(e){return $n(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,$n(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,$n(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=X(t)}return e}}const Zn={USER_NOT_FOUND:"user-not-found"};class ei extends Kn{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ei({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ei({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return en(e,"POST","/v1/accounts:signInWithPhoneNumber",$t(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await en(e,"POST","/v1/accounts:signInWithPhoneNumber",$t(e,t));if(n.temporaryProof)throw sn(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return en(e,"POST","/v1/accounts:signInWithPhoneNumber",$t(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Zn)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}=e;return n||t||i||s?new ei({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}):null}}class ti{constructor(e){var t,n,i,s,r,o;const a=$(J(e)),l=null!==(t=a.apiKey)&&void 0!==t?t:null,c=null!==(n=a.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=a.mode)&&void 0!==i?i:null);zt(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!==(s=a.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(r=a.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=$(J(e)).link,n=t?$(J(t)).deep_link_id:null,i=$(J(e)).deep_link_id;return(i?$(J(i)).link:null)||i||n||t||e}(e);try{return new ti(t)}catch(n){return null}}}class ni{constructor(){this.providerId=ni.PROVIDER_ID}static credential(e,t){return Xn._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=ti.parseLink(t);return zt(n,"argument-error"),Xn._fromEmailAndCode(e,n.code,n.tenantId)}}ni.PROVIDER_ID="password",ni.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ni.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ii{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class si extends ii{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ri extends si{constructor(){super("facebook.com")}static credential(e){return Jn._fromParams({providerId:ri.PROVIDER_ID,signInMethod:ri.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ri.credentialFromTaggedObject(e)}static credentialFromError(e){return ri.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return ri.credential(t.oauthAccessToken)}catch(n){return null}}}ri.FACEBOOK_SIGN_IN_METHOD="facebook.com",ri.PROVIDER_ID="facebook.com";class oi extends si{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Jn._fromParams({providerId:oi.PROVIDER_ID,signInMethod:oi.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return oi.credentialFromTaggedObject(e)}static credentialFromError(e){return oi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:i}=t;if(!n&&!i)return null;try{return oi.credential(n,i)}catch(s){return null}}}oi.GOOGLE_SIGN_IN_METHOD="google.com",oi.PROVIDER_ID="google.com";class ai extends si{constructor(){super("github.com")}static credential(e){return Jn._fromParams({providerId:ai.PROVIDER_ID,signInMethod:ai.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ai.credentialFromTaggedObject(e)}static credentialFromError(e){return ai.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return ai.credential(t.oauthAccessToken)}catch(n){return null}}}ai.GITHUB_SIGN_IN_METHOD="github.com",ai.PROVIDER_ID="github.com";class li extends si{constructor(){super("twitter.com")}static credential(e,t){return Jn._fromParams({providerId:li.PROVIDER_ID,signInMethod:li.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return li.credentialFromTaggedObject(e)}static credentialFromError(e){return li.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:i}=t;if(!n||!i)return null;try{return li.credential(n,i)}catch(s){return null}}}async function ci(e,t){return en(e,"POST","/v1/accounts:signUp",$t(e,t))}li.TWITTER_SIGN_IN_METHOD="twitter.com",li.PROVIDER_ID="twitter.com";class ui{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=await pn._fromIdTokenResponse(e,n,i),r=di(n);return new ui({user:s,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=di(n);return new ui({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function di(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class hi extends F{constructor(e,t,n,i){var s;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,hi.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new hi(e,t,n,i)}}function fi(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw hi._fromErrorAndOperation(e,n,t,i);throw n})}async function pi(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=await ln(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ui._forOperation(e,"link",i)}async function mi(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:i}=e,s="reauthenticate";try{const r=await ln(e,fi(i,s,t,e),n);zt(r.idToken,i,"internal-error");const o=an(r.idToken);zt(o,i,"internal-error");const{sub:a}=o;return zt(e.uid===a,i,"user-mismatch"),ui._forOperation(e,s,r)}catch(r){throw(null===r||void 0===r?void 0:r.code)==="auth/".concat("user-not-found")&&Mt(i,"user-mismatch"),r}}async function gi(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i="signIn",s=await fi(e,i,t),r=await ui._fromIdTokenResponse(e,i,s);return n||await e._updateCurrentUser(r.user),r}async function yi(e,t){return gi(Bn(e),t)}function vi(e){return se(e).signOut()}new WeakMap;const bi="__sak";class xi{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(bi,"1"),this.storage.removeItem(bi),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class _i extends xi{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=A();return Cn(e)||In(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=jn(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);Pn()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}_i.type="LOCAL";const wi=_i;class Ci extends xi{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Ci.type="SESSION";const Ni=Ci;class ki{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new ki(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:s}=t.data,r=this.handlersMap[i];if(!(null===r||void 0===r?void 0:r.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(r).map(async e=>e(t.origin,s)),a=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Ei(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let i=0;i<t;i++)n+=Math.floor(10*Math.random());return e+n}ki.receivers=[];class Ti{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const i="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,r;return new Promise((o,a)=>{const l=Ei("",20);i.port1.start();const c=setTimeout(()=>{a(new Error("unsupported_event"))},n);r={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),s=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(c),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(r),i.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])}).finally(()=>{r&&this.removeMessageHandler(r)})}}function Si(){return window}function Ii(){return"undefined"!==typeof Si().WorkerGlobalScope&&"function"===typeof Si().importScripts}const Pi="firebaseLocalStorageDb",ji="firebaseLocalStorage",Ai="fbase_key";class Di{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Ri(e,t){return e.transaction([ji],t?"readwrite":"readonly").objectStore(ji)}function Mi(){const e=indexedDB.open(Pi,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(ji,{keyPath:Ai})}catch(i){n(i)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(ji)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Pi);return new Di(e).toPromise()}(),t(await Mi()))})})}async function Oi(e,t,n){const i=Ri(e,!0).put({[Ai]:t,value:n});return new Di(i).toPromise()}function Li(e,t){const n=Ri(e,!0).delete(t);return new Di(n).toPromise()}class Fi{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Mi()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Ii()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ki._getInstance(Ii()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Ti(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Mi();return await Oi(e,bi,"1"),await Li(e,bi),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>Oi(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=Ri(e,!1).get(t),i=await new Di(n).toPromise();return void 0===i?null:i.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Li(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=Ri(e,!1).getAll();return new Di(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:i,value:s}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Fi.type="LOCAL";const zi=Fi;Ln("rcb"),new Gt(3e4,6e4);const Ui="recaptcha";async function Vi(e,t,n){var i;const s=await n.verify();try{let r;if(zt("string"===typeof s,e,"argument-error"),zt(n.type===Ui,e,"argument-error"),r="string"===typeof t?{phoneNumber:t}:t,"session"in r){const t=r.session;if("phoneNumber"in r){zt("enroll"===t.type,e,"internal-error");const n=await function(e,t){return Jt(e,"POST","/v2/accounts/mfaEnrollment:start",$t(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,recaptchaToken:s}});return n.phoneSessionInfo.sessionInfo}{zt("signin"===t.type,e,"internal-error");const n=(null===(i=r.multiFactorHint)||void 0===i?void 0:i.uid)||r.multiFactorUid;zt(n,e,"missing-multi-factor-info");const o=await function(e,t){return Jt(e,"POST","/v2/accounts/mfaSignIn:start",$t(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:s}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Jt(e,"POST","/v1/accounts:sendVerificationCode",$t(e,t))}(e,{phoneNumber:r.phoneNumber,recaptchaToken:s});return t}}finally{n._reset()}}class Bi{constructor(e){this.providerId=Bi.PROVIDER_ID,this.auth=Bn(e)}verifyPhoneNumber(e,t){return Vi(this.auth,e,se(t))}static credential(e,t){return ei._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Bi.credentialFromTaggedObject(t)}static credentialFromError(e){return Bi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:i}=t;return n&&i?ei._fromTokenResponse(n,i):null}}function Hi(e,t){return t?gn(t):(zt(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Bi.PROVIDER_ID="phone",Bi.PHONE_SIGN_IN_METHOD="phone";class qi extends Kn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return $n(e,this._buildIdpRequest())}_linkToIdToken(e,t){return $n(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return $n(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Wi(e){return gi(e.auth,new qi(e),e.bypassAuthState)}function Gi(e){const{auth:t,user:n}=e;return zt(n,t,"internal-error"),mi(n,new qi(e),e.bypassAuthState)}async function Ki(e){const{auth:t,user:n}=e;return zt(n,t,"internal-error"),pi(n,new qi(e),e.bypassAuthState)}class Yi{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:r,type:o}=e;if(r)return void this.reject(r);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Wi;case"linkViaPopup":case"linkViaRedirect":return Ki;case"reauthViaPopup":case"reauthViaRedirect":return Gi;default:Mt(this.auth,"internal-error")}}resolve(e){Vt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Vt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Qi=new Gt(2e3,1e4);class Xi extends Yi{constructor(e,t,n,i,s){super(e,t,i,s),this.provider=n,this.authWindow=null,this.pollId=null,Xi.currentPopupAction&&Xi.currentPopupAction.cancel(),Xi.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return zt(e,this.auth,"internal-error"),e}async onExecution(){Vt(1===this.filter.length,"Popup operations only handle one event");const e=Ei();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Ot(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Ot(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Xi.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ot(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Qi.get())};e()}}Xi.currentPopupAction=null;const $i=new Map;class Ji extends Yi{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=$i.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=ts(t),i=es(e);if(!await i._isAvailable())return!1;const s="true"===await i._get(n);return await i._remove(n),s}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}$i.set(this.auth._key(),e)}return this.bypassAuthState||$i.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Zi(e,t){$i.set(e._key(),t)}function es(e){return gn(e._redirectPersistence)}function ts(e){return bn("pendingRedirect",e.config.apiKey,e.name)}async function ns(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=Bn(e),s=Hi(i,t),r=new Ji(i,s,n),o=await r.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class is{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return rs(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!rs(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Ot(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(ss(e))}saveEventToCache(e){this.cachedEventUids.add(ss(e)),this.lastProcessedEventTime=Date.now()}}function ss(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function rs(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}const os=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,as=/^https?/;async function ls(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return Jt(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const i of t)try{if(cs(i))return}catch(n){}Mt(e,"unauthorized-domain")}function cs(e){const t=Bt(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===i}if(!as.test(n))return!1;if(os.test(e))return i===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const us=new Gt(3e4,6e4);function ds(){const e=Si().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let hs=null;function fs(e){return hs=hs||function(e){return new Promise((t,n)=>{var i,s,r;function o(){ds(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{ds(),n(Ot(e,"network-request-failed"))},timeout:us.get()})}if(null===(s=null===(i=Si().gapi)||void 0===i?void 0:i.iframes)||void 0===s?void 0:s.Iframe)t(gapi.iframes.getContext());else{if(!(null===(r=Si().gapi)||void 0===r?void 0:r.load)){const t=Ln("iframefcb");return Si()[t]=()=>{gapi.load?o():n(Ot(e,"network-request-failed"))},On("https://apis.google.com/js/api.js?onload=".concat(t)).catch(e=>n(e))}o()}}).catch(e=>{throw hs=null,e})}(e),hs}const ps=new Gt(5e3,15e3),ms={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},gs=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function ys(e){const t=e.config;zt(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Kt(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),i={apiKey:t.apiKey,appName:e.name,v:mt},s=gs.get(e.config.apiHost);s&&(i.eid=s);const r=e._getFrameworks();return r.length&&(i.fw=r.join(",")),"".concat(n,"?").concat(X(i).slice(1))}const vs={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class bs{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function xs(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const r=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const l=Object.assign(Object.assign({},vs),{width:i.toString(),height:s.toString(),top:r,left:o}),c=A().toLowerCase();n&&(a=Nn(c)?"_blank":n),wn(c)&&(t=t||"http://localhost",l.scrollbars="yes");const u=Object.entries(l).reduce((e,t)=>{let[n,i]=t;return"".concat(e).concat(n,"=").concat(i,",")},"");if(function(){var e;return In(arguments.length>0&&void 0!==arguments[0]?arguments[0]:A())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(c)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",a),new bs(null);const d=window.open(t||"",a,u);zt(d,e,"popup-blocked");try{d.focus()}catch(h){}return new bs(d)}const _s="__/auth/handler",ws="emulator/auth/handler",Cs=encodeURIComponent("fac");async function Ns(e,t,n,i,s,r){zt(e.config.authDomain,e,"auth-domain-config-required"),zt(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:mt,eventId:s};if(t instanceof ii){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",G(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(r||{}))o[e]=t}if(t instanceof si){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const u of Object.keys(a))void 0===a[u]&&delete a[u];const l=await e._getAppCheckToken(),c=l?"#".concat(Cs,"=").concat(encodeURIComponent(l)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(_s);return Kt(t,ws)}(e),"?").concat(X(a).slice(1)).concat(c)}const ks="webStorageSupport";const Es=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ni,this._completeRedirectFn=ns,this._overrideRedirectResult=Zi}async _openPopup(e,t,n,i){var s;Vt(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()");return xs(e,await Ns(e,t,n,Bt(),i),Ei())}async _openRedirect(e,t,n,i){await this._originValidation(e);return function(e){Si().location.href=e}(await Ns(e,t,n,Bt(),i)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Vt(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await async function(e){const t=await fs(e),n=Si().gapi;return zt(n,e,"internal-error"),t.open({where:document.body,url:ys(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ms,dontclear:!0},t=>new Promise(async(n,i)=>{await t.restyle({setHideOnLeave:!1});const s=Ot(e,"network-request-failed"),r=Si().setTimeout(()=>{i(s)},ps.get());function o(){Si().clearTimeout(r),n(t)}t.ping(o).then(o,()=>{i(s)})}))}(e),n=new is(e);return t.register("authEvent",t=>{zt(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(ks,{type:ks},n=>{var i;const s=null===(i=null===n||void 0===n?void 0:n[0])||void 0===i?void 0:i[ks];void 0!==s&&t(!!s),Mt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=ls(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return jn()||Cn()||In()}};var Ts="@firebase/auth",Ss="0.23.2";class Is{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){zt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Ps=I("authIdTokenMaxAge")||300;let js=null;function As(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yt();const t=ht(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=ht(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(Y(n.getOptions(),null!==t&&void 0!==t?t:{}))return e;Mt(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Es,persistence:[zi,wi,Ni]}),i=I("authTokenSyncURL");if(i){const e=(s=i,async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Ps)return;const i=null===t||void 0===t?void 0:t.token;js!==i&&(js=i,await fetch(s,{method:i?"POST":"DELETE",headers:i?{Authorization:"Bearer ".concat(i)}:{}}))});!function(e,t,n){se(e).beforeAuthStateChanged(t,n)}(n,e,()=>e(n.currentUser)),function(e,t,n,i){se(e).onIdTokenChanged(t,n,i)}(n,t=>e(t))}var s;const r=E("auth");return r&&qn(n,"http://".concat(r)),n}var Ds;Ds="Browser",dt(new re("auth",(e,t)=>{let{options:n}=t;const i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;zt(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});const l={apiKey:o,authDomain:a,clientPlatform:Ds,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:An(Ds)},c=new Vn(i,s,r,l);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(gn);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null===t||void 0===t?void 0:t.popupRedirectResolver)}(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),dt(new re("auth-internal",e=>(e=>new Is(e))(Bn(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),vt(Ts,Ss,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(Ds)),vt(Ts,Ss,"esm2017");var Rs,Ms="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},Os={},Ls=Ls||{},Fs=Ms||self;function zs(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Us(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Vs="closure_uid_"+(1e9*Math.random()>>>0),Bs=0;function Hs(e,t,n){return e.call.apply(e.bind,arguments)}function qs(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function Ws(e,t,n){return(Ws=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Hs:qs).apply(null,arguments)}function Gs(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function Ks(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return t.prototype[n].apply(e,s)}}function Ys(){this.s=this.s,this.o=this.o}Ys.prototype.s=!1,Ys.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,Vs)&&e[Vs]||(e[Vs]=++Bs))},Ys.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Qs=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"===typeof e)return"string"!==typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Xs(e){const t=e.length;if(0<t){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function $s(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(zs(t)){const n=e.length||0,i=t.length||0;e.length=n+i;for(let s=0;s<i;s++)e[n+s]=t[s]}else e.push(t)}}function Js(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}Js.prototype.h=function(){this.defaultPrevented=!0};var Zs=function(){if(!Fs.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{Fs.addEventListener("test",()=>{},t),Fs.removeEventListener("test",()=>{},t)}catch(n){}return e}();function er(e){return/^[\s\xa0]*$/.test(e)}function tr(){var e=Fs.navigator;return e&&(e=e.userAgent)?e:""}function nr(e){return-1!=tr().indexOf(e)}function ir(e){return ir[" "](e),e}ir[" "]=function(){};var sr,rr,or=nr("Opera"),ar=nr("Trident")||nr("MSIE"),lr=nr("Edge"),cr=lr||ar,ur=nr("Gecko")&&!(-1!=tr().toLowerCase().indexOf("webkit")&&!nr("Edge"))&&!(nr("Trident")||nr("MSIE"))&&!nr("Edge"),dr=-1!=tr().toLowerCase().indexOf("webkit")&&!nr("Edge");function hr(){var e=Fs.document;return e?e.documentMode:void 0}e:{var fr="",pr=function(){var e=tr();return ur?/rv:([^\);]+)(\)|;)/.exec(e):lr?/Edge\/([\d\.]+)/.exec(e):ar?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):dr?/WebKit\/(\S+)/.exec(e):or?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(pr&&(fr=pr?pr[1]:""),ar){var mr=hr();if(null!=mr&&mr>parseFloat(fr)){sr=String(mr);break e}}sr=fr}if(Fs.document&&ar){var gr=hr();rr=gr||(parseInt(sr,10)||void 0)}else rr=void 0;var yr=rr;function vr(e,t){if(Js.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(ur){e:{try{ir(t.nodeName);var s=!0;break e}catch(r){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:br[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&vr.$.h.call(this)}}Ks(vr,Js);var br={2:"touch",3:"pen",4:"mouse"};vr.prototype.h=function(){vr.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var xr="closure_listenable_"+(1e6*Math.random()|0),_r=0;function wr(e,t,n,i,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.la=s,this.key=++_r,this.fa=this.ia=!1}function Cr(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function Nr(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function kr(e){const t={};for(const n in e)t[n]=e[n];return t}const Er="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Tr(e,t){let n,i;for(let s=1;s<arguments.length;s++){for(n in i=arguments[s],i)e[n]=i[n];for(let t=0;t<Er.length;t++)n=Er[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function Sr(e){this.src=e,this.g={},this.h=0}function Ir(e,t){var n=t.type;if(n in e.g){var i,s=e.g[n],r=Qs(s,t);(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(Cr(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Pr(e,t,n,i){for(var s=0;s<e.length;++s){var r=e[s];if(!r.fa&&r.listener==t&&r.capture==!!n&&r.la==i)return s}return-1}Sr.prototype.add=function(e,t,n,i,s){var r=e.toString();(e=this.g[r])||(e=this.g[r]=[],this.h++);var o=Pr(e,t,i,s);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new wr(t,this.src,r,!!i,s)).ia=n,e.push(t)),t};var jr="closure_lm_"+(1e6*Math.random()|0),Ar={};function Dr(e,t,n,i,s){if(i&&i.once)return Mr(e,t,n,i,s);if(Array.isArray(t)){for(var r=0;r<t.length;r++)Dr(e,t[r],n,i,s);return null}return n=Br(n),e&&e[xr]?e.O(t,n,Us(i)?!!i.capture:!!i,s):Rr(e,t,n,!1,i,s)}function Rr(e,t,n,i,s,r){if(!t)throw Error("Invalid event type");var o=Us(s)?!!s.capture:!!s,a=Ur(e);if(a||(e[jr]=a=new Sr(e)),(n=a.add(t,n,i,o,r)).proxy)return n;if(i=function(){function e(n){return t.call(e.src,e.listener,n)}const t=zr;return e}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)Zs||(s=o),void 0===s&&(s=!1),e.addEventListener(t.toString(),i,s);else if(e.attachEvent)e.attachEvent(Fr(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}function Mr(e,t,n,i,s){if(Array.isArray(t)){for(var r=0;r<t.length;r++)Mr(e,t[r],n,i,s);return null}return n=Br(n),e&&e[xr]?e.P(t,n,Us(i)?!!i.capture:!!i,s):Rr(e,t,n,!0,i,s)}function Or(e,t,n,i,s){if(Array.isArray(t))for(var r=0;r<t.length;r++)Or(e,t[r],n,i,s);else i=Us(i)?!!i.capture:!!i,n=Br(n),e&&e[xr]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=Pr(r=e.g[t],n,i,s))&&(Cr(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete e.g[t],e.h--)))):e&&(e=Ur(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Pr(t,n,i,s)),(n=-1<e?t[e]:null)&&Lr(n))}function Lr(e){if("number"!==typeof e&&e&&!e.fa){var t=e.src;if(t&&t[xr])Ir(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(Fr(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=Ur(t))?(Ir(n,e),0==n.h&&(n.src=null,t[jr]=null)):Cr(e)}}}function Fr(e){return e in Ar?Ar[e]:Ar[e]="on"+e}function zr(e,t){if(e.fa)e=!0;else{t=new vr(t,this);var n=e.listener,i=e.la||e.src;e.ia&&Lr(e),e=n.call(i,t)}return e}function Ur(e){return(e=e[jr])instanceof Sr?e:null}var Vr="__closure_events_fn_"+(1e9*Math.random()>>>0);function Br(e){return"function"===typeof e?e:(e[Vr]||(e[Vr]=function(t){return e.handleEvent(t)}),e[Vr])}function Hr(){Ys.call(this),this.i=new Sr(this),this.S=this,this.J=null}function qr(e,t){var n,i=e.J;if(i)for(n=[];i;i=i.J)n.push(i);if(e=e.S,i=t.type||t,"string"===typeof t)t=new Js(t,e);else if(t instanceof Js)t.target=t.target||e;else{var s=t;Tr(t=new Js(i,e),s)}if(s=!0,n)for(var r=n.length-1;0<=r;r--){var o=t.g=n[r];s=Wr(o,i,!0,t)&&s}if(s=Wr(o=t.g=e,i,!0,t)&&s,s=Wr(o,i,!1,t)&&s,n)for(r=0;r<n.length;r++)s=Wr(o=t.g=n[r],i,!1,t)&&s}function Wr(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,r=0;r<t.length;++r){var o=t[r];if(o&&!o.fa&&o.capture==n){var a=o.listener,l=o.la||o.src;o.ia&&Ir(e.i,o),s=!1!==a.call(l,i)&&s}}return s&&!i.defaultPrevented}Ks(Hr,Ys),Hr.prototype[xr]=!0,Hr.prototype.removeEventListener=function(e,t,n,i){Or(this,e,t,n,i)},Hr.prototype.N=function(){if(Hr.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)Cr(n[i]);delete t.g[e],t.h--}}this.J=null},Hr.prototype.O=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},Hr.prototype.P=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};var Gr=Fs.JSON.stringify;function Kr(){var e=eo;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Yr=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new Qr,e=>e.reset());class Qr{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Xr(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function $r(e){Fs.setTimeout(()=>{throw e},0)}let Jr,Zr=!1,eo=new class{constructor(){this.h=this.g=null}add(e,t){const n=Yr.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},to=()=>{const e=Fs.Promise.resolve(void 0);Jr=()=>{e.then(no)}};var no=()=>{for(var e;e=Kr();){try{e.h.call(e.g)}catch(n){$r(n)}var t=Yr;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Zr=!1};function io(e,t){Hr.call(this),this.h=e||1,this.g=t||Fs,this.j=Ws(this.qb,this),this.l=Date.now()}function so(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function ro(e,t,n){if("function"===typeof e)n&&(e=Ws(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Ws(e.handleEvent,e)}return 2147483647<Number(t)?-1:Fs.setTimeout(e,t||0)}function oo(e){e.g=ro(()=>{e.g=null,e.i&&(e.i=!1,oo(e))},e.j);const t=e.h;e.h=null,e.m.apply(null,t)}Ks(io,Hr),(Rs=io.prototype).ga=!1,Rs.T=null,Rs.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),qr(this,"tick"),this.ga&&(so(this),this.start()))}},Rs.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Rs.N=function(){io.$.N.call(this),so(this),delete this.g};class ao extends Ys{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:oo(this)}N(){super.N(),this.g&&(Fs.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function lo(e){Ys.call(this),this.h=e,this.g={}}Ks(lo,Ys);var co=[];function uo(e,t,n,i){Array.isArray(n)||(n&&(co[0]=n.toString()),n=co);for(var s=0;s<n.length;s++){var r=Dr(t,n[s],i||e.handleEvent,!1,e.h||e);if(!r)break;e.g[r.key]=r}}function ho(e){Nr(e.g,function(e,t){this.g.hasOwnProperty(t)&&Lr(e)},e),e.g={}}function fo(){this.g=!0}function po(e,t,n,i){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<s.length;o++)s[o]=""}}}return Gr(n)}catch(a){return t}}(e,n)+(i?" "+i:"")})}lo.prototype.N=function(){lo.$.N.call(this),ho(this)},lo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},fo.prototype.Ea=function(){this.g=!1},fo.prototype.info=function(){};var mo={},go=null;function yo(){return go=go||new Hr}function vo(e){Js.call(this,mo.Ta,e)}function bo(e){const t=yo();qr(t,new vo(t))}function xo(e,t){Js.call(this,mo.STAT_EVENT,e),this.stat=t}function _o(e){const t=yo();qr(t,new xo(t,e))}function wo(e,t){Js.call(this,mo.Ua,e),this.size=t}function Co(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return Fs.setTimeout(function(){e()},t)}mo.Ta="serverreachability",Ks(vo,Js),mo.STAT_EVENT="statevent",Ks(xo,Js),mo.Ua="timingevent",Ks(wo,Js);var No={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ko={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Eo(){}function To(e){return e.h||(e.h=e.i())}function So(){}Eo.prototype.h=null;var Io,Po={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function jo(){Js.call(this,"d")}function Ao(){Js.call(this,"c")}function Do(){}function Ro(e,t,n,i){this.l=e,this.j=t,this.m=n,this.W=i||1,this.U=new lo(this),this.P=Oo,e=cr?125:void 0,this.V=new io(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Mo}function Mo(){this.i=null,this.g="",this.h=!1}Ks(jo,Js),Ks(Ao,Js),Ks(Do,Eo),Do.prototype.g=function(){return new XMLHttpRequest},Do.prototype.i=function(){return{}},Io=new Do;var Oo=45e3,Lo={},Fo={};function zo(e,t,n){e.L=1,e.v=sa(Zo(t)),e.s=n,e.S=!0,Uo(e,null)}function Uo(e,t){e.G=Date.now(),qo(e),e.A=Zo(e.v);var n=e.A,i=e.W;Array.isArray(i)||(i=[String(i)]),ya(n.i,"t",i),e.C=0,n=e.l.J,e.h=new Mo,e.g=vl(e.l,n?t:null,!e.s),0<e.O&&(e.M=new ao(Ws(e.Pa,e,e.g),e.O)),uo(e.U,e.g,"readystatechange",e.nb),t=e.I?kr(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),bo(),function(e,t,n,i,s,r){e.info(function(){if(e.g)if(r)for(var o="",a=r.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var d=u.split("_");o=2<=d.length&&"type"==d[1]?o+(u+"=")+c+"&":o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+t+"\n"+n+"\n"+o})}(e.j,e.u,e.A,e.m,e.W,e.s)}function Vo(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.l.Ha)}function Bo(e,t,n){let i,s=!0;for(;!e.J&&e.C<n.length;){if(i=Ho(e,n),i==Fo){4==t&&(e.o=4,_o(14),s=!1),po(e.j,e.m,null,"[Incomplete Response]");break}if(i==Lo){e.o=4,_o(15),po(e.j,e.m,n,"[Invalid Chunk]"),s=!1;break}po(e.j,e.m,i,null),Qo(e,i)}Vo(e)&&i!=Fo&&i!=Lo&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,_o(16),s=!1),e.i=e.i&&s,s?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),ul(t),t.M=!0,_o(11))):(po(e.j,e.m,n,"[Invalid Chunked Response]"),Yo(e),Ko(e))}function Ho(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?Fo:(n=Number(t.substring(n,i)),isNaN(n)?Lo:(i+=1)+n>t.length?Fo:(t=t.slice(i,i+n),e.C=i+n,t))}function qo(e){e.Y=Date.now()+e.P,Wo(e,e.P)}function Wo(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Co(Ws(e.lb,e),t)}function Go(e){e.B&&(Fs.clearTimeout(e.B),e.B=null)}function Ko(e){0==e.l.H||e.J||fl(e.l,e)}function Yo(e){Go(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,so(e.V),ho(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function Qo(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||Na(n.i,e)))if(!e.K&&Na(n.i,e)&&3==n.H){try{var i=n.Ja.g.parse(t)}catch(c){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;hl(n),nl(n)}cl(n),_o(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.G&&0==n.A&&!n.v&&(n.v=Co(Ws(n.ib,n),6e3));if(1>=Ca(n.i)&&n.oa){try{n.oa()}catch(c){}n.oa=void 0}}else ml(n,11)}else if((e.K||n.g==e)&&hl(n),!er(t))for(s=n.Ja.g.parse(t),t=0;t<s.length;t++){let c=s[t];if(n.V=c[0],c=c[1],2==n.H)if("c"==c[0]){n.K=c[1],n.pa=c[2];const t=c[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const s=c[4];null!=s&&(n.Ga=s,n.l.info("SVER="+n.Ga));const u=c[5];null!=u&&"number"===typeof u&&0<u&&(i=1.5*u,n.L=i,n.l.info("backChannelRequestTimeoutMs_="+i)),i=n;const d=e.g;if(d){const e=d.g?d.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=i.i;r.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(ka(r,r.h),r.h=null))}if(i.F){const e=d.g?d.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.Da=e,ia(i.I,i.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((i=n).wa=yl(i,i.J?i.pa:null,i.Y),o.K){Ea(i.i,o);var a=o,l=i.L;l&&a.setTimeout(l),a.B&&(Go(a),qo(a)),i.g=o}else ll(i);0<n.j.length&&sl(n)}else"stop"!=c[0]&&"close"!=c[0]||ml(n,7);else 3==n.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?ml(n,7):tl(n):"noop"!=c[0]&&n.h&&n.h.Aa(c),n.A=0)}bo()}catch(c){}}function Xo(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(zs(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(zs(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const i in e)t[n++]=i;return t}}}(e),i=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(zs(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),s=i.length,r=0;r<s;r++)t.call(void 0,i[r],n&&n[r],e)}(Rs=Ro.prototype).setTimeout=function(e){this.P=e},Rs.nb=function(e){e=e.target;const t=this.M;t&&3==Qa(e)?t.l():this.Pa(e)},Rs.Pa=function(e){try{if(e==this.g)e:{const u=Qa(this.g);var t=this.g.Ia();this.g.da();if(!(3>u)&&(3!=u||cr||this.g&&(this.h.h||this.g.ja()||Xa(this.g)))){this.J||4!=u||7==t||bo(),Go(this);var n=this.g.da();this.ca=n;t:if(Vo(this)){var i=Xa(this.g);e="";var s=i.length,r=4==Qa(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Yo(this),Ko(this);var o="";break t}this.h.i=new Fs.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:r&&t==s-1});i.splice(0,s),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,i,s,r,o){e.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+r+" "+o})}(this.j,this.u,this.A,this.m,this.W,u,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!er(a)){var c=a;break t}}c=null}if(!(n=c)){this.i=!1,this.o=3,_o(12),Yo(this),Ko(this);break e}po(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Qo(this,n)}this.S?(Bo(this,u,o),cr&&this.i&&3==u&&(uo(this.U,this.V,"tick",this.mb),this.V.start())):(po(this.j,this.m,o,null),Qo(this,o)),4==u&&Yo(this),this.i&&!this.J&&(4==u?fl(this.l,this):(this.i=!1,qo(this)))}else(function(e){const t={};e=(e.g&&2<=Qa(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(er(e[i]))continue;var n=Xr(e[i]);const s=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const r=t[s]||[];t[s]=r,r.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,_o(12)):(this.o=0,_o(13)),Yo(this),Ko(this)}}}catch(u){}},Rs.mb=function(){if(this.g){var e=Qa(this.g),t=this.g.ja();this.C<t.length&&(Go(this),Bo(this,e,t),this.i&&4!=e&&qo(this))}},Rs.cancel=function(){this.J=!0,Yo(this)},Rs.lb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.L&&(bo(),_o(17)),Yo(this),this.o=2,Ko(this)):Wo(this,this.Y-e)};var $o=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Jo(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Jo){this.h=e.h,ea(this,e.j),this.s=e.s,this.g=e.g,ta(this,e.m),this.l=e.l;var t=e.i,n=new fa;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),na(this,n),this.o=e.o}else e&&(t=String(e).match($o))?(this.h=!1,ea(this,t[1]||"",!0),this.s=ra(t[2]||""),this.g=ra(t[3]||"",!0),ta(this,t[4]),this.l=ra(t[5]||"",!0),na(this,t[6]||"",!0),this.o=ra(t[7]||"")):(this.h=!1,this.i=new fa(null,this.h))}function Zo(e){return new Jo(e)}function ea(e,t,n){e.j=n?ra(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ta(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function na(e,t,n){t instanceof fa?(e.i=t,function(e,t){t&&!e.j&&(pa(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(ma(this,t),ya(this,n,e))},e)),e.j=t}(e.i,e.h)):(n||(t=oa(t,da)),e.i=new fa(t,e.h))}function ia(e,t,n){e.i.set(t,n)}function sa(e){return ia(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ra(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function oa(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,aa),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function aa(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Jo.prototype.toString=function(){var e=[],t=this.j;t&&e.push(oa(t,la,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(oa(t,la,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(oa(n,"/"==n.charAt(0)?ua:ca,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",oa(n,ha)),e.join("")};var la=/[#\/\?@]/g,ca=/[#\?:]/g,ua=/[#\?]/g,da=/[#\?@]/g,ha=/#/g;function fa(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function pa(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),s=null;if(0<=i){var r=e[n].substring(0,i);s=e[n].substring(i+1)}else r=e[n];t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function ma(e,t){pa(e),t=va(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function ga(e,t){return pa(e),t=va(e,t),e.g.has(t)}function ya(e,t,n){ma(e,t),0<n.length&&(e.i=null,e.g.set(va(e,t),Xs(n)),e.h+=n.length)}function va(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(Rs=fa.prototype).add=function(e,t){pa(this),this.i=null,e=va(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Rs.forEach=function(e,t){pa(this),this.g.forEach(function(n,i){n.forEach(function(n){e.call(t,n,i,this)},this)},this)},Rs.ta=function(){pa(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){const s=e[i];for(let e=0;e<s.length;e++)n.push(t[i])}return n},Rs.Z=function(e){pa(this);let t=[];if("string"===typeof e)ga(this,e)&&(t=t.concat(this.g.get(va(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},Rs.set=function(e,t){return pa(this),this.i=null,ga(this,e=va(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Rs.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},Rs.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];const r=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var s=r;""!==o[i]&&(s+="="+encodeURIComponent(String(o[i]))),e.push(s)}}return this.i=e.join("&")};var ba=class{constructor(e,t){this.g=e,this.map=t}};function xa(e){this.l=e||_a,Fs.PerformanceNavigationTiming?e=0<(e=Fs.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(Fs.g&&Fs.g.Ka&&Fs.g.Ka()&&Fs.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var _a=10;function wa(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Ca(e){return e.h?1:e.g?e.g.size:0}function Na(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function ka(e,t){e.g?e.g.add(t):e.h=t}function Ea(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Ta(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return Xs(e.i)}xa.prototype.cancel=function(){if(this.i=Ta(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Sa,Ia=class{stringify(e){return Fs.JSON.stringify(e,void 0)}parse(e){return Fs.JSON.parse(e,void 0)}};function Pa(){this.g=new Ia}function ja(e,t,n){const i=n||"";try{Xo(e,function(e,n){let s=e;Us(e)&&(s=Gr(e)),t.push(i+n+"="+encodeURIComponent(s))})}catch(s){throw t.push(i+"type="+encodeURIComponent("_badmap")),s}}function Aa(e,t,n,i,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(i)}catch(r){}}function Da(e){this.l=e.fc||null,this.j=e.ob||!1}function Ra(e,t){Hr.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=Ma,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ks(Da,Eo),Da.prototype.g=function(){return new Ra(this.l,this.j)},Da.prototype.i=(Sa={},function(){return Sa}),Ks(Ra,Hr);var Ma=0;function Oa(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function La(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Fa(e)}function Fa(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Rs=Ra.prototype).open=function(e,t){if(this.readyState!=Ma)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Fa(this)},Rs.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||Fs).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},Rs.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,La(this)),this.readyState=Ma},Rs.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Fa(this)),this.g&&(this.readyState=3,Fa(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if("undefined"!==typeof Fs.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Oa(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},Rs.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?La(this):Fa(this),3==this.readyState&&Oa(this)}},Rs.Za=function(e){this.g&&(this.response=this.responseText=e,La(this))},Rs.Ya=function(e){this.g&&(this.response=e,La(this))},Rs.ka=function(){this.g&&La(this)},Rs.setRequestHeader=function(e,t){this.v.append(e,t)},Rs.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Rs.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Ra.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var za=Fs.JSON.parse;function Ua(e){Hr.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Va,this.L=this.M=!1}Ks(Ua,Hr);var Va="",Ba=/^https?$/i,Ha=["POST","PUT"];function qa(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Wa(e),Ka(e)}function Wa(e){e.F||(e.F=!0,qr(e,"complete"),qr(e,"error"))}function Ga(e){if(e.h&&"undefined"!=typeof Ls&&(!e.C[1]||4!=Qa(e)||2!=e.da()))if(e.v&&4==Qa(e))ro(e.La,0,e);else if(qr(e,"readystatechange"),4==Qa(e)){e.h=!1;try{const a=e.da();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var i;if(i=0===a){var s=String(e.I).match($o)[1]||null;!s&&Fs.self&&Fs.self.location&&(s=Fs.self.location.protocol.slice(0,-1)),i=!Ba.test(s?s.toLowerCase():"")}n=i}if(n)qr(e,"complete"),qr(e,"success");else{e.m=6;try{var r=2<Qa(e)?e.g.statusText:""}catch(o){r=""}e.j=r+" ["+e.da()+"]",Wa(e)}}finally{Ka(e)}}}function Ka(e,t){if(e.g){Ya(e);const i=e.g,s=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||qr(e,"ready");try{i.onreadystatechange=s}catch(n){}}}function Ya(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(Fs.clearTimeout(e.A),e.A=null)}function Qa(e){return e.g?e.g.readyState:0}function Xa(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case Va:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(tc){return null}}function $a(e){let t="";return Nr(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function Ja(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=$a(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):ia(e,t,n))}function Za(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function el(e){this.Ga=0,this.j=[],this.l=new fo,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Za("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Za("baseRetryDelayMs",5e3,e),this.hb=Za("retryDelaySeedMs",1e4,e),this.eb=Za("forwardChannelMaxRetries",2,e),this.xa=Za("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new xa(e&&e.concurrentRequestLimit),this.Ja=new Pa,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function tl(e){if(il(e),3==e.H){var t=e.W++,n=Zo(e.I);if(ia(n,"SID",e.K),ia(n,"RID",t),ia(n,"TYPE","terminate"),ol(e,n),(t=new Ro(e,e.l,t)).L=2,t.v=sa(Zo(n)),n=!1,Fs.navigator&&Fs.navigator.sendBeacon)try{n=Fs.navigator.sendBeacon(t.v.toString(),"")}catch(i){}!n&&Fs.Image&&((new Image).src=t.v,n=!0),n||(t.g=vl(t.l,null),t.g.ha(t.v)),t.G=Date.now(),qo(t)}gl(e)}function nl(e){e.g&&(ul(e),e.g.cancel(),e.g=null)}function il(e){nl(e),e.u&&(Fs.clearTimeout(e.u),e.u=null),hl(e),e.i.cancel(),e.m&&("number"===typeof e.m&&Fs.clearTimeout(e.m),e.m=null)}function sl(e){if(!wa(e.i)&&!e.m){e.m=!0;var t=e.Na;Jr||to(),Zr||(Jr(),Zr=!0),eo.add(t,e),e.C=0}}function rl(e,t){var n;n=t?t.m:e.W++;const i=Zo(e.I);ia(i,"SID",e.K),ia(i,"RID",n),ia(i,"AID",e.V),ol(e,i),e.o&&e.s&&Ja(i,e.o,e.s),n=new Ro(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=al(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),ka(e.i,n),zo(n,i,t)}function ol(e,t){e.na&&Nr(e.na,function(e,n){ia(t,n,e)}),e.h&&Xo({},function(e,n){ia(t,n,e)})}function al(e,t,n){n=Math.min(e.j.length,n);var i=e.h?Ws(e.h.Va,e.h,e):null;e:{var s=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let r=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=t,0>n)t=Math.max(0,s[o].g-100),r=!1;else try{ja(a,e,"req"+n+"_")}catch(hc){i&&i(a)}}if(r){i=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,i}function ll(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;Jr||to(),Zr||(Jr(),Zr=!0),eo.add(t,e),e.A=0}}function cl(e){return!(e.g||e.u||3<=e.A)&&(e.ba++,e.u=Co(Ws(e.Ma,e),pl(e,e.A)),e.A++,!0)}function ul(e){null!=e.B&&(Fs.clearTimeout(e.B),e.B=null)}function dl(e){e.g=new Ro(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=Zo(e.wa);ia(t,"RID","rpc"),ia(t,"SID",e.K),ia(t,"AID",e.V),ia(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&ia(t,"TO",e.qa),ia(t,"TYPE","xmlhttp"),ol(e,t),e.o&&e.s&&Ja(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=sa(Zo(t)),n.s=null,n.S=!0,Uo(n,e)}function hl(e){null!=e.v&&(Fs.clearTimeout(e.v),e.v=null)}function fl(e,t){var n=null;if(e.g==t){hl(e),ul(e),e.g=null;var i=2}else{if(!Na(e.i,t))return;n=t.F,Ea(e.i,t),i=1}if(0!=e.H)if(t.i)if(1==i){n=t.s?t.s.length:0,t=Date.now()-t.G;var s=e.C;qr(i=yo(),new wo(i,n)),sl(e)}else ll(e);else if(3==(s=t.o)||0==s&&0<t.ca||!(1==i&&function(e,t){return!(Ca(e.i)>=e.i.j-(e.m?1:0))&&(e.m?(e.j=t.F.concat(e.j),!0):!(1==e.H||2==e.H||e.C>=(e.cb?0:e.eb))&&(e.m=Co(Ws(e.Na,e,t),pl(e,e.C)),e.C++,!0))}(e,t)||2==i&&cl(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),s){case 1:ml(e,5);break;case 4:ml(e,10);break;case 3:ml(e,6);break;default:ml(e,2)}}function pl(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function ml(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var i=Ws(e.pb,e);n||(n=new Jo("//www.google.com/images/cleardot.gif"),Fs.location&&"http"==Fs.location.protocol||ea(n,"https"),sa(n)),function(e,t){const n=new fo;if(Fs.Image){const i=new Image;i.onload=Gs(Aa,n,i,"TestLoadImage: loaded",!0,t),i.onerror=Gs(Aa,n,i,"TestLoadImage: error",!1,t),i.onabort=Gs(Aa,n,i,"TestLoadImage: abort",!1,t),i.ontimeout=Gs(Aa,n,i,"TestLoadImage: timeout",!1,t),Fs.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=e}else t(!1)}(n.toString(),i)}else _o(2);e.H=0,e.h&&e.h.za(t),gl(e),il(e)}function gl(e){if(e.H=0,e.ma=[],e.h){const t=Ta(e.i);0==t.length&&0==e.j.length||($s(e.ma,t),$s(e.ma,e.j),e.i.i.length=0,Xs(e.j),e.j.length=0),e.h.ya()}}function yl(e,t,n){var i=n instanceof Jo?Zo(n):new Jo(n);if(""!=i.g)t&&(i.g=t+"."+i.g),ta(i,i.m);else{var s=Fs.location;i=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var r=new Jo(null);i&&ea(r,i),t&&(r.g=t),s&&ta(r,s),n&&(r.l=n),i=r}return n=e.F,t=e.Da,n&&t&&ia(i,n,t),ia(i,"VER",e.ra),ol(e,i),i}function vl(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ha&&!e.va?new Ua(new Da({ob:!0})):new Ua(e.va)).Oa(e.J),t}function bl(){}function xl(){if(ar&&!(10<=Number(yr)))throw Error("Environmental error: no available transport.")}function _l(e,t){Hr.call(this),this.g=new el(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!er(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!er(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Nl(this)}function wl(e){jo.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Cl(){Ao.call(this),this.status=1}function Nl(e){this.g=e}function kl(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function El(e,t,n){n||(n=0);var i=Array(16);if("string"===typeof t)for(var s=0;16>s;++s)i[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;16>s;++s)i[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];var r=e.g[3],o=t+(r^n&(s^r))+i[0]+3614090360&4294967295;o=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=n+(o<<7&4294967295|o>>>25))+((o=r+(s^t&(n^s))+i[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(t^n))+i[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(r^t))+i[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^n&(s^r))+i[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^t&(n^s))+i[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(t^n))+i[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(r^t))+i[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^n&(s^r))+i[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^t&(n^s))+i[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(t^n))+i[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(r^t))+i[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^n&(s^r))+i[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^t&(n^s))+i[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(t^n))+i[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(r^t))+i[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^r&(n^s))+i[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(t^n))+i[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(r^t))+i[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(s^r))+i[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^r&(n^s))+i[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(t^n))+i[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(r^t))+i[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(s^r))+i[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^r&(n^s))+i[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(t^n))+i[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(r^t))+i[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(s^r))+i[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^r&(n^s))+i[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(t^n))+i[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(r^t))+i[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(s^r))+i[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^s^r)+i[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^s)+i[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^t^n)+i[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^t)+i[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^r)+i[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^s)+i[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^t^n)+i[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^t)+i[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^r)+i[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^s)+i[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^t^n)+i[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^t)+i[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^r)+i[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^s)+i[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^t^n)+i[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^t)+i[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(s^(n|~r))+i[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~s))+i[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(r|~n))+i[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~t))+i[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(n|~r))+i[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~s))+i[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(r|~n))+i[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~t))+i[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(n|~r))+i[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~s))+i[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(r|~n))+i[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~t))+i[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((r=(t=n+((o=t+(s^(n|~r))+i[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~s))+i[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=r+((o=s+(t^(r|~n))+i[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+i[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+r&4294967295}function Tl(e,t){this.h=t;for(var n=[],i=!0,s=e.length-1;0<=s;s--){var r=0|e[s];i&&r==t||(n[s]=r,i=!1)}this.g=n}(Rs=Ua.prototype).Oa=function(e){this.M=e},Rs.ha=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Io.g(),this.C=this.u?To(this.u):To(Io),this.g.onreadystatechange=Ws(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(r){return void qa(this,r)}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else{if("function"!==typeof i.keys||"function"!==typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const e of i.keys())n.set(e,i.get(e))}i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=Fs.FormData&&e instanceof Fs.FormData,!(0<=Qs(Ha,t))||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[o,a]of n)this.g.setRequestHeader(o,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Ya(this),0<this.B&&((this.L=function(e){return ar&&"number"===typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ws(this.ua,this)):this.A=ro(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(r){qa(this,r)}},Rs.ua=function(){"undefined"!=typeof Ls&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,qr(this,"timeout"),this.abort(8))},Rs.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,qr(this,"complete"),qr(this,"abort"),Ka(this))},Rs.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ka(this,!0)),Ua.$.N.call(this)},Rs.La=function(){this.s||(this.G||this.v||this.l?Ga(this):this.kb())},Rs.kb=function(){Ga(this)},Rs.isActive=function(){return!!this.g},Rs.da=function(){try{return 2<Qa(this)?this.g.status:-1}catch(Sa){return-1}},Rs.ja=function(){try{return this.g?this.g.responseText:""}catch(Sa){return""}},Rs.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),za(t)}},Rs.Ia=function(){return this.m},Rs.Sa=function(){return"string"===typeof this.j?this.j:String(this.j)},(Rs=el.prototype).ra=8,Rs.H=1,Rs.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const s=new Ro(this,this.l,e);let r=this.s;if(this.U&&(r?(r=kr(r),Tr(r,this.U)):r=this.U),null!==this.o||this.O||(s.I=r,r=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var i=this.j[n];if(void 0===(i="__data__"in i.map&&"string"===typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=al(this,s,t),ia(n=Zo(this.I),"RID",e),ia(n,"CVER",22),this.F&&ia(n,"X-HTTP-Session-Id",this.F),ol(this,n),r&&(this.O?t="headers="+encodeURIComponent(String($a(r)))+"&"+t:this.o&&Ja(n,this.o,r)),ka(this.i,s),this.bb&&ia(n,"TYPE","init"),this.P?(ia(n,"$req",t),ia(n,"SID","null"),s.aa=!0,zo(s,n,null)):zo(s,n,t),this.H=2}}else 3==this.H&&(e?rl(this,e):0==this.j.length||wa(this.i)||rl(this))},Rs.Ma=function(){if(this.u=null,dl(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=Co(Ws(this.jb,this),e)}},Rs.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,_o(10),nl(this),dl(this))},Rs.ib=function(){null!=this.v&&(this.v=null,nl(this),cl(this),_o(19))},Rs.pb=function(e){e?(this.l.info("Successfully pinged google.com"),_o(2)):(this.l.info("Failed to ping google.com"),_o(1))},Rs.isActive=function(){return!!this.h&&this.h.isActive(this)},(Rs=bl.prototype).Ba=function(){},Rs.Aa=function(){},Rs.za=function(){},Rs.ya=function(){},Rs.isActive=function(){return!0},Rs.Va=function(){},xl.prototype.g=function(e,t){return new _l(e,t)},Ks(_l,Hr),_l.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;_o(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=yl(e,null,e.Y),sl(e)},_l.prototype.close=function(){tl(this.g)},_l.prototype.u=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=Gr(e),e=n);t.j.push(new ba(t.fb++,e)),3==t.H&&sl(t)},_l.prototype.N=function(){this.g.h=null,delete this.j,tl(this.g),delete this.g,_l.$.N.call(this)},Ks(wl,jo),Ks(Cl,Ao),Ks(Nl,bl),Nl.prototype.Ba=function(){qr(this.g,"a")},Nl.prototype.Aa=function(e){qr(this.g,new wl(e))},Nl.prototype.za=function(e){qr(this.g,new Cl)},Nl.prototype.ya=function(){qr(this.g,"b")},Ks(kl,function(){this.blockSize=-1}),kl.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},kl.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,i=this.m,s=this.h,r=0;r<t;){if(0==s)for(;r<=n;)El(this,e,r),r+=this.blockSize;if("string"===typeof e){for(;r<t;)if(i[s++]=e.charCodeAt(r++),s==this.blockSize){El(this,i),s=0;break}}else for(;r<t;)if(i[s++]=e[r++],s==this.blockSize){El(this,i),s=0;break}}this.h=s,this.i+=t},kl.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var i=0;32>i;i+=8)e[n++]=this.g[t]>>>i&255;return e};var Sl={};function Il(e){return-128<=e&&128>e?function(e,t){var n=Sl;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new Tl([0|e],0>e?-1:0)}):new Tl([0|e],0>e?-1:0)}function Pl(e){if(isNaN(e)||!isFinite(e))return Al;if(0>e)return Ll(Pl(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=jl;return new Tl(t,0)}var jl=4294967296,Al=Il(0),Dl=Il(1),Rl=Il(16777216);function Ml(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function Ol(e){return-1==e.h}function Ll(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new Tl(n,~e.h).add(Dl)}function Fl(e,t){return e.add(Ll(t))}function zl(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function Ul(e,t){this.g=e,this.h=t}function Vl(e,t){if(Ml(t))throw Error("division by zero");if(Ml(e))return new Ul(Al,Al);if(Ol(e))return t=Vl(Ll(e),t),new Ul(Ll(t.g),Ll(t.h));if(Ol(t))return t=Vl(e,Ll(t)),new Ul(Ll(t.g),t.h);if(30<e.g.length){if(Ol(e)||Ol(t))throw Error("slowDivide_ only works with positive integers.");for(var n=Dl,i=t;0>=i.X(e);)n=Bl(n),i=Bl(i);var s=Hl(n,1),r=Hl(i,1);for(i=Hl(i,2),n=Hl(n,2);!Ml(i);){var o=r.add(i);0>=o.X(e)&&(s=s.add(n),r=o),i=Hl(i,1),n=Hl(n,1)}return t=Fl(e,s.R(t)),new Ul(s,t)}for(s=Al;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),o=(r=Pl(n)).R(t);Ol(o)||0<o.X(e);)o=(r=Pl(n-=i)).R(t);Ml(r)&&(r=Dl),s=s.add(r),e=Fl(e,o)}return new Ul(s,e)}function Bl(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.D(i)<<1|e.D(i-1)>>>31;return new Tl(n,e.h)}function Hl(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,s=[],r=0;r<i;r++)s[r]=0<t?e.D(r+n)>>>t|e.D(r+n+1)<<32-t:e.D(r+n);return new Tl(s,e.h)}(Rs=Tl.prototype).ea=function(){if(Ol(this))return-Ll(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var i=this.D(n);e+=(0<=i?i:jl+i)*t,t*=jl}return e},Rs.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(Ml(this))return"0";if(Ol(this))return"-"+Ll(this).toString(e);for(var t=Pl(Math.pow(e,6)),n=this,i="";;){var s=Vl(n,t).g,r=((0<(n=Fl(n,s.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(Ml(n=s))return r+i;for(;6>r.length;)r="0"+r;i=r+i}},Rs.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},Rs.X=function(e){return Ol(e=Fl(this,e))?-1:Ml(e)?0:1},Rs.abs=function(){return Ol(this)?Ll(this):this},Rs.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,s=0;s<=t;s++){var r=i+(65535&this.D(s))+(65535&e.D(s)),o=(r>>>16)+(this.D(s)>>>16)+(e.D(s)>>>16);i=o>>>16,r&=65535,o&=65535,n[s]=o<<16|r}return new Tl(n,-2147483648&n[n.length-1]?-1:0)},Rs.R=function(e){if(Ml(this)||Ml(e))return Al;if(Ol(this))return Ol(e)?Ll(this).R(Ll(e)):Ll(Ll(this).R(e));if(Ol(e))return Ll(this.R(Ll(e)));if(0>this.X(Rl)&&0>e.X(Rl))return Pl(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<e.g.length;s++){var r=this.D(i)>>>16,o=65535&this.D(i),a=e.D(s)>>>16,l=65535&e.D(s);n[2*i+2*s]+=o*l,zl(n,2*i+2*s),n[2*i+2*s+1]+=r*l,zl(n,2*i+2*s+1),n[2*i+2*s+1]+=o*a,zl(n,2*i+2*s+1),n[2*i+2*s+2]+=r*a,zl(n,2*i+2*s+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new Tl(n,0)},Rs.gb=function(e){return Vl(this,e).h},Rs.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.D(i)&e.D(i);return new Tl(n,this.h&e.h)},Rs.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.D(i)|e.D(i);return new Tl(n,this.h|e.h)},Rs.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.D(i)^e.D(i);return new Tl(n,this.h^e.h)},xl.prototype.createWebChannel=xl.prototype.g,_l.prototype.send=_l.prototype.u,_l.prototype.open=_l.prototype.m,_l.prototype.close=_l.prototype.close,No.NO_ERROR=0,No.TIMEOUT=8,No.HTTP_ERROR=6,ko.COMPLETE="complete",So.EventType=Po,Po.OPEN="a",Po.CLOSE="b",Po.ERROR="c",Po.MESSAGE="d",Hr.prototype.listen=Hr.prototype.O,Ua.prototype.listenOnce=Ua.prototype.P,Ua.prototype.getLastError=Ua.prototype.Sa,Ua.prototype.getLastErrorCode=Ua.prototype.Ia,Ua.prototype.getStatus=Ua.prototype.da,Ua.prototype.getResponseJson=Ua.prototype.Wa,Ua.prototype.getResponseText=Ua.prototype.ja,Ua.prototype.send=Ua.prototype.ha,Ua.prototype.setWithCredentials=Ua.prototype.Oa,kl.prototype.digest=kl.prototype.l,kl.prototype.reset=kl.prototype.reset,kl.prototype.update=kl.prototype.j,Tl.prototype.add=Tl.prototype.add,Tl.prototype.multiply=Tl.prototype.R,Tl.prototype.modulo=Tl.prototype.gb,Tl.prototype.compare=Tl.prototype.X,Tl.prototype.toNumber=Tl.prototype.ea,Tl.prototype.toString=Tl.prototype.toString,Tl.prototype.getBits=Tl.prototype.D,Tl.fromNumber=Pl,Tl.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return Ll(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=Pl(Math.pow(n,8)),s=Al,r=0;r<t.length;r+=8){var o=Math.min(8,t.length-r),a=parseInt(t.substring(r,r+o),n);8>o?(o=Pl(Math.pow(n,o)),s=s.R(o).add(Pl(a))):s=(s=s.R(i)).add(Pl(a))}return s};var ql=Os.createWebChannelTransport=function(){return new xl},Wl=Os.getStatEventTarget=function(){return yo()},Gl=Os.ErrorCode=No,Kl=Os.EventType=ko,Yl=Os.Event=mo,Ql=Os.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Xl=Os.FetchXmlHttpFactory=Da,$l=Os.WebChannel=So,Jl=Os.XhrIo=Ua,Zl=Os.Md5=kl,ec=Os.Integer=Tl;const tc="@firebase/firestore";class nc{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}nc.UNAUTHENTICATED=new nc(null),nc.GOOGLE_CREDENTIALS=new nc("google-credentials-uid"),nc.FIRST_PARTY=new nc("first-party-uid"),nc.MOCK_USER=new nc("mock-user");let ic="9.23.0";const sc=new me("@firebase/firestore");function rc(){return sc.logLevel}function oc(e){if(sc.logLevel<=ue.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const s=n.map(cc);sc.debug("Firestore (".concat(ic,"): ").concat(e),...s)}}function ac(e){if(sc.logLevel<=ue.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const s=n.map(cc);sc.error("Firestore (".concat(ic,"): ").concat(e),...s)}}function lc(e){if(sc.logLevel<=ue.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];const s=n.map(cc);sc.warn("Firestore (".concat(ic,"): ").concat(e),...s)}}function cc(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function uc(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state";const t="FIRESTORE (".concat(ic,") INTERNAL ASSERTION FAILED: ")+e;throw ac(t),new Error(t)}function dc(e,t){e||uc()}function hc(e,t){return e}const fc={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class pc extends F{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class mc{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class gc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class yc{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(nc.UNAUTHENTICATED))}shutdown(){}}class vc{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class bc{constructor(e){this.t=e,this.currentUser=nc.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new mc;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new mc,e.enqueueRetryable(()=>i(this.currentUser))};const r=()=>{const t=s;e.enqueueRetryable(async()=>{await t.promise,await i(this.currentUser)})},o=e=>{oc("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(oc("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new mc)}},0),r()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(oc("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(dc("string"==typeof t.accessToken),new gc(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return dc(null===e||"string"==typeof e),new nc(e)}}class xc{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=nc.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class _c{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new xc(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(nc.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class wc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Cc{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const n=e=>{null!=e.error&&oc("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const n=e.token!==this.T;return this.T=e.token,oc("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const i=e=>{oc("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit(e=>i(e)),setTimeout(()=>{if(!this.appCheck){const e=this.I.getImmediate({optional:!0});e?i(e):oc("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(dc("string"==typeof e.token),this.T=e.token,new wc(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Nc(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let i=0;i<e;i++)n[i]=Math.floor(256*Math.random());return n}class kc{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=Nc(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%62))}return n}}function Ec(e,t){return e<t?-1:e>t?1:0}function Tc(e,t,n){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}class Sc{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new pc(fc.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new pc(fc.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new pc(fc.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new pc(fc.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Sc.fromMillis(Date.now())}static fromDate(e){return Sc.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Sc(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ec(this.nanoseconds,e.nanoseconds):Ec(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Ic{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ic(e)}static min(){return new Ic(new Sc(0,0))}static max(){return new Ic(new Sc(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Pc{constructor(e,t,n){void 0===t?t=0:t>e.length&&uc(),void 0===n?n=e.length-t:n>e.length-t&&uc(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Pc.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Pc?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=e.get(i),s=t.get(i);if(n<s)return-1;if(n>s)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class jc extends Pc{construct(e,t,n){return new jc(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const s of n){if(s.indexOf("//")>=0)throw new pc(fc.INVALID_ARGUMENT,"Invalid segment (".concat(s,"). Paths must not contain // in them."));e.push(...s.split("/").filter(e=>e.length>0))}return new jc(e)}static emptyPath(){return new jc([])}}const Ac=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Dc extends Pc{construct(e,t,n){return new Dc(e,t,n)}static isValidIdentifier(e){return Ac.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Dc.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Dc(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new pc(fc.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""};let r=!1;for(;i<e.length;){const t=e[i];if("\\"===t){if(i+1===e.length)throw new pc(fc.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new pc(fc.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?(r=!r,i++):"."!==t||r?(n+=t,i++):(s(),i++)}if(s(),r)throw new pc(fc.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Dc(t)}static emptyPath(){return new Dc([])}}class Rc{constructor(e){this.path=e}static fromPath(e){return new Rc(jc.fromString(e))}static fromName(e){return new Rc(jc.fromString(e).popFirst(5))}static empty(){return new Rc(jc.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===jc.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return jc.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Rc(new jc(e.slice()))}}class Mc{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}Mc.UNKNOWN_ID=-1;function Oc(e,t){const n=e.toTimestamp().seconds,i=e.toTimestamp().nanoseconds+1,s=Ic.fromTimestamp(1e9===i?new Sc(n+1,0):new Sc(n,i));return new Fc(s,Rc.empty(),t)}function Lc(e){return new Fc(e.readTime,e.key,-1)}class Fc{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Fc(Ic.min(),Rc.empty(),-1)}static max(){return new Fc(Ic.max(),Rc.empty(),-1)}}function zc(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Rc.comparator(e.documentKey,t.documentKey),0!==n?n:Ec(e.largestBatchId,t.largestBatchId))}const Uc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Vc{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function Bc(e){if(e.code!==fc.FAILED_PRECONDITION||e.message!==Uc)throw e;oc("LocalStore","Unexpectedly lost primary lease")}class Hc{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&uc(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Hc((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Hc?t:Hc.resolve(t)}catch(e){return Hc.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Hc.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Hc.reject(t)}static resolve(e){return new Hc((t,n)=>{t(e)})}static reject(e){return new Hc((t,n)=>{n(e)})}static waitFor(e){return new Hc((t,n)=>{let i=0,s=0,r=!1;e.forEach(e=>{++i,e.next(()=>{++s,r&&s===i&&t()},e=>n(e))}),r=!0,s===i&&t()})}static or(e){let t=Hc.resolve(!1);for(const n of e)t=t.next(e=>e?Hc.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,i)=>{n.push(t.call(this,e,i))}),this.waitFor(n)}static mapArray(e,t){return new Hc((n,i)=>{const s=e.length,r=new Array(s);let o=0;for(let a=0;a<s;a++){const l=a;t(e[l]).next(e=>{r[l]=e,++o,o===s&&n(r)},e=>i(e))}})}static doWhile(e,t){return new Hc((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}function qc(e){return"IndexedDbTransactionError"===e.name}class Wc{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ut&&this.ut(e),e}}function Gc(e){return null==e}function Kc(e){return 0===e&&1/e==-1/0}function Yc(e){return"number"==typeof e&&Number.isInteger(e)&&!Kc(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}Wc.ct=-1;const Qc=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Xc=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],$c=Xc;function Jc(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Zc(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function eu(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class tu{constructor(e,t){this.comparator=e,this.root=t||iu.EMPTY}insert(e,t){return new tu(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,iu.BLACK,null,null))}remove(e){return new tu(this.comparator,this.root.remove(e,this.comparator).copy(null,null,iu.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push("".concat(t,":").concat(n)),!1)),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nu(this.root,e,this.comparator,!1)}getReverseIterator(){return new nu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nu(this.root,e,this.comparator,!0)}}class nu{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class iu{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:iu.RED,this.left=null!=i?i:iu.EMPTY,this.right=null!=s?s:iu.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new iu(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return iu.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return iu.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,iu.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,iu.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw uc();if(this.right.isRed())throw uc();const e=this.left.check();if(e!==this.right.check())throw uc();return e+(this.isRed()?0:1)}}iu.EMPTY=null,iu.RED=!0,iu.BLACK=!1,iu.EMPTY=new class{constructor(){this.size=0}get key(){throw uc()}get value(){throw uc()}get color(){throw uc()}get left(){throw uc()}get right(){throw uc()}copy(e,t,n,i,s){return this}insert(e,t,n){return new iu(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class su{constructor(e){this.comparator=e,this.data=new tu(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ru(this.data.getIterator())}getIteratorFrom(e){return new ru(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof su))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new su(this.comparator);return t.data=e,t}}class ru{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ou{constructor(e){this.fields=e,e.sort(Dc.comparator)}static empty(){return new ou([])}unionWith(e){let t=new su(Dc.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new ou(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Tc(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class au extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class lu{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new au("Invalid base64 string: "+e):e}}(e);return new lu(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new lu(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ec(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}lu.EMPTY_BYTE_STRING=new lu("");const cu=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function uu(e){if(dc(!!e),"string"==typeof e){let t=0;const n=cu.exec(e);if(dc(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:du(e.seconds),nanos:du(e.nanos)}}function du(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function hu(e){return"string"==typeof e?lu.fromBase64String(e):lu.fromUint8Array(e)}function fu(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function pu(e){const t=e.mapValue.fields.__previous_value__;return fu(t)?pu(t):t}function mu(e){const t=uu(e.mapValue.fields.__local_write_time__.timestampValue);return new Sc(t.seconds,t.nanos)}class gu{constructor(e,t,n,i,s,r,o,a,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l}}class yu{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new yu("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof yu&&e.projectId===this.projectId&&e.database===this.database}}const vu={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function bu(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?fu(e)?4:Du(e)?9007199254740991:10:uc()}function xu(e,t){if(e===t)return!0;const n=bu(e);if(n!==bu(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return mu(e).isEqual(mu(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=uu(e.timestampValue),i=uu(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return hu(e.bytesValue).isEqual(hu(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return du(e.geoPointValue.latitude)===du(t.geoPointValue.latitude)&&du(e.geoPointValue.longitude)===du(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return du(e.integerValue)===du(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=du(e.doubleValue),i=du(t.doubleValue);return n===i?Kc(n)===Kc(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return Tc(e.arrayValue.values||[],t.arrayValue.values||[],xu);case 10:return function(e,t){const n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(Jc(n)!==Jc(i))return!1;for(const s in n)if(n.hasOwnProperty(s)&&(void 0===i[s]||!xu(n[s],i[s])))return!1;return!0}(e,t);default:return uc()}}function _u(e,t){return void 0!==(e.values||[]).find(e=>xu(e,t))}function wu(e,t){if(e===t)return 0;const n=bu(e),i=bu(t);if(n!==i)return Ec(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ec(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=du(e.integerValue||e.doubleValue),i=du(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return Cu(e.timestampValue,t.timestampValue);case 4:return Cu(mu(e),mu(t));case 5:return Ec(e.stringValue,t.stringValue);case 6:return function(e,t){const n=hu(e),i=hu(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),i=t.split("/");for(let s=0;s<n.length&&s<i.length;s++){const e=Ec(n[s],i[s]);if(0!==e)return e}return Ec(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Ec(du(e.latitude),du(t.latitude));return 0!==n?n:Ec(du(e.longitude),du(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],i=t.values||[];for(let s=0;s<n.length&&s<i.length;++s){const e=wu(n[s],i[s]);if(e)return e}return Ec(n.length,i.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===vu.mapValue&&t===vu.mapValue)return 0;if(e===vu.mapValue)return 1;if(t===vu.mapValue)return-1;const n=e.fields||{},i=Object.keys(n),s=t.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let o=0;o<i.length&&o<r.length;++o){const e=Ec(i[o],r[o]);if(0!==e)return e;const t=wu(n[i[o]],s[r[o]]);if(0!==t)return t}return Ec(i.length,r.length)}(e.mapValue,t.mapValue);default:throw uc()}}function Cu(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Ec(e,t);const n=uu(e),i=uu(t),s=Ec(n.seconds,i.seconds);return 0!==s?s:Ec(n.nanos,i.nanos)}function Nu(e){return ku(e)}function ku(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=uu(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?hu(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,Rc.fromName(n).toString()):"geoPointValue"in e?"geo(".concat((t=e.geoPointValue).latitude,",").concat(t.longitude,")"):"arrayValue"in e?function(e){let t="[",n=!0;for(const i of e.values||[])n?n=!1:t+=",",t+=ku(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",i=!0;for(const s of t)i?i=!1:n+=",",n+="".concat(s,":").concat(ku(e.fields[s]));return n+"}"}(e.mapValue):uc();var t,n}function Eu(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function Tu(e){return!!e&&"integerValue"in e}function Su(e){return!!e&&"arrayValue"in e}function Iu(e){return!!e&&"nullValue"in e}function Pu(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ju(e){return!!e&&"mapValue"in e}function Au(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Zc(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=Au(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Au(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Du(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class Ru{constructor(e){this.value=e}static empty(){return new Ru({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ju(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Au(t)}setAll(e){let t=Dc.emptyPath(),n={},i=[];e.forEach((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=s.popLast()}e?n[s.lastSegment()]=Au(e):i.push(s.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());ju(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return xu(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];ju(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Zc(t,(t,n)=>e[t]=n);for(const i of n)delete e[i]}clone(){return new Ru(Au(this.value))}}function Mu(e){const t=[];return Zc(e.fields,(e,n)=>{const i=new Dc([e]);if(ju(n)){const e=Mu(n.mapValue).fields;if(0===e.length)t.push(i);else for(const n of e)t.push(i.child(n))}else t.push(i)}),new ou(t)}class Ou{constructor(e,t,n,i,s,r,o){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=r,this.documentState=o}static newInvalidDocument(e){return new Ou(e,0,Ic.min(),Ic.min(),Ic.min(),Ru.empty(),0)}static newFoundDocument(e,t,n,i){return new Ou(e,1,t,Ic.min(),n,i,0)}static newNoDocument(e,t){return new Ou(e,2,t,Ic.min(),Ic.min(),Ru.empty(),0)}static newUnknownDocument(e,t){return new Ou(e,3,t,Ic.min(),Ic.min(),Ru.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ic.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ru.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ru.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ic.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ou&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ou(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class Lu{constructor(e,t){this.position=e,this.inclusive=t}}function Fu(e,t,n){let i=0;for(let s=0;s<e.position.length;s++){const r=t[s],o=e.position[s];if(i=r.field.isKeyField()?Rc.comparator(Rc.fromName(o.referenceValue),n.key):wu(o,n.data.field(r.field)),"desc"===r.dir&&(i*=-1),0!==i)break}return i}function zu(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!xu(e.position[n],t.position[n]))return!1;return!0}class Uu{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function Vu(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Bu{}class Hu extends Bu{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new $u(e,t,n):"array-contains"===t?new td(e,n):"in"===t?new nd(e,n):"not-in"===t?new id(e,n):"array-contains-any"===t?new sd(e,n):new Hu(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Ju(e,n):new Zu(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(wu(t,this.value)):null!==t&&bu(this.value)===bu(t)&&this.matchesComparison(wu(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return uc()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class qu extends Bu{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new qu(e,t)}matches(e){return Wu(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft(e=>e.isInequality());return null!==e?e.field:null}ft(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Wu(e){return"and"===e.op}function Gu(e){return Ku(e)&&Wu(e)}function Ku(e){for(const t of e.filters)if(t instanceof qu)return!1;return!0}function Yu(e){if(e instanceof Hu)return e.field.canonicalString()+e.op.toString()+Nu(e.value);if(Gu(e))return e.filters.map(e=>Yu(e)).join(",");{const t=e.filters.map(e=>Yu(e)).join(",");return"".concat(e.op,"(").concat(t,")")}}function Qu(e,t){return e instanceof Hu?function(e,t){return t instanceof Hu&&e.op===t.op&&e.field.isEqual(t.field)&&xu(e.value,t.value)}(e,t):e instanceof qu?function(e,t){return t instanceof qu&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,i)=>e&&Qu(n,t.filters[i]),!0)}(e,t):void uc()}function Xu(e){return e instanceof Hu?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(Nu(e.value))}(e):e instanceof qu?function(e){return e.op.toString()+" {"+e.getFilters().map(Xu).join(" ,")+"}"}(e):"Filter"}class $u extends Hu{constructor(e,t,n){super(e,t,n),this.key=Rc.fromName(n.referenceValue)}matches(e){const t=Rc.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ju extends Hu{constructor(e,t){super(e,"in",t),this.keys=ed("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Zu extends Hu{constructor(e,t){super(e,"not-in",t),this.keys=ed("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ed(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>Rc.fromName(e.referenceValue))}class td extends Hu{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Su(t)&&_u(t.arrayValue,this.value)}}class nd extends Hu{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&_u(this.value.arrayValue,t)}}class id extends Hu{constructor(e,t){super(e,"not-in",t)}matches(e){if(_u(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!_u(this.value.arrayValue,t)}}class sd extends Hu{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Su(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>_u(this.value.arrayValue,e))}}class rd{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=o,this.dt=null}}function od(e){return new rd(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function ad(e){const t=hc(e);if(null===t.dt){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Yu(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Gc(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Nu(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Nu(e)).join(",")),t.dt=e}return t.dt}function ld(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Vu(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Qu(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!zu(e.startAt,t.startAt)&&zu(e.endAt,t.endAt)}function cd(e){return Rc.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class ud{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=o,this.endAt=a,this.wt=null,this._t=null,this.startAt,this.endAt}}function dd(e,t,n,i,s,r,o,a){return new ud(e,t,n,i,s,r,o,a)}function hd(e){return new ud(e)}function fd(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function pd(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function md(e){for(const t of e.filters){const e=t.getFirstInequalityField();if(null!==e)return e}return null}function gd(e){return null!==e.collectionGroup}function yd(e){const t=hc(e);if(null===t.wt){t.wt=[];const e=md(t),n=pd(t);if(null!==e&&null===n)e.isKeyField()||t.wt.push(new Uu(e)),t.wt.push(new Uu(Dc.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.wt.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.wt.push(new Uu(Dc.keyField(),e))}}}return t.wt}function vd(e){const t=hc(e);if(!t._t)if("F"===t.limitType)t._t=od(t.path,t.collectionGroup,yd(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const s of yd(t)){const t="desc"===s.dir?"asc":"desc";e.push(new Uu(s.field,t))}const n=t.endAt?new Lu(t.endAt.position,t.endAt.inclusive):null,i=t.startAt?new Lu(t.startAt.position,t.startAt.inclusive):null;t._t=od(t.path,t.collectionGroup,e,t.filters,t.limit,n,i)}return t._t}function bd(e,t){t.getFirstInequalityField(),md(e);const n=e.filters.concat([t]);return new ud(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function xd(e,t,n){return new ud(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function _d(e,t){return ld(vd(e),vd(t))&&e.limitType===t.limitType}function wd(e){return"".concat(ad(vd(e)),"|lt:").concat(e.limitType)}function Cd(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(e=>Xu(e)).join(", "),"]")),Gc(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Nu(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Nu(e)).join(",")),"Target(".concat(t,")")}(vd(e)),"; limitType=").concat(e.limitType,")")}function Nd(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Rc.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of yd(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const i=Fu(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,yd(e),t))&&!(e.endAt&&!function(e,t,n){const i=Fu(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,yd(e),t))}(e,t)}function kd(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Ed(e){return(t,n)=>{let i=!1;for(const s of yd(e)){const e=Td(s,t,n);if(0!==e)return e;i=i||s.field.isKeyField()}return 0}}function Td(e,t,n){const i=e.field.isKeyField()?Rc.comparator(t.key,n.key):function(e,t,n){const i=t.data.field(e),s=n.data.field(e);return null!==i&&null!==s?wu(i,s):uc()}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return uc()}}class Sd{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Zc(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return eu(this.inner)}size(){return this.innerSize}}const Id=new tu(Rc.comparator);function Pd(){return Id}const jd=new tu(Rc.comparator);function Ad(){let e=jd;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const s of n)e=e.insert(s.key,s);return e}function Dd(e){let t=jd;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Rd(){return Od()}function Md(){return Od()}function Od(){return new Sd(e=>e.toString(),(e,t)=>e.isEqual(t))}const Ld=new tu(Rc.comparator),Fd=new su(Rc.comparator);function zd(){let e=Fd;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(const s of n)e=e.add(s);return e}const Ud=new su(Ec);function Vd(){return Ud}function Bd(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Kc(t)?"-0":t}}function Hd(e){return{integerValue:""+e}}function qd(e,t){return Yc(t)?Hd(t):Bd(e,t)}class Wd{constructor(){this._=void 0}}function Gd(e,t,n){return e instanceof Qd?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&fu(t)&&(t=pu(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Xd?$d(e,t):e instanceof Jd?Zd(e,t):function(e,t){const n=Yd(e,t),i=th(n)+th(e.gt);return Tu(n)&&Tu(e.gt)?Hd(i):Bd(e.serializer,i)}(e,t)}function Kd(e,t,n){return e instanceof Xd?$d(e,t):e instanceof Jd?Zd(e,t):n}function Yd(e,t){return e instanceof eh?Tu(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class Qd extends Wd{}class Xd extends Wd{constructor(e){super(),this.elements=e}}function $d(e,t){const n=nh(t);for(const i of e.elements)n.some(e=>xu(e,i))||n.push(i);return{arrayValue:{values:n}}}class Jd extends Wd{constructor(e){super(),this.elements=e}}function Zd(e,t){let n=nh(t);for(const i of e.elements)n=n.filter(e=>!xu(e,i));return{arrayValue:{values:n}}}class eh extends Wd{constructor(e,t){super(),this.serializer=e,this.gt=t}}function th(e){return du(e.integerValue||e.doubleValue)}function nh(e){return Su(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ih{constructor(e,t){this.field=e,this.transform=t}}class sh{constructor(e,t){this.version=e,this.transformResults=t}}class rh{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new rh}static exists(e){return new rh(void 0,e)}static updateTime(e){return new rh(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function oh(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ah{}function lh(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new vh(e.key,rh.none()):new fh(e.key,e.data,rh.none());{const n=e.data,i=Ru.empty();let s=new su(Dc.comparator);for(let e of t.fields)if(!s.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),s=s.add(e)}return new ph(e.key,i,new ou(s.toArray()),rh.none())}}function ch(e,t,n){e instanceof fh?function(e,t,n){const i=e.value.clone(),s=gh(e.fieldTransforms,t,n.transformResults);i.setAll(s),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof ph?function(e,t,n){if(!oh(e.precondition,t))return void t.convertToUnknownDocument(n.version);const i=gh(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(mh(e)),s.setAll(i),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function uh(e,t,n,i){return e instanceof fh?function(e,t,n,i){if(!oh(e.precondition,t))return n;const s=e.value.clone(),r=yh(e.fieldTransforms,i,t);return s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,i):e instanceof ph?function(e,t,n,i){if(!oh(e.precondition,t))return n;const s=yh(e.fieldTransforms,i,t),r=t.data;return r.setAll(mh(e)),r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,i):function(e,t,n){return oh(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function dh(e,t){let n=null;for(const i of e.fieldTransforms){const e=t.data.field(i.field),s=Yd(i.transform,e||null);null!=s&&(null===n&&(n=Ru.empty()),n.set(i.field,s))}return n||null}function hh(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Tc(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Xd&&t instanceof Xd||e instanceof Jd&&t instanceof Jd?Tc(e.elements,t.elements,xu):e instanceof eh&&t instanceof eh?xu(e.gt,t.gt):e instanceof Qd&&t instanceof Qd}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class fh extends ah{constructor(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class ph extends ah{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function mh(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const i=e.data.field(n);t.set(n,i)}}),t}function gh(e,t,n){const i=new Map;dc(e.length===n.length);for(let s=0;s<n.length;s++){const r=e[s],o=r.transform,a=t.data.field(r.field);i.set(r.field,Kd(o,a,n[s]))}return i}function yh(e,t,n){const i=new Map;for(const s of e){const e=s.transform,r=n.data.field(s.field);i.set(s.field,Gd(e,r,t))}return i}class vh extends ah{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class bh extends ah{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class xh{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const t=this.mutations[i];t.key.isEqual(e.key)&&ch(t,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=uh(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=uh(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Md();return this.mutations.forEach(i=>{const s=e.get(i.key),r=s.overlayedDocument;let o=this.applyToLocalView(r,s.mutatedFields);o=t.has(i.key)?null:o;const a=lh(r,o);null!==a&&n.set(i.key,a),r.isValidDocument()||r.convertToNoDocument(Ic.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),zd())}isEqual(e){return this.batchId===e.batchId&&Tc(this.mutations,e.mutations,(e,t)=>hh(e,t))&&Tc(this.baseMutations,e.baseMutations,(e,t)=>hh(e,t))}}class _h{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){dc(e.mutations.length===n.length);let i=Ld;const s=e.mutations;for(let r=0;r<s.length;r++)i=i.insert(s[r].key,n[r].version);return new _h(e,t,n,i)}}class wh{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class Ch{constructor(e,t){this.count=e,this.unchangedNames=t}}var Nh,kh;function Eh(e){switch(e){default:return uc();case fc.CANCELLED:case fc.UNKNOWN:case fc.DEADLINE_EXCEEDED:case fc.RESOURCE_EXHAUSTED:case fc.INTERNAL:case fc.UNAVAILABLE:case fc.UNAUTHENTICATED:return!1;case fc.INVALID_ARGUMENT:case fc.NOT_FOUND:case fc.ALREADY_EXISTS:case fc.PERMISSION_DENIED:case fc.FAILED_PRECONDITION:case fc.ABORTED:case fc.OUT_OF_RANGE:case fc.UNIMPLEMENTED:case fc.DATA_LOSS:return!0}}function Th(e){if(void 0===e)return ac("GRPC error has no .code"),fc.UNKNOWN;switch(e){case Nh.OK:return fc.OK;case Nh.CANCELLED:return fc.CANCELLED;case Nh.UNKNOWN:return fc.UNKNOWN;case Nh.DEADLINE_EXCEEDED:return fc.DEADLINE_EXCEEDED;case Nh.RESOURCE_EXHAUSTED:return fc.RESOURCE_EXHAUSTED;case Nh.INTERNAL:return fc.INTERNAL;case Nh.UNAVAILABLE:return fc.UNAVAILABLE;case Nh.UNAUTHENTICATED:return fc.UNAUTHENTICATED;case Nh.INVALID_ARGUMENT:return fc.INVALID_ARGUMENT;case Nh.NOT_FOUND:return fc.NOT_FOUND;case Nh.ALREADY_EXISTS:return fc.ALREADY_EXISTS;case Nh.PERMISSION_DENIED:return fc.PERMISSION_DENIED;case Nh.FAILED_PRECONDITION:return fc.FAILED_PRECONDITION;case Nh.ABORTED:return fc.ABORTED;case Nh.OUT_OF_RANGE:return fc.OUT_OF_RANGE;case Nh.UNIMPLEMENTED:return fc.UNIMPLEMENTED;case Nh.DATA_LOSS:return fc.DATA_LOSS;default:return uc()}}(kh=Nh||(Nh={}))[kh.OK=0]="OK",kh[kh.CANCELLED=1]="CANCELLED",kh[kh.UNKNOWN=2]="UNKNOWN",kh[kh.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",kh[kh.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",kh[kh.NOT_FOUND=5]="NOT_FOUND",kh[kh.ALREADY_EXISTS=6]="ALREADY_EXISTS",kh[kh.PERMISSION_DENIED=7]="PERMISSION_DENIED",kh[kh.UNAUTHENTICATED=16]="UNAUTHENTICATED",kh[kh.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",kh[kh.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",kh[kh.ABORTED=10]="ABORTED",kh[kh.OUT_OF_RANGE=11]="OUT_OF_RANGE",kh[kh.UNIMPLEMENTED=12]="UNIMPLEMENTED",kh[kh.INTERNAL=13]="INTERNAL",kh[kh.UNAVAILABLE=14]="UNAVAILABLE",kh[kh.DATA_LOSS=15]="DATA_LOSS";class Sh{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return Ih}static getOrCreateInstance(){return null===Ih&&(Ih=new Sh),Ih}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(t=>t(e))}}let Ih=null;function Ph(){return new TextEncoder}const jh=new ec([4294967295,4294967295],0);function Ah(e){const t=Ph().encode(e),n=new Zl;return n.update(t),new Uint8Array(n.digest())}function Dh(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),s=t.getUint32(8,!0),r=t.getUint32(12,!0);return[new ec([n,i],0),new ec([s,r],0)]}class Rh{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Mh("Invalid padding: ".concat(t));if(n<0)throw new Mh("Invalid hash count: ".concat(n));if(e.length>0&&0===this.hashCount)throw new Mh("Invalid hash count: ".concat(n));if(0===e.length&&0!==t)throw new Mh("Invalid padding when bitmap length is 0: ".concat(t));this.It=8*e.length-t,this.Tt=ec.fromNumber(this.It)}Et(e,t,n){let i=e.add(t.multiply(ec.fromNumber(n)));return 1===i.compare(jh)&&(i=new ec([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Tt).toNumber()}At(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;const t=Ah(e),[n,i]=Dh(t);for(let s=0;s<this.hashCount;s++){const e=this.Et(n,i,s);if(!this.At(e))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),r=new Rh(s,i,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.It)return;const t=Ah(e),[n,i]=Dh(t);for(let s=0;s<this.hashCount;s++){const e=this.Et(n,i,s);this.Rt(e)}}Rt(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Mh extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Oh{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Lh.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Oh(Ic.min(),i,new tu(Ec),Pd(),zd())}}class Lh{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Lh(n,t,zd(),zd(),zd())}}class Fh{constructor(e,t,n,i){this.Pt=e,this.removedTargetIds=t,this.key=n,this.bt=i}}class zh{constructor(e,t){this.targetId=e,this.Vt=t}}class Uh{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:lu.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class Vh{constructor(){this.St=0,this.Dt=qh(),this.Ct=lu.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=zd(),t=zd(),n=zd();return this.Dt.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:uc()}}),new Lh(this.Ct,this.xt,e,t,n)}Ft(){this.Nt=!1,this.Dt=qh()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class Bh{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=Pd(),this.zt=Hh(),this.Wt=new tu(Ec)}Ht(e){for(const t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(const t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,t=>{const n=this.Zt(t);switch(e.state){case 0:this.te(t)&&n.$t(e.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(e.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(t);break;case 3:this.te(t)&&(n.Kt(),n.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),n.$t(e.resumeToken));break;default:uc()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach((e,n)=>{this.te(n)&&t(n)})}ne(e){var t;const n=e.targetId,i=e.Vt.count,s=this.se(n);if(s){const r=s.target;if(cd(r))if(0===i){const e=new Rc(r.path);this.Yt(n,e,Ou.newNoDocument(e,Ic.min()))}else dc(1===i);else{const s=this.ie(n);if(s!==i){const i=this.re(e,s);if(0!==i){this.ee(n);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,e)}null===(t=Sh.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(e,t,n){var i,s,r,o,a,l;const c={localCacheCount:t,existenceFilterCount:n.count},u=n.unchangedNames;return u&&(c.bloomFilter={applied:0===e,hashCount:null!==(i=null==u?void 0:u.hashCount)&&void 0!==i?i:0,bitmapLength:null!==(o=null===(r=null===(s=null==u?void 0:u.bits)||void 0===s?void 0:s.bitmap)||void 0===r?void 0:r.length)&&void 0!==o?o:0,padding:null!==(l=null===(a=null==u?void 0:u.bits)||void 0===a?void 0:a.padding)&&void 0!==l?l:0}),c}(i,s,e.Vt))}}}}re(e,t){const{unchangedNames:n,count:i}=e.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:s="",padding:r=0},hashCount:o=0}=n;let a,l;try{a=hu(s).toUint8Array()}catch(e){if(e instanceof au)return lc("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{l=new Rh(a,r,o)}catch(e){return lc(e instanceof Mh?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===l.It?1:i!==t-this.oe(e.targetId,l)?2:0}oe(e,t){const n=this.Gt.getRemoteKeysForTarget(e);let i=0;return n.forEach(n=>{const s=this.Gt.ue(),r="projects/".concat(s.projectId,"/databases/").concat(s.database,"/documents/").concat(n.path.canonicalString());t.vt(r)||(this.Yt(e,n,null),i++)}),i}ce(e){const t=new Map;this.Qt.forEach((n,i)=>{const s=this.se(i);if(s){if(n.current&&cd(s.target)){const t=new Rc(s.target.path);null!==this.jt.get(t)||this.ae(i,t)||this.Yt(i,t,Ou.newNoDocument(t,e))}n.Mt&&(t.set(i,n.Ot()),n.Ft())}});let n=zd();this.zt.forEach((e,t)=>{let i=!0;t.forEachWhile(e=>{const t=this.se(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(i=!1,!1)}),i&&(n=n.add(e))}),this.jt.forEach((t,n)=>n.setReadTime(e));const i=new Oh(e,t,this.Wt,this.jt,n);return this.jt=Pd(),this.zt=Hh(),this.Wt=new tu(Ec),i}Jt(e,t){if(!this.te(e))return;const n=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,n),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,n){if(!this.te(e))return;const i=this.Zt(e);this.ae(e,t)?i.Bt(t,1):i.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),n&&(this.jt=this.jt.insert(t,n))}removeTarget(e){this.Qt.delete(e)}ie(e){const t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new Vh,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new su(Ec),this.zt=this.zt.insert(e,t)),t}te(e){const t=null!==this.se(e);return t||oc("WatchChangeAggregator","Detected inactive target",e),t}se(e){const t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new Vh),this.Gt.getRemoteKeysForTarget(e).forEach(t=>{this.Yt(e,t,null)})}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function Hh(){return new tu(Rc.comparator)}function qh(){return new tu(Rc.comparator)}const Wh={asc:"ASCENDING",desc:"DESCENDING"},Gh={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Kh={and:"AND",or:"OR"};class Yh{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Qh(e,t){return e.useProto3Json||Gc(t)?t:{value:t}}function Xh(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function $h(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Jh(e,t){return Xh(e,t.toTimestamp())}function Zh(e){return dc(!!e),Ic.fromTimestamp(function(e){const t=uu(e);return new Sc(t.seconds,t.nanos)}(e))}function ef(e,t){return function(e){return new jc(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function tf(e){const t=jc.fromString(e);return dc(wf(t)),t}function nf(e,t){return ef(e.databaseId,t.path)}function sf(e,t){const n=tf(t);if(n.get(1)!==e.databaseId.projectId)throw new pc(fc.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new pc(fc.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Rc(lf(n))}function rf(e,t){return ef(e.databaseId,t)}function of(e){const t=tf(e);return 4===t.length?jc.emptyPath():lf(t)}function af(e){return new jc(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function lf(e){return dc(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function cf(e,t,n){return{name:nf(e,t),fields:n.value.mapValue.fields}}function uf(e,t){let n;if(t instanceof fh)n={update:cf(e,t.key,t.value)};else if(t instanceof vh)n={delete:nf(e,t.key)};else if(t instanceof ph)n={update:cf(e,t.key,t.data),updateMask:_f(t.fieldMask)};else{if(!(t instanceof bh))return uc();n={verify:nf(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof Qd)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Xd)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Jd)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof eh)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw uc()}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Jh(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:uc()}(e,t.precondition)),n}function df(e,t){return{documents:[rf(e,t.path)]}}function hf(e,t){const n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(n.parent=rf(e,i),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=rf(e,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const s=function(e){if(0!==e.length)return xf(qu.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const r=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:vf(e.field),direction:mf(e.dir)}}(e))}(t.orderBy);r&&(n.structuredQuery.orderBy=r);const o=Qh(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function ff(e){let t=of(e.parent);const n=e.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){dc(1===i);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let r=[];n.where&&(r=function(e){const t=pf(e);return t instanceof qu&&Gu(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>function(e){return new Uu(bf(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Gc(t)?null:t}(n.limit));let l=null;n.startAt&&(l=function(e){const t=!!e.before,n=e.values||[];return new Lu(n,t)}(n.startAt));let c=null;return n.endAt&&(c=function(e){const t=!e.before,n=e.values||[];return new Lu(n,t)}(n.endAt)),dd(t,s,o,r,a,"F",l,c)}function pf(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=bf(e.unaryFilter.field);return Hu.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=bf(e.unaryFilter.field);return Hu.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=bf(e.unaryFilter.field);return Hu.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=bf(e.unaryFilter.field);return Hu.create(s,"!=",{nullValue:"NULL_VALUE"});default:return uc()}}(e):void 0!==e.fieldFilter?function(e){return Hu.create(bf(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return uc()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return qu.create(e.compositeFilter.filters.map(e=>pf(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return uc()}}(e.compositeFilter.op))}(e):uc()}function mf(e){return Wh[e]}function gf(e){return Gh[e]}function yf(e){return Kh[e]}function vf(e){return{fieldPath:e.canonicalString()}}function bf(e){return Dc.fromServerFormat(e.fieldPath)}function xf(e){return e instanceof Hu?function(e){if("=="===e.op){if(Pu(e.value))return{unaryFilter:{field:vf(e.field),op:"IS_NAN"}};if(Iu(e.value))return{unaryFilter:{field:vf(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Pu(e.value))return{unaryFilter:{field:vf(e.field),op:"IS_NOT_NAN"}};if(Iu(e.value))return{unaryFilter:{field:vf(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:vf(e.field),op:gf(e.op),value:e.value}}}(e):e instanceof qu?function(e){const t=e.getFilters().map(e=>xf(e));return 1===t.length?t[0]:{compositeFilter:{op:yf(e.op),filters:t}}}(e):uc()}function _f(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function wf(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Cf{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ic.min(),r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Ic.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:lu.EMPTY_BYTE_STRING,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Cf(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Cf(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Cf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Cf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Nf{constructor(e){this.fe=e}}function kf(e){const t=ff({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?xd(t,t.limit,"L"):t}class Ef{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(du(e.integerValue));else if("doubleValue"in e){const n=du(e.doubleValue);isNaN(n)?this.ye(t,13):(this.ye(t,15),Kc(n)?t.pe(0):t.pe(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ye(t,20),"string"==typeof n?t.Ie(n):(t.Ie("".concat(n.seconds||"")),t.pe(n.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(hu(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ye(t,45),t.pe(n.latitude||0),t.pe(n.longitude||0)}else"mapValue"in e?Du(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):uc()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){const n=e.fields||{};this.ye(t,55);for(const i of Object.keys(n))this.Te(i,t),this.me(n[i],t)}Pe(e,t){const n=e.values||[];this.ye(t,50);for(const i of n)this.me(i,t)}ve(e,t){this.ye(t,37),Rc.fromName(e).path.forEach(e=>{this.ye(t,60),this.be(e,t)})}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}Ef.Ve=new Ef;class Tf{constructor(){this.rn=new Sf}addToCollectionParentIndex(e,t){return this.rn.add(t),Hc.resolve()}getCollectionParents(e,t){return Hc.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return Hc.resolve()}deleteFieldIndex(e,t){return Hc.resolve()}getDocumentsMatchingTarget(e,t){return Hc.resolve(null)}getIndexType(e,t){return Hc.resolve(0)}getFieldIndexes(e,t){return Hc.resolve([])}getNextCollectionGroupToUpdate(e){return Hc.resolve(null)}getMinOffset(e,t){return Hc.resolve(Fc.min())}getMinOffsetFromCollectionGroup(e,t){return Hc.resolve(Fc.min())}updateCollectionGroup(e,t,n){return Hc.resolve()}updateIndexEntries(e,t){return Hc.resolve()}}class Sf{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new su(jc.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new su(jc.comparator)).toArray()}}new Uint8Array(0);class If{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new If(e,If.DEFAULT_COLLECTION_PERCENTILE,If.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}If.DEFAULT_COLLECTION_PERCENTILE=10,If.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,If.DEFAULT=new If(41943040,If.DEFAULT_COLLECTION_PERCENTILE,If.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),If.DISABLED=new If(-1,0,0);class Pf{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new Pf(0)}static Mn(){return new Pf(-1)}}class jf{constructor(){this.changes=new Sd(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ou.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Hc.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Af{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Df{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&uh(n.mutation,e,ou.empty(),Sc.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,zd()).next(()=>t))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:zd();const i=Rd();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(e=>{let t=Ad();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=Rd();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,zd()))}populateOverlays(e,t,n){const i=[];return n.forEach(e=>{t.has(e)||i.push(e)}),this.documentOverlayCache.getOverlays(e,i).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,i){let s=Pd();const r=Od(),o=Od();return t.forEach((e,t)=>{const o=n.get(t.key);i.has(t.key)&&(void 0===o||o.mutation instanceof ph)?s=s.insert(t.key,t):void 0!==o?(r.set(t.key,o.mutation.getFieldMask()),uh(o.mutation,t,o.mutation.getFieldMask(),Sc.now())):r.set(t.key,ou.empty())}),this.recalculateAndSaveOverlays(e,s).next(e=>(e.forEach((e,t)=>r.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new Af(t,null!==(n=r.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(e,t){const n=Od();let i=new tu((e,t)=>e-t),s=zd();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const s of e)s.keys().forEach(e=>{const r=t.get(e);if(null===r)return;let o=n.get(e)||ou.empty();o=s.applyToLocalView(r,o),n.set(e,o);const a=(i.get(s.batchId)||zd()).add(e);i=i.insert(s.batchId,a)})}).next(()=>{const r=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,l=i.value,c=Md();l.forEach(e=>{if(!s.has(e)){const i=lh(t.get(e),n.get(e));null!==i&&c.set(e,i),s=s.add(e)}}),r.push(this.documentOverlayCache.saveOverlays(e,a,c))}return Hc.waitFor(r)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n){return function(e){return Rc.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):gd(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const r=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):Hc.resolve(Rd());let o=-1,a=s;return r.next(t=>Hc.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(t)?Hc.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,s)).next(()=>this.computeViews(e,a,t,zd())).next(e=>({batchId:o,changes:Dd(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Rc(t)).next(e=>{let t=Ad();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n){const i=t.collectionGroup;let s=Ad();return this.indexManager.getCollectionParents(e,i).next(r=>Hc.forEach(r,r=>{const o=function(e,t){return new ud(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,r.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i))).next(e=>{i.forEach((t,n)=>{const i=n.getKey();null===e.get(i)&&(e=e.insert(i,Ou.newInvalidDocument(i)))});let n=Ad();return e.forEach((e,s)=>{const r=i.get(e);void 0!==r&&uh(r.mutation,s,ou.empty(),Sc.now()),Nd(t,s)&&(n=n.insert(e,s))}),n})}}class Rf{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return Hc.resolve(this.cs.get(t))}saveBundleMetadata(e,t){var n;return this.cs.set(t.id,{id:(n=t).id,version:n.version,createTime:Zh(n.createTime)}),Hc.resolve()}getNamedQuery(e,t){return Hc.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,function(e){return{name:e.name,query:kf(e.bundledQuery),readTime:Zh(e.readTime)}}(t)),Hc.resolve()}}class Mf{constructor(){this.overlays=new tu(Rc.comparator),this.ls=new Map}getOverlay(e,t){return Hc.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Rd();return Hc.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,i)=>{this.we(e,t,i)}),Hc.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.ls.get(n);return void 0!==i&&(i.forEach(e=>this.overlays=this.overlays.remove(e)),this.ls.delete(n)),Hc.resolve()}getOverlaysForCollection(e,t,n){const i=Rd(),s=t.length+1,r=new Rc(t.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const e=o.getNext().value,r=e.getKey();if(!t.isPrefixOf(r.path))break;r.path.length===s&&e.largestBatchId>n&&i.set(e.getKey(),e)}return Hc.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new tu((e,t)=>e-t);const r=this.overlays.getIterator();for(;r.hasNext();){const e=r.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=Rd(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Rd(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=i)););return Hc.resolve(o)}we(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const e=this.ls.get(i.largestBatchId).delete(n.key);this.ls.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new wh(t,n));let s=this.ls.get(t);void 0===s&&(s=zd(),this.ls.set(t,s)),this.ls.set(t,s.add(n.key))}}class Of{constructor(){this.fs=new su(Lf.ds),this.ws=new su(Lf._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){const n=new Lf(e,t);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.ys(new Lf(e,t))}ps(e,t){e.forEach(e=>this.removeReference(e,t))}Is(e){const t=new Rc(new jc([])),n=new Lf(t,e),i=new Lf(t,e+1),s=[];return this.ws.forEachInRange([n,i],e=>{this.ys(e),s.push(e.key)}),s}Ts(){this.fs.forEach(e=>this.ys(e))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const t=new Rc(new jc([])),n=new Lf(t,e),i=new Lf(t,e+1);let s=zd();return this.ws.forEachInRange([n,i],e=>{s=s.add(e.key)}),s}containsKey(e){const t=new Lf(e,0),n=this.fs.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Lf{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return Rc.comparator(e.key,t.key)||Ec(e.As,t.As)}static _s(e,t){return Ec(e.As,t.As)||Rc.comparator(e.key,t.key)}}class Ff{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new su(Lf.ds)}checkEmpty(e){return Hc.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new xh(s,t,n,i);this.mutationQueue.push(r);for(const o of i)this.Rs=this.Rs.add(new Lf(o.key,s)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return Hc.resolve(r)}lookupMutationBatch(e,t){return Hc.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.bs(n),s=i<0?0:i;return Hc.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Hc.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return Hc.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Lf(t,0),i=new Lf(t,Number.POSITIVE_INFINITY),s=[];return this.Rs.forEachInRange([n,i],e=>{const t=this.Ps(e.As);s.push(t)}),Hc.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new su(Ec);return t.forEach(e=>{const t=new Lf(e,0),i=new Lf(e,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([t,i],e=>{n=n.add(e.As)})}),Hc.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;Rc.isDocumentKey(s)||(s=s.child(""));const r=new Lf(new Rc(s),0);let o=new su(Ec);return this.Rs.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(o=o.add(e.As)),!0)},r),Hc.resolve(this.Vs(o))}Vs(e){const t=[];return e.forEach(e=>{const n=this.Ps(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){dc(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return Hc.forEach(t.mutations,i=>{const s=new Lf(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Rs=n})}Cn(e){}containsKey(e,t){const n=new Lf(t,0),i=this.Rs.firstAfterOrEqual(n);return Hc.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,Hc.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){const t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class zf{constructor(e){this.Ds=e,this.docs=new tu(Rc.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,r=this.Ds(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Hc.resolve(n?n.document.mutableCopy():Ou.newInvalidDocument(t))}getEntries(e,t){let n=Pd();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Ou.newInvalidDocument(e))}),Hc.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Pd();const r=t.path,o=new Rc(r.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!r.isPrefixOf(e.path))break;e.path.length>r.length+1||zc(Lc(o),n)<=0||(i.has(o.key)||Nd(t,o))&&(s=s.insert(o.key,o.mutableCopy()))}return Hc.resolve(s)}getAllFromCollectionGroup(e,t,n,i){uc()}Cs(e,t){return Hc.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Uf(this)}getSize(e){return Hc.resolve(this.size)}}class Uf extends jf{constructor(e){super(),this.os=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.os.addEntry(e,i)):this.os.removeEntry(n)}),Hc.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class Vf{constructor(e){this.persistence=e,this.xs=new Sd(e=>ad(e),ld),this.lastRemoteSnapshotVersion=Ic.min(),this.highestTargetId=0,this.Ns=0,this.ks=new Of,this.targetCount=0,this.Ms=Pf.kn()}forEachTarget(e,t){return this.xs.forEach((e,n)=>t(n)),Hc.resolve()}getLastRemoteSnapshotVersion(e){return Hc.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Hc.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),Hc.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ns&&(this.Ns=t),Hc.resolve()}Fn(e){this.xs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ms=new Pf(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,Hc.resolve()}updateTargetData(e,t){return this.Fn(t),Hc.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,Hc.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.xs.forEach((r,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.xs.delete(r),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),Hc.waitFor(s).next(()=>i)}getTargetCount(e){return Hc.resolve(this.targetCount)}getTargetData(e,t){const n=this.xs.get(t)||null;return Hc.resolve(n)}addMatchingKeys(e,t,n){return this.ks.gs(t,n),Hc.resolve()}removeMatchingKeys(e,t,n){this.ks.ps(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(t=>{s.push(i.markPotentiallyOrphaned(e,t))}),Hc.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),Hc.resolve()}getMatchingKeysForTargetId(e,t){const n=this.ks.Es(t);return Hc.resolve(n)}containsKey(e,t){return Hc.resolve(this.ks.containsKey(t))}}class Bf{constructor(e,t){this.$s={},this.overlays={},this.Os=new Wc(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new Vf(this),this.indexManager=new Tf,this.remoteDocumentCache=function(e){return new zf(e)}(e=>this.referenceDelegate.Ls(e)),this.serializer=new Nf(t),this.qs=new Rf(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Mf,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.$s[e.toKey()];return n||(n=new Ff(t,this.referenceDelegate),this.$s[e.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,n){oc("MemoryPersistence","Starting transaction:",e);const i=new Hf(this.Os.next());return this.referenceDelegate.Us(),n(i).next(e=>this.referenceDelegate.Ks(i).next(()=>e)).toPromise().then(e=>(i.raiseOnCommittedEvent(),e))}Gs(e,t){return Hc.or(Object.values(this.$s).map(n=>()=>n.containsKey(e,t)))}}class Hf extends Vc{constructor(e){super(),this.currentSequenceNumber=e}}class qf{constructor(e){this.persistence=e,this.Qs=new Of,this.js=null}static zs(e){return new qf(e)}get Ws(){if(this.js)return this.js;throw uc()}addReference(e,t,n){return this.Qs.addReference(n,t),this.Ws.delete(n.toString()),Hc.resolve()}removeReference(e,t,n){return this.Qs.removeReference(n,t),this.Ws.add(n.toString()),Hc.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),Hc.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach(e=>this.Ws.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Ws.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Us(){this.js=new Set}Ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Hc.forEach(this.Ws,n=>{const i=Rc.fromPath(n);return this.Hs(e,i).next(e=>{e||t.removeEntry(i,Ic.min())})}).next(()=>(this.js=null,t.apply(e)))}updateLimboDocument(e,t){return this.Hs(e,t).next(e=>{e?this.Ws.delete(t.toString()):this.Ws.add(t.toString())})}Ls(e){return 0}Hs(e,t){return Hc.or([()=>Hc.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class Wf{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Fi=n,this.Bi=i}static Li(e,t){let n=zd(),i=zd();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Wf(e,t.fromCache,n,i)}}class Gf{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,n,i){return this.Ki(e,t).next(s=>s||this.Gi(e,t,i,n)).next(n=>n||this.Qi(e,t))}Ki(e,t){if(fd(t))return Hc.resolve(null);let n=vd(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=xd(t,null,"F"),n=vd(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const s=zd(...i);return this.Ui.getDocuments(e,s).next(i=>this.indexManager.getMinOffset(e,n).next(n=>{const r=this.ji(t,i);return this.zi(t,r,s,n.readTime)?this.Ki(e,xd(t,null,"F")):this.Wi(e,r,t,n)}))})))}Gi(e,t,n,i){return fd(t)||i.isEqual(Ic.min())?this.Qi(e,t):this.Ui.getDocuments(e,n).next(s=>{const r=this.ji(t,s);return this.zi(t,r,n,i)?this.Qi(e,t):(rc()<=ue.DEBUG&&oc("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Cd(t)),this.Wi(e,r,t,Oc(i,-1)))})}ji(e,t){let n=new su(Ed(e));return t.forEach((t,i)=>{Nd(e,i)&&(n=n.add(i))}),n}zi(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Qi(e,t){return rc()<=ue.DEBUG&&oc("QueryEngine","Using full collection scan to execute query:",Cd(t)),this.Ui.getDocumentsMatchingQuery(e,t,Fc.min())}Wi(e,t,n,i){return this.Ui.getDocumentsMatchingQuery(e,n,i).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class Kf{constructor(e,t,n,i){this.persistence=e,this.Hi=t,this.serializer=i,this.Ji=new tu(Ec),this.Yi=new Sd(e=>ad(e),ld),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(n)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Df(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ji))}}function Yf(e,t,n,i){return new Kf(e,t,n,i)}async function Qf(e,t){const n=hc(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let i;return n.mutationQueue.getAllMutationBatches(e).next(s=>(i=s,n.tr(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const s=[],r=[];let o=zd();for(const e of i){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next(e=>({er:e,removedBatchIds:s,addedBatchIds:r}))})})}function Xf(e){const t=hc(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Bs.getLastRemoteSnapshotVersion(e))}function $f(e,t,n){let i=zd(),s=zd();return n.forEach(e=>i=i.add(e)),t.getEntries(e,i).next(e=>{let i=Pd();return n.forEach((n,r)=>{const o=e.get(n);r.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),r.isNoDocument()&&r.version.isEqual(Ic.min())?(t.removeEntry(n,r.readTime),i=i.insert(n,r)):!o.isValidDocument()||r.version.compareTo(o.version)>0||0===r.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(r),i=i.insert(n,r)):oc("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)}),{nr:i,sr:s}})}function Jf(e,t){const n=hc(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function Zf(e,t){const n=hc(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let i;return n.Bs.getTargetData(e,t).next(s=>s?(i=s,Hc.resolve(i)):n.Bs.allocateTargetId(e).next(s=>(i=new Cf(t,s,"TargetPurposeListen",e.currentSequenceNumber),n.Bs.addTargetData(e,i).next(()=>i))))}).then(e=>{const i=n.Ji.get(e.targetId);return(null===i||e.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(e.targetId,e),n.Yi.set(t,e.targetId)),e})}async function ep(e,t,n){const i=hc(e),s=i.Ji.get(t),r=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",r,e=>i.persistence.referenceDelegate.removeTarget(e,s))}catch(e){if(!qc(e))throw e;oc("LocalStore","Failed to update sequence numbers for target ".concat(t,": ").concat(e))}i.Ji=i.Ji.remove(t),i.Yi.delete(s.target)}function tp(e,t,n){const i=hc(e);let s=Ic.min(),r=zd();return i.persistence.runTransaction("Execute query","readonly",e=>function(e,t,n){const i=hc(e),s=i.Yi.get(n);return void 0!==s?Hc.resolve(i.Ji.get(s)):i.Bs.getTargetData(t,n)}(i,e,vd(t)).next(t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,i.Bs.getMatchingKeysForTargetId(e,t.targetId).next(e=>{r=e})}).next(()=>i.Hi.getDocumentsMatchingQuery(e,t,n?s:Ic.min(),n?r:zd())).next(e=>(np(i,kd(t),e),{documents:e,ir:r})))}function np(e,t,n){let i=e.Xi.get(t)||Ic.min();n.forEach((e,t)=>{t.readTime.compareTo(i)>0&&(i=t.readTime)}),e.Xi.set(t,i)}class ip{constructor(){this.activeTargetIds=Vd()}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class sp{constructor(){this.Hr=new ip,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,n){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new ip,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class rp{Yr(e){}shutdown(){}}class op{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){oc("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){oc("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ap=null;function lp(){return null===ap?ap=268435456+Math.round(2147483648*Math.random()):ap++,"0x"+ap.toString(16)}const cp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class up{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}const dp="WebChannelConnection";class hp extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.mo=t+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,n,i,s){const r=lp(),o=this.To(e,t);oc("RestConnection","Sending RPC '".concat(e,"' ").concat(r,":"),o,n);const a={};return this.Eo(a,i,s),this.Ao(e,o,a,n).then(t=>(oc("RestConnection","Received RPC '".concat(e,"' ").concat(r,": "),t),t),t=>{throw lc("RestConnection","RPC '".concat(e,"' ").concat(r," failed with error: "),t,"url: ",o,"request:",n),t})}vo(e,t,n,i,s,r){return this.Io(e,t,n,i,s)}Eo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+ic,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}To(e,t){const n=cp[e];return"".concat(this.mo,"/v1/").concat(t,":").concat(n)}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,n,i){const s=lp();return new Promise((r,o)=>{const a=new Jl;a.setWithCredentials(!0),a.listenOnce(Kl.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Gl.NO_ERROR:const t=a.getResponseJson();oc(dp,"XHR for RPC '".concat(e,"' ").concat(s," received:"),JSON.stringify(t)),r(t);break;case Gl.TIMEOUT:oc(dp,"RPC '".concat(e,"' ").concat(s," timed out")),o(new pc(fc.DEADLINE_EXCEEDED,"Request time out"));break;case Gl.HTTP_ERROR:const n=a.getStatus();if(oc(dp,"RPC '".concat(e,"' ").concat(s," failed with status:"),n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(fc).indexOf(t)>=0?t:fc.UNKNOWN}(t.status);o(new pc(e,t.message))}else o(new pc(fc.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new pc(fc.UNAVAILABLE,"Connection failed."));break;default:uc()}}finally{oc(dp,"RPC '".concat(e,"' ").concat(s," completed."))}});const l=JSON.stringify(i);oc(dp,"RPC '".concat(e,"' ").concat(s," sending request:"),i),a.send(t,"POST",l,n,15)})}Ro(e,t,n){const i=lp(),s=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=ql(),o=Wl(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.xmlHttpFactory=new Xl({})),this.Eo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const c=s.join("");oc(dp,"Creating RPC '".concat(e,"' stream ").concat(i,": ").concat(c),a);const u=r.createWebChannel(c,a);let d=!1,h=!1;const f=new up({ro:t=>{h?oc(dp,"Not sending because RPC '".concat(e,"' stream ").concat(i," is closed:"),t):(d||(oc(dp,"Opening RPC '".concat(e,"' stream ").concat(i," transport.")),u.open(),d=!0),oc(dp,"RPC '".concat(e,"' stream ").concat(i," sending:"),t),u.send(t))},oo:()=>u.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(u,$l.EventType.OPEN,()=>{h||oc(dp,"RPC '".concat(e,"' stream ").concat(i," transport opened."))}),p(u,$l.EventType.CLOSE,()=>{h||(h=!0,oc(dp,"RPC '".concat(e,"' stream ").concat(i," transport closed")),f.wo())}),p(u,$l.EventType.ERROR,t=>{h||(h=!0,lc(dp,"RPC '".concat(e,"' stream ").concat(i," transport errored:"),t),f.wo(new pc(fc.UNAVAILABLE,"The operation could not be completed")))}),p(u,$l.EventType.MESSAGE,t=>{var n;if(!h){const s=t.data[0];dc(!!s);const r=s,o=r.error||(null===(n=r[0])||void 0===n?void 0:n.error);if(o){oc(dp,"RPC '".concat(e,"' stream ").concat(i," received error:"),o);const t=o.status;let n=function(e){const t=Nh[e];if(void 0!==t)return Th(t)}(t),s=o.message;void 0===n&&(n=fc.INTERNAL,s="Unknown error status: "+t+" with message "+o.message),h=!0,f.wo(new pc(n,s)),u.close()}else oc(dp,"RPC '".concat(e,"' stream ").concat(i," received:"),s),f._o(s)}}),p(o,Yl.STAT_EVENT,t=>{t.stat===Ql.PROXY?oc(dp,"RPC '".concat(e,"' stream ").concat(i," detected buffering proxy")):t.stat===Ql.NOPROXY&&oc(dp,"RPC '".concat(e,"' stream ").concat(i," detected no buffering proxy"))}),setTimeout(()=>{f.fo()},0),f}}function fp(){return"undefined"!=typeof document?document:null}function pp(e){return new Yh(e,!0)}class mp{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.ii=e,this.timerId=t,this.Po=n,this.bo=i,this.Vo=s,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const t=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),i=Math.max(0,t-n);i>0&&oc("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.So," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.Do=this.ii.enqueueAfterDelay(this.timerId,i,()=>(this.Co=Date.now(),e())),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class gp{constructor(e,t,n,i,s,r,o,a){this.ii=e,this.$o=n,this.Oo=i,this.connection=s,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new mp(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,()=>this.zo()))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,t){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==e?this.qo.reset():t&&t.code===fc.RESOURCE_EXHAUSTED?(ac(t.toString()),ac("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):t&&t.code===fc.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(t)}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[n,i]=e;this.Fo===t&&this.Zo(n,i)},t=>{e(()=>{const e=new pc(fc.UNKNOWN,"Fetching auth token failed: "+t.message);return this.tu(e)})})}Zo(e,t){const n=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo(()=>{n(()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,()=>(this.Ko()&&(this.state=3),Promise.resolve())),this.listener.uo()))}),this.stream.ao(e=>{n(()=>this.tu(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Go(){this.state=5,this.qo.No(async()=>{this.state=0,this.start()})}tu(e){return oc("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget(()=>this.Fo===e?t():(oc("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class yp extends gp{constructor(e,t,n,i,s,r){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,r),this.serializer=s}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const i=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:uc()}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],r=function(e,t){return e.useProto3Json?(dc(void 0===t||"string"==typeof t),lu.fromBase64String(t||"")):(dc(void 0===t||t instanceof Uint8Array),lu.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?fc.UNKNOWN:Th(e.code);return new pc(t,e.message||"")}(o);n=new Uh(i,s,r,a||null)}else if("documentChange"in t){t.documentChange;const i=t.documentChange;i.document,i.document.name,i.document.updateTime;const s=sf(e,i.document.name),r=Zh(i.document.updateTime),o=i.document.createTime?Zh(i.document.createTime):Ic.min(),a=new Ru({mapValue:{fields:i.document.fields}}),l=Ou.newFoundDocument(s,r,o,a),c=i.targetIds||[],u=i.removedTargetIds||[];n=new Fh(c,u,l.key,l)}else if("documentDelete"in t){t.documentDelete;const i=t.documentDelete;i.document;const s=sf(e,i.document),r=i.readTime?Zh(i.readTime):Ic.min(),o=Ou.newNoDocument(s,r),a=i.removedTargetIds||[];n=new Fh([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const i=t.documentRemove;i.document;const s=sf(e,i.document),r=i.removedTargetIds||[];n=new Fh([],r,s,null)}else{if(!("filter"in t))return uc();{t.filter;const e=t.filter;e.targetId;const{count:i=0,unchangedNames:s}=e,r=new Ch(i,s),o=e.targetId;n=new zh(o,r)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Ic.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Ic.min():t.readTime?Zh(t.readTime):Ic.min()}(e);return this.listener.nu(t,n)}su(e){const t={};t.database=af(this.serializer),t.addTarget=function(e,t){let n;const i=t.target;if(n=cd(i)?{documents:df(e,i)}:{query:hf(e,i)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=$h(e,t.resumeToken);const i=Qh(e,t.expectedCount);null!==i&&(n.expectedCount=i)}else if(t.snapshotVersion.compareTo(Ic.min())>0){n.readTime=Xh(e,t.snapshotVersion.toTimestamp());const i=Qh(e,t.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return uc()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Wo(t)}iu(e){const t={};t.database=af(this.serializer),t.removeTarget=e,this.Wo(t)}}class vp extends gp{constructor(e,t,n,i,s,r){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,r),this.serializer=s,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(dc(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const t=function(e,t){return e&&e.length>0?(dc(void 0!==t),e.map(e=>function(e,t){let n=e.updateTime?Zh(e.updateTime):Zh(t);return n.isEqual(Ic.min())&&(n=Zh(t)),new sh(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=Zh(e.commitTime);return this.listener.cu(n,t)}return dc(!e.writeResults||0===e.writeResults.length),this.ru=!0,this.listener.au()}hu(){const e={};e.database=af(this.serializer),this.Wo(e)}uu(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>uf(this.serializer,e))};this.Wo(t)}}class bp extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.lu=!1}fu(){if(this.lu)throw new pc(fc.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(i=>{let[s,r]=i;return this.connection.Io(e,t,n,s,r)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===fc.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new pc(fc.UNKNOWN,e.toString())})}vo(e,t,n,i){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(s=>{let[r,o]=s;return this.connection.vo(e,t,n,r,o,i)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===fc.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new pc(fc.UNKNOWN,e.toString())})}terminate(){this.lu=!0}}class xp{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve())))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.mu?(ac(t),this.mu=!1):oc("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class _p{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=s,this.Pu.Yr(e=>{n.enqueueAndForget(async()=>{Pp(this)&&(oc("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=hc(e);t.vu.add(4),await Cp(t),t.bu.set("Unknown"),t.vu.delete(4),await wp(t)}(this))})}),this.bu=new xp(n,i)}}async function wp(e){if(Pp(e))for(const t of e.Ru)await t(!0)}async function Cp(e){for(const t of e.Ru)await t(!1)}function Np(e,t){const n=hc(e);n.Au.has(t.targetId)||(n.Au.set(t.targetId,t),Ip(n)?Sp(n):Yp(n).Ko()&&Ep(n,t))}function kp(e,t){const n=hc(e),i=Yp(n);n.Au.delete(t),i.Ko()&&Tp(n,t),0===n.Au.size&&(i.Ko()?i.jo():Pp(n)&&n.bu.set("Unknown"))}function Ep(e,t){if(e.Vu.qt(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Ic.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Yp(e).su(t)}function Tp(e,t){e.Vu.qt(t),Yp(e).iu(t)}function Sp(e){e.Vu=new Bh({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),le:t=>e.Au.get(t)||null,ue:()=>e.datastore.serializer.databaseId}),Yp(e).start(),e.bu.gu()}function Ip(e){return Pp(e)&&!Yp(e).Uo()&&e.Au.size>0}function Pp(e){return 0===hc(e).vu.size}function jp(e){e.Vu=void 0}async function Ap(e){e.Au.forEach((t,n)=>{Ep(e,t)})}async function Dp(e,t){jp(e),Ip(e)?(e.bu.Iu(t),Sp(e)):e.bu.set("Unknown")}async function Rp(e,t,n){if(e.bu.set("Online"),t instanceof Uh&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const i of t.targetIds)e.Au.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e.Au.delete(i),e.Vu.removeTarget(i))}(e,t)}catch(n){oc("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Mp(e,n)}else if(t instanceof Fh?e.Vu.Ht(t):t instanceof zh?e.Vu.ne(t):e.Vu.Xt(t),!n.isEqual(Ic.min()))try{const t=await Xf(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Vu.ce(t);return n.targetChanges.forEach((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const s=e.Au.get(i);s&&e.Au.set(i,s.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const i=e.Au.get(t);if(!i)return;e.Au.set(t,i.withResumeToken(lu.EMPTY_BYTE_STRING,i.snapshotVersion)),Tp(e,t);const s=new Cf(i.target,t,n,i.sequenceNumber);Ep(e,s)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){oc("RemoteStore","Failed to raise snapshot:",t),await Mp(e,t)}}async function Mp(e,t,n){if(!qc(t))throw t;e.vu.add(1),await Cp(e),e.bu.set("Offline"),n||(n=()=>Xf(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{oc("RemoteStore","Retrying IndexedDB access"),await n(),e.vu.delete(1),await wp(e)})}function Op(e,t){return t().catch(n=>Mp(e,n,t))}async function Lp(e){const t=hc(e),n=Qp(t);let i=t.Eu.length>0?t.Eu[t.Eu.length-1].batchId:-1;for(;Fp(t);)try{const e=await Jf(t.localStore,i);if(null===e){0===t.Eu.length&&n.jo();break}i=e.batchId,zp(t,e)}catch(e){await Mp(t,e)}Up(t)&&Vp(t)}function Fp(e){return Pp(e)&&e.Eu.length<10}function zp(e,t){e.Eu.push(t);const n=Qp(e);n.Ko()&&n.ou&&n.uu(t.mutations)}function Up(e){return Pp(e)&&!Qp(e).Uo()&&e.Eu.length>0}function Vp(e){Qp(e).start()}async function Bp(e){Qp(e).hu()}async function Hp(e){const t=Qp(e);for(const n of e.Eu)t.uu(n.mutations)}async function qp(e,t,n){const i=e.Eu.shift(),s=_h.from(i,t,n);await Op(e,()=>e.remoteSyncer.applySuccessfulWrite(s)),await Lp(e)}async function Wp(e,t){t&&Qp(e).ou&&await async function(e,t){if(Eh(n=t.code)&&n!==fc.ABORTED){const n=e.Eu.shift();Qp(e).Qo(),await Op(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await Lp(e)}var n}(e,t),Up(e)&&Vp(e)}async function Gp(e,t){const n=hc(e);n.asyncQueue.verifyOperationInProgress(),oc("RemoteStore","RemoteStore received new credentials");const i=Pp(n);n.vu.add(3),await Cp(n),i&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.vu.delete(3),await wp(n)}async function Kp(e,t){const n=hc(e);t?(n.vu.delete(2),await wp(n)):t||(n.vu.add(2),await Cp(n),n.bu.set("Unknown"))}function Yp(e){return e.Su||(e.Su=function(e,t,n){const i=hc(e);return i.fu(),new yp(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{uo:Ap.bind(null,e),ao:Dp.bind(null,e),nu:Rp.bind(null,e)}),e.Ru.push(async t=>{t?(e.Su.Qo(),Ip(e)?Sp(e):e.bu.set("Unknown")):(await e.Su.stop(),jp(e))})),e.Su}function Qp(e){return e.Du||(e.Du=function(e,t,n){const i=hc(e);return i.fu(),new vp(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{uo:Bp.bind(null,e),ao:Wp.bind(null,e),au:Hp.bind(null,e),cu:qp.bind(null,e)}),e.Ru.push(async t=>{t?(e.Du.Qo(),await Lp(e)):(await e.Du.stop(),e.Eu.length>0&&(oc("RemoteStore","Stopping write stream with ".concat(e.Eu.length," pending writes")),e.Eu=[]))})),e.Du}class Xp{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new mc,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,i,s){const r=Date.now()+n,o=new Xp(e,t,r,i,s);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new pc(fc.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function $p(e,t){if(ac("AsyncQueue","".concat(t,": ").concat(e)),qc(e))return new pc(fc.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class Jp{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Rc.comparator(t.key,n.key):(e,t)=>Rc.comparator(e.key,t.key),this.keyedMap=Ad(),this.sortedSet=new tu(this.comparator)}static emptySet(e){return new Jp(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Jp))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Jp;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Zp{constructor(){this.Cu=new tu(Rc.comparator)}track(e){const t=e.doc.key,n=this.Cu.get(t);n?0!==e.type&&3===n.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==n.type?this.Cu=this.Cu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Cu=this.Cu.remove(t):1===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):uc():this.Cu=this.Cu.insert(t,e)}xu(){const e=[];return this.Cu.inorderTraversal((t,n)=>{e.push(n)}),e}}class em{constructor(e,t,n,i,s,r,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,i,s){const r=[];return t.forEach(e=>{r.push({type:0,doc:e})}),new em(e,t,Jp.emptySet(t),r,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&_d(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class tm{constructor(){this.Nu=void 0,this.listeners=[]}}class nm{constructor(){this.queries=new Sd(e=>wd(e),_d),this.onlineState="Unknown",this.ku=new Set}}async function im(e,t){const n=hc(e),i=t.query;let s=!1,r=n.queries.get(i);if(r||(s=!0,r=new tm),s)try{r.Nu=await n.onListen(i)}catch(e){const n=$p(e,"Initialization of query '".concat(Cd(t.query),"' failed"));return void t.onError(n)}n.queries.set(i,r),r.listeners.push(t),t.Mu(n.onlineState),r.Nu&&t.$u(r.Nu)&&am(n)}async function sm(e,t){const n=hc(e),i=t.query;let s=!1;const r=n.queries.get(i);if(r){const e=r.listeners.indexOf(t);e>=0&&(r.listeners.splice(e,1),s=0===r.listeners.length)}if(s)return n.queries.delete(i),n.onUnlisten(i)}function rm(e,t){const n=hc(e);let i=!1;for(const s of t){const e=s.query,t=n.queries.get(e);if(t){for(const e of t.listeners)e.$u(s)&&(i=!0);t.Nu=s}}i&&am(n)}function om(e,t,n){const i=hc(e),s=i.queries.get(t);if(s)for(const r of s.listeners)r.onError(n);i.queries.delete(t)}function am(e){e.ku.forEach(e=>{e.next()})}class lm{constructor(e,t,n){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new em(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.Ku||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){if(e.docChanges.length>0)return!0;const t=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Uu(e){e=em.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class cm{constructor(e){this.key=e}}class um{constructor(e){this.key=e}}class dm{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=zd(),this.mutatedKeys=zd(),this.tc=Ed(e),this.ec=new Jp(this.tc)}get nc(){return this.Yu}sc(e,t){const n=t?t.ic:new Zp,i=t?t.ec:this.ec;let s=t?t.mutatedKeys:this.mutatedKeys,r=i,o=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((e,t)=>{const c=i.get(e),u=Nd(this.query,t)?t:null,d=!!c&&this.mutatedKeys.has(c.key),h=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;c&&u?c.data.isEqual(u.data)?d!==h&&(n.track({type:3,doc:u}),f=!0):this.rc(c,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.tc(u,a)>0||l&&this.tc(u,l)<0)&&(o=!0)):!c&&u?(n.track({type:0,doc:u}),f=!0):c&&!u&&(n.track({type:1,doc:c}),f=!0,(a||l)&&(o=!0)),f&&(u?(r=r.add(u),s=h?s.add(e):s.delete(e)):(r=r.delete(e),s=s.delete(e)))}),null!==this.query.limit)for(;r.size>this.query.limit;){const e="F"===this.query.limitType?r.last():r.first();r=r.delete(e.key),s=s.delete(e.key),n.track({type:1,doc:e})}return{ec:r,ic:n,zi:o,mutatedKeys:s}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const i=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const s=e.ic.xu();s.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return uc()}};return n(e)-n(t)}(e.type,t.type)||this.tc(e.doc,t.doc)),this.oc(n);const r=t?this.uc():[],o=0===this.Zu.size&&this.current?1:0,a=o!==this.Xu;return this.Xu=o,0!==s.length||a?{snapshot:new em(this.query,e.ec,i,s,e.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:r}:{cc:r}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new Zp,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach(e=>this.Yu=this.Yu.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Yu=this.Yu.delete(e)),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=zd(),this.ec.forEach(e=>{this.ac(e.key)&&(this.Zu=this.Zu.add(e.key))});const t=[];return e.forEach(e=>{this.Zu.has(e)||t.push(new um(e))}),this.Zu.forEach(n=>{e.has(n)||t.push(new cm(n))}),t}hc(e){this.Yu=e.ir,this.Zu=zd();const t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return em.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class hm{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class fm{constructor(e){this.key=e,this.fc=!1}}class pm{constructor(e,t,n,i,s,r){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.dc={},this.wc=new Sd(e=>wd(e),_d),this._c=new Map,this.mc=new Set,this.gc=new tu(Rc.comparator),this.yc=new Map,this.Ic=new Of,this.Tc={},this.Ec=new Map,this.Ac=Pf.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function mm(e,t){const n=Dm(e);let i,s;const r=n.wc.get(t);if(r)i=r.targetId,n.sharedClientState.addLocalQueryTarget(i),s=r.view.lc();else{const e=await Zf(n.localStore,vd(t)),r=n.sharedClientState.addLocalQueryTarget(e.targetId);i=e.targetId,s=await gm(n,t,i,"current"===r,e.resumeToken),n.isPrimaryClient&&Np(n.remoteStore,e)}return s}async function gm(e,t,n,i,s){e.Rc=(t,n,i)=>async function(e,t,n,i){let s=t.view.sc(n);s.zi&&(s=await tp(e.localStore,t.query,!1).then(e=>{let{documents:n}=e;return t.view.sc(n,s)}));const r=i&&i.targetChanges.get(t.targetId),o=t.view.applyChanges(s,e.isPrimaryClient,r);return Tm(e,t.targetId,o.cc),o.snapshot}(e,t,n,i);const r=await tp(e.localStore,t,!0),o=new dm(t,r.ir),a=o.sc(r.documents),l=Lh.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,s),c=o.applyChanges(a,e.isPrimaryClient,l);Tm(e,n,c.cc);const u=new hm(t,n,o);return e.wc.set(t,u),e._c.has(n)?e._c.get(n).push(t):e._c.set(n,[t]),c.snapshot}async function ym(e,t){const n=hc(e),i=n.wc.get(t),s=n._c.get(i.targetId);if(s.length>1)return n._c.set(i.targetId,s.filter(e=>!_d(e,t))),void n.wc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await ep(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),kp(n.remoteStore,i.targetId),km(n,i.targetId)}).catch(Bc)):(km(n,i.targetId),await ep(n.localStore,i.targetId,!0))}async function vm(e,t){const n=hc(e);try{const e=await function(e,t){const n=hc(e),i=t.snapshotVersion;let s=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const r=n.Zi.newChangeBuffer({trackRemovals:!0});s=n.Ji;const o=[];t.targetChanges.forEach((r,a)=>{const l=s.get(a);if(!l)return;o.push(n.Bs.removeMatchingKeys(e,r.removedDocuments,a).next(()=>n.Bs.addMatchingKeys(e,r.addedDocuments,a)));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?c=c.withResumeToken(lu.EMPTY_BYTE_STRING,Ic.min()).withLastLimboFreeSnapshotVersion(Ic.min()):r.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(r.resumeToken,i)),s=s.insert(a,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(l,c,r)&&o.push(n.Bs.updateTargetData(e,c))});let a=Pd(),l=zd();if(t.documentUpdates.forEach(i=>{t.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))}),o.push($f(e,r,t.documentUpdates).next(e=>{a=e.nr,l=e.sr})),!i.isEqual(Ic.min())){const t=n.Bs.getLastRemoteSnapshotVersion(e).next(t=>n.Bs.setTargetsMetadata(e,e.currentSequenceNumber,i));o.push(t)}return Hc.waitFor(o).next(()=>r.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,a,l)).next(()=>a)}).then(e=>(n.Ji=s,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const i=n.yc.get(t);i&&(dc(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?i.fc=!0:e.modifiedDocuments.size>0?dc(i.fc):e.removedDocuments.size>0&&(dc(i.fc),i.fc=!1))}),await Pm(n,e,t)}catch(e){await Bc(e)}}function bm(e,t,n){const i=hc(e);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const e=[];i.wc.forEach((n,i)=>{const s=i.view.Mu(t);s.snapshot&&e.push(s.snapshot)}),function(e,t){const n=hc(e);n.onlineState=t;let i=!1;n.queries.forEach((e,n)=>{for(const s of n.listeners)s.Mu(t)&&(i=!0)}),i&&am(n)}(i.eventManager,t),e.length&&i.dc.nu(e),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function xm(e,t,n){const i=hc(e);i.sharedClientState.updateQueryState(t,"rejected",n);const s=i.yc.get(t),r=s&&s.key;if(r){let e=new tu(Rc.comparator);e=e.insert(r,Ou.newNoDocument(r,Ic.min()));const n=zd().add(r),s=new Oh(Ic.min(),new Map,new tu(Ec),e,n);await vm(i,s),i.gc=i.gc.remove(r),i.yc.delete(t),Im(i)}else await ep(i.localStore,t,!1).then(()=>km(i,t,n)).catch(Bc)}async function _m(e,t){const n=hc(e),i=t.batch.batchId;try{const e=await function(e,t){const n=hc(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const i=t.batch.keys(),s=n.Zi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,i){const s=n.batch,r=s.keys();let o=Hc.resolve();return r.forEach(e=>{o=o.next(()=>i.getEntry(t,e)).next(t=>{const r=n.docVersions.get(e);dc(null!==r),t.version.compareTo(r)<0&&(s.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),i.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,s))}(n,e,t,s).next(()=>s.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=zd();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,i))})}(n.localStore,t);Nm(n,i,null),Cm(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await Pm(n,e)}catch(e){await Bc(e)}}async function wm(e,t,n){const i=hc(e);try{const e=await function(e,t){const n=hc(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let i;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(dc(null!==t),i=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,i)).next(()=>n.localDocuments.getDocuments(e,i))})}(i.localStore,t);Nm(i,t,n),Cm(i,t),i.sharedClientState.updateMutationState(t,"rejected",n),await Pm(i,e)}catch(n){await Bc(n)}}function Cm(e,t){(e.Ec.get(t)||[]).forEach(e=>{e.resolve()}),e.Ec.delete(t)}function Nm(e,t,n){const i=hc(e);let s=i.Tc[i.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),i.Tc[i.currentUser.toKey()]=s}}function km(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const i of e._c.get(t))e.wc.delete(i),n&&e.dc.Pc(i,n);e._c.delete(t),e.isPrimaryClient&&e.Ic.Is(t).forEach(t=>{e.Ic.containsKey(t)||Em(e,t)})}function Em(e,t){e.mc.delete(t.path.canonicalString());const n=e.gc.get(t);null!==n&&(kp(e.remoteStore,n),e.gc=e.gc.remove(t),e.yc.delete(n),Im(e))}function Tm(e,t,n){for(const i of n)i instanceof cm?(e.Ic.addReference(i.key,t),Sm(e,i)):i instanceof um?(oc("SyncEngine","Document no longer in limbo: "+i.key),e.Ic.removeReference(i.key,t),e.Ic.containsKey(i.key)||Em(e,i.key)):uc()}function Sm(e,t){const n=t.key,i=n.path.canonicalString();e.gc.get(n)||e.mc.has(i)||(oc("SyncEngine","New document in limbo: "+n),e.mc.add(i),Im(e))}function Im(e){for(;e.mc.size>0&&e.gc.size<e.maxConcurrentLimboResolutions;){const t=e.mc.values().next().value;e.mc.delete(t);const n=new Rc(jc.fromString(t)),i=e.Ac.next();e.yc.set(i,new fm(n)),e.gc=e.gc.insert(n,i),Np(e.remoteStore,new Cf(vd(hd(n.path)),i,"TargetPurposeLimboResolution",Wc.ct))}}async function Pm(e,t,n){const i=hc(e),s=[],r=[],o=[];i.wc.isEmpty()||(i.wc.forEach((e,a)=>{o.push(i.Rc(a,t,n).then(e=>{if((e||n)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){s.push(e);const t=Wf.Li(a.targetId,e);r.push(t)}}))}),await Promise.all(o),i.dc.nu(s),await async function(e,t){const n=hc(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Hc.forEach(t,t=>Hc.forEach(t.Fi,i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i)).next(()=>Hc.forEach(t.Bi,i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))}catch(e){if(!qc(e))throw e;oc("LocalStore","Failed to update sequence numbers: "+e)}for(const i of t){const e=i.targetId;if(!i.fromCache){const t=n.Ji.get(e),i=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(i);n.Ji=n.Ji.insert(e,s)}}}(i.localStore,r))}async function jm(e,t){const n=hc(e);if(!n.currentUser.isEqual(t)){oc("SyncEngine","User change. New user:",t.toKey());const e=await Qf(n.localStore,t);n.currentUser=t,function(e){e.Ec.forEach(e=>{e.forEach(e=>{e.reject(new pc(fc.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Ec.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Pm(n,e.er)}}function Am(e,t){const n=hc(e),i=n.yc.get(t);if(i&&i.fc)return zd().add(i.key);{let e=zd();const i=n._c.get(t);if(!i)return e;for(const t of i){const i=n.wc.get(t);e=e.unionWith(i.view.nc)}return e}}function Dm(e){const t=hc(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=vm.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Am.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=xm.bind(null,t),t.dc.nu=rm.bind(null,t.eventManager),t.dc.Pc=om.bind(null,t.eventManager),t}function Rm(e){const t=hc(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=_m.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=wm.bind(null,t),t}class Mm{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=pp(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Yf(this.persistence,new Gf,e.initialUser,this.serializer)}createPersistence(e){return new Bf(qf.zs,this.serializer)}createSharedClientState(e){return new sp}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Om{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>bm(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=jm.bind(null,this.syncEngine),await Kp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new nm}createDatastore(e){const t=pp(e.databaseInfo.databaseId),n=(i=e.databaseInfo,new hp(i));var i;return function(e,t,n,i){return new bp(e,t,n,i)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,i=e.asyncQueue,s=e=>bm(this.syncEngine,e,0),r=op.D()?new op:new rp,new _p(t,n,i,s,r);var t,n,i,s,r}createSyncEngine(e,t){return function(e,t,n,i,s,r,o){const a=new pm(e,t,n,i,s,r);return o&&(a.vc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=hc(e);oc("RemoteStore","RemoteStore shutting down."),t.vu.add(5),await Cp(t),t.Pu.shutdown(),t.bu.set("Unknown")}(this.remoteStore)}}class Lm{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):ac("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Fm{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new pc(fc.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=hc(e),i=af(n.serializer)+"/documents",s={documents:t.map(e=>nf(n.serializer,e))},r=await n.vo("BatchGetDocuments",i,s,t.length),o=new Map;r.forEach(e=>{const t=function(e,t){return"found"in t?function(e,t){dc(!!t.found),t.found.name,t.found.updateTime;const n=sf(e,t.found.name),i=Zh(t.found.updateTime),s=t.found.createTime?Zh(t.found.createTime):Ic.min(),r=new Ru({mapValue:{fields:t.found.fields}});return Ou.newFoundDocument(n,i,s,r)}(e,t):"missing"in t?function(e,t){dc(!!t.missing),dc(!!t.readTime);const n=sf(e,t.missing),i=Zh(t.readTime);return Ou.newNoDocument(n,i)}(e,t):uc()}(n.serializer,e);o.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{const t=o.get(e.toString());dc(!!t),a.push(t)}),a}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new vh(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{const n=Rc.fromPath(t);this.mutations.push(new bh(n,this.precondition(n)))}),await async function(e,t){const n=hc(e),i=af(n.serializer)+"/documents",s={writes:t.map(e=>uf(n.serializer,e))};await n.Io("Commit",i,s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw uc();t=Ic.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new pc(fc.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Ic.min())?rh.exists(!1):rh.updateTime(t):rh.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Ic.min()))throw new pc(fc.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return rh.updateTime(t)}return rh.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class zm{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.Bc=n.maxAttempts,this.qo=new mp(this.asyncQueue,"transaction_retry")}run(){this.Bc-=1,this.Lc()}Lc(){this.qo.No(async()=>{const e=new Fm(this.datastore),t=this.qc(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Uc(e)}))}).catch(e=>{this.Uc(e)})})}qc(e){try{const t=this.updateFunction(e);return!Gc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Uc(e){this.Bc>0&&this.Kc(e)?(this.Bc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Lc(),Promise.resolve()))):this.deferred.reject(e)}Kc(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Eh(t)}return!1}}class Um{constructor(e,t,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=nc.UNAUTHENTICATED,this.clientId=kc.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{oc("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(oc("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new pc(fc.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new mc;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=$p(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Vm(e,t){e.asyncQueue.verifyOperationInProgress(),oc("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener(async e=>{i.isEqual(e)||(await Qf(t.localStore,e),i=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function Bm(e,t){e.asyncQueue.verifyOperationInProgress();const n=await qm(e);oc("FirestoreClient","Initializing OnlineComponentProvider");const i=await e.getConfiguration();await t.initialize(n,i),e.setCredentialChangeListener(e=>Gp(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>Gp(t.remoteStore,n)),e._onlineComponents=t}function Hm(e){return"FirebaseError"===e.name?e.code===fc.FAILED_PRECONDITION||e.code===fc.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}async function qm(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){oc("FirestoreClient","Using user provided OfflineComponentProvider");try{await Vm(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!Hm(n))throw n;lc("Error using user provided cache. Falling back to memory cache: "+n),await Vm(e,new Mm)}}else oc("FirestoreClient","Using default OfflineComponentProvider"),await Vm(e,new Mm);return e._offlineComponents}async function Wm(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(oc("FirestoreClient","Using user provided OnlineComponentProvider"),await Bm(e,e._uninitializedComponentsProvider._online)):(oc("FirestoreClient","Using default OnlineComponentProvider"),await Bm(e,new Om))),e._onlineComponents}function Gm(e){return Wm(e).then(e=>e.syncEngine)}function Km(e){return Wm(e).then(e=>e.datastore)}async function Ym(e){const t=await Wm(e),n=t.eventManager;return n.onListen=mm.bind(null,t.syncEngine),n.onUnlisten=ym.bind(null,t.syncEngine),n}function Qm(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=new mc;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,i,s){const r=new Lm({next:r=>{t.enqueueAndForget(()=>sm(e,o));const a=r.docs.has(n);!a&&r.fromCache?s.reject(new pc(fc.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&r.fromCache&&i&&"server"===i.source?s.reject(new pc(fc.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(r)},error:e=>s.reject(e)}),o=new lm(hd(n.path),r,{includeMetadataChanges:!0,Ku:!0});return im(e,o)}(await Ym(e),e.asyncQueue,t,n,i)),i.promise}function Xm(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=new mc;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,i,s){const r=new Lm({next:n=>{t.enqueueAndForget(()=>sm(e,o)),n.fromCache&&"server"===i.source?s.reject(new pc(fc.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:e=>s.reject(e)}),o=new lm(n,r,{includeMetadataChanges:!0,Ku:!0});return im(e,o)}(await Ym(e),e.asyncQueue,t,n,i)),i.promise}function $m(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Jm=new Map;function Zm(e,t,n){if(!n)throw new pc(fc.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function eg(e){if(!Rc.isDocumentKey(e))throw new pc(fc.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function tg(e){if(Rc.isDocumentKey(e))throw new pc(fc.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function ng(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":uc()}function ig(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new pc(fc.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ng(e);throw new pc(fc.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}class sg{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new pc(fc.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new pc(fc.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new pc(fc.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=$m(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new pc(fc.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new pc(fc.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new pc(fc.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class rg{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new sg({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new pc(fc.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new pc(fc.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new sg(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new yc;switch(e.type){case"firstParty":return new _c(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new pc(fc.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Jm.get(e);t&&(oc("ComponentProvider","Removing Datastore"),Jm.delete(e),t.terminate())}(this),Promise.resolve()}}class og{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lg(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new og(this.firestore,e,this._key)}}class ag{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new ag(this.firestore,e,this._query)}}class lg extends ag{constructor(e,t,n){super(e,t,hd(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new og(this.firestore,null,new Rc(e))}withConverter(e){return new lg(this.firestore,e,this._path)}}function cg(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];if(e=se(e),Zm("collection","path",t),e instanceof rg){const n=jc.fromString(t,...i);return tg(n),new lg(e,null,n)}{if(!(e instanceof og||e instanceof lg))throw new pc(fc.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(jc.fromString(t,...i));return tg(n),new lg(e.firestore,null,n)}}function ug(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];if(e=se(e),1===arguments.length&&(t=kc.A()),Zm("doc","path",t),e instanceof rg){const n=jc.fromString(t,...i);return eg(n),new og(e,null,new Rc(n))}{if(!(e instanceof og||e instanceof lg))throw new pc(fc.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(jc.fromString(t,...i));return eg(n),new og(e.firestore,e instanceof lg?e.converter:null,new Rc(n))}}class dg{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new mp(this,"async_queue_retry"),this.Xc=()=>{const e=fp();e&&oc("AsyncQueue","Visibility state changed to "+e.visibilityState),this.qo.Mo()};const e=fp();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const t=fp();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise(()=>{});const t=new mc;return this.ta(()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qc.push(e),this.ea()))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!qc(e))throw e;oc("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No(()=>this.ea())}}ta(e){const t=this.Gc.then(()=>(this.Hc=!0,e().catch(e=>{this.Wc=e,this.Hc=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw ac("INTERNAL UNHANDLED ERROR: ",t),e}).then(e=>(this.Hc=!1,e))));return this.Gc=t,t}enqueueAfterDelay(e,t,n){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);const i=Xp.createAndSchedule(this,e,t,n,e=>this.na(e));return this.zc.push(i),i}Zc(){this.Wc&&uc()}verifyOperationInProgress(){}async sa(){let e;do{e=this.Gc,await e}while(e!==this.Gc)}ia(e){for(const t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then(()=>{this.zc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.zc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()})}oa(e){this.Yc.push(e)}na(e){const t=this.zc.indexOf(e);this.zc.splice(t,1)}}function hg(e){return function(e){if("object"!=typeof e||null===e)return!1;const t=e;for(const n of["next","error","complete"])if(n in t&&"function"==typeof t[n])return!0;return!1}(e)}class fg extends rg{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new dg,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||mg(this),this._firestoreClient.terminate()}}function pg(e){return e._firestoreClient||mg(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function mg(e){var t,n,i;const s=e._freezeSettings(),r=function(e,t,n,i){return new gu(e,t,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,$m(i.experimentalLongPollingOptions),i.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,s);e._firestoreClient=new Um(e._authCredentials,e._appCheckCredentials,e._queue,r),(null===(n=s.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=s.cache)||void 0===i?void 0:i._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.cache.kind,_offline:s.cache._offlineComponentProvider,_online:s.cache._onlineComponentProvider})}class gg{constructor(e){this._byteString=e}static fromBase64String(e){try{return new gg(lu.fromBase64String(e))}catch(e){throw new pc(fc.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new gg(lu.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class yg{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let i=0;i<t.length;++i)if(0===t[i].length)throw new pc(fc.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Dc(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class vg{constructor(e){this._methodName=e}}class bg{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new pc(fc.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new pc(fc.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ec(this._lat,e._lat)||Ec(this._long,e._long)}}const xg=/^__.*__$/;class _g{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ph(e,this.data,this.fieldMask,t,this.fieldTransforms):new fh(e,this.data,t,this.fieldTransforms)}}class wg{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new ph(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Cg(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw uc()}}class Ng{constructor(e,t,n,i,s,r){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.ua(),this.fieldTransforms=s||[],this.fieldMask=r||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new Ng(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.aa({path:n,la:!1});return i.fa(e),i}da(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.aa({path:n,la:!1});return i.ua(),i}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return Vg(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(Cg(this.ca)&&xg.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class kg{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||pp(e)}ya(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Ng({ca:e,methodName:t,ga:n,path:Dc.emptyPath(),la:!1,ma:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Eg(e){const t=e._freezeSettings(),n=pp(e._databaseId);return new kg(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Tg(e,t,n,i,s){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const o=e.ya(r.merge||r.mergeFields?2:0,t,n,s);Lg("Data must be an object, but it was:",o,i);const a=Mg(i,o);let l,c;if(r.merge)l=new ou(o.fieldMask),c=o.fieldTransforms;else if(r.mergeFields){const e=[];for(const i of r.mergeFields){const s=Fg(t,i,n);if(!o.contains(s))throw new pc(fc.INVALID_ARGUMENT,"Field '".concat(s,"' is specified in your field mask but missing from your input data."));Bg(e,s)||e.push(s)}l=new ou(e),c=o.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,c=o.fieldTransforms;return new _g(new Ru(a),l,c)}class Sg extends vg{_toFieldTransform(e){if(2!==e.ca)throw 1===e.ca?e._a("".concat(this._methodName,"() can only appear at the top level of your update data")):e._a("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Sg}}function Ig(e,t,n){return new Ng({ca:3,ga:t.settings.ga,methodName:e._methodName,la:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class Pg extends vg{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=Ig(this,e,!0),n=this.pa.map(e=>Rg(e,t)),i=new Xd(n);return new ih(e.path,i)}isEqual(e){return this===e}}function jg(e,t,n,i){const s=e.ya(1,t,n);Lg("Data must be an object, but it was:",s,i);const r=[],o=Ru.empty();Zc(i,(e,i)=>{const a=Ug(t,e,n);i=se(i);const l=s.da(a);if(i instanceof Sg)r.push(a);else{const e=Rg(i,l);null!=e&&(r.push(a),o.set(a,e))}});const a=new ou(r);return new wg(o,a,s.fieldTransforms)}function Ag(e,t,n,i,s,r){const o=e.ya(1,t,n),a=[Fg(t,i,n)],l=[s];if(r.length%2!=0)throw new pc(fc.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(let h=0;h<r.length;h+=2)a.push(Fg(t,r[h])),l.push(r[h+1]);const c=[],u=Ru.empty();for(let h=a.length-1;h>=0;--h)if(!Bg(c,a[h])){const e=a[h];let t=l[h];t=se(t);const n=o.da(e);if(t instanceof Sg)c.push(e);else{const i=Rg(t,n);null!=i&&(c.push(e),u.set(e,i))}}const d=new ou(c);return new wg(u,d,o.fieldTransforms)}function Dg(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Rg(n,e.ya(i?4:3,t))}function Rg(e,t){if(Og(e=se(e)))return Lg("Unsupported field value:",t,e),Mg(e,t);if(e instanceof vg)return function(e,t){if(!Cg(t.ca))throw t._a("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t._a("".concat(e._methodName,"() is not currently supported inside arrays"));const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.la&&4!==t.ca)throw t._a("Nested arrays are not supported");return function(e,t){const n=[];let i=0;for(const s of e){let e=Rg(s,t.wa(i));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),i++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=se(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return qd(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Sc.fromDate(e);return{timestampValue:Xh(t.serializer,n)}}if(e instanceof Sc){const n=new Sc(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Xh(t.serializer,n)}}if(e instanceof bg)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof gg)return{bytesValue:$h(t.serializer,e._byteString)};if(e instanceof og){const n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t._a("Document reference is for database ".concat(i.projectId,"/").concat(i.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:ef(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t._a("Unsupported field value: ".concat(ng(e)))}(e,t)}function Mg(e,t){const n={};return eu(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Zc(e,(e,i)=>{const s=Rg(i,t.ha(e));null!=s&&(n[e]=s)}),{mapValue:{fields:n}}}function Og(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Sc||e instanceof bg||e instanceof gg||e instanceof og||e instanceof vg)}function Lg(e,t,n){if(!Og(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const i=ng(n);throw"an object"===i?t._a(e+" a custom object"):t._a(e+" "+i)}}function Fg(e,t,n){if((t=se(t))instanceof yg)return t._internalPath;if("string"==typeof t)return Ug(e,t);throw Vg("Field path arguments must be of type string or ",e,!1,void 0,n)}const zg=new RegExp("[~\\*/\\[\\]]");function Ug(e,t,n){if(t.search(zg)>=0)throw Vg("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return new yg(...t.split("."))._internalPath}catch(i){throw Vg("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function Vg(e,t,n,i,s){const r=i&&!i.isEmpty(),o=void 0!==s;let a="Function ".concat(t,"() called with invalid data");n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(r||o)&&(l+=" (found",r&&(l+=" in field ".concat(i)),o&&(l+=" in document ".concat(s)),l+=")"),new pc(fc.INVALID_ARGUMENT,a+e+l)}function Bg(e,t){return e.some(e=>e.isEqual(t))}class Hg{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new og(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new qg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Wg("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class qg extends Hg{data(){return super.data()}}function Wg(e,t){return"string"==typeof t?Ug(e,t):t instanceof yg?t._internalPath:t._delegate._internalPath}function Gg(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new pc(fc.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Kg{}class Yg extends Kg{}function Qg(e,t){let n=[];for(var i=arguments.length,s=new Array(i>2?i-2:0),r=2;r<i;r++)s[r-2]=arguments[r];t instanceof Kg&&n.push(t),n=n.concat(s),function(e){const t=e.filter(e=>e instanceof Jg).length,n=e.filter(e=>e instanceof Xg).length;if(t>1||t>0&&n>0)throw new pc(fc.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const o of n)e=o._apply(e);return e}class Xg extends Yg{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Xg(e,t,n)}_apply(e){const t=this._parse(e);return sy(e._query,t),new ag(e.firestore,e.converter,bd(e._query,t))}_parse(e){const t=Eg(e.firestore),n=function(e,t,n,i,s,r,o){let a;if(s.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new pc(fc.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(r,"' queries on documentId()."));if("in"===r||"not-in"===r){iy(o,r);const t=[];for(const n of o)t.push(ny(i,e,n));a={arrayValue:{values:t}}}else a=ny(i,e,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||iy(o,r),a=Dg(n,"where",o,"in"===r||"not-in"===r);return Hu.create(s,r,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function $g(e,t,n){const i=t,s=Wg("where",e);return Xg._create(s,i,n)}class Jg extends Kg{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Jg(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:qu.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const i=t.getFlattenedFilters();for(const s of i)sy(n,s),n=bd(n,s)}(e._query,t),new ag(e.firestore,e.converter,bd(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Zg(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.forEach(e=>oy("or",e)),Jg._create("or",t)}class ey extends Yg{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ey(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new pc(fc.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new pc(fc.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const i=new Uu(t,n);return function(e,t){if(null===pd(e)){const n=md(e);null!==n&&ry(e,n,t.field)}}(e,i),i}(e._query,this._field,this._direction);return new ag(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new ud(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function ty(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=Wg("orderBy",e);return ey._create(n,t)}function ny(e,t,n){if("string"==typeof(n=se(n))){if(""===n)throw new pc(fc.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!gd(t)&&-1!==n.indexOf("/"))throw new pc(fc.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));const i=t.path.child(jc.fromString(n));if(!Rc.isDocumentKey(i))throw new pc(fc.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(i,"' is not because it has an odd number of segments (").concat(i.length,")."));return Eu(e,new Rc(i))}if(n instanceof og)return Eu(e,n._key);throw new pc(fc.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(ng(n),"."))}function iy(e,t){if(!Array.isArray(e)||0===e.length)throw new pc(fc.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function sy(e,t){if(t.isInequality()){const n=md(e),i=t.field;if(null!==n&&!n.isEqual(i))throw new pc(fc.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '".concat(n.toString(),"' and '").concat(i.toString(),"'"));const s=pd(e);null!==s&&ry(e,i,s)}const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new pc(fc.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new pc(fc.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}function ry(e,t,n){if(!n.isEqual(t))throw new pc(fc.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '".concat(t.toString(),"' and so you must also use '").concat(t.toString(),"' as your first argument to orderBy(), but your first orderBy() is on field '").concat(n.toString(),"' instead."))}function oy(e,t){if(!(t instanceof Xg||t instanceof Jg))throw new pc(fc.INVALID_ARGUMENT,"Function ".concat(e,"() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'."))}class ay{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(bu(e)){case 0:return null;case 1:return e.booleanValue;case 2:return du(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(hu(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw uc()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return Zc(e,(e,i)=>{n[e]=this.convertValue(i,t)}),n}convertGeoPoint(e){return new bg(du(e.latitude),du(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=pu(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(mu(e));default:return null}}convertTimestamp(e){const t=uu(e);return new Sc(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=jc.fromString(e);dc(wf(n));const i=new yu(n.get(1),n.get(3)),s=new Rc(n.popFirst(5));return i.isEqual(t)||ac("Document ".concat(s," contains a document reference within a different database (").concat(i.projectId,"/").concat(i.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),s}}function ly(e,t,n){let i;return i=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,i}class cy extends ay{constructor(e){super(),this.firestore=e}convertBytes(e){return new gg(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new og(this.firestore,null,t)}}class uy{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class dy extends Hg{constructor(e,t,n,i,s,r){super(e,t,n,i,r),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new hy(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(Wg("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class hy extends dy{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class fy{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new uy(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new hy(this._firestore,this._userDataWriter,n.key,n,new uy(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new pc(fc.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const i=new hy(e._firestore,e._userDataWriter,n.doc.key,n.doc,new uy(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const i=new hy(e._firestore,e._userDataWriter,t.doc.key,t.doc,new uy(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,r=-1;return 0!==t.type&&(s=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),r=n.indexOf(t.doc.key)),{type:py(t.type),doc:i,oldIndex:s,newIndex:r}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function py(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return uc()}}function my(e){e=ig(e,og);const t=ig(e.firestore,fg);return Qm(pg(t),e._key).then(n=>Cy(t,e,n))}class gy extends ay{constructor(e){super(),this.firestore=e}convertBytes(e){return new gg(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new og(this.firestore,null,t)}}function yy(e){e=ig(e,ag);const t=ig(e.firestore,fg),n=pg(t),i=new gy(t);return Gg(e._query),Xm(n,e._query).then(n=>new fy(t,i,e,n))}function vy(e,t,n){e=ig(e,og);const i=ig(e.firestore,fg),s=ly(e.converter,t,n);return wy(i,[Tg(Eg(i),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,rh.none())])}function by(e,t,n){e=ig(e,og);const i=ig(e.firestore,fg),s=Eg(i);let r;for(var o=arguments.length,a=new Array(o>3?o-3:0),l=3;l<o;l++)a[l-3]=arguments[l];return r="string"==typeof(t=se(t))||t instanceof yg?Ag(s,"updateDoc",e._key,t,n,a):jg(s,"updateDoc",e._key,t),wy(i,[r.toMutation(e._key,rh.exists(!0))])}function xy(e,t){const n=ig(e.firestore,fg),i=ug(e),s=ly(e.converter,t);return wy(n,[Tg(Eg(e.firestore),"addDoc",i._key,s,null!==e.converter,{}).toMutation(i._key,rh.exists(!1))]).then(()=>i)}function _y(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var s,r,o;e=se(e);let a={includeMetadataChanges:!1},l=0;"object"!=typeof n[l]||hg(n[l])||(a=n[l],l++);const c={includeMetadataChanges:a.includeMetadataChanges};if(hg(n[l])){const e=n[l];n[l]=null===(s=e.next)||void 0===s?void 0:s.bind(e),n[l+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),n[l+2]=null===(o=e.complete)||void 0===o?void 0:o.bind(e)}let u,d,h;if(e instanceof og)d=ig(e.firestore,fg),h=hd(e._key.path),u={next:t=>{n[l]&&n[l](Cy(d,e,t))},error:n[l+1],complete:n[l+2]};else{const t=ig(e,ag);d=ig(t.firestore,fg),h=t._query;const i=new gy(d);u={next:e=>{n[l]&&n[l](new fy(d,i,t,e))},error:n[l+1],complete:n[l+2]},Gg(e._query)}return function(e,t,n,i){const s=new Lm(i),r=new lm(t,s,n);return e.asyncQueue.enqueueAndForget(async()=>im(await Ym(e),r)),()=>{s.Dc(),e.asyncQueue.enqueueAndForget(async()=>sm(await Ym(e),r))}}(pg(d),h,c,u)}function wy(e,t){return function(e,t){const n=new mc;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const i=Rm(e);try{const e=await function(e,t){const n=hc(e),i=Sc.now(),s=t.reduce((e,t)=>e.add(t.key),zd());let r,o;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let a=Pd(),l=zd();return n.Zi.getEntries(e,s).next(e=>{a=e,a.forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,a)).next(s=>{r=s;const o=[];for(const e of t){const t=dh(e,r.get(e.key).overlayedDocument);null!=t&&o.push(new ph(e.key,t,Mu(t.value.mapValue),rh.exists(!0)))}return n.mutationQueue.addMutationBatch(e,i,o,t)}).next(t=>{o=t;const i=t.applyToLocalDocumentSet(r,l);return n.documentOverlayCache.saveOverlays(e,t.batchId,i)})}).then(()=>({batchId:o.batchId,changes:Dd(r)}))}(i.localStore,t);i.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let i=e.Tc[e.currentUser.toKey()];i||(i=new tu(Ec)),i=i.insert(t,n),e.Tc[e.currentUser.toKey()]=i}(i,e.batchId,n),await Pm(i,e.changes),await Lp(i.remoteStore)}catch(e){const t=$p(e,"Failed to persist write");n.reject(t)}}(await Gm(e),t,n)),n.promise}(pg(e),t)}function Cy(e,t,n){const i=n.docs.get(t._key),s=new gy(e);return new dy(e,s,t._key,i,new uy(n.hasPendingWrites,n.fromCache),t.converter)}const Ny={maxAttempts:5};class ky{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Eg(e)}set(e,t,n){this._verifyNotCommitted();const i=Ey(e,this._firestore),s=ly(i.converter,t,n),r=Tg(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,n);return this._mutations.push(r.toMutation(i._key,rh.none())),this}update(e,t,n){this._verifyNotCommitted();const i=Ey(e,this._firestore);let s;for(var r=arguments.length,o=new Array(r>3?r-3:0),a=3;a<r;a++)o[a-3]=arguments[a];return s="string"==typeof(t=se(t))||t instanceof yg?Ag(this._dataReader,"WriteBatch.update",i._key,t,n,o):jg(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,rh.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Ey(e,this._firestore);return this._mutations=this._mutations.concat(new vh(t._key,rh.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new pc(fc.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Ey(e,t){if((e=se(e)).firestore!==t)throw new pc(fc.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Ty extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Eg(e)}get(e){const t=Ey(e,this._firestore),n=new cy(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return uc();const i=e[0];if(i.isFoundDocument())return new Hg(this._firestore,n,i.key,i,t.converter);if(i.isNoDocument())return new Hg(this._firestore,n,t._key,null,t.converter);throw uc()})}set(e,t,n){const i=Ey(e,this._firestore),s=ly(i.converter,t,n),r=Tg(this._dataReader,"Transaction.set",i._key,s,null!==i.converter,n);return this._transaction.set(i._key,r),this}update(e,t,n){const i=Ey(e,this._firestore);let s;for(var r=arguments.length,o=new Array(r>3?r-3:0),a=3;a<r;a++)o[a-3]=arguments[a];return s="string"==typeof(t=se(t))||t instanceof yg?Ag(this._dataReader,"Transaction.update",i._key,t,n,o):jg(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=Ey(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Ey(e,this._firestore),n=new gy(this._firestore);return super.get(e).then(e=>new dy(this._firestore,n,t._key,e._document,new uy(!1,!1),t.converter))}}function Sy(e,t,n){e=ig(e,fg);const i=Object.assign(Object.assign({},Ny),n);return function(e){if(e.maxAttempts<1)throw new pc(fc.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),function(e,t,n){const i=new mc;return e.asyncQueue.enqueueAndForget(async()=>{const s=await Km(e);new zm(e.asyncQueue,s,n,t,i).run()}),i.promise}(pg(e),n=>t(new Ty(e,n)),i)}function Iy(){return new Sg("deleteField")}function Py(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Pg("arrayUnion",t)}!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){ic=e}(mt),dt(new re("firestore",(e,n)=>{let{instanceIdentifier:i,options:s}=n;const r=e.getProvider("app").getImmediate(),o=new fg(new bc(e.getProvider("auth-internal")),new Cc(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new pc(fc.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new yu(e.options.projectId,t)}(r,i),r);return s=Object.assign({useFetchStreams:t},s),o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),vt(tc,"3.13.0",e),vt(tc,"3.13.0","esm2017")}();const jy="firebasestorage.googleapis.com",Ay="storageBucket";class Dy extends F{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(Oy(e),"Firebase Storage: ".concat(t," (").concat(Oy(e),")")),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Dy.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Oy(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message="".concat(this._baseMessage,"\n").concat(this.customData.serverResponse):this.message=this._baseMessage}}var Ry,My;function Oy(e){return"storage/"+e}function Ly(){return new Dy(Ry.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Fy(){return new Dy(Ry.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function zy(){return new Dy(Ry.CANCELED,"User canceled the upload/download.")}function Uy(){return new Dy(Ry.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Vy(e){return new Dy(Ry.INVALID_ARGUMENT,e)}function By(){return new Dy(Ry.APP_DELETED,"The Firebase app was deleted.")}function Hy(e,t){return new Dy(Ry.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function qy(e){throw new Dy(Ry.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(Ry||(Ry={}));class Wy{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Wy.makeFromUrl(e,t)}catch(s){return new Wy(e,"")}if(""===n.path)return n;throw i=e,new Dy(Ry.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+i+"'.");var i}static makeFromUrl(e,t){let n=null;const i="([A-Za-z0-9.\\-_]+)";const s=new RegExp("^gs://"+i+"(/(.*))?$","i");function r(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:s,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp("^https?://".concat(o,"/").concat("v[A-Za-z0-9_]+","/b/").concat(i,"/o").concat("(/([^?#]*).*)?$"),"i"),indices:{bucket:1,path:3},postModify:r},{regex:new RegExp("^https?://".concat(t===jy?"(?:storage.googleapis.com|storage.cloud.google.com)":t,"/").concat(i,"/").concat("([^?#]*)"),"i"),indices:{bucket:1,path:2},postModify:r}];for(let l=0;l<a.length;l++){const t=a[l],i=t.regex.exec(e);if(i){const e=i[t.indices.bucket];let s=i[t.indices.path];s||(s=""),n=new Wy(e,s),t.postModify(n);break}}if(null==n)throw function(e){return new Dy(Ry.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class Gy{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(){}}function Ky(e){return"string"===typeof e||e instanceof String}function Yy(e){return Qy()&&e instanceof Blob}function Qy(){return"undefined"!==typeof Blob&&!R()}function Xy(e,t,n,i){if(i<t)throw Vy("Invalid value for '".concat(e,"'. Expected ").concat(t," or greater."));if(i>n)throw Vy("Invalid value for '".concat(e,"'. Expected ").concat(n," or less."))}function $y(e,t,n){let i=t;return null==n&&(i="https://".concat(t)),"".concat(n,"://").concat(i,"/v0").concat(e)}function Jy(e){const t=encodeURIComponent;let n="?";for(const i in e)if(e.hasOwnProperty(i)){n=n+(t(i)+"="+t(e[i]))+"&"}return n=n.slice(0,-1),n}function Zy(e,t){const n=e>=500&&e<600,i=-1!==[408,429].indexOf(e),s=-1!==t.indexOf(e);return n||i||s}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(My||(My={}));class ev{constructor(e,t,n,i,s,r,o,a,l,c,u){let d=!(arguments.length>11&&void 0!==arguments[11])||arguments[11];this.url_=e,this.method_=t,this.headers_=n,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=r,this.callback_=o,this.errorCallback_=a,this.timeout_=l,this.progressCallback_=c,this.connectionFactory_=u,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{if(t)return void e(!1,new tv(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const i=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(i),n.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(i),this.pendingConnection_=null;const t=n.getErrorCode()===My.NO_ERROR,s=n.getStatus();if(!t||Zy(s,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===My.ABORT;return void e(!1,new tv(!1,null,t))}const r=-1!==this.successCodes_.indexOf(s);e(!0,new tv(r,n))})},t=(e,t)=>{const n=this.resolve_,i=this.reject_,s=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(s,s.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(r){i(r)}else if(null!==s){const e=Ly();e.serverResponse=s.getErrorText(),this.errorCallback_?i(this.errorCallback_(s,e)):i(e)}else if(t.canceled){i(this.appDelete_?By():zy())}else{i(Fy())}};this.canceled_?t(0,new tv(!1,null,!0)):this.backoffId_=function(e,t,n){let i=1,s=null,r=null,o=!1,a=0;function l(){return 2===a}let c=!1;function u(){if(!c){c=!0;for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];t.apply(null,n)}}function d(t){s=setTimeout(()=>{s=null,e(f,l())},t)}function h(){r&&clearTimeout(r)}function f(e){if(c)return void h();for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];if(e)return h(),void u.call(null,e,...n);if(l()||o)return h(),void u.call(null,e,...n);let r;i<64&&(i*=2),1===a?(a=2,r=0):r=1e3*(i+Math.random()),d(r)}let p=!1;function m(e){p||(p=!0,h(),c||(null!==s?(e||(a=2),clearTimeout(s),d(0)):e||(a=1)))}return d(0),r=setTimeout(()=>{o=!0,m(!0)},n),m}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function(e){e(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class tv{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function nv(){return"undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function iv(){const e=nv();for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(void 0!==e){const t=new e;for(let e=0;e<n.length;e++)t.append(n[e]);return t.getBlob()}if(Qy())return new Blob(n);throw new Dy(Ry.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function sv(e){if("undefined"===typeof atob)throw t="base-64",new Dy(Ry.UNSUPPORTED_ENVIRONMENT,"".concat(t," is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information."));var t;return atob(e)}const rv="raw",ov="base64",av="base64url",lv="data_url";class cv{constructor(e,t){this.data=e,this.contentType=t||null}}function uv(e,t){switch(e){case rv:return new cv(dv(t));case ov:case av:return new cv(hv(e,t));case lv:return new cv(function(e){const t=new fv(e);return t.base64?hv(ov,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(n){throw Hy(lv,"Malformed data URL.")}return dv(t)}(t.rest)}(t),new fv(t).contentType)}throw Ly()}function dv(e){const t=[];for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);if(i<=127)t.push(i);else if(i<=2047)t.push(192|i>>6,128|63&i);else if(55296===(64512&i)){if(n<e.length-1&&56320===(64512&e.charCodeAt(n+1))){i=65536|(1023&i)<<10|1023&e.charCodeAt(++n),t.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i)}else t.push(239,191,189)}else 56320===(64512&i)?t.push(239,191,189):t.push(224|i>>12,128|i>>6&63,128|63&i)}return new Uint8Array(t)}function hv(e,t){switch(e){case ov:{const n=-1!==t.indexOf("-"),i=-1!==t.indexOf("_");if(n||i){throw Hy(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case av:{const n=-1!==t.indexOf("+"),i=-1!==t.indexOf("/");if(n||i){throw Hy(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=sv(t)}catch(s){if(s.message.includes("polyfill"))throw s;throw Hy(e,"Invalid character found")}const i=new Uint8Array(n.length);for(let r=0;r<n.length;r++)i[r]=n.charCodeAt(r);return i}class fv{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw Hy(lv,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){if(!(e.length>=t.length))return!1;return e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class pv{constructor(e,t){let n=0,i="";Yy(e)?(this.data_=e,n=e.size,i=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,t){if(Yy(this.data_)){const n=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,e,t);return null===n?null:new pv(n)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new pv(n,!0)}}static getBlob(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Qy()){const e=t.map(e=>e instanceof pv?e.data_:e);return new pv(iv.apply(null,e))}{const e=t.map(e=>Ky(e)?uv(rv,e).data:e.data_);let n=0;e.forEach(e=>{n+=e.byteLength});const i=new Uint8Array(n);let s=0;return e.forEach(e=>{for(let t=0;t<e.length;t++)i[s++]=e[t]}),new pv(i,!0)}}uploadData(){return this.data_}}function mv(e){let t;try{t=JSON.parse(e)}catch(n){return null}return function(e){return"object"===typeof e&&!Array.isArray(e)}(t)?t:null}function gv(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function yv(e,t){return t}class vv{constructor(e,t,n,i){this.server=e,this.local=t||e,this.writable=!!n,this.xform=i||yv}}let bv=null;function xv(){if(bv)return bv;const e=[];e.push(new vv("bucket")),e.push(new vv("generation")),e.push(new vv("metageneration")),e.push(new vv("name","fullPath",!0));const t=new vv("name");t.xform=function(e,t){return function(e){return!Ky(e)||e.length<2?e:gv(e)}(t)},e.push(t);const n=new vv("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new vv("timeCreated")),e.push(new vv("updated")),e.push(new vv("md5Hash",null,!0)),e.push(new vv("cacheControl",null,!0)),e.push(new vv("contentDisposition",null,!0)),e.push(new vv("contentEncoding",null,!0)),e.push(new vv("contentLanguage",null,!0)),e.push(new vv("contentType",null,!0)),e.push(new vv("metadata","customMetadata",!0)),bv=e,bv}function _v(e,t,n){const i={type:"file"},s=n.length;for(let r=0;r<s;r++){const e=n[r];i[e.local]=e.xform(i,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,i=e.fullPath,s=new Wy(n,i);return t._makeStorageReference(s)}})}(i,e),i}function wv(e,t,n){const i=mv(t);if(null===i)return null;return _v(e,i,n)}function Cv(e,t){const n={},i=t.length;for(let s=0;s<i;s++){const i=t[s];i.writable&&(n[i.server]=e[i.local])}return JSON.stringify(n)}class Nv{constructor(e,t,n,i){this.url=e,this.method=t,this.handler=n,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function kv(e){if(!e)throw Ly()}function Ev(e,t){return function(n,i){const s=wv(e,i,t);return kv(null!==s),s}}function Tv(e,t){return function(n,i){const s=wv(e,i,t);return kv(null!==s),function(e,t,n,i){const s=mv(t);if(null===s)return null;if(!Ky(s.downloadTokens))return null;const r=s.downloadTokens;if(0===r.length)return null;const o=encodeURIComponent;return r.split(",").map(t=>{const s=e.bucket,r=e.fullPath;return $y("/b/"+o(s)+"/o/"+o(r),n,i)+Jy({alt:"media",token:t})})[0]}(s,i,e.host,e._protocol)}}function Sv(e){return function(t,n){let i;var s,r;return 401===t.getStatus()?i=t.getErrorText().includes("Firebase App Check token is invalid")?new Dy(Ry.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new Dy(Ry.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(r=e.bucket,i=new Dy(Ry.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(s=e.path,i=new Dy(Ry.UNAUTHORIZED,"User does not have permission to access '"+s+"'.")):i=n,i.status=t.getStatus(),i.serverResponse=n.serverResponse,i}}function Iv(e){const t=Sv(e);return function(n,i){let s=t(n,i);var r;return 404===n.getStatus()&&(r=e.path,s=new Dy(Ry.OBJECT_NOT_FOUND,"Object '"+r+"' does not exist.")),s.serverResponse=i.serverResponse,s}}function Pv(e,t,n){const i=$y(t.fullServerUrl(),e.host,e._protocol),s=e.maxOperationRetryTime,r=new Nv(i,"GET",Ev(e,n),s);return r.errorHandler=Iv(t),r}function jv(e,t,n){const i=Object.assign({},n);return i.fullPath=e.path,i.size=t.size(),i.contentType||(i.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),i}function Av(e,t,n,i,s){const r=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};const a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const l=jv(t,i,s),c="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Cv(l,n)+"\r\n--"+a+"\r\nContent-Type: "+l.contentType+"\r\n\r\n",u="\r\n--"+a+"--",d=pv.getBlob(c,i,u);if(null===d)throw Uy();const h={name:l.fullPath},f=$y(r,e.host,e._protocol),p=e.maxUploadRetryTime,m=new Nv(f,"POST",Ev(e,n),p);return m.urlParams=h,m.headers=o,m.body=d.uploadData(),m.errorHandler=Sv(t),m}class Dv{constructor(e,t,n,i){this.current=e,this.total=t,this.finalized=!!n,this.metadata=i||null}}function Rv(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(i){kv(!1)}return kv(!!n&&-1!==(t||["active"]).indexOf(n)),n}const Mv=262144;function Ov(e,t,n,i,s,r,o,a){const l=new Dv(0,0);if(o?(l.current=o.current,l.total=o.total):(l.current=0,l.total=i.size()),i.size()!==l.total)throw new Dy(Ry.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");const c=l.total-l.current;let u=c;s>0&&(u=Math.min(u,s));const d=l.current,h=d+u;let f="";f=0===u?"finalize":c===u?"upload, finalize":"upload";const p={"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":"".concat(l.current)},m=i.slice(d,h);if(null===m)throw Uy();const g=t.maxUploadRetryTime,y=new Nv(n,"POST",function(e,n){const s=Rv(e,["active","final"]),o=l.current+u,a=i.size();let c;return c="final"===s?Ev(t,r)(e,n):null,new Dv(o,a,"final"===s,c)},g);return y.headers=p,y.body=m.uploadData(),y.progressCallback=a||null,y.errorHandler=Sv(e),y}const Lv="running",Fv="paused",zv="success",Uv="canceled",Vv="error";function Bv(e){switch(e){case"running":case"pausing":case"canceling":return Lv;case"paused":return Fv;case"success":return zv;case"canceled":return Uv;default:return Vv}}class Hv{constructor(e,t,n){const i=function(e){return"function"===typeof e}(e)||null!=t||null!=n;if(i)this.next=e,this.error=null!==t&&void 0!==t?t:void 0,this.complete=null!==n&&void 0!==n?n:void 0;else{const t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}function qv(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];Promise.resolve().then(()=>e(...n))}}class Wv{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=My.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=My.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=My.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,i){if(this.sent_)throw qy("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==i)for(const s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw qy("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw qy("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw qy("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw qy("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class Gv extends Wv{initXhr(){this.xhr_.responseType="text"}}function Kv(){return new Gv}class Yv{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=xv(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{if(this._request=void 0,this._chunkMultiplier=1,e._codeEquals(Ry.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const t=this.isExponentialBackoffExpired();if(Zy(e.status,[])){if(!t)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();e=Fy()}this._error=e,this._transition("error")}},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals(Ry.CANCELED)?this.completeTransitions_():(this._error=e,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(t=>{let[n,i]=t;switch(this._state){case"running":e(n,i);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{const n=function(e,t,n,i,s){const r=t.bucketOnlyServerUrl(),o=jv(t,i,s),a={name:o.fullPath},l=$y(r,e.host,e._protocol),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":"".concat(i.size()),"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},u=Cv(o,n),d=e.maxUploadRetryTime,h=new Nv(l,"POST",function(e){let t;Rv(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(n){kv(!1)}return kv(Ky(t)),t},d);return h.urlParams=a,h.headers=c,h.body=u,h.errorHandler=Sv(t),h}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(n,Kv,e,t);this._request=i,i.getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((t,n)=>{const i=function(e,t,n,i){const s=e.maxUploadRetryTime,r=new Nv(n,"POST",function(e){const t=Rv(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(r){kv(!1)}n||kv(!1);const s=Number(n);return kv(!isNaN(s)),new Dv(s,i.size(),"final"===t)},s);return r.headers={"X-Goog-Upload-Command":"query"},r.errorHandler=Sv(t),r}(this._ref.storage,this._ref._location,e,this._blob),s=this._ref.storage._makeRequest(i,Kv,t,n);this._request=s,s.getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=Mv*this._chunkMultiplier,t=new Dv(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken((i,s)=>{let r;try{r=Ov(this._ref._location,this._ref.storage,n,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(a){return this._error=a,void this._transition("error")}const o=this._ref.storage._makeRequest(r,Kv,i,s,!1);this._request=o,o.getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){2*(Mv*this._chunkMultiplier)<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{const n=Pv(this._ref.storage,this._ref._location,this._mappings),i=this._ref.storage._makeRequest(n,Kv,e,t);this._request=i,i.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{const n=Av(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(n,Kv,e,t);this._request=i,i.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=e,this._notifyObservers();break;case"canceled":this._error=zy(),this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=Bv(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,i){const s=new Hv(t||void 0,n||void 0,i||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise();this._observers.slice().forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(Bv(this._state)){case zv:qv(this._resolve.bind(null,this.snapshot))();break;case Uv:case Vv:qv(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(Bv(this._state)){case Lv:case Fv:e.next&&qv(e.next.bind(e,this.snapshot))();break;case zv:e.complete&&qv(e.complete.bind(e))();break;default:e.error&&qv(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class Qv{constructor(e,t){this._service=e,this._location=t instanceof Wy?t:Wy.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Qv(e,t)}get root(){const e=new Wy(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return gv(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new Wy(this._location.bucket,e);return new Qv(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Dy(Ry.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function Xv(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const i=$y(t.fullServerUrl(),e.host,e._protocol),s=e.maxOperationRetryTime,r=new Nv(i,"GET",Tv(e,n),s);return r.errorHandler=Iv(t),r}(e.storage,e._location,xv());return e.storage.makeRequestWithTokens(t,Kv).then(e=>{if(null===e)throw new Dy(Ry.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function $v(e,t){const n=function(e,t){const n=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),i=new Wy(e._location.bucket,n);return new Qv(e.storage,i)}function Jv(e,t){if(e instanceof tb){const n=e;if(null==n._bucket)throw new Dy(Ry.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Ay+"' property when initializing the app?");const i=new Qv(n,n._bucket);return null!=t?Jv(i,t):i}return void 0!==t?$v(e,t):e}function Zv(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof tb)return new Qv(e,t);throw Vy("To use ref(service, url), the first argument must be a Storage instance.")}return Jv(e,t)}function eb(e,t){const n=null===t||void 0===t?void 0:t[Ay];return null==n?null:Wy.makeFromBucketSpec(n,e)}class tb{constructor(e,t,n,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=jy,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?Wy.makeFromBucketSpec(i,this._host):eb(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=Wy.makeFromBucketSpec(this._url,e):this._bucket=eb(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Xy("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Xy("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Qv(this,e)}_makeRequest(e,t,n,i){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._deleted)return new Gy(By());{const r=function(e,t,n,i,s,r){let o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const a=Jy(e.urlParams),l=e.url+a,c=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(c,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(c,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!==t&&void 0!==t?t:"AppManager")}(c,r),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(c,i),new ev(l,e.method,c,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,s,o)}(e,this._appId,n,i,t,this._firebaseVersion,s);return this._requests.add(r),r.getPromise().then(()=>this._requests.delete(r),()=>this._requests.delete(r)),r}}async makeRequestWithTokens(e,t){const[n,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,i).getPromise()}}const nb="@firebase/storage",ib="0.11.2",sb="storage";function rb(e,t,n){return function(e,t,n){return e._throwIfRoot("uploadBytesResumable"),new Yv(e,new pv(t),n)}(e=se(e),t,n)}function ob(e){return Xv(e=se(e))}function ab(e,t){return Zv(e=se(e),t)}function lb(e,t){let{instanceIdentifier:n}=t;const i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return new tb(i,s,r,n,mt)}function cb(e,t){if(null==e)return{};var n,i,s=function(e,t){if(null==e)return{};var n={};for(var i in e)if({}.hasOwnProperty.call(e,i)){if(-1!==t.indexOf(i))continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}function ub(e){return e+.5|0}dt(new re(sb,lb,"PUBLIC").setMultipleInstances(!0)),vt(nb,ib,""),vt(nb,ib,"esm2017");const db=(e,t,n)=>Math.max(Math.min(e,n),t);function hb(e){return db(ub(2.55*e),0,255)}function fb(e){return db(ub(255*e),0,255)}function pb(e){return db(ub(e/2.55)/100,0,1)}function mb(e){return db(ub(100*e),0,100)}const gb={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},yb=[..."0123456789ABCDEF"],vb=e=>yb[15&e],bb=e=>yb[(240&e)>>4]+yb[15&e],xb=e=>(240&e)>>4===(15&e);function _b(e){var t=(e=>xb(e.r)&&xb(e.g)&&xb(e.b)&&xb(e.a))(e)?vb:bb;return e?"#"+t(e.r)+t(e.g)+t(e.b)+((e,t)=>e<255?t(e):"")(e.a,t):void 0}const wb=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Cb(e,t,n){const i=t*Math.min(n,1-n),s=function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t+e/30)%12;return n-i*Math.max(Math.min(s-3,9-s,1),-1)};return[s(0),s(8),s(4)]}function Nb(e,t,n){const i=function(i){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(i+e/60)%6;return n-n*t*Math.max(Math.min(s,4-s,1),0)};return[i(5),i(3),i(1)]}function kb(e,t,n){const i=Cb(e,1,.5);let s;for(t+n>1&&(s=1/(t+n),t*=s,n*=s),s=0;s<3;s++)i[s]*=1-t-n,i[s]+=t;return i}function Eb(e){const t=e.r/255,n=e.g/255,i=e.b/255,s=Math.max(t,n,i),r=Math.min(t,n,i),o=(s+r)/2;let a,l,c;return s!==r&&(c=s-r,l=o>.5?c/(2-s-r):c/(s+r),a=function(e,t,n,i,s){return e===s?(t-n)/i+(t<n?6:0):t===s?(n-e)/i+2:(e-t)/i+4}(t,n,i,c,s),a=60*a+.5),[0|a,l||0,o]}function Tb(e,t,n,i){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,n,i)).map(fb)}function Sb(e,t,n){return Tb(Cb,e,t,n)}function Ib(e){return(e%360+360)%360}function Pb(e){const t=wb.exec(e);let n,i=255;if(!t)return;t[5]!==n&&(i=t[6]?hb(+t[5]):fb(+t[5]));const s=Ib(+t[2]),r=+t[3]/100,o=+t[4]/100;return n="hwb"===t[1]?function(e,t,n){return Tb(kb,e,t,n)}(s,r,o):"hsv"===t[1]?function(e,t,n){return Tb(Nb,e,t,n)}(s,r,o):Sb(s,r,o),{r:n[0],g:n[1],b:n[2],a:i}}const jb={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Ab={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};let Db;function Rb(e){Db||(Db=function(){const e={},t=Object.keys(Ab),n=Object.keys(jb);let i,s,r,o,a;for(i=0;i<t.length;i++){for(o=a=t[i],s=0;s<n.length;s++)r=n[s],a=a.replace(r,jb[r]);r=parseInt(Ab[o],16),e[a]=[r>>16&255,r>>8&255,255&r]}return e}(),Db.transparent=[0,0,0,0]);const t=Db[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:4===t.length?t[3]:255}}const Mb=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;const Ob=e=>e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055,Lb=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function Fb(e,t,n){if(e){let i=Eb(e);i[t]=Math.max(0,Math.min(i[t]+i[t]*n,0===t?360:1)),i=Sb(i),e.r=i[0],e.g=i[1],e.b=i[2]}}function zb(e,t){return e?Object.assign(t||{},e):e}function Ub(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=fb(e[3]))):(t=zb(e,{r:0,g:0,b:0,a:1})).a=fb(t.a),t}function Vb(e){return"r"===e.charAt(0)?function(e){const t=Mb.exec(e);let n,i,s,r=255;if(t){if(t[7]!==n){const e=+t[7];r=t[8]?hb(e):db(255*e,0,255)}return n=+t[1],i=+t[3],s=+t[5],n=255&(t[2]?hb(n):db(n,0,255)),i=255&(t[4]?hb(i):db(i,0,255)),s=255&(t[6]?hb(s):db(s,0,255)),{r:n,g:i,b:s,a:r}}}(e):Pb(e)}class Bb{constructor(e){if(e instanceof Bb)return e;const t=typeof e;let n;"object"===t?n=Ub(e):"string"===t&&(n=function(e){var t,n=e.length;return"#"===e[0]&&(4===n||5===n?t={r:255&17*gb[e[1]],g:255&17*gb[e[2]],b:255&17*gb[e[3]],a:5===n?17*gb[e[4]]:255}:7!==n&&9!==n||(t={r:gb[e[1]]<<4|gb[e[2]],g:gb[e[3]]<<4|gb[e[4]],b:gb[e[5]]<<4|gb[e[6]],a:9===n?gb[e[7]]<<4|gb[e[8]]:255})),t}(e)||Rb(e)||Vb(e)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var e=zb(this._rgb);return e&&(e.a=pb(e.a)),e}set rgb(e){this._rgb=Ub(e)}rgbString(){return this._valid?function(e){return e&&(e.a<255?"rgba(".concat(e.r,", ").concat(e.g,", ").concat(e.b,", ").concat(pb(e.a),")"):"rgb(".concat(e.r,", ").concat(e.g,", ").concat(e.b,")"))}(this._rgb):void 0}hexString(){return this._valid?_b(this._rgb):void 0}hslString(){return this._valid?function(e){if(!e)return;const t=Eb(e),n=t[0],i=mb(t[1]),s=mb(t[2]);return e.a<255?"hsla(".concat(n,", ").concat(i,"%, ").concat(s,"%, ").concat(pb(e.a),")"):"hsl(".concat(n,", ").concat(i,"%, ").concat(s,"%)")}(this._rgb):void 0}mix(e,t){if(e){const n=this.rgb,i=e.rgb;let s;const r=t===s?.5:t,o=2*r-1,a=n.a-i.a,l=((o*a===-1?o:(o+a)/(1+o*a))+1)/2;s=1-l,n.r=255&l*n.r+s*i.r+.5,n.g=255&l*n.g+s*i.g+.5,n.b=255&l*n.b+s*i.b+.5,n.a=r*n.a+(1-r)*i.a,this.rgb=n}return this}interpolate(e,t){return e&&(this._rgb=function(e,t,n){const i=Lb(pb(e.r)),s=Lb(pb(e.g)),r=Lb(pb(e.b));return{r:fb(Ob(i+n*(Lb(pb(t.r))-i))),g:fb(Ob(s+n*(Lb(pb(t.g))-s))),b:fb(Ob(r+n*(Lb(pb(t.b))-r))),a:e.a+n*(t.a-e.a)}}(this._rgb,e._rgb,t)),this}clone(){return new Bb(this.rgb)}alpha(e){return this._rgb.a=fb(e),this}clearer(e){return this._rgb.a*=1-e,this}greyscale(){const e=this._rgb,t=ub(.3*e.r+.59*e.g+.11*e.b);return e.r=e.g=e.b=t,this}opaquer(e){return this._rgb.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return Fb(this._rgb,2,e),this}darken(e){return Fb(this._rgb,2,-e),this}saturate(e){return Fb(this._rgb,1,e),this}desaturate(e){return Fb(this._rgb,1,-e),this}rotate(e){return function(e,t){var n=Eb(e);n[0]=Ib(n[0]+t),n=Sb(n),e.r=n[0],e.g=n[1],e.b=n[2]}(this._rgb,e),this}}function Hb(){}const qb=(()=>{let e=0;return()=>e++})();function Wb(e){return null===e||void 0===e}function Gb(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return"[object"===t.slice(0,7)&&"Array]"===t.slice(-6)}function Kb(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function Yb(e){return("number"===typeof e||e instanceof Number)&&isFinite(+e)}function Qb(e,t){return Yb(e)?e:t}function Xb(e,t){return"undefined"===typeof e?t:e}const $b=(e,t)=>"string"===typeof e&&e.endsWith("%")?parseFloat(e)/100*t:+e;function Jb(e,t,n){if(e&&"function"===typeof e.call)return e.apply(n,t)}function Zb(e,t,n,i){let s,r,o;if(Gb(e))if(r=e.length,i)for(s=r-1;s>=0;s--)t.call(n,e[s],s);else for(s=0;s<r;s++)t.call(n,e[s],s);else if(Kb(e))for(o=Object.keys(e),r=o.length,s=0;s<r;s++)t.call(n,e[o[s]],o[s])}function ex(e,t){let n,i,s,r;if(!e||!t||e.length!==t.length)return!1;for(n=0,i=e.length;n<i;++n)if(s=e[n],r=t[n],s.datasetIndex!==r.datasetIndex||s.index!==r.index)return!1;return!0}function tx(e){if(Gb(e))return e.map(tx);if(Kb(e)){const t=Object.create(null),n=Object.keys(e),i=n.length;let s=0;for(;s<i;++s)t[n[s]]=tx(e[n[s]]);return t}return e}function nx(e){return-1===["__proto__","prototype","constructor"].indexOf(e)}function ix(e,t,n,i){if(!nx(e))return;const s=t[e],r=n[e];Kb(s)&&Kb(r)?sx(s,r,i):t[e]=tx(r)}function sx(e,t,n){const i=Gb(t)?t:[t],s=i.length;if(!Kb(e))return e;const r=(n=n||{}).merger||ix;let o;for(let a=0;a<s;++a){if(o=i[a],!Kb(o))continue;const t=Object.keys(o);for(let i=0,s=t.length;i<s;++i)r(t[i],e,o,n)}return e}function rx(e,t){return sx(e,t,{merger:ox})}function ox(e,t,n){if(!nx(e))return;const i=t[e],s=n[e];Kb(i)&&Kb(s)?rx(i,s):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=tx(s))}const ax={"":e=>e,x:e=>e.x,y:e=>e.y};function lx(e,t){const n=ax[t]||(ax[t]=function(e){const t=function(e){const t=e.split("."),n=[];let i="";for(const s of t)i+=s,i.endsWith("\\")?i=i.slice(0,-1)+".":(n.push(i),i="");return n}(e);return e=>{for(const n of t){if(""===n)break;e=e&&e[n]}return e}}(t));return n(e)}function cx(e){return e.charAt(0).toUpperCase()+e.slice(1)}const ux=e=>"undefined"!==typeof e,dx=e=>"function"===typeof e,hx=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0};const fx=Math.PI,px=2*fx,mx=px+fx,gx=Number.POSITIVE_INFINITY,yx=fx/180,vx=fx/2,bx=fx/4,xx=2*fx/3,_x=Math.log10,wx=Math.sign;function Cx(e,t,n){return Math.abs(e-t)<n}function Nx(e){const t=Math.round(e);e=Cx(e,t,e/1e3)?t:e;const n=Math.pow(10,Math.floor(_x(e))),i=e/n;return(i<=1?1:i<=2?2:i<=5?5:10)*n}function kx(e){return!function(e){return"symbol"===typeof e||"object"===typeof e&&null!==e&&!(Symbol.toPrimitive in e||"toString"in e||"valueOf"in e)}(e)&&!isNaN(parseFloat(e))&&isFinite(e)}function Ex(e,t,n){let i,s,r;for(i=0,s=e.length;i<s;i++)r=e[i][n],isNaN(r)||(t.min=Math.min(t.min,r),t.max=Math.max(t.max,r))}function Tx(e){return e*(fx/180)}function Sx(e){return e*(180/fx)}function Ix(e){if(!Yb(e))return;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,n++;return n}function Px(e,t){const n=t.x-e.x,i=t.y-e.y,s=Math.sqrt(n*n+i*i);let r=Math.atan2(i,n);return r<-.5*fx&&(r+=px),{angle:r,distance:s}}function jx(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Ax(e,t){return(e-t+mx)%px-fx}function Dx(e){return(e%px+px)%px}function Rx(e,t,n,i){const s=Dx(e),r=Dx(t),o=Dx(n),a=Dx(r-s),l=Dx(o-s),c=Dx(s-r),u=Dx(s-o);return s===r||s===o||i&&r===o||a>l&&c<u}function Mx(e,t,n){return Math.max(t,Math.min(n,e))}function Ox(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-6;return e>=Math.min(t,n)-i&&e<=Math.max(t,n)+i}function Lx(e,t,n){n=n||(n=>e[n]<t);let i,s=e.length-1,r=0;for(;s-r>1;)i=r+s>>1,n(i)?r=i:s=i;return{lo:r,hi:s}}const Fx=(e,t,n,i)=>Lx(e,n,i?i=>{const s=e[i][t];return s<n||s===n&&e[i+1][t]===n}:i=>e[i][t]<n),zx=(e,t,n)=>Lx(e,n,i=>e[i][t]>=n);const Ux=["push","pop","shift","splice","unshift"];function Vx(e,t){const n=e._chartjs;if(!n)return;const i=n.listeners,s=i.indexOf(t);-1!==s&&i.splice(s,1),i.length>0||(Ux.forEach(t=>{delete e[t]}),delete e._chartjs)}function Bx(e){const t=new Set(e);return t.size===e.length?e:Array.from(t)}const Hx="undefined"===typeof window?function(e){return e()}:window.requestAnimationFrame;function qx(e,t){let n=[],i=!1;return function(){for(var s=arguments.length,r=new Array(s),o=0;o<s;o++)r[o]=arguments[o];n=r,i||(i=!0,Hx.call(window,()=>{i=!1,e.apply(t,n)}))}}const Wx=e=>"start"===e?"left":"end"===e?"right":"center",Gx=(e,t,n)=>"start"===e?t:"end"===e?n:(t+n)/2;function Kx(e,t,n){const i=t.length;let s=0,r=i;if(e._sorted){const{iScale:o,vScale:a,_parsed:l}=e,c=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null,u=o.axis,{min:d,max:h,minDefined:f,maxDefined:p}=o.getUserBounds();if(f){if(s=Math.min(Fx(l,u,d).lo,n?i:Fx(t,u,o.getPixelForValue(d)).lo),c){const e=l.slice(0,s+1).reverse().findIndex(e=>!Wb(e[a.axis]));s-=Math.max(0,e)}s=Mx(s,0,i-1)}if(p){let e=Math.max(Fx(l,o.axis,h,!0).hi+1,n?0:Fx(t,u,o.getPixelForValue(h),!0).hi+1);if(c){const t=l.slice(e-1).findIndex(e=>!Wb(e[a.axis]));e+=Math.max(0,t)}r=Mx(e,s,i)-s}else r=i-s}return{start:s,count:r}}function Yx(e){const{xScale:t,yScale:n,_scaleRanges:i}=e,s={xmin:t.min,xmax:t.max,ymin:n.min,ymax:n.max};if(!i)return e._scaleRanges=s,!0;const r=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==n.min||i.ymax!==n.max;return Object.assign(i,s),r}const Qx=e=>0===e||1===e,Xx=(e,t,n)=>-Math.pow(2,10*(e-=1))*Math.sin((e-t)*px/n),$x=(e,t,n)=>Math.pow(2,-10*e)*Math.sin((e-t)*px/n)+1,Jx={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>1-Math.cos(e*vx),easeOutSine:e=>Math.sin(e*vx),easeInOutSine:e=>-.5*(Math.cos(fx*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>Qx(e)?e:e<.5?.5*Math.pow(2,10*(2*e-1)):.5*(2-Math.pow(2,-10*(2*e-1))),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>Qx(e)?e:Xx(e,.075,.3),easeOutElastic:e=>Qx(e)?e:$x(e,.075,.3),easeInOutElastic(e){const t=.1125;return Qx(e)?e:e<.5?.5*Xx(2*e,t,.45):.5+.5*$x(2*e-1,t,.45)},easeInBack(e){const t=1.70158;return e*e*((t+1)*e-t)},easeOutBack(e){const t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?e*e*((1+(t*=1.525))*e-t)*.5:.5*((e-=2)*e*((1+(t*=1.525))*e+t)+2)},easeInBounce:e=>1-Jx.easeOutBounce(1-e),easeOutBounce(e){const t=7.5625,n=2.75;return e<1/n?t*e*e:e<2/n?t*(e-=1.5/n)*e+.75:e<2.5/n?t*(e-=2.25/n)*e+.9375:t*(e-=2.625/n)*e+.984375},easeInOutBounce:e=>e<.5?.5*Jx.easeInBounce(2*e):.5*Jx.easeOutBounce(2*e-1)+.5};function Zx(e){if(e&&"object"===typeof e){const t=e.toString();return"[object CanvasPattern]"===t||"[object CanvasGradient]"===t}return!1}function e_(e){return Zx(e)?e:new Bb(e)}function t_(e){return Zx(e)?e:new Bb(e).saturate(.5).darken(.1).hexString()}const n_=["x","y","borderWidth","radius","tension"],i_=["color","borderColor","backgroundColor"];const s_=new Map;function r_(e,t,n){return function(e,t){t=t||{};const n=e+JSON.stringify(t);let i=s_.get(n);return i||(i=new Intl.NumberFormat(e,t),s_.set(n,i)),i}(t,n).format(e)}const o_={values:e=>Gb(e)?e:""+e,numeric(e,t,n){if(0===e)return"0";const i=this.chart.options.locale;let s,r=e;if(n.length>1){const t=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(t<1e-4||t>1e15)&&(s="scientific"),r=function(e,t){let n=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;Math.abs(n)>=1&&e!==Math.floor(e)&&(n=e-Math.floor(e));return n}(e,n)}const o=_x(Math.abs(r)),a=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:s,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),r_(e,i,l)},logarithmic(e,t,n){if(0===e)return"0";const i=n[t].significand||e/Math.pow(10,Math.floor(_x(e)));return[1,2,3,5,10,15].includes(i)||t>.8*n.length?o_.numeric.call(this,e,t,n):""}};var a_={formatters:o_};const l_=Object.create(null),c_=Object.create(null);function u_(e,t){if(!t)return e;const n=t.split(".");for(let i=0,s=n.length;i<s;++i){const t=n[i];e=e[t]||(e[t]=Object.create(null))}return e}function d_(e,t,n){return"string"===typeof t?sx(u_(e,t),n):sx(u_(e,""),t)}class h_{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=e=>e.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(e,t)=>t_(t.backgroundColor),this.hoverBorderColor=(e,t)=>t_(t.borderColor),this.hoverColor=(e,t)=>t_(t.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return d_(this,e,t)}get(e){return u_(this,e)}describe(e,t){return d_(c_,e,t)}override(e,t){return d_(l_,e,t)}route(e,t,n,i){const s=u_(this,e),r=u_(this,n),o="_"+t;Object.defineProperties(s,{[o]:{value:s[t],writable:!0},[t]:{enumerable:!0,get(){const e=this[o],t=r[i];return Kb(e)?Object.assign({},t,e):Xb(e,t)},set(e){this[o]=e}}})}apply(e){e.forEach(e=>e(this))}}var f_=new h_({_scriptable:e=>!e.startsWith("on"),_indexable:e=>"events"!==e,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function(e){e.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),e.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>"onProgress"!==e&&"onComplete"!==e&&"fn"!==e}),e.set("animations",{colors:{type:"color",properties:i_},numbers:{type:"number",properties:n_}}),e.describe("animations",{_fallback:"animation"}),e.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>0|e}}}})},function(e){e.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function(e){e.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:a_.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),e.route("scale.ticks","color","","color"),e.route("scale.grid","color","","borderColor"),e.route("scale.border","color","","borderColor"),e.route("scale.title","color","","color"),e.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&"callback"!==e&&"parser"!==e,_indexable:e=>"borderDash"!==e&&"tickBorderDash"!==e&&"dash"!==e}),e.describe("scales",{_fallback:"scale"}),e.describe("scale.ticks",{_scriptable:e=>"backdropPadding"!==e&&"callback"!==e,_indexable:e=>"backdropPadding"!==e})}]);function p_(e,t,n,i,s){let r=t[s];return r||(r=t[s]=e.measureText(s).width,n.push(s)),r>i&&(i=r),i}function m_(e,t,n,i){let s=(i=i||{}).data=i.data||{},r=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(s=i.data={},r=i.garbageCollect=[],i.font=t),e.save(),e.font=t;let o=0;const a=n.length;let l,c,u,d,h;for(l=0;l<a;l++)if(d=n[l],void 0===d||null===d||Gb(d)){if(Gb(d))for(c=0,u=d.length;c<u;c++)h=d[c],void 0===h||null===h||Gb(h)||(o=p_(e,s,r,o,h))}else o=p_(e,s,r,o,d);e.restore();const f=r.length/2;if(f>n.length){for(l=0;l<f;l++)delete s[r[l]];r.splice(0,f)}return o}function g_(e,t,n){const i=e.currentDevicePixelRatio,s=0!==n?Math.max(n/2,.5):0;return Math.round((t-s)*i)/i+s}function y_(e,t){(t||e)&&((t=t||e.getContext("2d")).save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore())}function v_(e,t,n,i){b_(e,t,n,i,null)}function b_(e,t,n,i,s){let r,o,a,l,c,u,d,h;const f=t.pointStyle,p=t.rotation,m=t.radius;let g=(p||0)*yx;if(f&&"object"===typeof f&&(r=f.toString(),"[object HTMLImageElement]"===r||"[object HTMLCanvasElement]"===r))return e.save(),e.translate(n,i),e.rotate(g),e.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),void e.restore();if(!(isNaN(m)||m<=0)){switch(e.beginPath(),f){default:s?e.ellipse(n,i,s/2,m,0,0,px):e.arc(n,i,m,0,px),e.closePath();break;case"triangle":u=s?s/2:m,e.moveTo(n+Math.sin(g)*u,i-Math.cos(g)*m),g+=xx,e.lineTo(n+Math.sin(g)*u,i-Math.cos(g)*m),g+=xx,e.lineTo(n+Math.sin(g)*u,i-Math.cos(g)*m),e.closePath();break;case"rectRounded":c=.516*m,l=m-c,o=Math.cos(g+bx)*l,d=Math.cos(g+bx)*(s?s/2-c:l),a=Math.sin(g+bx)*l,h=Math.sin(g+bx)*(s?s/2-c:l),e.arc(n-d,i-a,c,g-fx,g-vx),e.arc(n+h,i-o,c,g-vx,g),e.arc(n+d,i+a,c,g,g+vx),e.arc(n-h,i+o,c,g+vx,g+fx),e.closePath();break;case"rect":if(!p){l=Math.SQRT1_2*m,u=s?s/2:l,e.rect(n-u,i-l,2*u,2*l);break}g+=bx;case"rectRot":d=Math.cos(g)*(s?s/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),e.moveTo(n-d,i-a),e.lineTo(n+h,i-o),e.lineTo(n+d,i+a),e.lineTo(n-h,i+o),e.closePath();break;case"crossRot":g+=bx;case"cross":d=Math.cos(g)*(s?s/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),e.moveTo(n-d,i-a),e.lineTo(n+d,i+a),e.moveTo(n+h,i-o),e.lineTo(n-h,i+o);break;case"star":d=Math.cos(g)*(s?s/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),e.moveTo(n-d,i-a),e.lineTo(n+d,i+a),e.moveTo(n+h,i-o),e.lineTo(n-h,i+o),g+=bx,d=Math.cos(g)*(s?s/2:m),o=Math.cos(g)*m,a=Math.sin(g)*m,h=Math.sin(g)*(s?s/2:m),e.moveTo(n-d,i-a),e.lineTo(n+d,i+a),e.moveTo(n+h,i-o),e.lineTo(n-h,i+o);break;case"line":o=s?s/2:Math.cos(g)*m,a=Math.sin(g)*m,e.moveTo(n-o,i-a),e.lineTo(n+o,i+a);break;case"dash":e.moveTo(n,i),e.lineTo(n+Math.cos(g)*(s?s/2:m),i+Math.sin(g)*m);break;case!1:e.closePath()}e.fill(),t.borderWidth>0&&e.stroke()}}function x_(e,t,n){return n=n||.5,!t||e&&e.x>t.left-n&&e.x<t.right+n&&e.y>t.top-n&&e.y<t.bottom+n}function __(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function w_(e){e.restore()}function C_(e,t,n,i,s){if(!t)return e.lineTo(n.x,n.y);if("middle"===s){const i=(t.x+n.x)/2;e.lineTo(i,t.y),e.lineTo(i,n.y)}else"after"===s!==!!i?e.lineTo(t.x,n.y):e.lineTo(n.x,t.y);e.lineTo(n.x,n.y)}function N_(e,t,n,i){if(!t)return e.lineTo(n.x,n.y);e.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?n.cp2x:n.cp1x,i?n.cp2y:n.cp1y,n.x,n.y)}function k_(e,t,n,i,s){if(s.strikethrough||s.underline){const r=e.measureText(i),o=t-r.actualBoundingBoxLeft,a=t+r.actualBoundingBoxRight,l=n-r.actualBoundingBoxAscent,c=n+r.actualBoundingBoxDescent,u=s.strikethrough?(l+c)/2:c;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=s.decorationWidth||2,e.moveTo(o,u),e.lineTo(a,u),e.stroke()}}function E_(e,t){const n=e.fillStyle;e.fillStyle=t.color,e.fillRect(t.left,t.top,t.width,t.height),e.fillStyle=n}function T_(e,t,n,i,s){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const o=Gb(t)?t:[t],a=r.strokeWidth>0&&""!==r.strokeColor;let l,c;for(e.save(),e.font=s.string,function(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]),Wb(t.rotation)||e.rotate(t.rotation),t.color&&(e.fillStyle=t.color),t.textAlign&&(e.textAlign=t.textAlign),t.textBaseline&&(e.textBaseline=t.textBaseline)}(e,r),l=0;l<o.length;++l)c=o[l],r.backdrop&&E_(e,r.backdrop),a&&(r.strokeColor&&(e.strokeStyle=r.strokeColor),Wb(r.strokeWidth)||(e.lineWidth=r.strokeWidth),e.strokeText(c,n,i,r.maxWidth)),e.fillText(c,n,i,r.maxWidth),k_(e,n,i,c,r),i+=Number(s.lineHeight);e.restore()}function S_(e,t){const{x:n,y:i,w:s,h:r,radius:o}=t;e.arc(n+o.topLeft,i+o.topLeft,o.topLeft,1.5*fx,fx,!0),e.lineTo(n,i+r-o.bottomLeft),e.arc(n+o.bottomLeft,i+r-o.bottomLeft,o.bottomLeft,fx,vx,!0),e.lineTo(n+s-o.bottomRight,i+r),e.arc(n+s-o.bottomRight,i+r-o.bottomRight,o.bottomRight,vx,0,!0),e.lineTo(n+s,i+o.topRight),e.arc(n+s-o.topRight,i+o.topRight,o.topRight,0,-vx,!0),e.lineTo(n+o.topLeft,i)}const I_=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,P_=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function j_(e,t){const n=(""+e).match(I_);if(!n||"normal"===n[1])return 1.2*t;switch(e=+n[2],n[3]){case"px":return e;case"%":e/=100}return t*e}const A_=e=>+e||0;function D_(e,t){const n={},i=Kb(t),s=i?Object.keys(t):t,r=Kb(e)?i?n=>Xb(e[n],e[t[n]]):t=>e[t]:()=>e;for(const o of s)n[o]=A_(r(o));return n}function R_(e){return D_(e,{top:"y",right:"x",bottom:"y",left:"x"})}function M_(e){return D_(e,["topLeft","topRight","bottomLeft","bottomRight"])}function O_(e){const t=R_(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function L_(e,t){e=e||{},t=t||f_.font;let n=Xb(e.size,t.size);"string"===typeof n&&(n=parseInt(n,10));let i=Xb(e.style,t.style);i&&!(""+i).match(P_)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const s={family:Xb(e.family,t.family),lineHeight:j_(Xb(e.lineHeight,t.lineHeight),n),size:n,style:i,weight:Xb(e.weight,t.weight),string:""};return s.string=function(e){return!e||Wb(e.size)||Wb(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}(s),s}function F_(e,t,n,i){let s,r,o,a=!0;for(s=0,r=e.length;s<r;++s)if(o=e[s],void 0!==o&&(void 0!==t&&"function"===typeof o&&(o=o(t),a=!1),void 0!==n&&Gb(o)&&(o=o[n%o.length],a=!1),void 0!==o))return i&&!a&&(i.cacheable=!1),o}function z_(e,t){return Object.assign(Object.create(e),t)}function U_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[""],n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>e[0];const s=(arguments.length>2?arguments[2]:void 0)||e;"undefined"===typeof n&&(n=$_("_fallback",e));const r={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:s,_fallback:n,_getTarget:i,override:i=>U_([i,...e],t,s,n)};return new Proxy(r,{deleteProperty:(t,n)=>(delete t[n],delete t._keys,delete e[0][n],!0),get:(n,i)=>W_(n,i,()=>function(e,t,n,i){let s;for(const r of t)if(s=$_(H_(r,e),n),"undefined"!==typeof s)return q_(e,s)?Q_(n,i,e,s):s}(i,t,e,n)),getOwnPropertyDescriptor:(e,t)=>Reflect.getOwnPropertyDescriptor(e._scopes[0],t),getPrototypeOf:()=>Reflect.getPrototypeOf(e[0]),has:(e,t)=>J_(e).includes(t),ownKeys:e=>J_(e),set(e,t,n){const s=e._storage||(e._storage=i());return e[t]=s[t]=n,delete e._keys,!0}})}function V_(e,t,n,i){const s={_cacheable:!1,_proxy:e,_context:t,_subProxy:n,_stack:new Set,_descriptors:B_(e,i),setContext:t=>V_(e,t,n,i),override:s=>V_(e.override(s),t,n,i)};return new Proxy(s,{deleteProperty:(t,n)=>(delete t[n],delete e[n],!0),get:(e,t,n)=>W_(e,t,()=>function(e,t,n){const{_proxy:i,_context:s,_subProxy:r,_descriptors:o}=e;let a=i[t];dx(a)&&o.isScriptable(t)&&(a=function(e,t,n,i){const{_proxy:s,_context:r,_subProxy:o,_stack:a}=n;if(a.has(e))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+e);a.add(e);let l=t(r,o||i);a.delete(e),q_(e,l)&&(l=Q_(s._scopes,s,e,l));return l}(t,a,e,n));Gb(a)&&a.length&&(a=function(e,t,n,i){const{_proxy:s,_context:r,_subProxy:o,_descriptors:a}=n;if("undefined"!==typeof r.index&&i(e))return t[r.index%t.length];if(Kb(t[0])){const n=t,i=s._scopes.filter(e=>e!==n);t=[];for(const l of n){const n=Q_(i,s,e,l);t.push(V_(n,r,o&&o[e],a))}}return t}(t,a,e,o.isIndexable));q_(t,a)&&(a=V_(a,s,r&&r[t],o));return a}(e,t,n)),getOwnPropertyDescriptor:(t,n)=>t._descriptors.allKeys?Reflect.has(e,n)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,n),getPrototypeOf:()=>Reflect.getPrototypeOf(e),has:(t,n)=>Reflect.has(e,n),ownKeys:()=>Reflect.ownKeys(e),set:(t,n,i)=>(e[n]=i,delete t[n],!0)})}function B_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{scriptable:!0,indexable:!0};const{_scriptable:n=t.scriptable,_indexable:i=t.indexable,_allKeys:s=t.allKeys}=e;return{allKeys:s,scriptable:n,indexable:i,isScriptable:dx(n)?n:()=>n,isIndexable:dx(i)?i:()=>i}}const H_=(e,t)=>e?e+cx(t):t,q_=(e,t)=>Kb(t)&&"adapters"!==e&&(null===Object.getPrototypeOf(t)||t.constructor===Object);function W_(e,t,n){if(Object.prototype.hasOwnProperty.call(e,t)||"constructor"===t)return e[t];const i=n();return e[t]=i,i}function G_(e,t,n){return dx(e)?e(t,n):e}const K_=(e,t)=>!0===e?t:"string"===typeof e?lx(t,e):void 0;function Y_(e,t,n,i,s){for(const r of t){const t=K_(n,r);if(t){e.add(t);const r=G_(t._fallback,n,s);if("undefined"!==typeof r&&r!==n&&r!==i)return r}else if(!1===t&&"undefined"!==typeof i&&n!==i)return null}return!1}function Q_(e,t,n,i){const s=t._rootScopes,r=G_(t._fallback,n,i),o=[...e,...s],a=new Set;a.add(i);let l=X_(a,o,n,r||n,i);return null!==l&&(("undefined"===typeof r||r===n||(l=X_(a,o,r,l,i),null!==l))&&U_(Array.from(a),[""],s,r,()=>function(e,t,n){const i=e._getTarget();t in i||(i[t]={});const s=i[t];if(Gb(s)&&Kb(n))return n;return s||{}}(t,n,i)))}function X_(e,t,n,i,s){for(;n;)n=Y_(e,t,n,i,s);return n}function $_(e,t){for(const n of t){if(!n)continue;const t=n[e];if("undefined"!==typeof t)return t}}function J_(e){let t=e._keys;return t||(t=e._keys=function(e){const t=new Set;for(const n of e)for(const e of Object.keys(n).filter(e=>!e.startsWith("_")))t.add(e);return Array.from(t)}(e._scopes)),t}function Z_(e,t,n,i){const{iScale:s}=e,{key:r="r"}=this._parsing,o=new Array(i);let a,l,c,u;for(a=0,l=i;a<l;++a)c=a+n,u=t[c],o[a]={r:s.parse(lx(u,r),c)};return o}const ew=Number.EPSILON||1e-14,tw=(e,t)=>t<e.length&&!e[t].skip&&e[t],nw=e=>"x"===e?"y":"x";function iw(e,t,n,i){const s=e.skip?t:e,r=t,o=n.skip?t:n,a=jx(r,s),l=jx(o,r);let c=a/(a+l),u=l/(a+l);c=isNaN(c)?0:c,u=isNaN(u)?0:u;const d=i*c,h=i*u;return{previous:{x:r.x-d*(o.x-s.x),y:r.y-d*(o.y-s.y)},next:{x:r.x+h*(o.x-s.x),y:r.y+h*(o.y-s.y)}}}function sw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x";const n=nw(t),i=e.length,s=Array(i).fill(0),r=Array(i);let o,a,l,c=tw(e,0);for(o=0;o<i;++o)if(a=l,l=c,c=tw(e,o+1),l){if(c){const e=c[t]-l[t];s[o]=0!==e?(c[n]-l[n])/e:0}r[o]=a?c?wx(s[o-1])!==wx(s[o])?0:(s[o-1]+s[o])/2:s[o-1]:s[o]}!function(e,t,n){const i=e.length;let s,r,o,a,l,c=tw(e,0);for(let u=0;u<i-1;++u)l=c,c=tw(e,u+1),l&&c&&(Cx(t[u],0,ew)?n[u]=n[u+1]=0:(s=n[u]/t[u],r=n[u+1]/t[u],a=Math.pow(s,2)+Math.pow(r,2),a<=9||(o=3/Math.sqrt(a),n[u]=s*o*t[u],n[u+1]=r*o*t[u])))}(e,s,r),function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"x";const i=nw(n),s=e.length;let r,o,a,l=tw(e,0);for(let c=0;c<s;++c){if(o=a,a=l,l=tw(e,c+1),!a)continue;const s=a[n],u=a[i];o&&(r=(s-o[n])/3,a["cp1".concat(n)]=s-r,a["cp1".concat(i)]=u-r*t[c]),l&&(r=(l[n]-s)/3,a["cp2".concat(n)]=s+r,a["cp2".concat(i)]=u+r*t[c])}}(e,r,t)}function rw(e,t,n){return Math.max(Math.min(e,n),t)}function ow(e,t,n,i,s){let r,o,a,l;if(t.spanGaps&&(e=e.filter(e=>!e.skip)),"monotone"===t.cubicInterpolationMode)sw(e,s);else{let n=i?e[e.length-1]:e[0];for(r=0,o=e.length;r<o;++r)a=e[r],l=iw(n,a,e[Math.min(r+1,o-(i?0:1))%o],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,n=a}t.capBezierPoints&&function(e,t){let n,i,s,r,o,a=x_(e[0],t);for(n=0,i=e.length;n<i;++n)o=r,r=a,a=n<i-1&&x_(e[n+1],t),r&&(s=e[n],o&&(s.cp1x=rw(s.cp1x,t.left,t.right),s.cp1y=rw(s.cp1y,t.top,t.bottom)),a&&(s.cp2x=rw(s.cp2x,t.left,t.right),s.cp2y=rw(s.cp2y,t.top,t.bottom)))}(e,n)}function aw(){return"undefined"!==typeof window&&"undefined"!==typeof document}function lw(e){let t=e.parentNode;return t&&"[object ShadowRoot]"===t.toString()&&(t=t.host),t}function cw(e,t,n){let i;return"string"===typeof e?(i=parseInt(e,10),-1!==e.indexOf("%")&&(i=i/100*t.parentNode[n])):i=e,i}const uw=e=>e.ownerDocument.defaultView.getComputedStyle(e,null);const dw=["top","right","bottom","left"];function hw(e,t,n){const i={};n=n?"-"+n:"";for(let s=0;s<4;s++){const r=dw[s];i[r]=parseFloat(e[t+"-"+r+n])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}function fw(e,t){if("native"in e)return e;const{canvas:n,currentDevicePixelRatio:i}=t,s=uw(n),r="border-box"===s.boxSizing,o=hw(s,"padding"),a=hw(s,"border","width"),{x:l,y:c,box:u}=function(e,t){const n=e.touches,i=n&&n.length?n[0]:e,{offsetX:s,offsetY:r}=i;let o,a,l=!1;if(((e,t,n)=>(e>0||t>0)&&(!n||!n.shadowRoot))(s,r,e.target))o=s,a=r;else{const e=t.getBoundingClientRect();o=i.clientX-e.left,a=i.clientY-e.top,l=!0}return{x:o,y:a,box:l}}(e,n),d=o.left+(u&&a.left),h=o.top+(u&&a.top);let{width:f,height:p}=t;return r&&(f-=o.width+a.width,p-=o.height+a.height),{x:Math.round((l-d)/f*n.width/i),y:Math.round((c-h)/p*n.height/i)}}const pw=e=>Math.round(10*e)/10;function mw(e,t,n,i){const s=uw(e),r=hw(s,"margin"),o=cw(s.maxWidth,e,"clientWidth")||gx,a=cw(s.maxHeight,e,"clientHeight")||gx,l=function(e,t,n){let i,s;if(void 0===t||void 0===n){const r=e&&lw(e);if(r){const e=r.getBoundingClientRect(),o=uw(r),a=hw(o,"border","width"),l=hw(o,"padding");t=e.width-l.width-a.width,n=e.height-l.height-a.height,i=cw(o.maxWidth,r,"clientWidth"),s=cw(o.maxHeight,r,"clientHeight")}else t=e.clientWidth,n=e.clientHeight}return{width:t,height:n,maxWidth:i||gx,maxHeight:s||gx}}(e,t,n);let{width:c,height:u}=l;if("content-box"===s.boxSizing){const e=hw(s,"border","width"),t=hw(s,"padding");c-=t.width+e.width,u-=t.height+e.height}c=Math.max(0,c-r.width),u=Math.max(0,i?c/i:u-r.height),c=pw(Math.min(c,o,l.maxWidth)),u=pw(Math.min(u,a,l.maxHeight)),c&&!u&&(u=pw(c/2));return(void 0!==t||void 0!==n)&&i&&l.height&&u>l.height&&(u=l.height,c=pw(Math.floor(u*i))),{width:c,height:u}}function gw(e,t,n){const i=t||1,s=Math.floor(e.height*i),r=Math.floor(e.width*i);e.height=Math.floor(e.height),e.width=Math.floor(e.width);const o=e.canvas;return o.style&&(n||!o.style.height&&!o.style.width)&&(o.style.height="".concat(e.height,"px"),o.style.width="".concat(e.width,"px")),(e.currentDevicePixelRatio!==i||o.height!==s||o.width!==r)&&(e.currentDevicePixelRatio=i,o.height=s,o.width=r,e.ctx.setTransform(i,0,0,i,0,0),!0)}const yw=function(){let e=!1;try{const t={get passive(){return e=!0,!1}};aw()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch(t){}return e}();function vw(e,t){const n=function(e,t){return uw(e).getPropertyValue(t)}(e,t),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function bw(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}}function xw(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:"middle"===i?n<.5?e.y:t.y:"after"===i?n<1?e.y:t.y:n>0?t.y:e.y}}function _w(e,t,n,i){const s={x:e.cp2x,y:e.cp2y},r={x:t.cp1x,y:t.cp1y},o=bw(e,s,n),a=bw(s,r,n),l=bw(r,t,n),c=bw(o,a,n),u=bw(a,l,n);return bw(c,u,n)}function ww(e,t,n){return e?function(e,t){return{x:n=>e+e+t-n,setWidth(e){t=e},textAlign:e=>"center"===e?e:"right"===e?"left":"right",xPlus:(e,t)=>e-t,leftForLtr:(e,t)=>e-t}}(t,n):{x:e=>e,setWidth(e){},textAlign:e=>e,xPlus:(e,t)=>e+t,leftForLtr:(e,t)=>e}}function Cw(e,t){let n,i;"ltr"!==t&&"rtl"!==t||(n=e.canvas.style,i=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",t,"important"),e.prevTextDirection=i)}function Nw(e,t){void 0!==t&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function kw(e){return"angle"===e?{between:Rx,compare:Ax,normalize:Dx}:{between:Ox,compare:(e,t)=>e-t,normalize:e=>e}}function Ew(e){let{start:t,end:n,count:i,loop:s,style:r}=e;return{start:t%i,end:n%i,loop:s&&(n-t+1)%i===0,style:r}}function Tw(e,t,n){if(!n)return[e];const{property:i,start:s,end:r}=n,o=t.length,{compare:a,between:l,normalize:c}=kw(i),{start:u,end:d,loop:h,style:f}=function(e,t,n){const{property:i,start:s,end:r}=n,{between:o,normalize:a}=kw(i),l=t.length;let c,u,{start:d,end:h,loop:f}=e;if(f){for(d+=l,h+=l,c=0,u=l;c<u&&o(a(t[d%l][i]),s,r);++c)d--,h--;d%=l,h%=l}return h<d&&(h+=l),{start:d,end:h,loop:f,style:e.style}}(e,t,n),p=[];let m,g,y,v=!1,b=null;const x=()=>v||l(s,y,m)&&0!==a(s,y),_=()=>!v||0===a(r,m)||l(r,y,m);for(let w=u,C=u;w<=d;++w)g=t[w%o],g.skip||(m=c(g[i]),m!==y&&(v=l(m,s,r),null===b&&x()&&(b=0===a(m,s)?w:C),null!==b&&_()&&(p.push(Ew({start:b,end:w,loop:h,count:o,style:f})),b=null),C=w,y=m));return null!==b&&p.push(Ew({start:b,end:d,loop:h,count:o,style:f})),p}function Sw(e,t){const n=[],i=e.segments;for(let s=0;s<i.length;s++){const r=Tw(i[s],e.points,t);r.length&&n.push(...r)}return n}function Iw(e,t,n,i){return i&&i.setContext&&n?function(e,t,n,i){const s=e._chart.getContext(),r=Pw(e.options),{_datasetIndex:o,options:{spanGaps:a}}=e,l=n.length,c=[];let u=r,d=t[0].start,h=d;function f(e,t,i,s){const r=a?-1:1;if(e!==t){for(e+=l;n[e%l].skip;)e-=r;for(;n[t%l].skip;)t+=r;e%l!==t%l&&(c.push({start:e%l,end:t%l,loop:i,style:s}),u=s,d=t%l)}}for(const p of t){d=a?d:p.start;let e,t=n[d%l];for(h=d+1;h<=p.end;h++){const r=n[h%l];e=Pw(i.setContext(z_(s,{type:"segment",p0:t,p1:r,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:o}))),jw(e,u)&&f(d,h-1,p.loop,u),t=r,u=e}d<h-1&&f(d,h-1,p.loop,u)}return c}(e,t,n,i):t}function Pw(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function jw(e,t){if(!t)return!1;const n=[],i=function(e,t){return Zx(t)?(n.includes(t)||n.push(t),n.indexOf(t)):t};return JSON.stringify(e,i)!==JSON.stringify(t,i)}function Aw(e,t,n){return e.options.clip?e[n]:t[n]}function Dw(e,t){const n=t._clip;if(n.disabled)return!1;const i=function(e,t){const{xScale:n,yScale:i}=e;return n&&i?{left:Aw(n,t,"left"),right:Aw(n,t,"right"),top:Aw(i,t,"top"),bottom:Aw(i,t,"bottom")}:t}(t,e.chartArea);return{left:!1===n.left?0:i.left-(!0===n.left?0:n.left),right:!1===n.right?e.width:i.right+(!0===n.right?0:n.right),top:!1===n.top?0:i.top-(!0===n.top?0:n.top),bottom:!1===n.bottom?e.height:i.bottom+(!0===n.bottom?0:n.bottom)}}class Rw{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,n,i){const s=t.listeners[i],r=t.duration;s.forEach(i=>i({chart:e,initial:t.initial,numSteps:r,currentStep:Math.min(n-t.start,r)}))}_refresh(){this._request||(this._running=!0,this._request=Hx.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),t=0;this._charts.forEach((n,i)=>{if(!n.running||!n.items.length)return;const s=n.items;let r,o=s.length-1,a=!1;for(;o>=0;--o)r=s[o],r._active?(r._total>n.duration&&(n.duration=r._total),r.tick(e),a=!0):(s[o]=s[s.length-1],s.pop());a&&(i.draw(),this._notify(i,n,e,"progress")),s.length||(n.running=!1,this._notify(i,n,e,"complete"),n.initial=!1),t+=s.length}),this._lastDate=e,0===t&&(this._running=!1)}_getAnims(e){const t=this._charts;let n=t.get(e);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,n)),n}listen(e,t,n){this._getAnims(e).listeners[t].push(n)}add(e,t){t&&t.length&&this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){const t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((e,t)=>Math.max(e,t._duration),0),this._refresh())}running(e){if(!this._running)return!1;const t=this._charts.get(e);return!!(t&&t.running&&t.items.length)}stop(e){const t=this._charts.get(e);if(!t||!t.items.length)return;const n=t.items;let i=n.length-1;for(;i>=0;--i)n[i].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var Mw=new Rw;const Ow="transparent",Lw={boolean:(e,t,n)=>n>.5?t:e,color(e,t,n){const i=e_(e||Ow),s=i.valid&&e_(t||Ow);return s&&s.valid?s.mix(i,n).hexString():t},number:(e,t,n)=>e+(t-e)*n};class Fw{constructor(e,t,n,i){const s=t[n];i=F_([e.to,i,s,e.from]);const r=F_([e.from,s,i]);this._active=!0,this._fn=e.fn||Lw[e.type||typeof r],this._easing=Jx[e.easing]||Jx.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=n,this._from=r,this._to=i,this._promises=void 0}active(){return this._active}update(e,t,n){if(this._active){this._notify(!1);const i=this._target[this._prop],s=n-this._start,r=this._duration-s;this._start=n,this._duration=Math.floor(Math.max(r,e.duration)),this._total+=s,this._loop=!!e.loop,this._to=F_([e.to,t,i,e.from]),this._from=F_([e.from,i,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const t=e-this._start,n=this._duration,i=this._prop,s=this._from,r=this._loop,o=this._to;let a;if(this._active=s!==o&&(r||t<n),!this._active)return this._target[i]=o,void this._notify(!0);t<0?this._target[i]=s:(a=t/n%2,a=r&&a>1?2-a:a,a=this._easing(Math.min(1,Math.max(0,a))),this._target[i]=this._fn(s,o,a))}wait(){const e=this._promises||(this._promises=[]);return new Promise((t,n)=>{e.push({res:t,rej:n})})}_notify(e){const t=e?"res":"rej",n=this._promises||[];for(let i=0;i<n.length;i++)n[i][t]()}}class zw{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!Kb(e))return;const t=Object.keys(f_.animation),n=this._properties;Object.getOwnPropertyNames(e).forEach(i=>{const s=e[i];if(!Kb(s))return;const r={};for(const e of t)r[e]=s[e];(Gb(s.properties)&&s.properties||[i]).forEach(e=>{e!==i&&n.has(e)||n.set(e,r)})})}_animateOptions(e,t){const n=t.options,i=function(e,t){if(!t)return;let n=e.options;if(!n)return void(e.options=t);n.$shared&&(e.options=n=Object.assign({},n,{$shared:!1,$animations:{}}));return n}(e,n);if(!i)return[];const s=this._createAnimations(i,n);return n.$shared&&function(e,t){const n=[],i=Object.keys(t);for(let s=0;s<i.length;s++){const t=e[i[s]];t&&t.active()&&n.push(t.wait())}return Promise.all(n)}(e.options.$animations,n).then(()=>{e.options=n},()=>{}),s}_createAnimations(e,t){const n=this._properties,i=[],s=e.$animations||(e.$animations={}),r=Object.keys(t),o=Date.now();let a;for(a=r.length-1;a>=0;--a){const l=r[a];if("$"===l.charAt(0))continue;if("options"===l){i.push(...this._animateOptions(e,t));continue}const c=t[l];let u=s[l];const d=n.get(l);if(u){if(d&&u.active()){u.update(d,c,o);continue}u.cancel()}d&&d.duration?(s[l]=u=new Fw(d,e,l,c),i.push(u)):e[l]=c}return i}update(e,t){if(0===this._properties.size)return void Object.assign(e,t);const n=this._createAnimations(e,t);return n.length?(Mw.add(this._chart,n),!0):void 0}}function Uw(e,t){const n=e&&e.options||{},i=n.reverse,s=void 0===n.min?t:0,r=void 0===n.max?t:0;return{start:i?r:s,end:i?s:r}}function Vw(e,t){const n=[],i=e._getSortedDatasetMetas(t);let s,r;for(s=0,r=i.length;s<r;++s)n.push(i[s].index);return n}function Bw(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=e.keys,r="single"===i.mode;let o,a,l,c;if(null===t)return;let u=!1;for(o=0,a=s.length;o<a;++o){if(l=+s[o],l===n){if(u=!0,i.all)continue;break}c=e.values[l],Yb(c)&&(r||0===t||wx(t)===wx(c))&&(t+=c)}return u||i.all?t:0}function Hw(e,t){const n=e&&e.options.stacked;return n||void 0===n&&void 0!==t.stack}function qw(e,t,n){const i=e[t]||(e[t]={});return i[n]||(i[n]={})}function Ww(e,t,n,i){for(const s of t.getMatchingVisibleMetas(i).reverse()){const t=e[s.index];if(n&&t>0||!n&&t<0)return s.index}return null}function Gw(e,t){const{chart:n,_cachedMeta:i}=e,s=n._stacks||(n._stacks={}),{iScale:r,vScale:o,index:a}=i,l=r.axis,c=o.axis,u=function(e,t,n){return"".concat(e.id,".").concat(t.id,".").concat(n.stack||n.type)}(r,o,i),d=t.length;let h;for(let f=0;f<d;++f){const e=t[f],{[l]:n,[c]:r}=e;h=(e._stacks||(e._stacks={}))[c]=qw(s,u,n),h[a]=r,h._top=Ww(h,o,!0,i.type),h._bottom=Ww(h,o,!1,i.type);(h._visualValues||(h._visualValues={}))[a]=r}}function Kw(e,t){const n=e.scales;return Object.keys(n).filter(e=>n[e].axis===t).shift()}function Yw(e,t){const n=e.controller.index,i=e.vScale&&e.vScale.axis;if(i){t=t||e._parsed;for(const e of t){const t=e._stacks;if(!t||void 0===t[i]||void 0===t[i][n])return;delete t[i][n],void 0!==t[i]._visualValues&&void 0!==t[i]._visualValues[n]&&delete t[i]._visualValues[n]}}}const Qw=e=>"reset"===e||"none"===e,Xw=(e,t)=>t?e:Object.assign({},e);class $w{constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=Hw(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&Yw(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,t=this._cachedMeta,n=this.getDataset(),i=(e,t,n,i)=>"x"===e?t:"r"===e?i:n,s=t.xAxisID=Xb(n.xAxisID,Kw(e,"x")),r=t.yAxisID=Xb(n.yAxisID,Kw(e,"y")),o=t.rAxisID=Xb(n.rAxisID,Kw(e,"r")),a=t.indexAxis,l=t.iAxisID=i(a,s,r,o),c=t.vAxisID=i(a,r,s,o);t.xScale=this.getScaleForId(s),t.yScale=this.getScaleForId(r),t.rScale=this.getScaleForId(o),t.iScale=this.getScaleForId(l),t.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&Vx(this._data,this),e._stacked&&Yw(e)}_dataCheck(){const e=this.getDataset(),t=e.data||(e.data=[]),n=this._data;if(Kb(t)){const e=this._cachedMeta;this._data=function(e,t){const{iScale:n,vScale:i}=t,s="x"===n.axis?"x":"y",r="x"===i.axis?"x":"y",o=Object.keys(e),a=new Array(o.length);let l,c,u;for(l=0,c=o.length;l<c;++l)u=o[l],a[l]={[s]:u,[r]:e[u]};return a}(t,e)}else if(n!==t){if(n){Vx(n,this);const e=this._cachedMeta;Yw(e),e._parsed=[]}t&&Object.isExtensible(t)&&(s=this,(i=t)._chartjs?i._chartjs.listeners.push(s):(Object.defineProperty(i,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[s]}}),Ux.forEach(e=>{const t="_onData"+cx(e),n=i[e];Object.defineProperty(i,e,{configurable:!0,enumerable:!1,value(){for(var e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];const o=n.apply(this,s);return i._chartjs.listeners.forEach(e=>{"function"===typeof e[t]&&e[t](...s)}),o}})}))),this._syncList=[],this._data=t}var i,s}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const t=this._cachedMeta,n=this.getDataset();let i=!1;this._dataCheck();const s=t._stacked;t._stacked=Hw(t.vScale,t),t.stack!==n.stack&&(i=!0,Yw(t),t.stack=n.stack),this._resyncElements(e),(i||s!==t._stacked)&&(Gw(this,t._parsed),t._stacked=Hw(t.vScale,t))}configure(){const e=this.chart.config,t=e.datasetScopeKeys(this._type),n=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){const{_cachedMeta:n,_data:i}=this,{iScale:s,_stacked:r}=n,o=s.axis;let a,l,c,u=0===e&&t===i.length||n._sorted,d=e>0&&n._parsed[e-1];if(!1===this._parsing)n._parsed=i,n._sorted=!0,c=i;else{c=Gb(i[e])?this.parseArrayData(n,i,e,t):Kb(i[e])?this.parseObjectData(n,i,e,t):this.parsePrimitiveData(n,i,e,t);const s=()=>null===l[o]||d&&l[o]<d[o];for(a=0;a<t;++a)n._parsed[a+e]=l=c[a],u&&(s()&&(u=!1),d=l);n._sorted=u}r&&Gw(this,c)}parsePrimitiveData(e,t,n,i){const{iScale:s,vScale:r}=e,o=s.axis,a=r.axis,l=s.getLabels(),c=s===r,u=new Array(i);let d,h,f;for(d=0,h=i;d<h;++d)f=d+n,u[d]={[o]:c||s.parse(l[f],f),[a]:r.parse(t[f],f)};return u}parseArrayData(e,t,n,i){const{xScale:s,yScale:r}=e,o=new Array(i);let a,l,c,u;for(a=0,l=i;a<l;++a)c=a+n,u=t[c],o[a]={x:s.parse(u[0],c),y:r.parse(u[1],c)};return o}parseObjectData(e,t,n,i){const{xScale:s,yScale:r}=e,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,l=new Array(i);let c,u,d,h;for(c=0,u=i;c<u;++c)d=c+n,h=t[d],l[c]={x:s.parse(lx(h,o),d),y:r.parse(lx(h,a),d)};return l}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,n){const i=this.chart,s=this._cachedMeta,r=t[e.axis];return Bw({keys:Vw(i,!0),values:t._stacks[e.axis]._visualValues},r,s.index,{mode:n})}updateRangeFromParsed(e,t,n,i){const s=n[t.axis];let r=null===s?NaN:s;const o=i&&n._stacks[t.axis];i&&o&&(i.values=o,r=Bw(i,s,this._cachedMeta.index)),e.min=Math.min(e.min,r),e.max=Math.max(e.max,r)}getMinMax(e,t){const n=this._cachedMeta,i=n._parsed,s=n._sorted&&e===n.iScale,r=i.length,o=this._getOtherScale(e),a=((e,t,n)=>e&&!t.hidden&&t._stacked&&{keys:Vw(n,!0),values:null})(t,n,this.chart),l={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:u}=function(e){const{min:t,max:n,minDefined:i,maxDefined:s}=e.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:s?n:Number.POSITIVE_INFINITY}}(o);let d,h;function f(){h=i[d];const t=h[o.axis];return!Yb(h[e.axis])||c>t||u<t}for(d=0;d<r&&(f()||(this.updateRangeFromParsed(l,e,h,a),!s));++d);if(s)for(d=r-1;d>=0;--d)if(!f()){this.updateRangeFromParsed(l,e,h,a);break}return l}getAllParsedValues(e){const t=this._cachedMeta._parsed,n=[];let i,s,r;for(i=0,s=t.length;i<s;++i)r=t[i][e.axis],Yb(r)&&n.push(r);return n}getMaxOverflow(){return!1}getLabelAndValue(e){const t=this._cachedMeta,n=t.iScale,i=t.vScale,s=this.getParsed(e);return{label:n?""+n.getLabelForValue(s[n.axis]):"",value:i?""+i.getLabelForValue(s[i.axis]):""}}_update(e){const t=this._cachedMeta;this.update(e||"default"),t._clip=function(e){let t,n,i,s;return Kb(e)?(t=e.top,n=e.right,i=e.bottom,s=e.left):t=n=i=s=e,{top:t,right:n,bottom:i,left:s,disabled:!1===e}}(Xb(this.options.clip,function(e,t,n){if(!1===n)return!1;const i=Uw(e,n),s=Uw(t,n);return{top:s.end,right:i.end,bottom:s.start,left:i.start}}(t.xScale,t.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,t=this.chart,n=this._cachedMeta,i=n.data||[],s=t.chartArea,r=[],o=this._drawStart||0,a=this._drawCount||i.length-o,l=this.options.drawActiveElementsOnTop;let c;for(n.dataset&&n.dataset.draw(e,s,o,a),c=o;c<o+a;++c){const t=i[c];t.hidden||(t.active&&l?r.push(t):t.draw(e,s))}for(c=0;c<r.length;++c)r[c].draw(e,s)}getStyle(e,t){const n=t?"active":"default";return void 0===e&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(e||0,n)}getContext(e,t,n){const i=this.getDataset();let s;if(e>=0&&e<this._cachedMeta.data.length){const t=this._cachedMeta.data[e];s=t.$context||(t.$context=function(e,t,n){return z_(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:n,index:t,mode:"default",type:"data"})}(this.getContext(),e,t)),s.parsed=this.getParsed(e),s.raw=i.data[e],s.index=s.dataIndex=e}else s=this.$context||(this.$context=function(e,t){return z_(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}(this.chart.getContext(),this.index)),s.dataset=i,s.index=s.datasetIndex=this.index;return s.active=!!t,s.mode=n,s}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",n=arguments.length>2?arguments[2]:void 0;const i="active"===t,s=this._cachedDataOpts,r=e+"-"+t,o=s[r],a=this.enableOptionSharing&&ux(n);if(o)return Xw(o,a);const l=this.chart.config,c=l.datasetElementScopeKeys(this._type,e),u=i?["".concat(e,"Hover"),"hover",e,""]:[e,""],d=l.getOptionScopes(this.getDataset(),c),h=Object.keys(f_.elements[e]),f=l.resolveNamedOptions(d,h,()=>this.getContext(n,i,t),u);return f.$shared&&(f.$shared=a,s[r]=Object.freeze(Xw(f,a))),f}_resolveAnimations(e,t,n){const i=this.chart,s=this._cachedDataOpts,r="animation-".concat(t),o=s[r];if(o)return o;let a;if(!1!==i.options.animation){const i=this.chart.config,s=i.datasetAnimationScopeKeys(this._type,t),r=i.getOptionScopes(this.getDataset(),s);a=i.createResolver(r,this.getContext(e,n,t))}const l=new zw(i,a&&a.animations);return a&&a._cacheable&&(s[r]=Object.freeze(l)),l}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||Qw(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){const n=this.resolveDataElementOptions(e,t),i=this._sharedOptions,s=this.getSharedOptions(n),r=this.includeOptions(t,s)||s!==i;return this.updateSharedOptions(s,t,n),{sharedOptions:s,includeOptions:r}}updateElement(e,t,n,i){Qw(i)?Object.assign(e,n):this._resolveAnimations(t,i).update(e,n)}updateSharedOptions(e,t,n){e&&!Qw(t)&&this._resolveAnimations(void 0,t).update(e,n)}_setStyle(e,t,n,i){e.active=i;const s=this.getStyle(t,i);this._resolveAnimations(t,n,i).update(e,{options:!i&&this.getSharedOptions(s)||s})}removeHoverStyle(e,t,n){this._setStyle(e,n,"active",!1)}setHoverStyle(e,t,n){this._setStyle(e,n,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const t=this._data,n=this._cachedMeta.data;for(const[o,a,l]of this._syncList)this[o](a,l);this._syncList=[];const i=n.length,s=t.length,r=Math.min(s,i);r&&this.parse(0,r),s>i?this._insertElements(i,s-i,e):s<i&&this._removeElements(s,i-s)}_insertElements(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const i=this._cachedMeta,s=i.data,r=e+t;let o;const a=e=>{for(e.length+=t,o=e.length-1;o>=r;o--)e[o]=e[o-t]};for(a(s),o=e;o<r;++o)s[o]=new this.dataElementType;this._parsing&&a(i._parsed),this.parse(e,t),n&&this.updateElements(s,e,t,"reset")}updateElements(e,t,n,i){}_removeElements(e,t){const n=this._cachedMeta;if(this._parsing){const i=n._parsed.splice(e,t);n._stacked&&Yw(n,i)}n.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[t,n,i]=e;this[t](n,i)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);const n=arguments.length-2;n&&this._sync(["_insertElements",e,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function Jw(e){const t=e.iScale,n=function(e,t){if(!e._cache.$bar){const n=e.getMatchingVisibleMetas(t);let i=[];for(let t=0,s=n.length;t<s;t++)i=i.concat(n[t].controller.getAllParsedValues(e));e._cache.$bar=Bx(i.sort((e,t)=>e-t))}return e._cache.$bar}(t,e.type);let i,s,r,o,a=t._length;const l=()=>{32767!==r&&-32768!==r&&(ux(o)&&(a=Math.min(a,Math.abs(r-o)||a)),o=r)};for(i=0,s=n.length;i<s;++i)r=t.getPixelForValue(n[i]),l();for(o=void 0,i=0,s=t.ticks.length;i<s;++i)r=t.getPixelForTick(i),l();return a}function Zw(e,t,n,i){return Gb(e)?function(e,t,n,i){const s=n.parse(e[0],i),r=n.parse(e[1],i),o=Math.min(s,r),a=Math.max(s,r);let l=o,c=a;Math.abs(o)>Math.abs(a)&&(l=a,c=o),t[n.axis]=c,t._custom={barStart:l,barEnd:c,start:s,end:r,min:o,max:a}}(e,t,n,i):t[n.axis]=n.parse(e,i),t}function eC(e,t,n,i){const s=e.iScale,r=e.vScale,o=s.getLabels(),a=s===r,l=[];let c,u,d,h;for(c=n,u=n+i;c<u;++c)h=t[c],d={},d[s.axis]=a||s.parse(o[c],c),l.push(Zw(h,d,r,c));return l}function tC(e){return e&&void 0!==e.barStart&&void 0!==e.barEnd}function nC(e,t,n,i){let s=t.borderSkipped;const r={};if(!s)return void(e.borderSkipped=r);if(!0===s)return void(e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0});const{start:o,end:a,reverse:l,top:c,bottom:u}=function(e){let t,n,i,s,r;return e.horizontal?(t=e.base>e.x,n="left",i="right"):(t=e.base<e.y,n="bottom",i="top"),t?(s="end",r="start"):(s="start",r="end"),{start:n,end:i,reverse:t,top:s,bottom:r}}(e);"middle"===s&&n&&(e.enableBorderRadius=!0,(n._top||0)===i?s=c:(n._bottom||0)===i?s=u:(r[iC(u,o,a,l)]=!0,s=c)),r[iC(s,o,a,l)]=!0,e.borderSkipped=r}function iC(e,t,n,i){var s,r,o;return i?(o=n,e=sC(e=(s=e)===(r=t)?o:s===o?r:s,n,t)):e=sC(e,t,n),e}function sC(e,t,n){return"start"===e?t:"end"===e?n:e}function rC(e,t,n){let{inflateAmount:i}=t;e.inflateAmount="auto"===i?1===n?.33:0:i}a($w,"defaults",{}),a($w,"datasetElementType",null),a($w,"dataElementType",null);class oC extends $w{parsePrimitiveData(e,t,n,i){return eC(e,t,n,i)}parseArrayData(e,t,n,i){return eC(e,t,n,i)}parseObjectData(e,t,n,i){const{iScale:s,vScale:r}=e,{xAxisKey:o="x",yAxisKey:a="y"}=this._parsing,l="x"===s.axis?o:a,c="x"===r.axis?o:a,u=[];let d,h,f,p;for(d=n,h=n+i;d<h;++d)p=t[d],f={},f[s.axis]=s.parse(lx(p,l),d),u.push(Zw(lx(p,c),f,r,d));return u}updateRangeFromParsed(e,t,n,i){super.updateRangeFromParsed(e,t,n,i);const s=n._custom;s&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,s.min),e.max=Math.max(e.max,s.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const t=this._cachedMeta,{iScale:n,vScale:i}=t,s=this.getParsed(e),r=s._custom,o=tC(r)?"["+r.start+", "+r.end+"]":""+i.getLabelForValue(s[i.axis]);return{label:""+n.getLabelForValue(s[n.axis]),value:o}}initialize(){this.enableOptionSharing=!0,super.initialize();this._cachedMeta.stack=this.getDataset().stack}update(e){const t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,n,i){const s="reset"===i,{index:r,_cachedMeta:{vScale:o}}=this,a=o.getBasePixel(),l=o.isHorizontal(),c=this._getRuler(),{sharedOptions:u,includeOptions:d}=this._getSharedOptions(t,i);for(let h=t;h<t+n;h++){const t=this.getParsed(h),n=s||Wb(t[o.axis])?{base:a,head:a}:this._calculateBarValuePixels(h),f=this._calculateBarIndexPixels(h,c),p=(t._stacks||{})[o.axis],m={horizontal:l,base:n.base,enableBorderRadius:!p||tC(t._custom)||r===p._top||r===p._bottom,x:l?n.head:f.center,y:l?f.center:n.head,height:l?f.size:Math.abs(n.size),width:l?Math.abs(n.size):f.size};d&&(m.options=u||this.resolveDataElementOptions(h,e[h].active?"active":i));const g=m.options||e[h].options;nC(m,g,p,r),rC(m,g,c.ratio),this.updateElement(e[h],h,m,i)}}_getStacks(e,t){const{iScale:n}=this._cachedMeta,i=n.getMatchingVisibleMetas(this._type).filter(e=>e.controller.options.grouped),s=n.options.stacked,r=[],o=this._cachedMeta.controller.getParsed(t),a=o&&o[n.axis],l=e=>{const t=e._parsed.find(e=>e[n.axis]===a),i=t&&t[e.vScale.axis];if(Wb(i)||isNaN(i))return!0};for(const c of i)if((void 0===t||!l(c))&&((!1===s||-1===r.indexOf(c.stack)||void 0===s&&void 0===c.stack)&&r.push(c.stack),c.index===e))break;return r.length||r.push(void 0),r}_getStackCount(e){return this._getStacks(void 0,e).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const e=this.chart.scales,t=this.chart.options.indexAxis;return Object.keys(e).filter(n=>e[n].axis===t).shift()}_getAxis(){const e={},t=this.getFirstScaleIdForIndexAxis();for(const n of this.chart.data.datasets)e[Xb("x"===this.chart.options.indexAxis?n.xAxisID:n.yAxisID,t)]=!0;return Object.keys(e)}_getStackIndex(e,t,n){const i=this._getStacks(e,n),s=void 0!==t?i.indexOf(t):-1;return-1===s?i.length-1:s}_getRuler(){const e=this.options,t=this._cachedMeta,n=t.iScale,i=[];let s,r;for(s=0,r=t.data.length;s<r;++s)i.push(n.getPixelForValue(this.getParsed(s)[n.axis],s));const o=e.barThickness;return{min:o||Jw(t),pixels:i,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:e.grouped,ratio:o?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:t,_stacked:n,index:i},options:{base:s,minBarLength:r}}=this,o=s||0,a=this.getParsed(e),l=a._custom,c=tC(l);let u,d,h=a[t.axis],f=0,p=n?this.applyStack(t,a,n):h;p!==h&&(f=p-h,p=h),c&&(h=l.barStart,p=l.barEnd-l.barStart,0!==h&&wx(h)!==wx(l.barEnd)&&(f=0),f+=h);const m=Wb(s)||c?f:s;let g=t.getPixelForValue(m);if(u=this.chart.getDataVisibility(e)?t.getPixelForValue(f+p):g,d=u-g,Math.abs(d)<r){d=function(e,t,n){return 0!==e?wx(e):(t.isHorizontal()?1:-1)*(t.min>=n?1:-1)}(d,t,o)*r,h===o&&(g-=d/2);const e=t.getPixelForDecimal(0),s=t.getPixelForDecimal(1),l=Math.min(e,s),f=Math.max(e,s);g=Math.max(Math.min(g,f),l),u=g+d,n&&!c&&(a._stacks[t.axis]._visualValues[i]=t.getValueForPixel(u)-t.getValueForPixel(g))}if(g===t.getPixelForValue(o)){const e=wx(d)*t.getLineWidthForValue(o)/2;g+=e,d-=e}return{size:d,base:g,head:u,center:u+d/2}}_calculateBarIndexPixels(e,t){const n=t.scale,i=this.options,s=i.skipNull,r=Xb(i.maxBarThickness,1/0);let o,a;const l=this._getAxisCount();if(t.grouped){const n=s?this._getStackCount(e):t.stackCount,c="flex"===i.barThickness?function(e,t,n,i){const s=t.pixels,r=s[e];let o=e>0?s[e-1]:null,a=e<s.length-1?s[e+1]:null;const l=n.categoryPercentage;null===o&&(o=r-(null===a?t.end-t.start:a-r)),null===a&&(a=r+r-o);const c=r-(r-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/i,ratio:n.barPercentage,start:c}}(e,t,i,n*l):function(e,t,n,i){const s=n.barThickness;let r,o;return Wb(s)?(r=t.min*n.categoryPercentage,o=n.barPercentage):(r=s*i,o=1),{chunk:r/i,ratio:o,start:t.pixels[e]-r/2}}(e,t,i,n*l),u="x"===this.chart.options.indexAxis?this.getDataset().xAxisID:this.getDataset().yAxisID,d=this._getAxis().indexOf(Xb(u,this.getFirstScaleIdForIndexAxis())),h=this._getStackIndex(this.index,this._cachedMeta.stack,s?e:void 0)+d;o=c.start+c.chunk*h+c.chunk/2,a=Math.min(r,c.chunk*c.ratio)}else o=n.getPixelForValue(this.getParsed(e)[n.axis],e),a=Math.min(r,t.min*t.ratio);return{base:o-a/2,head:o+a/2,center:o,size:a}}draw(){const e=this._cachedMeta,t=e.vScale,n=e.data,i=n.length;let s=0;for(;s<i;++s)null===this.getParsed(s)[t.axis]||n[s].hidden||n[s].draw(this._ctx)}}a(oC,"id","bar"),a(oC,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),a(oC,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class aC extends $w{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,n,i){const s=super.parsePrimitiveData(e,t,n,i);for(let r=0;r<s.length;r++)s[r]._custom=this.resolveDataElementOptions(r+n).radius;return s}parseArrayData(e,t,n,i){const s=super.parseArrayData(e,t,n,i);for(let r=0;r<s.length;r++){const e=t[n+r];s[r]._custom=Xb(e[2],this.resolveDataElementOptions(r+n).radius)}return s}parseObjectData(e,t,n,i){const s=super.parseObjectData(e,t,n,i);for(let r=0;r<s.length;r++){const e=t[n+r];s[r]._custom=Xb(e&&e.r&&+e.r,this.resolveDataElementOptions(r+n).radius)}return s}getMaxOverflow(){const e=this._cachedMeta.data;let t=0;for(let n=e.length-1;n>=0;--n)t=Math.max(t,e[n].size(this.resolveDataElementOptions(n))/2);return t>0&&t}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart.data.labels||[],{xScale:i,yScale:s}=t,r=this.getParsed(e),o=i.getLabelForValue(r.x),a=s.getLabelForValue(r.y),l=r._custom;return{label:n[e]||"",value:"("+o+", "+a+(l?", "+l:"")+")"}}update(e){const t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,n,i){const s="reset"===i,{iScale:r,vScale:o}=this._cachedMeta,{sharedOptions:a,includeOptions:l}=this._getSharedOptions(t,i),c=r.axis,u=o.axis;for(let d=t;d<t+n;d++){const t=e[d],n=!s&&this.getParsed(d),h={},f=h[c]=s?r.getPixelForDecimal(.5):r.getPixelForValue(n[c]),p=h[u]=s?o.getBasePixel():o.getPixelForValue(n[u]);h.skip=isNaN(f)||isNaN(p),l&&(h.options=a||this.resolveDataElementOptions(d,t.active?"active":i),s&&(h.options.radius=0)),this.updateElement(t,d,h,i)}}resolveDataElementOptions(e,t){const n=this.getParsed(e);let i=super.resolveDataElementOptions(e,t);i.$shared&&(i=Object.assign({},i,{$shared:!1}));const s=i.radius;return"active"!==t&&(i.radius=0),i.radius+=Xb(n&&n._custom,s),i}}a(aC,"id","bubble"),a(aC,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),a(aC,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});class lC extends $w{constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){const n=this.getDataset().data,i=this._cachedMeta;if(!1===this._parsing)i._parsed=n;else{let s,r,o=e=>+n[e];if(Kb(n[e])){const{key:e="value"}=this._parsing;o=t=>+lx(n[t],e)}for(s=e,r=e+t;s<r;++s)i._parsed[s]=o(s)}}_getRotation(){return Tx(this.options.rotation-90)}_getCircumference(){return Tx(this.options.circumference)}_getRotationExtents(){let e=px,t=-px;for(let n=0;n<this.chart.data.datasets.length;++n)if(this.chart.isDatasetVisible(n)&&this.chart.getDatasetMeta(n).type===this._type){const i=this.chart.getDatasetMeta(n).controller,s=i._getRotation(),r=i._getCircumference();e=Math.min(e,s),t=Math.max(t,s+r)}return{rotation:e,circumference:t-e}}update(e){const t=this.chart,{chartArea:n}=t,i=this._cachedMeta,s=i.data,r=this.getMaxBorderWidth()+this.getMaxOffset(s)+this.options.spacing,o=Math.max((Math.min(n.width,n.height)-r)/2,0),a=Math.min((l=this.options.cutout,c=o,"string"===typeof l&&l.endsWith("%")?parseFloat(l)/100:+l/c),1);var l,c;const u=this._getRingWeight(this.index),{circumference:d,rotation:h}=this._getRotationExtents(),{ratioX:f,ratioY:p,offsetX:m,offsetY:g}=function(e,t,n){let i=1,s=1,r=0,o=0;if(t<px){const a=e,l=a+t,c=Math.cos(a),u=Math.sin(a),d=Math.cos(l),h=Math.sin(l),f=(e,t,i)=>Rx(e,a,l,!0)?1:Math.max(t,t*n,i,i*n),p=(e,t,i)=>Rx(e,a,l,!0)?-1:Math.min(t,t*n,i,i*n),m=f(0,c,d),g=f(vx,u,h),y=p(fx,c,d),v=p(fx+vx,u,h);i=(m-y)/2,s=(g-v)/2,r=-(m+y)/2,o=-(g+v)/2}return{ratioX:i,ratioY:s,offsetX:r,offsetY:o}}(h,d,a),y=(n.width-r)/f,v=(n.height-r)/p,b=Math.max(Math.min(y,v)/2,0),x=$b(this.options.radius,b),_=(x-Math.max(x*a,0))/this._getVisibleDatasetWeightTotal();this.offsetX=m*x,this.offsetY=g*x,i.total=this.calculateTotal(),this.outerRadius=x-_*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-_*u,0),this.updateElements(s,0,s.length,e)}_circumference(e,t){const n=this.options,i=this._cachedMeta,s=this._getCircumference();return t&&n.animation.animateRotate||!this.chart.getDataVisibility(e)||null===i._parsed[e]||i.data[e].hidden?0:this.calculateCircumference(i._parsed[e]*s/px)}updateElements(e,t,n,i){const s="reset"===i,r=this.chart,o=r.chartArea,a=r.options.animation,l=(o.left+o.right)/2,c=(o.top+o.bottom)/2,u=s&&a.animateScale,d=u?0:this.innerRadius,h=u?0:this.outerRadius,{sharedOptions:f,includeOptions:p}=this._getSharedOptions(t,i);let m,g=this._getRotation();for(m=0;m<t;++m)g+=this._circumference(m,s);for(m=t;m<t+n;++m){const t=this._circumference(m,s),n=e[m],r={x:l+this.offsetX,y:c+this.offsetY,startAngle:g,endAngle:g+t,circumference:t,outerRadius:h,innerRadius:d};p&&(r.options=f||this.resolveDataElementOptions(m,n.active?"active":i)),g+=t,this.updateElement(n,m,r,i)}}calculateTotal(){const e=this._cachedMeta,t=e.data;let n,i=0;for(n=0;n<t.length;n++){const s=e._parsed[n];null===s||isNaN(s)||!this.chart.getDataVisibility(n)||t[n].hidden||(i+=Math.abs(s))}return i}calculateCircumference(e){const t=this._cachedMeta.total;return t>0&&!isNaN(e)?px*(Math.abs(e)/t):0}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart,i=n.data.labels||[],s=r_(t._parsed[e],n.options.locale);return{label:i[e]||"",value:s}}getMaxBorderWidth(e){let t=0;const n=this.chart;let i,s,r,o,a;if(!e)for(i=0,s=n.data.datasets.length;i<s;++i)if(n.isDatasetVisible(i)){r=n.getDatasetMeta(i),e=r.data,o=r.controller;break}if(!e)return 0;for(i=0,s=e.length;i<s;++i)a=o.resolveDataElementOptions(i),"inner"!==a.borderAlign&&(t=Math.max(t,a.borderWidth||0,a.hoverBorderWidth||0));return t}getMaxOffset(e){let t=0;for(let n=0,i=e.length;n<i;++n){const e=this.resolveDataElementOptions(n);t=Math.max(t,e.offset||0,e.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let n=0;n<e;++n)this.chart.isDatasetVisible(n)&&(t+=this._getRingWeight(n));return t}_getRingWeight(e){return Math.max(Xb(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}a(lC,"id","doughnut"),a(lC,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),a(lC,"descriptors",{_scriptable:e=>"spacing"!==e,_indexable:e=>"spacing"!==e&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")}),a(lC,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:n,color:i}}=e.legend.options;return t.labels.map((t,s)=>{const r=e.getDatasetMeta(0).controller.getStyle(s);return{text:t,fillStyle:r.backgroundColor,strokeStyle:r.borderColor,fontColor:i,lineWidth:r.borderWidth,pointStyle:n,hidden:!e.getDataVisibility(s),index:s}})}return[]}},onClick(e,t,n){n.chart.toggleDataVisibility(t.index),n.chart.update()}}}});class cC extends $w{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const t=this._cachedMeta,{dataset:n,data:i=[],_dataset:s}=t,r=this.chart._animationsDisabled;let{start:o,count:a}=Kx(t,i,r);this._drawStart=o,this._drawCount=a,Yx(t)&&(o=0,a=i.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!s._decimated,n.points=i;const l=this.resolveDatasetElementOptions(e);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(n,void 0,{animated:!r,options:l},e),this.updateElements(i,o,a,e)}updateElements(e,t,n,i){const s="reset"===i,{iScale:r,vScale:o,_stacked:a,_dataset:l}=this._cachedMeta,{sharedOptions:c,includeOptions:u}=this._getSharedOptions(t,i),d=r.axis,h=o.axis,{spanGaps:f,segment:p}=this.options,m=kx(f)?f:Number.POSITIVE_INFINITY,g=this.chart._animationsDisabled||s||"none"===i,y=t+n,v=e.length;let b=t>0&&this.getParsed(t-1);for(let x=0;x<v;++x){const n=e[x],f=g?n:{};if(x<t||x>=y){f.skip=!0;continue}const v=this.getParsed(x),_=Wb(v[h]),w=f[d]=r.getPixelForValue(v[d],x),C=f[h]=s||_?o.getBasePixel():o.getPixelForValue(a?this.applyStack(o,v,a):v[h],x);f.skip=isNaN(w)||isNaN(C)||_,f.stop=x>0&&Math.abs(v[d]-b[d])>m,p&&(f.parsed=v,f.raw=l.data[x]),u&&(f.options=c||this.resolveDataElementOptions(x,n.active?"active":i)),g||this.updateElement(n,x,f,i),b=v}}getMaxOverflow(){const e=this._cachedMeta,t=e.dataset,n=t.options&&t.options.borderWidth||0,i=e.data||[];if(!i.length)return n;const s=i[0].size(this.resolveDataElementOptions(0)),r=i[i.length-1].size(this.resolveDataElementOptions(i.length-1));return Math.max(n,s,r)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}a(cC,"id","line"),a(cC,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),a(cC,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class uC extends $w{constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){const t=this._cachedMeta,n=this.chart,i=n.data.labels||[],s=r_(t._parsed[e].r,n.options.locale);return{label:i[e]||"",value:s}}parseObjectData(e,t,n,i){return Z_.bind(this)(e,t,n,i)}update(e){const t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){const e=this._cachedMeta,t={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return e.data.forEach((e,n)=>{const i=this.getParsed(n).r;!isNaN(i)&&this.chart.getDataVisibility(n)&&(i<t.min&&(t.min=i),i>t.max&&(t.max=i))}),t}_updateRadius(){const e=this.chart,t=e.chartArea,n=e.options,i=Math.min(t.right-t.left,t.bottom-t.top),s=Math.max(i/2,0),r=(s-Math.max(n.cutoutPercentage?s/100*n.cutoutPercentage:1,0))/e.getVisibleDatasetCount();this.outerRadius=s-r*this.index,this.innerRadius=this.outerRadius-r}updateElements(e,t,n,i){const s="reset"===i,r=this.chart,o=r.options.animation,a=this._cachedMeta.rScale,l=a.xCenter,c=a.yCenter,u=a.getIndexAngle(0)-.5*fx;let d,h=u;const f=360/this.countVisibleElements();for(d=0;d<t;++d)h+=this._computeAngle(d,i,f);for(d=t;d<t+n;d++){const t=e[d];let n=h,p=h+this._computeAngle(d,i,f),m=r.getDataVisibility(d)?a.getDistanceFromCenterForValue(this.getParsed(d).r):0;h=p,s&&(o.animateScale&&(m=0),o.animateRotate&&(n=p=u));const g={x:l,y:c,innerRadius:0,outerRadius:m,startAngle:n,endAngle:p,options:this.resolveDataElementOptions(d,t.active?"active":i)};this.updateElement(t,d,g,i)}}countVisibleElements(){const e=this._cachedMeta;let t=0;return e.data.forEach((e,n)=>{!isNaN(this.getParsed(n).r)&&this.chart.getDataVisibility(n)&&t++}),t}_computeAngle(e,t,n){return this.chart.getDataVisibility(e)?Tx(this.resolveDataElementOptions(e,t).angle||n):0}}a(uC,"id","polarArea"),a(uC,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),a(uC,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){const t=e.data;if(t.labels.length&&t.datasets.length){const{labels:{pointStyle:n,color:i}}=e.legend.options;return t.labels.map((t,s)=>{const r=e.getDatasetMeta(0).controller.getStyle(s);return{text:t,fillStyle:r.backgroundColor,strokeStyle:r.borderColor,fontColor:i,lineWidth:r.borderWidth,pointStyle:n,hidden:!e.getDataVisibility(s),index:s}})}return[]}},onClick(e,t,n){n.chart.toggleDataVisibility(t.index),n.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class dC extends lC{}a(dC,"id","pie"),a(dC,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class hC extends $w{getLabelAndValue(e){const t=this._cachedMeta.vScale,n=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(n[t.axis])}}parseObjectData(e,t,n,i){return Z_.bind(this)(e,t,n,i)}update(e){const t=this._cachedMeta,n=t.dataset,i=t.data||[],s=t.iScale.getLabels();if(n.points=i,"resize"!==e){const t=this.resolveDatasetElementOptions(e);this.options.showLine||(t.borderWidth=0);const r={_loop:!0,_fullLoop:s.length===i.length,options:t};this.updateElement(n,void 0,r,e)}this.updateElements(i,0,i.length,e)}updateElements(e,t,n,i){const s=this._cachedMeta.rScale,r="reset"===i;for(let o=t;o<t+n;o++){const t=e[o],n=this.resolveDataElementOptions(o,t.active?"active":i),a=s.getPointPositionForValue(o,this.getParsed(o).r),l=r?s.xCenter:a.x,c=r?s.yCenter:a.y,u={x:l,y:c,angle:a.angle,skip:isNaN(l)||isNaN(c),options:n};this.updateElement(t,o,u,i)}}}a(hC,"id","radar"),a(hC,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),a(hC,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class fC extends $w{getLabelAndValue(e){const t=this._cachedMeta,n=this.chart.data.labels||[],{xScale:i,yScale:s}=t,r=this.getParsed(e),o=i.getLabelForValue(r.x),a=s.getLabelForValue(r.y);return{label:n[e]||"",value:"("+o+", "+a+")"}}update(e){const t=this._cachedMeta,{data:n=[]}=t,i=this.chart._animationsDisabled;let{start:s,count:r}=Kx(t,n,i);if(this._drawStart=s,this._drawCount=r,Yx(t)&&(s=0,r=n.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:s,_dataset:r}=t;s._chart=this.chart,s._datasetIndex=this.index,s._decimated=!!r._decimated,s.points=n;const o=this.resolveDatasetElementOptions(e);o.segment=this.options.segment,this.updateElement(s,void 0,{animated:!i,options:o},e)}else this.datasetElementType&&(delete t.dataset,this.datasetElementType=!1);this.updateElements(n,s,r,e)}addElements(){const{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,t,n,i){const s="reset"===i,{iScale:r,vScale:o,_stacked:a,_dataset:l}=this._cachedMeta,c=this.resolveDataElementOptions(t,i),u=this.getSharedOptions(c),d=this.includeOptions(i,u),h=r.axis,f=o.axis,{spanGaps:p,segment:m}=this.options,g=kx(p)?p:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||s||"none"===i;let v=t>0&&this.getParsed(t-1);for(let b=t;b<t+n;++b){const t=e[b],n=this.getParsed(b),c=y?t:{},p=Wb(n[f]),x=c[h]=r.getPixelForValue(n[h],b),_=c[f]=s||p?o.getBasePixel():o.getPixelForValue(a?this.applyStack(o,n,a):n[f],b);c.skip=isNaN(x)||isNaN(_)||p,c.stop=b>0&&Math.abs(n[h]-v[h])>g,m&&(c.parsed=n,c.raw=l.data[b]),d&&(c.options=u||this.resolveDataElementOptions(b,t.active?"active":i)),y||this.updateElement(t,b,c,i),v=n}this.updateSharedOptions(u,i,c)}getMaxOverflow(){const e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let e=0;for(let n=t.length-1;n>=0;--n)e=Math.max(e,t[n].size(this.resolveDataElementOptions(n))/2);return e>0&&e}const n=e.dataset,i=n.options&&n.options.borderWidth||0;if(!t.length)return i;const s=t[0].size(this.resolveDataElementOptions(0)),r=t[t.length-1].size(this.resolveDataElementOptions(t.length-1));return Math.max(i,s,r)/2}}a(fC,"id","scatter"),a(fC,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),a(fC,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});function pC(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class mC{static override(e){Object.assign(mC.prototype,e)}constructor(e){a(this,"options",void 0),this.options=e||{}}init(){}formats(){return pC()}parse(){return pC()}format(){return pC()}add(){return pC()}diff(){return pC()}startOf(){return pC()}endOf(){return pC()}}var gC=mC;function yC(e,t,n,i){const{controller:s,data:r,_sorted:o}=e,a=s._cachedMeta.iScale,l=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null;if(a&&t===a.axis&&"r"!==t&&o&&r.length){const o=a._reversePixels?zx:Fx;if(!i){const i=o(r,t,n);if(l){const{vScale:t}=s._cachedMeta,{_parsed:n}=e,r=n.slice(0,i.lo+1).reverse().findIndex(e=>!Wb(e[t.axis]));i.lo-=Math.max(0,r);const o=n.slice(i.hi).findIndex(e=>!Wb(e[t.axis]));i.hi+=Math.max(0,o)}return i}if(s._sharedOptions){const e=r[0],i="function"===typeof e.getRange&&e.getRange(t);if(i){const e=o(r,t,n-i),s=o(r,t,n+i);return{lo:e.lo,hi:s.hi}}}}return{lo:0,hi:r.length-1}}function vC(e,t,n,i,s){const r=e.getSortedVisibleDatasetMetas(),o=n[t];for(let a=0,l=r.length;a<l;++a){const{index:e,data:n}=r[a],{lo:l,hi:c}=yC(r[a],t,o,s);for(let t=l;t<=c;++t){const s=n[t];s.skip||i(s,e,t)}}}function bC(e,t,n,i,s){const r=[];if(!s&&!e.isPointInArea(t))return r;return vC(e,n,t,function(n,o,a){(s||x_(n,e.chartArea,0))&&n.inRange(t.x,t.y,i)&&r.push({element:n,datasetIndex:o,index:a})},!0),r}function xC(e,t,n,i,s,r){let o=[];const a=function(e){const t=-1!==e.indexOf("x"),n=-1!==e.indexOf("y");return function(e,i){const s=t?Math.abs(e.x-i.x):0,r=n?Math.abs(e.y-i.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(r,2))}}(n);let l=Number.POSITIVE_INFINITY;return vC(e,n,t,function(n,c,u){const d=n.inRange(t.x,t.y,s);if(i&&!d)return;const h=n.getCenterPoint(s);if(!(!!r||e.isPointInArea(h))&&!d)return;const f=a(t,h);f<l?(o=[{element:n,datasetIndex:c,index:u}],l=f):f===l&&o.push({element:n,datasetIndex:c,index:u})}),o}function _C(e,t,n,i,s,r){return r||e.isPointInArea(t)?"r"!==n||i?xC(e,t,n,i,s,r):function(e,t,n,i){let s=[];return vC(e,n,t,function(e,n,r){const{startAngle:o,endAngle:a}=e.getProps(["startAngle","endAngle"],i),{angle:l}=Px(e,{x:t.x,y:t.y});Rx(l,o,a)&&s.push({element:e,datasetIndex:n,index:r})}),s}(e,t,n,s):[]}function wC(e,t,n,i,s){const r=[],o="x"===n?"inXRange":"inYRange";let a=!1;return vC(e,n,t,(e,i,l)=>{e[o]&&e[o](t[n],s)&&(r.push({element:e,datasetIndex:i,index:l}),a=a||e.inRange(t.x,t.y,s))}),i&&!a?[]:r}var CC={evaluateInteractionItems:vC,modes:{index(e,t,n,i){const s=fw(t,e),r=n.axis||"x",o=n.includeInvisible||!1,a=n.intersect?bC(e,s,r,i,o):_C(e,s,r,!1,i,o),l=[];return a.length?(e.getSortedVisibleDatasetMetas().forEach(e=>{const t=a[0].index,n=e.data[t];n&&!n.skip&&l.push({element:n,datasetIndex:e.index,index:t})}),l):[]},dataset(e,t,n,i){const s=fw(t,e),r=n.axis||"xy",o=n.includeInvisible||!1;let a=n.intersect?bC(e,s,r,i,o):_C(e,s,r,!1,i,o);if(a.length>0){const t=a[0].datasetIndex,n=e.getDatasetMeta(t).data;a=[];for(let e=0;e<n.length;++e)a.push({element:n[e],datasetIndex:t,index:e})}return a},point:(e,t,n,i)=>bC(e,fw(t,e),n.axis||"xy",i,n.includeInvisible||!1),nearest(e,t,n,i){const s=fw(t,e),r=n.axis||"xy",o=n.includeInvisible||!1;return _C(e,s,r,n.intersect,i,o)},x:(e,t,n,i)=>wC(e,fw(t,e),"x",n.intersect,i),y:(e,t,n,i)=>wC(e,fw(t,e),"y",n.intersect,i)}};const NC=["left","top","right","bottom"];function kC(e,t){return e.filter(e=>e.pos===t)}function EC(e,t){return e.filter(e=>-1===NC.indexOf(e.pos)&&e.box.axis===t)}function TC(e,t){return e.sort((e,n)=>{const i=t?n:e,s=t?e:n;return i.weight===s.weight?i.index-s.index:i.weight-s.weight})}function SC(e,t){const n=function(e){const t={};for(const n of e){const{stack:e,pos:i,stackWeight:s}=n;if(!e||!NC.includes(i))continue;const r=t[e]||(t[e]={count:0,placed:0,weight:0,size:0});r.count++,r.weight+=s}return t}(e),{vBoxMaxWidth:i,hBoxMaxHeight:s}=t;let r,o,a;for(r=0,o=e.length;r<o;++r){a=e[r];const{fullSize:o}=a.box,l=n[a.stack],c=l&&a.stackWeight/l.weight;a.horizontal?(a.width=c?c*i:o&&t.availableWidth,a.height=s):(a.width=i,a.height=c?c*s:o&&t.availableHeight)}return n}function IC(e,t,n,i){return Math.max(e[n],t[n])+Math.max(e[i],t[i])}function PC(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function jC(e,t,n,i){const{pos:s,box:r}=n,o=e.maxPadding;if(!Kb(s)){n.size&&(e[s]-=n.size);const t=i[n.stack]||{size:0,count:1};t.size=Math.max(t.size,n.horizontal?r.height:r.width),n.size=t.size/t.count,e[s]+=n.size}r.getPadding&&PC(o,r.getPadding());const a=Math.max(0,t.outerWidth-IC(o,e,"left","right")),l=Math.max(0,t.outerHeight-IC(o,e,"top","bottom")),c=a!==e.w,u=l!==e.h;return e.w=a,e.h=l,n.horizontal?{same:c,other:u}:{same:u,other:c}}function AC(e,t){const n=t.maxPadding;function i(e){const i={left:0,top:0,right:0,bottom:0};return e.forEach(e=>{i[e]=Math.max(t[e],n[e])}),i}return i(e?["left","right"]:["top","bottom"])}function DC(e,t,n,i){const s=[];let r,o,a,l,c,u;for(r=0,o=e.length,c=0;r<o;++r){a=e[r],l=a.box,l.update(a.width||t.w,a.height||t.h,AC(a.horizontal,t));const{same:o,other:d}=jC(t,n,a,i);c|=o&&s.length,u=u||d,l.fullSize||s.push(a)}return c&&DC(s,t,n,i)||u}function RC(e,t,n,i,s){e.top=n,e.left=t,e.right=t+i,e.bottom=n+s,e.width=i,e.height=s}function MC(e,t,n,i){const s=n.padding;let{x:r,y:o}=t;for(const a of e){const e=a.box,l=i[a.stack]||{count:1,placed:0,weight:1},c=a.stackWeight/l.weight||1;if(a.horizontal){const i=t.w*c,r=l.size||e.height;ux(l.start)&&(o=l.start),e.fullSize?RC(e,s.left,o,n.outerWidth-s.right-s.left,r):RC(e,t.left+l.placed,o,i,r),l.start=o,l.placed+=i,o=e.bottom}else{const i=t.h*c,o=l.size||e.width;ux(l.start)&&(r=l.start),e.fullSize?RC(e,r,s.top,o,n.outerHeight-s.bottom-s.top):RC(e,r,t.top+l.placed,o,i),l.start=r,l.placed+=i,r=e.right}}t.x=r,t.y=o}var OC={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},e.boxes.push(t)},removeBox(e,t){const n=e.boxes?e.boxes.indexOf(t):-1;-1!==n&&e.boxes.splice(n,1)},configure(e,t,n){t.fullSize=n.fullSize,t.position=n.position,t.weight=n.weight},update(e,t,n,i){if(!e)return;const s=O_(e.options.layout.padding),r=Math.max(t-s.width,0),o=Math.max(n-s.height,0),a=function(e){const t=function(e){const t=[];let n,i,s,r,o,a;for(n=0,i=(e||[]).length;n<i;++n)s=e[n],({position:r,options:{stack:o,stackWeight:a=1}}=s),t.push({index:n,box:s,pos:r,horizontal:s.isHorizontal(),weight:s.weight,stack:o&&r+o,stackWeight:a});return t}(e),n=TC(t.filter(e=>e.box.fullSize),!0),i=TC(kC(t,"left"),!0),s=TC(kC(t,"right")),r=TC(kC(t,"top"),!0),o=TC(kC(t,"bottom")),a=EC(t,"x"),l=EC(t,"y");return{fullSize:n,leftAndTop:i.concat(r),rightAndBottom:s.concat(l).concat(o).concat(a),chartArea:kC(t,"chartArea"),vertical:i.concat(s).concat(l),horizontal:r.concat(o).concat(a)}}(e.boxes),l=a.vertical,c=a.horizontal;Zb(e.boxes,e=>{"function"===typeof e.beforeLayout&&e.beforeLayout()});const u=l.reduce((e,t)=>t.box.options&&!1===t.box.options.display?e:e+1,0)||1,d=Object.freeze({outerWidth:t,outerHeight:n,padding:s,availableWidth:r,availableHeight:o,vBoxMaxWidth:r/2/u,hBoxMaxHeight:o/2}),h=Object.assign({},s);PC(h,O_(i));const f=Object.assign({maxPadding:h,w:r,h:o,x:s.left,y:s.top},s),p=SC(l.concat(c),d);DC(a.fullSize,f,d,p),DC(l,f,d,p),DC(c,f,d,p)&&DC(l,f,d,p),function(e){const t=e.maxPadding;function n(n){const i=Math.max(t[n]-e[n],0);return e[n]+=i,i}e.y+=n("top"),e.x+=n("left"),n("right"),n("bottom")}(f),MC(a.leftAndTop,f,d,p),f.x+=f.w,f.y+=f.h,MC(a.rightAndBottom,f,d,p),e.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},Zb(a.chartArea,t=>{const n=t.box;Object.assign(n,e.chartArea),n.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class LC{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,n){}removeEventListener(e,t,n){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,n,i){return t=Math.max(0,t||e.width),n=n||e.height,{width:t,height:Math.max(0,i?Math.floor(t/i):n)}}isAttached(e){return!0}updateConfig(e){}}class FC extends LC{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const zC="$chartjs",UC={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},VC=e=>null===e||""===e;const BC=!!yw&&{passive:!0};function HC(e,t,n){e&&e.canvas&&e.canvas.removeEventListener(t,n,BC)}function qC(e,t){for(const n of e)if(n===t||n.contains(t))return!0}function WC(e,t,n){const i=e.canvas,s=new MutationObserver(e=>{let t=!1;for(const n of e)t=t||qC(n.addedNodes,i),t=t&&!qC(n.removedNodes,i);t&&n()});return s.observe(document,{childList:!0,subtree:!0}),s}function GC(e,t,n){const i=e.canvas,s=new MutationObserver(e=>{let t=!1;for(const n of e)t=t||qC(n.removedNodes,i),t=t&&!qC(n.addedNodes,i);t&&n()});return s.observe(document,{childList:!0,subtree:!0}),s}const KC=new Map;let YC=0;function QC(){const e=window.devicePixelRatio;e!==YC&&(YC=e,KC.forEach((t,n)=>{n.currentDevicePixelRatio!==e&&t()}))}function XC(e,t,n){const i=e.canvas,s=i&&lw(i);if(!s)return;const r=qx((e,t)=>{const i=s.clientWidth;n(e,t),i<s.clientWidth&&n()},window),o=new ResizeObserver(e=>{const t=e[0],n=t.contentRect.width,i=t.contentRect.height;0===n&&0===i||r(n,i)});return o.observe(s),function(e,t){KC.size||window.addEventListener("resize",QC),KC.set(e,t)}(e,r),o}function $C(e,t,n){n&&n.disconnect(),"resize"===t&&function(e){KC.delete(e),KC.size||window.removeEventListener("resize",QC)}(e)}function JC(e,t,n){const i=e.canvas,s=qx(t=>{null!==e.ctx&&n(function(e,t){const n=UC[e.type]||e.type,{x:i,y:s}=fw(e,t);return{type:n,chart:t,native:e,x:void 0!==i?i:null,y:void 0!==s?s:null}}(t,e))},e);return function(e,t,n){e&&e.addEventListener(t,n,BC)}(i,t,s),s}class ZC extends LC{acquireContext(e,t){const n=e&&e.getContext&&e.getContext("2d");return n&&n.canvas===e?(function(e,t){const n=e.style,i=e.getAttribute("height"),s=e.getAttribute("width");if(e[zC]={initial:{height:i,width:s,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",VC(s)){const t=vw(e,"width");void 0!==t&&(e.width=t)}if(VC(i))if(""===e.style.height)e.height=e.width/(t||2);else{const t=vw(e,"height");void 0!==t&&(e.height=t)}}(e,t),n):null}releaseContext(e){const t=e.canvas;if(!t[zC])return!1;const n=t[zC].initial;["height","width"].forEach(e=>{const i=n[e];Wb(i)?t.removeAttribute(e):t.setAttribute(e,i)});const i=n.style||{};return Object.keys(i).forEach(e=>{t.style[e]=i[e]}),t.width=t.width,delete t[zC],!0}addEventListener(e,t,n){this.removeEventListener(e,t);const i=e.$proxies||(e.$proxies={}),s={attach:WC,detach:GC,resize:XC}[t]||JC;i[t]=s(e,t,n)}removeEventListener(e,t){const n=e.$proxies||(e.$proxies={}),i=n[t];if(!i)return;({attach:$C,detach:$C,resize:$C}[t]||HC)(e,t,i),n[t]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,n,i){return mw(e,t,n,i)}isAttached(e){const t=e&&lw(e);return!(!t||!t.isConnected)}}class eN{constructor(){a(this,"x",void 0),a(this,"y",void 0),a(this,"active",!1),a(this,"options",void 0),a(this,"$animations",void 0)}tooltipPosition(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}hasValue(){return kx(this.x)&&kx(this.y)}getProps(e,t){const n=this.$animations;if(!t||!n)return this;const i={};return e.forEach(e=>{i[e]=n[e]&&n[e].active()?n[e]._to:this[e]}),i}}function tN(e,t){const n=e.options.ticks,i=function(e){const t=e.options.offset,n=e._tickSize(),i=e._length/n+(t?0:1),s=e._maxLength/n;return Math.floor(Math.min(i,s))}(e),s=Math.min(n.maxTicksLimit||i,i),r=n.major.enabled?function(e){const t=[];let n,i;for(n=0,i=e.length;n<i;n++)e[n].major&&t.push(n);return t}(t):[],o=r.length,a=r[0],l=r[o-1],c=[];if(o>s)return function(e,t,n,i){let s,r=0,o=n[0];for(i=Math.ceil(i),s=0;s<e.length;s++)s===o&&(t.push(e[s]),r++,o=n[r*i])}(t,c,r,o/s),c;const u=function(e,t,n){const i=function(e){const t=e.length;let n,i;if(t<2)return!1;for(i=e[0],n=1;n<t;++n)if(e[n]-e[n-1]!==i)return!1;return i}(e),s=t.length/n;if(!i)return Math.max(s,1);const r=function(e){const t=[],n=Math.sqrt(e);let i;for(i=1;i<n;i++)e%i===0&&(t.push(i),t.push(e/i));return n===(0|n)&&t.push(n),t.sort((e,t)=>e-t).pop(),t}(i);for(let o=0,a=r.length-1;o<a;o++){const e=r[o];if(e>s)return e}return Math.max(s,1)}(r,t,s);if(o>0){let e,n;const i=o>1?Math.round((l-a)/(o-1)):null;for(nN(t,c,u,Wb(i)?0:a-i,a),e=0,n=o-1;e<n;e++)nN(t,c,u,r[e],r[e+1]);return nN(t,c,u,l,Wb(i)?t.length:l+i),c}return nN(t,c,u),c}function nN(e,t,n,i,s){const r=Xb(i,0),o=Math.min(Xb(s,e.length),e.length);let a,l,c,u=0;for(n=Math.ceil(n),s&&(a=s-i,n=a/Math.floor(a/n)),c=r;c<0;)u++,c=Math.round(r+u*n);for(l=Math.max(r,0);l<o;l++)l===c&&(t.push(e[l]),u++,c=Math.round(r+u*n))}a(eN,"defaults",{}),a(eN,"defaultRoutes",void 0);const iN=(e,t,n)=>"top"===t||"left"===t?e[t]+n:e[t]-n,sN=(e,t)=>Math.min(t||e,e);function rN(e,t){const n=[],i=e.length/t,s=e.length;let r=0;for(;r<s;r+=i)n.push(e[Math.floor(r)]);return n}function oN(e,t,n){const i=e.ticks.length,s=Math.min(t,i-1),r=e._startPixel,o=e._endPixel,a=1e-6;let l,c=e.getPixelForTick(s);if(!(n&&(l=1===i?Math.max(c-r,o-c):0===t?(e.getPixelForTick(1)-c)/2:(c-e.getPixelForTick(s-1))/2,c+=s<t?l:-l,c<r-a||c>o+a)))return c}function aN(e){return e.drawTicks?e.tickLength:0}function lN(e,t){if(!e.display)return 0;const n=L_(e.font,t),i=O_(e.padding);return(Gb(e.text)?e.text.length:1)*n.lineHeight+i.height}function cN(e,t,n){let i=Wx(e);return(n&&"right"!==t||!n&&"right"===t)&&(i=(e=>"left"===e?"right":"right"===e?"left":e)(i)),i}class uN extends eN{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:n,_suggestedMax:i}=this;return e=Qb(e,Number.POSITIVE_INFINITY),t=Qb(t,Number.NEGATIVE_INFINITY),n=Qb(n,Number.POSITIVE_INFINITY),i=Qb(i,Number.NEGATIVE_INFINITY),{min:Qb(e,n),max:Qb(t,i),minDefined:Yb(e),maxDefined:Yb(t)}}getMinMax(e){let t,{min:n,max:i,minDefined:s,maxDefined:r}=this.getUserBounds();if(s&&r)return{min:n,max:i};const o=this.getMatchingVisibleMetas();for(let a=0,l=o.length;a<l;++a)t=o[a].controller.getMinMax(this,e),s||(n=Math.min(n,t.min)),r||(i=Math.max(i,t.max));return n=r&&n>i?i:n,i=s&&n>i?n:i,{min:Qb(n,Qb(i,n)),max:Qb(i,Qb(n,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chart.chartArea;return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Jb(this.options.beforeUpdate,[this])}update(e,t,n){const{beginAtZero:i,grace:s,ticks:r}=this.options,o=r.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(e,t,n){const{min:i,max:s}=e,r=$b(t,(s-i)/2),o=(e,t)=>n&&0===e?0:e+t;return{min:o(i,-Math.abs(r)),max:o(s,r)}}(this,s,i),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const a=o<this.ticks.length;this._convertTicksToLabels(a?rN(this.ticks,o):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),r.display&&(r.autoSkip||"auto"===r.source)&&(this.ticks=tN(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),a&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e,t,n=this.options.reverse;this.isHorizontal()?(e=this.left,t=this.right):(e=this.top,t=this.bottom,n=!n),this._startPixel=e,this._endPixel=t,this._reversePixels=n,this._length=t-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Jb(this.options.afterUpdate,[this])}beforeSetDimensions(){Jb(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Jb(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),Jb(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Jb(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const t=this.options.ticks;let n,i,s;for(n=0,i=e.length;n<i;n++)s=e[n],s.label=Jb(t.callback,[s.value,n,e],this)}afterTickToLabelConversion(){Jb(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Jb(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,t=e.ticks,n=sN(this.ticks.length,e.ticks.maxTicksLimit),i=t.minRotation||0,s=t.maxRotation;let r,o,a,l=i;if(!this._isVisible()||!t.display||i>=s||n<=1||!this.isHorizontal())return void(this.labelRotation=i);const c=this._getLabelSizes(),u=c.widest.width,d=c.highest.height,h=Mx(this.chart.width-u,0,this.maxWidth);r=e.offset?this.maxWidth/n:h/(n-1),u+6>r&&(r=h/(n-(e.offset?.5:1)),o=this.maxHeight-aN(e.grid)-t.padding-lN(e.title,this.chart.options.font),a=Math.sqrt(u*u+d*d),l=Sx(Math.min(Math.asin(Mx((c.highest.height+6)/r,-1,1)),Math.asin(Mx(o/a,-1,1))-Math.asin(Mx(d/a,-1,1)))),l=Math.max(i,Math.min(s,l))),this.labelRotation=l}afterCalculateLabelRotation(){Jb(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Jb(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:t,options:{ticks:n,title:i,grid:s}}=this,r=this._isVisible(),o=this.isHorizontal();if(r){const r=lN(i,t.options.font);if(o?(e.width=this.maxWidth,e.height=aN(s)+r):(e.height=this.maxHeight,e.width=aN(s)+r),n.display&&this.ticks.length){const{first:t,last:i,widest:s,highest:r}=this._getLabelSizes(),a=2*n.padding,l=Tx(this.labelRotation),c=Math.cos(l),u=Math.sin(l);if(o){const t=n.mirror?0:u*s.width+c*r.height;e.height=Math.min(this.maxHeight,e.height+t+a)}else{const t=n.mirror?0:c*s.width+u*r.height;e.width=Math.min(this.maxWidth,e.width+t+a)}this._calculatePadding(t,i,u,c)}}this._handleMargins(),o?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,n,i){const{ticks:{align:s,padding:r},position:o}=this.options,a=0!==this.labelRotation,l="top"!==o&&"x"===this.axis;if(this.isHorizontal()){const o=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let u=0,d=0;a?l?(u=i*e.width,d=n*t.height):(u=n*e.height,d=i*t.width):"start"===s?d=t.width:"end"===s?u=e.width:"inner"!==s&&(u=e.width/2,d=t.width/2),this.paddingLeft=Math.max((u-o+r)*this.width/(this.width-o),0),this.paddingRight=Math.max((d-c+r)*this.width/(this.width-c),0)}else{let n=t.height/2,i=e.height/2;"start"===s?(n=0,i=e.height):"end"===s&&(n=t.height,i=0),this.paddingTop=n+r,this.paddingBottom=i+r}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Jb(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:t}=this.options;return"top"===t||"bottom"===t||"x"===e}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){let t,n;for(this.beforeTickToLabelConversion(),this.generateTickLabels(e),t=0,n=e.length;t<n;t++)Wb(e[t].label)&&(e.splice(t,1),n--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const t=this.options.ticks.sampleSize;let n=this.ticks;t<n.length&&(n=rN(n,t)),this._labelSizes=e=this._computeLabelSizes(n,n.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,n){const{ctx:i,_longestTextCache:s}=this,r=[],o=[],a=Math.floor(t/sN(t,n));let l,c,u,d,h,f,p,m,g,y,v,b=0,x=0;for(l=0;l<t;l+=a){if(d=e[l].label,h=this._resolveTickFontOptions(l),i.font=f=h.string,p=s[f]=s[f]||{data:{},gc:[]},m=h.lineHeight,g=y=0,Wb(d)||Gb(d)){if(Gb(d))for(c=0,u=d.length;c<u;++c)v=d[c],Wb(v)||Gb(v)||(g=p_(i,p.data,p.gc,g,v),y+=m)}else g=p_(i,p.data,p.gc,g,d),y=m;r.push(g),o.push(y),b=Math.max(g,b),x=Math.max(y,x)}!function(e,t){Zb(e,e=>{const n=e.gc,i=n.length/2;let s;if(i>t){for(s=0;s<i;++s)delete e.data[n[s]];n.splice(0,i)}})}(s,t);const _=r.indexOf(b),w=o.indexOf(x),C=e=>({width:r[e]||0,height:o[e]||0});return{first:C(0),last:C(t-1),widest:C(_),highest:C(w),widths:r,heights:o}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const t=this._startPixel+e*this._length;return Mx(this._alignToPixels?g_(this.chart,t,0):t,-32768,32767)}getDecimalForPixel(e){const t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){const t=this.ticks||[];if(e>=0&&e<t.length){const n=t[e];return n.$context||(n.$context=function(e,t,n){return z_(e,{tick:n,index:t,type:"tick"})}(this.getContext(),e,n))}return this.$context||(this.$context=z_(this.chart.getContext(),{scale:this,type:"scale"}))}_tickSize(){const e=this.options.ticks,t=Tx(this.labelRotation),n=Math.abs(Math.cos(t)),i=Math.abs(Math.sin(t)),s=this._getLabelSizes(),r=e.autoSkipPadding||0,o=s?s.widest.width+r:0,a=s?s.highest.height+r:0;return this.isHorizontal()?a*n>o*i?o/n:a/i:a*i<o*n?a/n:o/i}_isVisible(){const e=this.options.display;return"auto"!==e?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const t=this.axis,n=this.chart,i=this.options,{grid:s,position:r,border:o}=i,a=s.offset,l=this.isHorizontal(),c=this.ticks.length+(a?1:0),u=aN(s),d=[],h=o.setContext(this.getContext()),f=h.display?h.width:0,p=f/2,m=function(e){return g_(n,e,f)};let g,y,v,b,x,_,w,C,N,k,E,T;if("top"===r)g=m(this.bottom),_=this.bottom-u,C=g-p,k=m(e.top)+p,T=e.bottom;else if("bottom"===r)g=m(this.top),k=e.top,T=m(e.bottom)-p,_=g+p,C=this.top+u;else if("left"===r)g=m(this.right),x=this.right-u,w=g-p,N=m(e.left)+p,E=e.right;else if("right"===r)g=m(this.left),N=e.left,E=m(e.right)-p,x=g+p,w=this.left+u;else if("x"===t){if("center"===r)g=m((e.top+e.bottom)/2+.5);else if(Kb(r)){const e=Object.keys(r)[0],t=r[e];g=m(this.chart.scales[e].getPixelForValue(t))}k=e.top,T=e.bottom,_=g+p,C=_+u}else if("y"===t){if("center"===r)g=m((e.left+e.right)/2);else if(Kb(r)){const e=Object.keys(r)[0],t=r[e];g=m(this.chart.scales[e].getPixelForValue(t))}x=g-p,w=x-u,N=e.left,E=e.right}const S=Xb(i.ticks.maxTicksLimit,c),I=Math.max(1,Math.ceil(c/S));for(y=0;y<c;y+=I){const e=this.getContext(y),t=s.setContext(e),i=o.setContext(e),r=t.lineWidth,c=t.color,u=i.dash||[],h=i.dashOffset,f=t.tickWidth,p=t.tickColor,m=t.tickBorderDash||[],g=t.tickBorderDashOffset;v=oN(this,y,a),void 0!==v&&(b=g_(n,v,r),l?x=w=N=E=b:_=C=k=T=b,d.push({tx1:x,ty1:_,tx2:w,ty2:C,x1:N,y1:k,x2:E,y2:T,width:r,color:c,borderDash:u,borderDashOffset:h,tickWidth:f,tickColor:p,tickBorderDash:m,tickBorderDashOffset:g}))}return this._ticksLength=c,this._borderValue=g,d}_computeLabelItems(e){const t=this.axis,n=this.options,{position:i,ticks:s}=n,r=this.isHorizontal(),o=this.ticks,{align:a,crossAlign:l,padding:c,mirror:u}=s,d=aN(n.grid),h=d+c,f=u?-c:h,p=-Tx(this.labelRotation),m=[];let g,y,v,b,x,_,w,C,N,k,E,T,S="middle";if("top"===i)_=this.bottom-f,w=this._getXAxisLabelAlignment();else if("bottom"===i)_=this.top+f,w=this._getXAxisLabelAlignment();else if("left"===i){const e=this._getYAxisLabelAlignment(d);w=e.textAlign,x=e.x}else if("right"===i){const e=this._getYAxisLabelAlignment(d);w=e.textAlign,x=e.x}else if("x"===t){if("center"===i)_=(e.top+e.bottom)/2+h;else if(Kb(i)){const e=Object.keys(i)[0],t=i[e];_=this.chart.scales[e].getPixelForValue(t)+h}w=this._getXAxisLabelAlignment()}else if("y"===t){if("center"===i)x=(e.left+e.right)/2-h;else if(Kb(i)){const e=Object.keys(i)[0],t=i[e];x=this.chart.scales[e].getPixelForValue(t)}w=this._getYAxisLabelAlignment(d).textAlign}"y"===t&&("start"===a?S="top":"end"===a&&(S="bottom"));const I=this._getLabelSizes();for(g=0,y=o.length;g<y;++g){v=o[g],b=v.label;const e=s.setContext(this.getContext(g));C=this.getPixelForTick(g)+s.labelOffset,N=this._resolveTickFontOptions(g),k=N.lineHeight,E=Gb(b)?b.length:1;const t=E/2,n=e.color,a=e.textStrokeColor,c=e.textStrokeWidth;let d,h=w;if(r?(x=C,"inner"===w&&(h=g===y-1?this.options.reverse?"left":"right":0===g?this.options.reverse?"right":"left":"center"),T="top"===i?"near"===l||0!==p?-E*k+k/2:"center"===l?-I.highest.height/2-t*k+k:-I.highest.height+k/2:"near"===l||0!==p?k/2:"center"===l?I.highest.height/2-t*k:I.highest.height-E*k,u&&(T*=-1),0===p||e.showLabelBackdrop||(x+=k/2*Math.sin(p))):(_=C,T=(1-E)*k/2),e.showLabelBackdrop){const t=O_(e.backdropPadding),n=I.heights[g],i=I.widths[g];let s=T-t.top,r=0-t.left;switch(S){case"middle":s-=n/2;break;case"bottom":s-=n}switch(w){case"center":r-=i/2;break;case"right":r-=i;break;case"inner":g===y-1?r-=i:g>0&&(r-=i/2)}d={left:r,top:s,width:i+t.width,height:n+t.height,color:e.backdropColor}}m.push({label:b,font:N,textOffset:T,options:{rotation:p,color:n,strokeColor:a,strokeWidth:c,textAlign:h,textBaseline:S,translation:[x,_],backdrop:d}})}return m}_getXAxisLabelAlignment(){const{position:e,ticks:t}=this.options;if(-Tx(this.labelRotation))return"top"===e?"left":"right";let n="center";return"start"===t.align?n="left":"end"===t.align?n="right":"inner"===t.align&&(n="inner"),n}_getYAxisLabelAlignment(e){const{position:t,ticks:{crossAlign:n,mirror:i,padding:s}}=this.options,r=e+s,o=this._getLabelSizes().widest.width;let a,l;return"left"===t?i?(l=this.right+s,"near"===n?a="left":"center"===n?(a="center",l+=o/2):(a="right",l+=o)):(l=this.right-r,"near"===n?a="right":"center"===n?(a="center",l-=o/2):(a="left",l=this.left)):"right"===t?i?(l=this.left+s,"near"===n?a="right":"center"===n?(a="center",l-=o/2):(a="left",l-=o)):(l=this.left+r,"near"===n?a="left":"center"===n?(a="center",l+=o/2):(a="right",l=this.right)):a="right",{textAlign:a,x:l}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,t=this.options.position;return"left"===t||"right"===t?{top:0,left:this.left,bottom:e.height,right:this.right}:"top"===t||"bottom"===t?{top:this.top,left:0,bottom:this.bottom,right:e.width}:void 0}drawBackground(){const{ctx:e,options:{backgroundColor:t},left:n,top:i,width:s,height:r}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(n,i,s,r),e.restore())}getLineWidthForValue(e){const t=this.options.grid;if(!this._isVisible()||!t.display)return 0;const n=this.ticks.findIndex(t=>t.value===e);if(n>=0){return t.setContext(this.getContext(n)).lineWidth}return 0}drawGrid(e){const t=this.options.grid,n=this.ctx,i=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let s,r;const o=(e,t,i)=>{i.width&&i.color&&(n.save(),n.lineWidth=i.width,n.strokeStyle=i.color,n.setLineDash(i.borderDash||[]),n.lineDashOffset=i.borderDashOffset,n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(t.x,t.y),n.stroke(),n.restore())};if(t.display)for(s=0,r=i.length;s<r;++s){const e=i[s];t.drawOnChartArea&&o({x:e.x1,y:e.y1},{x:e.x2,y:e.y2},e),t.drawTicks&&o({x:e.tx1,y:e.ty1},{x:e.tx2,y:e.ty2},{color:e.tickColor,width:e.tickWidth,borderDash:e.tickBorderDash,borderDashOffset:e.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:t,options:{border:n,grid:i}}=this,s=n.setContext(this.getContext()),r=n.display?s.width:0;if(!r)return;const o=i.setContext(this.getContext(0)).lineWidth,a=this._borderValue;let l,c,u,d;this.isHorizontal()?(l=g_(e,this.left,r)-r/2,c=g_(e,this.right,o)+o/2,u=d=a):(u=g_(e,this.top,r)-r/2,d=g_(e,this.bottom,o)+o/2,l=c=a),t.save(),t.lineWidth=s.width,t.strokeStyle=s.color,t.beginPath(),t.moveTo(l,u),t.lineTo(c,d),t.stroke(),t.restore()}drawLabels(e){if(!this.options.ticks.display)return;const t=this.ctx,n=this._computeLabelArea();n&&__(t,n);const i=this.getLabelItems(e);for(const s of i){const e=s.options,n=s.font;T_(t,s.label,0,s.textOffset,n,e)}n&&w_(t)}drawTitle(){const{ctx:e,options:{position:t,title:n,reverse:i}}=this;if(!n.display)return;const s=L_(n.font),r=O_(n.padding),o=n.align;let a=s.lineHeight/2;"bottom"===t||"center"===t||Kb(t)?(a+=r.bottom,Gb(n.text)&&(a+=s.lineHeight*(n.text.length-1))):a+=r.top;const{titleX:l,titleY:c,maxWidth:u,rotation:d}=function(e,t,n,i){const{top:s,left:r,bottom:o,right:a,chart:l}=e,{chartArea:c,scales:u}=l;let d,h,f,p=0;const m=o-s,g=a-r;if(e.isHorizontal()){if(h=Gx(i,r,a),Kb(n)){const e=Object.keys(n)[0],i=n[e];f=u[e].getPixelForValue(i)+m-t}else f="center"===n?(c.bottom+c.top)/2+m-t:iN(e,n,t);d=a-r}else{if(Kb(n)){const e=Object.keys(n)[0],i=n[e];h=u[e].getPixelForValue(i)-g+t}else h="center"===n?(c.left+c.right)/2-g+t:iN(e,n,t);f=Gx(i,o,s),p="left"===n?-vx:vx}return{titleX:h,titleY:f,maxWidth:d,rotation:p}}(this,a,t,o);T_(e,n.text,0,0,s,{color:n.color,maxWidth:u,rotation:d,textAlign:cN(o,t,i),textBaseline:"middle",translation:[l,c]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,t=e.ticks&&e.ticks.z||0,n=Xb(e.grid&&e.grid.z,-1),i=Xb(e.border&&e.border.z,0);return this._isVisible()&&this.draw===uN.prototype.draw?[{z:n,draw:e=>{this.drawBackground(),this.drawGrid(e),this.drawTitle()}},{z:i,draw:()=>{this.drawBorder()}},{z:t,draw:e=>{this.drawLabels(e)}}]:[{z:t,draw:e=>{this.draw(e)}}]}getMatchingVisibleMetas(e){const t=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",i=[];let s,r;for(s=0,r=t.length;s<r;++s){const r=t[s];r[n]!==this.id||e&&r.type!==e||i.push(r)}return i}_resolveTickFontOptions(e){return L_(this.options.ticks.setContext(this.getContext(e)).font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class dN{constructor(e,t,n){this.type=e,this.scope=t,this.override=n,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const t=Object.getPrototypeOf(e);let n;(function(e){return"id"in e&&"defaults"in e})(t)&&(n=this.register(t));const i=this.items,s=e.id,r=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+e);return s in i||(i[s]=e,function(e,t,n){const i=sx(Object.create(null),[n?f_.get(n):{},f_.get(t),e.defaults]);f_.set(t,i),e.defaultRoutes&&function(e,t){Object.keys(t).forEach(n=>{const i=n.split("."),s=i.pop(),r=[e].concat(i).join("."),o=t[n].split("."),a=o.pop(),l=o.join(".");f_.route(r,s,l,a)})}(t,e.defaultRoutes);e.descriptors&&f_.describe(t,e.descriptors)}(e,r,n),this.override&&f_.override(e.id,e.overrides)),r}get(e){return this.items[e]}unregister(e){const t=this.items,n=e.id,i=this.scope;n in t&&delete t[n],i&&n in f_[i]&&(delete f_[i][n],this.override&&delete l_[n])}}class hN{constructor(){this.controllers=new dN($w,"datasets",!0),this.elements=new dN(eN,"elements"),this.plugins=new dN(Object,"plugins"),this.scales=new dN(uN,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t)}remove(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t)}addControllers(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.controllers)}addElements(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.elements)}addPlugins(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.plugins)}addScales(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("register",t,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.controllers)}removeElements(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.elements)}removePlugins(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.plugins)}removeScales(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._each("unregister",t,this.scales)}_each(e,t,n){[...t].forEach(t=>{const i=n||this._getRegistryForType(t);n||i.isForType(t)||i===this.plugins&&t.id?this._exec(e,i,t):Zb(t,t=>{const i=n||this._getRegistryForType(t);this._exec(e,i,t)})})}_exec(e,t,n){const i=cx(e);Jb(n["before"+i],[],n),t[e](n),Jb(n["after"+i],[],n)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){const n=this._typedRegistries[t];if(n.isForType(e))return n}return this.plugins}_get(e,t,n){const i=t.get(e);if(void 0===i)throw new Error('"'+e+'" is not a registered '+n+".");return i}}var fN=new hN;class pN{constructor(){this._init=[]}notify(e,t,n,i){"beforeInit"===t&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const s=i?this._descriptors(e).filter(i):this._descriptors(e),r=this._notify(s,e,t,n);return"afterDestroy"===t&&(this._notify(s,e,"stop"),this._notify(this._init,e,"uninstall")),r}_notify(e,t,n,i){i=i||{};for(const s of e){const e=s.plugin;if(!1===Jb(e[n],[t,i,s.options],e)&&i.cancelable)return!1}return!0}invalidate(){Wb(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){const n=e&&e.config,i=Xb(n.options&&n.options.plugins,{}),s=function(e){const t={},n=[],i=Object.keys(fN.plugins.items);for(let r=0;r<i.length;r++)n.push(fN.getPlugin(i[r]));const s=e.plugins||[];for(let r=0;r<s.length;r++){const e=s[r];-1===n.indexOf(e)&&(n.push(e),t[e.id]=!0)}return{plugins:n,localIds:t}}(n);return!1!==i||t?function(e,t,n,i){let{plugins:s,localIds:r}=t;const o=[],a=e.getContext();for(const l of s){const t=l.id,s=mN(n[t],i);null!==s&&o.push({plugin:l,options:gN(e.config,{plugin:l,local:r[t]},s,a)})}return o}(e,s,i,t):[]}_notifyStateChanges(e){const t=this._oldCache||[],n=this._cache,i=(e,t)=>e.filter(e=>!t.some(t=>e.plugin.id===t.plugin.id));this._notify(i(t,n),e,"stop"),this._notify(i(n,t),e,"start")}}function mN(e,t){return t||!1!==e?!0===e?{}:e:null}function gN(e,t,n,i){let{plugin:s,local:r}=t;const o=e.pluginScopeKeys(s),a=e.getOptionScopes(n,o);return r&&s.defaults&&a.push(s.defaults),e.createResolver(a,i,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function yN(e,t){const n=f_.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||n.indexAxis||"x"}function vN(e){if("x"===e||"y"===e||"r"===e)return e}function bN(e){return"top"===e||"bottom"===e?"x":"left"===e||"right"===e?"y":void 0}function xN(e){if(vN(e))return e;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(const s of n){const t=s.axis||bN(s.position)||e.length>1&&vN(e[0].toLowerCase());if(t)return t}throw new Error("Cannot determine type of '".concat(e,"' axis. Please provide 'axis' or 'position' option."))}function _N(e,t,n){if(n[t+"AxisID"]===e)return{axis:t}}function wN(e,t){const n=l_[e.type]||{scales:{}},i=t.scales||{},s=yN(e.type,t),r=Object.create(null);return Object.keys(i).forEach(t=>{const o=i[t];if(!Kb(o))return console.error("Invalid scale configuration for scale: ".concat(t));if(o._proxy)return console.warn("Ignoring resolver passed as options for scale: ".concat(t));const a=xN(t,o,function(e,t){if(t.data&&t.data.datasets){const n=t.data.datasets.filter(t=>t.xAxisID===e||t.yAxisID===e);if(n.length)return _N(e,"x",n[0])||_N(e,"y",n[0])}return{}}(t,e),f_.scales[o.type]),l=function(e,t){return e===t?"_index_":"_value_"}(a,s),c=n.scales||{};r[t]=rx(Object.create(null),[{axis:a},o,c[a],c[l]])}),e.data.datasets.forEach(n=>{const s=n.type||e.type,o=n.indexAxis||yN(s,t),a=(l_[s]||{}).scales||{};Object.keys(a).forEach(e=>{const t=function(e,t){let n=e;return"_index_"===e?n=t:"_value_"===e&&(n="x"===t?"y":"x"),n}(e,o),s=n[t+"AxisID"]||t;r[s]=r[s]||Object.create(null),rx(r[s],[{axis:t},i[s],a[e]])})}),Object.keys(r).forEach(e=>{const t=r[e];rx(t,[f_.scales[t.type],f_.scale])}),r}function CN(e){const t=e.options||(e.options={});t.plugins=Xb(t.plugins,{}),t.scales=wN(e,t)}function NN(e){return(e=e||{}).datasets=e.datasets||[],e.labels=e.labels||[],e}const kN=new Map,EN=new Set;function TN(e,t){let n=kN.get(e);return n||(n=t(),kN.set(e,n),EN.add(n)),n}const SN=(e,t,n)=>{const i=lx(t,n);void 0!==i&&e.add(i)};class IN{constructor(e){this._config=function(e){return(e=e||{}).data=NN(e.data),CN(e),e}(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=NN(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),CN(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return TN(e,()=>[["datasets.".concat(e),""]])}datasetAnimationScopeKeys(e,t){return TN("".concat(e,".transition.").concat(t),()=>[["datasets.".concat(e,".transitions.").concat(t),"transitions.".concat(t)],["datasets.".concat(e),""]])}datasetElementScopeKeys(e,t){return TN("".concat(e,"-").concat(t),()=>[["datasets.".concat(e,".elements.").concat(t),"datasets.".concat(e),"elements.".concat(t),""]])}pluginScopeKeys(e){const t=e.id,n=this.type;return TN("".concat(n,"-plugin-").concat(t),()=>[["plugins.".concat(t),...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){const n=this._scopeCache;let i=n.get(e);return i&&!t||(i=new Map,n.set(e,i)),i}getOptionScopes(e,t,n){const{options:i,type:s}=this,r=this._cachedScopes(e,n),o=r.get(t);if(o)return o;const a=new Set;t.forEach(t=>{e&&(a.add(e),t.forEach(t=>SN(a,e,t))),t.forEach(e=>SN(a,i,e)),t.forEach(e=>SN(a,l_[s]||{},e)),t.forEach(e=>SN(a,f_,e)),t.forEach(e=>SN(a,c_,e))});const l=Array.from(a);return 0===l.length&&l.push(Object.create(null)),EN.has(t)&&r.set(t,l),l}chartOptionScopes(){const{options:e,type:t}=this;return[e,l_[t]||{},f_.datasets[t]||{},{type:t},f_,c_]}resolveNamedOptions(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[""];const s={$shared:!0},{resolver:r,subPrefixes:o}=PN(this._resolverCache,e,i);let a=r;if(function(e,t){const{isScriptable:n,isIndexable:i}=B_(e);for(const s of t){const t=n(s),r=i(s),o=(r||t)&&e[s];if(t&&(dx(o)||jN(o))||r&&Gb(o))return!0}return!1}(r,t)){s.$shared=!1;a=V_(r,n=dx(n)?n():n,this.createResolver(e,n,o))}for(const l of t)s[l]=a[l];return s}createResolver(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""],i=arguments.length>3?arguments[3]:void 0;const{resolver:s}=PN(this._resolverCache,e,n);return Kb(t)?V_(s,t,void 0,i):s}}function PN(e,t,n){let i=e.get(t);i||(i=new Map,e.set(t,i));const s=n.join();let r=i.get(s);if(!r){r={resolver:U_(t,n),subPrefixes:n.filter(e=>!e.toLowerCase().includes("hover"))},i.set(s,r)}return r}const jN=e=>Kb(e)&&Object.getOwnPropertyNames(e).some(t=>dx(e[t]));const AN=["top","bottom","left","right","chartArea"];function DN(e,t){return"top"===e||"bottom"===e||-1===AN.indexOf(e)&&"x"===t}function RN(e,t){return function(n,i){return n[e]===i[e]?n[t]-i[t]:n[e]-i[e]}}function MN(e){const t=e.chart,n=t.options.animation;t.notifyPlugins("afterRender"),Jb(n&&n.onComplete,[e],t)}function ON(e){const t=e.chart,n=t.options.animation;Jb(n&&n.onProgress,[e],t)}function LN(e){return aw()&&"string"===typeof e?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const FN={},zN=e=>{const t=LN(e);return Object.values(FN).filter(e=>e.canvas===t).pop()};function UN(e,t,n){const i=Object.keys(e);for(const s of i){const i=+s;if(i>=t){const r=e[s];delete e[s],(n>0||i>t)&&(e[i+n]=r)}}}class VN{static register(){fN.add(...arguments),BN()}static unregister(){fN.remove(...arguments),BN()}constructor(e,t){const n=this.config=new IN(t),i=LN(e),s=zN(i);if(s)throw new Error("Canvas is already in use. Chart with ID '"+s.id+"' must be destroyed before the canvas with ID '"+s.canvas.id+"' can be reused.");const r=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||function(e){return!aw()||"undefined"!==typeof OffscreenCanvas&&e instanceof OffscreenCanvas?FC:ZC}(i)),this.platform.updateConfig(n);const o=this.platform.acquireContext(i,r.aspectRatio),a=o&&o.canvas,l=a&&a.height,c=a&&a.width;this.id=qb(),this.ctx=o,this.canvas=a,this.width=c,this.height=l,this._options=r,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new pN,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(e,t){let n;return function(){for(var i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return t?(clearTimeout(n),n=setTimeout(e,t,s)):e.apply(this,s),t}}(e=>this.update(e),r.resizeDelay||0),this._dataChanges=[],FN[this.id]=this,o&&a?(Mw.listen(this,"complete",MN),Mw.listen(this,"progress",ON),this._initialize(),this.attached&&this.update()):console.error("Failed to create chart: can't acquire context from the given item")}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:t},width:n,height:i,_aspectRatio:s}=this;return Wb(e)?t&&s?s:i?n/i:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return fN}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():gw(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return y_(this.canvas,this.ctx),this}stop(){return Mw.stop(this),this}resize(e,t){Mw.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){const n=this.options,i=this.canvas,s=n.maintainAspectRatio&&this.aspectRatio,r=this.platform.getMaximumSize(i,e,t,s),o=n.devicePixelRatio||this.platform.getDevicePixelRatio(),a=this.width?"resize":"attach";this.width=r.width,this.height=r.height,this._aspectRatio=this.aspectRatio,gw(this,o,!0)&&(this.notifyPlugins("resize",{size:r}),Jb(n.onResize,[this,r],this),this.attached&&this._doResize(a)&&this.render())}ensureScalesHaveIDs(){Zb(this.options.scales||{},(e,t)=>{e.id=t})}buildOrUpdateScales(){const e=this.options,t=e.scales,n=this.scales,i=Object.keys(n).reduce((e,t)=>(e[t]=!1,e),{});let s=[];t&&(s=s.concat(Object.keys(t).map(e=>{const n=t[e],i=xN(e,n),s="r"===i,r="x"===i;return{options:n,dposition:s?"chartArea":r?"bottom":"left",dtype:s?"radialLinear":r?"category":"linear"}}))),Zb(s,t=>{const s=t.options,r=s.id,o=xN(r,s),a=Xb(s.type,t.dtype);void 0!==s.position&&DN(s.position,o)===DN(t.dposition)||(s.position=t.dposition),i[r]=!0;let l=null;if(r in n&&n[r].type===a)l=n[r];else{l=new(fN.getScale(a))({id:r,type:a,ctx:this.ctx,chart:this}),n[l.id]=l}l.init(s,e)}),Zb(i,(e,t)=>{e||delete n[t]}),Zb(n,e=>{OC.configure(this,e,e.options),OC.addBox(this,e)})}_updateMetasets(){const e=this._metasets,t=this.data.datasets.length,n=e.length;if(e.sort((e,t)=>e.index-t.index),n>t){for(let e=t;e<n;++e)this._destroyDatasetMeta(e);e.splice(t,n-t)}this._sortedMetasets=e.slice(0).sort(RN("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((e,n)=>{0===t.filter(t=>t===e._dataset).length&&this._destroyDatasetMeta(n)})}buildOrUpdateControllers(){const e=[],t=this.data.datasets;let n,i;for(this._removeUnreferencedMetasets(),n=0,i=t.length;n<i;n++){const i=t[n];let s=this.getDatasetMeta(n);const r=i.type||this.config.type;if(s.type&&s.type!==r&&(this._destroyDatasetMeta(n),s=this.getDatasetMeta(n)),s.type=r,s.indexAxis=i.indexAxis||yN(r,this.options),s.order=i.order||0,s.index=n,s.label=""+i.label,s.visible=this.isDatasetVisible(n),s.controller)s.controller.updateIndex(n),s.controller.linkScales();else{const t=fN.getController(r),{datasetElementType:i,dataElementType:o}=f_.datasets[r];Object.assign(t,{dataElementType:fN.getElement(o),datasetElementType:i&&fN.getElement(i)}),s.controller=new t(this,n),e.push(s.controller)}}return this._updateMetasets(),e}_resetElements(){Zb(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const t=this.config;t.update();const n=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),i=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0}))return;const s=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let r=0;for(let l=0,c=this.data.datasets.length;l<c;l++){const{controller:e}=this.getDatasetMeta(l),t=!i&&-1===s.indexOf(e);e.buildOrUpdateElements(t),r=Math.max(+e.getMaxOverflow(),r)}r=this._minPadding=n.layout.autoPadding?r:0,this._updateLayout(r),i||Zb(s,e=>{e.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(RN("z","_idx"));const{_active:o,_lastEvent:a}=this;a?this._eventHandler(a,!0):o.length&&this._updateHoverStyles(o,o,!0),this.render()}_updateScales(){Zb(this.scales,e=>{OC.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,t=new Set(Object.keys(this._listeners)),n=new Set(e.events);hx(t,n)&&!!this._responsiveListeners===e.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,t=this._getUniformDataChanges()||[];for(const{method:n,start:i,count:s}of t){UN(e,i,"_removeElements"===n?-s:s)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const t=this.data.datasets.length,n=t=>new Set(e.filter(e=>e[0]===t).map((e,t)=>t+","+e.splice(1).join(","))),i=n(0);for(let s=1;s<t;s++)if(!hx(i,n(s)))return;return Array.from(i).map(e=>e.split(",")).map(e=>({method:e[1],start:+e[2],count:+e[3]}))}_updateLayout(e){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;OC.update(this,this.width,this.height,e);const t=this.chartArea,n=t.width<=0||t.height<=0;this._layers=[],Zb(this.boxes,e=>{n&&"chartArea"===e.position||(e.configure&&e.configure(),this._layers.push(...e._layers()))},this),this._layers.forEach((e,t)=>{e._idx=t}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})){for(let e=0,t=this.data.datasets.length;e<t;++e)this.getDatasetMeta(e).controller.configure();for(let t=0,n=this.data.datasets.length;t<n;++t)this._updateDataset(t,dx(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){const n=this.getDatasetMeta(e),i={meta:n,index:e,mode:t,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",i)&&(n.controller._update(t),i.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",i))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(Mw.has(this)?this.attached&&!Mw.running(this)&&Mw.start(this):(this.draw(),MN({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:e,height:t}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(e,t)}if(this.clear(),this.width<=0||this.height<=0)return;if(!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;const t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const t=this._sortedMetasets,n=[];let i,s;for(i=0,s=t.length;i<s;++i){const s=t[i];e&&!s.visible||n.push(s)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;const e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const t=this.ctx,n={meta:e,index:e.index,cancelable:!0},i=Dw(this,e);!1!==this.notifyPlugins("beforeDatasetDraw",n)&&(i&&__(t,i),e.controller.draw(),i&&w_(t),n.cancelable=!1,this.notifyPlugins("afterDatasetDraw",n))}isPointInArea(e){return x_(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,n,i){const s=CC.modes[t];return"function"===typeof s?s(this,e,n,i):[]}getDatasetMeta(e){const t=this.data.datasets[e],n=this._metasets;let i=n.filter(e=>e&&e._dataset===t).pop();return i||(i={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},n.push(i)),i}getContext(){return this.$context||(this.$context=z_(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const t=this.data.datasets[e];if(!t)return!1;const n=this.getDatasetMeta(e);return"boolean"===typeof n.hidden?!n.hidden:!t.hidden}setDatasetVisibility(e,t){this.getDatasetMeta(e).hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,n){const i=n?"show":"hide",s=this.getDatasetMeta(e),r=s.controller._resolveAnimations(void 0,i);ux(t)?(s.data[t].hidden=!n,this.update()):(this.setDatasetVisibility(e,n),r.update(s,{visible:n}),this.update(t=>t.datasetIndex===e?i:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){const t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),Mw.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),y_(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete FN[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(){return this.canvas.toDataURL(...arguments)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,t=this.platform,n=(n,i)=>{t.addEventListener(this,n,i),e[n]=i},i=(e,t,n)=>{e.offsetX=t,e.offsetY=n,this._eventHandler(e)};Zb(this.options.events,e=>n(e,i))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,t=this.platform,n=(n,i)=>{t.addEventListener(this,n,i),e[n]=i},i=(n,i)=>{e[n]&&(t.removeEventListener(this,n,i),delete e[n])},s=(e,t)=>{this.canvas&&this.resize(e,t)};let r;const o=()=>{i("attach",o),this.attached=!0,this.resize(),n("resize",s),n("detach",r)};r=()=>{this.attached=!1,i("resize",s),this._stop(),this._resize(0,0),n("attach",o)},t.isAttached(this.canvas)?o():r()}unbindEvents(){Zb(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},Zb(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,n){const i=n?"set":"remove";let s,r,o,a;for("dataset"===t&&(s=this.getDatasetMeta(e[0].datasetIndex),s.controller["_"+i+"DatasetHoverStyle"]()),o=0,a=e.length;o<a;++o){r=e[o];const t=r&&this.getDatasetMeta(r.datasetIndex).controller;t&&t[i+"HoverStyle"](r.element,r.datasetIndex,r.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const t=this._active||[],n=e.map(e=>{let{datasetIndex:t,index:n}=e;const i=this.getDatasetMeta(t);if(!i)throw new Error("No dataset found at index "+t);return{datasetIndex:t,element:i.data[n],index:n}});!ex(n,t)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,t))}notifyPlugins(e,t,n){return this._plugins.notify(this,e,t,n)}isPluginEnabled(e){return 1===this._plugins._cache.filter(t=>t.plugin.id===e).length}_updateHoverStyles(e,t,n){const i=this.options.hover,s=(e,t)=>e.filter(e=>!t.some(t=>e.datasetIndex===t.datasetIndex&&e.index===t.index)),r=s(t,e),o=n?e:s(e,t);r.length&&this.updateHoverStyle(r,i.mode,!1),o.length&&i.mode&&this.updateHoverStyle(o,i.mode,!0)}_eventHandler(e,t){const n={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},i=t=>(t.options.events||this.options.events).includes(e.native.type);if(!1===this.notifyPlugins("beforeEvent",n,i))return;const s=this._handleEvent(e,t,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,i),(s||n.changed)&&this.render(),this}_handleEvent(e,t,n){const{_active:i=[],options:s}=this,r=t,o=this._getActiveElements(e,i,n,r),a=function(e){return"mouseup"===e.type||"click"===e.type||"contextmenu"===e.type}(e),l=function(e,t,n,i){return n&&"mouseout"!==e.type?i?t:e:null}(e,this._lastEvent,n,a);n&&(this._lastEvent=null,Jb(s.onHover,[e,o,this],this),a&&Jb(s.onClick,[e,o,this],this));const c=!ex(o,i);return(c||t)&&(this._active=o,this._updateHoverStyles(o,i,t)),this._lastEvent=l,c}_getActiveElements(e,t,n,i){if("mouseout"===e.type)return[];if(!n)return t;const s=this.options.hover;return this.getElementsAtEventForMode(e,s.mode,s,i)}}function BN(){return Zb(VN.instances,e=>e._plugins.invalidate())}function HN(e,t,n,i){const s=D_(e.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]);const r=(n-t)/2,o=Math.min(r,i*t/2),a=e=>{const t=(n-Math.min(r,e))*i/2;return Mx(e,0,Math.min(r,t))};return{outerStart:a(s.outerStart),outerEnd:a(s.outerEnd),innerStart:Mx(s.innerStart,0,o),innerEnd:Mx(s.innerEnd,0,o)}}function qN(e,t,n,i){return{x:n+e*Math.cos(t),y:i+e*Math.sin(t)}}function WN(e,t,n,i,s,r){const{x:o,y:a,startAngle:l,pixelMargin:c,innerRadius:u}=t,d=Math.max(t.outerRadius+i+n-c,0),h=u>0?u+i+n+c:0;let f=0;const p=s-l;if(i){const e=((u>0?u-i:0)+(d>0?d-i:0))/2;f=(p-(0!==e?p*e/(e+i):p))/2}const m=(p-Math.max(.001,p*d-n/fx)/d)/2,g=l+m+f,y=s-m-f,{outerStart:v,outerEnd:b,innerStart:x,innerEnd:_}=HN(t,h,d,y-g),w=d-v,C=d-b,N=g+v/w,k=y-b/C,E=h+x,T=h+_,S=g+x/E,I=y-_/T;if(e.beginPath(),r){const t=(N+k)/2;if(e.arc(o,a,d,N,t),e.arc(o,a,d,t,k),b>0){const t=qN(C,k,o,a);e.arc(t.x,t.y,b,k,y+vx)}const n=qN(T,y,o,a);if(e.lineTo(n.x,n.y),_>0){const t=qN(T,I,o,a);e.arc(t.x,t.y,_,y+vx,I+Math.PI)}const i=(y-_/h+(g+x/h))/2;if(e.arc(o,a,h,y-_/h,i,!0),e.arc(o,a,h,i,g+x/h,!0),x>0){const t=qN(E,S,o,a);e.arc(t.x,t.y,x,S+Math.PI,g-vx)}const s=qN(w,g,o,a);if(e.lineTo(s.x,s.y),v>0){const t=qN(w,N,o,a);e.arc(t.x,t.y,v,g-vx,N)}}else{e.moveTo(o,a);const t=Math.cos(N)*d+o,n=Math.sin(N)*d+a;e.lineTo(t,n);const i=Math.cos(k)*d+o,s=Math.sin(k)*d+a;e.lineTo(i,s)}e.closePath()}function GN(e,t,n,i,s){const{fullCircles:r,startAngle:o,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:u,borderDash:d,borderDashOffset:h,borderRadius:f}=l,p="inner"===l.borderAlign;if(!c)return;e.setLineDash(d||[]),e.lineDashOffset=h,p?(e.lineWidth=2*c,e.lineJoin=u||"round"):(e.lineWidth=c,e.lineJoin=u||"bevel");let m=t.endAngle;if(r){WN(e,t,n,i,m,s);for(let t=0;t<r;++t)e.stroke();isNaN(a)||(m=o+(a%px||px))}p&&function(e,t,n){const{startAngle:i,pixelMargin:s,x:r,y:o,outerRadius:a,innerRadius:l}=t;let c=s/a;e.beginPath(),e.arc(r,o,a,i-c,n+c),l>s?(c=s/l,e.arc(r,o,l,n+c,i-c,!0)):e.arc(r,o,s,n+vx,i-vx),e.closePath(),e.clip()}(e,t,m),l.selfJoin&&m-o>=fx&&0===f&&"miter"!==u&&function(e,t,n){const{startAngle:i,x:s,y:r,outerRadius:o,innerRadius:a,options:l}=t,{borderWidth:c,borderJoinStyle:u}=l,d=Math.min(c/o,Dx(i-n));if(e.beginPath(),e.arc(s,r,o-c/2,i+d/2,n-d/2),a>0){const t=Math.min(c/a,Dx(i-n));e.arc(s,r,a+c/2,n-t/2,i+t/2,!0)}else{const t=Math.min(c/2,o*Dx(i-n));if("round"===u)e.arc(s,r,t,n-fx/2,i+fx/2,!0);else if("bevel"===u){const o=2*t*t,a=-o*Math.cos(n+fx/2)+s,l=-o*Math.sin(n+fx/2)+r,c=o*Math.cos(i+fx/2)+s,u=o*Math.sin(i+fx/2)+r;e.lineTo(a,l),e.lineTo(c,u)}}e.closePath(),e.moveTo(0,0),e.rect(0,0,e.canvas.width,e.canvas.height),e.clip("evenodd")}(e,t,m),r||(WN(e,t,n,i,m,s),e.stroke())}a(VN,"defaults",f_),a(VN,"instances",FN),a(VN,"overrides",l_),a(VN,"registry",fN),a(VN,"version","4.5.0"),a(VN,"getChart",zN);class KN extends eN{constructor(e){super(),a(this,"circumference",void 0),a(this,"endAngle",void 0),a(this,"fullCircles",void 0),a(this,"innerRadius",void 0),a(this,"outerRadius",void 0),a(this,"pixelMargin",void 0),a(this,"startAngle",void 0),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,n){const i=this.getProps(["x","y"],n),{angle:s,distance:r}=Px(i,{x:e,y:t}),{startAngle:o,endAngle:a,innerRadius:l,outerRadius:c,circumference:u}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],n),d=(this.options.spacing+this.options.borderWidth)/2,h=Xb(u,a-o),f=Rx(s,o,a)&&o!==a,p=h>=px||f,m=Ox(r,l+d,c+d);return p&&m}getCenterPoint(e){const{x:t,y:n,startAngle:i,endAngle:s,innerRadius:r,outerRadius:o}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:a,spacing:l}=this.options,c=(i+s)/2,u=(r+o+l+a)/2;return{x:t+Math.cos(c)*u,y:n+Math.sin(c)*u}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:t,circumference:n}=this,i=(t.offset||0)/4,s=(t.spacing||0)/2,r=t.circular;if(this.pixelMargin="inner"===t.borderAlign?.33:0,this.fullCircles=n>px?Math.floor(n/px):0,0===n||this.innerRadius<0||this.outerRadius<0)return;e.save();const o=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(o)*i,Math.sin(o)*i);const a=i*(1-Math.sin(Math.min(fx,n||0)));e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor,function(e,t,n,i,s){const{fullCircles:r,startAngle:o,circumference:a}=t;let l=t.endAngle;if(r){WN(e,t,n,i,l,s);for(let t=0;t<r;++t)e.fill();isNaN(a)||(l=o+(a%px||px))}WN(e,t,n,i,l,s),e.fill()}(e,this,a,s,r),GN(e,this,a,s,r),e.restore()}}function YN(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;e.lineCap=Xb(n.borderCapStyle,t.borderCapStyle),e.setLineDash(Xb(n.borderDash,t.borderDash)),e.lineDashOffset=Xb(n.borderDashOffset,t.borderDashOffset),e.lineJoin=Xb(n.borderJoinStyle,t.borderJoinStyle),e.lineWidth=Xb(n.borderWidth,t.borderWidth),e.strokeStyle=Xb(n.borderColor,t.borderColor)}function QN(e,t,n){e.lineTo(n.x,n.y)}function XN(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=e.length,{start:s=0,end:r=i-1}=n,{start:o,end:a}=t,l=Math.max(s,o),c=Math.min(r,a),u=s<o&&r<o||s>a&&r>a;return{count:i,start:l,loop:t.loop,ilen:c<l&&!u?i+c-l:c-l}}function $N(e,t,n,i){const{points:s,options:r}=t,{count:o,start:a,loop:l,ilen:c}=XN(s,n,i),u=function(e){return e.stepped?C_:e.tension||"monotone"===e.cubicInterpolationMode?N_:QN}(r);let d,h,f,{move:p=!0,reverse:m}=i||{};for(d=0;d<=c;++d)h=s[(a+(m?c-d:d))%o],h.skip||(p?(e.moveTo(h.x,h.y),p=!1):u(e,f,h,m,r.stepped),f=h);return l&&(h=s[(a+(m?c:0))%o],u(e,f,h,m,r.stepped)),!!l}function JN(e,t,n,i){const s=t.points,{count:r,start:o,ilen:a}=XN(s,n,i),{move:l=!0,reverse:c}=i||{};let u,d,h,f,p,m,g=0,y=0;const v=e=>(o+(c?a-e:e))%r,b=()=>{f!==p&&(e.lineTo(g,p),e.lineTo(g,f),e.lineTo(g,m))};for(l&&(d=s[v(0)],e.moveTo(d.x,d.y)),u=0;u<=a;++u){if(d=s[v(u)],d.skip)continue;const t=d.x,n=d.y,i=0|t;i===h?(n<f?f=n:n>p&&(p=n),g=(y*g+t)/++y):(b(),e.lineTo(t,n),h=i,y=0,f=p=n),m=n}b()}function ZN(e){const t=e.options,n=t.borderDash&&t.borderDash.length;return!e._decimated&&!e._loop&&!t.tension&&"monotone"!==t.cubicInterpolationMode&&!t.stepped&&!n?JN:$N}a(KN,"id","arc"),a(KN,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),a(KN,"defaultRoutes",{backgroundColor:"backgroundColor"}),a(KN,"descriptors",{_scriptable:!0,_indexable:e=>"borderDash"!==e});const ek="function"===typeof Path2D;function tk(e,t,n,i){ek&&!t.options.segment?function(e,t,n,i){let s=t._path;s||(s=t._path=new Path2D,t.path(s,n,i)&&s.closePath()),YN(e,t.options),e.stroke(s)}(e,t,n,i):function(e,t,n,i){const{segments:s,options:r}=t,o=ZN(t);for(const a of s)YN(e,r,a.style),e.beginPath(),o(e,t,a,{start:n,end:n+i-1})&&e.closePath(),e.stroke()}(e,t,n,i)}class nk extends eN{constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){const n=this.options;if((n.tension||"monotone"===n.cubicInterpolationMode)&&!n.stepped&&!this._pointsUpdated){const i=n.spanGaps?this._loop:this._fullLoop;ow(this._points,n,e,i,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(e,t){const n=e.points,i=e.options.spanGaps,s=n.length;if(!s)return[];const r=!!e._loop,{start:o,end:a}=function(e,t,n,i){let s=0,r=t-1;if(n&&!i)for(;s<t&&!e[s].skip;)s++;for(;s<t&&e[s].skip;)s++;for(s%=t,n&&(r+=s);r>s&&e[r%t].skip;)r--;return r%=t,{start:s,end:r}}(n,s,r,i);return Iw(e,!0===i?[{start:o,end:a,loop:r}]:function(e,t,n,i){const s=e.length,r=[];let o,a=t,l=e[t];for(o=t+1;o<=n;++o){const n=e[o%s];n.skip||n.stop?l.skip||(i=!1,r.push({start:t%s,end:(o-1)%s,loop:i}),t=a=n.stop?o:null):(a=o,l.skip&&(t=o)),l=n}return null!==a&&r.push({start:t%s,end:a%s,loop:i}),r}(n,o,a<o?a+s:a,!!e._fullLoop&&0===o&&a===s-1),n,t)}(this,this.options.segment))}first(){const e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){const e=this.segments,t=this.points,n=e.length;return n&&t[e[n-1].end]}interpolate(e,t){const n=this.options,i=e[t],s=this.points,r=Sw(this,{property:t,start:i,end:i});if(!r.length)return;const o=[],a=function(e){return e.stepped?xw:e.tension||"monotone"===e.cubicInterpolationMode?_w:bw}(n);let l,c;for(l=0,c=r.length;l<c;++l){const{start:c,end:u}=r[l],d=s[c],h=s[u];if(d===h){o.push(d);continue}const f=a(d,h,Math.abs((i-d[t])/(h[t]-d[t])),n.stepped);f[t]=e[t],o.push(f)}return 1===o.length?o[0]:o}pathSegment(e,t,n){return ZN(this)(e,this,t,n)}path(e,t,n){const i=this.segments,s=ZN(this);let r=this._loop;t=t||0,n=n||this.points.length-t;for(const o of i)r&=s(e,this,o,{start:t,end:t+n-1});return!!r}draw(e,t,n,i){const s=this.options||{};(this.points||[]).length&&s.borderWidth&&(e.save(),tk(e,this,n,i),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function ik(e,t,n,i){const s=e.options,{[n]:r}=e.getProps([n],i);return Math.abs(t-r)<s.radius+s.hitRadius}a(nk,"id","line"),a(nk,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),a(nk,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),a(nk,"descriptors",{_scriptable:!0,_indexable:e=>"borderDash"!==e&&"fill"!==e});class sk extends eN{constructor(e){super(),a(this,"parsed",void 0),a(this,"skip",void 0),a(this,"stop",void 0),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,t,n){const i=this.options,{x:s,y:r}=this.getProps(["x","y"],n);return Math.pow(e-s,2)+Math.pow(t-r,2)<Math.pow(i.hitRadius+i.radius,2)}inXRange(e,t){return ik(this,e,"x",t)}inYRange(e,t){return ik(this,e,"y",t)}getCenterPoint(e){const{x:t,y:n}=this.getProps(["x","y"],e);return{x:t,y:n}}size(e){let t=(e=e||this.options||{}).radius||0;t=Math.max(t,t&&e.hoverRadius||0);return 2*(t+(t&&e.borderWidth||0))}draw(e,t){const n=this.options;this.skip||n.radius<.1||!x_(this,t,this.size(n)/2)||(e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.fillStyle=n.backgroundColor,v_(e,n,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}function rk(e,t){const{x:n,y:i,base:s,width:r,height:o}=e.getProps(["x","y","base","width","height"],t);let a,l,c,u,d;return e.horizontal?(d=o/2,a=Math.min(n,s),l=Math.max(n,s),c=i-d,u=i+d):(d=r/2,a=n-d,l=n+d,c=Math.min(i,s),u=Math.max(i,s)),{left:a,top:c,right:l,bottom:u}}function ok(e,t,n,i){return e?0:Mx(t,n,i)}function ak(e){const t=rk(e),n=t.right-t.left,i=t.bottom-t.top,s=function(e,t,n){const i=e.options.borderWidth,s=e.borderSkipped,r=R_(i);return{t:ok(s.top,r.top,0,n),r:ok(s.right,r.right,0,t),b:ok(s.bottom,r.bottom,0,n),l:ok(s.left,r.left,0,t)}}(e,n/2,i/2),r=function(e,t,n){const{enableBorderRadius:i}=e.getProps(["enableBorderRadius"]),s=e.options.borderRadius,r=M_(s),o=Math.min(t,n),a=e.borderSkipped,l=i||Kb(s);return{topLeft:ok(!l||a.top||a.left,r.topLeft,0,o),topRight:ok(!l||a.top||a.right,r.topRight,0,o),bottomLeft:ok(!l||a.bottom||a.left,r.bottomLeft,0,o),bottomRight:ok(!l||a.bottom||a.right,r.bottomRight,0,o)}}(e,n/2,i/2);return{outer:{x:t.left,y:t.top,w:n,h:i,radius:r},inner:{x:t.left+s.l,y:t.top+s.t,w:n-s.l-s.r,h:i-s.t-s.b,radius:{topLeft:Math.max(0,r.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,r.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,r.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,r.bottomRight-Math.max(s.b,s.r))}}}}function lk(e,t,n,i){const s=null===t,r=null===n,o=e&&!(s&&r)&&rk(e,i);return o&&(s||Ox(t,o.left,o.right))&&(r||Ox(n,o.top,o.bottom))}function ck(e,t){e.rect(t.x,t.y,t.w,t.h)}function uk(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=e.x!==n.x?-t:0,s=e.y!==n.y?-t:0,r=(e.x+e.w!==n.x+n.w?t:0)-i,o=(e.y+e.h!==n.y+n.h?t:0)-s;return{x:e.x+i,y:e.y+s,w:e.w+r,h:e.h+o,radius:e.radius}}a(sk,"id","point"),a(sk,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),a(sk,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});class dk extends eN{constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:t,options:{borderColor:n,backgroundColor:i}}=this,{inner:s,outer:r}=ak(this),o=(a=r.radius).topLeft||a.topRight||a.bottomLeft||a.bottomRight?S_:ck;var a;e.save(),r.w===s.w&&r.h===s.h||(e.beginPath(),o(e,uk(r,t,s)),e.clip(),o(e,uk(s,-t,r)),e.fillStyle=n,e.fill("evenodd")),e.beginPath(),o(e,uk(s,t)),e.fillStyle=i,e.fill(),e.restore()}inRange(e,t,n){return lk(this,e,t,n)}inXRange(e,t){return lk(this,e,null,t)}inYRange(e,t){return lk(this,null,e,t)}getCenterPoint(e){const{x:t,y:n,base:i,horizontal:s}=this.getProps(["x","y","base","horizontal"],e);return{x:s?(t+i)/2:t,y:s?n:(n+i)/2}}getRange(e){return"x"===e?this.width/2:this.height/2}}a(dk,"id","bar"),a(dk,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),a(dk,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const hk=(e,t)=>{let{boxHeight:n=t,boxWidth:i=t}=e;return e.usePointStyle&&(n=Math.min(n,t),i=e.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:n,itemHeight:Math.max(t,n)}};class fk extends eN{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,n){this.maxWidth=e,this.maxHeight=t,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let t=Jb(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(t=>e.filter(t,this.chart.data))),e.sort&&(t=t.sort((t,n)=>e.sort(t,n,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){const{options:e,ctx:t}=this;if(!e.display)return void(this.width=this.height=0);const n=e.labels,i=L_(n.font),s=i.size,r=this._computeTitleHeight(),{boxWidth:o,itemHeight:a}=hk(n,s);let l,c;t.font=i.string,this.isHorizontal()?(l=this.maxWidth,c=this._fitRows(r,s,o,a)+10):(c=this.maxHeight,l=this._fitCols(r,i,o,a)+10),this.width=Math.min(l,e.maxWidth||this.maxWidth),this.height=Math.min(c,e.maxHeight||this.maxHeight)}_fitRows(e,t,n,i){const{ctx:s,maxWidth:r,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],l=this.lineWidths=[0],c=i+o;let u=e;s.textAlign="left",s.textBaseline="middle";let d=-1,h=-c;return this.legendItems.forEach((e,f)=>{const p=n+t/2+s.measureText(e.text).width;(0===f||l[l.length-1]+p+2*o>r)&&(u+=c,l[l.length-(f>0?0:1)]=0,h+=c,d++),a[f]={left:0,top:h,row:d,width:p,height:i},l[l.length-1]+=p+o}),u}_fitCols(e,t,n,i){const{ctx:s,maxHeight:r,options:{labels:{padding:o}}}=this,a=this.legendHitBoxes=[],l=this.columnSizes=[],c=r-e;let u=o,d=0,h=0,f=0,p=0;return this.legendItems.forEach((e,r)=>{const{itemWidth:m,itemHeight:g}=function(e,t,n,i,s){const r=function(e,t,n,i){let s=e.text;s&&"string"!==typeof s&&(s=s.reduce((e,t)=>e.length>t.length?e:t));return t+n.size/2+i.measureText(s).width}(i,e,t,n),o=function(e,t,n){let i=e;"string"!==typeof t.text&&(i=pk(t,n));return i}(s,i,t.lineHeight);return{itemWidth:r,itemHeight:o}}(n,t,s,e,i);r>0&&h+g+2*o>c&&(u+=d+o,l.push({width:d,height:h}),f+=d+o,p++,d=h=0),a[r]={left:f,top:h,col:p,width:m,height:g},d=Math.max(d,m),h+=g+o}),u+=d,l.push({width:d,height:h}),u}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:n,labels:{padding:i},rtl:s}}=this,r=ww(s,this.left,this.width);if(this.isHorizontal()){let s=0,o=Gx(n,this.left+i,this.right-this.lineWidths[s]);for(const a of t)s!==a.row&&(s=a.row,o=Gx(n,this.left+i,this.right-this.lineWidths[s])),a.top+=this.top+e+i,a.left=r.leftForLtr(r.x(o),a.width),o+=a.width+i}else{let s=0,o=Gx(n,this.top+e+i,this.bottom-this.columnSizes[s].height);for(const a of t)a.col!==s&&(s=a.col,o=Gx(n,this.top+e+i,this.bottom-this.columnSizes[s].height)),a.top=o,a.left+=this.left+i,a.left=r.leftForLtr(r.x(a.left),a.width),o+=a.height+i}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){const e=this.ctx;__(e,this),this._draw(),w_(e)}}_draw(){const{options:e,columnSizes:t,lineWidths:n,ctx:i}=this,{align:s,labels:r}=e,o=f_.color,a=ww(e.rtl,this.left,this.width),l=L_(r.font),{padding:c}=r,u=l.size,d=u/2;let h;this.drawTitle(),i.textAlign=a.textAlign("left"),i.textBaseline="middle",i.lineWidth=.5,i.font=l.string;const{boxWidth:f,boxHeight:p,itemHeight:m}=hk(r,u),g=this.isHorizontal(),y=this._computeTitleHeight();h=g?{x:Gx(s,this.left+c,this.right-n[0]),y:this.top+c+y,line:0}:{x:this.left+c,y:Gx(s,this.top+y+c,this.bottom-t[0].height),line:0},Cw(this.ctx,e.textDirection);const v=m+c;this.legendItems.forEach((b,x)=>{i.strokeStyle=b.fontColor,i.fillStyle=b.fontColor;const _=i.measureText(b.text).width,w=a.textAlign(b.textAlign||(b.textAlign=r.textAlign)),C=f+d+_;let N=h.x,k=h.y;a.setWidth(this.width),g?x>0&&N+C+c>this.right&&(k=h.y+=v,h.line++,N=h.x=Gx(s,this.left+c,this.right-n[h.line])):x>0&&k+v>this.bottom&&(N=h.x=N+t[h.line].width+c,h.line++,k=h.y=Gx(s,this.top+y+c,this.bottom-t[h.line].height));if(function(e,t,n){if(isNaN(f)||f<=0||isNaN(p)||p<0)return;i.save();const s=Xb(n.lineWidth,1);if(i.fillStyle=Xb(n.fillStyle,o),i.lineCap=Xb(n.lineCap,"butt"),i.lineDashOffset=Xb(n.lineDashOffset,0),i.lineJoin=Xb(n.lineJoin,"miter"),i.lineWidth=s,i.strokeStyle=Xb(n.strokeStyle,o),i.setLineDash(Xb(n.lineDash,[])),r.usePointStyle){const o={radius:p*Math.SQRT2/2,pointStyle:n.pointStyle,rotation:n.rotation,borderWidth:s},l=a.xPlus(e,f/2);b_(i,o,l,t+d,r.pointStyleWidth&&f)}else{const r=t+Math.max((u-p)/2,0),o=a.leftForLtr(e,f),l=M_(n.borderRadius);i.beginPath(),Object.values(l).some(e=>0!==e)?S_(i,{x:o,y:r,w:f,h:p,radius:l}):i.rect(o,r,f,p),i.fill(),0!==s&&i.stroke()}i.restore()}(a.x(N),k,b),N=((e,t,n,i)=>e===(i?"left":"right")?n:"center"===e?(t+n)/2:t)(w,N+f+d,g?N+C:this.right,e.rtl),function(e,t,n){T_(i,n.text,e,t+m/2,l,{strikethrough:n.hidden,textAlign:a.textAlign(n.textAlign)})}(a.x(N),k,b),g)h.x+=C+c;else if("string"!==typeof b.text){const e=l.lineHeight;h.y+=pk(b,e)+c}else h.y+=v}),Nw(this.ctx,e.textDirection)}drawTitle(){const e=this.options,t=e.title,n=L_(t.font),i=O_(t.padding);if(!t.display)return;const s=ww(e.rtl,this.left,this.width),r=this.ctx,o=t.position,a=n.size/2,l=i.top+a;let c,u=this.left,d=this.width;if(this.isHorizontal())d=Math.max(...this.lineWidths),c=this.top+l,u=Gx(e.align,u,this.right-d);else{const t=this.columnSizes.reduce((e,t)=>Math.max(e,t.height),0);c=l+Gx(e.align,this.top,this.bottom-t-e.labels.padding-this._computeTitleHeight())}const h=Gx(o,u,u+d);r.textAlign=s.textAlign(Wx(o)),r.textBaseline="middle",r.strokeStyle=t.color,r.fillStyle=t.color,r.font=n.string,T_(r,t.text,h,c,n)}_computeTitleHeight(){const e=this.options.title,t=L_(e.font),n=O_(e.padding);return e.display?t.lineHeight+n.height:0}_getLegendItemAt(e,t){let n,i,s;if(Ox(e,this.left,this.right)&&Ox(t,this.top,this.bottom))for(s=this.legendHitBoxes,n=0;n<s.length;++n)if(i=s[n],Ox(e,i.left,i.left+i.width)&&Ox(t,i.top,i.top+i.height))return this.legendItems[n];return null}handleEvent(e){const t=this.options;if(!function(e,t){if(("mousemove"===e||"mouseout"===e)&&(t.onHover||t.onLeave))return!0;if(t.onClick&&("click"===e||"mouseup"===e))return!0;return!1}(e.type,t))return;const n=this._getLegendItemAt(e.x,e.y);if("mousemove"===e.type||"mouseout"===e.type){const i=this._hoveredItem,s=((e,t)=>null!==e&&null!==t&&e.datasetIndex===t.datasetIndex&&e.index===t.index)(i,n);i&&!s&&Jb(t.onLeave,[e,i,this],this),this._hoveredItem=n,n&&!s&&Jb(t.onHover,[e,n,this],this)}else n&&Jb(t.onClick,[e,n,this],this)}}function pk(e,t){return t*(e.text?e.text.length:0)}var mk={id:"legend",_element:fk,start(e,t,n){const i=e.legend=new fk({ctx:e.ctx,options:n,chart:e});OC.configure(e,i,n),OC.addBox(e,i)},stop(e){OC.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,n){const i=e.legend;OC.configure(e,i,n),i.options=n},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,n){const i=t.datasetIndex,s=n.chart;s.isDatasetVisible(i)?(s.hide(i),t.hidden=!0):(s.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:n,pointStyle:i,textAlign:s,color:r,useBorderRadius:o,borderRadius:a}}=e.legend.options;return e._getSortedDatasetMetas().map(e=>{const l=e.controller.getStyle(n?0:void 0),c=O_(l.borderWidth);return{text:t[e.index].label,fillStyle:l.backgroundColor,fontColor:r,hidden:!e.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(c.width+c.height)/4,strokeStyle:l.borderColor,pointStyle:i||l.pointStyle,rotation:l.rotation,textAlign:s||l.textAlign,borderRadius:o&&(a||l.borderRadius),datasetIndex:e.index}},this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class gk extends eN{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){const n=this.options;if(this.left=0,this.top=0,!n.display)return void(this.width=this.height=this.right=this.bottom=0);this.width=this.right=e,this.height=this.bottom=t;const i=Gb(n.text)?n.text.length:1;this._padding=O_(n.padding);const s=i*L_(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=s:this.width=s}isHorizontal(){const e=this.options.position;return"top"===e||"bottom"===e}_drawArgs(e){const{top:t,left:n,bottom:i,right:s,options:r}=this,o=r.align;let a,l,c,u=0;return this.isHorizontal()?(l=Gx(o,n,s),c=t+e,a=s-n):("left"===r.position?(l=n+e,c=Gx(o,i,t),u=-.5*fx):(l=s-e,c=Gx(o,t,i),u=.5*fx),a=i-t),{titleX:l,titleY:c,maxWidth:a,rotation:u}}draw(){const e=this.ctx,t=this.options;if(!t.display)return;const n=L_(t.font),i=n.lineHeight/2+this._padding.top,{titleX:s,titleY:r,maxWidth:o,rotation:a}=this._drawArgs(i);T_(e,t.text,0,0,n,{color:t.color,maxWidth:o,rotation:a,textAlign:Wx(t.align),textBaseline:"middle",translation:[s,r]})}}var yk={id:"title",_element:gk,start(e,t,n){!function(e,t){const n=new gk({ctx:e.ctx,options:t,chart:e});OC.configure(e,n,t),OC.addBox(e,n),e.titleBlock=n}(e,n)},stop(e){const t=e.titleBlock;OC.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,n){const i=e.titleBlock;OC.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};new WeakMap;const vk={average(e){if(!e.length)return!1;let t,n,i=new Set,s=0,r=0;for(t=0,n=e.length;t<n;++t){const n=e[t].element;if(n&&n.hasValue()){const e=n.tooltipPosition();i.add(e.x),s+=e.y,++r}}if(0===r||0===i.size)return!1;const o=[...i].reduce((e,t)=>e+t)/i.size;return{x:o,y:s/r}},nearest(e,t){if(!e.length)return!1;let n,i,s,r=t.x,o=t.y,a=Number.POSITIVE_INFINITY;for(n=0,i=e.length;n<i;++n){const i=e[n].element;if(i&&i.hasValue()){const e=jx(t,i.getCenterPoint());e<a&&(a=e,s=i)}}if(s){const e=s.tooltipPosition();r=e.x,o=e.y}return{x:r,y:o}}};function bk(e,t){return t&&(Gb(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function xk(e){return("string"===typeof e||e instanceof String)&&e.indexOf("\n")>-1?e.split("\n"):e}function _k(e,t){const{element:n,datasetIndex:i,index:s}=t,r=e.getDatasetMeta(i).controller,{label:o,value:a}=r.getLabelAndValue(s);return{chart:e,label:o,parsed:r.getParsed(s),raw:e.data.datasets[i].data[s],formattedValue:a,dataset:r.getDataset(),dataIndex:s,datasetIndex:i,element:n}}function wk(e,t){const n=e.chart.ctx,{body:i,footer:s,title:r}=e,{boxWidth:o,boxHeight:a}=t,l=L_(t.bodyFont),c=L_(t.titleFont),u=L_(t.footerFont),d=r.length,h=s.length,f=i.length,p=O_(t.padding);let m=p.height,g=0,y=i.reduce((e,t)=>e+t.before.length+t.lines.length+t.after.length,0);if(y+=e.beforeBody.length+e.afterBody.length,d&&(m+=d*c.lineHeight+(d-1)*t.titleSpacing+t.titleMarginBottom),y){m+=f*(t.displayColors?Math.max(a,l.lineHeight):l.lineHeight)+(y-f)*l.lineHeight+(y-1)*t.bodySpacing}h&&(m+=t.footerMarginTop+h*u.lineHeight+(h-1)*t.footerSpacing);let v=0;const b=function(e){g=Math.max(g,n.measureText(e).width+v)};return n.save(),n.font=c.string,Zb(e.title,b),n.font=l.string,Zb(e.beforeBody.concat(e.afterBody),b),v=t.displayColors?o+2+t.boxPadding:0,Zb(i,e=>{Zb(e.before,b),Zb(e.lines,b),Zb(e.after,b)}),v=0,n.font=u.string,Zb(e.footer,b),n.restore(),g+=p.width,{width:g,height:m}}function Ck(e,t,n,i){const{x:s,width:r}=n,{width:o,chartArea:{left:a,right:l}}=e;let c="center";return"center"===i?c=s<=(a+l)/2?"left":"right":s<=r/2?c="left":s>=o-r/2&&(c="right"),function(e,t,n,i){const{x:s,width:r}=i,o=n.caretSize+n.caretPadding;return"left"===e&&s+r+o>t.width||"right"===e&&s-r-o<0||void 0}(c,e,t,n)&&(c="center"),c}function Nk(e,t,n){const i=n.yAlign||t.yAlign||function(e,t){const{y:n,height:i}=t;return n<i/2?"top":n>e.height-i/2?"bottom":"center"}(e,n);return{xAlign:n.xAlign||t.xAlign||Ck(e,t,n,i),yAlign:i}}function kk(e,t,n,i){const{caretSize:s,caretPadding:r,cornerRadius:o}=e,{xAlign:a,yAlign:l}=n,c=s+r,{topLeft:u,topRight:d,bottomLeft:h,bottomRight:f}=M_(o);let p=function(e,t){let{x:n,width:i}=e;return"right"===t?n-=i:"center"===t&&(n-=i/2),n}(t,a);const m=function(e,t,n){let{y:i,height:s}=e;return"top"===t?i+=n:i-="bottom"===t?s+n:s/2,i}(t,l,c);return"center"===l?"left"===a?p+=c:"right"===a&&(p-=c):"left"===a?p-=Math.max(u,h)+s:"right"===a&&(p+=Math.max(d,f)+s),{x:Mx(p,0,i.width-t.width),y:Mx(m,0,i.height-t.height)}}function Ek(e,t,n){const i=O_(n.padding);return"center"===t?e.x+e.width/2:"right"===t?e.x+e.width-i.right:e.x+i.left}function Tk(e){return bk([],xk(e))}function Sk(e,t){const n=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return n?e.override(n):e}const Ik={beforeTitle:Hb,title(e){if(e.length>0){const t=e[0],n=t.chart.data.labels,i=n?n.length:0;if(this&&this.options&&"dataset"===this.options.mode)return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return n[t.dataIndex]}return""},afterTitle:Hb,beforeBody:Hb,beforeLabel:Hb,label(e){if(this&&this.options&&"dataset"===this.options.mode)return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const n=e.formattedValue;return Wb(n)||(t+=n),t},labelColor(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:Hb,afterBody:Hb,beforeFooter:Hb,footer:Hb,afterFooter:Hb};function Pk(e,t,n,i){const s=e[t].call(n,i);return"undefined"===typeof s?Ik[t].call(n,i):s}class jk extends eN{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const t=this.chart,n=this.options.setContext(this.getContext()),i=n.enabled&&t.options.animation&&n.animations,s=new zw(this.chart,i);return i._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=(e=this.chart.getContext(),t=this,n=this._tooltipItems,z_(e,{tooltip:t,tooltipItems:n,type:"tooltip"})));var e,t,n}getTitle(e,t){const{callbacks:n}=t,i=Pk(n,"beforeTitle",this,e),s=Pk(n,"title",this,e),r=Pk(n,"afterTitle",this,e);let o=[];return o=bk(o,xk(i)),o=bk(o,xk(s)),o=bk(o,xk(r)),o}getBeforeBody(e,t){return Tk(Pk(t.callbacks,"beforeBody",this,e))}getBody(e,t){const{callbacks:n}=t,i=[];return Zb(e,e=>{const t={before:[],lines:[],after:[]},s=Sk(n,e);bk(t.before,xk(Pk(s,"beforeLabel",this,e))),bk(t.lines,Pk(s,"label",this,e)),bk(t.after,xk(Pk(s,"afterLabel",this,e))),i.push(t)}),i}getAfterBody(e,t){return Tk(Pk(t.callbacks,"afterBody",this,e))}getFooter(e,t){const{callbacks:n}=t,i=Pk(n,"beforeFooter",this,e),s=Pk(n,"footer",this,e),r=Pk(n,"afterFooter",this,e);let o=[];return o=bk(o,xk(i)),o=bk(o,xk(s)),o=bk(o,xk(r)),o}_createItems(e){const t=this._active,n=this.chart.data,i=[],s=[],r=[];let o,a,l=[];for(o=0,a=t.length;o<a;++o)l.push(_k(this.chart,t[o]));return e.filter&&(l=l.filter((t,i,s)=>e.filter(t,i,s,n))),e.itemSort&&(l=l.sort((t,i)=>e.itemSort(t,i,n))),Zb(l,t=>{const n=Sk(e.callbacks,t);i.push(Pk(n,"labelColor",this,t)),s.push(Pk(n,"labelPointStyle",this,t)),r.push(Pk(n,"labelTextColor",this,t))}),this.labelColors=i,this.labelPointStyles=s,this.labelTextColors=r,this.dataPoints=l,l}update(e,t){const n=this.options.setContext(this.getContext()),i=this._active;let s,r=[];if(i.length){const e=vk[n.position].call(this,i,this._eventPosition);r=this._createItems(n),this.title=this.getTitle(r,n),this.beforeBody=this.getBeforeBody(r,n),this.body=this.getBody(r,n),this.afterBody=this.getAfterBody(r,n),this.footer=this.getFooter(r,n);const t=this._size=wk(this,n),o=Object.assign({},e,t),a=Nk(this.chart,n,o),l=kk(n,o,a,this.chart);this.xAlign=a.xAlign,this.yAlign=a.yAlign,s={opacity:1,x:l.x,y:l.y,width:t.width,height:t.height,caretX:e.x,caretY:e.y}}else 0!==this.opacity&&(s={opacity:0});this._tooltipItems=r,this.$context=void 0,s&&this._resolveAnimations().update(this,s),e&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,n,i){const s=this.getCaretPosition(e,n,i);t.lineTo(s.x1,s.y1),t.lineTo(s.x2,s.y2),t.lineTo(s.x3,s.y3)}getCaretPosition(e,t,n){const{xAlign:i,yAlign:s}=this,{caretSize:r,cornerRadius:o}=n,{topLeft:a,topRight:l,bottomLeft:c,bottomRight:u}=M_(o),{x:d,y:h}=e,{width:f,height:p}=t;let m,g,y,v,b,x;return"center"===s?(b=h+p/2,"left"===i?(m=d,g=m-r,v=b+r,x=b-r):(m=d+f,g=m+r,v=b-r,x=b+r),y=m):(g="left"===i?d+Math.max(a,c)+r:"right"===i?d+f-Math.max(l,u)-r:this.caretX,"top"===s?(v=h,b=v-r,m=g-r,y=g+r):(v=h+p,b=v+r,m=g+r,y=g-r),x=v),{x1:m,x2:g,x3:y,y1:v,y2:b,y3:x}}drawTitle(e,t,n){const i=this.title,s=i.length;let r,o,a;if(s){const l=ww(n.rtl,this.x,this.width);for(e.x=Ek(this,n.titleAlign,n),t.textAlign=l.textAlign(n.titleAlign),t.textBaseline="middle",r=L_(n.titleFont),o=n.titleSpacing,t.fillStyle=n.titleColor,t.font=r.string,a=0;a<s;++a)t.fillText(i[a],l.x(e.x),e.y+r.lineHeight/2),e.y+=r.lineHeight+o,a+1===s&&(e.y+=n.titleMarginBottom-o)}}_drawColorBox(e,t,n,i,s){const r=this.labelColors[n],o=this.labelPointStyles[n],{boxHeight:a,boxWidth:l}=s,c=L_(s.bodyFont),u=Ek(this,"left",s),d=i.x(u),h=a<c.lineHeight?(c.lineHeight-a)/2:0,f=t.y+h;if(s.usePointStyle){const t={radius:Math.min(l,a)/2,pointStyle:o.pointStyle,rotation:o.rotation,borderWidth:1},n=i.leftForLtr(d,l)+l/2,c=f+a/2;e.strokeStyle=s.multiKeyBackground,e.fillStyle=s.multiKeyBackground,v_(e,t,n,c),e.strokeStyle=r.borderColor,e.fillStyle=r.backgroundColor,v_(e,t,n,c)}else{e.lineWidth=Kb(r.borderWidth)?Math.max(...Object.values(r.borderWidth)):r.borderWidth||1,e.strokeStyle=r.borderColor,e.setLineDash(r.borderDash||[]),e.lineDashOffset=r.borderDashOffset||0;const t=i.leftForLtr(d,l),n=i.leftForLtr(i.xPlus(d,1),l-2),o=M_(r.borderRadius);Object.values(o).some(e=>0!==e)?(e.beginPath(),e.fillStyle=s.multiKeyBackground,S_(e,{x:t,y:f,w:l,h:a,radius:o}),e.fill(),e.stroke(),e.fillStyle=r.backgroundColor,e.beginPath(),S_(e,{x:n,y:f+1,w:l-2,h:a-2,radius:o}),e.fill()):(e.fillStyle=s.multiKeyBackground,e.fillRect(t,f,l,a),e.strokeRect(t,f,l,a),e.fillStyle=r.backgroundColor,e.fillRect(n,f+1,l-2,a-2))}e.fillStyle=this.labelTextColors[n]}drawBody(e,t,n){const{body:i}=this,{bodySpacing:s,bodyAlign:r,displayColors:o,boxHeight:a,boxWidth:l,boxPadding:c}=n,u=L_(n.bodyFont);let d=u.lineHeight,h=0;const f=ww(n.rtl,this.x,this.width),p=function(n){t.fillText(n,f.x(e.x+h),e.y+d/2),e.y+=d+s},m=f.textAlign(r);let g,y,v,b,x,_,w;for(t.textAlign=r,t.textBaseline="middle",t.font=u.string,e.x=Ek(this,m,n),t.fillStyle=n.bodyColor,Zb(this.beforeBody,p),h=o&&"right"!==m?"center"===r?l/2+c:l+2+c:0,b=0,_=i.length;b<_;++b){for(g=i[b],y=this.labelTextColors[b],t.fillStyle=y,Zb(g.before,p),v=g.lines,o&&v.length&&(this._drawColorBox(t,e,b,f,n),d=Math.max(u.lineHeight,a)),x=0,w=v.length;x<w;++x)p(v[x]),d=u.lineHeight;Zb(g.after,p)}h=0,d=u.lineHeight,Zb(this.afterBody,p),e.y-=s}drawFooter(e,t,n){const i=this.footer,s=i.length;let r,o;if(s){const a=ww(n.rtl,this.x,this.width);for(e.x=Ek(this,n.footerAlign,n),e.y+=n.footerMarginTop,t.textAlign=a.textAlign(n.footerAlign),t.textBaseline="middle",r=L_(n.footerFont),t.fillStyle=n.footerColor,t.font=r.string,o=0;o<s;++o)t.fillText(i[o],a.x(e.x),e.y+r.lineHeight/2),e.y+=r.lineHeight+n.footerSpacing}}drawBackground(e,t,n,i){const{xAlign:s,yAlign:r}=this,{x:o,y:a}=e,{width:l,height:c}=n,{topLeft:u,topRight:d,bottomLeft:h,bottomRight:f}=M_(i.cornerRadius);t.fillStyle=i.backgroundColor,t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.beginPath(),t.moveTo(o+u,a),"top"===r&&this.drawCaret(e,t,n,i),t.lineTo(o+l-d,a),t.quadraticCurveTo(o+l,a,o+l,a+d),"center"===r&&"right"===s&&this.drawCaret(e,t,n,i),t.lineTo(o+l,a+c-f),t.quadraticCurveTo(o+l,a+c,o+l-f,a+c),"bottom"===r&&this.drawCaret(e,t,n,i),t.lineTo(o+h,a+c),t.quadraticCurveTo(o,a+c,o,a+c-h),"center"===r&&"left"===s&&this.drawCaret(e,t,n,i),t.lineTo(o,a+u),t.quadraticCurveTo(o,a,o+u,a),t.closePath(),t.fill(),i.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){const t=this.chart,n=this.$animations,i=n&&n.x,s=n&&n.y;if(i||s){const n=vk[e.position].call(this,this._active,this._eventPosition);if(!n)return;const r=this._size=wk(this,e),o=Object.assign({},n,this._size),a=Nk(t,e,o),l=kk(e,o,a,t);i._to===l.x&&s._to===l.y||(this.xAlign=a.xAlign,this.yAlign=a.yAlign,this.width=r.width,this.height=r.height,this.caretX=n.x,this.caretY=n.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(e){const t=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(t);const i={width:this.width,height:this.height},s={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const r=O_(t.padding),o=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&o&&(e.save(),e.globalAlpha=n,this.drawBackground(s,e,i,t),Cw(e,t.textDirection),s.y+=r.top,this.drawTitle(s,e,t),this.drawBody(s,e,t),this.drawFooter(s,e,t),Nw(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){const n=this._active,i=e.map(e=>{let{datasetIndex:t,index:n}=e;const i=this.chart.getDatasetMeta(t);if(!i)throw new Error("Cannot find a dataset at index "+t);return{datasetIndex:t,element:i.data[n],index:n}}),s=!ex(n,i),r=this._positionChanged(i,t);(s||r)&&(this._active=i,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const i=this.options,s=this._active||[],r=this._getActiveElements(e,s,t,n),o=this._positionChanged(r,e),a=t||!ex(r,s)||o;return a&&(this._active=r,(i.enabled||i.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),a}_getActiveElements(e,t,n,i){const s=this.options;if("mouseout"===e.type)return[];if(!i)return t.filter(e=>this.chart.data.datasets[e.datasetIndex]&&void 0!==this.chart.getDatasetMeta(e.datasetIndex).controller.getParsed(e.index));const r=this.chart.getElementsAtEventForMode(e,s.mode,s,n);return s.reverse&&r.reverse(),r}_positionChanged(e,t){const{caretX:n,caretY:i,options:s}=this,r=vk[s.position].call(this,e,t);return!1!==r&&(n!==r.x||i!==r.y)}}a(jk,"positioners",vk);var Ak={id:"tooltip",_element:jk,positioners:vk,afterInit(e,t,n){n&&(e.tooltip=new jk({chart:e,options:n}))},beforeUpdate(e,t,n){e.tooltip&&e.tooltip.initialize(n)},reset(e,t,n){e.tooltip&&e.tooltip.initialize(n)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const n={tooltip:t};if(!1===e.notifyPlugins("beforeTooltipDraw",c(c({},n),{},{cancelable:!0})))return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",n)}},afterEvent(e,t){if(e.tooltip){const n=t.replay;e.tooltip.handleEvent(t.event,n,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Ik},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>"filter"!==e&&"itemSort"!==e&&"external"!==e,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};function Dk(e,t,n,i){const s=e.indexOf(t);if(-1===s)return((e,t,n,i)=>("string"===typeof t?(n=e.push(t)-1,i.unshift({index:n,label:t})):isNaN(t)&&(n=null),n))(e,t,n,i);return s!==e.lastIndexOf(t)?n:s}function Rk(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}class Mk extends uN{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const t=this._addedLabels;if(t.length){const e=this.getLabels();for(const{index:n,label:i}of t)e[n]===i&&e.splice(n,1);this._addedLabels=[]}super.init(e)}parse(e,t){if(Wb(e))return null;const n=this.getLabels();return((e,t)=>null===e?null:Mx(Math.round(e),0,t))(t=isFinite(t)&&n[t]===e?t:Dk(n,e,Xb(t,e),this._addedLabels),n.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let{min:n,max:i}=this.getMinMax(!0);"ticks"===this.options.bounds&&(e||(n=0),t||(i=this.getLabels().length-1)),this.min=n,this.max=i}buildTicks(){const e=this.min,t=this.max,n=this.options.offset,i=[];let s=this.getLabels();s=0===e&&t===s.length-1?s:s.slice(e,t+1),this._valueRange=Math.max(s.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let r=e;r<=t;r++)i.push({value:r});return i}getLabelForValue(e){return Rk.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return"number"!==typeof e&&(e=this.parse(e)),null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function Ok(e,t){const n=[],{bounds:i,step:s,min:r,max:o,precision:a,count:l,maxTicks:c,maxDigits:u,includeBounds:d}=e,h=s||1,f=c-1,{min:p,max:m}=t,g=!Wb(r),y=!Wb(o),v=!Wb(l),b=(m-p)/(u+1);let x,_,w,C,N=Nx((m-p)/f/h)*h;if(N<1e-14&&!g&&!y)return[{value:p},{value:m}];C=Math.ceil(m/N)-Math.floor(p/N),C>f&&(N=Nx(C*N/f/h)*h),Wb(a)||(x=Math.pow(10,a),N=Math.ceil(N*x)/x),"ticks"===i?(_=Math.floor(p/N)*N,w=Math.ceil(m/N)*N):(_=p,w=m),g&&y&&s&&function(e,t){const n=Math.round(e);return n-t<=e&&n+t>=e}((o-r)/s,N/1e3)?(C=Math.round(Math.min((o-r)/N,c)),N=(o-r)/C,_=r,w=o):v?(_=g?r:_,w=y?o:w,C=l-1,N=(w-_)/C):(C=(w-_)/N,C=Cx(C,Math.round(C),N/1e3)?Math.round(C):Math.ceil(C));const k=Math.max(Ix(N),Ix(_));x=Math.pow(10,Wb(a)?k:a),_=Math.round(_*x)/x,w=Math.round(w*x)/x;let E=0;for(g&&(d&&_!==r?(n.push({value:r}),_<r&&E++,Cx(Math.round((_+E*N)*x)/x,r,Lk(r,b,e))&&E++):_<r&&E++);E<C;++E){const e=Math.round((_+E*N)*x)/x;if(y&&e>o)break;n.push({value:e})}return y&&d&&w!==o?n.length&&Cx(n[n.length-1].value,o,Lk(o,b,e))?n[n.length-1].value=o:n.push({value:o}):y&&w!==o||n.push({value:w}),n}function Lk(e,t,n){let{horizontal:i,minRotation:s}=n;const r=Tx(s),o=(i?Math.sin(r):Math.cos(r))||.001,a=.75*t*(""+e).length;return Math.min(t/o,a)}a(Mk,"id","category"),a(Mk,"defaults",{ticks:{callback:Rk}});class Fk extends uN{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return Wb(e)||("number"===typeof e||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:i,max:s}=this;const r=e=>i=t?i:e,o=e=>s=n?s:e;if(e){const e=wx(i),t=wx(s);e<0&&t<0?o(0):e>0&&t>0&&r(0)}if(i===s){let t=0===s?1:Math.abs(.05*s);o(s+t),e||r(i-t)}this.min=i,this.max=s}getTickLimit(){const e=this.options.ticks;let t,{maxTicksLimit:n,stepSize:i}=e;return i?(t=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,t>1e3&&(console.warn("scales.".concat(this.id,".ticks.stepSize: ").concat(i," would result generating up to ").concat(t," ticks. Limiting to 1000.")),t=1e3)):(t=this.computeTickLimit(),n=n||11),n&&(t=Math.min(n,t)),t}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,t=e.ticks;let n=this.getTickLimit();n=Math.max(2,n);const i=Ok({maxTicks:n,bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:!1!==t.includeBounds},this._range||this);return"ticks"===e.bounds&&Ex(i,this,"value"),e.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}configure(){const e=this.ticks;let t=this.min,n=this.max;if(super.configure(),this.options.offset&&e.length){const i=(n-t)/Math.max(e.length-1,1)/2;t-=i,n+=i}this._startValue=t,this._endValue=n,this._valueRange=n-t}getLabelForValue(e){return r_(e,this.chart.options.locale,this.options.ticks.format)}}class zk extends Fk{determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=Yb(e)?e:0,this.max=Yb(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),t=e?this.width:this.height,n=Tx(this.options.ticks.minRotation),i=(e?Math.sin(n):Math.cos(n))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(t/Math.min(40,s.lineHeight/i))}getPixelForValue(e){return null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}a(zk,"id","linear"),a(zk,"defaults",{ticks:{callback:a_.formatters.numeric}});const Uk=e=>Math.floor(_x(e)),Vk=(e,t)=>Math.pow(10,Uk(e)+t);function Bk(e){return 1===e/Math.pow(10,Uk(e))}function Hk(e,t,n){const i=Math.pow(10,n),s=Math.floor(e/i);return Math.ceil(t/i)-s}function qk(e,t){let{min:n,max:i}=t;n=Qb(e.min,n);const s=[],r=Uk(n);let o=function(e,t){let n=Uk(t-e);for(;Hk(e,t,n)>10;)n++;for(;Hk(e,t,n)<10;)n--;return Math.min(n,Uk(e))}(n,i),a=o<0?Math.pow(10,Math.abs(o)):1;const l=Math.pow(10,o),c=r>o?Math.pow(10,r):0,u=Math.round((n-c)*a)/a,d=Math.floor((n-c)/l/10)*l*10;let h=Math.floor((u-d)/Math.pow(10,o)),f=Qb(e.min,Math.round((c+d+h*Math.pow(10,o))*a)/a);for(;f<i;)s.push({value:f,major:Bk(f),significand:h}),h>=10?h=h<15?15:20:h++,h>=20&&(o++,h=2,a=o>=0?1:a),f=Math.round((c+d+h*Math.pow(10,o))*a)/a;const p=Qb(e.max,f);return s.push({value:p,major:Bk(p),significand:h}),s}class Wk extends uN{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){const n=Fk.prototype.parse.apply(this,[e,t]);if(0!==n)return Yb(n)&&n>0?n:null;this._zero=!0}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!0);this.min=Yb(e)?Math.max(0,e):null,this.max=Yb(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Yb(this._userMin)&&(this.min=e===Vk(this.min,0)?Vk(this.min,-1):Vk(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:e,maxDefined:t}=this.getUserBounds();let n=this.min,i=this.max;const s=t=>n=e?n:t,r=e=>i=t?i:e;n===i&&(n<=0?(s(1),r(10)):(s(Vk(n,-1)),r(Vk(i,1)))),n<=0&&s(Vk(i,-1)),i<=0&&r(Vk(n,1)),this.min=n,this.max=i}buildTicks(){const e=this.options,t=qk({min:this._userMin,max:this._userMax},this);return"ticks"===e.bounds&&Ex(t,this,"value"),e.reverse?(t.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),t}getLabelForValue(e){return void 0===e?"0":r_(e,this.chart.options.locale,this.options.ticks.format)}configure(){const e=this.min;super.configure(),this._startValue=_x(e),this._valueRange=_x(this.max)-_x(e)}getPixelForValue(e){return void 0!==e&&0!==e||(e=this.min),null===e||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(_x(e)-this._startValue)/this._valueRange)}getValueForPixel(e){const t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}function Gk(e){const t=e.ticks;if(t.display&&e.display){const e=O_(t.backdropPadding);return Xb(t.font&&t.font.size,f_.font.size)+e.height}return 0}function Kk(e,t,n){return n=Gb(n)?n:[n],{w:m_(e,t.string,n),h:n.length*t.lineHeight}}function Yk(e,t,n,i,s){return e===i||e===s?{start:t-n/2,end:t+n/2}:e<i||e>s?{start:t-n,end:t}:{start:t,end:t+n}}function Qk(e){const t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},n=Object.assign({},t),i=[],s=[],r=e._pointLabels.length,o=e.options.pointLabels,a=o.centerPointLabels?fx/r:0;for(let l=0;l<r;l++){const r=o.setContext(e.getPointLabelContext(l));s[l]=r.padding;const c=e.getPointPosition(l,e.drawingArea+s[l],a),u=L_(r.font),d=Kk(e.ctx,u,e._pointLabels[l]);i[l]=d;const h=Dx(e.getIndexAngle(l)+a),f=Math.round(Sx(h));Xk(n,t,h,Yk(f,c.x,d.w,0,180),Yk(f,c.y,d.h,90,270))}e.setCenterPoint(t.l-n.l,n.r-t.r,t.t-n.t,n.b-t.b),e._pointLabelItems=function(e,t,n){const i=[],s=e._pointLabels.length,r=e.options,{centerPointLabels:o,display:a}=r.pointLabels,l={extra:Gk(r)/2,additionalAngle:o?fx/s:0};let c;for(let u=0;u<s;u++){l.padding=n[u],l.size=t[u];const s=$k(e,u,l);i.push(s),"auto"===a&&(s.visible=Jk(s,c),s.visible&&(c=s))}return i}(e,i,s)}function Xk(e,t,n,i,s){const r=Math.abs(Math.sin(n)),o=Math.abs(Math.cos(n));let a=0,l=0;i.start<t.l?(a=(t.l-i.start)/r,e.l=Math.min(e.l,t.l-a)):i.end>t.r&&(a=(i.end-t.r)/r,e.r=Math.max(e.r,t.r+a)),s.start<t.t?(l=(t.t-s.start)/o,e.t=Math.min(e.t,t.t-l)):s.end>t.b&&(l=(s.end-t.b)/o,e.b=Math.max(e.b,t.b+l))}function $k(e,t,n){const i=e.drawingArea,{extra:s,additionalAngle:r,padding:o,size:a}=n,l=e.getPointPosition(t,i+s+o,r),c=Math.round(Sx(Dx(l.angle+vx))),u=function(e,t,n){90===n||270===n?e-=t/2:(n>270||n<90)&&(e-=t);return e}(l.y,a.h,c),d=function(e){if(0===e||180===e)return"center";if(e<180)return"left";return"right"}(c),h=function(e,t,n){"right"===n?e-=t:"center"===n&&(e-=t/2);return e}(l.x,a.w,d);return{visible:!0,x:l.x,y:u,textAlign:d,left:h,top:u,right:h+a.w,bottom:u+a.h}}function Jk(e,t){if(!t)return!0;const{left:n,top:i,right:s,bottom:r}=e;return!(x_({x:n,y:i},t)||x_({x:n,y:r},t)||x_({x:s,y:i},t)||x_({x:s,y:r},t))}function Zk(e,t,n){const{left:i,top:s,right:r,bottom:o}=n,{backdropColor:a}=t;if(!Wb(a)){const n=M_(t.borderRadius),l=O_(t.backdropPadding);e.fillStyle=a;const c=i-l.left,u=s-l.top,d=r-i+l.width,h=o-s+l.height;Object.values(n).some(e=>0!==e)?(e.beginPath(),S_(e,{x:c,y:u,w:d,h:h,radius:n}),e.fill()):e.fillRect(c,u,d,h)}}function eE(e,t,n,i){const{ctx:s}=e;if(n)s.arc(e.xCenter,e.yCenter,t,0,px);else{let n=e.getPointPosition(0,t);s.moveTo(n.x,n.y);for(let r=1;r<i;r++)n=e.getPointPosition(r,t),s.lineTo(n.x,n.y)}}a(Wk,"id","logarithmic"),a(Wk,"defaults",{ticks:{callback:a_.formatters.logarithmic,major:{enabled:!0}}});class tE extends Fk{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const e=this._padding=O_(Gk(this.options)/2),t=this.width=this.maxWidth-e.width,n=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+n/2+e.top),this.drawingArea=Math.floor(Math.min(t,n)/2)}determineDataLimits(){const{min:e,max:t}=this.getMinMax(!1);this.min=Yb(e)&&!isNaN(e)?e:0,this.max=Yb(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Gk(this.options))}generateTickLabels(e){Fk.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((e,t)=>{const n=Jb(this.options.pointLabels.callback,[e,t],this);return n||0===n?n:""}).filter((e,t)=>this.chart.getDataVisibility(t))}fit(){const e=this.options;e.display&&e.pointLabels.display?Qk(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,n,i){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((n-i)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,n,i))}getIndexAngle(e){return Dx(e*(px/(this._pointLabels.length||1))+Tx(this.options.startAngle||0))}getDistanceFromCenterForValue(e){if(Wb(e))return NaN;const t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(Wb(e))return NaN;const t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){const t=this._pointLabels||[];if(e>=0&&e<t.length){const n=t[e];return function(e,t,n){return z_(e,{label:n,index:t,type:"pointLabel"})}(this.getContext(),e,n)}}getPointPosition(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=this.getIndexAngle(e)-vx+n;return{x:Math.cos(i)*t+this.xCenter,y:Math.sin(i)*t+this.yCenter,angle:i}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){const{left:t,top:n,right:i,bottom:s}=this._pointLabelItems[e];return{left:t,top:n,right:i,bottom:s}}drawBackground(){const{backgroundColor:e,grid:{circular:t}}=this.options;if(e){const n=this.ctx;n.save(),n.beginPath(),eE(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),n.closePath(),n.fillStyle=e,n.fill(),n.restore()}}drawGrid(){const e=this.ctx,t=this.options,{angleLines:n,grid:i,border:s}=t,r=this._pointLabels.length;let o,a,l;if(t.pointLabels.display&&function(e,t){const{ctx:n,options:{pointLabels:i}}=e;for(let s=t-1;s>=0;s--){const t=e._pointLabelItems[s];if(!t.visible)continue;const r=i.setContext(e.getPointLabelContext(s));Zk(n,r,t);const o=L_(r.font),{x:a,y:l,textAlign:c}=t;T_(n,e._pointLabels[s],a,l+o.lineHeight/2,o,{color:r.color,textAlign:c,textBaseline:"middle"})}}(this,r),i.display&&this.ticks.forEach((e,t)=>{if(0!==t||0===t&&this.min<0){a=this.getDistanceFromCenterForValue(e.value);const n=this.getContext(t),o=i.setContext(n),l=s.setContext(n);!function(e,t,n,i,s){const r=e.ctx,o=t.circular,{color:a,lineWidth:l}=t;!o&&!i||!a||!l||n<0||(r.save(),r.strokeStyle=a,r.lineWidth=l,r.setLineDash(s.dash||[]),r.lineDashOffset=s.dashOffset,r.beginPath(),eE(e,n,o,i),r.closePath(),r.stroke(),r.restore())}(this,o,a,r,l)}}),n.display){for(e.save(),o=r-1;o>=0;o--){const i=n.setContext(this.getPointLabelContext(o)),{color:s,lineWidth:r}=i;r&&s&&(e.lineWidth=r,e.strokeStyle=s,e.setLineDash(i.borderDash),e.lineDashOffset=i.borderDashOffset,a=this.getDistanceFromCenterForValue(t.reverse?this.min:this.max),l=this.getPointPosition(o,a),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(l.x,l.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){const e=this.ctx,t=this.options,n=t.ticks;if(!n.display)return;const i=this.getIndexAngle(0);let s,r;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(i),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((i,o)=>{if(0===o&&this.min>=0&&!t.reverse)return;const a=n.setContext(this.getContext(o)),l=L_(a.font);if(s=this.getDistanceFromCenterForValue(this.ticks[o].value),a.showLabelBackdrop){e.font=l.string,r=e.measureText(i.label).width,e.fillStyle=a.backdropColor;const t=O_(a.backdropPadding);e.fillRect(-r/2-t.left,-s-l.size/2-t.top,r+t.width,l.size+t.height)}T_(e,i.label,0,-s,l,{color:a.color,strokeColor:a.textStrokeColor,strokeWidth:a.textStrokeWidth})}),e.restore()}drawTitle(){}}a(tE,"id","radialLinear"),a(tE,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:a_.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:e=>e,padding:5,centerPointLabels:!1}}),a(tE,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),a(tE,"descriptors",{angleLines:{_fallback:"grid"}});const nE={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},iE=Object.keys(nE);function sE(e,t){return e-t}function rE(e,t){if(Wb(t))return null;const n=e._adapter,{parser:i,round:s,isoWeekday:r}=e._parseOpts;let o=t;return"function"===typeof i&&(o=i(o)),Yb(o)||(o="string"===typeof i?n.parse(o,i):n.parse(o)),null===o?null:(s&&(o="week"!==s||!kx(r)&&!0!==r?n.startOf(o,s):n.startOf(o,"isoWeek",r)),+o)}function oE(e,t,n,i){const s=iE.length;for(let r=iE.indexOf(e);r<s-1;++r){const e=nE[iE[r]],s=e.steps?e.steps:Number.MAX_SAFE_INTEGER;if(e.common&&Math.ceil((n-t)/(s*e.size))<=i)return iE[r]}return iE[s-1]}function aE(e,t,n){if(n){if(n.length){const{lo:i,hi:s}=Lx(n,t);e[n[i]>=t?n[i]:n[s]]=!0}}else e[t]=!0}function lE(e,t,n){const i=[],s={},r=t.length;let o,a;for(o=0;o<r;++o)a=t[o],s[a]=o,i.push({value:a,major:!1});return 0!==r&&n?function(e,t,n,i){const s=e._adapter,r=+s.startOf(t[0].value,i),o=t[t.length-1].value;let a,l;for(a=r;a<=o;a=+s.add(a,1,i))l=n[a],l>=0&&(t[l].major=!0);return t}(e,i,s,n):i}class cE extends uN{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=e.time||(e.time={}),i=this._adapter=new gC(e.adapters.date);i.init(t),rx(n.displayFormats,i.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return void 0===e?null:rE(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,t=this._adapter,n=e.time.unit||"day";let{min:i,max:s,minDefined:r,maxDefined:o}=this.getUserBounds();function a(e){r||isNaN(e.min)||(i=Math.min(i,e.min)),o||isNaN(e.max)||(s=Math.max(s,e.max))}r&&o||(a(this._getLabelBounds()),"ticks"===e.bounds&&"labels"===e.ticks.source||a(this.getMinMax(!1))),i=Yb(i)&&!isNaN(i)?i:+t.startOf(Date.now(),n),s=Yb(s)&&!isNaN(s)?s:+t.endOf(Date.now(),n)+1,this.min=Math.min(i,s-1),this.max=Math.max(i+1,s)}_getLabelBounds(){const e=this.getLabelTimestamps();let t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return e.length&&(t=e[0],n=e[e.length-1]),{min:t,max:n}}buildTicks(){const e=this.options,t=e.time,n=e.ticks,i="labels"===n.source?this.getLabelTimestamps():this._generate();"ticks"===e.bounds&&i.length&&(this.min=this._userMin||i[0],this.max=this._userMax||i[i.length-1]);const s=this.min,r=function(e,t,n){let i=0,s=e.length;for(;i<s&&e[i]<t;)i++;for(;s>i&&e[s-1]>n;)s--;return i>0||s<e.length?e.slice(i,s):e}(i,s,this.max);return this._unit=t.unit||(n.autoSkip?oE(t.minUnit,this.min,this.max,this._getLabelCapacity(s)):function(e,t,n,i,s){for(let r=iE.length-1;r>=iE.indexOf(n);r--){const n=iE[r];if(nE[n].common&&e._adapter.diff(s,i,n)>=t-1)return n}return iE[n?iE.indexOf(n):0]}(this,r.length,t.minUnit,this.min,this.max)),this._majorUnit=n.major.enabled&&"year"!==this._unit?function(e){for(let t=iE.indexOf(e)+1,n=iE.length;t<n;++t)if(nE[iE[t]].common)return iE[t]}(this._unit):void 0,this.initOffsets(i),e.reverse&&r.reverse(),lE(this,r,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(){let e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=0,s=0;this.options.offset&&n.length&&(e=this.getDecimalForValue(n[0]),i=1===n.length?1-e:(this.getDecimalForValue(n[1])-e)/2,t=this.getDecimalForValue(n[n.length-1]),s=1===n.length?t:(t-this.getDecimalForValue(n[n.length-2]))/2);const r=n.length<3?.5:.25;i=Mx(i,0,r),s=Mx(s,0,r),this._offsets={start:i,end:s,factor:1/(i+1+s)}}_generate(){const e=this._adapter,t=this.min,n=this.max,i=this.options,s=i.time,r=s.unit||oE(s.minUnit,t,n,this._getLabelCapacity(t)),o=Xb(i.ticks.stepSize,1),a="week"===r&&s.isoWeekday,l=kx(a)||!0===a,c={};let u,d,h=t;if(l&&(h=+e.startOf(h,"isoWeek",a)),h=+e.startOf(h,l?"day":r),e.diff(n,t,r)>1e5*o)throw new Error(t+" and "+n+" are too far apart with stepSize of "+o+" "+r);const f="data"===i.ticks.source&&this.getDataTimestamps();for(u=h,d=0;u<n;u=+e.add(u,o,r),d++)aE(c,u,f);return u!==n&&"ticks"!==i.bounds&&1!==d||aE(c,u,f),Object.keys(c).sort(sE).map(e=>+e)}getLabelForValue(e){const t=this._adapter,n=this.options.time;return n.tooltipFormat?t.format(e,n.tooltipFormat):t.format(e,n.displayFormats.datetime)}format(e,t){const n=this.options.time.displayFormats,i=this._unit,s=t||n[i];return this._adapter.format(e,s)}_tickFormatFunction(e,t,n,i){const s=this.options,r=s.ticks.callback;if(r)return Jb(r,[e,t,n],this);const o=s.time.displayFormats,a=this._unit,l=this._majorUnit,c=a&&o[a],u=l&&o[l],d=n[t],h=l&&u&&d&&d.major;return this._adapter.format(e,i||(h?u:c))}generateTickLabels(e){let t,n,i;for(t=0,n=e.length;t<n;++t)i=e[t],i.label=this._tickFormatFunction(i.value,t,e)}getDecimalForValue(e){return null===e?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const t=this._offsets,n=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+n)*t.factor)}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+n*(this.max-this.min)}_getLabelSize(e){const t=this.options.ticks,n=this.ctx.measureText(e).width,i=Tx(this.isHorizontal()?t.maxRotation:t.minRotation),s=Math.cos(i),r=Math.sin(i),o=this._resolveTickFontOptions(0).size;return{w:n*s+o*r,h:n*r+o*s}}_getLabelCapacity(e){const t=this.options.time,n=t.displayFormats,i=n[t.unit]||n.millisecond,s=this._tickFormatFunction(e,0,lE(this,[e],this._majorUnit),i),r=this._getLabelSize(s),o=Math.floor(this.isHorizontal()?this.width/r.w:this.height/r.h)-1;return o>0?o:1}getDataTimestamps(){let e,t,n=this._cache.data||[];if(n.length)return n;const i=this.getMatchingVisibleMetas();if(this._normalized&&i.length)return this._cache.data=i[0].controller.getAllParsedValues(this);for(e=0,t=i.length;e<t;++e)n=n.concat(i[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(n)}getLabelTimestamps(){const e=this._cache.labels||[];let t,n;if(e.length)return e;const i=this.getLabels();for(t=0,n=i.length;t<n;++t)e.push(rE(this,i[t]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return Bx(e.sort(sE))}}function uE(e,t,n){let i,s,r,o,a=0,l=e.length-1;n?(t>=e[a].pos&&t<=e[l].pos&&({lo:a,hi:l}=Fx(e,"pos",t)),({pos:i,time:r}=e[a]),({pos:s,time:o}=e[l])):(t>=e[a].time&&t<=e[l].time&&({lo:a,hi:l}=Fx(e,"time",t)),({time:i,pos:r}=e[a]),({time:s,pos:o}=e[l]));const c=s-i;return c?r+(o-r)*(t-i)/c:r}a(cE,"id","time"),a(cE,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});class dE extends cE{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=uE(t,this.min),this._tableRange=uE(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:t,max:n}=this,i=[],s=[];let r,o,a,l,c;for(r=0,o=e.length;r<o;++r)l=e[r],l>=t&&l<=n&&i.push(l);if(i.length<2)return[{time:t,pos:0},{time:n,pos:1}];for(r=0,o=i.length;r<o;++r)c=i[r+1],a=i[r-1],l=i[r],Math.round((c+a)/2)!==l&&s.push({time:l,pos:r/(o-1)});return s}_generate(){const e=this.min,t=this.max;let n=super.getDataTimestamps();return n.includes(e)&&n.length||n.splice(0,0,e),n.includes(t)&&1!==n.length||n.push(t),n.sort((e,t)=>e-t)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const t=this.getDataTimestamps(),n=this.getLabelTimestamps();return e=t.length&&n.length?this.normalize(t.concat(n)):t.length?t:n,e=this._cache.all=e,e}getDecimalForValue(e){return(uE(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const t=this._offsets,n=this.getDecimalForPixel(e)/t.factor-t.end;return uE(this._table,n*this._tableRange+this._minPos,!0)}}a(dE,"id","timeseries"),a(dE,"defaults",cE.defaults);const hE=["height","width","redraw","datasetIdKey","type","data","options","plugins","fallbackContent","updateMode"],fE="label";function pE(e,t){"function"===typeof e?e(t):e&&(e.current=t)}function mE(e,t){e.labels=t}function gE(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:fE;const i=[];e.datasets=t.map(t=>{const s=e.datasets.find(e=>e[n]===t[n]);return s&&t.data&&!i.includes(s)?(i.push(s),Object.assign(s,t),s):c({},t)})}function yE(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fE;const n={labels:[],datasets:[]};return mE(n,e.labels),gE(n,e.datasets,t),n}function vE(e,t){const{height:n=150,width:s=300,redraw:r=!1,datasetIdKey:o,type:a,data:l,options:u,plugins:d=[],fallbackContent:h,updateMode:f}=e,p=cb(e,hE),m=(0,i.useRef)(null),g=(0,i.useRef)(null),y=()=>{m.current&&(g.current=new VN(m.current,{type:a,data:yE(l,o),options:u&&c({},u),plugins:d}),pE(t,g.current))},v=()=>{pE(t,null),g.current&&(g.current.destroy(),g.current=null)};return(0,i.useEffect)(()=>{!r&&g.current&&u&&function(e,t){const n=e.options;n&&t&&Object.assign(n,t)}(g.current,u)},[r,u]),(0,i.useEffect)(()=>{!r&&g.current&&mE(g.current.config.data,l.labels)},[r,l.labels]),(0,i.useEffect)(()=>{!r&&g.current&&l.datasets&&gE(g.current.config.data,l.datasets,o)},[r,l.datasets]),(0,i.useEffect)(()=>{g.current&&(r?(v(),setTimeout(y)):g.current.update(f))},[r,u,l.labels,l.datasets,f]),(0,i.useEffect)(()=>{g.current&&(v(),setTimeout(y))},[a]),(0,i.useEffect)(()=>(y(),()=>v()),[]),i.createElement("canvas",c({ref:m,role:"img",height:n,width:s},p),h)}const bE=(0,i.forwardRef)(vE);function xE(e,t){return VN.register(t),(0,i.forwardRef)((t,n)=>i.createElement(bE,c(c({},t),{},{ref:n,type:e})))}const _E=xE("line",cC),wE=xE("bar",oC);function CE(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e)){var s=e.length;for(t=0;t<s;t++)e[t]&&(n=CE(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}const NE=function(){for(var e,t,n=0,i="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=CE(e))&&(i&&(i+=" "),i+=t);return i},kE=["theme","type","isLoading"];!function(e){if(!e||"undefined"==typeof document)return;let t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}(':root{--toastify-color-light: #fff;--toastify-color-dark: #121212;--toastify-color-info: #3498db;--toastify-color-success: #07bc0c;--toastify-color-warning: #f1c40f;--toastify-color-error: hsl(6, 78%, 57%);--toastify-color-transparent: rgba(255, 255, 255, .7);--toastify-icon-color-info: var(--toastify-color-info);--toastify-icon-color-success: var(--toastify-color-success);--toastify-icon-color-warning: var(--toastify-color-warning);--toastify-icon-color-error: var(--toastify-color-error);--toastify-container-width: fit-content;--toastify-toast-width: 320px;--toastify-toast-offset: 16px;--toastify-toast-top: max(var(--toastify-toast-offset), env(safe-area-inset-top));--toastify-toast-right: max(var(--toastify-toast-offset), env(safe-area-inset-right));--toastify-toast-left: max(var(--toastify-toast-offset), env(safe-area-inset-left));--toastify-toast-bottom: max(var(--toastify-toast-offset), env(safe-area-inset-bottom));--toastify-toast-background: #fff;--toastify-toast-padding: 14px;--toastify-toast-min-height: 64px;--toastify-toast-max-height: 800px;--toastify-toast-bd-radius: 6px;--toastify-toast-shadow: 0px 4px 12px rgba(0, 0, 0, .1);--toastify-font-family: sans-serif;--toastify-z-index: 9999;--toastify-text-color-light: #757575;--toastify-text-color-dark: #fff;--toastify-text-color-info: #fff;--toastify-text-color-success: #fff;--toastify-text-color-warning: #fff;--toastify-text-color-error: #fff;--toastify-spinner-color: #616161;--toastify-spinner-color-empty-area: #e0e0e0;--toastify-color-progress-light: linear-gradient(to right, #4cd964, #5ac8fa, #007aff, #34aadc, #5856d6, #ff2d55);--toastify-color-progress-dark: #bb86fc;--toastify-color-progress-info: var(--toastify-color-info);--toastify-color-progress-success: var(--toastify-color-success);--toastify-color-progress-warning: var(--toastify-color-warning);--toastify-color-progress-error: var(--toastify-color-error);--toastify-color-progress-bgo: .2}.Toastify__toast-container{z-index:var(--toastify-z-index);-webkit-transform:translate3d(0,0,var(--toastify-z-index));position:fixed;width:var(--toastify-container-width);box-sizing:border-box;color:#fff;display:flex;flex-direction:column}.Toastify__toast-container--top-left{top:var(--toastify-toast-top);left:var(--toastify-toast-left)}.Toastify__toast-container--top-center{top:var(--toastify-toast-top);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--top-right{top:var(--toastify-toast-top);right:var(--toastify-toast-right);align-items:end}.Toastify__toast-container--bottom-left{bottom:var(--toastify-toast-bottom);left:var(--toastify-toast-left)}.Toastify__toast-container--bottom-center{bottom:var(--toastify-toast-bottom);left:50%;transform:translate(-50%);align-items:center}.Toastify__toast-container--bottom-right{bottom:var(--toastify-toast-bottom);right:var(--toastify-toast-right);align-items:end}.Toastify__toast{--y: 0;position:relative;touch-action:none;width:var(--toastify-toast-width);min-height:var(--toastify-toast-min-height);box-sizing:border-box;margin-bottom:1rem;padding:var(--toastify-toast-padding);border-radius:var(--toastify-toast-bd-radius);box-shadow:var(--toastify-toast-shadow);max-height:var(--toastify-toast-max-height);font-family:var(--toastify-font-family);z-index:0;display:flex;flex:1 auto;align-items:center;word-break:break-word}@media only screen and (max-width: 480px){.Toastify__toast-container{width:100vw;left:env(safe-area-inset-left);margin:0}.Toastify__toast-container--top-left,.Toastify__toast-container--top-center,.Toastify__toast-container--top-right{top:env(safe-area-inset-top);transform:translate(0)}.Toastify__toast-container--bottom-left,.Toastify__toast-container--bottom-center,.Toastify__toast-container--bottom-right{bottom:env(safe-area-inset-bottom);transform:translate(0)}.Toastify__toast-container--rtl{right:env(safe-area-inset-right);left:initial}.Toastify__toast{--toastify-toast-width: 100%;margin-bottom:0;border-radius:0}}.Toastify__toast-container[data-stacked=true]{width:var(--toastify-toast-width)}.Toastify__toast--stacked{position:absolute;width:100%;transform:translate3d(0,var(--y),0) scale(var(--s));transition:transform .3s}.Toastify__toast--stacked[data-collapsed] .Toastify__toast-body,.Toastify__toast--stacked[data-collapsed] .Toastify__close-button{transition:opacity .1s}.Toastify__toast--stacked[data-collapsed=false]{overflow:visible}.Toastify__toast--stacked[data-collapsed=true]:not(:last-child)>*{opacity:0}.Toastify__toast--stacked:after{content:"";position:absolute;left:0;right:0;height:calc(var(--g) * 1px);bottom:100%}.Toastify__toast--stacked[data-pos=top]{top:0}.Toastify__toast--stacked[data-pos=bot]{bottom:0}.Toastify__toast--stacked[data-pos=bot].Toastify__toast--stacked:before{transform-origin:top}.Toastify__toast--stacked[data-pos=top].Toastify__toast--stacked:before{transform-origin:bottom}.Toastify__toast--stacked:before{content:"";position:absolute;left:0;right:0;bottom:0;height:100%;transform:scaleY(3);z-index:-1}.Toastify__toast--rtl{direction:rtl}.Toastify__toast--close-on-click{cursor:pointer}.Toastify__toast-icon{margin-inline-end:10px;width:22px;flex-shrink:0;display:flex}.Toastify--animate{animation-fill-mode:both;animation-duration:.5s}.Toastify--animate-icon{animation-fill-mode:both;animation-duration:.3s}.Toastify__toast-theme--dark{background:var(--toastify-color-dark);color:var(--toastify-text-color-dark)}.Toastify__toast-theme--light,.Toastify__toast-theme--colored.Toastify__toast--default{background:var(--toastify-color-light);color:var(--toastify-text-color-light)}.Toastify__toast-theme--colored.Toastify__toast--info{color:var(--toastify-text-color-info);background:var(--toastify-color-info)}.Toastify__toast-theme--colored.Toastify__toast--success{color:var(--toastify-text-color-success);background:var(--toastify-color-success)}.Toastify__toast-theme--colored.Toastify__toast--warning{color:var(--toastify-text-color-warning);background:var(--toastify-color-warning)}.Toastify__toast-theme--colored.Toastify__toast--error{color:var(--toastify-text-color-error);background:var(--toastify-color-error)}.Toastify__progress-bar-theme--light{background:var(--toastify-color-progress-light)}.Toastify__progress-bar-theme--dark{background:var(--toastify-color-progress-dark)}.Toastify__progress-bar--info{background:var(--toastify-color-progress-info)}.Toastify__progress-bar--success{background:var(--toastify-color-progress-success)}.Toastify__progress-bar--warning{background:var(--toastify-color-progress-warning)}.Toastify__progress-bar--error{background:var(--toastify-color-progress-error)}.Toastify__progress-bar-theme--colored.Toastify__progress-bar--info,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--success,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--warning,.Toastify__progress-bar-theme--colored.Toastify__progress-bar--error{background:var(--toastify-color-transparent)}.Toastify__close-button{color:#fff;position:absolute;top:6px;right:6px;background:transparent;outline:none;border:none;padding:0;cursor:pointer;opacity:.7;transition:.3s ease;z-index:1}.Toastify__toast--rtl .Toastify__close-button{left:6px;right:unset}.Toastify__close-button--light{color:#000;opacity:.3}.Toastify__close-button>svg{fill:currentColor;height:16px;width:14px}.Toastify__close-button:hover,.Toastify__close-button:focus{opacity:1}@keyframes Toastify__trackProgress{0%{transform:scaleX(1)}to{transform:scaleX(0)}}.Toastify__progress-bar{position:absolute;bottom:0;left:0;width:100%;height:100%;z-index:1;opacity:.7;transform-origin:left}.Toastify__progress-bar--animated{animation:Toastify__trackProgress linear 1 forwards}.Toastify__progress-bar--controlled{transition:transform .2s}.Toastify__progress-bar--rtl{right:0;left:initial;transform-origin:right;border-bottom-left-radius:initial}.Toastify__progress-bar--wrp{position:absolute;overflow:hidden;bottom:0;left:0;width:100%;height:5px;border-bottom-left-radius:var(--toastify-toast-bd-radius);border-bottom-right-radius:var(--toastify-toast-bd-radius)}.Toastify__progress-bar--wrp[data-hidden=true]{opacity:0}.Toastify__progress-bar--bg{opacity:var(--toastify-color-progress-bgo);width:100%;height:100%}.Toastify__spinner{width:20px;height:20px;box-sizing:border-box;border:2px solid;border-radius:100%;border-color:var(--toastify-spinner-color-empty-area);border-right-color:var(--toastify-spinner-color);animation:Toastify__spin .65s linear infinite}@keyframes Toastify__bounceInRight{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(3000px,0,0)}60%{opacity:1;transform:translate3d(-25px,0,0)}75%{transform:translate3d(10px,0,0)}90%{transform:translate3d(-5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutRight{20%{opacity:1;transform:translate3d(-20px,var(--y),0)}to{opacity:0;transform:translate3d(2000px,var(--y),0)}}@keyframes Toastify__bounceInLeft{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(-3000px,0,0)}60%{opacity:1;transform:translate3d(25px,0,0)}75%{transform:translate3d(-10px,0,0)}90%{transform:translate3d(5px,0,0)}to{transform:none}}@keyframes Toastify__bounceOutLeft{20%{opacity:1;transform:translate3d(20px,var(--y),0)}to{opacity:0;transform:translate3d(-2000px,var(--y),0)}}@keyframes Toastify__bounceInUp{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,3000px,0)}60%{opacity:1;transform:translate3d(0,-20px,0)}75%{transform:translate3d(0,10px,0)}90%{transform:translate3d(0,-5px,0)}to{transform:translateZ(0)}}@keyframes Toastify__bounceOutUp{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,-2000px,0)}}@keyframes Toastify__bounceInDown{0%,60%,75%,90%,to{animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{opacity:0;transform:translate3d(0,-3000px,0)}60%{opacity:1;transform:translate3d(0,25px,0)}75%{transform:translate3d(0,-10px,0)}90%{transform:translate3d(0,5px,0)}to{transform:none}}@keyframes Toastify__bounceOutDown{20%{transform:translate3d(0,calc(var(--y) - 10px),0)}40%,45%{opacity:1;transform:translate3d(0,calc(var(--y) + 20px),0)}to{opacity:0;transform:translate3d(0,2000px,0)}}.Toastify__bounce-enter--top-left,.Toastify__bounce-enter--bottom-left{animation-name:Toastify__bounceInLeft}.Toastify__bounce-enter--top-right,.Toastify__bounce-enter--bottom-right{animation-name:Toastify__bounceInRight}.Toastify__bounce-enter--top-center{animation-name:Toastify__bounceInDown}.Toastify__bounce-enter--bottom-center{animation-name:Toastify__bounceInUp}.Toastify__bounce-exit--top-left,.Toastify__bounce-exit--bottom-left{animation-name:Toastify__bounceOutLeft}.Toastify__bounce-exit--top-right,.Toastify__bounce-exit--bottom-right{animation-name:Toastify__bounceOutRight}.Toastify__bounce-exit--top-center{animation-name:Toastify__bounceOutUp}.Toastify__bounce-exit--bottom-center{animation-name:Toastify__bounceOutDown}@keyframes Toastify__zoomIn{0%{opacity:0;transform:scale3d(.3,.3,.3)}50%{opacity:1}}@keyframes Toastify__zoomOut{0%{opacity:1}50%{opacity:0;transform:translate3d(0,var(--y),0) scale3d(.3,.3,.3)}to{opacity:0}}.Toastify__zoom-enter{animation-name:Toastify__zoomIn}.Toastify__zoom-exit{animation-name:Toastify__zoomOut}@keyframes Toastify__flipIn{0%{transform:perspective(400px) rotateX(90deg);animation-timing-function:ease-in;opacity:0}40%{transform:perspective(400px) rotateX(-20deg);animation-timing-function:ease-in}60%{transform:perspective(400px) rotateX(10deg);opacity:1}80%{transform:perspective(400px) rotateX(-5deg)}to{transform:perspective(400px)}}@keyframes Toastify__flipOut{0%{transform:translate3d(0,var(--y),0) perspective(400px)}30%{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(-20deg);opacity:1}to{transform:translate3d(0,var(--y),0) perspective(400px) rotateX(90deg);opacity:0}}.Toastify__flip-enter{animation-name:Toastify__flipIn}.Toastify__flip-exit{animation-name:Toastify__flipOut}@keyframes Toastify__slideInRight{0%{transform:translate3d(110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInLeft{0%{transform:translate3d(-110%,0,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInUp{0%{transform:translate3d(0,110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideInDown{0%{transform:translate3d(0,-110%,0);visibility:visible}to{transform:translate3d(0,var(--y),0)}}@keyframes Toastify__slideOutRight{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(110%,var(--y),0)}}@keyframes Toastify__slideOutLeft{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(-110%,var(--y),0)}}@keyframes Toastify__slideOutDown{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,500px,0)}}@keyframes Toastify__slideOutUp{0%{transform:translate3d(0,var(--y),0)}to{visibility:hidden;transform:translate3d(0,-500px,0)}}.Toastify__slide-enter--top-left,.Toastify__slide-enter--bottom-left{animation-name:Toastify__slideInLeft}.Toastify__slide-enter--top-right,.Toastify__slide-enter--bottom-right{animation-name:Toastify__slideInRight}.Toastify__slide-enter--top-center{animation-name:Toastify__slideInDown}.Toastify__slide-enter--bottom-center{animation-name:Toastify__slideInUp}.Toastify__slide-exit--top-left,.Toastify__slide-exit--bottom-left{animation-name:Toastify__slideOutLeft;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-right,.Toastify__slide-exit--bottom-right{animation-name:Toastify__slideOutRight;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--top-center{animation-name:Toastify__slideOutUp;animation-timing-function:ease-in;animation-duration:.3s}.Toastify__slide-exit--bottom-center{animation-name:Toastify__slideOutDown;animation-timing-function:ease-in;animation-duration:.3s}@keyframes Toastify__spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}\n');var EE=e=>"number"==typeof e&&!isNaN(e),TE=e=>"string"==typeof e,SE=e=>"function"==typeof e,IE=e=>TE(e)||SE(e)?e:null,PE=(e,t)=>!1===e||EE(e)&&e>0?e:t,jE=e=>(0,i.isValidElement)(e)||TE(e)||SE(e)||EE(e);function AE(e){let{enter:t,exit:n,appendPosition:s=!1,collapse:r=!0,collapseDuration:o=300}=e;return function(e){let{children:a,position:l,preventExitTransition:c,done:u,nodeRef:d,isIn:h,playToast:f}=e,p=s?"".concat(t,"--").concat(l):t,m=s?"".concat(n,"--").concat(l):n,g=(0,i.useRef)(0);return(0,i.useLayoutEffect)(()=>{let e=d.current,t=p.split(" "),n=i=>{i.target===d.current&&(f(),e.removeEventListener("animationend",n),e.removeEventListener("animationcancel",n),0===g.current&&"animationcancel"!==i.type&&e.classList.remove(...t))};e.classList.add(...t),e.addEventListener("animationend",n),e.addEventListener("animationcancel",n)},[]),(0,i.useEffect)(()=>{let e=d.current,t=()=>{e.removeEventListener("animationend",t),r?function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,{scrollHeight:i,style:s}=e;requestAnimationFrame(()=>{s.minHeight="initial",s.height=i+"px",s.transition="all ".concat(n,"ms"),requestAnimationFrame(()=>{s.height="0",s.padding="0",s.margin="0",setTimeout(t,n)})})}(e,u,o):u()};h||(c?t():(g.current=1,e.className+=" ".concat(m),e.addEventListener("animationend",t)))},[h]),i.createElement(i.Fragment,null,a)}}function DE(e,t){return{content:RE(e.content,e.props),containerId:e.props.containerId,id:e.props.toastId,theme:e.props.theme,type:e.props.type,data:e.props.data||{},isLoading:e.props.isLoading,icon:e.props.icon,reason:e.removalReason,status:t}}function RE(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,i.isValidElement)(e)&&!TE(e.type)?(0,i.cloneElement)(e,{closeToast:t.closeToast,toastProps:t,data:t.data,isPaused:n}):SE(e)?e({closeToast:t.closeToast,toastProps:t,data:t.data,isPaused:n}):e}function ME(e){let{delay:t,isRunning:n,closeToast:s,type:r="default",hide:o,className:a,controlledProgress:l,progress:u,rtl:d,isIn:h,theme:f}=e,p=o||l&&0===u,m={animationDuration:"".concat(t,"ms"),animationPlayState:n?"running":"paused"};l&&(m.transform="scaleX(".concat(u,")"));let g=NE("Toastify__progress-bar",l?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated","Toastify__progress-bar-theme--".concat(f),"Toastify__progress-bar--".concat(r),{"Toastify__progress-bar--rtl":d}),y=SE(a)?a({rtl:d,type:r,defaultClassName:g}):NE(g,a),v={[l&&u>=1?"onTransitionEnd":"onAnimationEnd"]:l&&u<1?null:()=>{h&&s()}};return i.createElement("div",{className:"Toastify__progress-bar--wrp","data-hidden":p},i.createElement("div",{className:"Toastify__progress-bar--bg Toastify__progress-bar-theme--".concat(f," Toastify__progress-bar--").concat(r)}),i.createElement("div",c({role:"progressbar","aria-hidden":p?"true":"false","aria-label":"notification timer",className:y,style:m},v)))}var OE=1,LE=()=>"".concat(OE++);function FE(e,t,n){let i=1,s=0,r=[],o=[],a=t,l=new Map,u=new Set,d=()=>{o=Array.from(l.values()),u.forEach(e=>e())},h=e=>{var t,n;null==(n=null==(t=e.props)?void 0:t.onClose)||n.call(t,e.removalReason),e.isActive=!1},f=e=>{if(null==e)l.forEach(h);else{let t=l.get(e);t&&h(t)}d()},p=e=>{var t,i;let{toastId:s,updateId:r}=e.props,o=null==r;e.staleId&&l.delete(e.staleId),e.isActive=!0,l.set(s,e),d(),n(DE(e,o?"added":"updated")),o&&(null==(i=(t=e.props).onOpen)||i.call(t))};return{id:e,props:a,observe:e=>(u.add(e),()=>u.delete(e)),toggle:(e,t)=>{l.forEach(n=>{var i;(null==t||t===n.props.toastId)&&(null==(i=n.toggle)||i.call(n,e))})},removeToast:f,toasts:l,clearQueue:()=>{s-=r.length,r=[]},buildToast:(t,o)=>{if((t=>{let{containerId:n,toastId:i,updateId:s}=t,r=n?n!==e:1!==e,o=l.has(i)&&null==s;return r||o})(o))return;let{toastId:u,updateId:h,data:m,staleId:g,delay:y}=o,v=null==h;v&&s++;let b=c(c(c({},a),{},{style:a.toastStyle,key:i++},Object.fromEntries(Object.entries(o).filter(e=>{let[t,n]=e;return null!=n}))),{},{toastId:u,updateId:h,data:m,isIn:!1,className:IE(o.className||a.toastClassName),progressClassName:IE(o.progressClassName||a.progressClassName),autoClose:!o.isLoading&&PE(o.autoClose,a.autoClose),closeToast(e){l.get(u).removalReason=e,f(u)},deleteToast(){let e=l.get(u);if(null!=e){if(n(DE(e,"removed")),l.delete(u),s--,s<0&&(s=0),r.length>0)return void p(r.shift());d()}}});b.closeButton=a.closeButton,!1===o.closeButton||jE(o.closeButton)?b.closeButton=o.closeButton:!0===o.closeButton&&(b.closeButton=!jE(a.closeButton)||a.closeButton);let x={content:t,props:b,staleId:g};a.limit&&a.limit>0&&s>a.limit&&v?r.push(x):EE(y)?setTimeout(()=>{p(x)},y):p(x)},setProps(e){a=e},setToggle:(e,t)=>{let n=l.get(e);n&&(n.toggle=t)},isToastActive:e=>{var t;return null==(t=l.get(e))?void 0:t.isActive},getSnapshot:()=>o}}var zE=new Map,UE=[],VE=new Set,BE=e=>VE.forEach(t=>t(e)),HE=()=>zE.size>0;function qE(e,t){var n;if(t)return!(null==(n=zE.get(t))||!n.isToastActive(e));let i=!1;return zE.forEach(t=>{t.isToastActive(e)&&(i=!0)}),i}function WE(e){if(HE()){if(null==e||(e=>TE(e)||EE(e))(e))zE.forEach(t=>{t.removeToast(e)});else if(e&&("containerId"in e||"id"in e)){let t=zE.get(e.containerId);t?t.removeToast(e.id):zE.forEach(t=>{t.removeToast(e.id)})}}else UE=UE.filter(t=>null!=e&&t.options.toastId!==e)}function GE(e,t){jE(e)&&(HE()||UE.push({content:e,options:t}),zE.forEach(n=>{n.buildToast(e,t)}))}function KE(e,t){zE.forEach(n=>{(null==t||null==t||!t.containerId||(null==t?void 0:t.containerId)===n.id)&&n.toggle(e,null==t?void 0:t.id)})}function YE(e){let t=e.containerId||1;return{subscribe(n){let i=FE(t,e,BE);zE.set(t,i);let s=i.observe(n);return UE.forEach(e=>GE(e.content,e.options)),UE=[],()=>{s(),zE.delete(t)}},setProps(e){var n;null==(n=zE.get(t))||n.setProps(e)},getSnapshot(){var e;return null==(e=zE.get(t))?void 0:e.getSnapshot()}}}function QE(e){return e&&(TE(e.toastId)||EE(e.toastId))?e.toastId:LE()}function XE(e,t){return GE(e,t),t.toastId}function $E(e,t){return c(c({},t),{},{type:t&&t.type||e,toastId:QE(t)})}function JE(e){return(t,n)=>XE(t,$E(e,n))}function ZE(e,t){return XE(e,$E("default",t))}function eT(e){let[t,n]=(0,i.useState)(!1),[s,r]=(0,i.useState)(!1),o=(0,i.useRef)(null),a=(0,i.useRef)({start:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,didMove:!1}).current,{autoClose:l,pauseOnHover:c,closeToast:u,onClick:d,closeOnClick:h}=e;function f(){n(!0)}function p(){n(!1)}function m(n){let i=o.current;if(a.canDrag&&i){a.didMove=!0,t&&p(),"x"===e.draggableDirection?a.delta=n.clientX-a.start:a.delta=n.clientY-a.start,a.start!==n.clientX&&(a.canCloseOnClick=!1);let s="x"===e.draggableDirection?"".concat(a.delta,"px, var(--y)"):"0, calc(".concat(a.delta,"px + var(--y))");i.style.transform="translate3d(".concat(s,",0)"),i.style.opacity="".concat(1-Math.abs(a.delta/a.removalDistance))}}function g(){document.removeEventListener("pointermove",m),document.removeEventListener("pointerup",g);let t=o.current;if(a.canDrag&&a.didMove&&t){if(a.canDrag=!1,Math.abs(a.delta)>a.removalDistance)return r(!0),e.closeToast(!0),void e.collapseAll();t.style.transition="transform 0.2s, opacity 0.2s",t.style.removeProperty("transform"),t.style.removeProperty("opacity")}}(function(e){var t;null==(t=zE.get(e.containerId||1))||t.setToggle(e.id,e.fn)})({id:e.toastId,containerId:e.containerId,fn:n}),(0,i.useEffect)(()=>{if(e.pauseOnFocusLoss)return document.hasFocus()||p(),window.addEventListener("focus",f),window.addEventListener("blur",p),()=>{window.removeEventListener("focus",f),window.removeEventListener("blur",p)}},[e.pauseOnFocusLoss]);let y={onPointerDown:function(t){if(!0===e.draggable||e.draggable===t.pointerType){a.didMove=!1,document.addEventListener("pointermove",m),document.addEventListener("pointerup",g);let n=o.current;a.canCloseOnClick=!0,a.canDrag=!0,n.style.transition="none","x"===e.draggableDirection?(a.start=t.clientX,a.removalDistance=n.offsetWidth*(e.draggablePercent/100)):(a.start=t.clientY,a.removalDistance=n.offsetHeight*(80===e.draggablePercent?1.5*e.draggablePercent:e.draggablePercent)/100)}},onPointerUp:function(t){let{top:n,bottom:i,left:s,right:r}=o.current.getBoundingClientRect();"touchend"!==t.nativeEvent.type&&e.pauseOnHover&&t.clientX>=s&&t.clientX<=r&&t.clientY>=n&&t.clientY<=i?p():f()}};return l&&c&&(y.onMouseEnter=p,e.stacked||(y.onMouseLeave=f)),h&&(y.onClick=e=>{d&&d(e),a.canCloseOnClick&&u(!0)}),{playToast:f,pauseToast:p,isRunning:t,preventExitTransition:s,toastRef:o,eventHandlers:y}}ZE.loading=(e,t)=>XE(e,$E("default",c({isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1},t))),ZE.promise=function(e,t,n){let i,{pending:s,error:r,success:o}=t;s&&(i=TE(s)?ZE.loading(s,n):ZE.loading(s.render,c(c({},n),s)));let a={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},l=(e,t,s)=>{if(null==t)return void ZE.dismiss(i);let r=c(c(c({type:e},a),n),{},{data:s}),o=TE(t)?{render:t}:t;return i?ZE.update(i,c(c({},r),o)):ZE(o.render,c(c({},r),o)),s},u=SE(e)?e():e;return u.then(e=>l("success",o,e)).catch(e=>l("error",r,e)),u},ZE.success=JE("success"),ZE.info=JE("info"),ZE.error=JE("error"),ZE.warning=JE("warning"),ZE.warn=ZE.warning,ZE.dark=(e,t)=>XE(e,$E("default",c({theme:"dark"},t))),ZE.dismiss=function(e){WE(e)},ZE.clearWaitingQueue=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};zE.forEach(t=>{t.props.limit&&(!e.containerId||t.id===e.containerId)&&t.clearQueue()})},ZE.isActive=qE,ZE.update=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=((e,t)=>{let{containerId:n}=t;var i;return null==(i=zE.get(n||1))?void 0:i.toasts.get(e)})(e,t);if(n){let{props:i,content:s}=n,r=c(c(c({delay:100},i),t),{},{toastId:t.toastId||e,updateId:LE()});r.toastId!==e&&(r.staleId=e);let o=r.render||s;delete r.render,XE(o,r)}},ZE.done=e=>{ZE.update(e,{progress:1})},ZE.onChange=function(e){return VE.add(e),()=>{VE.delete(e)}},ZE.play=e=>KE(!0,e),ZE.pause=e=>KE(!1,e);var tT="undefined"!=typeof window?i.useLayoutEffect:i.useEffect,nT=e=>{let{theme:t,type:n,isLoading:s}=e,r=cb(e,kE);return i.createElement("svg",c({viewBox:"0 0 24 24",width:"100%",height:"100%",fill:"colored"===t?"currentColor":"var(--toastify-icon-color-".concat(n,")")},r))};var iT={info:function(e){return i.createElement(nT,c({},e),i.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(e){return i.createElement(nT,c({},e),i.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(e){return i.createElement(nT,c({},e),i.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(e){return i.createElement(nT,c({},e),i.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return i.createElement("div",{className:"Toastify__spinner"})}};function sT(e){let{theme:t,type:n,isLoading:s,icon:r}=e,o=null,a={theme:t,type:n};return!1===r||(SE(r)?o=r(c(c({},a),{},{isLoading:s})):(0,i.isValidElement)(r)?o=(0,i.cloneElement)(r,a):s?o=iT.spinner():(e=>e in iT)(n)&&(o=iT[n](a))),o}var rT=e=>{let{isRunning:t,preventExitTransition:n,toastRef:s,eventHandlers:r,playToast:o}=eT(e),{closeButton:a,children:l,autoClose:u,onClick:d,type:h,hideProgressBar:f,closeToast:p,transition:m,position:g,className:y,style:v,progressClassName:b,updateId:x,role:_,progress:w,rtl:C,toastId:N,deleteToast:k,isIn:E,isLoading:T,closeOnClick:S,theme:I,ariaLabel:P}=e,j=NE("Toastify__toast","Toastify__toast-theme--".concat(I),"Toastify__toast--".concat(h),{"Toastify__toast--rtl":C},{"Toastify__toast--close-on-click":S}),A=SE(y)?y({rtl:C,position:g,type:h,defaultClassName:j}):NE(j,y),D=sT(e),R=!!w||!u,M={closeToast:p,type:h,theme:I},O=null;return!1===a||(O=SE(a)?a(M):(0,i.isValidElement)(a)?(0,i.cloneElement)(a,M):function(e){let{closeToast:t,theme:n,ariaLabel:s="close"}=e;return i.createElement("button",{className:"Toastify__close-button Toastify__close-button--".concat(n),type:"button",onClick:e=>{e.stopPropagation(),t(!0)},"aria-label":s},i.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},i.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}(M)),i.createElement(m,{isIn:E,done:k,position:g,preventExitTransition:n,nodeRef:s,playToast:o},i.createElement("div",c(c({id:N,tabIndex:0,onClick:d,"data-in":E,className:A},r),{},{style:v,ref:s},E&&{role:_,"aria-label":P}),null!=D&&i.createElement("div",{className:NE("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!T})},D),RE(l,e,!t),O,!e.customProgressBar&&i.createElement(ME,c(c({},x&&!R?{key:"p-".concat(x)}:{}),{},{rtl:C,theme:I,delay:u,isRunning:t,isIn:E,closeToast:p,hide:f,type:h,className:b,controlledProgress:R,progress:w||0}))))},oT=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{enter:"Toastify--animate Toastify__".concat(e,"-enter"),exit:"Toastify--animate Toastify__".concat(e,"-exit"),appendPosition:t}},aT=AE(oT("bounce",!0)),lT=(AE(oT("slide",!0)),AE(oT("zoom")),AE(oT("flip")),{position:"top-right",transition:aT,autoClose:5e3,closeButton:!0,pauseOnHover:!0,pauseOnFocusLoss:!0,draggable:"touch",draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light","aria-label":"Notifications Alt+T",hotKeys:e=>e.altKey&&"KeyT"===e.code});function cT(e){let t=c(c({},lT),e),n=e.stacked,[s,r]=(0,i.useState)(!0),o=(0,i.useRef)(null),{getToastToRender:a,isToastActive:l,count:u}=function(e){var t;let{subscribe:n,getSnapshot:s,setProps:r}=(0,i.useRef)(YE(e)).current;r(e);let o=null==(t=(0,i.useSyncExternalStore)(n,s,s))?void 0:t.slice();return{getToastToRender:function(t){if(!o)return[];let n=new Map;return e.newestOnTop&&o.reverse(),o.forEach(e=>{let{position:t}=e.props;n.has(t)||n.set(t,[]),n.get(t).push(e)}),Array.from(n,e=>t(e[0],e[1]))},isToastActive:qE,count:null==o?void 0:o.length}}(t),{className:d,style:h,rtl:f,containerId:p,hotKeys:m}=t;function g(e){let t=NE("Toastify__toast-container","Toastify__toast-container--".concat(e),{"Toastify__toast-container--rtl":f});return SE(d)?d({position:e,rtl:f,defaultClassName:t}):NE(t,IE(d))}function y(){n&&(r(!0),ZE.play())}return tT(()=>{var e;if(n){let n=o.current.querySelectorAll('[data-in="true"]'),i=12,r=null==(e=t.position)?void 0:e.includes("top"),a=0,l=0;Array.from(n).reverse().forEach((e,t)=>{let n=e;n.classList.add("Toastify__toast--stacked"),t>0&&(n.dataset.collapsed="".concat(s)),n.dataset.pos||(n.dataset.pos=r?"top":"bot");let o=a*(s?.2:1)+(s?0:i*t);n.style.setProperty("--y","".concat(r?o:-1*o,"px")),n.style.setProperty("--g","".concat(i)),n.style.setProperty("--s","".concat(1-(s?l:0))),a+=n.offsetHeight,l+=.025})}},[s,u,n]),(0,i.useEffect)(()=>{function e(e){var t;let n=o.current;m(e)&&(null==(t=n.querySelector('[tabIndex="0"]'))||t.focus(),r(!1),ZE.pause()),"Escape"===e.key&&(document.activeElement===n||null!=n&&n.contains(document.activeElement))&&(r(!0),ZE.play())}return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[m]),i.createElement("section",{ref:o,className:"Toastify",id:p,onMouseEnter:()=>{n&&(r(!1),ZE.pause())},onMouseLeave:y,"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text","aria-label":t["aria-label"]},a((e,t)=>{let s=t.length?c({},h):c(c({},h),{},{pointerEvents:"none"});return i.createElement("div",{tabIndex:-1,className:g(e),"data-stacked":n,style:s,key:"c-".concat(e)},t.map(e=>{let{content:t,props:s}=e;return i.createElement(rT,c(c({},s),{},{stacked:n,collapseAll:y,isIn:l(s.toastId,s.containerId),key:"t-".concat(s.key)}),t)}))}))}const uT={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,n){return e},captureMetaData:!1},dT=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",hT=new RegExp("^"+("["+dT+"]["+(dT+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040")+"]*")+"$");function fT(e,t){const n=[];let i=t.exec(e);for(;i;){const s=[];s.startIndex=t.lastIndex-i[0].length;const r=i.length;for(let e=0;e<r;e++)s.push(i[e]);n.push(s),i=t.exec(e)}return n}const pT=function(e){const t=hT.exec(e);return!(null===t||"undefined"===typeof t)};let mT;mT="function"!==typeof Symbol?"@@xmlMetadata":Symbol("XML Node Metadata");class gT{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){"__proto__"===e&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e,t){"__proto__"===e.tagname&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child}),void 0!==t&&(this.child[this.child.length-1][mT]={startIndex:t})}static getMetaDataSymbol(){return mT}}function yT(e,t){const n={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let i=1,s=!1,r=!1,o="";for(;t<e.length;t++)if("<"!==e[t]||r)if(">"===e[t]){if(r?"-"===e[t-1]&&"-"===e[t-2]&&(r=!1,i--):i--,0===i)break}else"["===e[t]?s=!0:o+=e[t];else{if(s&&CT(e,"!ENTITY",t)){let i,s;t+=7,[i,s,t]=bT(e,t+1),-1===s.indexOf("&")&&(n[i]={regx:RegExp("&".concat(i,";"),"g"),val:s})}else if(s&&CT(e,"!ELEMENT",t)){t+=8;const{index:n}=wT(e,t+1);t=n}else if(s&&CT(e,"!ATTLIST",t))t+=8;else if(s&&CT(e,"!NOTATION",t)){t+=9;const{index:n}=xT(e,t+1);t=n}else{if(!CT(e,"!--",t))throw new Error("Invalid DOCTYPE");r=!0}i++,o=""}if(0!==i)throw new Error("Unclosed DOCTYPE")}return{entities:n,i:t}}const vT=(e,t)=>{for(;t<e.length&&/\s/.test(e[t]);)t++;return t};function bT(e,t){t=vT(e,t);let n="";for(;t<e.length&&!/\s/.test(e[t])&&'"'!==e[t]&&"'"!==e[t];)n+=e[t],t++;if(NT(n),t=vT(e,t),"SYSTEM"===e.substring(t,t+6).toUpperCase())throw new Error("External entities are not supported");if("%"===e[t])throw new Error("Parameter entities are not supported");let i="";return[t,i]=_T(e,t,"entity"),[n,i,--t]}function xT(e,t){t=vT(e,t);let n="";for(;t<e.length&&!/\s/.test(e[t]);)n+=e[t],t++;NT(n),t=vT(e,t);const i=e.substring(t,t+6).toUpperCase();if("SYSTEM"!==i&&"PUBLIC"!==i)throw new Error('Expected SYSTEM or PUBLIC, found "'.concat(i,'"'));t+=i.length,t=vT(e,t);let s=null,r=null;if("PUBLIC"===i)[t,s]=_T(e,t,"publicIdentifier"),'"'!==e[t=vT(e,t)]&&"'"!==e[t]||([t,r]=_T(e,t,"systemIdentifier"));else if("SYSTEM"===i&&([t,r]=_T(e,t,"systemIdentifier"),!r))throw new Error("Missing mandatory system identifier for SYSTEM notation");return{notationName:n,publicIdentifier:s,systemIdentifier:r,index:--t}}function _T(e,t,n){let i="";const s=e[t];if('"'!==s&&"'"!==s)throw new Error('Expected quoted string, found "'.concat(s,'"'));for(t++;t<e.length&&e[t]!==s;)i+=e[t],t++;if(e[t]!==s)throw new Error("Unterminated ".concat(n," value"));return[++t,i]}function wT(e,t){t=vT(e,t);let n="";for(;t<e.length&&!/\s/.test(e[t]);)n+=e[t],t++;if(!NT(n))throw new Error('Invalid element name: "'.concat(n,'"'));let i="";if("E"===e[t=vT(e,t)]&&CT(e,"MPTY",t))t+=4;else if("A"===e[t]&&CT(e,"NY",t))t+=2;else{if("("!==e[t])throw new Error('Invalid Element Expression, found "'.concat(e[t],'"'));for(t++;t<e.length&&")"!==e[t];)i+=e[t],t++;if(")"!==e[t])throw new Error("Unterminated content model")}return{elementName:n,contentModel:i.trim(),index:t}}function CT(e,t,n){for(let i=0;i<t.length;i++)if(t[i]!==e[n+i+1])return!1;return!0}function NT(e){if(pT(e))return e;throw new Error("Invalid entity name ".concat(e))}const kT=/^[-+]?0x[a-fA-F0-9]+$/,ET=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,TT={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function ST(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t=Object.assign({},TT,t),!e||"string"!==typeof e)return e;let n=e.trim();if(void 0!==t.skipLike&&t.skipLike.test(n))return e;if("0"===e)return 0;if(t.hex&&kT.test(n))return function(e,t){if(parseInt)return parseInt(e,t);if(Number.parseInt)return Number.parseInt(e,t);if(window&&window.parseInt)return window.parseInt(e,t);throw new Error("parseInt, Number.parseInt, window.parseInt are not supported")}(n,16);if(-1!==n.search(/.+[eE].+/))return function(e,t,n){if(!n.eNotation)return e;const i=t.match(IT);if(i){let s=i[1]||"";const r=-1===i[3].indexOf("e")?"E":"e",o=i[2],a=s?e[o.length+1]===r:e[o.length]===r;return o.length>1&&a?e:1!==o.length||!i[3].startsWith(".".concat(r))&&i[3][0]!==r?n.leadingZeros&&!a?(t=(i[1]||"")+i[3],Number(t)):e:Number(t)}return e}(e,n,t);{const i=ET.exec(n);if(i){const s=i[1]||"",r=i[2];let o=function(e){if(e&&-1!==e.indexOf("."))return"."===(e=e.replace(/0+$/,""))?e="0":"."===e[0]?e="0"+e:"."===e[e.length-1]&&(e=e.substring(0,e.length-1)),e;return e}(i[3]);const a=s?"."===e[r.length+1]:"."===e[r.length];if(!t.leadingZeros&&(r.length>1||1===r.length&&!a))return e;{const i=Number(n),a=String(i);if(0===i)return i;if(-1!==a.search(/[eE]/))return t.eNotation?i:e;if(-1!==n.indexOf("."))return"0"===a||a===o||a==="".concat(s).concat(o)?i:e;let l=r?o:n;return r?l===a||s+l===a?i:e:l===a||l===s+a?i:e}}return e}}const IT=/^([-+])?(0*)(\d*(\.\d*)?[eE][-\+]?\d+)$/;class PT{constructor(e){var t;this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xa2"},pound:{regex:/&(pound|#163);/g,val:"\xa3"},yen:{regex:/&(yen|#165);/g,val:"\xa5"},euro:{regex:/&(euro|#8364);/g,val:"\u20ac"},copyright:{regex:/&(copy|#169);/g,val:"\xa9"},reg:{regex:/&(reg|#174);/g,val:"\xae"},inr:{regex:/&(inr|#8377);/g,val:"\u20b9"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,t)=>String.fromCodePoint(Number.parseInt(t,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,t)=>String.fromCodePoint(Number.parseInt(t,16))}},this.addExternalEntities=jT,this.parseXml=OT,this.parseTextData=AT,this.resolveNameSpace=DT,this.buildAttributesMap=MT,this.isItStopNode=UT,this.replaceEntitiesValue=FT,this.readStopNodeData=HT,this.saveTextToParentTag=zT,this.addChild=LT,this.ignoreAttributesFn="function"===typeof(t=this.options.ignoreAttributes)?t:Array.isArray(t)?e=>{for(const n of t){if("string"===typeof n&&e===n)return!0;if(n instanceof RegExp&&n.test(e))return!0}}:()=>!1}}function jT(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const i=t[n];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:e[i]}}}function AT(e,t,n,i,s,r,o){if(void 0!==e&&(this.options.trimValues&&!i&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const i=this.options.tagValueProcessor(t,e,n,s,r);if(null===i||void 0===i)return e;if(typeof i!==typeof e||i!==e)return i;if(this.options.trimValues)return qT(e,this.options.parseTagValue,this.options.numberParseOptions);return e.trim()===e?qT(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function DT(e){if(this.options.removeNSPrefix){const t=e.split(":"),n="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=n+t[1])}return e}const RT=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function MT(e,t,n){if(!0!==this.options.ignoreAttributes&&"string"===typeof e){const n=fT(e,RT),i=n.length,s={};for(let e=0;e<i;e++){const i=this.resolveNameSpace(n[e][1]);if(this.ignoreAttributesFn(i,t))continue;let r=n[e][4],o=this.options.attributeNamePrefix+i;if(i.length)if(this.options.transformAttributeName&&(o=this.options.transformAttributeName(o)),"__proto__"===o&&(o="#__proto__"),void 0!==r){this.options.trimValues&&(r=r.trim()),r=this.replaceEntitiesValue(r);const e=this.options.attributeValueProcessor(i,r,t);s[o]=null===e||void 0===e?r:typeof e!==typeof r||e!==r?e:qT(r,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(s[o]=!0)}if(!Object.keys(s).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=s,e}return s}}const OT=function(e){e=e.replace(/\r\n?/g,"\n");const t=new gT("!xml");let n=t,i="",s="";for(let r=0;r<e.length;r++){if("<"===e[r])if("/"===e[r+1]){const t=VT(e,">",r,"Closing Tag is not closed.");let o=e.substring(r+2,t).trim();if(this.options.removeNSPrefix){const e=o.indexOf(":");-1!==e&&(o=o.substr(e+1))}this.options.transformTagName&&(o=this.options.transformTagName(o)),n&&(i=this.saveTextToParentTag(i,n,s));const a=s.substring(s.lastIndexOf(".")+1);if(o&&-1!==this.options.unpairedTags.indexOf(o))throw new Error("Unpaired tag can not be used as closing tag: </".concat(o,">"));let l=0;a&&-1!==this.options.unpairedTags.indexOf(a)?(l=s.lastIndexOf(".",s.lastIndexOf(".")-1),this.tagsNodeStack.pop()):l=s.lastIndexOf("."),s=s.substring(0,l),n=this.tagsNodeStack.pop(),i="",r=t}else if("?"===e[r+1]){let t=BT(e,r,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,n,s),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new gT(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,s,t.tagName)),this.addChild(n,e,s,r)}r=t.closeIndex+1}else if("!--"===e.substr(r+1,3)){const t=VT(e,"--\x3e",r+4,"Comment is not closed.");if(this.options.commentPropName){const o=e.substring(r+4,t-2);i=this.saveTextToParentTag(i,n,s),n.add(this.options.commentPropName,[{[this.options.textNodeName]:o}])}r=t}else if("!D"===e.substr(r+1,2)){const t=yT(e,r);this.docTypeEntities=t.entities,r=t.i}else if("!["===e.substr(r+1,2)){const t=VT(e,"]]>",r,"CDATA is not closed.")-2,o=e.substring(r+9,t);i=this.saveTextToParentTag(i,n,s);let a=this.parseTextData(o,n.tagname,s,!0,!1,!0,!0);void 0==a&&(a=""),this.options.cdataPropName?n.add(this.options.cdataPropName,[{[this.options.textNodeName]:o}]):n.add(this.options.textNodeName,a),r=t+2}else{let o=BT(e,r,this.options.removeNSPrefix),a=o.tagName;const l=o.rawTagName;let c=o.tagExp,u=o.attrExpPresent,d=o.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),n&&i&&"!xml"!==n.tagname&&(i=this.saveTextToParentTag(i,n,s,!1));const h=n;h&&-1!==this.options.unpairedTags.indexOf(h.tagname)&&(n=this.tagsNodeStack.pop(),s=s.substring(0,s.lastIndexOf("."))),a!==t.tagname&&(s+=s?"."+a:a);const f=r;if(this.isItStopNode(this.options.stopNodes,s,a)){let t="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)"/"===a[a.length-1]?(a=a.substr(0,a.length-1),s=s.substr(0,s.length-1),c=a):c=c.substr(0,c.length-1),r=o.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(a))r=o.closeIndex;else{const n=this.readStopNodeData(e,l,d+1);if(!n)throw new Error("Unexpected end of ".concat(l));r=n.i,t=n.tagContent}const i=new gT(a);a!==c&&u&&(i[":@"]=this.buildAttributesMap(c,s,a)),t&&(t=this.parseTextData(t,a,s,!0,u,!0,!0)),s=s.substr(0,s.lastIndexOf(".")),i.add(this.options.textNodeName,t),this.addChild(n,i,s,f)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){"/"===a[a.length-1]?(a=a.substr(0,a.length-1),s=s.substr(0,s.length-1),c=a):c=c.substr(0,c.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));const e=new gT(a);a!==c&&u&&(e[":@"]=this.buildAttributesMap(c,s,a)),this.addChild(n,e,s,f),s=s.substr(0,s.lastIndexOf("."))}else{const e=new gT(a);this.tagsNodeStack.push(n),a!==c&&u&&(e[":@"]=this.buildAttributesMap(c,s,a)),this.addChild(n,e,s,f),n=e}i="",r=d}}else i+=e[r]}return t.child};function LT(e,t,n,i){this.options.captureMetaData||(i=void 0);const s=this.options.updateTag(t.tagname,n,t[":@"]);!1===s||("string"===typeof s?(t.tagname=s,e.addChild(t,i)):e.addChild(t,i))}const FT=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const n=this.docTypeEntities[t];e=e.replace(n.regx,n.val)}for(let t in this.lastEntities){const n=this.lastEntities[t];e=e.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const n=this.htmlEntities[t];e=e.replace(n.regex,n.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function zT(e,t,n,i){return e&&(void 0===i&&(i=0===t.child.length),void 0!==(e=this.parseTextData(e,t.tagname,n,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,i))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function UT(e,t,n){const i="*."+n;for(const s in e){const n=e[s];if(i===n||t===n)return!0}return!1}function VT(e,t,n,i){const s=e.indexOf(t,n);if(-1===s)throw new Error(i);return s+t.length-1}function BT(e,t,n){const i=function(e,t){let n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:">",s="";for(let r=t;r<e.length;r++){let t=e[r];if(n)t===n&&(n="");else if('"'===t||"'"===t)n=t;else if(t===i[0]){if(!i[1])return{data:s,index:r};if(e[r+1]===i[1])return{data:s,index:r}}else"\t"===t&&(t=" ");s+=t}}(e,t+1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:">");if(!i)return;let s=i.data;const r=i.index,o=s.search(/\s/);let a=s,l=!0;-1!==o&&(a=s.substring(0,o),s=s.substring(o+1).trimStart());const c=a;if(n){const e=a.indexOf(":");-1!==e&&(a=a.substr(e+1),l=a!==i.data.substr(e+1))}return{tagName:a,tagExp:s,closeIndex:r,attrExpPresent:l,rawTagName:c}}function HT(e,t,n){const i=n;let s=1;for(;n<e.length;n++)if("<"===e[n])if("/"===e[n+1]){const r=VT(e,">",n,"".concat(t," is not closed"));if(e.substring(n+2,r).trim()===t&&(s--,0===s))return{tagContent:e.substring(i,n),i:r};n=r}else if("?"===e[n+1]){n=VT(e,"?>",n+1,"StopNode is not closed.")}else if("!--"===e.substr(n+1,3)){n=VT(e,"--\x3e",n+3,"StopNode is not closed.")}else if("!["===e.substr(n+1,2)){n=VT(e,"]]>",n,"StopNode is not closed.")-2}else{const i=BT(e,n,">");if(i){(i&&i.tagName)===t&&"/"!==i.tagExp[i.tagExp.length-1]&&s++,n=i.closeIndex}}}function qT(e,t,n){if(t&&"string"===typeof e){const t=e.trim();return"true"===t||"false"!==t&&ST(e,n)}return function(e){return"undefined"!==typeof e}(e)?e:""}const WT=gT.getMetaDataSymbol();function GT(e,t){return KT(e,t)}function KT(e,t,n){let i;const s={};for(let r=0;r<e.length;r++){const o=e[r],a=YT(o);let l="";if(l=void 0===n?a:n+"."+a,a===t.textNodeName)void 0===i?i=o[a]:i+=""+o[a];else{if(void 0===a)continue;if(o[a]){let e=KT(o[a],t,l);const n=XT(e,t);void 0!==o[WT]&&(e[WT]=o[WT]),o[":@"]?QT(e,o[":@"],l,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==s[a]&&s.hasOwnProperty(a)?(Array.isArray(s[a])||(s[a]=[s[a]]),s[a].push(e)):t.isArray(a,l,n)?s[a]=[e]:s[a]=e}}}return"string"===typeof i?i.length>0&&(s[t.textNodeName]=i):void 0!==i&&(s[t.textNodeName]=i),s}function YT(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const e=t[n];if(":@"!==e)return e}}function QT(e,t,n,i){if(t){const s=Object.keys(t),r=s.length;for(let o=0;o<r;o++){const r=s[o];i.isArray(r,n+"."+r,!0,!0)?e[r]=[t[r]]:e[r]=t[r]}}}function XT(e,t){const{textNodeName:n}=t,i=Object.keys(e).length;return 0===i||!(1!==i||!e[n]&&"boolean"!==typeof e[n]&&0!==e[n])}const $T={allowBooleanAttributes:!1,unpairedTags:[]};function JT(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function ZT(e,t){const n=t;for(;t<e.length;t++)if("?"==e[t]||" "==e[t]){const i=e.substr(n,t-n);if(t>5&&"xml"===i)return aS("InvalidXml","XML declaration allowed only at the start of the document.",uS(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}continue}return t}function eS(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let n=1;for(t+=8;t<e.length;t++)if("<"===e[t])n++;else if(">"===e[t]&&(n--,0===n))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}const tS='"',nS="'";function iS(e,t){let n="",i="",s=!1;for(;t<e.length;t++){if(e[t]===tS||e[t]===nS)""===i?i=e[t]:i!==e[t]||(i="");else if(">"===e[t]&&""===i){s=!0;break}n+=e[t]}return""===i&&{value:n,index:t,tagClosed:s}}const sS=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function rS(e,t){const n=fT(e,sS),i={};for(let s=0;s<n.length;s++){if(0===n[s][1].length)return aS("InvalidAttr","Attribute '"+n[s][2]+"' has no space in starting.",dS(n[s]));if(void 0!==n[s][3]&&void 0===n[s][4])return aS("InvalidAttr","Attribute '"+n[s][2]+"' is without value.",dS(n[s]));if(void 0===n[s][3]&&!t.allowBooleanAttributes)return aS("InvalidAttr","boolean attribute '"+n[s][2]+"' is not allowed.",dS(n[s]));const e=n[s][2];if(!lS(e))return aS("InvalidAttr","Attribute '"+e+"' is an invalid name.",dS(n[s]));if(i.hasOwnProperty(e))return aS("InvalidAttr","Attribute '"+e+"' is repeated.",dS(n[s]));i[e]=1}return!0}function oS(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let n=/\d/;for("x"===e[t]&&(t++,n=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(n))break}return-1}(e,++t);let n=0;for(;t<e.length;t++,n++)if(!(e[t].match(/\w/)&&n<20)){if(";"===e[t])break;return-1}return t}function aS(e,t,n){return{err:{code:e,msg:t,line:n.line||n,col:n.col}}}function lS(e){return pT(e)}function cS(e){return pT(e)}function uS(e,t){const n=e.substring(0,t).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function dS(e){return e.startIndex+e[1].length}class hS{constructor(e){this.externalEntities={},this.options=function(e){return Object.assign({},uT,e)}(e)}parse(e,t){if("string"===typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const n=function(e,t){t=Object.assign({},$T,t);const n=[];let i=!1,s=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let r=0;r<e.length;r++)if("<"===e[r]&&"?"===e[r+1]){if(r+=2,r=ZT(e,r),r.err)return r}else{if("<"!==e[r]){if(JT(e[r]))continue;return aS("InvalidChar","char '"+e[r]+"' is not expected.",uS(e,r))}{let o=r;if(r++,"!"===e[r]){r=eS(e,r);continue}{let a=!1;"/"===e[r]&&(a=!0,r++);let l="";for(;r<e.length&&">"!==e[r]&&" "!==e[r]&&"\t"!==e[r]&&"\n"!==e[r]&&"\r"!==e[r];r++)l+=e[r];if(l=l.trim(),"/"===l[l.length-1]&&(l=l.substring(0,l.length-1),r--),!cS(l)){let t;return t=0===l.trim().length?"Invalid space after '<'.":"Tag '"+l+"' is an invalid name.",aS("InvalidTag",t,uS(e,r))}const c=iS(e,r);if(!1===c)return aS("InvalidAttr","Attributes for '"+l+"' have open quote.",uS(e,r));let u=c.value;if(r=c.index,"/"===u[u.length-1]){const n=r-u.length;u=u.substring(0,u.length-1);const s=rS(u,t);if(!0!==s)return aS(s.err.code,s.err.msg,uS(e,n+s.err.line));i=!0}else if(a){if(!c.tagClosed)return aS("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",uS(e,r));if(u.trim().length>0)return aS("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",uS(e,o));if(0===n.length)return aS("InvalidTag","Closing tag '"+l+"' has not been opened.",uS(e,o));{const t=n.pop();if(l!==t.tagName){let n=uS(e,t.tagStartPos);return aS("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+n.line+", col "+n.col+") instead of closing tag '"+l+"'.",uS(e,o))}0==n.length&&(s=!0)}}else{const a=rS(u,t);if(!0!==a)return aS(a.err.code,a.err.msg,uS(e,r-u.length+a.err.line));if(!0===s)return aS("InvalidXml","Multiple possible root nodes found.",uS(e,r));-1!==t.unpairedTags.indexOf(l)||n.push({tagName:l,tagStartPos:o}),i=!0}for(r++;r<e.length;r++)if("<"===e[r]){if("!"===e[r+1]){r++,r=eS(e,r);continue}if("?"!==e[r+1])break;if(r=ZT(e,++r),r.err)return r}else if("&"===e[r]){const t=oS(e,r);if(-1==t)return aS("InvalidChar","char '&' is not expected.",uS(e,r));r=t}else if(!0===s&&!JT(e[r]))return aS("InvalidXml","Extra text at the end",uS(e,r));"<"===e[r]&&r--}}}return i?1==n.length?aS("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",uS(e,n[0].tagStartPos)):!(n.length>0)||aS("InvalidXml","Invalid '"+JSON.stringify(n.map(e=>e.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):aS("InvalidXml","Start tag expected.",1)}(e,t);if(!0!==n)throw Error("".concat(n.err.msg,":").concat(n.err.line,":").concat(n.err.col))}const n=new PT(this.options);n.addExternalEntities(this.externalEntities);const i=n.parseXml(e);return this.options.preserveOrder||void 0===i?i:GT(i,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if("&"===t)throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=t}static getMetaDataSymbol(){return gT.getMetaDataSymbol()}}const fS="@firebase/database",pS="0.14.4";let mS="";class gS{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),B(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:V(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class yS{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return q(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const vS=function(e){try{if("undefined"!==typeof window&&"undefined"!==typeof window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new gS(t)}}catch(t){}return new yS},bS=vS("localStorage"),xS=vS("sessionStorage"),_S=new me("@firebase/database"),wS=function(){let e=1;return function(){return e++}}(),CS=function(e){const t=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);if(s>=55296&&s<=56319){const t=s-55296;i++,f(i<e.length,"Surrogate pair missing trail surrogate."),s=65536+(t<<10)+(e.charCodeAt(i)-56320)}s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):s<65536?(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t}(e),n=new Z;n.update(t);const i=n.digest();return g.encodeByteArray(i)},NS=function(){let e="";for(let t=0;t<arguments.length;t++){const n=t<0||arguments.length<=t?void 0:arguments[t];Array.isArray(n)||n&&"object"===typeof n&&"number"===typeof n.length?e+=NS.apply(null,n):e+="object"===typeof n?B(n):n,e+=" "}return e};let kS=null,ES=!0;const TS=function(e,t){f(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(_S.logLevel=ue.VERBOSE,kS=_S.log.bind(_S),t&&xS.set("logging_enabled",!0)):"function"===typeof e?kS=e:(kS=null,xS.remove("logging_enabled"))},SS=function(){if(!0===ES&&(ES=!1,null===kS&&!0===xS.get("logging_enabled")&&TS(!0)),kS){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=NS.apply(null,t);kS(i)}},IS=function(e){return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];SS(e,...n)}},PS=function(){const e="FIREBASE INTERNAL ERROR: "+NS(...arguments);_S.error(e)},jS=function(){const e="FIREBASE FATAL ERROR: ".concat(NS(...arguments));throw _S.error(e),new Error(e)},AS=function(){const e="FIREBASE WARNING: "+NS(...arguments);_S.warn(e)},DS=function(e){return"number"===typeof e&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},RS="[MIN_NAME]",MS="[MAX_NAME]",OS=function(e,t){if(e===t)return 0;if(e===RS||t===MS)return-1;if(t===RS||e===MS)return 1;{const n=qS(e),i=qS(t);return null!==n?null!==i?n-i===0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},LS=function(e,t){return e===t?0:e<t?-1:1},FS=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+B(t))},zS=function(e){if("object"!==typeof e||null===e)return B(e);const t=[];for(const i in e)t.push(i);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=B(t[i]),n+=":",n+=zS(e[t[i]]);return n+="}",n},US=function(e,t){const n=e.length;if(n<=t)return[e];const i=[];for(let s=0;s<n;s+=t)s+t>n?i.push(e.substring(s,n)):i.push(e.substring(s,s+t));return i};function VS(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const BS=function(e){f(!DS(e),"Invalid JSON number");const t=1023;let n,i,s,r,o;0===e?(i=0,s=0,n=1/e===-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(r=Math.min(Math.floor(Math.log(e)/Math.LN2),t),i=r+t,s=Math.round(e*Math.pow(2,52-r)-Math.pow(2,52))):(i=0,s=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(s%2?1:0),s=Math.floor(s/2);for(o=11;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);a.push(n?1:0),a.reverse();const l=a.join("");let c="";for(o=0;o<64;o+=8){let e=parseInt(l.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()};const HS=new RegExp("^-?(0*)\\d{1,10}$"),qS=function(e){if(HS.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},WS=function(e){try{e()}catch(t){setTimeout(()=>{const e=t.stack||"";throw AS("Exception was thrown by user callback.",e),t},Math.floor(0))}},GS=function(e,t){const n=setTimeout(e,t);return"number"===typeof n&&"undefined"!==typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"===typeof n&&n.unref&&n.unref(),n};class KS{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null===t||void 0===t?void 0:t.getImmediate({optional:!0}),this.appCheck||null===t||void 0===t||t.get().then(e=>this.appCheck=e)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){AS('Provided AppCheck credentials for the app named "'.concat(this.appName_,'" ')+"are invalid. This usually indicates your app was not initialized correctly.")}}class YS{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(SS("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',AS(e)}}class QS{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}QS.OWNER="owner";const XS="5",$S=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,JS="ac",ZS="websocket",eI="long_polling";class tI{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=r,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=bS.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&bS.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns=".concat(this.namespace):"";return"".concat(e).concat(this.host,"/").concat(t)}}function nI(e,t,n){let i;if(f("string"===typeof t,"typeof type must == string"),f("object"===typeof n,"typeof params must == object"),t===ZS)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==eI)throw new Error("Unknown connection type: "+t);i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const s=[];return VS(n,(e,t)=>{s.push(e+"="+t)}),i+s.join("&")}class iI{constructor(){this.counters_={}}incrementCounter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;q(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return _(this.counters_)}}const sI={},rI={};function oI(e){const t=e.toString();return sI[t]||(sI[t]=new iI),sI[t]}class aI{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&WS(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const lI="start";class cI{constructor(e,t,n,i,s,r,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.transportSessionId=r,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=IS(e),this.stats_=oI(t),this.urlFn=e=>(this.appCheckToken&&(e[JS]=this.appCheckToken),nI(t,eI,e))}open(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new aI(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(e){if(O()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new uI(function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const[s,r,o,a,l]=t;if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,s===lI)n.id=r,n.password=o;else{if("close"!==s)throw new Error("Unrecognized command received: "+s);r?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(r,()=>{n.onClosed_()})):n.onClosed_()}},function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const[s,r]=t;n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(s,r)},()=>{this.onClosed_()},this.urlFn);const e={};e[lI]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=XS,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[JS]=this.appCheckToken),"undefined"!==typeof location&&location.hostname&&$S.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){cI.forceAllow_=!0}static forceDisallow(){cI.forceDisallow_=!0}static isAvailable(){return!O()&&(!!cI.forceAllow_||!cI.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!("object"===typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"===typeof Windows&&"object"===typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=B(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=v(t),i=US(n,1840);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(O())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=B(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class uI{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,O())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=wS(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=uI.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){n='<script>document.domain="'+document.domain+'";<\/script>'}const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(s){SS("frame writing exception"),s.stack&&SS(s.stack),SS(s)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||SS("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(i),n()})}addTag(e,t){O()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{SS("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(n){}},Math.floor(1))}}let dI=null;"undefined"!==typeof MozWebSocket?dI=MozWebSocket:"undefined"!==typeof WebSocket&&(dI=WebSocket);class hI{constructor(e,t,n,i,s,r,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=IS(this.connId),this.stats_=oI(t),this.connURL=hI.connectionURL_(t,r,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,s){const r={};return r.v=XS,!O()&&"undefined"!==typeof location&&location.hostname&&$S.test(location.hostname)&&(r.r="f"),t&&(r.s=t),n&&(r.ls=n),i&&(r[JS]=i),s&&(r.p=s),nI(e,ZS,r)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,bS.set("previous_websocket_failure",!0);try{let e;if(O()){const t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":"Firebase/".concat(XS,"/").concat(mS,"/").concat(process.platform,"/").concat(t),"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization="Bearer ".concat(this.authToken)),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);const n={NODE_ENV:"production",PUBLIC_URL:"/portal",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0},i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new dI(this.connURL,[],e)}catch(n){this.log_("Error instantiating WebSocket.");const e=n.message||n.data;return e&&this.log_(e),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){hI.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!==typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==dI&&!hI.forceDisallow_}static previouslyFailed(){return bS.isInMemoryStorage||!0===bS.get("previous_websocket_failure")}markConnectionHealthy(){bS.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=V(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(f(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=B(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=US(t,16384);n.length>1&&this.sendString_(String(n.length));for(let i=0;i<n.length;i++)this.sendString_(n[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}hI.responsesRequiredToBeHealthy=2,hI.healthyTimeout=3e4;class fI{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[cI,hI]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=hI&&hI.isAvailable();let n=t&&!hI.previouslyFailed();if(e.webSocketOnly&&(t||AS("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[hI];else{const e=this.transports_=[];for(const t of fI.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);fI.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}fI.globalTransportInitialized_=!1;class pI{constructor(e,t,n,i,s,r,o,a,l,c){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=r,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=c,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=IS("c:"+this.id+":"),this.transportManager_=new fI(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=GS(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=FS("t",e),n=FS("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=FS("t",e),n=FS("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=FS("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?PS("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):PS("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),XS!==n&&AS("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),GS(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):GS(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(bS.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class mI{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class gI{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];for(let e=0;e<s.length;e++)s[e].callback.apply(s[e].context,n)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!n||n===i[s].context))return void i.splice(s,1)}validateEventType_(e){f(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class yI extends gI{constructor(){super(["online"]),this.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||D()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new yI}getInitialEvent(e){return f("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class vI{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function bI(){return new vI("")}function xI(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function _I(e){return e.pieces_.length-e.pieceNum_}function wI(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new vI(e.pieces_,t)}function CI(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function NI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.pieces_.slice(e.pieceNum_+t)}function kI(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new vI(t,0)}function EI(e,t){const n=[];for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);if(t instanceof vI)for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new vI(n,0)}function TI(e){return e.pieceNum_>=e.pieces_.length}function SI(e,t){const n=xI(e),i=xI(t);if(null===n)return t;if(n===i)return SI(wI(e),wI(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function II(e,t){const n=NI(e,0),i=NI(t,0);for(let s=0;s<n.length&&s<i.length;s++){const e=OS(n[s],i[s]);if(0!==e)return e}return n.length===i.length?0:n.length<i.length?-1:1}function PI(e,t){if(_I(e)!==_I(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function jI(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(_I(e)>_I(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class AI{constructor(e,t){this.errorPrefix_=t,this.parts_=NI(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=ie(this.parts_[n]);DI(this)}}function DI(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+RI(e))}function RI(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class MI extends gI{constructor(){let e,t;super(["visible"]),"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document.hidden?(t="visibilitychange",e="hidden"):"undefined"!==typeof document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):"undefined"!==typeof document.msHidden?(t="msvisibilitychange",e="msHidden"):"undefined"!==typeof document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}static getInstance(){return new MI}getInitialEvent(e){return f("visible"===e,"Unknown event type: "+e),[this.visible_]}}const OI=1e3;class LI extends mI{constructor(e,t,n,i,s,r,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=r,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=LI.nextPersistentConnectionId_++,this.log_=IS("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=OI,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!O())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");MI.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&yI.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const i=++this.requestNumber_,s={r:i,a:e,b:t};this.log_(B(s)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();const t=new P,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();const s=e._queryIdentifier,r=e._path.toString();this.log_("Listen called for "+r+" "+s),this.listens.has(r)||this.listens.set(r,new Map),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(r).has(s),"listen() called twice for same path/queryId.");const o={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(r).set(s,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const s={p:n};e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest("q",s,s=>{const r=s.d,o=s.s;LI.warnOnListenWarnings_(r,t);(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",s),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,r))})}static warnOnListenWarnings_(e,t){if(e&&"object"===typeof e&&q(e,"w")){const n=W(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();AS("Using an unspecified index. Your data will be downloaded and "+"filtered on the client. Consider adding ".concat(e," at ")+"".concat(n," to your security rules for better performance."))}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=H(e).claims;return"object"===typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=H(e).claims;return!!t&&"object"===typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"===typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{const n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){const n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const s={p:e};i&&(s.q=n,s.t=i),this.sendRequest("n",s)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const s={p:t,d:n};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,e=>{i&&setTimeout(()=>{i(e.s,e.d)},Math.floor(0))})}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,s){this.initConnection_();const r={p:t,d:n};void 0!==s&&(r.h=s),this.outstandingPuts_.push({action:e,request:r,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+B(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):PS("Unrecognized action received from server: "+B(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=OI,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=OI,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=OI),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+LI.nextConnectionId_++,s=this.lastSessionId;let r=!1,o=null;const a=function(){o?o.close():(r=!0,n())},l=function(e){f(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)};this.realtime_={close:a,sendRequest:l};const c=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,l]=await Promise.all([this.authTokenProvider_.getToken(c),this.appCheckTokenProvider_.getToken(c)]);r?SS("getToken() completed but was canceled"):(SS("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=l&&l.token,o=new pI(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{AS(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(PS){this.log_("Failed to get token: "+PS),r||(this.repoInfo_.nodeAdmin&&AS(PS),a())}}}interrupt(e){SS("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){SS("Resuming connection for reason: "+e),delete this.interruptReasons_[e],G(this.interruptReasons_)&&(this.reconnectDelay_=OI,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>zS(e)).join("$"):"default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new vI(e).toString();let i;if(this.listens.has(n)){const e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){SS("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){SS("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";O()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+mS.replace(/\./g,"-")]=1,D()?e["framework.cordova"]=1:M()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=yI.getInstance().currentlyOnline();return G(this.interruptReasons_)&&e}}LI.nextPersistentConnectionId_=0,LI.nextConnectionId_=0;class FI{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new FI(e,t)}}class zI{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new FI(RS,e),i=new FI(RS,t);return 0!==this.compare(n,i)}minPost(){return FI.MIN}}let UI;class VI extends zI{static get __EMPTY_NODE(){return UI}static set __EMPTY_NODE(e){UI=e}compare(e,t){return OS(e.name,t.name)}isDefinedOn(e){throw p("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return FI.MIN}maxPost(){return new FI(MS,UI)}makePost(e,t){return f("string"===typeof e,"KeyIndex indexValue must always be a string."),new FI(e,UI)}toString(){return".key"}}const BI=new VI;class HI{constructor(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,i&&(r*=-1),r<0)e=this.isReverse_?e.left:e.right;else{if(0===r){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class qI{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:qI.RED,this.left=null!=i?i:WI.EMPTY_NODE,this.right=null!=s?s:WI.EMPTY_NODE}copy(e,t,n,i,s){return new qI(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return WI.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return WI.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,qI.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,qI.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}qI.RED=!0,qI.BLACK=!1;class WI{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:WI.EMPTY_NODE;this.comparator_=e,this.root_=t}insert(e,t){return new WI(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,qI.BLACK,null,null))}remove(e){return new WI(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,qI.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new HI(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new HI(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new HI(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new HI(this.root_,null,this.comparator_,!0,e)}}function GI(e,t){return OS(e.name,t.name)}function KI(e,t){return OS(e,t)}let YI;WI.EMPTY_NODE=new class{copy(e,t,n,i,s){return this}insert(e,t,n){return new qI(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const QI=function(e){return"number"===typeof e?"number:"+BS(e):"string:"+e},XI=function(e){if(e.isLeafNode()){const t=e.val();f("string"===typeof t||"number"===typeof t||"object"===typeof t&&q(t,".sv"),"Priority must be a string or number.")}else f(e===YI||e.isEmpty(),"priority of unexpected type.");f(e===YI||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let $I,JI,ZI;class eP{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eP.__childrenNodeConstructor.EMPTY_NODE;this.value_=e,this.priorityNode_=t,this.lazyHash_=null,f(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),XI(this.priorityNode_)}static set __childrenNodeConstructor(e){$I=e}static get __childrenNodeConstructor(){return $I}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new eP(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:eP.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return TI(e)?this:".priority"===xI(e)?this.priorityNode_:eP.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:eP.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=xI(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(f(".priority"!==n||1===_I(e),".priority must be the last token in a path"),this.updateImmediateChild(n,eP.__childrenNodeConstructor.EMPTY_NODE.updateChild(wI(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+QI(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?BS(this.value_):this.value_,this.lazyHash_=CS(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===eP.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof eP.__childrenNodeConstructor?-1:(f(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,i=eP.VALUE_TYPE_ORDER.indexOf(t),s=eP.VALUE_TYPE_ORDER.indexOf(n);return f(i>=0,"Unknown leaf type: "+t),f(s>=0,"Unknown leaf type: "+n),i===s?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}eP.VALUE_TYPE_ORDER=["object","boolean","number","string"];const tP=new class extends zI{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),s=n.compareTo(i);return 0===s?OS(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return FI.MIN}maxPost(){return new FI(MS,new eP("[PRIORITY-POST]",ZI))}makePost(e,t){const n=JI(e);return new FI(t,new eP("[PRIORITY-POST]",n))}toString(){return".priority"}},nP=Math.log(2);class iP{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/nP,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const sP=function(e,t,n,i){e.sort(t);const s=function(t,i){const r=i-t;let o,a;if(0===r)return null;if(1===r)return o=e[t],a=n?n(o):o,new qI(a,o.node,qI.BLACK,null,null);{const l=parseInt(r/2,10)+t,c=s(t,l),u=s(l+1,i);return o=e[l],a=n?n(o):o,new qI(a,o.node,qI.BLACK,c,u)}},r=function(t){let i=null,r=null,o=e.length;const a=function(t,i){const r=o-t,a=o;o-=t;const c=s(r+1,a),u=e[r],d=n?n(u):u;l(new qI(d,u.node,i,null,c))},l=function(e){i?(i.left=e,i=e):(r=e,i=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,qI.BLACK):(a(i,qI.BLACK),a(i,qI.RED))}return r}(new iP(e.length));return new WI(i||t,r)};let rP;const oP={};class aP{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return f(oP&&tP,"ChildrenNode.ts has not been loaded"),rP=rP||new aP({".priority":oP},{".priority":tP}),rP}get(e){const t=W(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof WI?t:null}hasIndex(e){return q(this.indexSet_,e.toString())}addIndex(e,t){f(e!==BI,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let i=!1;const s=t.getIterator(FI.Wrap);let r,o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),n.push(o),o=s.getNext();r=i?sP(n,e.getCompare()):oP;const a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;const c=Object.assign({},this.indexes_);return c[a]=r,new aP(c,l)}addToIndexes(e,t){const n=K(this.indexes_,(n,i)=>{const s=W(this.indexSet_,i);if(f(s,"Missing index implementation for "+i),n===oP){if(s.isDefinedOn(e.node)){const n=[],i=t.getIterator(FI.Wrap);let r=i.getNext();for(;r;)r.name!==e.name&&n.push(r),r=i.getNext();return n.push(e),sP(n,s.getCompare())}return oP}{const i=t.get(e.name);let s=n;return i&&(s=s.remove(new FI(e.name,i))),s.insert(e,e.node)}});return new aP(n,this.indexSet_)}removeFromIndexes(e,t){const n=K(this.indexes_,n=>{if(n===oP)return n;{const i=t.get(e.name);return i?n.remove(new FI(e.name,i)):n}});return new aP(n,this.indexSet_)}}let lP;class cP{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&XI(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return lP||(lP=new cP(new WI(KI),null,aP.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||lP}updatePriority(e){return this.children_.isEmpty()?this:new cP(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?lP:t}}getChild(e){const t=xI(e);return null===t?this:this.getImmediateChild(t).getChild(wI(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(f(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new FI(e,t);let i,s;t.isEmpty()?(i=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,t),s=this.indexMap_.addToIndexes(n,this.children_));const r=i.isEmpty()?lP:this.priorityNode_;return new cP(i,r,s)}}updateChild(e,t){const n=xI(e);if(null===n)return t;{f(".priority"!==xI(e)||1===_I(e),".priority must be the last token in a path");const i=this.getImmediateChild(n).updateChild(wI(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,s=!0;if(this.forEachChild(tP,(r,o)=>{t[r]=o.val(e),n++,s&&cP.INTEGER_REGEXP_.test(r)?i=Math.max(i,Number(r)):s=!1}),!e&&s&&i<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+QI(this.getPriority().val())+":"),this.forEachChild(tP,(t,n)=>{const i=n.hash();""!==i&&(e+=":"+t+":"+i)}),this.lazyHash_=""===e?"":CS(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new FI(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new FI(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new FI(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{const n=this.children_.getIteratorFrom(e.name,FI.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{const n=this.children_.getReverseIteratorFrom(e.name,FI.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===uP?-1:0}withIndex(e){if(e===BI||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new cP(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===BI||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(tP),n=t.getIterator(tP);let i=e.getNext(),s=n.getNext();for(;i&&s;){if(i.name!==s.name||!i.node.equals(s.node))return!1;i=e.getNext(),s=n.getNext()}return null===i&&null===s}return!1}return!1}}resolveIndex_(e){return e===BI?null:this.indexMap_.get(e.toString())}}cP.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const uP=new class extends cP{constructor(){super(new WI(KI),cP.EMPTY_NODE,aP.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return cP.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(FI,{MIN:{value:new FI(RS,cP.EMPTY_NODE)},MAX:{value:new FI(MS,uP)}}),VI.__EMPTY_NODE=cP.EMPTY_NODE,eP.__childrenNodeConstructor=cP,YI=uP,function(e){ZI=e}(uP);function dP(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===e)return cP.EMPTY_NODE;if("object"===typeof e&&".priority"in e&&(t=e[".priority"]),f(null===t||"string"===typeof t||"number"===typeof t||"object"===typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"===typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!==typeof e||".sv"in e){return new eP(e,dP(t))}if(e instanceof Array){let n=cP.EMPTY_NODE;return VS(e,(t,i)=>{if(q(e,t)&&"."!==t.substring(0,1)){const e=dP(i);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}}),n.updatePriority(dP(t))}{const n=[];let i=!1;if(VS(e,(e,t)=>{if("."!==e.substring(0,1)){const s=dP(t);s.isEmpty()||(i=i||!s.getPriority().isEmpty(),n.push(new FI(e,s)))}}),0===n.length)return cP.EMPTY_NODE;const s=sP(n,GI,e=>e.name,KI);if(i){const e=sP(n,tP.getCompare());return new cP(s,dP(t),new aP({".priority":e},{".priority":tP}))}return new cP(s,dP(t),aP.Default)}}!function(e){JI=e}(dP);class hP extends zI{constructor(e){super(),this.indexPath_=e,f(!TI(e)&&".priority"!==xI(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),s=n.compareTo(i);return 0===s?OS(e.name,t.name):s}makePost(e,t){const n=dP(e),i=cP.EMPTY_NODE.updateChild(this.indexPath_,n);return new FI(t,i)}maxPost(){const e=cP.EMPTY_NODE.updateChild(this.indexPath_,uP);return new FI(MS,e)}toString(){return NI(this.indexPath_,0).join("/")}}const fP=new class extends zI{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?OS(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return FI.MIN}maxPost(){return FI.MAX}makePost(e,t){const n=dP(e);return new FI(t,n)}toString(){return".value"}};function pP(e){return{type:"value",snapshotNode:e}}function mP(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function gP(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function yP(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class vP{constructor(e){this.index_=e}updateChild(e,t,n,i,s,r){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(i).equals(n.getChild(i))&&o.isEmpty()===n.isEmpty()?e:(null!=r&&(n.isEmpty()?e.hasChild(t)?r.trackChildChange(gP(t,o)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?r.trackChildChange(mP(t,n)):r.trackChildChange(yP(t,n,o))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(tP,(e,i)=>{t.hasChild(e)||n.trackChildChange(gP(e,i))}),t.isLeafNode()||t.forEachChild(tP,(t,i)=>{if(e.hasChild(t)){const s=e.getImmediateChild(t);s.equals(i)||n.trackChildChange(yP(t,i,s))}else n.trackChildChange(mP(t,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?cP.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class bP{constructor(e){this.indexedFilter_=new vP(e.getIndex()),this.index_=e.getIndex(),this.startPost_=bP.getStartPost_(e),this.endPost_=bP.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,i,s,r){return this.matches(new FI(t,n))||(n=cP.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,s,r)}updateFullNode(e,t,n){t.isLeafNode()&&(t=cP.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(cP.EMPTY_NODE);const s=this;return t.forEachChild(tP,(e,t)=>{s.matches(new FI(e,t))||(i=i.updateImmediateChild(e,cP.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class xP{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new bP(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,s,r){return this.rangedFilter_.matches(new FI(t,n))||(n=cP.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,s,r):this.fullLimitUpdateChild_(e,t,n,s,r)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=cP.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=cP.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;i=i.updateImmediateChild(t.name,t.node),n++}}}else{let e;i=t.withIndex(this.index_),i=i.updatePriority(cP.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,cP.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,s){let r;if(this.reverse_){const e=this.index_.getCompare();r=(t,n)=>e(n,t)}else r=this.index_.getCompare();const o=e;f(o.numChildren()===this.limit_,"");const a=new FI(t,n),l=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),c=this.rangedFilter_.matches(a);if(o.hasChild(t)){const e=o.getImmediateChild(t);let u=i.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=u&&(u.name===t||o.hasChild(u.name));)u=i.getChildAfterChild(this.index_,u,this.reverse_);const d=null==u?1:r(u,a);if(c&&!n.isEmpty()&&d>=0)return null!=s&&s.trackChildChange(yP(t,n,e)),o.updateImmediateChild(t,n);{null!=s&&s.trackChildChange(gP(t,e));const n=o.updateImmediateChild(t,cP.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=s&&s.trackChildChange(mP(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:c&&r(l,a)>=0?(null!=s&&(s.trackChildChange(gP(l.name,l.node)),s.trackChildChange(mP(t,n))),o.updateImmediateChild(t,n).updateImmediateChild(l.name,cP.EMPTY_NODE)):e}}class _P{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=tP}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:RS}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:MS}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===tP}copy(){const e=new _P;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function wP(e){const t={};if(e.isDefault())return t;let n;if(e.index_===tP?n="$priority":e.index_===fP?n="$value":e.index_===BI?n="$key":(f(e.index_ instanceof hP,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=B(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=B(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+B(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=B(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+B(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function CP(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==tP&&(t.i=e.index_.toString()),t}class NP extends mI{constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=IS("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const r=NP.getListenId_(e,n),o={};this.listens_[r]=o;const a=wP(e._queryParams);this.restRequest_(s+".json",a,(e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(s,a,!1,n),W(this.listens_,r)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(t,null)}})}unlisten(e,t){const n=NP.getListenId_(e,t);delete this.listens_[n]}get(e){const t=wP(e._queryParams),n=e._path.toString(),i=new P;return this.restRequest_(n+".json",t,(e,t)=>{let s=t;404===e&&(s=null,e=null),null===e?(this.onDataUpdate_(n,s,!1,null),i.resolve(s)):i.reject(new Error(s))}),i.promise}refreshAuthToken(e){}restRequest_(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(i=>{let[s,r]=i;s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+X(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&4===a.readyState){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let t=null;if(a.status>=200&&a.status<300){try{t=V(a.responseText)}catch(e){AS("Failed to parse JSON response for "+o+": "+a.responseText)}n(null,t)}else 401!==a.status&&404!==a.status&&AS("Got unsuccessful REST response for "+o+" Status: "+a.status),n(a.status);n=null}},a.open("GET",o,!0),a.send()})}}class kP{constructor(){this.rootNode_=cP.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function EP(){return{value:null,children:new Map}}function TP(e,t,n){if(TI(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const i=xI(t);e.children.has(i)||e.children.set(i,EP());TP(e.children.get(i),t=wI(t),n)}}function SP(e,t){if(TI(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;{const n=e.value;return e.value=null,n.forEachChild(tP,(t,n)=>{TP(e,new vI(t),n)}),SP(e,t)}}if(e.children.size>0){const n=xI(t);if(t=wI(t),e.children.has(n)){SP(e.children.get(n),t)&&e.children.delete(n)}return 0===e.children.size}return!0}function IP(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((e,n)=>{t(n,e)})}(e,(e,i)=>{IP(i,new vI(t.toString()+"/"+e),n)})}class PP{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&VS(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class jP{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new PP(e);const n=1e4+2e4*Math.random();GS(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;VS(e,(e,i)=>{i>0&&q(this.statsToReport_,e)&&(t[e]=i,n=!0)}),n&&this.server_.reportStats(t),GS(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var AP;function DP(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(AP||(AP={}));class RP{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=AP.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(TI(this.path)){if(null!=this.affectedTree.value)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new vI(e));return new RP(bI(),t,this.revert)}}return f(xI(this.path)===e,"operationForChild called for unrelated child."),new RP(wI(this.path),this.affectedTree,this.revert)}}class MP{constructor(e,t){this.source=e,this.path=t,this.type=AP.LISTEN_COMPLETE}operationForChild(e){return TI(this.path)?new MP(this.source,bI()):new MP(this.source,wI(this.path))}}class OP{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=AP.OVERWRITE}operationForChild(e){return TI(this.path)?new OP(this.source,bI(),this.snap.getImmediateChild(e)):new OP(this.source,wI(this.path),this.snap)}}class LP{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=AP.MERGE}operationForChild(e){if(TI(this.path)){const t=this.children.subtree(new vI(e));return t.isEmpty()?null:t.value?new OP(this.source,bI(),t.value):new LP(this.source,bI(),t)}return f(xI(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new LP(this.source,wI(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class FP{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(TI(e))return this.isFullyInitialized()&&!this.filtered_;const t=xI(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class zP{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function UP(e,t,n,i,s,r){const o=i.filter(e=>e.type===n);o.sort((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw p("Should only compare child_ events.");const i=new FI(t.childName,t.snapshotNode),s=new FI(n.childName,n.snapshotNode);return e.index_.compare(i,s)}(e,t,n)),o.forEach(n=>{const i=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,r);s.forEach(s=>{s.respondsTo(n.type)&&t.push(s.createEvent(i,e.query_))})})}function VP(e,t){return{eventCache:e,serverCache:t}}function BP(e,t,n,i){return VP(new FP(t,n,i),e.serverCache)}function HP(e,t,n,i){return VP(e.eventCache,new FP(t,n,i))}function qP(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function WP(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let GP;class KP{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(GP||(GP=new WI(LS)),GP);this.value=e,this.children=t}static fromObject(e){let t=new KP(null);return VS(e,(e,n)=>{t=t.set(new vI(e),n)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:bI(),value:this.value};if(TI(e))return null;{const n=xI(e),i=this.children.get(n);if(null!==i){const s=i.findRootMostMatchingPathAndValue(wI(e),t);if(null!=s){return{path:EI(new vI(n),s.path),value:s.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(TI(e))return this;{const t=xI(e),n=this.children.get(t);return null!==n?n.subtree(wI(e)):new KP(null)}}set(e,t){if(TI(e))return new KP(t,this.children);{const n=xI(e),i=(this.children.get(n)||new KP(null)).set(wI(e),t),s=this.children.insert(n,i);return new KP(this.value,s)}}remove(e){if(TI(e))return this.children.isEmpty()?new KP(null):new KP(null,this.children);{const t=xI(e),n=this.children.get(t);if(n){const i=n.remove(wI(e));let s;return s=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&s.isEmpty()?new KP(null):new KP(this.value,s)}return this}}get(e){if(TI(e))return this.value;{const t=xI(e),n=this.children.get(t);return n?n.get(wI(e)):null}}setTree(e,t){if(TI(e))return t;{const n=xI(e),i=(this.children.get(n)||new KP(null)).setTree(wI(e),t);let s;return s=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new KP(this.value,s)}}fold(e){return this.fold_(bI(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((i,s)=>{n[i]=s.fold_(EI(e,i),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,bI(),t)}findOnPath_(e,t,n){const i=!!this.value&&n(t,this.value);if(i)return i;if(TI(e))return null;{const i=xI(e),s=this.children.get(i);return s?s.findOnPath_(wI(e),EI(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,bI(),t)}foreachOnPath_(e,t,n){if(TI(e))return this;{this.value&&n(t,this.value);const i=xI(e),s=this.children.get(i);return s?s.foreachOnPath_(wI(e),EI(t,i),n):new KP(null)}}foreach(e){this.foreach_(bI(),e)}foreach_(e,t){this.children.inorderTraversal((n,i)=>{i.foreach_(EI(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class YP{constructor(e){this.writeTree_=e}static empty(){return new YP(new KP(null))}}function QP(e,t,n){if(TI(t))return new YP(new KP(n));{const i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){const s=i.path;let r=i.value;const o=SI(s,t);return r=r.updateChild(o,n),new YP(e.writeTree_.set(s,r))}{const i=new KP(n),s=e.writeTree_.setTree(t,i);return new YP(s)}}}function XP(e,t,n){let i=e;return VS(n,(e,n)=>{i=QP(i,EI(t,e),n)}),i}function $P(e,t){if(TI(t))return YP.empty();{const n=e.writeTree_.setTree(t,new KP(null));return new YP(n)}}function JP(e,t){return null!=ZP(e,t)}function ZP(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(SI(n.path,t)):null}function ej(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(tP,(e,n)=>{t.push(new FI(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new FI(e,n.value))}),t}function tj(e,t){if(TI(t))return e;{const n=ZP(e,t);return new YP(null!=n?new KP(n):e.writeTree_.subtree(t))}}function nj(e){return e.writeTree_.isEmpty()}function ij(e,t){return sj(bI(),e.writeTree_,t)}function sj(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let i=null;return t.children.inorderTraversal((t,s)=>{".priority"===t?(f(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):n=sj(EI(e,t),s,n)}),n.getChild(e).isEmpty()||null===i||(n=n.updateChild(EI(e,".priority"),i)),n}}function rj(e,t){return vj(t,e)}function oj(e,t){const n=e.allWrites.findIndex(e=>e.writeId===t);f(n>=0,"removeWrite called with nonexistent writeId.");const i=e.allWrites[n];e.allWrites.splice(n,1);let s=i.visible,r=!1,o=e.allWrites.length-1;for(;s&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=n&&aj(t,i.path)?s=!1:jI(i.path,t.path)&&(r=!0)),o--}if(s){if(r)return function(e){e.visibleWrites=cj(e.allWrites,lj,bI()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(i.snap)e.visibleWrites=$P(e.visibleWrites,i.path);else{VS(i.children,t=>{e.visibleWrites=$P(e.visibleWrites,EI(i.path,t))})}return!0}return!1}function aj(e,t){if(e.snap)return jI(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&jI(EI(e.path,n),t))return!0;return!1}function lj(e){return e.visible}function cj(e,t,n){let i=YP.empty();for(let s=0;s<e.length;++s){const r=e[s];if(t(r)){const e=r.path;let t;if(r.snap)jI(n,e)?(t=SI(n,e),i=QP(i,t,r.snap)):jI(e,n)&&(t=SI(e,n),i=QP(i,bI(),r.snap.getChild(t)));else{if(!r.children)throw p("WriteRecord should have .snap or .children");if(jI(n,e))t=SI(n,e),i=XP(i,t,r.children);else if(jI(e,n))if(t=SI(e,n),TI(t))i=XP(i,bI(),r.children);else{const e=W(r.children,xI(t));if(e){const n=e.getChild(wI(t));i=QP(i,bI(),n)}}}}}return i}function uj(e,t,n,i,s){if(i||s){const r=tj(e.visibleWrites,t);if(!s&&nj(r))return n;if(s||null!=n||JP(r,bI())){const r=function(e){return(e.visible||s)&&(!i||!~i.indexOf(e.writeId))&&(jI(e.path,t)||jI(t,e.path))};return ij(cj(e.allWrites,r,t),n||cP.EMPTY_NODE)}return null}{const i=ZP(e.visibleWrites,t);if(null!=i)return i;{const i=tj(e.visibleWrites,t);if(nj(i))return n;if(null!=n||JP(i,bI())){return ij(i,n||cP.EMPTY_NODE)}return null}}}function dj(e,t,n,i){return uj(e.writeTree,e.treePath,t,n,i)}function hj(e,t){return function(e,t,n){let i=cP.EMPTY_NODE;const s=ZP(e.visibleWrites,t);if(s)return s.isLeafNode()||s.forEachChild(tP,(e,t)=>{i=i.updateImmediateChild(e,t)}),i;if(n){const s=tj(e.visibleWrites,t);return n.forEachChild(tP,(e,t)=>{const n=ij(tj(s,new vI(e)),t);i=i.updateImmediateChild(e,n)}),ej(s).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}return ej(tj(e.visibleWrites,t)).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}(e.writeTree,e.treePath,t)}function fj(e,t,n,i){return function(e,t,n,i,s){f(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=EI(t,n);if(JP(e.visibleWrites,r))return null;{const t=tj(e.visibleWrites,r);return nj(t)?s.getChild(n):ij(t,s.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function pj(e,t){return function(e,t){return ZP(e.visibleWrites,t)}(e.writeTree,EI(e.treePath,t))}function mj(e,t,n,i,s,r){return function(e,t,n,i,s,r,o){let a;const l=tj(e.visibleWrites,t),c=ZP(l,bI());if(null!=c)a=c;else{if(null==n)return[];a=ij(l,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let l=n.getNext();for(;l&&e.length<s;)0!==t(l,i)&&e.push(l),l=n.getNext();return e}}(e.writeTree,e.treePath,t,n,i,s,r)}function gj(e,t,n){return function(e,t,n,i){const s=EI(t,n),r=ZP(e.visibleWrites,s);if(null!=r)return r;if(i.isCompleteForChild(n))return ij(tj(e.visibleWrites,s),i.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function yj(e,t){return vj(EI(e.treePath,t),e.writeTree)}function vj(e,t){return{treePath:e,writeTree:t}}class bj{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;f("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),f(".priority"!==n,"Only non-priority child changes can be tracked.");const i=this.changeMap.get(n);if(i){const s=i.type;if("child_added"===t&&"child_removed"===s)this.changeMap.set(n,yP(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===s)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===s)this.changeMap.set(n,gP(n,i.oldSnap));else if("child_changed"===t&&"child_added"===s)this.changeMap.set(n,mP(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==s)throw p("Illegal combination of changes: "+e+" occurred after "+i);this.changeMap.set(n,yP(n,e.snapshotNode,i.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const xj=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class _j{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new FP(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return gj(this.writes_,e,t)}}getChildAfterChild(e,t,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:WP(this.viewCache_),s=mj(this.writes_,i,t,1,n,e);return 0===s.length?null:s[0]}}function wj(e,t,n,i,s){const r=new bj;let o,a;if(n.type===AP.OVERWRITE){const l=n;l.source.fromUser?o=kj(e,t,l.path,l.snap,i,s,r):(f(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered()&&!TI(l.path),o=Nj(e,t,l.path,l.snap,i,s,a,r))}else if(n.type===AP.MERGE){const l=n;l.source.fromUser?o=function(e,t,n,i,s,r,o){let a=t;return i.foreach((i,l)=>{const c=EI(n,i);Ej(t,xI(c))&&(a=kj(e,a,c,l,s,r,o))}),i.foreach((i,l)=>{const c=EI(n,i);Ej(t,xI(c))||(a=kj(e,a,c,l,s,r,o))}),a}(e,t,l.path,l.children,i,s,r):(f(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),o=Sj(e,t,l.path,l.children,i,s,a,r))}else if(n.type===AP.ACK_USER_WRITE){const a=n;o=a.revert?function(e,t,n,i,s,r){let o;if(null!=pj(i,n))return t;{const a=new _j(i,t,s),l=t.eventCache.getNode();let c;if(TI(n)||".priority"===xI(n)){let n;if(t.serverCache.isFullyInitialized())n=dj(i,WP(t));else{const e=t.serverCache.getNode();f(e instanceof cP,"serverChildren would be complete if leaf node"),n=hj(i,e)}c=e.filter.updateFullNode(l,n,r)}else{const s=xI(n);let u=gj(i,s,t.serverCache);null==u&&t.serverCache.isCompleteForChild(s)&&(u=l.getImmediateChild(s)),c=null!=u?e.filter.updateChild(l,s,u,wI(n),a,r):t.eventCache.getNode().hasChild(s)?e.filter.updateChild(l,s,cP.EMPTY_NODE,wI(n),a,r):l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=dj(i,WP(t)),o.isLeafNode()&&(c=e.filter.updateFullNode(c,o,r)))}return o=t.serverCache.isFullyInitialized()||null!=pj(i,bI()),BP(t,c,o,e.filter.filtersNodes())}}(e,t,a.path,i,s,r):function(e,t,n,i,s,r,o){if(null!=pj(s,n))return t;const a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=i.value){if(TI(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return Nj(e,t,n,l.getNode().getChild(n),s,r,a,o);if(TI(n)){let i=new KP(null);return l.getNode().forEachChild(BI,(e,t)=>{i=i.set(new vI(e),t)}),Sj(e,t,n,i,s,r,a,o)}return t}{let c=new KP(null);return i.foreach((e,t)=>{const i=EI(n,e);l.isCompleteForPath(i)&&(c=c.set(e,l.getNode().getChild(i)))}),Sj(e,t,n,c,s,r,a,o)}}(e,t,a.path,a.affectedTree,i,s,r)}else{if(n.type!==AP.LISTEN_COMPLETE)throw p("Unknown operation type: "+n.type);o=function(e,t,n,i,s){const r=t.serverCache,o=HP(t,r.getNode(),r.isFullyInitialized()||TI(n),r.isFiltered());return Cj(e,o,n,i,xj,s)}(e,t,n.path,i,r)}const l=r.getChanges();return function(e,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=qP(e);(n.length>0||!e.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push(pP(qP(t)))}}(t,o,l),{viewCache:o,changes:l}}function Cj(e,t,n,i,s,r){const o=t.eventCache;if(null!=pj(i,n))return t;{let a,l;if(TI(n))if(f(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=WP(t),s=hj(i,n instanceof cP?n:cP.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),s,r)}else{const n=dj(i,WP(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,r)}else{const c=xI(n);if(".priority"===c){f(1===_I(n),"Can't have a priority with additional path components");const s=o.getNode();l=t.serverCache.getNode();const r=fj(i,n,s,l);a=null!=r?e.filter.updatePriority(s,r):o.getNode()}else{const u=wI(n);let d;if(o.isCompleteForChild(c)){l=t.serverCache.getNode();const e=fj(i,n,o.getNode(),l);d=null!=e?o.getNode().getImmediateChild(c).updateChild(u,e):o.getNode().getImmediateChild(c)}else d=gj(i,c,t.serverCache);a=null!=d?e.filter.updateChild(o.getNode(),c,d,u,s,r):o.getNode()}}return BP(t,a,o.isFullyInitialized()||TI(n),e.filter.filtersNodes())}}function Nj(e,t,n,i,s,r,o,a){const l=t.serverCache;let c;const u=o?e.filter:e.filter.getIndexedFilter();if(TI(n))c=u.updateFullNode(l.getNode(),i,null);else if(u.filtersNodes()&&!l.isFiltered()){const e=l.getNode().updateChild(n,i);c=u.updateFullNode(l.getNode(),e,null)}else{const e=xI(n);if(!l.isCompleteForPath(n)&&_I(n)>1)return t;const s=wI(n),r=l.getNode().getImmediateChild(e).updateChild(s,i);c=".priority"===e?u.updatePriority(l.getNode(),r):u.updateChild(l.getNode(),e,r,s,xj,null)}const d=HP(t,c,l.isFullyInitialized()||TI(n),u.filtersNodes());return Cj(e,d,n,s,new _j(s,d,r),a)}function kj(e,t,n,i,s,r,o){const a=t.eventCache;let l,c;const u=new _j(s,t,r);if(TI(n))c=e.filter.updateFullNode(t.eventCache.getNode(),i,o),l=BP(t,c,!0,e.filter.filtersNodes());else{const s=xI(n);if(".priority"===s)c=e.filter.updatePriority(t.eventCache.getNode(),i),l=BP(t,c,a.isFullyInitialized(),a.isFiltered());else{const r=wI(n),c=a.getNode().getImmediateChild(s);let d;if(TI(r))d=i;else{const e=u.getCompleteChild(s);d=null!=e?".priority"===CI(r)&&e.getChild(kI(r)).isEmpty()?e:e.updateChild(r,i):cP.EMPTY_NODE}if(c.equals(d))l=t;else{l=BP(t,e.filter.updateChild(a.getNode(),s,d,r,u,o),a.isFullyInitialized(),e.filter.filtersNodes())}}}return l}function Ej(e,t){return e.eventCache.isCompleteForChild(t)}function Tj(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function Sj(e,t,n,i,s,r,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l,c=t;l=TI(n)?i:new KP(null).setTree(n,i);const u=t.serverCache.getNode();return l.children.inorderTraversal((n,i)=>{if(u.hasChild(n)){const l=Tj(0,t.serverCache.getNode().getImmediateChild(n),i);c=Nj(e,c,new vI(n),l,s,r,o,a)}}),l.children.inorderTraversal((n,i)=>{const l=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!u.hasChild(n)&&!l){const l=Tj(0,t.serverCache.getNode().getImmediateChild(n),i);c=Nj(e,c,new vI(n),l,s,r,o,a)}}),c}class Ij{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new vP(n.getIndex()),s=(r=n).loadsAllData()?new vP(r.getIndex()):r.hasLimit()?new xP(r):new bP(r);var r;this.processor_=function(e){return{filter:e}}(s);const o=t.serverCache,a=t.eventCache,l=i.updateFullNode(cP.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(cP.EMPTY_NODE,a.getNode(),null),u=new FP(l,o.isFullyInitialized(),i.filtersNodes()),d=new FP(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=VP(d,u),this.eventGenerator_=new zP(this.query_)}get query(){return this.query_}}function Pj(e,t){const n=WP(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!TI(t)&&!n.getImmediateChild(xI(t)).isEmpty())?n.getChild(t):null}function jj(e){return 0===e.eventRegistrations_.length}function Aj(e,t,n){const i=[];if(n){f(null==t,"A cancel should cancel all event registrations.");const s=e.query._path;e.eventRegistrations_.forEach(e=>{const t=e.createCancelEvent(n,s);t&&i.push(t)})}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){const s=e.eventRegistrations_[i];if(s.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(s)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function Dj(e,t,n,i){t.type===AP.MERGE&&null!==t.source.queryId&&(f(WP(e.viewCache_),"We should always have a full cache before handling merges"),f(qP(e.viewCache_),"Missing event cache, even though we have a server cache"));const s=e.viewCache_,r=wj(e.processor_,s,t,n,i);var o,a;return o=e.processor_,a=r.viewCache,f(a.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),f(a.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),f(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=r.viewCache,Rj(e,r.changes,r.viewCache.eventCache.getNode(),null)}function Rj(e,t,n,i){const s=i?[i]:e.eventRegistrations_;return function(e,t,n,i){const s=[],r=[];return t.forEach(t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&r.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))}),UP(e,s,"child_removed",t,i,n),UP(e,s,"child_added",t,i,n),UP(e,s,"child_moved",r,i,n),UP(e,s,"child_changed",t,i,n),UP(e,s,"value",t,i,n),s}(e.eventGenerator_,t,n,s)}let Mj,Oj;class Lj{constructor(){this.views=new Map}}function Fj(e,t,n,i){const s=t.source.queryId;if(null!==s){const r=e.views.get(s);return f(null!=r,"SyncTree gave us an op for an invalid query."),Dj(r,t,n,i)}{let s=[];for(const r of e.views.values())s=s.concat(Dj(r,t,n,i));return s}}function zj(e,t,n,i,s){const r=t._queryIdentifier,o=e.views.get(r);if(!o){let e=dj(n,s?i:null),r=!1;e?r=!0:i instanceof cP?(e=hj(n,i),r=!1):(e=cP.EMPTY_NODE,r=!1);const o=VP(new FP(e,r,!1),new FP(i,s,!1));return new Ij(t,o)}return o}function Uj(e,t,n,i,s,r){const o=zj(e,t,i,s,r);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,i=[];n.getNode().isLeafNode()||n.getNode().forEachChild(tP,(e,t)=>{i.push(mP(e,t))});return n.isFullyInitialized()&&i.push(pP(n.getNode())),Rj(e,i,n.getNode(),t)}(o,n)}function Vj(e,t,n,i){const s=t._queryIdentifier,r=[];let o=[];const a=Gj(e);if("default"===s)for(const[l,c]of e.views.entries())o=o.concat(Aj(c,n,i)),jj(c)&&(e.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{const t=e.views.get(s);t&&(o=o.concat(Aj(t,n,i)),jj(t)&&(e.views.delete(s),t.query._queryParams.loadsAllData()||r.push(t.query)))}return a&&!Gj(e)&&r.push(new(f(Mj,"Reference.ts has not been loaded"),Mj)(t._repo,t._path)),{removed:r,events:o}}function Bj(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function Hj(e,t){let n=null;for(const i of e.views.values())n=n||Pj(i,t);return n}function qj(e,t){if(t._queryParams.loadsAllData())return Kj(e);{const n=t._queryIdentifier;return e.views.get(n)}}function Wj(e,t){return null!=qj(e,t)}function Gj(e){return null!=Kj(e)}function Kj(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Yj=1;class Qj{constructor(e){this.listenProvider_=e,this.syncPointTree_=new KP(null),this.pendingWriteTree_={visibleWrites:YP.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Xj(e,t,n,i,s){return function(e,t,n,i,s){f(i>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),e.allWrites.push({path:t,snap:n,writeId:i,visible:s}),s&&(e.visibleWrites=QP(e.visibleWrites,t,n)),e.lastWriteId=i}(e.pendingWriteTree_,t,n,i,s),s?iA(e,new OP({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function $j(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=function(e,t){for(let n=0;n<e.allWrites.length;n++){const i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(oj(e.pendingWriteTree_,t)){let t=new KP(null);return null!=i.snap?t=t.set(bI(),!0):VS(i.children,e=>{t=t.set(new vI(e),!0)}),iA(e,new RP(i.path,t,n))}return[]}function Jj(e,t,n){return iA(e,new OP({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Zj(e,t,n,i){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=t._path,o=e.syncPointTree_.get(r);let a=[];if(o&&("default"===t._queryIdentifier||Wj(o,t))){const l=Vj(o,t,n,i);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(r));const c=l.removed;if(a=l.events,!s){const n=-1!==c.findIndex(e=>e._queryParams.loadsAllData()),s=e.syncPointTree_.findOnPath(r,(e,t)=>Gj(t));if(n&&!s){const t=e.syncPointTree_.subtree(r);if(!t.isEmpty()){const n=function(e){return e.fold((e,t,n)=>{if(t&&Gj(t)){return[Kj(t)]}{let e=[];return t&&(e=Bj(t)),VS(n,(t,n)=>{e=e.concat(n)}),e}})}(t);for(let t=0;t<n.length;++t){const i=n[t],s=i.query,r=oA(e,i);e.listenProvider_.startListening(hA(s),aA(e,s),r.hashFn,r.onComplete)}}}if(!s&&c.length>0&&!i)if(n){const n=null;e.listenProvider_.stopListening(hA(t),n)}else c.forEach(t=>{const n=e.queryToTagMap.get(lA(t));e.listenProvider_.stopListening(hA(t),n)})}!function(e,t){for(let n=0;n<t.length;++n){const i=t[n];if(!i._queryParams.loadsAllData()){const t=lA(i),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,c)}return a}function eA(e,t,n,i){const s=cA(e,i);if(null!=s){const i=uA(s),r=i.path,o=i.queryId,a=SI(r,t);return dA(e,r,new OP(DP(o),a,n))}return[]}function tA(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=t._path;let r=null,o=!1;e.syncPointTree_.foreachOnPath(s,(e,t)=>{const n=SI(e,s);r=r||Hj(t,n),o=o||Gj(t)});let a,l=e.syncPointTree_.get(s);if(l?(o=o||Gj(l),r=r||Hj(l,bI())):(l=new Lj,e.syncPointTree_=e.syncPointTree_.set(s,l)),null!=r)a=!0;else{a=!1,r=cP.EMPTY_NODE;e.syncPointTree_.subtree(s).foreachChild((e,t)=>{const n=Hj(t,bI());n&&(r=r.updateImmediateChild(e,n))})}const c=Wj(l,t);if(!c&&!t._queryParams.loadsAllData()){const n=lA(t);f(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const i=Yj++;e.queryToTagMap.set(n,i),e.tagToQueryMap.set(i,n)}let u=Uj(l,t,n,rj(e.pendingWriteTree_,s),r,a);if(!c&&!o&&!i){const n=qj(l,t);u=u.concat(function(e,t,n){const i=t._path,s=aA(e,t),r=oA(e,n),o=e.listenProvider_.startListening(hA(t),s,r.hashFn,r.onComplete),a=e.syncPointTree_.subtree(i);if(s)f(!Gj(a.value),"If we're adding a query, it shouldn't be shadowed");else{const t=a.fold((e,t,n)=>{if(!TI(e)&&t&&Gj(t))return[Kj(t).query];{let e=[];return t&&(e=e.concat(Bj(t).map(e=>e.query))),VS(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){const i=t[n];e.listenProvider_.stopListening(hA(i),aA(e,i))}}return o}(e,t,n))}return u}function nA(e,t,n){const i=e.pendingWriteTree_,s=e.syncPointTree_.findOnPath(t,(e,n)=>{const i=Hj(n,SI(e,t));if(i)return i});return uj(i,t,s,n,!0)}function iA(e,t){return sA(t,e.syncPointTree_,null,rj(e.pendingWriteTree_,bI()))}function sA(e,t,n,i){if(TI(e.path))return rA(e,t,n,i);{const s=t.get(bI());null==n&&null!=s&&(n=Hj(s,bI()));let r=[];const o=xI(e.path),a=e.operationForChild(o),l=t.children.get(o);if(l&&a){const e=n?n.getImmediateChild(o):null,t=yj(i,o);r=r.concat(sA(a,l,e,t))}return s&&(r=r.concat(Fj(s,e,i,n))),r}}function rA(e,t,n,i){const s=t.get(bI());null==n&&null!=s&&(n=Hj(s,bI()));let r=[];return t.children.inorderTraversal((t,s)=>{const o=n?n.getImmediateChild(t):null,a=yj(i,t),l=e.operationForChild(t);l&&(r=r.concat(rA(l,s,o,a)))}),s&&(r=r.concat(Fj(s,e,i,n))),r}function oA(e,t){const n=t.query,i=aA(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||cP.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return i?function(e,t,n){const i=cA(e,n);if(i){const n=uA(i),s=n.path,r=n.queryId,o=SI(s,t);return dA(e,s,new MP(DP(r),o))}return[]}(e,n._path,i):function(e,t){return iA(e,new MP({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const i=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const i=new Error(e+" at "+t._path.toString()+": "+n);return i.code=e.toUpperCase(),i}(t,n);return Zj(e,n,null,i)}}}}function aA(e,t){const n=lA(t);return e.queryToTagMap.get(n)}function lA(e){return e._path.toString()+"$"+e._queryIdentifier}function cA(e,t){return e.tagToQueryMap.get(t)}function uA(e){const t=e.indexOf("$");return f(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new vI(e.substr(0,t))}}function dA(e,t,n){const i=e.syncPointTree_.get(t);f(i,"Missing sync point for query tag that we're tracking");return Fj(i,n,rj(e.pendingWriteTree_,t),null)}function hA(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(f(Oj,"Reference.ts has not been loaded"),Oj)(e._repo,e._path):e}class fA{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new fA(t)}node(){return this.node_}}class pA{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=EI(this.path_,e);return new pA(this.syncTree_,t)}node(){return nA(this.syncTree_,this.path_)}}const mA=function(e,t,n){return e&&"object"===typeof e?(f(".sv"in e,"Unexpected leaf node or priority contents"),"string"===typeof e[".sv"]?gA(e[".sv"],t,n):"object"===typeof e[".sv"]?yA(e[".sv"],t):void f(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},gA=function(e,t,n){if("timestamp"===e)return n.timestamp;f(!1,"Unexpected server value: "+e)},yA=function(e,t,n){e.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const i=e.increment;"number"!==typeof i&&f(!1,"Unexpected increment value: "+i);const s=t.node();if(f(null!==s&&"undefined"!==typeof s,"Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const r=s.getValue();return"number"!==typeof r?i:r+i},vA=function(e,t,n,i){return xA(t,new pA(n,e),i)},bA=function(e,t,n){return xA(e,new fA(t),n)};function xA(e,t,n){const i=e.getPriority().val(),s=mA(i,t.getImmediateChild(".priority"),n);let r;if(e.isLeafNode()){const i=e,r=mA(i.getValue(),t,n);return r!==i.getValue()||s!==i.getPriority().val()?new eP(r,dP(s)):e}{const i=e;return r=i,s!==i.getPriority().val()&&(r=r.updatePriority(new eP(s))),i.forEachChild(tP,(e,i)=>{const s=xA(i,t.getImmediateChild(e),n);s!==i&&(r=r.updateImmediateChild(e,s))}),r}}class _A{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{children:{},childCount:0};this.name=e,this.parent=t,this.node=n}}function wA(e,t){let n=t instanceof vI?t:new vI(t),i=e,s=xI(n);for(;null!==s;){const e=W(i.node.children,s)||{children:{},childCount:0};i=new _A(s,i,e),n=wI(n),s=xI(n)}return i}function CA(e){return e.node.value}function NA(e,t){e.node.value=t,IA(e)}function kA(e){return e.node.childCount>0}function EA(e,t){VS(e.node.children,(n,i)=>{t(new _A(n,e,i))})}function TA(e,t,n,i){n&&!i&&t(e),EA(e,e=>{TA(e,t,!0,i)}),n&&i&&t(e)}function SA(e){return new vI(null===e.parent?e.name:SA(e.parent)+"/"+e.name)}function IA(e){null!==e.parent&&function(e,t,n){const i=function(e){return void 0===CA(e)&&!kA(e)}(n),s=q(e.node.children,t);i&&s?(delete e.node.children[t],e.node.childCount--,IA(e)):i||s||(e.node.children[t]=n.node,e.node.childCount++,IA(e))}(e.parent,e.name,e)}const PA=/[\[\].#$\/\u0000-\u001F\u007F]/,jA=/[\[\].#$\u0000-\u001F\u007F]/,AA=10485760,DA=function(e){return"string"===typeof e&&0!==e.length&&!PA.test(e)},RA=function(e){return"string"===typeof e&&0!==e.length&&!jA.test(e)},MA=function(e){return null===e||"string"===typeof e||"number"===typeof e&&!DS(e)||e&&"object"===typeof e&&q(e,".sv")},OA=function(e,t,n,i){i&&void 0===t||LA(ne(e,"value"),t,n)},LA=function(e,t,n){const i=n instanceof vI?new AI(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+RI(i));if("function"===typeof t)throw new Error(e+"contains a function "+RI(i)+" with contents = "+t.toString());if(DS(t))throw new Error(e+"contains "+t.toString()+" "+RI(i));if("string"===typeof t&&t.length>AA/3&&ie(t)>AA)throw new Error(e+"contains a string greater than "+AA+" utf8 bytes "+RI(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"===typeof t){let n=!1,s=!1;if(VS(t,(t,r)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(s=!0,!DA(t)))throw new Error(e+" contains an invalid key ("+t+") "+RI(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=ie(t),DI(e)}(i,t),LA(e,r,i),function(e){const t=e.parts_.pop();e.byteLength_-=ie(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)}),n&&s)throw new Error(e+' contains ".value" child '+RI(i)+" in addition to actual children.")}},FA=function(e,t,n,i){if(i&&void 0===t)return;const s=ne(e,"values");if(!t||"object"!==typeof t||Array.isArray(t))throw new Error(s+" must be an object containing the children to replace.");const r=[];VS(t,(e,t)=>{const i=new vI(e);if(LA(s,t,EI(n,i)),".priority"===CI(i)&&!MA(t))throw new Error(s+"contains an invalid value for '"+i.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(i)}),function(e,t){let n,i;for(n=0;n<t.length;n++){i=t[n];const s=NI(i);for(let t=0;t<s.length;t++)if(".priority"===s[t]&&t===s.length-1);else if(!DA(s[t]))throw new Error(e+"contains an invalid key ("+s[t]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(II);let s=null;for(n=0;n<t.length;n++){if(i=t[n],null!==s&&jI(s,i))throw new Error(e+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}}(s,r)},zA=function(e,t,n){if(!n||void 0!==t){if(DS(t))throw new Error(ne(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!MA(t))throw new Error(ne(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},UA=function(e,t,n,i){if((!i||void 0!==n)&&!RA(n))throw new Error(ne(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},VA=function(e,t){if(".info"===xI(t))throw new Error(e+" failed = Can't modify data under /.info/")},BA=function(e,t){const n=t.path.toString();if("string"!==typeof t.repoInfo.host||0===t.repoInfo.host.length||!DA(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),RA(e)}(n))throw new Error(ne(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class HA{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function qA(e,t){let n=null;for(let i=0;i<t.length;i++){const s=t[i],r=s.getPath();null===n||PI(r,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&e.eventLists_.push(n)}function WA(e,t,n){qA(e,n),KA(e,e=>PI(e,t))}function GA(e,t,n){qA(e,n),KA(e,e=>jI(e,t)||jI(t,e))}function KA(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const s=e.eventLists_[i];if(s){t(s.path)?(YA(e.eventLists_[i]),e.eventLists_[i]=null):n=!1}}n&&(e.eventLists_=[]),e.recursionDepth_--}function YA(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const i=n.getEventRunner();kS&&SS("event: "+n.toString()),WS(i)}}}const QA="repo_interrupt";class XA{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new HA,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=EP(),this.transactionQueueTree_=new _A,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function $A(e,t,n){if(e.stats_=oI(e.repoInfo_),e.forceRestClient_||("object"===typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new NP(e.repoInfo_,(t,n,i,s)=>{eD(e,t,n,i,s)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>tD(e,!0),0);else{if("undefined"!==typeof n&&null!==n){if("object"!==typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{B(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}e.persistentConnection_=new LI(e.repoInfo_,t,(t,n,i,s)=>{eD(e,t,n,i,s)},t=>{tD(e,t)},t=>{!function(e,t){VS(t,(t,n)=>{nD(e,t,n)})}(e,t)},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){const n=e.toString();return rI[n]||(rI[n]=t()),rI[n]}(e.repoInfo_,()=>new jP(e.stats_,e.server_)),e.infoData_=new kP,e.infoSyncTree_=new Qj({startListening:(t,n,i,s)=>{let r=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(r=Jj(e.infoSyncTree_,t._path,o),setTimeout(()=>{s("ok")},0)),r},stopListening:()=>{}}),nD(e,"connected",!1),e.serverSyncTree_=new Qj({startListening:(t,n,i,s)=>(e.server_.listen(t,i,n,(n,i)=>{const r=s(n,i);GA(e.eventQueue_,t._path,r)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function JA(e){const t=e.infoData_.getNode(new vI(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function ZA(e){return(t=(t={timestamp:JA(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function eD(e,t,n,i,s){e.dataUpdateCount++;const r=new vI(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(s)if(i){const t=K(n,e=>dP(e));o=function(e,t,n,i){const s=cA(e,i);if(s){const i=uA(s),r=i.path,o=i.queryId,a=SI(r,t),l=KP.fromObject(n);return dA(e,r,new LP(DP(o),a,l))}return[]}(e.serverSyncTree_,r,t,s)}else{const t=dP(n);o=eA(e.serverSyncTree_,r,t,s)}else if(i){const t=K(n,e=>dP(e));o=function(e,t,n){const i=KP.fromObject(n);return iA(e,new LP({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,r,t)}else{const t=dP(n);o=Jj(e.serverSyncTree_,r,t)}let a=r;o.length>0&&(a=fD(e,r)),GA(e.eventQueue_,a,o)}function tD(e,t){nD(e,"connected",t),!1===t&&function(e){cD(e,"onDisconnectEvents");const t=ZA(e),n=EP();IP(e.onDisconnect_,bI(),(i,s)=>{const r=vA(i,s,e.serverSyncTree_,t);TP(n,i,r)});let i=[];IP(n,bI(),(t,n)=>{i=i.concat(Jj(e.serverSyncTree_,t,n));const s=vD(e,t);fD(e,s)}),e.onDisconnect_=EP(),GA(e.eventQueue_,bI(),i)}(e)}function nD(e,t,n){const i=new vI("/.info/"+t),s=dP(n);e.infoData_.updateSnapshot(i,s);const r=Jj(e.infoSyncTree_,i,s);GA(e.eventQueue_,i,r)}function iD(e){return e.nextWriteId_++}function sD(e,t,n,i,s){cD(e,"set",{path:t.toString(),value:n,priority:i});const r=ZA(e),o=dP(n,i),a=nA(e.serverSyncTree_,t),l=bA(o,a,r),c=iD(e),u=Xj(e.serverSyncTree_,t,l,c,!0);qA(e.eventQueue_,u),e.server_.put(t.toString(),o.val(!0),(n,i)=>{const r="ok"===n;r||AS("set at "+t+" failed: "+n);const o=$j(e.serverSyncTree_,c,!r);GA(e.eventQueue_,t,o),uD(e,s,n,i)});const d=vD(e,t);fD(e,d),GA(e.eventQueue_,d,[])}function rD(e,t,n){e.server_.onDisconnectCancel(t.toString(),(i,s)=>{"ok"===i&&SP(e.onDisconnect_,t),uD(e,n,i,s)})}function oD(e,t,n,i){const s=dP(n);e.server_.onDisconnectPut(t.toString(),s.val(!0),(n,r)=>{"ok"===n&&TP(e.onDisconnect_,t,s),uD(e,i,n,r)})}function aD(e,t,n){let i;i=".info"===xI(t._path)?Zj(e.infoSyncTree_,t,n):Zj(e.serverSyncTree_,t,n),WA(e.eventQueue_,t._path,i)}function lD(e){e.persistentConnection_&&e.persistentConnection_.interrupt(QA)}function cD(e){let t="";e.persistentConnection_&&(t=e.persistentConnection_.id+":");for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];SS(t,...i)}function uD(e,t,n,i){t&&WS(()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let s=e;i&&(s+=": "+i);const r=new Error(s);r.code=e,t(r)}})}function dD(e,t,n){return nA(e.serverSyncTree_,t,n)||cP.EMPTY_NODE}function hD(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transactionQueueTree_;if(t||yD(e,t),CA(t)){const n=mD(e,t);f(n.length>0,"Sending zero length transaction queue");n.every(e=>0===e.status)&&function(e,t,n){const i=n.map(e=>e.currentWriteId),s=dD(e,t,i);let r=s;const o=s.hash();for(let c=0;c<n.length;c++){const e=n[c];f(0===e.status,"tryToSendTransactionQueue_: items in queue should all be run."),e.status=1,e.retryCount++;const i=SI(t,e.path);r=r.updateChild(i,e.currentOutputSnapshotRaw)}const a=r.val(!0),l=t;e.server_.put(l.toString(),a,i=>{cD(e,"transaction put response",{path:l.toString(),status:i});let s=[];if("ok"===i){const i=[];for(let t=0;t<n.length;t++)n[t].status=2,s=s.concat($j(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&i.push(()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)),n[t].unwatcher();yD(e,wA(e.transactionQueueTree_,t)),hD(e,e.transactionQueueTree_),GA(e.eventQueue_,t,s);for(let e=0;e<i.length;e++)WS(i[e])}else{if("datastale"===i)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{AS("transaction at "+l.toString()+" failed: "+i);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=i}fD(e,t)}},o)}(e,SA(t),n)}else kA(t)&&EA(t,t=>{hD(e,t)})}function fD(e,t){const n=pD(e,t),i=SA(n);return function(e,t,n){if(0===t.length)return;const i=[];let s=[];const r=t.filter(e=>0===e.status),o=r.map(e=>e.currentWriteId);for(let a=0;a<t.length;a++){const r=t[a],l=SI(n,r.path);let c,u=!1;if(f(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===r.status)u=!0,c=r.abortReason,s=s.concat($j(e.serverSyncTree_,r.currentWriteId,!0));else if(0===r.status)if(r.retryCount>=25)u=!0,c="maxretry",s=s.concat($j(e.serverSyncTree_,r.currentWriteId,!0));else{const n=dD(e,r.path,o);r.currentInputSnapshot=n;const i=t[a].update(n.val());if(void 0!==i){LA("transaction failed: Data returned ",i,r.path);let t=dP(i);"object"===typeof i&&null!=i&&q(i,".priority")||(t=t.updatePriority(n.getPriority()));const a=r.currentWriteId,l=ZA(e),c=bA(t,n,l);r.currentOutputSnapshotRaw=t,r.currentOutputSnapshotResolved=c,r.currentWriteId=iD(e),o.splice(o.indexOf(a),1),s=s.concat(Xj(e.serverSyncTree_,r.path,c,r.currentWriteId,r.applyLocally)),s=s.concat($j(e.serverSyncTree_,a,!0))}else u=!0,c="nodata",s=s.concat($j(e.serverSyncTree_,r.currentWriteId,!0))}GA(e.eventQueue_,n,s),s=[],u&&(t[a].status=2,function(e){setTimeout(e,Math.floor(0))}(t[a].unwatcher),t[a].onComplete&&("nodata"===c?i.push(()=>t[a].onComplete(null,!1,t[a].currentInputSnapshot)):i.push(()=>t[a].onComplete(new Error(c),!1,null))))}yD(e,e.transactionQueueTree_);for(let a=0;a<i.length;a++)WS(i[a]);hD(e,e.transactionQueueTree_)}(e,mD(e,n),i),i}function pD(e,t){let n,i=e.transactionQueueTree_;for(n=xI(t);null!==n&&void 0===CA(i);)i=wA(i,n),n=xI(t=wI(t));return i}function mD(e,t){const n=[];return gD(e,t,n),n.sort((e,t)=>e.order-t.order),n}function gD(e,t,n){const i=CA(t);if(i)for(let s=0;s<i.length;s++)n.push(i[s]);EA(t,t=>{gD(e,t,n)})}function yD(e,t){const n=CA(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,NA(t,n.length>0?n:void 0)}EA(t,t=>{yD(e,t)})}function vD(e,t){const n=SA(pD(e,t)),i=wA(e.transactionQueueTree_,t);return function(e,t,n){let i=n?e:e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,t=>{bD(e,t)}),bD(e,i),TA(i,t=>{bD(e,t)}),n}function bD(e,t){const n=CA(t);if(n){const i=[];let s=[],r=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(f(r===t-1,"All SENT items should be at beginning of queue."),r=t,n[t].status=3,n[t].abortReason="set"):(f(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),s=s.concat($j(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===r?NA(t,void 0):n.length=r+1,GA(e.eventQueue_,SA(t),s);for(let e=0;e<i.length;e++)WS(i[e])}}const xD=function(e,t){const n=_D(e),i=n.namespace;"firebase.com"===n.domain&&jS(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||jS("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&AS("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const s="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new tI(n.host,n.secure,i,s,t,"",i!==n.subdomain),path:new vI(n.pathString)}},_D=function(e){let t="",n="",i="",s="",r="",o=!0,a="https",l=443;if("string"===typeof e){let c=e.indexOf("//");c>=0&&(a=e.substring(0,c-1),e=e.substring(c+2));let u=e.indexOf("/");-1===u&&(u=e.length);let d=e.indexOf("?");-1===d&&(d=e.length),t=e.substring(0,Math.min(u,d)),u<d&&(s=function(e){let t="";const n=e.split("/");for(let s=0;s<n.length;s++)if(n[s].length>0){let e=n[s];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(i){}t+="/"+e}return t}(e.substring(u,d)));const h=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):AS("Invalid query segment '".concat(n,"' in query '").concat(e,"'"))}return t}(e.substring(Math.min(e.length,d)));c=t.indexOf(":"),c>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(c+1),10)):c=t.length;const f=t.slice(0,c);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{const e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),r=i}"ns"in h&&(r=h.ns)}return{host:t,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}},wD="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";!function(){let e=0;const t=[]}();class CD{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+B(this.snapshot.exportVal())}}class ND{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class kD{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class ED{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new P;return rD(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){VA("OnDisconnect.remove",this._path);const e=new P;return oD(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){VA("OnDisconnect.set",this._path),OA("OnDisconnect.set",e,this._path,!1);const t=new P;return oD(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){VA("OnDisconnect.setWithPriority",this._path),OA("OnDisconnect.setWithPriority",e,this._path,!1),zA("OnDisconnect.setWithPriority",t,!1);const n=new P;return function(e,t,n,i,s){const r=dP(n,i);e.server_.onDisconnectPut(t.toString(),r.val(!0),(n,i)=>{"ok"===n&&TP(e.onDisconnect_,t,r),uD(0,s,n,i)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){VA("OnDisconnect.update",this._path),FA("OnDisconnect.update",e,this._path,!1);const t=new P;return function(e,t,n,i){if(G(n))return SS("onDisconnect().update() called with empty data.  Don't do anything."),void uD(0,i,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,(s,r)=>{"ok"===s&&VS(n,(n,i)=>{const s=dP(i);TP(e.onDisconnect_,EI(t,n),s)}),uD(0,i,s,r)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class TD{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return TI(this._path)?null:CI(this._path)}get ref(){return new SD(this._repo,this._path)}get _queryIdentifier(){const e=CP(this._queryParams),t=zS(e);return"{}"===t?"default":t}get _queryObject(){return CP(this._queryParams)}isEqual(e){if(!((e=se(e))instanceof TD))return!1;const t=this._repo===e._repo,n=PI(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class SD extends TD{constructor(e,t){super(e,t,new _P,!1)}get parent(){const e=kI(this._path);return null===e?null:new SD(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ID{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new vI(e),n=jD(this.ref,e);return new ID(this._node.getChild(t),n,tP)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,(t,n)=>e(new ID(n,jD(this.ref,t),tP)))}hasChild(e){const t=new vI(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function PD(e,t){return(e=se(e))._checkNotDeleted("ref"),void 0!==t?jD(e._root,t):e._root}function jD(e,t){var n,i,s,r;return null===xI((e=se(e))._path)?(n="child",i="path",r=!1,(s=t)&&(s=s.replace(/^\/*\.info(\/|$)/,"/")),UA(n,i,s,r)):UA("child","path",t,!1),new SD(e._repo,EI(e._path,t))}function AD(e,t){e=se(e),VA("set",e._path),OA("set",t,e._path,!1);const n=new P;return sD(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}class DD{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new CD("value",this,new ID(e.snapshotNode,new SD(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ND(this,e,t):null}matches(e){return e instanceof DD&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class RD{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ND(this,e,t):null}createEvent(e,t){f(null!=e.childName,"Child events should have a childName.");const n=jD(new SD(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new CD(e.type,this,new ID(e.snapshotNode,n,i),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof RD&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function MD(e,t,n,i,s){let r;if("object"===typeof i&&(r=void 0,s=i),"function"===typeof i&&(r=i),s&&s.onlyOnce){const t=n,i=(n,i)=>{aD(e._repo,e,a),t(n,i)};i.userCallback=n.userCallback,i.context=n.context,n=i}const o=new kD(n,r||void 0),a="value"===t?new DD(o):new RD(t,o);return function(e,t,n){let i;i=".info"===xI(t._path)?tA(e.infoSyncTree_,t,n):tA(e.serverSyncTree_,t,n),WA(e.eventQueue_,t._path,i)}(e._repo,e,a),()=>aD(e._repo,e,a)}function OD(e,t,n,i){return MD(e,"value",t,n,i)}!function(e){f(!Mj,"__referenceConstructor has already been defined"),Mj=e}(SD),function(e){f(!Oj,"__referenceConstructor has already been defined"),Oj=e}(SD);const LD={};let FD=!1;function zD(e,t,n,i,s){let r=i||e.options.databaseURL;void 0===r&&(e.options.projectId||jS("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),SS("Using default host for project ",e.options.projectId),r="".concat(e.options.projectId,"-default-rtdb.firebaseio.com"));let o,a,l=xD(r,s),c=l.repoInfo;"undefined"!==typeof process&&(a={NODE_ENV:"production",PUBLIC_URL:"/portal",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.FIREBASE_DATABASE_EMULATOR_HOST),a?(o=!0,r="http://".concat(a,"?ns=").concat(c.namespace),l=xD(r,s),c=l.repoInfo):o=!l.repoInfo.secure;const u=s&&o?new QS(QS.OWNER):new YS(e.name,e.options,t);BA("Invalid Firebase Database URL",l),TI(l.path)||jS("Database URL must point to the root of a Firebase Database (not including a child path).");const d=function(e,t,n,i){let s=LD[t.name];s||(s={},LD[t.name]=s);let r=s[e.toURLString()];r&&jS("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return r=new XA(e,FD,n,i),s[e.toURLString()]=r,r}(c,e,u,new KS(e.name,n));return new UD(d,e)}class UD{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||($A(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new SD(this._repo,bI())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=LD[t];n&&n[e.key]===e||jS("Database ".concat(t,"(").concat(e.repoInfo_,") has already been deleted.")),lD(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&jS("Cannot call "+e+" on a deleted database.")}}const VD={".sv":"timestamp"};function BD(){return VD}LI.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},LI.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};!function(e){!function(e){mS=e}(mt),dt(new re("database",(e,t)=>{let{instanceIdentifier:n}=t;return zD(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),n)},"PUBLIC").setMultipleInstances(!0)),vt(fS,pS,e),vt(fS,pS,"esm2017")}();var HD=n(579);VN.register(Mk,zk,dk,nk,sk,cC,yk,Ak,mk,KN);const qD={apiKey:"AIzaSyA7H6G0mXCy9DmoLg3fSW3TrxIRcEzz9jg",authDomain:"portal-evelsa.firebaseapp.com",projectId:"portal-evelsa",storageBucket:"portal-evelsa.firebasestorage.app",messagingSenderId:"847174487471",appId:"1:847174487471:web:c3a57fd8315ce619a2335a"},WD=gt(qD),GD=As(WD),KD=function(e,t){const n="string"==typeof e?e:t||"(default)",i=ht("object"==typeof e?e:yt(),"firestore").getImmediate({identifier:n});if(!i._initialized){const e=T("firestore");e&&function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var s;const r=(e=ig(e,rg))._getSettings(),o="".concat(t,":").concat(n);if("firestore.googleapis.com"!==r.host&&r.host!==o&&lc("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},r),{host:o,ssl:!1})),i.mockUserToken){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=nc.MOCK_USER;else{t=j(i.mockUserToken,null===(s=e._app)||void 0===s?void 0:s.options.projectId);const r=i.mockUserToken.sub||i.mockUserToken.user_id;if(!r)throw new pc(fc.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new nc(r)}e._authCredentials=new vc(new gc(t,n))}}(i,...e)}return i}(WD),YD="proyectos_v2",QD=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yt(),t=arguments.length>1?arguments[1]:void 0;e=se(e);const n=ht(e,sb).getImmediate({identifier:t}),i=T("storage");return i&&function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.host="".concat(t,":").concat(n),e._protocol="http";const{mockUserToken:s}=i;s&&(e._overrideAuthToken="string"===typeof s?s:j(s,e.app.options.projectId))}(e,t,n,i)}(n,...i),n}(WD),XD=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yt(),t=arguments.length>1?arguments[1]:void 0;const n=ht(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=T("database");e&&function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=se(e),e._checkNotDeleted("useEmulator"),e._instanceStarted&&jS("Cannot call useEmulator() after instance has already been initialized.");const s=e._repoInternal;let r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&jS('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new QS(QS.OWNER);else if(i.mockUserToken){const t="string"===typeof i.mockUserToken?i.mockUserToken:j(i.mockUserToken,e.app.options.projectId);r=new QS(t)}!function(e,t,n,i){e.repoInfo_=new tI("".concat(t,":").concat(n),!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),i&&(e.authTokenProvider_=i)}(s,t,n,r)}(n,...e)}return n}(WD),$D=e=>{if(!e)return"---";let t;if(t=e&&"function"===typeof e.toDate?e.toDate():new Date(e),isNaN(t.getTime()))return"---";const n=6e4*t.getTimezoneOffset();return new Date(t.getTime()+n).toLocaleDateString("es-MX",{year:"numeric",month:"2-digit",day:"2-digit"})},JD=(e,t)=>{let n=0;const i=new Date(e),s=new Date(t);for(i.setHours(0,0,0,0),s.setHours(0,0,0,0);i<=s;){const e=i.getDay();0!==e&&6!==e&&n++,i.setDate(i.getDate()+1)}return n},ZD=e=>{let{breakInfo:t,onEndBreak:n}=e;const s=(e=>{const[t,n]=(0,i.useState)(0);return(0,i.useEffect)(()=>{if(!e)return void n(0);const t=e.toDate().getTime(),i=setInterval(()=>{const e=Date.now(),i=t-e;n(i>0?i:0)},1e3);return()=>clearInterval(i)},[e]),(e=>{if(e<=0)return"00:00";const t=Math.floor(e/1e3),n=String(Math.floor(t/60)).padStart(2,"0"),i=String(t%60).padStart(2,"0");return"".concat(n,":").concat(i)})(t)})(new Sc(t.inicio.seconds+4500,t.inicio.nanoseconds));return(0,HD.jsxs)("div",{className:"bg-yellow-500 text-white p-4 rounded-lg shadow-lg mb-8 flex justify-between items-center sticky top-20 z-30",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("p",{className:"font-bold",children:"En Descanso"}),(0,HD.jsx)("p",{className:"text-lg",children:"El trabajo se reanudar\xe1 autom\xe1ticamente."})]}),(0,HD.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,HD.jsxs)("div",{className:"text-right",children:[(0,HD.jsx)("p",{className:"text-2xl font-mono",children:s}),(0,HD.jsx)("p",{className:"text-xs",children:"Tiempo Restante"})]}),(0,HD.jsx)("button",{onClick:n,className:"bg-green-600 hover:bg-green-700 font-bold py-3 px-4 rounded-lg",children:"Volver al Trabajo"})]})]})},eR=e=>{let{message:t,type:n,onClose:i}=e;if(!t)return null;return(0,HD.jsxs)("div",{className:"".concat("p-4 mb-4 text-sm rounded-lg relative"," ").concat({error:"bg-red-100 text-red-800",success:"bg-green-100 text-green-800"}[n]),role:"alert",children:[(0,HD.jsx)("span",{className:"font-medium",children:t}),(0,HD.jsx)("button",{onClick:i,className:"absolute top-0 right-0 mt-2 mr-3 text-2xl font-semibold leading-none",children:"\xd7"})]})},tR=(e,t)=>{if(!e)return null;let n=new Date(e),i=0;for(;i<t;){n.setDate(n.getDate()+1);const e=n.getDay();0!==e&&6!==e&&i++}return n},nR=e=>{try{var t,n,i;const s=new hS({ignoreAttributes:!1,attributeNamePrefix:"@_",parseAttributeValue:!0}),r=s.parse(e)["cfdi:Comprobante"],o=r.getAttribute("Fecha");let a=new Date;if(o){const e=o.split("T")[0];a=new Date(e+"T12:00:00")}if(!r)throw new Error("Nodo <cfdi:Comprobante> no encontrado.");const l=null===(t=r["cfdi:Complemento"])||void 0===t?void 0:t["tfd:TimbreFiscalDigital"];if(!l)throw new Error("Nodo <tfd:TimbreFiscalDigital> no encontrado.");let c=0;const u=r["cfdi:Impuestos"];if(u&&u["@_TotalImpuestosTrasladados"])c=u["@_TotalImpuestosTrasladados"];else if(u&&u["cfdi:Traslados"]){const e=u["cfdi:Traslados"];(Array.isArray(e["cfdi:Traslado"])?e["cfdi:Traslado"]:[e["cfdi:Traslado"]]).forEach(e=>{e&&"002"===e["@_Impuesto"]&&(c+=e["@_Importe"])})}return{folio:r["@_Folio"]||"S/F",uuid:l["@_UUID"],subtotal:r["@_SubTotal"],iva:c,monto:r["@_Total"],fechaEmision:a,rfcEmisor:null===(n=r["cfdi:Emisor"])||void 0===n?void 0:n["@_Rfc"],rfcReceptor:null===(i=r["cfdi:Receptor"])||void 0===i?void 0:i["@_Rfc"]}}catch(s){return console.error("Error al parsear el XML:",s),null}},iR=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e)return{totalGenerado:0,tomados:0,disponibles:0,antiguedad:0};const n=Array.isArray(t)?t:[],i=e.toDate(),s=new Date;let r=s.getFullYear()-i.getFullYear();const o=s.getMonth()-i.getMonth();(o<0||0===o&&s.getDate()<i.getDate())&&r--;let a=0;for(let c=1;c<=r+1;c++){let e=0;if(1===c)e=12;else if(2===c)e=14;else if(3===c)e=16;else if(4===c)e=18;else if(5===c)e=20;else{e=20+2*(Math.floor((c-6)/5)+1)}if(c<=r)a+=e;else{const t=new Date(i);t.setFullYear(s.getFullYear()),s<t&&t.setFullYear(s.getFullYear()-1);const n=s.getTime()-t.getTime(),r=e/365*Math.ceil(n/864e5);a+=Math.floor(r)}}const l=n.reduce((e,t)=>e+(Number(t.dias)||0),0);return{totalGenerado:a,tomados:l,disponibles:a-l,antiguedad:r}},sR=()=>{const[e,t]=(0,i.useState)(!0),[n,s]=(0,i.useState)(null);if((0,i.useEffect)(()=>{(async()=>{t(!0);const e=Qg(cg(KD,"facturas"),$g("tipo","==","cliente"),$g("estado","==","Pendiente")),n=(await yy(e)).docs.map(e=>e.data()),i=new Date,r={"0-30 D\xedas":0,"31-60 D\xedas":0,"61-90 D\xedas":0,"+90 D\xedas":0};n.forEach(e=>{const t=e.fechaEmision.toDate(),n=Math.abs(i-t),s=Math.ceil(n/864e5);s<=30?r["0-30 D\xedas"]+=e.monto:s<=60?r["31-60 D\xedas"]+=e.monto:s<=90?r["61-90 D\xedas"]+=e.monto:r["+90 D\xedas"]+=e.monto}),s({labels:Object.keys(r),datasets:[{label:"Monto Pendiente de Cobro",data:Object.values(r),backgroundColor:["rgba(75, 192, 192, 0.6)","rgba(255, 206, 86, 0.6)","rgba(255, 159, 64, 0.6)","rgba(255, 99, 132, 0.6)"],borderColor:["rgba(75, 192, 192, 1)","rgba(255, 206, 86, 1)","rgba(255, 159, 64, 1)","rgba(255, 99, 132, 1)"],borderWidth:1}]}),t(!1)})()},[]),e)return(0,HD.jsx)("p",{children:"Calculando reporte de antig\xfcedad..."});return(0,HD.jsx)("div",{className:"bg-white p-6 rounded-xl shadow-md",children:n&&(0,HD.jsx)(wE,{data:n,options:{indexAxis:"y",responsive:!0,plugins:{legend:{display:!1},title:{display:!0,text:"Monto Pendiente de Cobro por Antig\xfcedad"}}}})})},rR=e=>{let{title:t,message:n,onConfirm:i,onCancel:s,confirmText:r="Confirmar",cancelText:o="Cancelar",confirmColor:a="bg-green-600"}=e;return(0,HD.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-sm",children:[(0,HD.jsx)("h3",{className:"text-lg font-bold mb-4",children:t}),(0,HD.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:n}),(0,HD.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,HD.jsx)("button",{onClick:s,className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded",children:o}),(0,HD.jsx)("button",{onClick:i,className:"".concat(a," hover:opacity-90 text-white font-bold py-2 px-4 rounded"),children:r})]})]})})},oR=e=>{let{project:t,onClose:n,onFinalized:s}=e;const[r,o]=(0,i.useState)([]),[a,l]=(0,i.useState)(t.asignadoTecnicosIds&&t.asignadoTecnicosIds[0]||""),[u,d]=(0,i.useState)(t.fechaEntregaInterna?t.fechaEntregaInterna.toDate().toISOString().split("T")[0]:""),[h,f]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{const e=Qg(cg(KD,"usuarios"),$g("rol","==","tecnico")),t=Qg(cg(KD,"usuarios"),$g("roles","array-contains","tecnico")),[n,i]=await Promise.all([yy(e),yy(t)]),s=new Map;n.forEach(e=>s.set(e.id,c({id:e.id},e.data()))),i.forEach(e=>s.set(e.id,c({id:e.id},e.data()))),o(Array.from(s.values()))})()},[]);return(0,HD.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-md",children:[(0,HD.jsxs)("h3",{className:"text-lg font-bold mb-4",children:["Asignar Proyecto: ",t.npu]}),(0,HD.jsxs)("div",{className:"space-y-4",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"T\xe9cnico Asignado"}),(0,HD.jsx)("div",{className:"mt-2 max-h-48 overflow-y-auto border rounded-md p-2",children:r.map(e=>(0,HD.jsxs)("div",{className:"flex items-center",children:[(0,HD.jsx)("input",{type:"radio",name:"technician",id:e.id,value:e.id,checked:a===e.id,onChange:e=>l(e.target.value),className:"h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"}),(0,HD.jsx)("label",{htmlFor:e.id,className:"ml-3 text-sm text-gray-700",children:e.nombreCompleto})]},e.id))})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Fecha L\xedmite de Entrega (Interna)"}),(0,HD.jsx)("input",{type:"date",value:u,onChange:e=>d(e.target.value),className:"mt-1 block w-full px-3 py-2 border rounded-md"})]})]}),(0,HD.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,HD.jsx)("button",{onClick:n,disabled:h,className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded",children:"Cancelar"}),(0,HD.jsx)("button",{onClick:async()=>{var e;if(!a)return void alert("Debes seleccionar un t\xe9cnico.");f(!0);const i=ug(KD,YD,t.id),r={};r[a]=(null===(e=t.tecnicosStatus)||void 0===e?void 0:e[a])||"No Visto",await by(i,{asignadoTecnicosIds:[a],tecnicosStatus:r,fechaAsignacionTecnico:Sc.now(),fechaEntregaInterna:u?Sc.fromDate(new Date(u)):null}),f(!1),s(),n()},disabled:h,className:"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded",children:h?"Asignando...":"Guardar Asignaci\xf3n"})]})]})})},aR=e=>{let{project:t,onClose:n,onUpdate:s,user:r,userData:o,userRole:a}=e;const[l,u]=(0,i.useState)({prioridad:t.prioridad||"1 - Normal",fechaEntregaInterna:t.fechaEntregaInterna?t.fechaEntregaInterna.toDate().toISOString().split("T")[0]:"",notasSupervisor:t.notasSupervisor||"",precioCotizacionCliente:t.precioCotizacionCliente||"",costoProveedor:t.costoProveedor||"",cotizacionClienteRef:t.cotizacionClienteRef||"",poClienteRef:t.poClienteRef||"",cotizacionProveedorRef:t.cotizacionProveedorRef||""}),[d,h]=(0,i.useState)(!1),[f,p]=(0,i.useState)([]),[m,g]=(0,i.useState)(!0);(0,i.useEffect)(()=>{g(!0);const e=_y(Qg(cg(KD,"bitacoras_proyectos"),$g("projectId","==",t.id),ty("fecha","desc")),e=>{p(e.docs.map(e=>c({id:e.id},e.data()))),g(!1)});return()=>e()},[t.id]);const y=e=>{const{name:t,value:n}=e.target;u(e=>c(c({},e),{},{[t]:n}))};return(0,HD.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg",children:[(0,HD.jsxs)("h3",{className:"text-lg font-bold mb-4",children:["Gestionar Proyecto: ",t.npu]}),(0,HD.jsxs)("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto pr-2",children:["supervisor"===a&&(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"Prioridad"}),(0,HD.jsxs)("select",{name:"prioridad",value:l.prioridad,onChange:y,className:"mt-1 block w-full p-2 border rounded-md",children:[(0,HD.jsx)("option",{value:"1 - Normal",children:"Normal"}),(0,HD.jsx)("option",{value:"2 - Alta",children:"Alta"}),(0,HD.jsx)("option",{value:"3 - Urgente",children:"Urgente"})]})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"Fecha L\xedmite de Entrega"}),(0,HD.jsx)("input",{type:"date",name:"fechaEntregaInterna",value:l.fechaEntregaInterna,onChange:y,className:"mt-1 block w-full p-2 border rounded-md"})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"Notas del Supervisor"}),(0,HD.jsx)("textarea",{name:"notasSupervisor",value:l.notasSupervisor,onChange:y,rows:"8",className:"mt-1 block w-full p-2 border rounded-md"})]})]}),"administrador"===a&&(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,HD.jsx)("input",{type:"number",name:"precioCotizacionCliente",value:l.precioCotizacionCliente,onChange:y,placeholder:"Precio Cliente",className:"px-3 py-2 border rounded-md"}),(0,HD.jsx)("input",{type:"number",name:"costoProveedor",value:l.costoProveedor,onChange:y,placeholder:"Costo Proveedor",className:"px-3 py-2 border rounded-md"})]}),(0,HD.jsx)("input",{type:"text",name:"cotizacionClienteRef",value:l.cotizacionClienteRef,onChange:y,placeholder:"Ref. Cotizaci\xf3n Cliente",className:"w-full px-3 py-2 border rounded-md"}),(0,HD.jsx)("input",{type:"text",name:"poClienteRef",value:l.poClienteRef,onChange:y,placeholder:"Ref. PO Cliente",className:"w-full px-3 py-2 border rounded-md"}),(0,HD.jsx)("input",{type:"text",name:"cotizacionProveedorRef",value:l.cotizacionProveedorRef,onChange:y,placeholder:"Ref. Cotizaci\xf3n Proveedor",className:"w-full px-3 py-2 border rounded-md"})]}),"supervisor"===a&&(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Bit\xe1cora (Solo Lectura)"}),(0,HD.jsx)("div",{className:"bg-gray-50 border rounded-md p-2 h-96 overflow-y-auto space-y-2",children:m?(0,HD.jsx)("p",{children:"Cargando..."}):f.length>0?f.map(e=>(0,HD.jsxs)("div",{className:"text-xs border-b pb-1",children:[(0,HD.jsx)("p",{className:"text-gray-800 whitespace-pre-wrap",children:e.mensaje}),e.adjuntoUrl&&(0,HD.jsx)("a",{href:e.adjuntoUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"Ver adjunto"}),(0,HD.jsxs)("p",{className:"text-gray-500 mt-1 text-right",children:[e.autorNombre," - ",$D(e.fecha)]})]},e.id)):(0,HD.jsx)("p",{className:"text-gray-500",children:"No hay entradas."})})]})]}),(0,HD.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,HD.jsx)("button",{onClick:n,className:"bg-gray-300 hover:bg-gray-400 font-bold py-2 px-4 rounded",children:"Cancelar"}),(0,HD.jsx)("button",{onClick:async()=>{h(!0);const e=ug(KD,YD,t.id),i={};"supervisor"===a?(i.prioridad=l.prioridad,i.fechaEntregaInterna=l.fechaEntregaInterna?Sc.fromDate(new Date(l.fechaEntregaInterna)):null,i.notasSupervisor=l.notasSupervisor):"administrador"===a&&(i.precioCotizacionCliente=Number(l.precioCotizacionCliente)||0,i.costoProveedor=Number(l.costoProveedor)||0,i.cotizacionClienteRef=l.cotizacionClienteRef,i.poClienteRef=l.poClienteRef,i.cotizacionProveedorRef=l.cotizacionProveedorRef);try{Object.keys(i).length>0&&await by(e,i),s(),n(),ZE.success("Proyecto actualizado correctamente.")}catch(r){ZE.error("Error al guardar los cambios."),console.error("Error al guardar:",r)}finally{h(!1)}},disabled:d,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:d?"Guardando...":"Guardar Cambios"})]})]})})},lR=e=>{let{title:t,message:n,onConfirm:s,onCancel:r,confirmText:o="Confirmar",cancelText:a="Cancelar",confirmColor:l="bg-orange-600"}=e;const[c,u]=(0,i.useState)("");return(0,HD.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-md",children:[(0,HD.jsx)("h3",{className:"text-lg font-bold mb-4",children:t}),(0,HD.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:n}),(0,HD.jsx)("textarea",{value:c,onChange:e=>u(e.target.value),placeholder:"Escribe el motivo aqu\xed...",rows:"3",className:"w-full p-2 border rounded-md"}),(0,HD.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,HD.jsx)("button",{onClick:r,className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded",children:a}),(0,HD.jsx)("button",{onClick:()=>s(c),className:"".concat(l," hover:opacity-90 text-white font-bold py-2 px-4 rounded"),children:o})]})]})})},cR=e=>{var t;let{user:n,userData:s,selectedRole:r,setSelectedRole:o,isWorking:a,selectedClientProfile:l,setSelectedClientProfile:u}=e;const d=(null===s||void 0===s?void 0:s.roles)&&s.roles.length>1,h=(null===s||void 0===s?void 0:s.clientesAsociados)&&s.clientesAsociados.length>1,[f,p]=(0,i.useState)([]),[m,g]=(0,i.useState)(!1),y=s&&"cliente"!==s.rol&&"rh"!==s.rol&&"administrador"!==s.rol&&"directivo"!==s.rol&&!(null!==(t=s.roles)&&void 0!==t&&t.includes("administrador"));(0,i.useEffect)(()=>{if(h){const e=async()=>{const e=s.clientesAsociados.map(e=>my(ug(KD,"usuarios",e))),t=await Promise.all(e);p(t.map(e=>c({id:e.id},e.data())))};e()}},[s,h]);return(0,i.useEffect)(()=>{if(null===n||void 0===n||!n.uid)return;const e=new Audio("https://freesound.org/data/previews/131/131660_2398463-lq.mp3"),t=_y(Qg(cg(KD,"notificaciones"),$g("recipientId","==",n.uid),$g("read","==",!1)),t=>{const n=[];if(t.docChanges().forEach(e=>{"added"===e.type&&n.push(c({id:e.doc.id},e.doc.data()))}),n.length>2?(ZE.info("\ud83d\udd14 Tienes ".concat(n.length," notificaciones nuevas sin leer.")),e.play().catch(e=>console.log("La interacci\xf3n del usuario es necesaria para reproducir sonido."))):n.forEach((t,n)=>{setTimeout(()=>{ZE.info("\ud83d\udd14 ".concat(t.message)),e.play().catch(e=>console.log("La interacci\xf3n del usuario es necesaria para reproducir sonido."))},1e3*n)}),n.length>0){const e=(pg(i=ig(i=KD,fg)),new ky(i,e=>wy(i,e)));n.forEach(t=>{const n=ug(KD,"notificaciones",t.id);e.update(n,{read:!0})}),e.commit()}var i});return()=>t()},[n]),(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsx)("header",{className:"bg-white shadow-md sticky top-0 z-40",children:(0,HD.jsxs)("div",{className:"max-w-7xl mx-auto py-3 px-4 sm:px-6 lg:px-8 flex justify-between items-center",children:[(0,HD.jsx)("div",{className:"flex items-center",children:l&&"cliente"===l.rol&&l.logoUrl?(0,HD.jsx)("img",{src:l.logoUrl,onError:e=>{e.target.onerror=null,e.target.src="https://placehold.co/150x50/FFFFFF/000000?text=Logo+Cliente"},alt:"Logo Cliente",className:"h-12 w-auto mr-4 object-contain"}):(0,HD.jsx)("img",{src:"https://www.grupoevelsa.com/assets/images/Logo Evelsa 2.png",alt:"Logo Grupo Evelsa",className:"h-12 w-auto mr-4"})}),n&&(0,HD.jsxs)("div",{className:"flex items-center space-x-4",children:[y?(0,HD.jsxs)("button",{onClick:()=>g(!0),className:"text-gray-600 hidden sm:flex items-center hover:text-blue-600 hover:bg-blue-50 px-2 py-1 rounded transition",title:"Ver Perfil y Vacaciones",children:[(0,HD.jsxs)("span",{className:"font-medium",children:["Hola, ",s?s.nombreCompleto.split(" ")[0]:n.email]}),(0,HD.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 ml-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,HD.jsx)("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})]}):(0,HD.jsxs)("span",{className:"text-gray-600 hidden sm:flex items-center px-2 py-1 font-medium cursor-default",children:["Hola, ",s?s.nombreCompleto.split(" ")[0]:n.email]}),d&&(0,HD.jsx)("div",{className:"relative",children:(0,HD.jsx)("select",{value:r,onChange:e=>o(e.target.value),className:"appearance-none bg-gray-100 border border-gray-300 rounded-md py-2 pl-3 pr-8 text-sm font-medium text-gray-700 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:s.roles.map(e=>(0,HD.jsx)("option",{value:e,className:"capitalize",children:e.charAt(0).toUpperCase()+e.slice(1)},e))})}),h&&"cliente"===r&&(0,HD.jsx)("div",{className:"relative",children:(0,HD.jsx)("select",{value:(null===l||void 0===l?void 0:l.id)||"",onChange:async e=>{const t=e.target.value,n=f.find(e=>e.id===t);u(n)},className:"appearance-none bg-gray-100 border border-gray-300 rounded-md py-2 pl-3 pr-8 text-sm font-medium text-gray-700 hover:bg-gray-200",children:f.map(e=>(0,HD.jsx)("option",{value:e.id,children:e.planta||e.nombreCompleto},e.id))})}),(0,HD.jsx)("button",{onClick:()=>{vi(GD)},disabled:a,className:"font-bold py-2 px-4 rounded-lg transition duration-300 ".concat(a?"bg-gray-400 text-gray-700 cursor-not-allowed":"bg-red-600 hover:bg-red-700 text-white"),title:a?"Debes 'Finalizar D\xeda' antes de salir":"Cerrar sesi\xf3n",children:"Salir"})]})]})}),m&&s&&y&&(0,HD.jsx)(gR,{user:n,userData:s,onClose:()=>g(!1)})]})},uR=e=>{let{project:t,user:n,userData:s,onClose:r,selectedRole:o}=e;const[a,l]=(0,i.useState)([]),[u,d]=(0,i.useState)(""),[h,f]=(0,i.useState)(!0),[p,m]=(0,i.useState)(!1),[g,y]=(0,i.useState)(""),v="supervisor"!==o;(0,i.useEffect)(()=>{const e=_y(Qg(cg(KD,"bitacoras_proyectos"),$g("projectId","==",t.id),ty("fecha","asc")),e=>{l(e.docs.map(e=>c({id:e.id},e.data()))),f(!1)},e=>{console.error("Error fetching log entries:",e),y("No se pudo cargar la bit\xe1cora."),f(!1)});return()=>e()},[t.id]);return(0,HD.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl h-[90vh] flex flex-col",children:[(0,HD.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,HD.jsxs)("h3",{className:"text-lg font-bold",children:["Bit\xe1cora del Proyecto: ",t.npu]}),(0,HD.jsx)("button",{onClick:r,className:"text-gray-600 hover:text-gray-900 text-2xl font-bold",children:"\xd7"})]}),(0,HD.jsx)("div",{className:"flex-grow overflow-y-auto border rounded-md p-4 space-y-4 mb-4 bg-gray-50",children:h?(0,HD.jsx)("p",{children:"Cargando bit\xe1cora..."}):0===a.length?(0,HD.jsx)("p",{children:"No hay entradas en la bit\xe1cora."}):a.map(e=>{return(0,HD.jsxs)("div",{className:"p-3 bg-white rounded-lg shadow-sm",children:[(0,HD.jsx)("p",{className:"text-sm text-gray-800 whitespace-pre-wrap",children:e.mensaje}),(0,HD.jsxs)("p",{className:"text-xs text-gray-500 mt-2 text-right",children:[e.autorNombre," - ",(t=e.fecha,t?new Date(1e3*t.seconds).toLocaleString("es-MX"):"---")]})]},e.id);var t})}),v&&(0,HD.jsxs)("div",{className:"border-t pt-4",children:[(0,HD.jsx)("textarea",{value:u,onChange:e=>d(e.target.value),placeholder:"A\xf1adir nueva nota...",rows:"3",className:"w-full p-2 border rounded-md"}),(0,HD.jsx)(eR,{message:g,type:"error",onClose:()=>y("")}),(0,HD.jsx)("button",{onClick:async()=>{if(u.trim()){m(!0),y("");try{await xy(cg(KD,"bitacoras_proyectos"),{projectId:t.id,autorId:n.uid,autorNombre:s.nombreCompleto,mensaje:u,fecha:Sc.now()}),d("");const e=document.getElementById("file-input-".concat(t.id));e&&(e.value="")}catch(e){console.error("Error al guardar en bit\xe1cora:",e),y("No se pudo guardar la nota. Por favor, intente de nuevo.")}finally{m(!1)}}},disabled:p,className:"w-full mt-2 bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg disabled:bg-gray-300",children:p?"Guardando...":"A\xf1adir a la Bit\xe1cora"})]})]})})},dR=()=>{const[e,t]=(0,i.useState)([]),[n,s]=(0,i.useState)({nombre:"",servicioIdNumerico:"",dependencia:"",durationType:"fixed",totalHoras:"",baseHoras:"",porUnidad:"",nombreUnidad:""}),[r,o]=(0,i.useState)(!0),[a,l]=(0,i.useState)(""),[u,d]=(0,i.useState)("");(0,i.useEffect)(()=>{const e=_y(Qg(cg(KD,"servicios")),e=>{t(e.docs.map(e=>c({id:e.id},e.data()))),o(!1)},e=>{l("No se pudieron cargar los servicios."),o(!1)});return()=>e()},[]);const h=e=>{const{name:t,value:n,type:i}=e.target;s(e=>c(c({},e),{},{[t]:n}))},f=e=>{const t=e.calculoDuracion;return t?t.totalHoras?"".concat(t.totalHoras,"h Total"):void 0!==t.baseHoras?"".concat(t.baseHoras,"h + ").concat(t.porUnidad,"h/").concat(t.nombreUnidad||"unidad"):"Inv\xe1lido":"N/A"};return(0,HD.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-lg border",children:[(0,HD.jsx)("h3",{className:"text-xl font-bold mb-4",children:"A\xf1adir Nuevo Servicio"}),(0,HD.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),l(""),d(""),!n.nombre||!n.servicioIdNumerico||!n.dependencia)return void l("Nombre, ID Num\xe9rico y Dependencia son obligatorios.");let t={};if("fixed"===n.durationType){if(!n.totalHoras)return void l("Debe especificar las horas totales para duraci\xf3n fija.");t={totalHoras:Number(n.totalHoras)}}else{if(!n.baseHoras||!n.porUnidad||!n.nombreUnidad)return void l("Horas base, valor por unidad y nombre de unidad son obligatorios para duraci\xf3n variable.");t={baseHoras:Number(n.baseHoras),porUnidad:Number(n.porUnidad),nombreUnidad:n.nombreUnidad}}try{await xy(cg(KD,"servicios"),{nombre:n.nombre,servicioIdNumerico:n.servicioIdNumerico,dependencia:n.dependencia,calculoDuracion:t}),d("\xa1Servicio '".concat(n.nombre,"' a\xf1adido con \xe9xito!")),s({nombre:"",servicioIdNumerico:"",dependencia:"",durationType:"fixed",totalHoras:"",baseHoras:"",porUnidad:"",nombreUnidad:""})}catch(i){l("Error al a\xf1adir el servicio: ".concat(i.message))}},className:"space-y-4",children:[(0,HD.jsx)("input",{type:"text",name:"nombre",value:n.nombre,onChange:h,placeholder:"Nombre del Servicio",className:"w-full p-2 border rounded",required:!0}),(0,HD.jsx)("input",{type:"text",name:"servicioIdNumerico",value:n.servicioIdNumerico,onChange:h,placeholder:"ID Num\xe9rico (ej: 0001)",className:"w-full p-2 border rounded",required:!0}),(0,HD.jsx)("input",{type:"text",name:"dependencia",value:n.dependencia,onChange:h,placeholder:"Dependencia",className:"w-full p-2 border rounded",required:!0}),(0,HD.jsxs)("fieldset",{className:"border p-3 rounded",children:[(0,HD.jsx)("legend",{className:"text-sm font-medium",children:"Tipo de Duraci\xf3n"}),(0,HD.jsxs)("div",{className:"flex space-x-4",children:[(0,HD.jsxs)("label",{children:[(0,HD.jsx)("input",{type:"radio",name:"durationType",value:"fixed",checked:"fixed"===n.durationType,onChange:h})," Fija"]}),(0,HD.jsxs)("label",{children:[(0,HD.jsx)("input",{type:"radio",name:"durationType",value:"variable",checked:"variable"===n.durationType,onChange:h})," Variable"]})]})]}),"fixed"===n.durationType&&(0,HD.jsx)("input",{type:"number",name:"totalHoras",value:n.totalHoras,onChange:h,placeholder:"Horas Totales Estimadas",className:"w-full p-2 border rounded"}),"variable"===n.durationType&&(0,HD.jsxs)("div",{className:"space-y-2 border p-3 rounded bg-gray-50",children:[(0,HD.jsx)("input",{type:"number",name:"baseHoras",value:n.baseHoras,onChange:h,placeholder:"Horas Base",className:"w-full p-2 border rounded"}),(0,HD.jsx)("input",{type:"number",step:"0.01",name:"porUnidad",value:n.porUnidad,onChange:h,placeholder:"Horas por Unidad (ej: 0.75)",className:"w-full p-2 border rounded"}),(0,HD.jsx)("input",{type:"text",name:"nombreUnidad",value:n.nombreUnidad,onChange:h,placeholder:"Nombre de la Unidad (ej: punto, foto)",className:"w-full p-2 border rounded"})]}),(0,HD.jsx)(eR,{message:a,type:"error",onClose:()=>l("")}),(0,HD.jsx)(eR,{message:u,type:"success",onClose:()=>d("")}),(0,HD.jsx)("button",{type:"submit",className:"w-full bg-[#b0ef26] hover:bg-[#9ac91e] font-bold py-2 px-4 rounded",children:"A\xf1adir Servicio"})]})]}),(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-lg border",children:[(0,HD.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Servicios Existentes"}),(0,HD.jsx)("div",{className:"overflow-y-auto max-h-96",children:(0,HD.jsxs)("table",{className:"min-w-full divide-y",children:[(0,HD.jsx)("thead",{className:"bg-gray-50",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"Nombre"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"ID Num."}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"Dependencia"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"Duraci\xf3n Estimada"})]})}),(0,HD.jsx)("tbody",{className:"bg-white divide-y",children:r?(0,HD.jsx)("tr",{children:(0,HD.jsx)("td",{colSpan:"4",children:"Cargando..."})}):e.map(e=>(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("td",{className:"px-4 py-2 text-sm",children:e.nombre}),(0,HD.jsx)("td",{className:"px-4 py-2 text-sm",children:e.servicioIdNumerico}),(0,HD.jsx)("td",{className:"px-4 py-2 text-sm",children:e.dependencia}),(0,HD.jsx)("td",{className:"px-4 py-2 text-sm",children:f(e)})]},e.id))})]})})]})]})},hR=e=>{let{onUserAdded:t}=e;const[n,s]=(0,i.useState)(""),[r,o]=(0,i.useState)(""),[a,l]=(0,i.useState)(""),[c,u]=(0,i.useState)("cliente"),[d,h]=(0,i.useState)(""),[f,p]=(0,i.useState)(""),[m,g]=(0,i.useState)(""),[y,v]=(0,i.useState)("");return(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[(0,HD.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Crear Nuevo Usuario"}),(0,HD.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),g(""),v(""),a&&n&&r)if("cliente"!==c||d)try{const e=As(gt(qD,"Secondary-".concat((new Date).getTime()))),i=await async function(e,t,n){var i;const s=Bn(e),r={returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"};let o;if(null===(i=s._getRecaptchaConfig())||void 0===i?void 0:i.emailPasswordEnabled){const e=await zn(s,r,"signUpPassword");o=ci(s,e)}else o=ci(s,r).catch(async e=>{if(e.code==="auth/".concat("missing-recaptcha-token")){console.log("Sign-up is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-up flow.");const e=await zn(s,r,"signUpPassword");return ci(s,e)}return Promise.reject(e)});const a=await o.catch(e=>Promise.reject(e)),l=await ui._fromIdTokenResponse(s,"signIn",a);return await s._updateCurrentUser(l.user),l}(e,n,r);await vy(ug(KD,"usuarios",i.user.uid),{email:n,rol:c,nombreCompleto:a,clienteIdNumerico:"cliente"===c?d.padStart(3,"0"):"",logoUrl:"cliente"===c?f:""}),v("\xa1Usuario ".concat(n," con rol '").concat(c,"' creado con \xe9xito!")),s(""),o(""),l(""),u("cliente"),h(""),p(""),t&&t()}catch(i){g("Error al crear usuario: ".concat(i.message))}else g("Para clientes, el ID Num\xe9rico es obligatorio.");else g("Nombre, email y contrase\xf1a son obligatorios.")},className:"space-y-4",children:[(0,HD.jsx)("input",{type:"text",value:a,onChange:e=>l(e.target.value),placeholder:"Nombre Completo",className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"}),(0,HD.jsxs)("select",{value:c,onChange:e=>u(e.target.value),className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm",children:[(0,HD.jsx)("option",{value:"cliente",children:"Cliente"}),(0,HD.jsx)("option",{value:"administrador",children:"Administrador"}),(0,HD.jsx)("option",{value:"directivo",children:"Directivo"}),(0,HD.jsx)("option",{value:"ecotech",children:"Encargada Ecotech"}),(0,HD.jsx)("option",{value:"supervisor",children:"Supervisor de Proyectos"}),(0,HD.jsx)("option",{value:"tecnico",children:"T\xe9cnico"}),(0,HD.jsx)("option",{value:"finanzas",children:"Finanzas"}),(0,HD.jsx)("option",{value:"practicante",children:"Practicante"})]}),(0,HD.jsx)("input",{type:"email",value:n,onChange:e=>s(e.target.value),placeholder:"Email de Acceso",className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"}),(0,HD.jsx)("input",{type:"password",value:r,onChange:e=>o(e.target.value),placeholder:"Contrase\xf1a (m\xednimo 6 caracteres)",className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"}),"cliente"===c&&(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsx)("input",{type:"text",value:d,onChange:e=>h(e.target.value),placeholder:"ID Num\xe9rico Cliente (ej: 001)",className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"}),(0,HD.jsx)("input",{type:"text",value:f,onChange:e=>p(e.target.value),placeholder:"URL del Logo (Opcional)",className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"})]}),(0,HD.jsx)(eR,{message:m,type:"error",onClose:()=>g("")}),(0,HD.jsx)(eR,{message:y,type:"success",onClose:()=>v("")}),(0,HD.jsx)("button",{type:"submit",className:"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg",children:"Crear Usuario"})]})]})},fR=e=>{let{collectionName:t,title:n,fields:s,placeholderTexts:r}=e;const[o,a]=(0,i.useState)([]),[l,u]=(0,i.useState)({}),[d,h]=(0,i.useState)(!0),[f,p]=(0,i.useState)(""),[m,g]=(0,i.useState)("");(0,i.useEffect)(()=>{const e=_y(Qg(cg(KD,t)),e=>{const t=e.docs.map(e=>c({id:e.id},e.data()));a(t),h(!1)},e=>{console.error("Error fetching ".concat(t,":"),e),p("No se pudieron cargar los datos de ".concat(n,".")),h(!1)});return()=>e()},[t,n]);const y=e=>{const{name:t,value:n}=e.target;u(e=>c(c({},e),{},{[t]:n}))};return(0,HD.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[(0,HD.jsxs)("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:["A\xf1adir Nuevo ",n.slice(0,-1)]}),(0,HD.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),s.some(e=>!l[e]))p("Todos los campos son obligatorios.");else{p(""),g("");try{await xy(cg(KD,t),l),g("\xa1".concat(n.slice(0,-1)," a\xf1adido con \xe9xito!")),u({})}catch(i){p("Error al a\xf1adir el nuevo \xedtem: ".concat(i.message))}}},className:"space-y-4",children:[s.map((e,t)=>(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium text-gray-700 capitalize",children:e.replace(/([A-Z])/g," $1")}),(0,HD.jsx)("input",{type:"text",name:e,value:l[e]||"",onChange:y,placeholder:r[t],className:"mt-1 block w-full px-3 py-2 border rounded-md"})]},e)),(0,HD.jsx)(eR,{message:f,type:"error",onClose:()=>p("")}),(0,HD.jsx)(eR,{message:m,type:"success",onClose:()=>g("")}),(0,HD.jsx)("button",{type:"submit",className:"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg",children:"A\xf1adir"})]})]}),(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[(0,HD.jsxs)("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:[n," Existentes"]}),(0,HD.jsx)("div",{className:"overflow-y-auto max-h-96",children:(0,HD.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,HD.jsx)("thead",{className:"bg-gray-50",children:(0,HD.jsx)("tr",{children:s.map(e=>(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:e.replace(/([A-Z])/g," $1")},e))})}),(0,HD.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:d?(0,HD.jsx)("tr",{children:(0,HD.jsx)("td",{colSpan:s.length,children:"Cargando..."})}):o.map(e=>(0,HD.jsx)("tr",{children:s.map(t=>(0,HD.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:e[t]},"".concat(e.id,"-").concat(t)))},e.id))})]})})]})]})},pR=()=>{const[e,t]=(0,i.useState)([]),[n,s]=(0,i.useState)([]),[r,o]=(0,i.useState)(null),[a,l]=(0,i.useState)({fecha:"",acumulados:0,tomadosManual:0}),[u,d]=(0,i.useState)(null);(0,i.useEffect)(()=>{const e=_y(Qg(cg(KD,"usuarios")),e=>{const n=e.docs.map(e=>c({id:e.id},e.data())).filter(e=>{var t;if("cliente"===e.rol||null!==(t=e.roles)&&void 0!==t&&t.includes("cliente"))return!1;const n=["tecnico","supervisor","practicante","ecotech"],i=n.includes(e.rol)||e.roles&&e.roles.some(e=>n.includes(e));return i});t(n)}),n=_y(Qg(cg(KD,"solicitudesVacaciones"),Zg($g("estado","==","Pendiente RH"),$g("estado","==","Pendiente Supervisor"))),e=>{const t=e.docs.map(e=>c({id:e.id},e.data())).filter(e=>"Pendiente RH"===e.estado||"Pendiente Supervisor"===e.estado&&"supervisor"===e.rol);s(t)});return()=>{e(),n()}},[]);return(0,HD.jsxs)("div",{children:[(0,HD.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Gesti\xf3n de Recursos Humanos"}),(0,HD.jsxs)("div",{className:"mb-8",children:[(0,HD.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Solicitudes Pendientes"}),(0,HD.jsx)(yR,{requests:n,viewerRole:"rh",onActionComplete:()=>{}})]}),(0,HD.jsxs)("div",{className:"bg-white rounded-xl shadow overflow-hidden",children:[(0,HD.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 bg-gray-50",children:(0,HD.jsx)("h2",{className:"text-lg font-semibold text-gray-700",children:"N\xf3mina de Empleados"})}),(0,HD.jsx)("div",{className:"overflow-x-auto",children:(0,HD.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,HD.jsx)("thead",{className:"bg-gray-50",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Empleado"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fecha Ingreso"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase bg-green-50",children:"Saldo Disponible"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),(0,HD.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(e=>{const t=iR(e.fechaIngreso,e.historialVacaciones||[]);return(0,HD.jsxs)("tr",{children:[(0,HD.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap font-medium text-gray-900",children:[e.nombreCompleto,(0,HD.jsxs)("div",{className:"text-xs text-gray-500 font-normal",children:["Antig\xfcedad: ",t.antiguedad," a\xf1os"]})]}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600",children:r===e.id?(0,HD.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,HD.jsx)("input",{type:"date",className:"border rounded p-1 text-xs w-32",value:a.fecha,onChange:e=>l(c(c({},a),{},{fecha:e.target.value}))}),(0,HD.jsx)("button",{onClick:()=>(async e=>{const t=ug(KD,"usuarios",e);try{const e={diasAcumuladosAnteriores:Number(a.acumulados)||0,diasTomadosManuales:Number(a.tomadosManual)||0};a.fecha&&(e.fechaIngreso=Sc.fromDate(new Date(a.fecha+"T12:00:00"))),await by(t,e),o(null),ZE.success("Datos actualizados")}catch(PS){console.error("Error:",PS),alert("No se pudieron actualizar los datos.")}})(e.id),className:"text-green-600 font-bold",children:"\u2713"}),(0,HD.jsx)("button",{onClick:()=>o(null),className:"text-red-600",children:"\u2715"})]}):(0,HD.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,HD.jsx)("span",{children:e.fechaIngreso?e.fechaIngreso.toDate().toLocaleDateString("es-MX"):"---"}),(0,HD.jsx)("button",{onClick:()=>o(e.id),className:"text-gray-400 hover:text-blue-600",children:"\u270f\ufe0f"})]})}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold text-center bg-green-50 text-green-700 text-lg",children:e.fechaIngreso?t.disponibles:"-"}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,HD.jsx)("button",{onClick:()=>d(e),className:"text-blue-600 hover:text-blue-900 font-semibold",children:"Ver Bit\xe1cora / Ajustar"})})]},e.id)})})]})})]}),u&&(0,HD.jsx)(mR,{employee:u,onClose:()=>d(null),onUpdate:()=>{}})]})},mR=e=>{let{employee:t,onClose:n,onUpdate:s}=e;const[r,o]=(0,i.useState)(""),[a,l]=(0,i.useState)(""),[c,u]=(0,i.useState)(""),[d,h]=(0,i.useState)(!1),f=(t.historialVacaciones||[]).sort((e,t)=>t.fechaInicio.seconds-e.fechaInicio.seconds),p=e=>e?e.toDate().toLocaleDateString("es-MX"):"-";return(0,HD.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-3xl h-[80vh] flex flex-col",children:[(0,HD.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("h3",{className:"text-lg font-bold",children:"Historial de Vacaciones"}),(0,HD.jsx)("p",{className:"text-sm text-gray-600",children:t.nombreCompleto})]}),(0,HD.jsx)("button",{onClick:n,className:"text-gray-500 hover:text-gray-800 text-2xl font-bold",children:"\xd7"})]}),(0,HD.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 flex-grow overflow-hidden",children:[(0,HD.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border overflow-y-auto",children:[(0,HD.jsx)("h4",{className:"font-bold text-sm text-gray-700 mb-3",children:"Agregar Registro Manual"}),(0,HD.jsxs)("div",{className:"space-y-3",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-xs font-bold text-gray-500",children:"Desde"}),(0,HD.jsx)("input",{type:"date",value:r,onChange:e=>o(e.target.value),className:"w-full p-2 border rounded-md text-sm"})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-xs font-bold text-gray-500",children:"Hasta"}),(0,HD.jsx)("input",{type:"date",value:a,onChange:e=>l(e.target.value),className:"w-full p-2 border rounded-md text-sm"})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-xs font-bold text-gray-500",children:"Motivo"}),(0,HD.jsx)("input",{type:"text",value:c,onChange:e=>u(e.target.value),className:"w-full p-2 border rounded-md text-sm"})]}),(0,HD.jsx)("button",{onClick:async()=>{if(!r||!a)return alert("Fechas requeridas");const e=new Date(r+"T12:00:00"),n=new Date(a+"T12:00:00");if(n<e)return alert("La fecha fin no puede ser antes de la inicio");const i=JD(e,n);if(0===i)return alert("El rango seleccionado no tiene d\xedas h\xe1biles.");h(!0);try{const r=ug(KD,"usuarios",t.id),a={id:Date.now().toString(),fechaInicio:Sc.fromDate(e),fechaFin:Sc.fromDate(n),dias:i,motivo:c||"Registro Manual RH",tipo:"Manual (RH)",fechaRegistro:Sc.now()};await by(r,{historialVacaciones:Py(a)}),ZE.success("Registrados ".concat(i," d\xedas h\xe1biles.")),s(),o(""),l(""),u("")}catch(PS){console.error(PS),ZE.error("Error al guardar.")}finally{h(!1)}},disabled:d,className:"w-full bg-blue-600 text-white font-bold py-2 rounded-md text-sm hover:bg-blue-700",children:d?"Guardando...":"Registrar"}),(0,HD.jsx)("p",{className:"text-xs text-gray-500 mt-2 italic",children:"* Se descontar\xe1n solo los d\xedas h\xe1biles (L-V)."})]})]}),(0,HD.jsxs)("div",{className:"md:col-span-2 overflow-y-auto pr-2",children:[(0,HD.jsx)("h4",{className:"font-bold text-sm text-gray-700 mb-3",children:"Bit\xe1cora de D\xedas Tomados"}),0===f.length?(0,HD.jsx)("p",{className:"text-gray-400 text-sm text-center mt-10",children:"Sin registros."}):(0,HD.jsxs)("table",{className:"min-w-full text-sm",children:[(0,HD.jsx)("thead",{className:"bg-gray-100 sticky top-0",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-600",children:"Fechas"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-center font-medium text-gray-600",children:"D\xedas"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left font-medium text-gray-600",children:"Motivo/Origen"})]})}),(0,HD.jsx)("tbody",{className:"divide-y",children:f.map((e,t)=>(0,HD.jsxs)("tr",{children:[(0,HD.jsxs)("td",{className:"px-4 py-2 text-gray-800",children:[p(e.fechaInicio)," - ",p(e.fechaFin)]}),(0,HD.jsxs)("td",{className:"px-4 py-2 text-center font-bold text-red-600",children:["-",e.dias]}),(0,HD.jsxs)("td",{className:"px-4 py-2 text-gray-600",children:[e.motivo," ",(0,HD.jsxs)("span",{className:"text-xs text-gray-400 block",children:["(",e.tipo,")"]})]})]},t))})]})]})]})]})})},gR=e=>{let{user:t,userData:n,onClose:s}=e;const[r,o]=(0,i.useState)(""),[a,l]=(0,i.useState)(""),[u,d]=(0,i.useState)(""),[h,f]=(0,i.useState)(!1),[p,m]=(0,i.useState)([]);(0,i.useEffect)(()=>{const e=_y(Qg(cg(KD,"solicitudesVacaciones"),$g("uid","==",t.uid)),e=>{const t=e.docs.map(e=>c({id:e.id},e.data()));m(t)});return()=>e()},[t.uid]);const g=i.useMemo(()=>iR(n.fechaIngreso,n.historialVacaciones||[]),[n]),y=i.useMemo(()=>p.filter(e=>e.estado&&e.estado.includes("Pendiente")).reduce((e,t)=>e+(Number(t.diasSolicitados)||0),0),[p]),v=g.disponibles-y,{upcoming:b,history:x}=i.useMemo(()=>{const e=new Date;e.setHours(0,0,0,0);let t=[],i=[],s=[],r=[];p.forEach(e=>{"Rechazado"===e.estado?i.push({id:e.id,fechaInicio:e.fechaInicio,fechaFin:e.fechaFin,dias:e.diasSolicitados,motivo:e.motivo,estado:"Rechazado",motivoRechazo:e.motivoRechazo,tipo:"Solicitud"}):e.estado&&e.estado.includes("Pendiente")&&t.push({id:e.id,fechaInicio:e.fechaInicio,fechaFin:e.fechaFin,dias:e.diasSolicitados,motivo:e.motivo,estado:e.estado,isPending:!0,tipo:"Solicitud"})});(n.historialVacaciones||[]).forEach(t=>{const n=t.fechaFin.toDate();n.setHours(0,0,0,0),n>=e?s.push(c(c({},t),{},{estado:"Aprobado (Agendado)"})):r.push(c(c({},t),{},{estado:"Completado"}))});const o=[...t,...s].sort((e,t)=>e.fechaInicio.seconds-t.fechaInicio.seconds),a=[...i,...r].sort((e,t)=>t.fechaInicio.seconds-e.fechaInicio.seconds);return{upcoming:o,history:a}},[p,n.historialVacaciones]),_=e=>e?e.toDate().toLocaleDateString("es-MX"):"",w=e=>"Rechazado"===e?"bg-red-50 border-red-200":e&&e.includes("Pendiente")?"bg-yellow-50 border-yellow-200":e&&e.includes("Aprobado")?"bg-green-50 border-green-200":"bg-white border-gray-200";return(0,HD.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl h-[85vh] flex flex-col",children:[(0,HD.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,HD.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"Mis Vacaciones"}),(0,HD.jsx)("button",{onClick:s,className:"text-gray-500 hover:text-gray-800 text-2xl font-bold",children:"\xd7"})]}),(0,HD.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-700 rounded-xl p-6 text-white shadow-lg mb-6",children:(0,HD.jsxs)("div",{className:"flex justify-between items-start",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("p",{className:"text-blue-100 text-sm font-medium",children:"Disponibles"}),(0,HD.jsx)("p",{className:"text-5xl font-bold mt-1",children:v}),(0,HD.jsx)("p",{className:"text-xs text-blue-200 mt-1",children:"D\xedas h\xe1biles"})]}),(0,HD.jsxs)("div",{className:"text-right text-sm text-blue-100 space-y-1",children:[(0,HD.jsxs)("p",{children:["Correspondientes: ",(0,HD.jsx)("span",{className:"font-bold text-white",children:g.totalGenerado})]}),(0,HD.jsxs)("p",{children:["Tomados: ",(0,HD.jsxs)("span",{className:"font-bold text-white",children:["-",g.tomados]})]}),y>0&&(0,HD.jsxs)("p",{className:"text-yellow-300 font-bold bg-white/10 px-2 py-0.5 rounded inline-block",children:["En Tr\xe1mite: -",y]})]})]})}),(0,HD.jsxs)("div",{className:"flex-grow overflow-y-auto pr-2 space-y-6",children:[(0,HD.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border",children:[(0,HD.jsx)("h4",{className:"font-bold text-gray-700 mb-3",children:"Nueva Solicitud"}),n.fechaIngreso?(0,HD.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-xs font-bold text-gray-500",children:"Desde"}),(0,HD.jsx)("input",{type:"date",value:r,onChange:e=>o(e.target.value),className:"w-full p-2 border rounded-md"})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-xs font-bold text-gray-500",children:"Hasta"}),(0,HD.jsx)("input",{type:"date",value:a,onChange:e=>l(e.target.value),className:"w-full p-2 border rounded-md"})]}),(0,HD.jsx)("div",{className:"md:col-span-2",children:(0,HD.jsx)("input",{type:"text",value:u,onChange:e=>d(e.target.value),placeholder:"Motivo (Opcional)",className:"w-full p-2 border rounded-md"})}),(0,HD.jsx)("div",{className:"md:col-span-2",children:(0,HD.jsx)("button",{onClick:async()=>{if(!r||!a)return ZE.error("Fechas incompletas");const e=new Date(r+"T12:00:00"),i=new Date(a+"T12:00:00");if(i<e)return ZE.error("Fecha fin inv\xe1lida");const s=JD(e,i);if(0===s)return ZE.error("No hay d\xedas h\xe1biles.");if(s>v)return ZE.error("Saldo insuficiente. Disponibles: ".concat(v," d\xedas."));f(!0);try{var c;await xy(cg(KD,"solicitudesVacaciones"),{uid:t.uid,nombre:n.nombreCompleto,rol:n.rol||(null===(c=n.roles)||void 0===c?void 0:c[0]),fechaSolicitud:Sc.now(),fechaInicio:Sc.fromDate(e),fechaFin:Sc.fromDate(i),diasSolicitados:s,motivo:u,estado:"Pendiente Supervisor",aprobadoSupervisor:!1,aprobadoRH:!1}),ZE.success("Solicitud enviada."),o(""),l(""),d("")}catch(PS){ZE.error("Error al solicitar.")}finally{f(!1)}},disabled:h,className:"w-full bg-blue-600 text-white font-bold py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50",children:h?"Enviando...":"Solicitar"})})]}):(0,HD.jsx)("p",{className:"text-red-500 text-sm",children:"Sin fecha de ingreso. Contacta a RH."})]}),b.length>0&&(0,HD.jsxs)("div",{children:[(0,HD.jsx)("h4",{className:"font-bold text-gray-700 mb-2 text-sm uppercase tracking-wide",children:"Pr\xf3ximas / En Tr\xe1mite"}),(0,HD.jsx)("div",{className:"space-y-2",children:b.map((e,t)=>(0,HD.jsxs)("div",{className:"border rounded-lg p-3 flex justify-between items-center ".concat(w(e.estado)),children:[(0,HD.jsxs)("div",{children:[(0,HD.jsxs)("p",{className:"font-bold text-gray-800",children:[_(e.fechaInicio)," - ",_(e.fechaFin)]}),(0,HD.jsxs)("p",{className:"text-xs text-gray-600",children:[e.dias||e.diasSolicitados," d\xedas \u2022 ",e.motivo]})]}),(0,HD.jsx)("div",{className:"text-right",children:(0,HD.jsx)("span",{className:"px-2 py-1 text-xs font-bold rounded-full ".concat(e.isPending?"bg-yellow-200 text-yellow-900":"bg-green-200 text-green-900"),children:e.estado})})]},t))})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("h4",{className:"font-bold text-gray-700 mb-2 text-sm uppercase tracking-wide",children:"Historial"}),0===x.length?(0,HD.jsx)("p",{className:"text-gray-400 text-sm italic",children:"Sin historial."}):(0,HD.jsx)("div",{className:"space-y-2",children:x.map((e,t)=>(0,HD.jsxs)("div",{className:"border rounded-lg p-3 flex justify-between items-start ".concat(w(e.estado)),children:[(0,HD.jsxs)("div",{children:[(0,HD.jsxs)("p",{className:"font-medium ".concat("Rechazado"===e.estado?"text-red-800":"text-gray-800"),children:[_(e.fechaInicio)," - ",_(e.fechaFin)]}),(0,HD.jsx)("p",{className:"text-xs text-gray-500",children:e.motivo}),"Rechazado"===e.estado&&e.motivoRechazo&&(0,HD.jsxs)("div",{className:"mt-1 text-xs text-red-600 font-semibold bg-white px-2 py-1 rounded border border-red-100 inline-block",children:["Motivo: ",e.motivoRechazo]})]}),(0,HD.jsx)("div",{className:"text-right",children:"Rechazado"===e.estado?(0,HD.jsx)("span",{className:"text-xs font-bold text-red-600 bg-red-100 px-2 py-1 rounded",children:"Rechazado"}):(0,HD.jsxs)("p",{className:"font-bold text-gray-500",children:["-",e.dias]})})]},t))})]})]})]})})},yR=e=>{let{requests:t,viewerRole:n,onActionComplete:s}=e;const[r,o]=(0,i.useState)(null),[a,l]=(0,i.useState)(null),c=(e,t)=>{"approve"===t?o({type:"approve",request:e,title:"Aprobar Solicitud",message:"\xbfDeseas aprobar esta solicitud?"}):"reject"===t&&o({type:"reject",request:e,title:"Rechazar Solicitud",message:"Indica el motivo del rechazo para notificar al empleado:",confirmText:"Rechazar Solicitud",confirmColor:"bg-red-600"})};return(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsx)("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:(0,HD.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,HD.jsx)("thead",{className:"bg-gray-50",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Empleado"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fechas"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"D\xedas"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Motivo"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),(0,HD.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===t.length?(0,HD.jsx)("tr",{children:(0,HD.jsx)("td",{colSpan:"5",className:"px-6 py-4 text-center text-gray-500",children:"No hay solicitudes pendientes."})}):t.map(e=>(0,HD.jsxs)("tr",{children:[(0,HD.jsxs)("td",{className:"px-6 py-4 text-sm font-medium text-gray-900",children:[e.nombre," ",(0,HD.jsx)("br",{}),(0,HD.jsx)("span",{className:"text-xs text-gray-500 capitalize",children:e.rol})]}),(0,HD.jsxs)("td",{className:"px-6 py-4 text-sm text-gray-600",children:[e.fechaInicio.toDate().toLocaleDateString()," - ",e.fechaFin.toDate().toLocaleDateString()]}),(0,HD.jsx)("td",{className:"px-6 py-4 text-sm font-bold text-blue-600",children:e.diasSolicitados}),(0,HD.jsx)("td",{className:"px-6 py-4 text-sm text-gray-600",children:e.motivo||"---"}),(0,HD.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[(0,HD.jsx)("button",{onClick:()=>c(e,"approve"),disabled:a===e.id,className:"text-green-600 hover:text-green-900 font-bold disabled:opacity-50",children:"Aprobar"}),(0,HD.jsx)("button",{onClick:()=>c(e,"reject"),disabled:a===e.id,className:"text-red-600 hover:text-red-900 font-bold disabled:opacity-50",children:"Rechazar"})]})]},e.id))})]})}),"approve"===(null===r||void 0===r?void 0:r.type)&&(0,HD.jsx)(rR,{title:r.title,message:r.message,onConfirm:async()=>{if(!r)return;const{request:e}=r;l(e.id);try{const t=ug(KD,"solicitudesVacaciones",e.id);"supervisor"===n?(await by(t,{estado:"Pendiente RH",aprobadoSupervisor:!0,fechaAprobacionSupervisor:Sc.now()}),ZE.success("Aprobado. Enviado a RH.")):"rh"===n&&(await Sy(KD,async n=>{const i=ug(KD,"usuarios",e.uid),s={id:e.id,fechaInicio:e.fechaInicio,fechaFin:e.fechaFin,dias:e.diasSolicitados,motivo:e.motivo||"Solicitud App",tipo:"Solicitud App",fechaRegistro:Sc.now()};n.update(i,{historialVacaciones:Py(s)}),n.update(t,{estado:"Aprobado",aprobadoRH:!0,fechaAprobacionRH:Sc.now()})}),ZE.success("Solicitud finalizada y d\xedas descontados.")),s()}catch(PS){console.error(PS),ZE.error("Error al procesar.")}finally{l(null),o(null)}},onCancel:()=>o(null)}),"reject"===(null===r||void 0===r?void 0:r.type)&&(0,HD.jsx)(lR,{title:r.title,message:r.message,onConfirm:async e=>{if(!r)return;const{request:t}=r;if(e&&""!==e.trim()){l(t.id);try{const i=ug(KD,"solicitudesVacaciones",t.id);await by(i,{estado:"Rechazado",rechazadoPor:n,motivoRechazo:e,fechaRechazo:Sc.now()}),ZE.info("Solicitud rechazada."),s()}catch(PS){console.error(PS),ZE.error("Error al rechazar.")}finally{l(null),o(null)}}else alert("Debes escribir un motivo.")},onCancel:()=>o(null),confirmText:r.confirmText,confirmColor:r.confirmColor})]})},vR=e=>{let{user:t,userData:n,selectedRole:s}=e;const[r,o]=(0,i.useState)("projects"),[a,l]=(0,i.useState)([]),[u,d]=(0,i.useState)(!0),[h,f]=(0,i.useState)(null),p=()=>{d(!0);return _y(Qg(cg(KD,YD),ty("fechaApertura","desc")),e=>{l(e.docs.map(e=>c({id:e.id},e.data()))),d(!1)})};return(0,i.useEffect)(()=>{const e=p();return()=>e()},[]),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("div",{className:"mb-6 border-b border-gray-200",children:(0,HD.jsxs)("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[(0,HD.jsx)("button",{onClick:()=>o("projects"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("projects"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500"),children:"Proyectos"}),(0,HD.jsx)("button",{onClick:()=>o("users"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("users"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500"),children:"Usuarios"}),(0,HD.jsx)("button",{onClick:()=>o("services"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("services"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500"),children:"Servicios"}),(0,HD.jsx)("button",{onClick:()=>o("providers"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("providers"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500"),children:"Proveedores"})]})}),"users"===r&&(0,HD.jsx)(hR,{onUserAdded:()=>{}}),"projects"===r&&(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsx)(_R,{onProjectAdded:p}),(0,HD.jsx)("h2",{className:"text-2xl font-bold text-gray-800 my-6",children:"Todos los Proyectos"}),u?(0,HD.jsx)("p",{children:"Cargando tabla..."}):(0,HD.jsx)(wR,{projects:a,onUpdateProject:p,userRole:"administrador",selectedRole:s,onManageClick:f})]}),"services"===r&&(0,HD.jsx)(dR,{}),"providers"===r&&(0,HD.jsx)(fR,{collectionName:"proveedores",title:"Proveedores",fields:["nombre","proveedorIdNumerico"],placeholderTexts:["Nombre del Proveedor","ID Num\xe9rico (ej: 01)"]}),h&&(0,HD.jsx)(aR,{project:h,onClose:()=>f(null),onUpdate:p,user:t,userData:n,userRole:"administrador"})]})},bR=e=>{let{url:t,onClose:n}=e;return(0,HD.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center z-50",children:(0,HD.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full h-full max-w-6xl max-h-[90vh] flex flex-col",children:[(0,HD.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,HD.jsx)("h3",{className:"text-lg font-bold",children:"Visor de Documentos"}),(0,HD.jsx)("button",{onClick:n,className:"text-gray-600 hover:text-gray-900 text-2xl font-bold",children:"\xd7"})]}),(0,HD.jsx)("div",{className:"flex-grow",children:(0,HD.jsx)("iframe",{src:t,title:"Visor de Heyzine",className:"w-full h-full",frameBorder:"0",allowFullScreen:!0})})]})})},xR=e=>{let{projects:t,onOpenModal:n}=e;const i=t.filter(e=>"Terminado"===e.estadoCliente&&e.urlHeyzine);return(0,HD.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-8",children:i.map(e=>(0,HD.jsxs)("button",{className:"group text-left focus:outline-none",onClick:()=>n(e.urlHeyzine),children:[(0,HD.jsxs)("div",{className:"relative pt-[141%] bg-gray-200 rounded-lg shadow-lg group-hover:shadow-2xl transition-all duration-300 transform group-hover:-translate-y-1 overflow-hidden",children:[(0,HD.jsx)("img",{src:"https://firebasestorage.googleapis.com/v0/b/portal-evelsa.firebasestorage.app/o/portada%20Carpetas.jpeg?alt=media&token=417eb65c-1694-4efc-9e2a-55528d43a8d6",alt:"Portada de proyecto",className:"absolute inset-0 w-full h-full object-cover"}),(0,HD.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-40"}),(0,HD.jsxs)("div",{className:"absolute inset-0 flex flex-col justify-center items-center p-4 text-white text-center",children:[(0,HD.jsx)("h4",{className:"font-bold text-lg leading-tight",children:e.clienteNombre}),(0,HD.jsx)("hr",{className:"w-1/4 my-2 border-gray-400"}),(0,HD.jsx)("p",{className:"text-sm",children:e.servicioNombre})]})]}),(0,HD.jsx)("p",{className:"text-sm font-semibold text-gray-700 mt-3 truncate group-hover:text-blue-600",children:e.servicioNombre})]},e.id))})},_R=e=>{var t;let{onProjectAdded:n}=e;const[s,r]=(0,i.useState)({clienteId:"",servicioId:"",proveedorId:"",comentariosApertura:"",fechaApertura:(new Date).toISOString().split("T")[0],precioCotizacionCliente:"",costoProveedor:"",cotizacionClienteRef:"",poClienteRef:"",cotizacionProveedorRef:"",cantidadUnidades:1}),[o,a]=(0,i.useState)(null),l=i.useRef(null),[u,d]=(0,i.useState)({clientes:[],servicios:[],proveedores:[]}),[h,f]=(0,i.useState)(""),[p,m]=(0,i.useState)(!1),g="ecologia y asesoria ambiental"===(null===(t=u.proveedores.find(e=>e.id===s.proveedorId))||void 0===t?void 0:t.nombre.toLowerCase().trim());(0,i.useEffect)(()=>{(async()=>{try{const[e,t,n]=await Promise.all([yy(Qg(cg(KD,"usuarios"),$g("rol","==","cliente"))),yy(cg(KD,"servicios")),yy(cg(KD,"proveedores"))]),i=(e,t)=>(e.nombreCompleto||e.nombre).localeCompare(t.nombreCompleto||t.nombre);d({clientes:e.docs.map(e=>c({id:e.id},e.data())).sort(i),servicios:t.docs.map(e=>c({id:e.id},e.data())).sort(i),proveedores:n.docs.map(e=>c({id:e.id},e.data())).sort(i)})}catch(e){f("Error al cargar datos maestros.")}})()},[]),(0,i.useEffect)(()=>{g&&r(e=>c(c({},e),{},{costoProveedor:"0"}))},[s.proveedorId,g]);const y=e=>{const{name:t,value:n}=e.target;if(r(e=>c(c({},e),{},{[t]:n})),"servicioId"===t){const e=u.servicios.find(e=>e.id===n);a(e)}},v=o&&o.calculoDuracion&&o.calculoDuracion.porUnidad;return(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-8",children:[(0,HD.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"Crear Nuevo Proyecto"}),(0,HD.jsxs)("form",{ref:l,onSubmit:async e=>{if(e.preventDefault(),s.clienteId&&s.servicioId&&s.proveedorId){m(!0),f("");try{var t;let e=0;if(o&&o.calculoDuracion)if(o.calculoDuracion.totalHoras)e=o.calculoDuracion.totalHoras;else if(void 0!==o.calculoDuracion.baseHoras){const t=o.calculoDuracion.baseHoras||0,n=o.calculoDuracion.porUnidad||0;e=t+n*(Number(s.cantidadUnidades)||1)}const i=new Date(s.fechaApertura).getFullYear(),c=ug(KD,"contadores","proyectos_".concat(i)),d=await Sy(KD,async e=>{const t=await e.get(c),n=(t.exists()?t.data().consecutivo:0)+1;return e.set(c,{consecutivo:n},{merge:!0}),n}),h=i.toString().slice(-2),f=d.toString().padStart(3,"0"),p=u.clientes.find(e=>e.id===s.clienteId),m=u.servicios.find(e=>e.id===s.servicioId),y=u.proveedores.find(e=>e.id===s.proveedorId),v="".concat(p.clienteIdNumerico,"-").concat(m.servicioIdNumerico,"-").concat(y.proveedorIdNumerico,"-").concat(f).concat(h);await xy(cg(KD,YD),{npu:v,clienteId:s.clienteId,clienteNombre:p.nombreCompleto,servicioId:s.servicioId,servicioNombre:m.nombre,proveedorId:s.proveedorId,proveedorNombre:y.nombre,fechaApertura:Sc.fromDate(new Date(s.fechaApertura)),estado:s.poClienteRef?"Activo":"Cotizaci\xf3n",prioridad:"1 - Normal",dependencia:m.dependencia||"Sin Dependencia",precioCotizacionCliente:Number(s.precioCotizacionCliente)||0,costoProveedor:Number(s.costoProveedor)||0,horasEstimadas:e,horasRegistradas:0,facturasClienteIds:[],facturasProveedorIds:[],faseFacturacion:"N/A",cotizacionClienteRef:s.cotizacionClienteRef,poClienteRef:s.poClienteRef,cotizacionProveedorRef:s.cotizacionProveedorRef,poProveedor:g?"N/A":v.slice(-8),cantidadUnidades:null!==o&&void 0!==o&&null!==(t=o.calculoDuracion)&&void 0!==t&&t.porUnidad?Number(s.cantidadUnidades):null,asignadoTecnicosIds:[],comentariosApertura:s.comentariosApertura,fechaAsignacionTecnico:null,fechaEntregaInterna:null,notasSupervisor:"",fechaFinTecnicoReal:null}),r({clienteId:"",servicioId:"",proveedorId:"",comentariosApertura:"",fechaApertura:(new Date).toISOString().split("T")[0],precioCotizacionCliente:"",costoProveedor:"",cotizacionClienteRef:"",poClienteRef:"",cotizacionProveedorRef:"",cantidadUnidades:1}),a(null),l.current.reset(),n&&n()}catch(i){console.error("Error al crear proyecto:",i),f("Ocurri\xf3 un error: ".concat(i.message))}m(!1)}else f("Cliente, Servicio y Proveedor son obligatorios.")},className:"space-y-6",children:[(0,HD.jsxs)("div",{className:"space-y-4",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Fecha de Apertura"}),(0,HD.jsx)("input",{type:"date",name:"fechaApertura",value:s.fechaApertura,onChange:y,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"})]}),(0,HD.jsxs)("select",{name:"clienteId",value:s.clienteId,onChange:y,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm",children:[(0,HD.jsx)("option",{value:"",children:"Seleccione un Cliente"}),u.clientes.map(e=>(0,HD.jsx)("option",{value:e.id,children:e.nombreCompleto},e.id))]}),(0,HD.jsxs)("select",{name:"servicioId",value:s.servicioId,onChange:y,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm",children:[(0,HD.jsx)("option",{value:"",children:"Seleccione un Proyecto/Servicio"}),u.servicios.map(e=>(0,HD.jsx)("option",{value:e.id,children:e.nombre},e.id))]}),(0,HD.jsxs)("select",{name:"proveedorId",value:s.proveedorId,onChange:y,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm",children:[(0,HD.jsx)("option",{value:"",children:"Seleccione un Proveedor"}),u.proveedores.map(e=>(0,HD.jsx)("option",{value:e.id,children:e.nombre},e.id))]}),(0,HD.jsx)("textarea",{name:"comentariosApertura",value:s.comentariosApertura,onChange:y,placeholder:"Comentarios de apertura",className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"}),v&&(0,HD.jsxs)("div",{children:[(0,HD.jsxs)("label",{className:"block text-sm font-medium text-gray-700 capitalize",children:["Cantidad de ",o.calculoDuracion.nombreUnidad||"Unidades"]}),(0,HD.jsx)("input",{type:"number",name:"cantidadUnidades",value:s.cantidadUnidades,onChange:y,className:"mt-1 block w-full px-3 py-2 border rounded-md"})]})]}),(0,HD.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 border-t pt-6",children:[(0,HD.jsxs)("div",{className:"space-y-4",children:[(0,HD.jsx)("h4",{className:"font-semibold text-gray-700",children:"Informaci\xf3n del Cliente"}),(0,HD.jsx)("input",{type:"number",name:"precioCotizacionCliente",value:s.precioCotizacionCliente,onChange:y,placeholder:"Precio Cotizaci\xf3n (con IVA)",className:"mt-1 block w-full px-3 py-2 border rounded-md"}),(0,HD.jsx)("input",{type:"text",name:"cotizacionClienteRef",value:s.cotizacionClienteRef,onChange:y,placeholder:"N\xba o Referencia de Cotizaci\xf3n",className:"mt-1 block w-full px-3 py-2 border rounded-md"}),(0,HD.jsx)("input",{type:"text",name:"poClienteRef",value:s.poClienteRef,onChange:y,placeholder:"N\xba de Orden de Compra (PO)",className:"mt-1 block w-full px-3 py-2 border rounded-md"})]}),(0,HD.jsxs)("div",{className:"space-y-4",children:[(0,HD.jsx)("h4",{className:"font-semibold text-gray-700",children:"Informaci\xf3n del Proveedor"}),(0,HD.jsx)("input",{type:"number",name:"costoProveedor",value:s.costoProveedor,onChange:y,placeholder:"Costo (con IVA)",disabled:g,className:"mt-1 block w-full px-3 py-2 border rounded-md disabled:bg-gray-100"}),(0,HD.jsx)("input",{type:"text",name:"cotizacionProveedorRef",value:s.cotizacionProveedorRef,onChange:y,placeholder:"N\xba o Ref. de Cotizaci\xf3n Proveedor",disabled:g,className:"mt-1 block w-full px-3 py-2 border rounded-md"})]})]}),(0,HD.jsx)(eR,{message:h,type:"error",onClose:()=>f("")}),(0,HD.jsx)("button",{type:"submit",disabled:p,className:"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg disabled:bg-gray-400",children:p?"Creando...":"Crear Proyecto y Generar NPU"})]})]})},wR=e=>{let{projects:t,onUpdateProject:n,userRole:s,supervisorView:r,onManageClick:o,onAssignClick:a,user:l,userData:u,selectedRole:d}=e;const[h,f]=(0,i.useState)(null),[p,m]=(0,i.useState)(1),[g,y]=(0,i.useState)(10),[v,b]=(0,i.useState)({}),[x,_]=(0,i.useState)(null),[w,C]=(0,i.useState)("");(0,i.useEffect)(()=>{const e=(()=>{const e=Qg(cg(KD,"usuarios"),$g("rol","==","tecnico")),t=_y(Qg(cg(KD,"usuarios"),$g("roles","array-contains","tecnico")),t=>{const n={};t.forEach(e=>{n[e.id]=e.data().nombreCompleto}),yy(e).then(e=>{e.forEach(e=>{n[e.id]||(n[e.id]=e.data().nombreCompleto)})})}),n=_y(Qg(cg(KD,"facturas")),e=>{const t={};e.forEach(e=>{t[e.id]=e.data().folio}),b(t)});return()=>{t(),n()}})();return()=>e()},[]);const N="administrador"===s?t.filter(e=>{var t,n,i;return(null===(t=e.npu)||void 0===t?void 0:t.toLowerCase().includes(w.toLowerCase()))||(null===(n=e.clienteNombre)||void 0===n?void 0:n.toLowerCase().includes(w.toLowerCase()))||(null===(i=e.servicioNombre)||void 0===i?void 0:i.toLowerCase().includes(w.toLowerCase()))}):t,k=N.slice((p-1)*g,p*g),E=Math.ceil(N.length/g),T=e=>m(e),S=async e=>{var t;await(t=ug(KD,YD,e),wy(ig(t.firestore,fg),[new vh(t._key,rh.none())])),_(null)};return(0,HD.jsxs)(HD.Fragment,{children:["administrador"===s&&(0,HD.jsxs)("div",{className:"mb-4 flex flex-col md:flex-row justify-between items-center",children:[(0,HD.jsx)("input",{type:"text",placeholder:"Buscar por NPU, cliente, servicio o dependencia...",className:"w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md mb-2 md:mb-0",onChange:e=>{C(e.target.value),m(1)}}),(0,HD.jsxs)("div",{className:"flex items-center",children:[(0,HD.jsx)("span",{className:"text-sm mr-2",children:"Mostrar:"}),(0,HD.jsxs)("select",{value:g,onChange:e=>{y(Number(e.target.value)),m(1)},className:"px-2 py-1 border border-gray-300 rounded-md",children:[(0,HD.jsx)("option",{value:10,children:"10"}),(0,HD.jsx)("option",{value:25,children:"25"}),(0,HD.jsx)("option",{value:50,children:"50"}),(0,HD.jsx)("option",{value:100,children:"100"})]})]})]}),(0,HD.jsx)("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:(0,HD.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,HD.jsxs)("thead",{className:"bg-gray-50",children:["supervisor"===s&&"new"===r&&(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fecha Apertura"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"NPU"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cliente"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Servicio"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]}),"supervisor"===s&&"techDetail"===r&&(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase",children:"Estado"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase",children:"Prioridad"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase",children:"Horas (Reg/Est)"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase",children:"Servicio"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium uppercase",children:"Ver M\xe1s"})]}),"administrador"===s&&(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fecha Apertura"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"NPU"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cliente"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Servicio"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Proveedor"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"N\xba Proy. Lab."}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Comentarios"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"PO Prov."}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Precio"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Costo"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Ref. Cliente"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Ref. Proveedor"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fact. Cliente"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Fact. Proveedor"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})]}),(0,HD.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:k.map(e=>{var t,n,l,c,u,d;const p=h===e.id;let m="A Tiempo";if("supervisor"===s){var g;const t=new Date;t.setHours(0,0,0,0);const n=null===(g=e.fechaEntregaInterna)||void 0===g?void 0:g.toDate();n?(n.setHours(0,0,0,0),n<t?m="Atrasado":(n-t)/864e5<=3&&(m="Por Vencer")):m="Sin Fecha"}const y=null===(t=e.proveedorNombre)||void 0===t?void 0:t.toLowerCase().includes("ecotech");return(0,HD.jsxs)(i.Fragment,{children:[(0,HD.jsx)("tr",{className:p?"bg-blue-50":"",children:"administrador"===s&&(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:$D(e.fechaApertura)}),(0,HD.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium",children:e.npu}),(0,HD.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:e.clienteNombre}),(0,HD.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:e.servicioNombre}),(0,HD.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:e.proveedorNombre}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(null===(n=e.datosEcotech)||void 0===n?void 0:n.numeroProyecto)||"---"}),(0,HD.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",title:e.comentariosApertura,children:(0,HD.jsx)("p",{className:"w-32 truncate",children:e.comentariosApertura||"---"})}),(0,HD.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:e.poProveedor}),(0,HD.jsxs)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-green-600",children:["$",(e.precioCotizacionCliente||0).toFixed(2)]}),(0,HD.jsxs)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-red-600",children:["$",(e.costoProveedor||0).toFixed(2)]}),(0,HD.jsxs)("td",{className:"px-4 py-2 text-xs",children:[(0,HD.jsxs)("p",{children:[(0,HD.jsx)("strong",{children:"Cot:"})," ",e.cotizacionClienteRef||"N/A"]}),(0,HD.jsxs)("p",{children:[(0,HD.jsx)("strong",{children:"PO:"})," ",e.poClienteRef||"N/A"]})]}),(0,HD.jsx)("td",{className:"px-4 py-2 text-xs",children:(0,HD.jsxs)("p",{children:[(0,HD.jsx)("strong",{children:"Cot:"})," ",e.cotizacionProveedorRef||"N/A"]})}),(0,HD.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:v[e.facturaClienteId]||"---"}),(0,HD.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:v[e.facturaProveedorId]||("ecologia y asesoria ambiental"===(null===(l=e.proveedorNombre)||void 0===l?void 0:l.toLowerCase().trim())?"N/A":"---")}),(0,HD.jsx)("td",{className:"px-4 py-2",children:(0,HD.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat("Activo"===e.estado?"bg-orange-100 text-orange-800":"bg-gray-100 text-gray-800"),children:e.estado})}),(0,HD.jsx)("td",{className:"px-4 py-2",children:(0,HD.jsxs)("div",{className:"flex items-center space-x-4",children:["Cotizaci\xf3n"===e.estado&&(0,HD.jsx)("button",{onClick:()=>(async e=>{await by(ug(KD,YD,e),{estado:"Activo",estadoCliente:"Activo"})})(e.id),className:"text-green-600",children:"Activar"}),(0,HD.jsx)("button",{onClick:()=>o(e),className:"text-indigo-600",children:"Gestionar"}),"Terminado"!==e.estado&&"Archivado"!==e.estado&&(0,HD.jsx)("button",{onClick:()=>{return t=e.id,n=e.npu,void _({title:"Confirmar Eliminaci\xf3n",message:"\xbfEst\xe1s seguro de que quieres borrar el proyecto ".concat(n,"? Esta acci\xf3n no se puede deshacer."),onConfirm:()=>S(t),confirmText:"S\xed, Borrar",confirmColor:"bg-red-600"});var t,n},className:"text-red-600",children:"Borrar"})]})})]})}),"supervisor"===s&&"new"===r&&(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:$D(e.fechaApertura)}),(0,HD.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm font-medium",children:e.npu}),(0,HD.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:e.clienteNombre}),(0,HD.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:e.servicioNombre}),(0,HD.jsx)("td",{className:"px-4 py-2",children:(0,HD.jsx)("button",{onClick:()=>a(e),className:"text-indigo-600 font-medium",children:"Asignar"})})]}),"supervisor"===s&&"techDetail"===r&&(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsx)("td",{className:"px-4 py-3",children:(0,HD.jsx)(PR,{status:m})}),(0,HD.jsx)("td",{className:"px-4 py-3 text-sm",children:e.prioridad||"1 - Normal"}),(0,HD.jsxs)("td",{className:"px-4 py-3 text-sm",children:[(0,HD.jsxs)("span",{className:"font-semibold",children:[(e.horasRegistradas||0).toFixed(1),"h"]})," /",(0,HD.jsxs)("span",{className:"text-gray-600",children:[(e.horasEstimadas||0).toFixed(1),"h"]})]}),(0,HD.jsx)("td",{className:"px-4 py-3 text-sm",children:e.servicioNombre}),(0,HD.jsx)("td",{className:"px-4 py-3",children:(0,HD.jsx)("button",{onClick:()=>{return t=e.id,void f(e=>e===t?null:t);var t},className:"text-indigo-600 font-medium",children:h===e.id?"Ocultar":"Detalles..."})})]}),p&&(0,HD.jsx)("tr",{className:"bg-gray-50 border-b-2 border-blue-200",children:(0,HD.jsx)("td",{colSpan:"5",className:"p-4",children:(0,HD.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("p",{className:"font-semibold",children:"Cliente:"}),(0,HD.jsx)("p",{children:e.clienteNombre})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("p",{className:"font-semibold",children:"Fecha L\xedmite (Supervisor):"}),(0,HD.jsx)("p",{children:$D(e.fechaEntregaInterna)})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("p",{className:"font-semibold",children:"Estado Detallado:"}),e.fechaFinTecnicoReal?(0,HD.jsxs)("p",{className:"text-purple-800",children:["EL t\xe9cnico finaliz\xf3 el dia ",$D(e.fechaFinTecnicoReal),", en espera de proveedor o resolutivo."]}):(0,HD.jsx)("p",{className:"text-gray-600",children:"El t\xe9cnico est\xe1 trabajando en el proyecto."})]}),(0,HD.jsxs)("div",{className:"col-span-3 bg-yellow-50 p-3 rounded-md border border-yellow-200",children:[(0,HD.jsx)("p",{className:"font-semibold text-yellow-800",children:"Comentarios"}),(0,HD.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap mt-1",children:e.comentariosApertura||"Sin instrucciones espec\xedficas."})]}),(0,HD.jsxs)("div",{className:"col-span-full",children:[(0,HD.jsx)("p",{className:"font-semibold",children:"Notas del Supervisor:"}),(0,HD.jsx)("p",{className:"text-gray-600 whitespace-pre-wrap",children:e.notasSupervisor||"No hay notas."})]}),y&&(0,HD.jsxs)("div",{className:"col-span-3 border-t pt-2 mt-2",children:[(0,HD.jsx)("p",{className:"font-semibold text-gray-800",children:"Info Ecotech:"}),(0,HD.jsxs)("p",{children:[(0,HD.jsx)("strong",{children:"N\xba Proy:"})," ",(null===(c=e.datosEcotech)||void 0===c?void 0:c.numeroProyecto)||"N/A",", ",(0,HD.jsx)("strong",{children:"Puntos:"})," ",(null===(u=e.datosEcotech)||void 0===u?void 0:u.puntosDeTrabajo)||"N/A",", ",(0,HD.jsx)("strong",{children:"Estatus:"})," ",(null===(d=e.datosEcotech)||void 0===d?void 0:d.estatus)||"N/A"]})]}),(0,HD.jsxs)("div",{className:"col-span-full flex justify-end items-center space-x-4 border-t pt-3 mt-2",children:[(0,HD.jsx)("button",{onClick:()=>a(e),className:"bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-yellow-600",children:"Reasignar T\xe9cnico"}),(0,HD.jsx)("button",{onClick:()=>o(e),className:"bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700",children:"Gestionar"})]})]})})})]},e.id)})})]})}),(0,HD.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,HD.jsxs)("span",{className:"text-sm text-gray-700",children:["P\xe1gina ",p," de ",E]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("button",{onClick:()=>T(p-1),disabled:1===p,className:"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50",children:"Anterior"}),(0,HD.jsx)("button",{onClick:()=>T(p+1),disabled:p===E||0===E,className:"px-3 py-1 border rounded-md bg-white disabled:opacity-50",children:"Siguiente"})]})]}),x&&(0,HD.jsx)(rR,c(c({},x),{},{onCancel:()=>_(null)}))]})},CR=e=>{let{projects:t,onUpdateProject:n}=e;const[s,r]=(0,i.useState)(null);return(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsx)("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:(0,HD.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,HD.jsx)("thead",{className:"bg-gray-50",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cliente"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Servicio"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"NPU"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Documentos"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),(0,HD.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.clienteNombre}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.servicioNombre}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.npu}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,HD.jsxs)("div",{className:"flex flex-col space-y-1",children:[e.urlHeyzine&&(0,HD.jsx)("a",{href:e.urlHeyzine,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600",children:"Ver Proyecto"}),e.fase1_urlNotaEntregaFirmada&&(0,HD.jsx)("a",{href:e.fase1_urlNotaEntregaFirmada,target:"_blank",rel:"noopener noreferrer",className:"text-red-600",children:"Nota F1"}),e.fase2_urlNotaEntregaFirmada&&(0,HD.jsx)("a",{href:e.fase2_urlNotaEntregaFirmada,target:"_blank",rel:"noopener noreferrer",className:"text-red-600",children:"Nota F2"})]})}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,HD.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,HD.jsx)("button",{onClick:()=>(e=>{const t=!!e.fase2_urlNotaEntregaFirmada,n=!!e.fase1_urlNotaEntregaFirmada&&!t;let i="\xbfConfirmar aprobaci\xf3n?";t?i="El proyecto se marcar\xe1 como TERMINADO. \xbfContinuar?":n&&(i="El proyecto pasara a pendiente de resolutivo \xbfContinuar?"),r({action:"approve",payload:{project:e},title:"Confirmar Aprobaci\xf3n",message:i})})(e),className:"text-green-600 hover:text-green-900",children:"Aprobar"}),(0,HD.jsx)("button",{onClick:()=>{return t=e.id,void r({action:"reject",payload:{projectId:t},title:"Rechazar Proyecto",message:"Por favor, introduce el motivo del rechazo para notificar al practicante.",confirmText:"Rechazar",confirmColor:"bg-orange-600"});var t},className:"text-orange-600 hover:text-orange-900",children:"Rechazar"})]})})]},e.id))})]})}),"approve"===(null===s||void 0===s?void 0:s.action)&&(0,HD.jsx)(rR,{title:s.title,message:s.message,onConfirm:async()=>{if(!s||"approve"!==s.action)return;const{project:e}=s.payload,t=ug(KD,YD,e.id),i={};if(e.urlNotaPdf2)i.estado="Terminado",i.estadoCliente="Terminado";else if(e.urlNotaPdf1){if(i.estado="Activo",i.faseFacturacion="Fase 2 Pendiente",i.estadoCliente="Terminado",e.asignadoTecnicosIds){const t={};e.asignadoTecnicosIds.forEach(e=>{t[e]="No Visto"}),i.tecnicosStatus=t}e.facturasClienteIds&&e.facturasClienteIds.length>0||(i.necesitaFactura=!0)}try{await by(t,i),ZE.success("Proyecto procesado correctamente.")}catch(o){console.error(o),ZE.error("Error al actualizar el proyecto.")}r(null),n()},onCancel:()=>r(null)}),"reject"===(null===s||void 0===s?void 0:s.action)&&(0,HD.jsx)(lR,{title:s.title,message:s.message,onConfirm:async e=>{if(!s||"reject"!==s.action)return;const{projectId:t}=s.payload;if(e&&""!==e.trim()){{const i=ug(KD,YD,t);await by(i,{estado:"Terminado Internamente",motivoRechazo:e}),n()}r(null)}else alert("El motivo del rechazo no puede estar vac\xedo.")},onCancel:()=>r(null),confirmText:s.confirmText,confirmColor:s.confirmColor})]})},NR=e=>{let{projects:t,onOpenModal:n}=e;const[s,r]=(0,i.useState)(null),o=t.reduce((e,t)=>{const n=t.dependencia||"Sin Dependencia";return e[n]||(e[n]=[]),e[n].push(t),e},{});return(0,HD.jsx)("div",{className:"space-y-4",children:Object.entries(o).map(e=>{let[t,i]=e;return(0,HD.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,HD.jsxs)("button",{onClick:()=>{return r(s===(e=t)?null:e);var e},className:"w-full p-4 text-left font-bold text-lg text-gray-800 flex justify-between items-center hover:bg-gray-50 transition",children:[(0,HD.jsxs)("span",{children:[t," ",(0,HD.jsxs)("span",{className:"text-sm font-normal text-gray-500",children:["(",i.length,")"]})]}),(0,HD.jsx)("span",{className:"transform transition-transform duration-300 ".concat(s===t?"rotate-180":""),children:"\u25bc"})]}),s===t&&(0,HD.jsx)("ul",{className:"divide-y divide-gray-200 border-t",children:i.map(e=>{return(0,HD.jsxs)("li",{className:"p-4 md:px-6 md:py-4 flex flex-col md:flex-row md:items-center",children:[(0,HD.jsx)("div",{className:"flex-1 mb-4 md:mb-0",children:(0,HD.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.servicioNombre})}),(0,HD.jsx)("div",{className:"w-full md:w-40 mb-4 md:mb-0",children:(0,HD.jsx)("div",{className:"text-sm text-gray-500 hidden md:block",children:(i=e.fechaApertura,i?new Date(1e3*i.seconds).toLocaleDateString("es-MX"):"---")})}),(0,HD.jsx)("div",{className:"w-full md:w-40 mb-4 md:mb-0",children:(0,HD.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat((t=e.estadoCliente,"Activo"===t?"bg-orange-100 text-orange-800":"bg-green-100 text-green-800")),children:e.estadoCliente})}),(0,HD.jsxs)("div",{className:"w-full md:w-56 flex items-center space-x-4",children:[e.urlHeyzine&&(0,HD.jsx)("button",{onClick:()=>n(e.urlHeyzine),className:"text-sm font-medium text-blue-600 hover:text-blue-900",children:"Ver Proyecto"}),e.urlNotaPdf1&&(0,HD.jsx)("a",{href:e.urlNotaPdf1,download:!0,className:"text-sm font-medium text-red-600 hover:text-red-900",children:"Nota Preliminar"}),e.urlNotaPdf2&&(0,HD.jsx)("a",{href:e.urlNotaPdf2,download:!0,className:"text-sm font-medium text-red-600 hover:text-red-900",children:"Nota Final"})]})]},e.id);var t,i})})]},t)})})},kR=e=>{let{user:t,userData:n}=e;const[s,r]=(0,i.useState)([]),[o,a]=(0,i.useState)([]),[l,u]=(0,i.useState)(!0),[d,h]=(0,i.useState)("shelf"),[f,p]=(0,i.useState)(null);return(0,i.useEffect)(()=>{if(!n||!n.id)return void u(!1);u(!0);const e=_y(Qg(cg(KD,YD),$g("clienteId","==",n.id),$g("estadoCliente","in",["Activo","Terminado"])),e=>{const t=e.docs.map(e=>c({id:e.id},e.data()));t.sort((e,t)=>{var n,i;return((null===(n=t.fechaApertura)||void 0===n?void 0:n.seconds)||0)-((null===(i=e.fechaApertura)||void 0===i?void 0:i.seconds)||0)}),r(t),u(!1);const n=new Map;t.forEach(e=>{if("Terminado"===e.estadoCliente&&e.urlHeyzine){var t,i;const s=e.servicioId,r=n.get(s);(!r||(null===(t=e.fechaApertura)||void 0===t?void 0:t.seconds)>(null===(i=r.fechaApertura)||void 0===i?void 0:i.seconds))&&n.set(s,e)}}),a(Array.from(n.values())),u(!1)},e=>{console.error("Error fetching client projects: ",e),u(!1)});return()=>e()},[n]),n?(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:["Proyectos de ",n.nombreCompleto]}),(0,HD.jsx)("div",{className:"mb-6 border-b border-gray-200",children:(0,HD.jsxs)("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[(0,HD.jsx)("button",{onClick:()=>h("shelf"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("shelf"===d?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Estanter\xeda de Proyectos"}),(0,HD.jsx)("button",{onClick:()=>h("list"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("list"===d?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Lista Detallada"})]})}),l?(0,HD.jsx)("p",{children:"Cargando proyectos..."}):0===s.length?(0,HD.jsx)("p",{className:"text-center text-gray-500 mt-8",children:"No hay proyectos para mostrar."}):"shelf"===d?(0,HD.jsx)(xR,{projects:o,onOpenModal:p}):(0,HD.jsx)(NR,{projects:s,onOpenModal:p}),f&&(0,HD.jsx)(bR,{url:f,onClose:()=>p(null)})]}):(0,HD.jsx)("div",{className:"text-center py-10",children:"Cargando perfil..."})},ER=e=>{let{chartData:t}=e;const n={labels:t.labels,datasets:[{label:"Valor en Cotizaci\xf3n",data:t.cotizacionData,backgroundColor:"rgba(255, 159, 64, 0.7)"},{label:"Valor Activo",data:t.activoData,backgroundColor:"rgba(54, 162, 235, 0.7)"},{label:"Valor Pdto. Factura",data:t.pendienteFacturaData,backgroundColor:"rgba(255, 206, 86, 0.7)"},{type:"line",label:"Valor Total Ofertado",data:t.totalData,borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.2)",fill:!0,tension:.2,yAxisID:"y1"}]};return(0,HD.jsx)(wE,{options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!1},tooltip:{mode:"index",intersect:!1},legend:{position:"bottom"}},scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0},y1:{position:"right",grid:{drawOnChartArea:!1},beginAtZero:!0}}},data:n})},TR=e=>{let{chartData:t}=e;const n={labels:t.labels,datasets:[{label:"Pagado",data:t.pagadoData,backgroundColor:"rgba(75, 192, 192, 0.7)"},{label:"Programado a Pago",data:t.programadoData,backgroundColor:"rgba(54, 162, 235, 0.7)"},{label:"Vence Hoy",data:t.venceHoyData,backgroundColor:"rgba(255, 159, 64, 0.7)"},{label:"Vencido",data:t.vencidoData,backgroundColor:"rgba(255, 99, 132, 0.7)"},{label:"Pdte. de Programaci\xf3n",data:t.pdteProgramacionData,backgroundColor:"rgba(201, 203, 207, 0.7)"},{type:"line",label:"Total Facturado",data:t.totalFacturadoData,borderColor:"#36A2EB",tension:.2,yAxisID:"y1"}]};return(0,HD.jsx)(wE,{options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!1},tooltip:{mode:"index",intersect:!1},legend:{position:"bottom"}},scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0},y1:{position:"right",grid:{drawOnChartArea:!1},beginAtZero:!0}}},data:n})},SR=e=>{let{chartData:t}=e;const n={labels:t.labels,datasets:[{label:"Ingresos Programados",data:t.ingresosData,borderColor:"rgb(54, 162, 235)",backgroundColor:"rgba(54, 162, 235, 0.5)",type:"bar"},{label:"Egresos Programados",data:t.egresosData,borderColor:"rgb(255, 99, 132)",backgroundColor:"rgba(255, 99, 132, 0.5)",type:"bar"}]};return(0,HD.jsx)(wE,{options:{responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!1},legend:{position:"bottom"}},scales:{y:{beginAtZero:!0}}},data:n})},IR=e=>{let{title:t,value:n,unit:i="",trend:s=null}=e;return(0,HD.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-md",children:[(0,HD.jsx)("h3",{className:"font-bold text-gray-500 truncate",children:t}),(0,HD.jsxs)("p",{className:"text-3xl font-bold mt-2",children:[n,(0,HD.jsx)("span",{className:"text-xl font-semibold ml-1",children:i})]})]})},PR=e=>{let{status:t}=e;return(0,HD.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat({Atrasado:"bg-red-100 text-red-800","Por Vencer":"bg-orange-100 text-orange-800","A Tiempo":"bg-green-100 text-green-800","En Espera de Proveedor":"bg-purple-100 text-purple-800","Sin Fecha":"bg-gray-100 text-gray-600",Activo:"bg-orange-100 text-orange-800","En Revisi\xf3n Final":"bg-blue-100 text-blue-800","Terminado Internamente":"bg-indigo-100 text-indigo-800","Pendiente de Factura":"bg-yellow-100 text-yellow-800",Facturado:"bg-green-100 text-green-800",Archivado:"bg-gray-100 text-gray-700","Cotizaci\xf3n":"bg-gray-200 text-gray-800"}[t]||"bg-gray-100"),children:t})},jR=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],AR=e=>{let{projects:t,techniciansMap:n}=e;const s=(new Date).getFullYear(),r=[{value:"",label:"Todos los Meses"},...jR.map((e,t)=>({value:String(t),label:e}))],[o,a]=(0,i.useState)("delivered"),[l,c]=(0,i.useState)(""),[u,d]=(0,i.useState)(s),[h,f]=(0,i.useState)(1),[p,m]=(0,i.useState)(10),[g,y]=(0,i.useState)(""),v=i.useMemo(()=>n?Object.values(n).filter((e,t,n)=>n.indexOf(e)===t).sort().map(e=>({value:e,label:e})):[],[n]),{filteredProjects:b,totalSum:x,totalLabel:_}=i.useMemo(()=>{let e=[];e="delivered"===o?t.filter(e=>{var t,n;const i=(null===(t=e.fase1_fechaFinTecnico)||void 0===t?void 0:t.toDate())||(null===(n=e.fase2_fechaFinTecnico)||void 0===n?void 0:n.toDate());if(!i)return!1;const s=i.getFullYear()===u,r=!l||i.getMonth()===parseInt(l,10);return s&&r}):t.filter(e=>{var t;const n=null===(t=e.fechaEntregaInterna)||void 0===t?void 0:t.toDate();if(!n)return!1;const i="Activo"===e.estado&&!e.fechaFinTecnicoReal,s=n.getFullYear()===u,r=!l||n.getMonth()===parseInt(l,10);return i&&s&&r}),g&&(e=e.filter(e=>e.responsableNombre===g));const n=e.reduce((e,t)=>e+(t.precioCotizacionCliente||0),0);e.sort((e,t)=>{var n,i;const s=(null===(n="delivered"===o?e.fase2_fechaFinTecnico||e.fase1_fechaFinTecnico:e.fechaEntregaInterna)||void 0===n?void 0:n.toDate())||0;return((null===(i="delivered"===o?t.fase2_fechaFinTecnico||t.fase1_fechaFinTecnico:t.fechaEntregaInterna)||void 0===i?void 0:i.toDate())||0)-s});return{filteredProjects:e,totalSum:n,totalLabel:l?"".concat(jR[parseInt(l,10)]," ").concat(u):"Todo ".concat(u)}},[t,o,l,u,g]),w=b.slice((h-1)*p,h*p),C=Math.ceil(b.length/p),N=e=>f(e),k=Array.from({length:5},(e,t)=>s-t);return(0,HD.jsxs)("div",{children:[(0,HD.jsxs)("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg border flex flex-wrap items-center gap-x-6 gap-y-4",children:[(0,HD.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,HD.jsx)("label",{className:"text-sm font-medium",children:"Ver:"}),(0,HD.jsxs)("select",{value:o,onChange:e=>{a(e.target.value),f(1)},className:"border-gray-300 rounded-md p-2 text-sm",children:[(0,HD.jsx)("option",{value:"delivered",children:"Entregados en"}),(0,HD.jsx)("option",{value:"pending",children:"Pendientes para"})]})]}),(0,HD.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,HD.jsx)("label",{className:"text-sm font-medium",children:"Mes:"}),(0,HD.jsx)("select",{value:l,onChange:e=>{c(e.target.value),f(1)},className:"border-gray-300 rounded-md p-2 text-sm",children:r.map(e=>(0,HD.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,HD.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,HD.jsx)("label",{className:"text-sm font-medium",children:"A\xf1o:"}),(0,HD.jsx)("select",{value:u,onChange:e=>{d(parseInt(e.target.value,10)),f(1)},className:"border-gray-300 rounded-md p-2 text-sm",children:k.map(e=>(0,HD.jsx)("option",{value:e,children:e},e))})]}),(0,HD.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,HD.jsx)("label",{className:"text-sm font-medium",children:"Responsable:"}),(0,HD.jsxs)("select",{value:g,onChange:e=>{y(e.target.value),f(1)},className:"border-gray-300 rounded-md p-2 text-sm",children:[(0,HD.jsx)("option",{value:"",children:"Todos"}),v.map(e=>(0,HD.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,HD.jsxs)("div",{className:"flex items-center space-x-2 ml-auto",children:[(0,HD.jsx)("span",{className:"text-sm",children:"Mostrar:"}),(0,HD.jsxs)("select",{value:p,onChange:e=>{m(Number(e.target.value)),f(1)},className:"px-2 py-1 border border-gray-300 rounded-md",children:[(0,HD.jsx)("option",{value:10,children:"10"}),(0,HD.jsx)("option",{value:15,children:"15"}),(0,HD.jsx)("option",{value:25,children:"25"})]})]})]}),(0,HD.jsx)("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:(0,HD.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,HD.jsx)("thead",{className:"bg-gray-50",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"Cliente"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"Proyecto"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"Monto"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"Responsable"}),"pending"===o&&(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"Estatus Entrega"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"Notas Supervisor"})]}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"delivered"===o?"Nota Entrega":"Fecha L\xedmite"})]})}),(0,HD.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(e=>(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("td",{className:"px-4 py-2",children:e.clienteNombre}),(0,HD.jsx)("td",{className:"px-4 py-2",children:e.servicioNombre}),(0,HD.jsxs)("td",{className:"px-4 py-2 font-semibold",children:["$",(e.precioCotizacionCliente||0).toFixed(2)]}),(0,HD.jsx)("td",{className:"px-4 py-2",children:e.responsableNombre}),"pending"===o&&(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsx)("td",{className:"px-4 py-2",children:(0,HD.jsx)(PR,{status:e.deliveryStatus})}),(0,HD.jsx)("td",{className:"px-4 py-2 text-sm",title:e.notasSupervisor,children:(0,HD.jsx)("p",{className:"w-32 truncate",children:e.notasSupervisor||"---"})})]}),(0,HD.jsx)("td",{className:"px-4 py-2",children:"delivered"===o?e.notaEntregaNumero:$D(e.fechaEntregaInterna)})]},e.id))}),(0,HD.jsx)("tfoot",{className:"bg-gray-100 border-t-2",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsxs)("td",{className:"px-4 py-3 font-bold text-right text-sm",colSpan:"2",children:["Total ","delivered"===o?"Entregado":"Pendiente"," (",_,"):"]}),(0,HD.jsxs)("td",{className:"px-4 py-3 font-bold text-lg text-gray-900",children:["$",x.toFixed(2)]}),(0,HD.jsx)("td",{colSpan:"delivered"===o?2:4})]})})]})}),(0,HD.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,HD.jsxs)("span",{className:"text-sm text-gray-700",children:["P\xe1gina ",h," de ",C]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("button",{onClick:()=>N(h-1),disabled:1===h,className:"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50",children:"Anterior"}),(0,HD.jsx)("button",{onClick:()=>N(h+1),disabled:h===C||0===C,className:"px-3 py-1 border rounded-md bg-white disabled:opacity-50",children:"Siguiente"})]})]})]})},DR=e=>{let{title:t,invoices:n,getInvoiceStatusBadge:s}=e;const[r,o]=(0,i.useState)(""),[a,l]=(0,i.useState)(""),[c,u]=(0,i.useState)(1),[d,h]=(0,i.useState)(10),{filteredInvoices:f,totalSum:p}=i.useMemo(()=>{let e=r?n.filter(e=>e.estado===r):n;if(a){const t=parseInt(a,10);e=e.filter(e=>{var n;return(null===(n=e.fechaPromesaPago)||void 0===n?void 0:n.toDate().getMonth())===t})}const t=e.reduce((e,t)=>e+(t.monto||0),0);return{filteredInvoices:e,totalSum:t}},[n,r,a]),m=i.useMemo(()=>{const e=new Set;n.forEach(t=>{var n;null!==(n=t.fechaPromesaPago)&&void 0!==n&&n.toDate&&e.add(t.fechaPromesaPago.toDate().getMonth())});const t=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],i=Array.from(e).sort((e,t)=>e-t).map(e=>({value:String(e),label:t[e]}));return[{value:"",label:"Todos los Meses"},...i]},[n]),g=f.slice((c-1)*d,c*d),y=Math.ceil(f.length/d),v=e=>u(e);return(0,HD.jsxs)("div",{children:[(0,HD.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:t}),(0,HD.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,HD.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,HD.jsx)("label",{htmlFor:"".concat(t,"-status-filter"),className:"text-sm font-medium",children:"Estado:"}),(0,HD.jsxs)("select",{id:"".concat(t,"-status-filter"),value:r,onChange:e=>{o(e.target.value),u(1)},className:"border-gray-300 rounded-md p-2 text-sm",children:[(0,HD.jsx)("option",{value:"",children:"Todos"}),(0,HD.jsx)("option",{value:"Pend. de Autorizaci\xf3n",children:"Pend. Autorizaci\xf3n"}),(0,HD.jsx)("option",{value:"Prog. a Pago",children:"Prog. a Pago"}),(0,HD.jsx)("option",{value:"Vencida",children:"Vencida"})]})]}),(0,HD.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,HD.jsx)("label",{htmlFor:"".concat(t,"-month-filter"),className:"text-sm font-medium",children:"Mes Pago Prog.:"}),(0,HD.jsx)("select",{id:"".concat(t,"-month-filter"),value:a,onChange:e=>{l(e.target.value),u(1)},className:"border-gray-300 rounded-md p-2 text-sm",children:m.map(e=>(0,HD.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,HD.jsxs)("div",{className:"flex items-center",children:[(0,HD.jsx)("span",{className:"text-sm mr-2",children:"Mostrar:"}),(0,HD.jsxs)("select",{value:d,onChange:e=>{h(Number(e.target.value)),u(1)},className:"px-2 py-1 border border-gray-300 rounded-md",children:[(0,HD.jsx)("option",{value:10,children:"10"}),(0,HD.jsx)("option",{value:15,children:"15"}),(0,HD.jsx)("option",{value:25,children:"25"})]})]})]}),(0,HD.jsx)("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:(0,HD.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,HD.jsx)("thead",{className:"bg-gray-50",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"Estado"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"Monto"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"Fecha Prog. Pago"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"Planta"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"Servicio"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium uppercase",children:"Factura"})]})}),(0,HD.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(e=>(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("td",{className:"px-4 py-2",children:s(e.estado)}),(0,HD.jsxs)("td",{className:"px-4 py-2 font-semibold text-gray-900",children:["$",(e.monto||0).toFixed(2)]}),(0,HD.jsx)("td",{className:"px-4 py-2",children:$D(e.fechaPromesaPago)}),(0,HD.jsx)("td",{className:"px-4 py-2",children:e.planta||"N/A"}),(0,HD.jsx)("td",{className:"px-4 py-2",children:e.servicio||"General"}),(0,HD.jsx)("td",{className:"px-4 py-2",children:e.folio})]},e.id))}),(0,HD.jsx)("tfoot",{className:"bg-gray-100",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("td",{className:"px-4 py-3 font-bold text-right",children:"Total:"}),(0,HD.jsxs)("td",{className:"px-4 py-3 font-bold text-lg text-gray-900",colSpan:"4",children:["$",p.toFixed(2)]})]})})]})}),(0,HD.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,HD.jsxs)("span",{className:"text-sm text-gray-700",children:["P\xe1gina ",c," de ",y]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("button",{onClick:()=>v(c-1),disabled:1===c,className:"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50",children:"Anterior"}),(0,HD.jsx)("button",{onClick:()=>v(c+1),disabled:c===y||0===y,className:"px-3 py-1 border rounded-md bg-white disabled:opacity-50",children:"Siguiente"})]})]})]})},RR=e=>{let{invoices:t,projectsMap:n}=e;const[s,r]=(0,i.useState)(""),[o,a]=(0,i.useState)(1),[l,u]=(0,i.useState)(10),{processedInvoices:d,totalSum:h}=i.useMemo(()=>{const e=t.filter(e=>"Pend. de Autorizaci\xf3n"===e.estado||"Prog. a Pago"===e.estado||"Vencida"===e.estado),i=s?e.filter(e=>e.proveedorNombre===s):e,r=i.reduce((e,t)=>e+(t.monto||0),0);return{processedInvoices:i.map(e=>{let t="N/A";if(e.proyectoId&&"general"!==e.proyectoId){const i=n.get(e.proyectoId);t=i&&i.facturasClienteIds&&i.facturasClienteIds.length>0?"Facturado":"No Facturado"}return c(c({},e),{},{projectBillingStatus:t})}),totalSum:r}},[t,s,n]),f=d.slice((o-1)*l,o*l),p=Math.ceil(d.length/l),m=e=>a(e),g=[...new Set(t.map(e=>e.proveedorNombre))].sort(),y=e=>(0,HD.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat({Facturado:"bg-green-100 text-green-800","No Facturado":"bg-red-100 text-red-800","N/A":"bg-gray-100 text-gray-700"}[e]||"bg-gray-100"),children:e});return(0,HD.jsxs)("div",{children:[(0,HD.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Cuentas por Pagar"}),(0,HD.jsxs)("div",{className:"mb-4 flex justify-between items-center",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{htmlFor:"provider-filter",className:"text-sm font-medium mr-2",children:"Filtrar por Proveedor:"}),(0,HD.jsxs)("select",{id:"provider-filter",value:s,onChange:e=>{r(e.target.value),a(1)},className:"border-gray-300 rounded-md p-2 text-sm",children:[(0,HD.jsx)("option",{value:"",children:"Todos"}),g.map(e=>(0,HD.jsx)("option",{value:e,children:e},e))]})]}),(0,HD.jsxs)("div",{className:"flex items-center",children:[(0,HD.jsx)("span",{className:"text-sm mr-2",children:"Mostrar:"}),(0,HD.jsxs)("select",{value:l,onChange:e=>{u(Number(e.target.value)),a(1)},className:"px-2 py-1 border border-gray-300 rounded-md",children:[(0,HD.jsx)("option",{value:10,children:"10"}),(0,HD.jsx)("option",{value:15,children:"15"}),(0,HD.jsx)("option",{value:25,children:"25"})]})]})]}),(0,HD.jsx)("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:(0,HD.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,HD.jsx)("thead",{className:"bg-gray-50",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium",children:"Factura"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium",children:"Proveedor"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium",children:"Monto"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium",children:"Fecha Prog. Pago"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium",children:"Estatus"}),(0,HD.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium",children:"Estatus Cobro"})]})}),(0,HD.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map(e=>{return(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("td",{className:"px-4 py-2",children:e.folio}),(0,HD.jsx)("td",{className:"px-4 py-2",children:e.proveedorNombre||"N/A"}),(0,HD.jsxs)("td",{className:"px-4 py-2 font-semibold text-gray-900",children:["$",(e.monto||0).toFixed(2)]}),(0,HD.jsx)("td",{className:"px-4 py-2",children:$D(e.fechaPromesaPago)}),(0,HD.jsx)("td",{className:"px-4 py-2",children:(t=e.estado,(0,HD.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat({"Prog. a Pago":"bg-blue-100 text-blue-800","Pend. de Autorizaci\xf3n":"bg-yellow-100 text-yellow-800",Vencida:"bg-red-100 text-yellow-800"}[t]||"bg-gray-100"),children:t}))}),(0,HD.jsx)("td",{className:"px-4 py-2",children:y(e.projectBillingStatus)})]},e.id);var t})}),(0,HD.jsx)("tfoot",{className:"bg-gray-100",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("td",{className:"px-4 py-3 font-bold text-right",children:"Total:"}),(0,HD.jsxs)("td",{className:"px-4 py-3 font-bold text-lg text-gray-900",colSpan:"4",children:["$",h.toFixed(2)]})]})})]})}),(0,HD.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,HD.jsxs)("span",{className:"text-sm text-gray-700",children:["P\xe1gina ",o," de ",p]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("button",{onClick:()=>m(o-1),disabled:1===o,className:"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50",children:"Anterior"}),(0,HD.jsx)("button",{onClick:()=>m(o+1),disabled:o===p||0===p,className:"px-3 py-1 border rounded-md bg-white disabled:opacity-50",children:"Siguiente"})]})]})]})},MR=e=>{let{chartData:t}=e;const n={labels:t.labels,datasets:t.datasets},i={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},title:{display:!1},tooltip:{mode:"index",intersect:!1,callbacks:{label:function(e){let t=e.dataset.label||"";return t&&(t+=": "),null!==e.parsed.y&&(t+=new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(e.parsed.y)),t}}}},scales:{y:{beginAtZero:!0,ticks:{callback:function(e){return"$"+new Intl.NumberFormat("es-MX").format(e)}}}}};return(0,HD.jsx)(_E,{data:n,options:i})},OR=()=>{const[e,t]=(0,i.useState)(!0),[n,s]=(0,i.useState)(""),[r,o]=(0,i.useState)(null),[a,l]=(0,i.useState)("kpis"),[u,d]=(0,i.useState)(0),[h,f]=(0,i.useState)(0);if((0,i.useEffect)(()=>{(async()=>{t(!0);try{const e=Qg(cg(KD,YD)),t=Qg(cg(KD,"facturas")),n=Qg(cg(KD,"usuarios"),$g("rol","==","tecnico")),i=Qg(cg(KD,"usuarios"),$g("roles","array-contains","tecnico")),[s,r,a,l]=await Promise.all([yy(e),yy(t),yy(n),yy(i)]),u=s.docs.map(e=>c({id:e.id},e.data())),d=r.docs.map(e=>c({id:e.id},e.data())),h=new Map;a.forEach(e=>h.set(e.id,c({id:e.id},e.data()))),l.forEach(e=>h.set(e.id,c({id:e.id},e.data())));const f=((e,t,n)=>{const i=(new Date).getFullYear(),s=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],r=new Date;r.setHours(0,0,0,0);const o=864e5,a=Array(12).fill(0).map(()=>({cotizacion:0,activo:0,pendienteFactura:0,total:0})),l=Array(12).fill(0).map(()=>({totalFacturado:0,pdteProgramacion:0,programado:0,venceHoy:0,vencido:0,pagado:0})),u=Array(12).fill(0),d=Array(12).fill(0),h=Array(8).fill(0).map(()=>({ingresos:0,egresos:0})),f=[],p=[],m=new Map(e.map(e=>[e.id,e])),g={};n.forEach(e=>{g[e.id]=e.nombreCompleto});const y={};n.forEach(e=>{y[e.id]={label:e.nombreCompleto.split(" ")[0],data:Array(12).fill(0)}});let v=0,b=0;e.forEach(e=>{var t,n,s,r,l,c;if(null!==(t=e.fechaApertura)&&void 0!==t&&t.toDate&&e.fechaApertura.toDate().getFullYear()===i){const t=e.fechaApertura.toDate().getMonth(),n=e.precioCotizacionCliente||0;switch(a[t].total+=n,e.estado){case"Cotizaci\xf3n":a[t].cotizacion+=n;break;case"Activo":case"Terminado Internamente":case"En Revisi\xf3n Final":a[t].activo+=n;break;case"Pendiente de Factura":a[t].pendienteFactura+=n}}const u=(null===(n=e.fase2_fechaFinTecnico)||void 0===n?void 0:n.toDate())||(null===(s=e.fase1_fechaFinTecnico)||void 0===s?void 0:s.toDate());if(u&&u.getFullYear()===i&&e.asignadoTecnicosIds&&e.asignadoTecnicosIds.length>0){const t=u.getMonth(),n=e.precioCotizacionCliente||0,i=e.asignadoTecnicosIds[0];y[i]&&(y[i].data[t]+=n)}if((e.precioCotizacionCliente||0)>0&&(e.costoProveedor||0)>=0)return(e.precioCotizacionCliente-e.costoProveedor)/e.precioCotizacionCliente;if(null!==(r=e.fechaAsignacionTecnico)&&void 0!==r&&r.toDate&&(null!==(l=e.fase1_fechaFinTecnico)&&void 0!==l&&l.toDate()||null!==(c=e.fechaFinTecnicoReal)&&void 0!==c&&c.toDate())){var d,h;const t=(null===(d=e.fase1_fechaFinTecnico)||void 0===d?void 0:d.toDate())||(null===(h=e.fechaFinTecnicoReal)||void 0===h?void 0:h.toDate());v+=(t-e.fechaAsignacionTecnico.toDate())/o,b++}}),t.forEach(e=>{var t;const n=e.monto||0;let s="Pend. de Autorizaci\xf3n",a=null;if("Pagada"===e.estado?s="Pagada":"Cancelada"===e.estado?s="Cancelada":null!==(t=e.fechaPromesaPago)&&void 0!==t&&t.toDate&&(a=e.fechaPromesaPago.toDate(),a.setHours(0,0,0,0),s=a<r?"Vencida":a.getTime()===r.getTime()?"Vence Hoy":"Prog. a Pago"),e.estado=s,"cliente"===e.tipo){var g,y;if(null!==(g=e.fechaEmision)&&void 0!==g&&g.toDate&&e.fechaEmision.toDate().getFullYear()===i){const t=e.fechaEmision.toDate().getMonth();switch("Cancelada"!==e.estado&&(l[t].totalFacturado+=n),e.estado){case"Pagada":l[t].pagado+=n;break;case"Vencida":l[t].vencido+=n;break;case"Vence Hoy":l[t].venceHoy+=n;break;case"Prog. a Pago":l[t].programado+=n;break;case"Pend. de Autorizaci\xf3n":l[t].pdteProgramacion+=n}}if("Pagada"===e.estado&&null!==(y=e.fechaPagoReal)&&void 0!==y&&y.toDate){const t=e.fechaPagoReal.toDate();t.getFullYear()===i&&(u[t.getMonth()]+=n)}!a||"Prog. a Pago"!==e.estado&&"Vencida"!==e.estado&&"Vence Hoy"!==e.estado||a.getFullYear()===i&&(d[a.getMonth()]+=n)}let v=-1;if("Vencida"===e.estado)v=0;else if("Prog. a Pago"===e.estado||"Vence Hoy"===e.estado){const e=Math.floor((a-r)/o),t=Math.floor(e/7);t>=0&&t<8&&(v=t)}v>=0&&("cliente"===e.tipo?h[v].ingresos+=n:h[v].egresos+=n);const b=e.proyectoId&&"general"!==e.proyectoId?m.get(e.proyectoId):null,x=c(c({},e),{},{planta:(null===b||void 0===b?void 0:b.ubicacionCliente)||(null===b||void 0===b?void 0:b.clienteNombre)||e.clienteNombre||e.proveedorNombre||"N/A",servicio:(null===b||void 0===b?void 0:b.servicioNombre)||e.descripcion||"Gasto General"});"cliente"===e.tipo&&f.push(x),"proveedor"===e.tipo&&p.push(x)});const x={avgDeliveryDays:b>0?(v/b).toFixed(1):0,monthlyBillingData:l,monthlyPaidData:u,monthlyProgrammedData:d},_=[];for(let c=0;c<8;c++){const e=new Date(r.getTime()+7*c*o);_.push("Sem ".concat(c+1," (").concat(e.getDate(),"/").concat(e.getMonth()+1,")"))}const w=["rgba(54, 162, 235, 1)","rgba(255, 99, 132, 1)","rgba(75, 192, 192, 1)","rgba(255, 206, 86, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],C=Object.values(y).map((e,t)=>c(c({},e),{},{borderColor:w[t%w.length],backgroundColor:w[t%w.length].replace("1)","0.2)"),fill:!0,tension:.1})),N=e.map(e=>{var t;const n=null===(t=e.asignadoTecnicosIds)||void 0===t?void 0:t[0];let i=e.estado,s=99;if("Activo"===e.estado)if(e.fechaFinTecnicoReal)i="En Espera de Proveedor",s=4;else{var o;const t=null===(o=e.fechaEntregaInterna)||void 0===o?void 0:o.toDate();if(t){t.setHours(0,0,0,0);const e=(t-r)/864e5;e<0?(i="Atrasado",s=1):e<=3?(i="Por Vencer",s=2):(i="A Tiempo",s=3)}else i="Sin Fecha",s=5}return c(c({},e),{},{responsableNombre:g[n]||"No Asignado",notaEntregaNumero:e.fase2_numeroNotaInterna||e.fase1_numeroNotaInterna||"N/A",fechaEntregaReal:e.fase1_fechaFinTecnico||e.fase2_fechaFinTecnico||e.fechaFinTecnicoReal,deliveryStatus:i,sortOrder:s})}),k=f.filter(e=>"Pagada"!==e.estado&&"Cancelada"!==e.estado).sort((e,t)=>{var n,i;return((null===(n=e.fechaPromesaPago)||void 0===n?void 0:n.toDate())||new Date("2999-12-31"))-((null===(i=t.fechaPromesaPago)||void 0===i?void 0:i.toDate())||new Date("2999-12-31"))}),E=p.filter(e=>"Pagada"!==e.estado&&"Cancelada"!==e.estado).sort((e,t)=>{var n,i;return((null===(n=e.fechaPromesaPago)||void 0===n?void 0:n.toDate())||new Date("2999-12-31"))-((null===(i=t.fechaPromesaPago)||void 0===i?void 0:i.toDate())||new Date("2999-12-31"))});return{kpis:x,pipeline:{labels:s,cotizacionData:a.map(e=>e.cotizacion),activoData:a.map(e=>e.activo),pendienteFacturaData:a.map(e=>e.pendienteFactura),totalData:a.map(e=>e.total)},accountsReceivable:{labels:s,totalFacturadoData:l.map(e=>e.totalFacturado),pagadoData:l.map(e=>e.pagado),programadoData:l.map(e=>e.programado),venceHoyData:l.map(e=>e.venceHoy),vencidoData:l.map(e=>e.vencido),pdteProgramacionData:l.map(e=>e.pdteProgramacion)},cashFlow:{labels:_,ingresosData:h.map(e=>e.ingresos),egresosData:h.map(e=>e.egresos)},techRevenueChart:{labels:s,datasets:C},allOperationalProjects:N,techniciansMap:g,accountsReceivableList:k,accountsPayableList:E,projectsMap:m}})(u,d,Array.from(h.values()));o(f)}catch(e){console.error("Error al obtener datos para el dashboard directivo:",e),s("No se pudieron cargar las m\xe9tricas.")}finally{t(!1)}})()},[]),e)return(0,HD.jsx)("div",{className:"text-center py-10",children:"Calculando m\xe9tricas... \u2699\ufe0f"});if(n)return(0,HD.jsx)("div",{className:"text-center py-10 text-red-600",children:n});return(0,HD.jsxs)("div",{className:"space-y-8",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard Directivos"}),(0,HD.jsx)("p",{className:"text-gray-600",children:"Vista general de la salud y rendimiento del negocio."})]}),(0,HD.jsx)("div",{className:"mb-6 border-b border-gray-200",children:(0,HD.jsxs)("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[(0,HD.jsx)("button",{onClick:()=>l("kpis"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("kpis"===a?"border-blue-500 text-blue-600":"border-transparent text-gray-500"),children:"M\xe9tricas y Finanzas"}),(0,HD.jsx)("button",{onClick:()=>l("operativo"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("operativo"===a?"border-blue-500 text-blue-600":"border-transparent text-gray-500"),children:"Seguimiento Operativo"}),(0,HD.jsx)("button",{onClick:()=>l("cobrar"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("cobrar"===a?"border-blue-500":"border-transparent text-gray-500"),children:"Cuentas por Cobrar"}),(0,HD.jsx)("button",{onClick:()=>l("pagar"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("pagar"===a?"border-blue-500":"border-transparent text-gray-500"),children:"Cuentas por Pagar"})]})}),"kpis"===a&&(0,HD.jsxs)(HD.Fragment,{children:[(null===r||void 0===r?void 0:r.kpis)&&(0,HD.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5",children:[(0,HD.jsx)(IR,{title:"Tiempo Prom. Entrega",value:r.kpis.avgDeliveryDays,unit:"d\xedas"}),(()=>{const e=(new Date).getMonth(),t=r.kpis.monthlyProgrammedData[e],n=jR[e];return(0,HD.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-md",children:[(0,HD.jsxs)("h3",{className:"font-bold text-gray-500",children:["Programado (",n,")"]}),(0,HD.jsx)("p",{className:"text-3xl font-bold mt-2",children:t.toLocaleString("es-MX",{style:"currency",currency:"MXN"})})]})})(),(()=>{const e=(new Date).getMonth(),t=r.kpis.monthlyPaidData,n=(e-h+12)%12,i=t[n],s=jR[n];return(0,HD.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-md relative",children:[(0,HD.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,HD.jsxs)("h3",{className:"font-bold text-gray-500",children:["Ingresos (",s,")"]}),(0,HD.jsxs)("div",{className:"flex space-x-1",children:[(0,HD.jsx)("button",{onClick:()=>f(e=>(e+1)%3),children:"\u2190"}),(0,HD.jsx)("button",{onClick:()=>f(e=>(e-1+3)%3),children:"\u2192"})]})]}),(0,HD.jsx)("p",{className:"text-3xl font-bold mt-2",children:i.toLocaleString("es-MX",{style:"currency",currency:"MXN"})})]})})(),(()=>{const e=(new Date).getMonth(),t=r.kpis.monthlyBillingData,n=(e-u+12)%12,i=t[n].totalFacturado,s=jR[n];return(0,HD.jsxs)("div",{className:"bg-white p-5 rounded-xl shadow-md relative",children:[(0,HD.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,HD.jsxs)("h3",{className:"font-bold text-gray-500",children:["Facturado (",s,")"]}),(0,HD.jsxs)("div",{className:"flex space-x-1",children:[(0,HD.jsx)("button",{onClick:()=>d(e=>(e+1)%3),className:"bg-gray-200 hover:bg-gray-300 text-gray-700 w-6 h-6 rounded-full flex items-center justify-center",title:"Mes anterior",children:"\u2190"}),(0,HD.jsx)("button",{onClick:()=>d(e=>(e-1+3)%3),className:"bg-gray-200 hover:bg-gray-300 text-gray-700 w-6 h-6 rounded-full flex items-center justify-center",title:"Mes siguiente",children:"\u2192"})]})]}),(0,HD.jsx)("p",{className:"text-3xl font-bold mt-2",children:i.toLocaleString("es-MX",{style:"currency",currency:"MXN"})})]})})()]}),(0,HD.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[(0,HD.jsx)("h3",{className:"font-bold text-lg mb-4",children:"Pipeline de Proyectos (Mensual)"}),(0,HD.jsx)("div",{className:"h-80",children:(null===r||void 0===r?void 0:r.pipeline)&&(0,HD.jsx)(ER,{chartData:r.pipeline})})]}),(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[(0,HD.jsx)("h3",{className:"font-bold text-lg mb-4",children:"Salud de Cuentas por Cobrar (Mensual)"}),(0,HD.jsx)("div",{className:"h-80",children:(null===r||void 0===r?void 0:r.accountsReceivable)&&(0,HD.jsx)(TR,{chartData:r.accountsReceivable})})]}),(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[(0,HD.jsx)("h3",{className:"font-bold text-lg mb-4",children:"Flujo de Caja Proyectado (Pr\xf3ximas 8 Semanas)"}),(0,HD.jsx)("div",{className:"h-80",children:(null===r||void 0===r?void 0:r.cashFlow)&&(0,HD.jsx)(SR,{chartData:r.cashFlow})})]}),(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[(0,HD.jsx)("h3",{className:"font-bold text-lg mb-4",children:"Monto Entregado por T\xe9cnico (Mensual)"}),(0,HD.jsx)("div",{className:"h-80",children:(null===r||void 0===r?void 0:r.techRevenueChart)&&(0,HD.jsx)(MR,{chartData:r.techRevenueChart})})]})]})]}),"operativo"===a&&r&&(0,HD.jsx)(AR,{projects:r.allOperationalProjects,techniciansMap:r.techniciansMap}),"cobrar"===a&&r&&(0,HD.jsx)(DR,{title:"Cuentas por Cobrar",invoices:r.accountsReceivableList,getInvoiceStatusBadge:e=>(0,HD.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat({Pagada:"bg-green-100 text-green-800",Vencida:"bg-red-100 text-red-800","Prog. a Pago":"bg-blue-100 text-blue-800","Pend. de Autorizaci\xf3n":"bg-yellow-100 text-yellow-800",Cancelada:"bg-gray-100 text-gray-700"}[e]||"bg-gray-100"),children:e})}),"pagar"===a&&r&&(0,HD.jsx)(RR,{invoices:r.accountsPayableList,projectsMap:r.projectsMap})]})},LR=()=>{const[e,t]=(0,i.useState)([]),[n,s]=(0,i.useState)(!0),r=()=>{s(!0);const e=_y(Qg(cg(KD,YD),$g("proveedorNombre","==","Ecotech Ingenieria del Medio Ambiente"),$g("estado","==","Activo")),e=>{t(e.docs.map(e=>c({id:e.id},e.data()))),s(!1)},e=>{console.error("Error fetching projects for Ecotech: ",e),s(!1)});return e};return(0,i.useEffect)(()=>{const e=r();return()=>e()},[]),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Gesti\xf3n de Proyectos Ecotech"}),n?(0,HD.jsx)("p",{children:"Cargando proyectos de Ecotech..."}):0===e.length?(0,HD.jsx)("p",{className:"text-center text-gray-500 mt-8",children:"No hay proyectos de Ecotech activos."}):(0,HD.jsx)(FR,{projects:e,onUpdateProject:r})]})},FR=e=>{let{projects:t,onUpdateProject:n}=e;const[s,r]=(0,i.useState)(null),[o,a]=(0,i.useState)(""),[l,c]=(0,i.useState)(1),[u,d]=(0,i.useState)(10),h=e=>{var t,n,s,r,o,a,l,c;let{project:u,onClose:d,onFinalized:h}=e;const[f,p]=(0,i.useState)((null===(t=u.datosEcotech)||void 0===t?void 0:t.numeroProyecto)||""),[m,g]=(0,i.useState)((null===(n=u.datosEcotech)||void 0===n?void 0:n.puntosDeTrabajo)||""),[y,v]=(0,i.useState)((null===(s=u.datosEcotech)||void 0===s?void 0:s.notas)||""),[b,x]=(0,i.useState)((null===(r=u.datosEcotech)||void 0===r?void 0:r.numeroGuiaEnvio)||""),[_,w]=(0,i.useState)((null===(o=u.datosEcotech)||void 0===o?void 0:o.numeroGuiaRegreso)||""),[C,N]=(0,i.useState)((null===(a=u.datosEcotech)||void 0===a?void 0:a.fechaMuestreo)||""),[k,E]=(0,i.useState)(!1),T=(null===(l=u.datosEcotech)||void 0===l?void 0:l.estatus)||"Pendiente",S=async e=>{E(!0);const t=ug(KD,YD,u.id);try{await by(t,e),h(),d()}catch(n){alert("Error al actualizar el estado."),E(!1)}};return(0,HD.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg",children:[(0,HD.jsxs)("h3",{className:"text-lg font-bold mb-2",children:["Gestionar Proyecto Ecotech: ",u.npu]}),(0,HD.jsxs)("p",{className:"text-sm text-gray-500 mb-6",children:["Estado actual: ",(0,HD.jsx)("span",{className:"font-bold",children:(null===(c=u.datosEcotech)||void 0===c?void 0:c.estatus)||"Pendiente"})]}),"Pendiente"===T&&(0,HD.jsx)("button",{onClick:()=>S({"datosEcotech.estatus":"Pend. No de proyecto"}),className:"w-full bg-blue-600 text-white font-bold py-3 rounded-lg mb-4",children:"Empezar Tarea"}),"Pend. No de proyecto"===T&&(0,HD.jsxs)("div",{className:"p-4 border rounded-md bg-gray-50 mb-4",children:[(0,HD.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Introduce la Fecha de Muestreo"}),(0,HD.jsx)("input",{type:"date",value:C,onChange:e=>N(e.target.value),className:"mt-1 block w-full px-3 py-2 border rounded-md"}),(0,HD.jsx)("button",{onClick:()=>S({"datosEcotech.estatus":"En Proceso","datosEcotech.fechaMuestreo":Sc.fromDate(new Date(C))}),disabled:!C,className:"w-full mt-3 bg-blue-600 text-white font-bold py-2 rounded-lg disabled:bg-gray-400",children:'Guardar Fecha y Poner "En Proceso"'})]}),"En Proceso"===T&&(0,HD.jsx)("button",{onClick:()=>S({"datosEcotech.estatus":"Enviado Dig.","datosEcotech.fechaEnvioDigital":Sc.now()}),className:"w-full bg-blue-600 text-white font-bold py-3 rounded-lg mb-4",children:'Marcar como "Enviado Digitalmente"'}),"Enviado Dig."===T&&(0,HD.jsxs)("div",{className:"p-4 border rounded-md bg-gray-50 mb-4",children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"Introduce la Gu\xeda de Env\xedo F\xedsico"}),(0,HD.jsx)("input",{type:"text",value:b,onChange:e=>x(e.target.value),placeholder:"N\xfamero de gu\xeda...",className:"mt-1 block w-full px-3 py-2 border rounded-md"}),(0,HD.jsx)("button",{onClick:()=>S({"datosEcotech.estatus":"Enviado F\xedsicamente","datosEcotech.numeroGuiaEnvio":b}),disabled:!b,className:"w-full mt-3 bg-blue-600 text-white font-bold py-2 rounded-lg disabled:bg-gray-400",children:'Marcar como "Enviado F\xedsicamente"'})]}),"Enviado F\xedsicamente"===T&&(0,HD.jsxs)("div",{className:"p-4 border rounded-md bg-gray-50 mb-4",children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"Introduce la Gu\xeda de Regreso para Finalizar"}),(0,HD.jsx)("input",{type:"text",value:_,onChange:e=>w(e.target.value),placeholder:"N\xfamero de gu\xeda...",className:"mt-1 block w-full px-3 py-2 border rounded-md"}),(0,HD.jsx)("button",{onClick:()=>S({"datosEcotech.estatus":"Terminado","datosEcotech.numeroGuiaRegreso":_}),disabled:!_,className:"w-full mt-3 bg-green-600 text-white font-bold py-2 rounded-lg disabled:bg-gray-400",children:"Finalizar Proyecto"})]}),(0,HD.jsxs)("div",{className:"space-y-4",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"N\xfamero de Proyecto (Laboratorio)"}),(0,HD.jsx)("input",{type:"text",value:f,onChange:e=>p(e.target.value),className:"mt-1 block w-full px-3 py-2 border rounded-md"})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"Puntos de Trabajo"}),(0,HD.jsx)("input",{type:"number",value:m,onChange:e=>g(e.target.value),className:"mt-1 block w-full px-3 py-2 border rounded-md"})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"N\xba de Gu\xeda (Env\xedo)"}),(0,HD.jsx)("input",{type:"text",value:b,onChange:e=>x(e.target.value),className:"mt-1 block w-full px-3 py-2 border rounded-md"})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"N\xba de Gu\xeda (Regreso)"}),(0,HD.jsx)("input",{type:"text",value:_,onChange:e=>w(e.target.value),className:"mt-1 block w-full px-3 py-2 border rounded-md"})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"Notas"}),(0,HD.jsx)("textarea",{value:y,onChange:e=>v(e.target.value),rows:"3",className:"mt-1 block w-full px-3 py-2 border rounded-md"})]})]}),(0,HD.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,HD.jsx)("button",{onClick:d,className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded",children:"Cerrar"}),(0,HD.jsx)("button",{onClick:async()=>{E(!0);const e=ug(KD,YD,u.id);try{await by(e,{"datosEcotech.numeroProyecto":f,"datosEcotech.puntosDeTrabajo":Number(m)||0,"datosEcotech.notas":y,"datosEcotech.numeroGuiaEnvio":b,"datosEcotech.numeroGuiaRegreso":_,"datosEcotech.estatus":T}),h()}catch(t){alert("No se pudieron guardar los cambios.")}finally{E(!1)}},className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded",children:k?"Guardando...":"Guardar Cambios"})]})]})})},f=t.filter(e=>e.npu&&e.npu.toLowerCase().includes(o.toLowerCase())||e.clienteNombre&&e.clienteNombre.toLowerCase().includes(o.toLowerCase())||e.servicioNombre&&e.servicioNombre.toLowerCase().includes(o.toLowerCase())),p=l*u,m=p-u,g=f.slice(m,p),y=Math.ceil(f.length/u),v=e=>c(e);return(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsxs)("div",{className:"mb-4 flex flex-col md:flex-row justify-between items-center",children:[(0,HD.jsx)("input",{type:"text",placeholder:"Buscar por NPU, cliente o servicio...",className:"w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md mb-2 md:mb-0",onChange:e=>{a(e.target.value),c(1)}}),(0,HD.jsxs)("div",{className:"flex items-center",children:[(0,HD.jsx)("span",{className:"text-sm mr-2",children:"Mostrar:"}),(0,HD.jsxs)("select",{value:u,onChange:e=>{d(Number(e.target.value)),c(1)},className:"px-2 py-1 border border-gray-300 rounded-md",children:[(0,HD.jsx)("option",{value:10,children:"10"}),(0,HD.jsx)("option",{value:25,children:"25"}),(0,HD.jsx)("option",{value:50,children:"50"})]})]})]}),(0,HD.jsx)("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:(0,HD.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,HD.jsx)("thead",{className:"bg-gray-50",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"NPU"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cliente"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Servicio"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"N\xba Proyecto Lab."}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Puntos"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Notas"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Gu\xeda Env\xedo"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Gu\xeda Regreso"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estatus Interno"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),(0,HD.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(e=>{var t,n,i,s,o,a;const l=(e=>{var t,n,i,s,r,o;const a=new Date;return a.setHours(0,0,0,0),"Terminado"===(null===(t=e.datosEcotech)||void 0===t?void 0:t.estatus)?{text:"Terminado",class:"bg-blue-100 text-blue-800"}:null!==(n=e.datosEcotech)&&void 0!==n&&null!==(i=n.fechaEnvioDigital)&&void 0!==i&&i.toDate?a>tR(null===(l=e.datosEcotech)||void 0===l?void 0:l.fechaEnvioDigital.toDate(),15)?{text:"Vencido Lab.",class:"bg-red-100 text-red-800 font-bold"}:{text:null===(c=e.datosEcotech)||void 0===c?void 0:c.estatus,class:"bg-green-100 text-green-800"}:null!==(s=e.datosEcotech)&&void 0!==s&&null!==(r=s.fechaMuestreo)&&void 0!==r&&r.toDate?a>tR(null===(u=e.datosEcotech)||void 0===u?void 0:u.fechaMuestreo.toDate(),3)?{text:"Vencido Internamente",class:"bg-orange-100 text-orange-800 font-semibold"}:{text:null===(d=e.datosEcotech)||void 0===d?void 0:d.estatus,class:"bg-green-100 text-green-800"}:{text:(null===(o=e.datosEcotech)||void 0===o?void 0:o.estatus)||"Pendiente",class:"bg-gray-100 text-gray-700"};var l,c,u,d})(e);return(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.npu}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.clienteNombre}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.servicioNombre}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(null===(t=e.datosEcotech)||void 0===t?void 0:t.numeroProyecto)||"---"}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(null===(n=e.datosEcotech)||void 0===n?void 0:n.puntosDeTrabajo)||"---"}),(0,HD.jsx)("td",{className:"px-6 py-4 text-sm text-gray-500",title:null===(i=e.datosEcotech)||void 0===i?void 0:i.notas,children:(0,HD.jsx)("p",{className:"w-40 truncate",children:(null===(s=e.datosEcotech)||void 0===s?void 0:s.notas)||"---"})}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(null===(o=e.datosEcotech)||void 0===o?void 0:o.numeroGuiaEnvio)||"---"}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(null===(a=e.datosEcotech)||void 0===a?void 0:a.numeroGuiaRegreso)||"---"}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,HD.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(l.class),children:l.text})}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,HD.jsx)("button",{onClick:()=>r(e),className:"text-indigo-600 hover:text-indigo-900",children:"Gestionar"})})]},e.id)})})]})}),(0,HD.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,HD.jsxs)("span",{className:"text-sm text-gray-700",children:["P\xe1gina ",l," de ",y]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("button",{onClick:()=>v(l-1),disabled:1===l,className:"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50",children:"Anterior"}),(0,HD.jsx)("button",{onClick:()=>v(l+1),disabled:l===y||0===y,className:"px-3 py-1 border rounded-md bg-white disabled:opacity-50",children:"Siguiente"})]})]}),s&&(0,HD.jsx)(h,{project:s,onClose:()=>r(null),onFinalized:n})]})},zR=e=>{let{techData:t}=e;const{nombre:n,proyectosActivos:i,proyectosEntregados:s,horasAsignadas:r,capacidadSemanal:o,saturacion:a,diasParaTerminar:l,proyectosFase2Pendiente:c}=t;return(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200 flex flex-col space-y-4",children:[(0,HD.jsx)("h3",{className:"text-xl font-bold text-gray-800 truncate",children:n}),(0,HD.jsxs)("div",{children:[(0,HD.jsxs)("div",{className:"flex justify-between text-sm font-medium text-gray-600",children:[(0,HD.jsx)("span",{children:"Saturaci\xf3n (Horas Semanales)"}),(0,HD.jsxs)("span",{children:[r.toFixed(1),"h / ",o,"h"]})]}),(0,HD.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-4 mt-1",children:(0,HD.jsx)("div",{className:"h-4 rounded-full ".concat((u=a,u>100?"bg-red-500":u>85?"bg-yellow-500":"bg-green-500")),style:{width:"".concat(Math.min(a,100),"%")}})}),a>100&&(0,HD.jsxs)("p",{className:"text-xs text-red-600 font-semibold mt-1",children:["\xa1Sobrecargado por ",(a-100).toFixed(0),"%!"]})]}),(0,HD.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-center border-t border-b py-4",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("p",{className:"text-2xl font-bold",children:i}),(0,HD.jsx)("p",{className:"text-sm text-gray-500",children:"Activos"})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("p",{className:"text-2xl font-bold",children:s}),(0,HD.jsx)("p",{className:"text-sm text-gray-500",children:"Entregados (2025)"})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("p",{className:"text-2xl font-bold",children:l.toFixed(1)}),(0,HD.jsx)("p",{className:"text-sm text-gray-500",children:"D\xedas para Terminar"})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("p",{className:"text-2xl font-bold text-gray-600",children:c}),(0,HD.jsx)("p",{className:"text-sm text-gray-500",children:"Pend. resolutivo"})]})]})]});var u},UR=e=>{let{user:t,userData:n,selectedRole:s}=e;const[r,o]=(0,i.useState)("new"),[a,l]=(0,i.useState)([]),[u,d]=(0,i.useState)([]),[h,f]=(0,i.useState)([]),[p,m]=(0,i.useState)([]),[g,y]=(0,i.useState)(!0),[v,b]=(0,i.useState)(null),[x,_]=(0,i.useState)(null),w=async()=>{try{const e=Qg(cg(KD,YD),$g("estado","!=","Cotizaci\xf3n")),t=Qg(cg(KD,"usuarios"),$g("rol","==","tecnico")),n=Qg(cg(KD,"usuarios"),$g("roles","array-contains","tecnico")),i=Qg(cg(KD,YD),$g("estado","==","En Revisi\xf3n Final")),s=Qg(cg(KD,"solicitudesVacaciones"),$g("estado","==","Pendiente Supervisor")),[r,o,a,u,h]=await Promise.all([yy(e),yy(t),yy(n),yy(i),yy(s)]),p=r.docs.map(e=>c({id:e.id},e.data()));l(p);const g=new Map;o.forEach(e=>g.set(e.id,c({id:e.id},e.data()))),a.forEach(e=>g.set(e.id,c({id:e.id},e.data()))),d(Array.from(g.values())),f(u.docs.map(e=>c({id:e.id},e.data()))),m(h.docs.map(e=>c({id:e.id},e.data())))}catch(e){console.error("Error fetching supervisor data:",e)}finally{y(!1)}};(0,i.useEffect)(()=>{y(!0),w()},[]);const C=i.useMemo(()=>{if(0===u.length)return{healthData:[],newProjects:[],projectsByTechnician:{},projectsForReview:[]};const e={};u.forEach(t=>{e[t.id]=a.filter(e=>{var n;return"Activo"===e.estado&&(null===(n=e.asignadoTecnicosIds)||void 0===n?void 0:n.includes(t.id))})});const t=u.map(e=>{const t=a.filter(t=>{var n;return null===(n=t.asignadoTecnicosIds)||void 0===n?void 0:n.includes(e.id)}),n=t.filter(e=>"Activo"===e.estado&&!e.fechaFinTecnicoReal),i=t.filter(e=>"Activo"===e.estado&&"Fase 2 Pendiente"===e.faseFacturacion).length,s=n.reduce((e,t)=>e+Math.max(0,(t.horasEstimadas||0)-(t.horasRegistradas||0)),0),r=5*(e.horasDisponiblesDiarias||8),o=r>0?s/r*100:0,l=(e.horasDisponiblesDiarias||8)>0?s/(e.horasDisponiblesDiarias||8):0,c=a.filter(t=>{var n,i;return(null===(n=t.asignadoTecnicosIds)||void 0===n?void 0:n.includes(e.id))&&("Archivado"===t.estado||"Facturado"===t.estado)&&(null===(i=t.fase1_fechaFinTecnico||t.fechaFinTecnicoReal)||void 0===i?void 0:i.toDate().getFullYear())===(new Date).getFullYear()}).length;return{id:e.id,nombre:e.nombreCompleto,proyectosActivos:n.length,proyectosEntregados:c,horasAsignadas:s,capacidadSemanal:r,saturacion:o,diasParaTerminar:l,proyectosFase2Pendiente:i}}),n=a.filter(e=>"Activo"===e.estado&&(!e.asignadoTecnicosIds||0===e.asignadoTecnicosIds.length)),i=a.filter(e=>"En Revisi\xf3n Final"===e.estado);for(const s in e)e[s].sort((e,t)=>(t.prioridad||"").localeCompare(e.prioridad||""));return{healthData:t,newProjects:n,projectsByTechnician:e,projectsForReview:i}},[a,u]);return(0,HD.jsxs)("div",{children:[(0,HD.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Panel de Supervisi\xf3n"}),g?(0,HD.jsx)("p",{children:"Calculando m\xe9tricas del equipo..."}):(0,HD.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-[1fr,3fr] gap-8",children:[(0,HD.jsxs)("div",{className:"space-y-4",children:[(0,HD.jsx)("h2",{className:"text-lg font-semibold text-gray-700",children:"Vistas de Gesti\xf3n"}),(0,HD.jsx)("button",{onClick:()=>o("new"),className:"w-full p-3 rounded-lg text-left transition-colors ".concat("new"===r?"bg-blue-600 text-white shadow-lg":"bg-white hover:bg-gray-50"),children:(0,HD.jsxs)("div",{className:"flex justify-between items-center",children:[(0,HD.jsx)("span",{className:"font-bold",children:"Nuevos por Asignar"}),C.newProjects.length>0&&(0,HD.jsx)("span",{className:"px-2 py-0.5 text-xs font-bold text-white bg-red-500 rounded-full",children:C.newProjects.length})]})}),(0,HD.jsx)("button",{onClick:()=>o("review"),className:"w-full p-3 rounded-lg text-left transition-colors ".concat("review"===r?"bg-blue-600 text-white shadow-lg":"bg-white hover:bg-gray-50"),children:(0,HD.jsxs)("div",{className:"flex justify-between items-center",children:[(0,HD.jsx)("span",{className:"font-bold",children:"Revisi\xf3n Final"}),h.length>0&&(0,HD.jsx)("span",{className:"px-2 py-0.5 text-xs font-bold text-white bg-red-500 rounded-full",children:h.length})]})}),(0,HD.jsx)("button",{onClick:()=>o("vacations"),className:"w-full p-3 rounded-lg text-left transition-colors ".concat("vacations"===r?"bg-blue-600 text-white shadow-lg":"bg-white hover:bg-gray-50"),children:(0,HD.jsxs)("div",{className:"flex justify-between items-center",children:[(0,HD.jsx)("span",{className:"font-bold",children:"Solicitudes Vacaciones"}),p.length>0&&(0,HD.jsx)("span",{className:"px-2 py-0.5 text-xs font-bold text-white bg-red-500 rounded-full",children:p.length})]})}),(0,HD.jsx)("hr",{className:"my-4"}),(0,HD.jsx)("h2",{className:"text-lg font-semibold text-gray-700",children:"Equipo T\xe9cnico"}),(0,HD.jsx)("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto pr-2",children:C.healthData.map(e=>(0,HD.jsx)("button",{onClick:()=>o(e.id),className:"w-full text-left transition-colors ".concat(r===e.id?"ring-2 ring-blue-500":""),children:(0,HD.jsx)(zR,{techData:e})},e.id))})]}),(0,HD.jsxs)("div",{className:"min-w-0",children:["new"===r&&(0,HD.jsx)(wR,{projects:C.newProjects,userRole:"supervisor",supervisorView:"new",onAssignClick:_,user:t,userData:n,selectedRole:s}),"review"===r&&(0,HD.jsx)(CR,{projects:h,onUpdateProject:w}),"vacations"===r&&(0,HD.jsx)(yR,{requests:p,viewerRole:"supervisor",onActionComplete:w}),C.projectsByTechnician[r]&&(0,HD.jsx)(wR,{projects:C.projectsByTechnician[r],userRole:"supervisor",supervisorView:"techDetail",onManageClick:b,onAssignClick:_,user:t,userData:n,selectedRole:s})]})]}),v&&(0,HD.jsx)(aR,{project:v,onClose:()=>b(null),onUpdate:w,user:t,userData:n,userRole:"supervisor"}),x&&(0,HD.jsx)(oR,{project:x,onClose:()=>_(null),onFinalized:w})]})},VR=e=>{var t;let{user:n,userData:s,selectedRole:r,setIsWorkingState:o}=e;const[a,l]=(0,i.useState)([]),[u,d]=(0,i.useState)(!0),[h,f]=(0,i.useState)(null),[p,m]=(0,i.useState)(null),[g,y]=(0,i.useState)(!0),[v,b]=(0,i.useState)(null),[x,_]=(0,i.useState)(""),[w,C]=(0,i.useState)(null),[N,k]=(0,i.useState)(!0),E=(T=null===s||void 0===s||null===(t=s.ultimoDescanso)||void 0===t?void 0:t.toDate(),S=new Date,!(!T||!S)&&T.getFullYear()===S.getFullYear()&&T.getMonth()===S.getMonth()&&T.getDate()===S.getDate());var T,S;const I=i.useCallback(async e=>{const t=ug(KD,"usuarios",n.uid),i={projectId:e,inicio:Sc.now()};if(h&&h.projectId){const e=ug(cg(KD,"registrosDeTiempo"));await vy(e,{tecnicoId:n.uid,projectId:h.projectId,fechaInicio:h.inicio,fechaFin:Sc.now()})}const s=ug(KD,YD,e);await by(s,{["tecnicosStatus.".concat(n.uid)]:"En Proceso"}),await by(t,{tareaActiva:i})},[n,h]),P=i.useCallback(async()=>{if(!h)return;const e=ug(KD,"usuarios",n.uid),t=ug(cg(KD,"registrosDeTiempo"));await vy(t,{tecnicoId:n.uid,projectId:h.projectId,fechaInicio:h.inicio,fechaFin:Sc.now()}),await by(e,{tareaActiva:Iy()})},[n,h]),j=i.useCallback(async()=>{h&&await P(),ZE.info("Tu jornada finalizo el cron\xf3metro se ha detenido.")},[h,P]),A=i.useCallback(async()=>{if(!h)return;await P();const e=ug(KD,"usuarios",n.uid);await by(e,{enDescanso:{inicio:Sc.now(),proyectoPausadoId:h.projectId},ultimoDescanso:Sc.now()})},[h,P,n.uid]),D=i.useCallback(async()=>{if(!p||null===n||void 0===n||!n.uid)return;const e=ug(KD,"usuarios",n.uid);await I(p.proyectoPausadoId),await by(e,{enDescanso:Iy()})},[p,I,n]);(0,i.useEffect)(()=>{if(null===n||void 0===n||!n.uid)return y(!1),f(null),m(null),void o(!1);y(!0);const e=_y(ug(KD,"usuarios",n.uid),async e=>{const t=e.data(),n=null===t||void 0===t?void 0:t.tareaActiva,i=null===t||void 0===t?void 0:t.enDescanso;if(m(i||null),n&&n.projectId)try{const e=ug(KD,YD,n.projectId),t=await my(e);f(c(c({},n),{},{projectId:t.id,projectDetails:t.exists()?c({id:t.id},t.data()):null})),o(!0)}catch(s){console.error("Error fetching active project details:",s),f(null),o(!1)}else f(null),o(!1);i&&o(!1),y(!1)},e=>{console.error("Error listening to user document:",e),y(!1),f(null),m(null),o(!1)});return()=>e()},[n,o]),(0,i.useEffect)(()=>{if(!p)return;const e=p.inicio.toMillis()+45e5-Date.now();if(e<=0)return void D();const t=setTimeout(D,e);return()=>clearTimeout(t)},[p,D]),(0,i.useEffect)(()=>{if(null===n||void 0===n||!n.uid)return l([]),void d(!1);d(!0);const e=_y(Qg(cg(KD,YD),$g("asignadoTecnicosIds","array-contains",n.uid),$g("estado","==","Activo")),e=>{l(e.docs.map(e=>c({id:e.id},e.data()))),d(!1)},e=>{console.error("Error fetching technician projects:",e),l([]),d(!1)});return()=>e()},[n]);const R=e=>{C({title:"Confirmar para finalizar la parte T\xe9cnica",message:"Esta acci\xf3n registrar\xe1 el dia de hoy como la fecha de termino de tu proyecto, seguira activo hasta que generes la nota de entrega.",onConfirm:()=>(async e=>{const t=ug(KD,YD,e);try{await by(t,{fechaFinTecnicoReal:Sc.now()}),ZE.success("Tarea t\xe9cnica finalizada y registrada.")}catch(n){alert("Error al finalizar la tarea t\xe9cnica.")}C(null)})(e),confirmText:"S\xed, Finalizar"})},{newProjectsCount:M,kanbanProjects:O}=i.useMemo(()=>{if(null===n||void 0===n||!n.uid)return{newProjectsCount:0,kanbanProjects:[]};const e=a.sort((e,t)=>(t.prioridad||"").localeCompare(e.prioridad||"")),t=a.filter(e=>{var t;return"No Visto"===(null===(t=e.tecnicosStatus)||void 0===t?void 0:t[n.uid])}).length;return{newProjectsCount:t,kanbanProjects:e}},[a,n]),L=e=>{let{project:t,onClose:n,onFinalized:s}=e;const[r,o]=(0,i.useState)(""),[a,l]=(0,i.useState)(null),[c,u]=(0,i.useState)(!1),[d,h]=(0,i.useState)("");return(0,HD.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg",children:[(0,HD.jsxs)("h3",{className:"text-lg font-bold mb-4",children:["Gestionar Tarea: ",t.npu]}),(0,HD.jsxs)("div",{className:"space-y-4",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Comentarios Finales (para Nota de Entrega)"}),(0,HD.jsx)("textarea",{value:r,onChange:e=>o(e.target.value),rows:"4",className:"mt-1 block w-full px-3 py-2 border rounded-md"})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Subir Evidencia T\xe9cnica (PDF)"}),(0,HD.jsx)("input",{type:"file",accept:".pdf",onChange:e=>{e.target.files[0]&&l(e.target.files[0])},className:"mt-1 block w-full text-sm"})]})]}),(0,HD.jsx)(eR,{message:d,type:"error",onClose:()=>h("")}),(0,HD.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,HD.jsx)("button",{onClick:n,disabled:c,className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded",children:"Cancelar"}),(0,HD.jsx)("button",{onClick:async()=>{if(a){u(!0),h("");try{const e=rb(ab(QD,"evidencia_tecnicos/".concat(t.id,"/").concat(Date.now(),"_").concat(a.name)),a),i=await ob((await e).ref),{numeroNota:o}=await(async()=>{if("undefined"===typeof window.jspdf)throw new Error("La librer\xeda para generar PDFs (jsPDF) no se ha cargado.");const{jsPDF:e}=window.jspdf,n=new e,i=(new Date).getFullYear(),s=ug(KD,"contadores","notas_entrega_".concat(i)),o=await Sy(KD,async e=>{const t=await e.get(s),n=(t.exists()?t.data().consecutivo:0)+1;return e.set(s,{consecutivo:n},{merge:!0}),n}),a="".concat(i,"-").concat(o.toString().padStart(4,"0")),l=await fetch("https://www.grupoevelsa.com/assets/images/Logo Evelsa 2.png"),c=await l.blob(),u=new FileReader;await new Promise((e,t)=>{u.onload=e,u.onerror=t,u.readAsDataURL(c)});const d=u.result;n.addImage(d,"PNG",15,15,50,15),n.setFont("helvetica","bold"),n.setFontSize(10),n.text("ECOLOG\xcdA Y ASESOR\xcdA AMBIENTAL S. DE R.L. DE C.V.",105,35,{align:"center"}),n.setFont("helvetica","normal"),n.setFontSize(8),n.text("HERMANOS ESCOBAR 6150-2 PARQUE INDUSTRIAL OMEGA",105,40,{align:"center"}),n.text("CP.32410 CD. JU\xc1REZ, CHIHUAHUA. RFC EAA12060765A",105,44,{align:"center"}),n.setFontSize(16),n.setFont("helvetica","bold"),n.text("NOTA DE ENTREGA",105,55,{align:"center"}),n.text(a,180,65),n.setFontSize(11),n.setFont("helvetica","normal"),n.text("FECHA: ".concat((new Date).toLocaleDateString("es-MX")),20,75),n.text("PROYECTO: ".concat(t.npu),20,85),n.text("NOMBRE/RAZ\xd3N SOCIAL: ".concat(t.clienteNombre),20,95),n.rect(15,105,180,40),n.text("DESCRIPCI\xd3N",20,111),n.text("CANTIDAD",170,111);const h=n.splitTextToSize(t.servicioNombre,145);n.text(h,20,118),n.text("1",175,118),n.text("Comentarios:",20,155);const f=n.splitTextToSize(r,170);return n.text(f,20,162),n.text("RECIBIDO POR:",20,250),n.line(20,260,100,260),n.text("NOMBRE Y FIRMA",45,265),n.save("Nota_Entrega_".concat(a,".pdf")),{numeroNota:a}})(),l=ug(KD,YD,t.id),c=Sc.now(),u={estado:"Terminado Internamente"};"Fase 2 Pendiente"===t.faseFacturacion?(u.fase2_comentariosTecnico=r,u.fase2_urlEvidencia=i,u.fase2_numeroNotaInterna=o,u.fase2_fechaFinTecnico=c):(u.fase1_comentariosTecnico=r,u.fase1_urlEvidencia=i,u.fase1_numeroNotaInterna=o,u.fase1_fechaFinTecnico=c,u.necesitaFactura=!0),t.fechaFinTecnicoReal||(u.fechaFinTecnicoReal=c),await by(l,u),s(),n()}catch(e){console.error("Error al completar la tarea:",e),h(e.message||"Ocurri\xf3 un error al guardar los datos."),u(!1)}}else h("Es obligatorio subir el archivo PDF de evidencia.")},disabled:c,className:"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded",children:c?"Enviando...":"Generar Nota y Finalizar Tarea"})]})]})})},F=e=>{let{project:t}=e;const n=(null===h||void 0===h?void 0:h.projectId)===t.id,i=n?"Trabajando en este":h?"Cambiar a este Proyecto":"Empezar a Trabajar";return(0,HD.jsxs)("div",{className:"p-4 bg-white rounded-lg shadow-md border-l-4 transition-all ".concat(n?"ring-2 ring-blue-500":""," ").concat("3 - Urgente"===t.prioridad?"border-red-500":"2 - Alta"===t.prioridad?"border-orange-500":"border-gray-300"),children:[(0,HD.jsx)("p",{className:"font-bold text-gray-800",children:t.servicioNombre}),(0,HD.jsx)("p",{className:"text-sm text-gray-600",children:t.clienteNombre}),(0,HD.jsx)("p",{className:"text-sm text-gray-400",children:t.npu}),(0,HD.jsxs)("p",{className:"text-xs text-gray-400 mt-2",children:["Prioridad: ",(0,HD.jsx)("span",{className:"font-semibold",children:t.prioridad||"N/A"})]}),t.comentariosApertura&&(0,HD.jsxs)("div",{className:"mt-2 mb-2 p-2 bg-gray-50 rounded text-xs text-gray-600 italic border border-gray-100",children:[(0,HD.jsx)("span",{className:"font-bold not-italic",children:"Nota: "}),t.comentariosApertura.length>60?t.comentariosApertura.substring(0,60)+"...":t.comentariosApertura]}),(0,HD.jsx)("button",{onClick:()=>I(t.id),disabled:n||p,className:"w-full mt-4 bg-green-600 text-white font-bold py-2 rounded-lg disabled:bg-gray-400 disabled:cursor-not-allowed hover:bg-green-700",children:i})]})},z=e=>{var t;let{project:n}=e;if(!n||!n.projectDetails)return null;const i=n.projectDetails,s=null===(t=n.projectDetails.proveedorNombre)||void 0===t?void 0:t.toLowerCase().includes("ecologia"),r=!!n.projectDetails.fechaFinTecnicoReal;return(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:"Herramientas de Trabajo"}),(0,HD.jsx)("p",{className:"text-sm text-gray-500",children:i.npu})]}),(0,HD.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-md",children:(0,HD.jsx)("div",{className:"flex",children:(0,HD.jsxs)("div",{className:"ml-3",children:[(0,HD.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Instrucciones del Proyecto"}),(0,HD.jsx)("div",{className:"mt-2 text-sm text-yellow-700",children:(0,HD.jsx)("p",{className:"whitespace-pre-wrap",children:i.comentariosApertura||"No hay instrucciones adicionales para este proyecto."})})]})})}),(0,HD.jsxs)("div",{className:"space-y-4",children:[(0,HD.jsx)("button",{onClick:()=>{b(n.projectDetails),_("log")},className:"w-full text-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gray-600 hover:bg-gray-700",children:"Ver Bit\xe1cora"}),s?(0,HD.jsx)("button",{onClick:()=>{b(n.projectDetails),_("task")},className:"w-full text-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700",children:"Generar Nota de Entrega"}):(0,HD.jsxs)(HD.Fragment,{children:[!r&&(0,HD.jsx)("button",{onClick:()=>R(n.projectId),className:"w-full text-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700",children:"Finalizar Parte T\xe9cnica"}),r&&(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsx)("p",{className:"text-center p-2 bg-green-100 text-green-800 rounded-md text-sm font-semibold",children:"Parte T\xe9cnica Finalizada (En espera de proveedor)"}),(0,HD.jsx)("button",{onClick:()=>{b(n.projectDetails),_("task")},className:"w-full text-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700",children:"Generar Nota de Entrega Final"})]})]})]})]})},U=()=>(0,HD.jsxs)("div",{className:"text-center p-10 bg-white rounded-lg shadow-lg h-full flex flex-col justify-center",children:[(0,HD.jsx)("h2",{className:"text-2xl font-semibold text-gray-700 mb-4",children:"\xbfEn qu\xe9 vas a trabajar hoy?"}),(0,HD.jsx)("p",{className:"text-gray-500",children:"Selecciona un proyecto de tu Kanban para empezar trabajar en un proyecto."})]}),V=u||g;return(0,HD.jsxs)("div",{children:[p&&(0,HD.jsx)(ZD,{breakInfo:p,onEndBreak:D}),h&&!p&&(0,HD.jsx)(BR,{task:h,onEndDay:j,onStartBreak:A,breakTakenToday:E}),M>0&&N&&(0,HD.jsxs)("div",{className:"bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6 rounded-md shadow-md relative",role:"alert",children:[(0,HD.jsx)("button",{onClick:()=>k(!1),className:"absolute top-2 right-2 text-yellow-700 font-bold text-lg",children:"\xd7"}),(0,HD.jsx)("p",{className:"font-bold",children:"\xa1Atenci\xf3n!"}),(0,HD.jsxs)("p",{children:["Tienes ",M," proyecto(s) nuevo(s) asignado(s). \xa1Rev\xedsalos en tu Kanban!"]})]}),(0,HD.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-[2fr,1fr] gap-8",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Mi Kanban de Tareas"}),V?(0,HD.jsx)("p",{children:"Cargando..."}):(0,HD.jsx)("div",{className:"space-y-4 max-h-[75vh] overflow-y-auto pr-4 rounded-lg",children:O.length>0?O.map(e=>(0,HD.jsx)(F,{project:e},e.id)):(0,HD.jsx)("p",{className:"text-gray-500 p-4 bg-white rounded-md",children:"No tienes proyectos activos asignados."})})]}),(0,HD.jsx)("div",{className:"sticky top-40 h-fit",children:!V&&(h?(0,HD.jsx)(z,{project:h}):(0,HD.jsx)(U,{}))})]}),v&&"log"===x&&(0,HD.jsx)(uR,{project:v,user:n,userData:s,onClose:()=>b(null),selectedRole:r}),v&&"task"===x&&(0,HD.jsx)(L,{project:v,onClose:()=>b(null),onFinalized:()=>{}}),w&&(0,HD.jsx)(rR,c(c({},w),{},{onCancel:()=>C(null)}))]})},BR=e=>{var t,n;let{task:s,onEndDay:r,onStartBreak:o,breakTakenToday:a}=e;const l=(e=>{const[t,n]=(0,i.useState)(0);return(0,i.useEffect)(()=>{if(!e)return void n(0);const t=e.toDate().getTime(),i=setInterval(()=>{const e=Date.now();n(e-t)},1e3);return()=>clearInterval(i)},[e]),(e=>{const t=Math.floor(e/1e3),n=String(Math.floor(t/3600)).padStart(2,"0"),i=String(Math.floor(t%3600/60)).padStart(2,"0"),s=String(t%60).padStart(2,"0");return"".concat(n,":").concat(i,":").concat(s)})(t)})(s.inicio);return(0,HD.jsxs)("div",{className:"bg-blue-600 text-white p-4 rounded-lg shadow-lg mb-8 flex justify-between items-center sticky top-20 z-30",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("p",{className:"font-bold",children:"Trabajando ahora en:"}),(0,HD.jsxs)("p",{className:"text-lg",children:[null===(t=s.projectDetails)||void 0===t?void 0:t.npu," - ",null===(n=s.projectDetails)||void 0===n?void 0:n.servicioNombre]})]}),(0,HD.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,HD.jsx)("p",{className:"text-2xl font-mono",children:l}),(0,HD.jsx)("button",{onClick:o,disabled:a,className:"bg-green-500 hover:bg-green-600 font-bold py-3 px-4 rounded-lg disabled:bg-gray-400 disabled:cursor-not-allowed",title:a?"Ya tomaste tu descanso de hoy":"Ir a comer",children:"Ir a Comer"}),(0,HD.jsx)("button",{onClick:r,className:"bg-red-600 hover:bg-red-700 font-bold py-3 px-4 rounded-lg",children:"Finalizar D\xeda"})]})]})},HR=e=>{let{user:t,userData:n}=e;const[s,r]=(0,i.useState)("dashboard"),[o,a]=(0,i.useState)([]),[l,u]=(0,i.useState)(!0),d=()=>{u(!0);const e=_y(Qg(cg(KD,YD),Zg($g("necesitaFactura","==",!0),$g("estado","==","Pendiente de Factura"))),e=>{const t=e.docs.map(e=>c({id:e.id},e.data()));a(t),u(!1)},e=>{console.error("Error al cargar proyectos pendientes de facturaci\xf3n:",e),u(!1)});return e};return(0,i.useEffect)(()=>{let e=()=>{};return"pendientes"===s?e=d():u(!1),()=>e()},[s]),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"Panel de Finanzas"}),(0,HD.jsx)("div",{className:"mb-6 border-b border-gray-200",children:(0,HD.jsxs)("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[(0,HD.jsx)("button",{onClick:()=>r("dashboard"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("dashboard"===s?"border-blue-500 text-blue-600":"border-transparent text-gray-500"),children:"Dashboard"}),(0,HD.jsx)("button",{onClick:()=>r("pendientes"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("pendientes"===s?"border-blue-500 text-blue-600":"border-transparent text-gray-500"),children:"Pendientes de Gesti\xf3n"}),(0,HD.jsx)("button",{onClick:()=>r("cobrar"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("cobrar"===s?"border-blue-500 text-blue-600":"border-transparent text-gray-500"),children:"Cuentas por Cobrar"}),(0,HD.jsx)("button",{onClick:()=>r("pagar"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("pagar"===s?"border-blue-500 text-blue-600":"border-transparent text-gray-500"),children:"Cuentas por Pagar"})]})}),"dashboard"===s&&(0,HD.jsxs)("div",{children:[(0,HD.jsx)("h2",{className:"text-2xl font-bold text-gray-800 my-6",children:"An\xe1lisis Financiero"}),(0,HD.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:(0,HD.jsx)(sR,{})})]}),"pendientes"===s&&(0,HD.jsxs)("div",{children:[(0,HD.jsx)("h2",{className:"text-2xl font-bold text-gray-800 my-6",children:"Proyectos Pendientes de Facturar"}),l?(0,HD.jsx)("p",{children:"Cargando proyectos..."}):(0,HD.jsx)(qR,{projects:o,onUpdate:d})]}),"cobrar"===s&&(0,HD.jsx)(WR,{invoiceType:"cliente",onUpdate:()=>{}}),"pagar"===s&&(0,HD.jsx)(WR,{invoiceType:"proveedor",onUpdate:()=>{}})]})},qR=()=>{const[e,t]=(0,i.useState)([]),[n,s]=(0,i.useState)(!0),[r,o]=(0,i.useState)(""),[a,l]=(0,i.useState)(1),[u,d]=(0,i.useState)(10),[h,f]=(0,i.useState)(null),p=e=>{var t,n,s,r,o,a,l,u,d;let{project:h,onClose:f,onFinalized:p}=e;const[m,g]=(0,i.useState)("upload"),[y,v]=(0,i.useState)(null),[b,x]=(0,i.useState)(null),[_,w]=(0,i.useState)(null),[C,N]=(0,i.useState)(null),[k,E]=(0,i.useState)(!1),[T,S]=(0,i.useState)(""),[I,P]=(0,i.useState)([]),[j,A]=(0,i.useState)(""),[D,R]=(0,i.useState)(""),M=null===(t=h.proveedorNombre)||void 0===t?void 0:t.toLowerCase().includes("ecologia");(0,i.useEffect)(()=>{if("link"===m){const e=_y(Qg(cg(KD,"facturas"),ty("fechaEmision","desc")),e=>{P(e.docs.map(e=>c({id:e.id},e.data())))});return()=>e()}},[m]);const O=(e,t)=>{const n=e.target.files[0];if(!n)return;"client"===t&&v(n),"provider"===t&&x(n);const i=new FileReader;i.onload=e=>{const n=e.target.result,i=nR(n);i?("client"===t&&w(i),"provider"===t&&N(i),S("")):S("Error al leer el XML. Aseg\xfarate de que es un archivo CFDI v\xe1lido.")},i.readAsText(n)},L=async(e,t)=>{if(!e)return null;const n=rb(ab(QD,t),e);return ob((await n).ref)};return(0,HD.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl",children:[(0,HD.jsxs)("h3",{className:"text-lg font-bold mb-4",children:["Gestionar Facturas: ",h.npu]}),(0,HD.jsx)("div",{className:"mb-4 border-b border-gray-200",children:(0,HD.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,HD.jsx)("button",{onClick:()=>g("upload"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("upload"===m?"border-blue-500 text-blue-600":"border-transparent text-gray-500"),children:"Subir Nueva Factura (XML)"}),(0,HD.jsx)("button",{onClick:()=>g("link"),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat("link"===m?"border-blue-500 text-blue-600":"border-transparent text-gray-500"),children:"Enlazar Factura Existente"})]})}),"upload"===m&&(0,HD.jsxs)("div",{className:"grid grid-cols-1 ".concat(M?"":"md:grid-cols-2"," gap-6"),children:[(0,HD.jsxs)("div",{className:"space-y-4 p-4 border rounded-lg",children:[(0,HD.jsx)("h4",{className:"font-semibold text-gray-800",children:"Factura a Cliente"}),(null===(n=h.facturasClienteIds)||void 0===n?void 0:n.length)>0?(0,HD.jsx)("p",{className:"text-green-600 font-semibold",children:"\u2713 Factura ya adjuntada."}):(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"Subir archivo XML"}),(0,HD.jsx)("input",{type:"file",name:"clientXml",accept:".xml",onChange:e=>O(e,"client"),className:"block w-full text-sm"}),_&&(0,HD.jsxs)("div",{className:"text-xs bg-gray-50 p-2 rounded-md mt-2 space-y-1",children:[(0,HD.jsxs)("p",{children:[(0,HD.jsx)("strong",{children:"Folio:"})," ",_.folio]}),(0,HD.jsxs)("p",{children:[(0,HD.jsx)("strong",{children:"Subtotal:"})," $",null===(s=_.subtotal)||void 0===s?void 0:s.toFixed(2)]}),(0,HD.jsxs)("p",{children:[(0,HD.jsx)("strong",{children:"IVA:"})," $",null===(r=_.iva)||void 0===r?void 0:r.toFixed(2)]}),(0,HD.jsxs)("p",{children:[(0,HD.jsx)("strong",{children:"Total:"})," $",null===(o=_.monto)||void 0===o?void 0:o.toFixed(2)]})]})]})]}),!M&&(0,HD.jsxs)("div",{className:"space-y-4 p-4 border rounded-lg",children:[(0,HD.jsx)("h4",{className:"font-semibold text-gray-800",children:"Factura de Proveedor"}),(null===(a=h.facturasProveedorIds)||void 0===a?void 0:a.length)>0?(0,HD.jsx)("p",{className:"text-green-600 font-semibold",children:"\u2713 Factura ya adjuntada."}):(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"Subir archivo XML"}),(0,HD.jsx)("input",{type:"file",name:"providerXml",accept:".xml",onChange:e=>O(e,"provider"),className:"block w-full text-sm"}),C&&(0,HD.jsxs)("div",{className:"text-xs bg-gray-50 p-2 rounded-md mt-2 space-y-1",children:[(0,HD.jsxs)("p",{children:[(0,HD.jsx)("strong",{children:"Folio:"})," ",C.folio]}),(0,HD.jsxs)("p",{children:[(0,HD.jsx)("strong",{children:"Subtotal:"})," $",null===(l=C.subtotal)||void 0===l?void 0:l.toFixed(2)]}),(0,HD.jsxs)("p",{children:[(0,HD.jsx)("strong",{children:"IVA:"})," $",null===(u=C.iva)||void 0===u?void 0:u.toFixed(2)]}),(0,HD.jsxs)("p",{children:[(0,HD.jsx)("strong",{children:"Total:"})," $",null===(d=C.monto)||void 0===d?void 0:d.toFixed(2)]})]})]})]})]}),"link"===m&&(0,HD.jsxs)("div",{className:"grid grid-cols-1 ".concat(M?"":"md:grid-cols-2"," gap-6"),children:[(0,HD.jsxs)("div",{className:"space-y-2 p-4 border rounded-lg",children:[(0,HD.jsx)("h4",{className:"font-semibold text-gray-800",children:"Enlazar Factura de Cliente"}),(0,HD.jsxs)("select",{value:j,onChange:e=>A(e.target.value),className:"block w-full border rounded-md p-2",children:[(0,HD.jsx)("option",{value:"",children:"Seleccione una factura..."}),I.filter(e=>"cliente"===e.tipo).map(e=>{var t;return(0,HD.jsx)("option",{value:e.id,children:"Folio: ".concat(e.folio," - $").concat(null===(t=e.monto)||void 0===t?void 0:t.toFixed(2))},e.id)})]})]}),!M&&(0,HD.jsxs)("div",{className:"space-y-2 p-4 border rounded-lg",children:[(0,HD.jsx)("h4",{className:"font-semibold text-gray-800",children:"Enlazar Factura de Proveedor"}),(0,HD.jsxs)("select",{value:D,onChange:e=>R(e.target.value),className:"block w-full border rounded-md p-2",children:[(0,HD.jsx)("option",{value:"",children:"Seleccione una factura..."}),I.filter(e=>"proveedor"===e.tipo).map(e=>{var t;return(0,HD.jsx)("option",{value:e.id,children:"Folio: ".concat(e.folio," - $").concat(null===(t=e.monto)||void 0===t?void 0:t.toFixed(2))},e.id)})]})]})]}),(0,HD.jsx)(eR,{message:T,type:"error",onClose:()=>S("")}),(0,HD.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,HD.jsx)("button",{onClick:f,className:"bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded",children:"Cancelar"}),(0,HD.jsx)("button",{onClick:async()=>{E(!0),S("");try{const e=ug(KD,YD,h.id),t={},n=h.facturasClienteIds&&h.facturasClienteIds.length>0||"upload"===m&&y&&_||"link"===m&&j,i=M||h.facturasProveedorIds&&h.facturasProveedorIds.length>0||"upload"===m&&b&&C||"link"===m&&D;if(n&&i?(t.necesitaFactura=!1,"Pendiente de Factura"===h.estado&&(t.estado="Terminado",t.estadoCliente="Terminado")):t.necesitaFactura=!0,"upload"===m){if(y&&_){const e=await L(y,"facturas_clientes/".concat(h.id,"/").concat(y.name)),n=await xy(cg(KD,"facturas"),{tipo:"cliente",proyectoId:h.id,folio:_.folio,uuid:_.uuid,subtotal:_.subtotal,iva:_.iva,monto:_.monto,fechaEmision:Sc.fromDate(_.fechaEmision),estado:"Pendiente",urlXml:e,pdfUrl:"",clienteNombre:h.clienteNombre});t.facturasClienteIds=Py(n.id)}if(!M&&b&&C){const e=await L(b,"facturas_proveedores/".concat(h.id,"/").concat(b.name)),n=await xy(cg(KD,"facturas"),{tipo:"proveedor",proyectoId:h.id,folio:C.folio,uuid:C.uuid,subtotal:C.subtotal,iva:C.iva,monto:C.monto,fechaEmision:Sc.fromDate(C.fechaEmision),estado:"Pendiente",urlXml:e,proveedorNombre:h.proveedorNombre});t.facturasProveedorIds=Py(n.id)}}else j&&(await by(ug(KD,"facturas",j),{proyectosIds:Py(h.id)}),t.facturasClienteIds=Py(j)),D&&!M&&(await by(ug(KD,"facturas",D),{proyectosIds:Py(h.id)}),t.facturasProveedorIds=Py(D));Object.keys(t).length>0&&await by(e,t),p(),f()}catch(e){S("Ocurri\xf3 un error al guardar las facturas."),console.error("Error saving invoices:",e),E(!1)}},className:"bg-[#b0ef26] text-black font-bold py-2 px-4 rounded",disabled:k,children:k?"Guardando...":"Guardar Cambios"})]})]})})};(0,i.useEffect)(()=>{s(!0);const e=_y(Qg(cg(KD,YD),Zg($g("necesitaFactura","==",!0),$g("estado","==","Pendiente de Factura"))),e=>{t(e.docs.map(e=>c({id:e.id},e.data()))),s(!1)},e=>{console.error("Error cargando facturas pendientes:",e),s(!1)});return()=>e()},[]);const m=e.filter(e=>e.npu&&e.npu.toLowerCase().includes(r.toLowerCase())||e.clienteNombre&&e.clienteNombre.toLowerCase().includes(r.toLowerCase())||e.poClienteRef&&e.poClienteRef.toLowerCase().includes(r.toLowerCase())),g=a*u,y=g-u,v=m.slice(y,g),b=Math.ceil(m.length/u),x=e=>l(e);return(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsxs)("div",{className:"mb-4 flex flex-col md:flex-row justify-between items-center",children:[(0,HD.jsx)("input",{type:"text",placeholder:"Buscar por NPU, cliente o servicio...",className:"w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md mb-2 md:mb-0",onChange:e=>{o(e.target.value),l(1)}}),(0,HD.jsxs)("div",{className:"flex items-center",children:[(0,HD.jsx)("span",{className:"text-sm mr-2",children:"Mostrar:"}),(0,HD.jsxs)("select",{value:u,onChange:e=>{d(Number(e.target.value)),l(1)},className:"px-2 py-1 border border-gray-300 rounded-md",children:[(0,HD.jsx)("option",{value:10,children:"10"}),(0,HD.jsx)("option",{value:25,children:"25"}),(0,HD.jsx)("option",{value:50,children:"50"})]})]})]}),(0,HD.jsx)("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:(0,HD.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,HD.jsx)("thead",{className:"bg-gray-50",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"NPU"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cliente"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Servicio"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Referencias"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Montos"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Facturas"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),(0,HD.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:n?(0,HD.jsx)("tr",{children:(0,HD.jsx)("td",{colSpan:"6",className:"text-center py-4",children:"Cargando proyectos pendientes..."})}):0===v.length?(0,HD.jsx)("tr",{children:(0,HD.jsx)("td",{colSpan:"6",className:"text-center py-4",children:"No hay proyectos pendientes de facturar."})}):v.map(e=>{var t,n,i,s,r;return(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("td",{className:"px-6 py-4 font-medium",children:e.npu}),(0,HD.jsx)("td",{className:"px-4 py-2",children:e.clienteNombre}),(0,HD.jsx)("td",{className:"px-4 py-2",children:e.servicioNombre}),(0,HD.jsx)("td",{className:"px-4 py-2 text-xs text-gray-700",children:(0,HD.jsxs)("div",{className:"space-y-1",children:[(0,HD.jsxs)("p",{children:[(0,HD.jsx)("span",{className:"font-bold text-gray-600",children:"NE:"})," ",e.fase1_numeroNotaInterna||"N/A"]}),(0,HD.jsxs)("p",{className:"border-t mt-1 pt-1",children:[(0,HD.jsx)("span",{className:"font-bold text-blue-600",children:"Cliente:"})," ",e.poClienteRef||"N/A"]}),(0,HD.jsxs)("p",{children:[(0,HD.jsx)("span",{className:"font-bold text-gray-500",children:"Prov:"})," ",e.poProveedor||"N/A"]})]})}),(0,HD.jsx)("td",{className:"px-4 py-2 text-sm",children:(0,HD.jsxs)("div",{className:"flex flex-col",children:[(0,HD.jsxs)("span",{className:"text-green-600 font-semibold",children:["$",null===(t=e.precioCotizacionCliente)||void 0===t?void 0:t.toFixed(2)]}),(0,HD.jsxs)("span",{className:"text-red-500 text-xs",children:["$",null===(n=e.costoProveedor)||void 0===n?void 0:n.toFixed(2)]})]})}),(0,HD.jsx)("td",{className:"px-4 py-2 text-sm",children:(0,HD.jsxs)("div",{className:"flex flex-col",children:[(0,HD.jsx)("div",{className:"px-6 py-4",children:(null===(i=e.facturasClienteIds)||void 0===i?void 0:i.length)>0?(0,HD.jsx)("span",{className:"text-green-600",children:"Adjunta"}):(0,HD.jsx)("span",{className:"text-orange-500",children:"Pendiente"})}),(0,HD.jsx)("div",{className:"px-6 py-4",children:null!==(s=e.proveedorNombre)&&void 0!==s&&s.toLowerCase().includes("ecologia")?(0,HD.jsx)("span",{className:"text-gray-500",children:"N/A"}):(null===(r=e.facturasProveedorIds)||void 0===r?void 0:r.length)>0?(0,HD.jsx)("span",{className:"text-green-600",children:"Adjunta"}):(0,HD.jsx)("span",{className:"text-orange-500",children:"Pendiente"})})]})}),(0,HD.jsx)("td",{className:"px-4 py-2",children:(0,HD.jsx)("button",{onClick:()=>f(e),className:"text-indigo-600 hover:text-indigo-900 font-bold",children:"Adjuntar Factura"})})]},e.id)})})]})}),(0,HD.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,HD.jsxs)("span",{className:"text-sm text-gray-700",children:["P\xe1gina ",a," de ",b]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("button",{onClick:()=>x(a-1),disabled:1===a,className:"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50",children:"Anterior"}),(0,HD.jsx)("button",{onClick:()=>x(a+1),disabled:a===b||0===b,className:"px-3 py-1 border rounded-md bg-white disabled:opacity-50",children:"Siguiente"})]})]}),h&&(0,HD.jsx)(p,{project:h,onClose:()=>f(null),onFinalized:()=>f(null)})]})},WR=e=>{let{invoiceType:t,onUpdate:n}=e;const[s,r]=(0,i.useState)([]),[o,a]=(0,i.useState)(!0),[l,u]=(0,i.useState)(!1),[d,h]=(0,i.useState)(null),[f,p]=(0,i.useState)(""),[m,g]=(0,i.useState)(1),[y,v]=(0,i.useState)(10);(0,i.useEffect)(()=>{a(!0);const e=_y(Qg(cg(KD,"facturas"),$g("tipo","==",t),ty("fechaEmision","desc")),e=>{r(e.docs.map(e=>c({id:e.id},e.data()))),a(!1)});return()=>e()},[t]);const b=s.filter(e=>e.folio&&String(e.folio).toLowerCase().includes(f.toLowerCase())||e.clienteNombre&&e.clienteNombre.toLowerCase().includes(f.toLowerCase())||e.proveedorNombre&&e.proveedorNombre.toLowerCase().includes(f.toLowerCase())||e.descripcion&&e.descripcion.toLowerCase().includes(f.toLowerCase())),x=m*y,_=x-y,w=b.slice(_,x),C=Math.ceil(b.length/y),N=e=>g(e),k=e=>{let{onClose:n,onFinalized:s}=e;const[r,o]=(0,i.useState)({folio:"",monto:"",fechaEmision:(new Date).toISOString().split("T")[0],entidadId:"",descripcion:""}),[a,l]=(0,i.useState)(null),[u,d]=(0,i.useState)(null),[h,f]=(0,i.useState)([]),[p,m]=(0,i.useState)(""),[g,y]=(0,i.useState)(!1),[v,b]=(0,i.useState)("");(0,i.useEffect)(()=>{let e;e="cliente"===t?Qg(cg(KD,"usuarios"),$g("rol","==","cliente")):Qg(cg(KD,"proveedores")),yy(e).then(e=>{const t=e.docs.map(e=>c({id:e.id},e.data())).sort((e,t)=>(e.nombreCompleto||e.nombre).localeCompare(t.nombreCompleto||t.nombre));f(t)})},[]),(0,i.useEffect)(()=>{u&&o(e=>c(c({},e),{},{folio:u.folio,subtotal:u.subtotal,iva:u.iva,monto:u.monto,fechaEmision:u.fechaEmision.toISOString().split("T")[0]}))},[u]);return(0,HD.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg",children:[(0,HD.jsxs)("h3",{className:"text-lg font-bold mb-4",children:["A\xf1adir Factura General (",t,")"]}),(0,HD.jsxs)("div",{className:"space-y-4",children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"Subir archivo XML (la informaci\xf3n se cargar\xe1 autom\xe1ticamente)"}),(0,HD.jsx)("input",{type:"file",name:"xmlFile",accept:".xml",onChange:e=>{const t=e.target.files[0];if(!t)return;l(t);const n=new FileReader;n.onload=e=>{const t=e.target.result,n=nR(t);n?(d(n),b("")):b("Error al leer el XML. Aseg\xfarate de que es un archivo CFDI v\xe1lido.")},n.readAsText(t)},className:"block w-full text-sm"}),(0,HD.jsx)("hr",{}),(0,HD.jsxs)("select",{value:r.entidadId,onChange:e=>o(t=>c(c({},t),{},{entidadId:e.target.value})),name:"entidadId",className:"block w-full border rounded-md p-2",children:[(0,HD.jsxs)("option",{value:"",children:["Seleccione un ",t]}),h.map(e=>(0,HD.jsx)("option",{value:e.id,children:e.nombreCompleto||e.nombre},e.id)),(0,HD.jsx)("option",{value:"otro",children:"Otro (especificar)"})]}),"otro"===r.entidadId&&(0,HD.jsx)("input",{type:"text",value:p,onChange:e=>m(e.target.value),placeholder:"Nombre del ".concat(t),className:"block w-full border rounded-md p-2"}),(0,HD.jsx)("input",{type:"text",name:"descripcion",placeholder:"Descripci\xf3n (ej: Renta de oficina)",value:r.descripcion,onChange:e=>o(t=>c(c({},t),{},{descripcion:e.target.value})),className:"block w-full border rounded-md p-2"}),(0,HD.jsx)("input",{type:"text",name:"folio",placeholder:"Folio (del XML)",value:r.folio,disabled:!0,className:"block w-full border rounded-md p-2 bg-gray-100"}),(0,HD.jsx)("input",{type:"number",name:"subtotal",placeholder:"Subtotal (del XML)",value:r.subtotal||"",disabled:!0,className:"block w-full border rounded-md p-2 bg-gray-100"}),(0,HD.jsx)("input",{type:"number",name:"iva",placeholder:"IVA (del XML)",value:r.iva||"",disabled:!0,className:"block w-full border rounded-md p-2 bg-gray-100"}),(0,HD.jsx)("input",{type:"number",name:"monto",placeholder:"Monto (del XML)",value:r.monto,disabled:!0,className:"block w-full border rounded-md p-2 bg-gray-100"}),(0,HD.jsx)("input",{type:"date",name:"fechaEmision",value:r.fechaEmision,disabled:!0,className:"block w-full border rounded-md p-2 bg-gray-100"})]}),(0,HD.jsx)(eR,{message:v,type:"error",onClose:()=>b("")}),(0,HD.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,HD.jsx)("button",{onClick:n,children:"Cancelar"}),(0,HD.jsx)("button",{onClick:async()=>{if(u&&a&&""!==r.entidadId&&("otro"!==r.entidadId||p)){y(!0);try{var e,i;const o=await(async(e,t)=>{if(!e)return null;const n=rb(ab(QD,t),e);return ob((await n).ref)})(a,"facturas_".concat(t,"/").concat(Date.now(),"/").concat(a.name)),l="otro"===r.entidadId?p:(null===(e=h.find(e=>e.id===r.entidadId))||void 0===e?void 0:e.nombreCompleto)||(null===(i=h.find(e=>e.id===r.entidadId))||void 0===i?void 0:i.nombre);await xy(cg(KD,"facturas"),{tipo:t,proyectoId:"general",folio:r.folio,uuid:u.uuid,subtotal:Number(r.subtotal),iva:Number(r.iva),monto:Number(r.monto),fechaEmision:Sc.fromDate(new Date(r.fechaEmision)),estado:"Pendiente",descripcion:r.descripcion||"",urlXml:o,urlPdf:"",["cliente"===t?"clienteNombre":"proveedorNombre"]:l}),s(),n()}catch(o){console.error("Error al guardar factura general:",o),b("Ocurri\xf3 un error al guardar."),y(!1)}}else b("Debes subir un XML v\xe1lido y seleccionar un cliente/proveedor.")},disabled:g,className:"bg-[#b0ef26] text-black font-bold py-2 px-4 rounded",children:g?"Guardando...":"Guardar Factura"})]})]})})},E=e=>{let{invoice:t,onClose:n,onFinalized:s}=e;const[r,o]=(0,i.useState)({fechaPromesaPago:t.fechaPromesaPago?t.fechaPromesaPago.toDate().toISOString().split("T")[0]:"",fechaPagoReal:t.fechaPagoReal?t.fechaPagoReal.toDate().toISOString().split("T")[0]:""}),[a,l]=(0,i.useState)(!1);return(0,HD.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg",children:[(0,HD.jsxs)("h3",{className:"text-lg font-bold mb-4",children:["Gestionar Factura: ",t.folio]}),(0,HD.jsxs)("div",{className:"space-y-4",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"Fecha Promesa de Pago"}),(0,HD.jsx)("input",{type:"date",value:r.fechaPromesaPago,onChange:e=>o(c(c({},r),{},{fechaPromesaPago:e.target.value})),className:"mt-1 block w-full border rounded-md p-2"})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"Fecha de Pago Real"}),(0,HD.jsx)("input",{type:"date",value:r.fechaPagoReal,onChange:e=>o(c(c({},r),{},{fechaPagoReal:e.target.value})),className:"mt-1 block w-full border rounded-md p-2"})]})]}),(0,HD.jsxs)("div",{className:"mt-6 flex justify-between items-center",children:[(0,HD.jsx)("button",{onClick:async()=>{if(window.confirm("\xbfEst\xe1s seguro de que quieres cancelar esta factura? Esta acci\xf3n es irreversible.")){if(l(!0),await by(ug(KD,"facturas",t.id),{estado:"Cancelada"}),t.proyectoId&&"general"!==t.proyectoId){const e="cliente"===t.tipo?"facturaClienteId":"facturaProveedorId";await by(ug(KD,YD,t.proyectoId),{[e]:Iy(),estado:"Pendiente de Factura"})}s(),n()}},disabled:a,className:"bg-red-600 text-white font-bold py-2 px-4 rounded disabled:bg-red-300",children:"Cancelar Factura"}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("button",{onClick:n,disabled:a,className:"bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded mr-2",children:"Cerrar"}),(0,HD.jsx)("button",{onClick:async()=>{l(!0);const e={fechaPromesaPago:r.fechaPromesaPago?Sc.fromDate(new Date(r.fechaPromesaPago)):Iy(),fechaPagoReal:r.fechaPagoReal?Sc.fromDate(new Date(r.fechaPagoReal)):Iy()};r.fechaPagoReal?e.estado="Pagada":"Pagada"===t.estado&&(e.estado="Pendiente"),await by(ug(KD,"facturas",t.id),e),s(),n()},disabled:a,className:"bg-[#b0ef26] text-black font-bold py-2 px-4 rounded",children:a?"Guardando...":"Guardar"})]})]})]})})},T=e=>e?new Date(1e3*e.seconds).toLocaleDateString("es-MX"):"---";return(0,HD.jsxs)("div",{children:[(0,HD.jsxs)("div",{className:"mb-4 flex flex-col md:flex-row justify-between items-center",children:[(0,HD.jsx)("input",{type:"text",placeholder:"Buscar por folio, cliente/prov. o descripci\xf3n...",className:"w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md mb-2 md:mb-0",onChange:e=>{p(e.target.value),g(1)}}),(0,HD.jsxs)("div",{className:"flex items-center",children:[(0,HD.jsx)("span",{className:"text-sm mr-2",children:"Mostrar:"}),(0,HD.jsxs)("select",{value:y,onChange:e=>{v(Number(e.target.value)),g(1)},className:"px-2 py-1 border border-gray-300 rounded-md",children:[(0,HD.jsx)("option",{value:10,children:"10"}),(0,HD.jsx)("option",{value:25,children:"25"}),(0,HD.jsx)("option",{value:50,children:"50"})]}),(0,HD.jsx)("button",{onClick:()=>u(!0),className:"ml-4 bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg",children:"+ A\xf1adir Factura General"})]})]}),(0,HD.jsx)("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:(0,HD.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,HD.jsx)("thead",{className:"bg-gray-50",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase",children:"Folio"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase",children:"cliente"===t?"Cliente":"Proveedor"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase",children:"Descripci\xf3n"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase",children:"Subtotal"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase",children:"IVA"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase",children:"Total"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase",children:"Fecha Emisi\xf3n"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase",children:"Fecha Promesa Pago"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase",children:"Fecha Pago"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase",children:"Estado"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase",children:"Acciones"})]})}),(0,HD.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:o?(0,HD.jsx)("tr",{children:(0,HD.jsx)("td",{colSpan:"11",children:"Cargando..."})}):w.map(e=>{const t=(e=>{var t;const n=new Date;if(n.setHours(0,0,0,0),"Pagada"===e.estado)return{text:"Pagada",class:"bg-green-100 text-green-800"};if("Cancelada"===e.estado)return{text:"Cancelada",class:"bg-gray-100 text-gray-700"};if(null!==(t=e.fechaPromesaPago)&&void 0!==t&&t.toDate){const t=e.fechaPromesaPago.toDate();return t.setHours(0,0,0,0),t<n?{text:"Vencida",class:"bg-red-100 text-red-800"}:{text:"Prog. a Pago",class:"bg-blue-100 text-blue-800"}}return{text:"Pend. de Autorizaci\xf3n",class:"bg-yellow-100 text-yellow-800"}})(e);return(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("td",{className:"px-6 py-4",children:e.folio}),(0,HD.jsx)("td",{className:"px-6 py-4",children:e.clienteNombre||e.proveedorNombre}),(0,HD.jsx)("td",{className:"px-6 py-4",children:e.descripcion||("general"!==e.proyectoId?"Gasto de Proyecto":"---")}),(0,HD.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["$",(e.subtotal||0).toFixed(2)]}),(0,HD.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["$",(e.iva||0).toFixed(2)]}),(0,HD.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold",children:["$",(e.monto||0).toFixed(2)]}),(0,HD.jsx)("td",{className:"px-6 py-4",children:T(e.fechaEmision)}),(0,HD.jsx)("td",{className:"px-6 py-4",children:T(e.fechaPromesaPago)}),(0,HD.jsx)("td",{className:"px-6 py-4",children:T(e.fechaPagoReal)}),(0,HD.jsx)("td",{className:"px-6 py-4",children:(0,HD.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(t.class),children:t.text})}),(0,HD.jsx)("td",{className:"px-6 py-4",children:(0,HD.jsx)("button",{onClick:()=>h(e),className:"text-indigo-600",children:"Gestionar"})})]},e.id)})})]})}),(0,HD.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,HD.jsxs)("span",{className:"text-sm text-gray-700",children:["P\xe1gina ",m," de ",C]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("button",{onClick:()=>N(m-1),disabled:1===m,className:"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50",children:"Anterior"}),(0,HD.jsx)("button",{onClick:()=>N(m+1),disabled:m===C||0===C,className:"px-3 py-1 border rounded-md bg-white disabled:opacity-50",children:"Siguiente"})]})]}),l&&(0,HD.jsx)(k,{onClose:()=>u(!1),onFinalized:n}),d&&(0,HD.jsx)(E,{invoice:d,onClose:()=>h(null),onFinalized:n})]})},GR=()=>{const[e,t]=(0,i.useState)([]),[n,s]=(0,i.useState)(!0),[r,o]=(0,i.useState)(null),[a,l]=(0,i.useState)(null),[u,d]=(0,i.useState)(null),[h,f]=(0,i.useState)("desc"),[p,m]=(0,i.useState)(1),[g,y]=(0,i.useState)(10),[v,b]=(0,i.useState)(""),x=()=>{s(!0);const e=_y(Qg(cg(KD,YD),$g("estado","in",["Terminado Internamente","En Revisi\xf3n Final"])),e=>{t(e.docs.map(e=>c({id:e.id},e.data()))),s(!1)},e=>{console.error("Error fetching projects for practicante: ",e),s(!1)});return e};(0,i.useEffect)(()=>{const e=x();return()=>e()},[]);const _=i.useMemo(()=>{const t=e.filter(e=>{var t,n,i;return(null===(t=e.npu)||void 0===t?void 0:t.toLowerCase().includes(v.toLowerCase()))||(null===(n=e.clienteNombre)||void 0===n?void 0:n.toLowerCase().includes(v.toLowerCase()))||(null===(i=e.servicioNombre)||void 0===i?void 0:i.toLowerCase().includes(v.toLowerCase()))}),n=[...t];return n.sort((e,t)=>{const n=e.fase2_fechaFinTecnico||e.fase1_fechaFinTecnico,i=t.fase2_fechaFinTecnico||t.fase1_fechaFinTecnico,s=(null===n||void 0===n?void 0:n.toDate())||new Date(0),r=(null===i||void 0===i?void 0:i.toDate())||new Date(0);return s<r?"asc"===h?-1:1:s>r?"asc"===h?1:-1:0}),n},[e,h,v]),w=_.slice((p-1)*g,p*g),C=Math.ceil(_.length/g),N=e=>m(e),k=e=>{d({title:"Confirmar Env\xedo",message:"\xbfEst\xe1s seguro de que todos los documentos est\xe1n listos y quieres enviar este proyecto a revisi\xf3n final?",onConfirm:()=>{(async e=>{l(e);try{await by(ug(KD,YD,e),{estado:"En Revisi\xf3n Final",motivoRechazo:Iy()})}catch(PS){console.error("Error sending project to review:",PS),alert("Ocurri\xf3 un error al enviar el proyecto a revisi\xf3n.")}finally{l(null)}})(e),d(null)}})},E=e=>{let{project:t,onClose:n,onFinalized:s}=e;const[r,o]=(0,i.useState)(t.urlHeyzine||""),[a,l]=(0,i.useState)(null),[c,u]=(0,i.useState)(null),[d,h]=(0,i.useState)(!1),f=e=>t=>{t.target.files[0]&&e(t.target.files[0])},p=async(e,t)=>{if(!e)return null;const n=rb(ab(QD,t),e);return ob((await n).ref)};return(0,HD.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:(0,HD.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg",children:[(0,HD.jsxs)("h3",{className:"text-lg font-bold mb-4",children:["Gestionar Entrega Final: ",t.npu]}),(0,HD.jsxs)("div",{className:"space-y-4",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"Enlace Heyzine (\xdanico)"}),(0,HD.jsx)("input",{type:"text",value:r,onChange:e=>o(e.target.value),className:"mt-1 block w-full border rounded-md p-2"})]}),(0,HD.jsx)("hr",{}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"Subir/Reemplazar Nota de Entrega 1 (Firmada)"}),(0,HD.jsx)("input",{type:"file",accept:".pdf",onChange:f(l),className:"mt-1 block w-full text-sm"})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium",children:"Subir/Reemplazar Nota de Entrega 2 (Firmada)"}),(0,HD.jsx)("input",{type:"file",accept:".pdf",onChange:f(u),className:"mt-1 block w-full text-sm"})]})]}),(0,HD.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,HD.jsx)("button",{onClick:n,className:"bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded",children:"Cancelar"}),(0,HD.jsx)("button",{onClick:async()=>{h(!0);const e={urlHeyzine:r},i=await p(a,"notas_entrega_cliente/".concat(t.id,"/nota1_").concat(null===a||void 0===a?void 0:a.name)),o=await p(c,"notas_entrega_cliente/".concat(t.id,"/nota2_").concat(null===c||void 0===c?void 0:c.name));i&&(e.urlNotaPdf1=i),o&&(e.urlNotaPdf2=o),Object.keys(e).length>0&&await by(ug(KD,YD,t.id),e),s(),n()},className:"bg-blue-600 text-white font-bold py-2 px-4 rounded",children:d?"Guardando...":"Guardar Documentos"})]})]})})};return(0,HD.jsxs)("div",{children:[(0,HD.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,HD.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Proyectos Listos para Documentar"}),(0,HD.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,HD.jsx)("input",{type:"text",placeholder:"Buscar por NPU, Cliente...",value:v,onChange:e=>b(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-md text-sm"}),(0,HD.jsxs)("div",{className:"flex items-center",children:[(0,HD.jsx)("span",{className:"text-sm mr-2",children:"Mostrar:"}),(0,HD.jsxs)("select",{value:g,onChange:e=>{y(Number(e.target.value)),m(1)},className:"px-2 py-1 border border-gray-300 rounded-md",children:[(0,HD.jsx)("option",{value:10,children:"10"}),(0,HD.jsx)("option",{value:25,children:"25"}),(0,HD.jsx)("option",{value:50,children:"50"})]})]}),(0,HD.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,HD.jsx)("span",{className:"text-sm font-medium",children:"Ordenar por Fecha:"}),(0,HD.jsx)("button",{onClick:()=>f("asc"===h?"desc":"asc"),className:"p-2 border rounded-md text-sm bg-white shadow-sm",children:"asc"===h?"Ascendente \u2191":"Descendente \u2193"})]})]})]}),n?(0,HD.jsx)("p",{children:"Cargando..."}):0===_.length?(0,HD.jsx)("p",{children:"No hay proyectos pendientes."}):(0,HD.jsxs)(HD.Fragment,{children:[(0,HD.jsx)("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:(0,HD.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,HD.jsx)("thead",{className:"bg-gray-50",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"NPU"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Cliente"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Servicio"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Estado"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Documentos y correcciones"}),(0,HD.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Acciones"})]})}),(0,HD.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map(e=>{const t="En Revisi\xf3n Final"===e.estado?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800";return(0,HD.jsxs)("tr",{className:e.motivoRechazo?"bg-orange-50":"",children:[(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.npu}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.clienteNombre}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.servicioNombre}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,HD.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat(t),children:e.estado})}),(0,HD.jsx)("td",{className:"px-6 py-4",children:(0,HD.jsxs)("div",{className:"flex flex-col space-y-2 text-sm",children:[e.fase1_urlEvidencia&&(0,HD.jsxs)("div",{children:[(0,HD.jsx)("p",{className:"font-semibold text-xs",children:"Fase 1:"}),(0,HD.jsx)("a",{href:e.fase1_urlEvidencia,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600",children:"Ver Evidencia 1"}),(0,HD.jsxs)("p",{children:["Nota Interna: ",(0,HD.jsx)("span",{className:"font-semibold",children:e.fase1_numeroNotaInterna||"N/A"})]})]}),e.fase2_urlEvidencia&&(0,HD.jsxs)("div",{children:[(0,HD.jsx)("p",{className:"font-semibold text-xs",children:"Fase 2:"}),(0,HD.jsx)("a",{href:e.fase2_urlEvidencia,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600",children:"Ver Evidencia 2"}),(0,HD.jsxs)("p",{children:["Nota Interna: ",(0,HD.jsx)("span",{className:"font-semibold",children:e.fase2_numeroNotaInterna||"N/A"})]})]}),e.motivoRechazo&&(0,HD.jsxs)("div",{className:"mt-2 p-2 bg-red-100 text-red-800 rounded-md text-xs border border-red-200",children:[(0,HD.jsx)("p",{className:"font-bold",children:"Requiere Correcci\xf3n:"}),(0,HD.jsx)("p",{children:e.motivoRechazo})]})]})}),(0,HD.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,HD.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,HD.jsx)("button",{onClick:()=>o(e),className:"text-indigo-600 hover:text-indigo-800",children:"Gestionar Entrega"}),"Terminado Internamente"===e.estado?(0,HD.jsx)("button",{onClick:()=>k(e.id),disabled:a===e.id,className:"text-green-600 hover:text-green-800 disabled:opacity-50",children:a===e.id?"Enviando...":"Enviar a Revisi\xf3n"}):(0,HD.jsx)("span",{className:"text-sm font-semibold text-gray-500",children:"Enviado"})]})})]},e.id)})})]})}),(0,HD.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,HD.jsxs)("span",{className:"text-sm text-gray-700",children:["P\xe1gina ",p," de ",C]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("button",{onClick:()=>N(p-1),disabled:1===p,className:"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50",children:"Anterior"}),(0,HD.jsx)("button",{onClick:()=>N(p+1),disabled:p===C||0===C,className:"px-3 py-1 border rounded-md bg-white disabled:opacity-50",children:"Siguiente"})]})]})]}),r&&(0,HD.jsx)(E,{project:r,onClose:()=>o(null),onFinalized:x}),u&&(0,HD.jsx)(rR,c(c({},u),{},{onCancel:()=>d(null)}))]})},KR=()=>{const[e,t]=(0,i.useState)([]),[n,s]=(0,i.useState)({}),[r,o]=(0,i.useState)(!0),[a,l]=(0,i.useState)(""),[u,d]=(0,i.useState)(""),[h,f]=(0,i.useState)(""),[p,m]=(0,i.useState)(""),[g,y]=(0,i.useState)(1),[v]=(0,i.useState)(10);(0,i.useEffect)(()=>{(async()=>{o(!0);try{const e=(new Date).getFullYear(),n=new Date(e-2,0,1),i=Sc.fromDate(n),r=Qg(cg(KD,YD),$g("fechaApertura",">=",i),ty("fechaApertura","desc")),o=Qg(cg(KD,"facturas")),[a,l]=await Promise.all([yy(r),yy(o)]),u=a.docs.map(e=>c({id:e.id},e.data())),d={};l.forEach(e=>{d[e.id]=e.data().folio}),t(u),s(d)}catch(e){console.error("Error cargando antecedentes:",e)}finally{o(!1)}})()},[]);const b=i.useMemo(()=>{const t=e.map(e=>e.servicioNombre).filter(Boolean);return[...new Set(t)].sort()},[e]),x=i.useMemo(()=>{const t=e.map(e=>e.clienteNombre).filter(Boolean);return[...new Set(t)].sort()},[e]),_=i.useMemo(()=>{const t=e.map(e=>e.proveedorNombre).filter(Boolean);return[...new Set(t)].sort()},[e]),w=e.filter(e=>{const t=!a||e.npu&&e.npu.toLowerCase().includes(a.toLowerCase()),n=!h||e.clienteNombre===h,i=!p||e.proveedorNombre===p,s=!u||e.servicioNombre===u;return t&&n&&i&&s}),C=g*v,N=C-v,k=w.slice(N,C),E=Math.ceil(w.length/v),T=e=>y(e);return(0,HD.jsxs)("div",{children:[(0,HD.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:["Historial de Proyectos (",(new Date).getFullYear()-2," - ",(new Date).getFullYear(),")"]}),(0,HD.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg border flex flex-wrap items-center gap-4",children:[(0,HD.jsxs)("div",{className:"flex-1 min-w-[200px]",children:[(0,HD.jsx)("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"Buscar NPU"}),(0,HD.jsx)("input",{type:"text",placeholder:"Escribe el NPU...",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",value:a,onChange:e=>{l(e.target.value),y(1)}})]}),(0,HD.jsxs)("div",{className:"w-full md:w-auto",children:[(0,HD.jsx)("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"Filtrar por Cliente"}),(0,HD.jsxs)("select",{className:"w-full md:w-48 px-3 py-2 border border-gray-300 rounded-md text-sm",value:h,onChange:e=>{f(e.target.value),y(1)},children:[(0,HD.jsx)("option",{value:"",children:"Todos los Clientes"}),x.map(e=>(0,HD.jsx)("option",{value:e,children:e},e))]})]}),(0,HD.jsxs)("div",{className:"w-full md:w-auto",children:[(0,HD.jsx)("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"Filtrar por Servicio"}),(0,HD.jsxs)("select",{className:"w-full md:w-48 px-3 py-2 border border-gray-300 rounded-md text-sm",value:u,onChange:e=>{d(e.target.value),y(1)},children:[(0,HD.jsx)("option",{value:"",children:"Todos los Servicios"}),b.map(e=>(0,HD.jsx)("option",{value:e,children:e},e))]})]}),(0,HD.jsxs)("div",{className:"w-full md:w-auto",children:[(0,HD.jsx)("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"Filtrar por Proveedor"}),(0,HD.jsxs)("select",{className:"w-full md:w-48 px-3 py-2 border border-gray-300 rounded-md text-sm",value:p,onChange:e=>{m(e.target.value),y(1)},children:[(0,HD.jsx)("option",{value:"",children:"Todos los Proveedores"}),_.map(e=>(0,HD.jsx)("option",{value:e,children:e},e))]})]})]}),r?(0,HD.jsx)("p",{children:"Cargando archivo hist\xf3rico..."}):(0,HD.jsx)("div",{className:"overflow-x-auto bg-white rounded-lg shadow",children:(0,HD.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[(0,HD.jsx)("thead",{className:"bg-gray-50 text-gray-500 mb-1",children:(0,HD.jsxs)("tr",{children:[(0,HD.jsx)("th",{className:"px-4 py-3 text-left font-medium uppercase tracking-wider",children:"Cliente"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left font-medium uppercase tracking-wider",children:"NPU"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left font-medium uppercase tracking-wider",children:"Servicio"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left font-medium uppercase tracking-wider",children:"Proveedor"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left font-medium uppercase tracking-wider",children:"Doc. Prov."}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left font-medium uppercase tracking-wider",children:"Costo Prov."}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left font-medium uppercase tracking-wider",children:"Notas Internas"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left font-medium uppercase tracking-wider",children:"PO Cliente"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left font-medium uppercase tracking-wider",children:"Precio Cot."}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left font-medium uppercase tracking-wider",children:"Factura Cliente"}),(0,HD.jsx)("th",{className:"px-4 py-3 text-left font-medium uppercase tracking-wider",children:"Heyzine"})]})}),(0,HD.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:k.map(e=>(0,HD.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,HD.jsx)("td",{className:"px-4 py-2 font-medium",children:e.clienteNombre}),(0,HD.jsx)("td",{className:"px-4 py-2font-medium",children:e.npu}),(0,HD.jsx)("td",{className:"px-4 py-2font-medium",children:e.servicioNombre}),(0,HD.jsx)("td",{className:"px-4 py-2",children:e.proveedorNombre}),(0,HD.jsxs)("td",{className:"px-4 py-2 text-xs",children:[(0,HD.jsxs)("div",{children:["Cot: ",e.cotizacionProveedorRef||"-"]}),(0,HD.jsxs)("div",{children:["PO: ",e.poProveedor||"-"]})]}),(0,HD.jsxs)("td",{className:"px-4 py-2 text-red-600 font-medium",children:["$",(e.costoProveedor||0).toFixed(2)]}),(0,HD.jsx)("td",{className:"px-4 py-2",children:(0,HD.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,HD.jsxs)("span",{children:["NE1: ",e.fase1_numeroNotaInterna||"-"]}),e.fase2_numeroNotaInterna&&(0,HD.jsxs)("span",{children:["NE2: ",e.fase2_numeroNotaInterna]})]})}),(0,HD.jsx)("td",{className:"px-4 py-2 text-xs text-blue-600",children:(0,HD.jsx)("div",{children:e.poClienteRef||"-"})}),(0,HD.jsxs)("td",{className:"px-4 py-2 text-green-600 font-medium",children:["$",(e.precioCotizacionCliente||0).toFixed(2)]}),(0,HD.jsx)("td",{className:"px-4 py-2 text-xs",children:e.facturasClienteIds&&e.facturasClienteIds.length>0?e.facturasClienteIds.map(e=>n[e]||e).join(", "):"---"}),(0,HD.jsx)("td",{className:"px-4 py-2",children:e.urlHeyzine?(0,HD.jsx)("a",{href:e.urlHeyzine,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline font-bold",children:"Ver"}):(0,HD.jsx)("span",{className:"text-gray-400",children:"---"})})]},e.id))})]})}),(0,HD.jsxs)("div",{className:"mt-4 flex justify-between items-center",children:[(0,HD.jsxs)("span",{className:"text-sm text-gray-700",children:["P\xe1gina ",g," de ",E||1]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("button",{onClick:()=>T(g-1),disabled:1===g,className:"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50",children:"Anterior"}),(0,HD.jsx)("button",{onClick:()=>T(g+1),disabled:g===E||0===E,className:"px-3 py-1 border rounded-md bg-white disabled:opacity-50",children:"Siguiente"})]})]})]})},YR=e=>{let{user:t,userData:n,selectedRole:i,setIsTechnicianWorking:s,selectedClientProfile:r}=e;return(0,HD.jsx)("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(()=>{switch(i){case"administrador":return(0,HD.jsx)(vR,{user:t,userData:n,selectedRole:i});case"cliente":return(0,HD.jsx)(kR,{user:t,userData:r});case"directivo":return(0,HD.jsx)(OR,{user:t,userData:n});case"ecotech":return(0,HD.jsx)(LR,{user:t,userData:n});case"supervisor":return(0,HD.jsx)(UR,{user:t,userData:n,selectedRole:i});case"tecnico":return(0,HD.jsx)(VR,{user:t,userData:n,selectedRole:i,setIsWorkingState:s});case"finanzas":return(0,HD.jsx)(HR,{user:t,userData:n});case"practicante":return(0,HD.jsx)(GR,{});case"antecedentes":return(0,HD.jsx)(KR,{});case"rh":return(0,HD.jsx)(pR,{});default:return(0,HD.jsxs)("div",{children:[(0,HD.jsx)("h2",{className:"text-2xl font-bold",children:"Rol no reconocido"}),(0,HD.jsx)("p",{children:"Contacte al administrador."})]})}})()})},QR=()=>{const[e,t]=(0,i.useState)(""),[n,s]=(0,i.useState)(""),[r,o]=(0,i.useState)("");return(0,HD.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-[#cdcdcd]",children:(0,HD.jsxs)("div",{className:"max-w-md w-full bg-white p-8 rounded-xl shadow-2xl",children:[(0,HD.jsx)("img",{src:"https://www.grupoevelsa.com/assets/images/Logo Evelsa 2.png",alt:"Logo Grupo Evelsa",className:"h-16 mx-auto mb-6"}),(0,HD.jsx)("h2",{className:"text-2xl font-bold text-center text-gray-800 mb-8",children:"Acceso al Portal"}),(0,HD.jsxs)("form",{onSubmit:async t=>{t.preventDefault(),o("");try{await function(e,t,n){return yi(se(e),ni.credential(t,n))}(GD,e,n)}catch(i){o("Email o contrase\xf1a incorrectos.")}},className:"space-y-6",children:[(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,HD.jsx)("input",{type:"email",value:e,onChange:e=>t(e.target.value),required:!0,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"})]}),(0,HD.jsxs)("div",{children:[(0,HD.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Contrase\xf1a"}),(0,HD.jsx)("input",{type:"password",value:n,onChange:e=>s(e.target.value),required:!0,className:"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"})]}),r&&(0,HD.jsx)("p",{className:"text-red-500 text-sm text-center",children:r}),(0,HD.jsx)("button",{type:"submit",className:"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-3 px-4 rounded-lg transition duration-300 text-lg",children:"Entrar"})]})]})})};function XR(){const[e,t]=(0,i.useState)(null),[n,s]=(0,i.useState)(null),[r,o]=(0,i.useState)(!0),[a,l]=(0,i.useState)(null),[u,d]=(0,i.useState)(!1),[h,f]=(0,i.useState)(null);return(0,i.useEffect)(()=>{let e=()=>{};const n=function(e,t,n,i){return se(e).onAuthStateChanged(t,n,i)}(GD,n=>{if(e(),n){o(!0);const i=ug(KD,"usuarios",n.uid);e=_y(i,e=>{if(e.exists()){const i=e.data();if(s(i),t(n),i.roles&&i.roles.length>0?l(i.roles[0]):i.rol&&l(i.rol),"cliente"===i.rol)if(i.clientesAsociados&&i.clientesAsociados.length>0){my(ug(KD,"usuarios",i.clientesAsociados[0])).then(e=>{e.exists()&&f(c({id:e.id},e.data())),o(!1)})}else f(c({id:e.id},i)),o(!1);else o(!1)}else vi(GD),o(!1)},e=>{console.error("Error en listener de usuario (normal al salir):",e.message),o(!1)})}else t(null),s(null),l(null),f(null),d(!1),o(!1)});return()=>{n(),e()}},[]),(0,i.useEffect)(()=>{const e=async e=>{if(GD.currentUser&&null!==n&&void 0!==n&&n.tareaActiva){console.log("Cierre de ventana detectado, pausando tarea activa...");const e=ug(KD,"usuarios",GD.currentUser.uid),t=ug(cg(KD,"registrosDeTiempo"));await vy(t,{tecnicoId:GD.currentUser.uid,projectId:n.tareaActiva.projectId,fechaInicio:n.tareaActiva.inicio,fechaFin:Sc.now()}),await by(e,{tareaActiva:Iy()})}};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[n]),(0,i.useEffect)(()=>{if(null===e||void 0===e||!e.uid||!n||n.roles&&!n.roles.includes("tecnico"))return;const t=PD(XD,"/status/"+e.uid),i={state:"offline",last_changed:BD()},s={state:"online",last_changed:BD()},r=OD(PD(XD,".info/connected"),e=>{!0===e.val()&&(AD(t,s),function(e){return e=se(e),new ED(e._repo,e._path)}(t).set(i))});return()=>{r(),AD(t,i)}},[e,n]),r?(0,HD.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-[#cdcdcd] text-gray-700",children:"Cargando..."}):(0,HD.jsxs)("div",{className:"bg-[#c9c9c9] min-h-screen font-sans",children:[(0,HD.jsx)(cT,{position:"bottom-right",autoClose:8e3,hideProgressBar:!1,newestOnTop:!0,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0}),(0,HD.jsx)(cR,{user:e,userData:n,selectedRole:a,setSelectedRole:l,isWorking:u,selectedClientProfile:h,setSelectedClientProfile:f}),(0,HD.jsx)("main",{children:e&&n?(0,HD.jsx)(YR,{user:e,userData:n,selectedRole:a,setIsTechnicianWorking:d,selectedClientProfile:h}):(0,HD.jsx)(QR,{})})]})}s.createRoot(document.getElementById("root")).render((0,HD.jsx)(i.StrictMode,{children:(0,HD.jsx)(XR,{})}))})();
//# sourceMappingURL=main.29414568.js.map