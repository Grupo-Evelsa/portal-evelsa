{"ast":null,"code":"import _objectSpread from\"C:/Users/CAD/Documents/portal-evelsa/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{initializeApp}from'firebase/app';import{getAuth,onAuthStateChanged,createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut}from'firebase/auth';import{getFirestore,collection,addDoc,query,where,getDocs,doc,getDoc,updateDoc,onSnapshot,setDoc,Timestamp,runTransaction,orderBy,deleteDoc}from'firebase/firestore';import{getStorage,ref,uploadBytesResumable,getDownloadURL}from'firebase/storage';// --- INSTRUCCIONES DE CONFIGURACIÓN DE FIREBASE ---\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const firebaseConfig={apiKey:\"AIzaSyA7H6G0mXCy9DmoLg3fSW3TrxIRcEzz9jg\",authDomain:\"portal-evelsa.firebaseapp.com\",projectId:\"portal-evelsa\",storageBucket:\"portal-evelsa.firebasestorage.app\",messagingSenderId:\"847174487471\",appId:\"1:847174487471:web:c3a57fd8315ce619a2335a\"};// --- Inicialización de Firebase ---\nconst app=initializeApp(firebaseConfig);const auth=getAuth(app);const db=getFirestore(app);const storage=getStorage(app);// --- Componentes Reutilizables ---\nconst Alert=_ref=>{let{message,type,onClose}=_ref;if(!message)return null;const baseClasses=\"p-4 mb-4 text-sm rounded-lg relative\";const typeClasses={error:\"bg-red-100 text-red-800\",success:\"bg-green-100 text-green-800\"};return/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(baseClasses,\" \").concat(typeClasses[type]),role:\"alert\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:message}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"absolute top-0 right-0 mt-2 mr-3 text-2xl font-semibold leading-none\",children:\"\\xD7\"})]});};// --- Componente de Cabecera ---\nconst Header=_ref2=>{let{user,userData}=_ref2;const logoGrupoEvelsa=\"https://www.grupoevelsa.com/assets/images/Logo Evelsa 2.png\";return/*#__PURE__*/_jsx(\"header\",{className:\"bg-white shadow-md sticky top-0 z-40\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-7xl mx-auto py-3 px-4 sm:px-6 lg:px-8 flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center\",children:userData&&userData.rol==='cliente'&&userData.logoUrl?/*#__PURE__*/_jsx(\"img\",{src:userData.logoUrl,onError:e=>{e.target.onerror=null;e.target.src=\"https://placehold.co/150x50/FFFFFF/000000?text=Logo+Cliente\";},alt:\"Logo Cliente\",className:\"h-12 w-auto mr-4 object-contain\"}):/*#__PURE__*/_jsx(\"img\",{src:logoGrupoEvelsa,alt:\"Logo Grupo Evelsa\",className:\"h-12 w-auto mr-4\"})}),user&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-600 mr-4 hidden sm:block\",children:[\"Hola, \",userData?userData.nombreCompleto.split(' ')[0]:user.email]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>signOut(auth),className:\"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300\",children:\"Salir\"})]})]})});};// --- Componentes de Gestión (Para Administradores) ---\nconst UserManagement=_ref3=>{let{onUserAdded}=_ref3;const[email,setEmail]=useState('');const[password,setPassword]=useState('');const[nombreCompleto,setNombreCompleto]=useState('');const[rol,setRol]=useState('cliente');const[clienteIdNumerico,setClienteIdNumerico]=useState('');const[logoUrl,setLogoUrl]=useState('');const[error,setError]=useState('');const[success,setSuccess]=useState('');const resetForm=()=>{setEmail('');setPassword('');setNombreCompleto('');setRol('cliente');setClienteIdNumerico('');setLogoUrl('');};const handleSubmit=async e=>{e.preventDefault();setError('');setSuccess('');if(!nombreCompleto||!email||!password){setError('Nombre, email y contraseña son obligatorios.');return;}if(rol==='cliente'&&!clienteIdNumerico){setError('Para clientes, el ID Numérico es obligatorio.');return;}try{const tempApp=initializeApp(firebaseConfig,\"Secondary-\".concat(new Date().getTime()));const tempAuth=getAuth(tempApp);const userCredential=await createUserWithEmailAndPassword(tempAuth,email,password);await setDoc(doc(db,\"usuarios\",userCredential.user.uid),{email,rol,nombreCompleto,clienteIdNumerico:rol==='cliente'?clienteIdNumerico.padStart(3,'0'):'',logoUrl:rol==='cliente'?logoUrl:''});setSuccess(\"\\xA1Usuario \".concat(email,\" con rol '\").concat(rol,\"' creado con \\xE9xito!\"));resetForm();if(onUserAdded)onUserAdded();}catch(err){setError(\"Error al crear usuario: \".concat(err.message));}};return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-xl shadow-lg border border-gray-200\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-800 mb-4\",children:\"Crear Nuevo Usuario\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:nombreCompleto,onChange:e=>setNombreCompleto(e.target.value),placeholder:\"Nombre Completo\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"}),/*#__PURE__*/_jsxs(\"select\",{value:rol,onChange:e=>setRol(e.target.value),className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"cliente\",children:\"Cliente\"}),/*#__PURE__*/_jsx(\"option\",{value:\"administrador\",children:\"Administrador\"}),/*#__PURE__*/_jsx(\"option\",{value:\"directivo\",children:\"Directivo\"}),/*#__PURE__*/_jsx(\"option\",{value:\"ecotech\",children:\"Encargada Ecotech\"}),/*#__PURE__*/_jsx(\"option\",{value:\"supervisor\",children:\"Supervisor de Proyectos\"}),/*#__PURE__*/_jsx(\"option\",{value:\"tecnico\",children:\"T\\xE9cnico\"}),/*#__PURE__*/_jsx(\"option\",{value:\"finanzas\",children:\"Finanzas\"}),/*#__PURE__*/_jsx(\"option\",{value:\"practicante\",children:\"Practicante\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:email,onChange:e=>setEmail(e.target.value),placeholder:\"Email de Acceso\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,onChange:e=>setPassword(e.target.value),placeholder:\"Contrase\\xF1a (m\\xEDnimo 6 caracteres)\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"}),rol==='cliente'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:clienteIdNumerico,onChange:e=>setClienteIdNumerico(e.target.value),placeholder:\"ID Num\\xE9rico Cliente (ej: 001)\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:logoUrl,onChange:e=>setLogoUrl(e.target.value),placeholder:\"URL del Logo (Opcional)\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"})]}),/*#__PURE__*/_jsx(Alert,{message:error,type:\"error\",onClose:()=>setError('')}),/*#__PURE__*/_jsx(Alert,{message:success,type:\"success\",onClose:()=>setSuccess('')}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg\",children:\"Crear Usuario\"})]})]});};// --- Dashboards Esqueleto para cada Rol ---\n// **CÓDIGO CORREGIDO PARA AdminDashboard**\nconst AdminDashboard=()=>{const[view,setView]=useState('projects');const[projects,setProjects]=useState([]);const[loading,setLoading]=useState(true);const fetchProjects=()=>{setLoading(true);// El administrador ve TODOS los proyectos\nconst q=query(collection(db,\"proyectos\"),orderBy(\"fechaApertura\",\"desc\"));const unsubscribe=onSnapshot(q,querySnapshot=>{const projectsData=querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setProjects(projectsData);setLoading(false);},error=>{console.error(\"Error fetching projects for admin: \",error);setLoading(false);});return unsubscribe;};useEffect(()=>{const unsubscribe=fetchProjects();return()=>unsubscribe();},[]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"nav\",{className:\"-mb-px flex space-x-8\",\"aria-label\":\"Tabs\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('projects'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='projects'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:\"Proyectos\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('users'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='users'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:\"Usuarios\"})]})}),view==='users'&&/*#__PURE__*/_jsx(UserManagement,{onUserAdded:()=>{}}),view==='projects'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(NewProjectForm,{onProjectAdded:fetchProjects}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-800 my-6\",children:\"Todos los Proyectos\"}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando tabla de proyectos...\"}):/*#__PURE__*/// Se pasa el rol para que la tabla sepa qué mostrar\n_jsx(ProjectsTable,{projects:projects,onUpdateProject:fetchProjects,userRole:\"administrador\"})]})]});};// --- Componentes para la Vista de Cliente ---\nconst HeyzineViewerModal=_ref4=>{let{url,onClose}=_ref4;return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-xl w-full h-full max-w-6xl max-h-[90vh] flex flex-col\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-4 border-b\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-bold\",children:\"Visor de Documentos\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"text-gray-600 hover:text-gray-900 text-2xl font-bold\",children:\"\\xD7\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-grow\",children:/*#__PURE__*/_jsx(\"iframe\",{src:url,className:\"w-full h-full\",frameBorder:\"0\",allowFullScreen:true})})]})});};const ProjectsShelf=_ref5=>{let{projects,onOpenModal}=_ref5;const finishedProjects=projects.filter(p=>p.estadoCliente==='Terminado'&&(p.urlDocumento1||p.urlDocumento2));const coverTemplateUrl=\"https://firebasestorage.googleapis.com/v0/b/portal-evelsa.firebasestorage.app/o/portada%20Carpetas.jpeg?alt=media&token=417eb65c-1694-4efc-9e2a-55528d43a8d6\";return/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-8\",children:finishedProjects.map(project=>/*#__PURE__*/_jsxs(\"button\",{className:\"group text-left focus:outline-none\",onClick:()=>onOpenModal(project.urlDocumento2||project.urlDocumento1),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative pt-[141%] bg-gray-200 rounded-lg shadow-lg group-hover:shadow-2xl transition-all duration-300 transform group-hover:-translate-y-1 overflow-hidden\",children:[/*#__PURE__*/_jsx(\"img\",{src:coverTemplateUrl,alt:\"Portada de proyecto\",className:\"absolute inset-0 w-full h-full object-cover\"}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-0 bg-black bg-opacity-40\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute inset-0 flex flex-col justify-center items-center p-4 text-white text-center\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-bold text-lg leading-tight\",children:project.clienteNombre}),/*#__PURE__*/_jsx(\"hr\",{className:\"w-1/4 my-2 border-gray-400\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:project.servicioNombre})]})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-semibold text-gray-700 mt-3 truncate group-hover:text-blue-600\",children:project.servicioNombre})]},project.id))});};// **CÓDIGO COMPLETO Y CORREGIDO PARA NewProjectForm (FASE 2)**\nconst NewProjectForm=_ref6=>{var _collections$proveedo;let{onProjectAdded}=_ref6;const[formData,setFormData]=useState({clienteId:'',servicioId:'',proveedorId:'',comentariosApertura:'',fechaApertura:new Date().toISOString().split('T')[0],precioCotizacionCliente:'',costoProveedor:''});const[files,setFiles]=useState({cotizacionClienteFile:null,poClienteFile:null,cotizacionProveedorFile:null,poProveedorFile:null// Campo para la PO del proveedor\n});const[collections,setCollections]=useState({clientes:[],servicios:[],proveedores:[]});const[error,setError]=useState('');const[loading,setLoading]=useState(false);const isInternalProvider=((_collections$proveedo=collections.proveedores.find(p=>p.id===formData.proveedorId))===null||_collections$proveedo===void 0?void 0:_collections$proveedo.nombre)===\"Ecología y asesoría ambiental\";useEffect(()=>{const fetchData=async()=>{try{const[clientesSnap,serviciosSnap,proveedoresSnap]=await Promise.all([getDocs(query(collection(db,\"usuarios\"),where(\"rol\",\"==\",\"cliente\"))),getDocs(collection(db,\"servicios\")),getDocs(collection(db,\"proveedores\"))]);const sortByName=(a,b)=>(a.nombreCompleto||a.nombre).localeCompare(b.nombreCompleto||b.nombre);setCollections({clientes:clientesSnap.docs.map(doc=>_objectSpread({id:doc.id},doc.data())).sort(sortByName),servicios:serviciosSnap.docs.map(doc=>_objectSpread({id:doc.id},doc.data())).sort(sortByName),proveedores:proveedoresSnap.docs.map(doc=>_objectSpread({id:doc.id},doc.data())).sort(sortByName)});}catch(e){setError(\"Error al cargar datos maestros.\");}};fetchData();},[]);useEffect(()=>{if(isInternalProvider){setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{costoProveedor:'0'}));}},[formData.proveedorId,isInternalProvider]);const handleChange=e=>{const{name,value}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));};const handleFileChange=e=>{const{name,files:inputFiles}=e.target;if(inputFiles[0]){setFiles(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:inputFiles[0]}));}};const uploadFile=async(file,path)=>{if(!file)return null;const storageRef=ref(storage,path);const uploadTask=uploadBytesResumable(storageRef,file);await uploadTask;return await getDownloadURL(uploadTask.snapshot.ref);};const handleSubmit=async e=>{e.preventDefault();if(!formData.clienteId||!formData.servicioId||!formData.proveedorId){setError('Cliente, Servicio y Proveedor son obligatorios.');return;}setLoading(true);setError('');try{var _files$cotizacionClie,_files$poClienteFile,_files$cotizacionProv,_files$poProveedorFil;const urlCotizacionCliente=await uploadFile(files.cotizacionClienteFile,\"cotizaciones_clientes/\".concat(Date.now(),\"_\").concat((_files$cotizacionClie=files.cotizacionClienteFile)===null||_files$cotizacionClie===void 0?void 0:_files$cotizacionClie.name));const urlPOCliente=await uploadFile(files.poClienteFile,\"po_clientes/\".concat(Date.now(),\"_\").concat((_files$poClienteFile=files.poClienteFile)===null||_files$poClienteFile===void 0?void 0:_files$poClienteFile.name));const urlCotizacionProveedor=await uploadFile(files.cotizacionProveedorFile,\"cotizaciones_proveedores/\".concat(Date.now(),\"_\").concat((_files$cotizacionProv=files.cotizacionProveedorFile)===null||_files$cotizacionProv===void 0?void 0:_files$cotizacionProv.name));const urlPOProveedor=await uploadFile(files.poProveedorFile,\"po_proveedores/\".concat(Date.now(),\"_\").concat((_files$poProveedorFil=files.poProveedorFile)===null||_files$poProveedorFil===void 0?void 0:_files$poProveedorFil.name));const anioActual=new Date(formData.fechaApertura).getFullYear();const contadorRef=doc(db,\"contadores\",\"proyectos_\".concat(anioActual));const nuevoConsecutivo=await runTransaction(db,async transaction=>{const contadorDoc=await transaction.get(contadorRef);const nuevoValor=(contadorDoc.exists()?contadorDoc.data().consecutivo:0)+1;transaction.set(contadorRef,{consecutivo:nuevoValor},{merge:true});return nuevoValor;});const ultimosDosDigitosAnio=anioActual.toString().slice(-2);const consecutivoFormateado=nuevoConsecutivo.toString().padStart(3,'0');const cliente=collections.clientes.find(c=>c.id===formData.clienteId);const servicio=collections.servicios.find(s=>s.id===formData.servicioId);const proveedor=collections.proveedores.find(p=>p.id===formData.proveedorId);const npu=\"\".concat(cliente.clienteIdNumerico,\"-\").concat(servicio.servicioIdNumerico,\"-\").concat(proveedor.proveedorIdNumerico,\"-\").concat(consecutivoFormateado).concat(ultimosDosDigitosAnio);const poProveedorAuto=npu.slice(-8);const estadoInicial=urlPOCliente?'Activo':'Cotización';await addDoc(collection(db,\"proyectos\"),{fechaApertura:Timestamp.fromDate(new Date(formData.fechaApertura)),npu,clienteId:formData.clienteId,clienteNombre:cliente.nombreCompleto,servicioId:formData.servicioId,servicioNombre:servicio.nombre,proveedorId:formData.proveedorId,proveedorNombre:proveedor.nombre,comentariosApertura:formData.comentariosApertura,estado:estadoInicial,estadoCliente:estadoInicial,dependencia:servicio.dependencia||'Sin Dependencia',precioCotizacionCliente:Number(formData.precioCotizacionCliente)||0,urlCotizacionCliente:urlCotizacionCliente||'',urlPOCliente:urlPOCliente||'',costoProveedor:Number(formData.costoProveedor)||0,poProveedor:poProveedorAuto,urlCotizacionProveedor:urlCotizacionProveedor||'',urlPOProveedor:urlPOProveedor||''});setFormData({clienteId:'',servicioId:'',proveedorId:'',comentariosApertura:'',fechaApertura:new Date().toISOString().split('T')[0],precioCotizacionCliente:'',costoProveedor:''});setFiles({cotizacionClienteFile:null,poClienteFile:null,cotizacionProveedorFile:null,poProveedorFile:null});if(onProjectAdded)onProjectAdded();}catch(err){console.error(\"Error al crear proyecto:\",err);setError(\"Ocurri\\xF3 un error: \".concat(err.message));}setLoading(false);};return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-8\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-800 mb-4\",children:\"Crear Nuevo Proyecto\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Fecha de Apertura\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"fechaApertura\",value:formData.fechaApertura,onChange:handleChange,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"})]}),/*#__PURE__*/_jsxs(\"select\",{name:\"clienteId\",value:formData.clienteId,onChange:handleChange,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccione un Cliente\"}),collections.clientes.map(c=>/*#__PURE__*/_jsx(\"option\",{value:c.id,children:c.nombreCompleto},c.id))]}),/*#__PURE__*/_jsxs(\"select\",{name:\"servicioId\",value:formData.servicioId,onChange:handleChange,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccione un Proyecto/Servicio\"}),collections.servicios.map(s=>/*#__PURE__*/_jsx(\"option\",{value:s.id,children:s.nombre},s.id))]}),/*#__PURE__*/_jsxs(\"select\",{name:\"proveedorId\",value:formData.proveedorId,onChange:handleChange,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccione un Proveedor\"}),collections.proveedores.map(p=>/*#__PURE__*/_jsx(\"option\",{value:p.id,children:p.nombre},p.id))]}),/*#__PURE__*/_jsx(\"textarea\",{name:\"comentariosApertura\",value:formData.comentariosApertura,onChange:handleChange,placeholder:\"Comentarios de apertura\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6 border-t pt-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-700\",children:\"Informaci\\xF3n del Cliente\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Precio Cotizaci\\xF3n (sin IVA)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"precioCotizacionCliente\",value:formData.precioCotizacionCliente,onChange:handleChange,placeholder:\"0.00\",className:\"mt-1 block w-full px-3 py-2 border rounded-md\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"PDF Cotizaci\\xF3n\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"cotizacionClienteFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"PDF Orden de Compra (PO)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"poClienteFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-700\",children:\"Informaci\\xF3n del Proveedor\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Costo (sin IVA)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"costoProveedor\",value:formData.costoProveedor,onChange:handleChange,placeholder:\"0.00\",disabled:isInternalProvider,className:\"mt-1 block w-full px-3 py-2 border rounded-md disabled:bg-gray-100\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:isInternalProvider?'Número de Proyecto':'PDF Cotización Proveedor'}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"cotizacionProveedorFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"PDF Orden de Compra (PO) Proveedor\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"poProveedorFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]})]})]}),/*#__PURE__*/_jsx(Alert,{message:error,type:\"error\",onClose:()=>setError('')}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,className:\"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg disabled:bg-gray-400\",children:loading?'Creando...':'Crear Proyecto y Generar NPU'})]})]});};// **CÓDIGO ACTUALIZADO PARA ProjectsTable (FASE 3)**\nconst ProjectsTable=_ref7=>{let{projects,onUpdateProject,userRole}=_ref7;const[modalProject,setModalProject]=useState(null);const[modalType,setModalType]=useState('');// 'assign' o 'manage'\nconst[searchTerm,setSearchTerm]=useState('');const[currentPage,setCurrentPage]=useState(1);const[itemsPerPage,setItemsPerPage]=useState(10);// Modal para asignar técnicos (para Supervisor)\nconst AssignProjectModal=_ref8=>{let{project,onClose,onFinalized}=_ref8;const[technicians,setTechnicians]=useState([]);const[selectedTechnicians,setSelectedTechnicians]=useState(project.asignadoTecnicosIds||[]);const[deliveryDate,setDeliveryDate]=useState('');const[loading,setLoading]=useState(false);useEffect(()=>{const fetchTechnicians=async()=>{const q=query(collection(db,\"usuarios\"),where(\"rol\",\"==\",\"tecnico\"));const querySnapshot=await getDocs(q);setTechnicians(querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data())));};fetchTechnicians();},[]);const handleCheckboxChange=techId=>{setSelectedTechnicians(prev=>prev.includes(techId)?prev.filter(id=>id!==techId):[...prev,techId]);};const handleSave=async()=>{setLoading(true);const projectRef=doc(db,\"proyectos\",project.id);await updateDoc(projectRef,{asignadoTecnicosIds:selectedTechnicians,fechaAsignacionTecnico:Timestamp.now(),fechaEntregaInterna:deliveryDate?Timestamp.fromDate(new Date(deliveryDate)):null});setLoading(false);onFinalized();onClose();};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-md\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold mb-4\",children:[\"Asignar Proyecto: \",project.npu]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"T\\xE9cnicos Disponibles\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 max-h-48 overflow-y-auto border rounded-md p-2\",children:technicians.map(tech=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:tech.id,checked:selectedTechnicians.includes(tech.id),onChange:()=>handleCheckboxChange(tech.id),className:\"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:tech.id,className:\"ml-3 text-sm text-gray-700\",children:tech.nombreCompleto})]},tech.id))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Fecha L\\xEDmite de Entrega (Interna)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:deliveryDate,onChange:e=>setDeliveryDate(e.target.value),className:\"mt-1 block w-full px-3 py-2 border rounded-md\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,disabled:loading,className:\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\",children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,disabled:loading,className:\"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded\",children:loading?'Asignando...':'Asignar'})]})]})});};// **CÓDIGO RESTAURADO PARA ManageProjectModal**\nconst ManageProjectModal=_ref9=>{let{project,onClose,onFinalized}=_ref9;const[files,setFiles]=useState({cotizacionClienteFile:null,poClienteFile:null,cotizacionProveedorFile:null,poProveedorFile:null});const[loading,setLoading]=useState(false);const[error,setError]=useState('');const handleFileChange=e=>{const{name,files:inputFiles}=e.target;if(inputFiles[0]){setFiles(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:inputFiles[0]}));}};const uploadFile=async(file,path)=>{if(!file)return null;const storageRef=ref(storage,path);const uploadTask=uploadBytesResumable(storageRef,file);await uploadTask;return await getDownloadURL(uploadTask.snapshot.ref);};const handleSave=async()=>{setLoading(true);setError('');try{var _files$cotizacionClie2,_files$poClienteFile2,_files$cotizacionProv2,_files$poProveedorFil2;const updatePayload={};const urlCotizacionCliente=await uploadFile(files.cotizacionClienteFile,\"cotizaciones_clientes/\".concat(Date.now(),\"_\").concat((_files$cotizacionClie2=files.cotizacionClienteFile)===null||_files$cotizacionClie2===void 0?void 0:_files$cotizacionClie2.name));const urlPOCliente=await uploadFile(files.poClienteFile,\"po_clientes/\".concat(Date.now(),\"_\").concat((_files$poClienteFile2=files.poClienteFile)===null||_files$poClienteFile2===void 0?void 0:_files$poClienteFile2.name));const urlCotizacionProveedor=await uploadFile(files.cotizacionProveedorFile,\"cotizaciones_proveedores/\".concat(Date.now(),\"_\").concat((_files$cotizacionProv2=files.cotizacionProveedorFile)===null||_files$cotizacionProv2===void 0?void 0:_files$cotizacionProv2.name));const urlPOProveedor=await uploadFile(files.poProveedorFile,\"po_proveedores/\".concat(Date.now(),\"_\").concat((_files$poProveedorFil2=files.poProveedorFile)===null||_files$poProveedorFil2===void 0?void 0:_files$poProveedorFil2.name));if(urlCotizacionCliente)updatePayload.urlCotizacionCliente=urlCotizacionCliente;if(urlPOCliente)updatePayload.urlPOCliente=urlPOCliente;if(urlCotizacionProveedor)updatePayload.urlCotizacionProveedor=urlCotizacionProveedor;if(urlPOProveedor)updatePayload.urlPOProveedor=urlPOProveedor;if(urlPOCliente){updatePayload.estado='Activo';updatePayload.estadoCliente='Activo';}if(Object.keys(updatePayload).length>0){const projectRef=doc(db,\"proyectos\",project.id);await updateDoc(projectRef,updatePayload);}onFinalized();onClose();}catch(err){setError(\"Error al subir documentos.\");setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold mb-4\",children:[\"Gestionar Documentos: \",project.npu]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"PDF Cotizaci\\xF3n Cliente\"}),project.urlCotizacionCliente?/*#__PURE__*/_jsx(\"a\",{href:project.urlCotizacionCliente,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500 text-sm\",children:\"Ver actual\"}):/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"cotizacionClienteFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"PDF Orden de Compra (PO) Cliente\"}),project.urlPOCliente?/*#__PURE__*/_jsx(\"a\",{href:project.urlPOCliente,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500 text-sm\",children:\"Ver actual\"}):/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"poClienteFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"PDF Cotizaci\\xF3n Proveedor\"}),project.urlCotizacionProveedor?/*#__PURE__*/_jsx(\"a\",{href:project.urlCotizacionProveedor,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500 text-sm\",children:\"Ver actual\"}):/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"cotizacionProveedorFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"PDF Orden de Compra (PO) Proveedor\"}),project.urlPOProveedor?/*#__PURE__*/_jsx(\"a\",{href:project.urlPOProveedor,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500 text-sm\",children:\"Ver actual\"}):/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"poProveedorFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]})]}),/*#__PURE__*/_jsx(Alert,{message:error,type:\"error\",onClose:()=>setError('')}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,disabled:loading,className:\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\",children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,disabled:loading,className:\"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded\",children:loading?'Guardando...':'Guardar Cambios'})]})]})});};const filteredProjects=projects.filter(project=>project.npu&&project.npu.toLowerCase().includes(searchTerm.toLowerCase())||project.clienteNombre&&project.clienteNombre.toLowerCase().includes(searchTerm.toLowerCase())||project.servicioNombre&&project.servicioNombre.toLowerCase().includes(searchTerm.toLowerCase()));const currentItems=filteredProjects.slice((currentPage-1)*itemsPerPage,currentPage*itemsPerPage);const totalPages=Math.ceil(filteredProjects.length/itemsPerPage);const paginate=pageNumber=>setCurrentPage(pageNumber);const formatDate=timestamp=>!timestamp?'---':new Date(timestamp.seconds*1000).toLocaleDateString('es-MX');const handleActivateProject=async projectId=>{await updateDoc(doc(db,\"proyectos\",projectId),{estado:'Activo',estadoCliente:'Activo'});};const handleDeleteProject=async(projectId,projectNpu)=>{if(window.confirm(\"\\xBFEst\\xE1s seguro de que quieres borrar el proyecto \".concat(projectNpu,\"?\"))){await deleteDoc(doc(db,\"proyectos\",projectId));}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 flex flex-col md:flex-row justify-between items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Buscar por NPU, cliente, servicio o dependencia...\",className:\"w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md mb-2 md:mb-0\",onChange:e=>{setSearchTerm(e.target.value);setCurrentPage(1);}}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm mr-2\",children:\"Mostrar:\"}),/*#__PURE__*/_jsxs(\"select\",{value:itemsPerPage,onChange:e=>{setItemsPerPage(Number(e.target.value));setCurrentPage(1);},className:\"px-2 py-1 border border-gray-300 rounded-md\",children:[/*#__PURE__*/_jsx(\"option\",{value:10,children:\"10\"}),/*#__PURE__*/_jsx(\"option\",{value:25,children:\"25\"}),/*#__PURE__*/_jsx(\"option\",{value:50,children:\"50\"}),/*#__PURE__*/_jsx(\"option\",{value:100,children:\"100\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto bg-white rounded-lg shadow\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"NPU\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Cliente\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Servicio\"}),userRole==='administrador'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"PO Prov.\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Precio\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Costo\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Docs\"})]}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Estado\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Acciones\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:currentItems.map(project=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm font-medium\",children:project.npu}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.clienteNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.servicioNombre}),userRole==='administrador'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.poProveedor}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-green-600\",children:[\"$\",(project.precioCotizacionCliente||0).toFixed(2)]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-red-600\",children:[\"$\",(project.costoProveedor||0).toFixed(2)]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[project.urlCotizacionCliente&&/*#__PURE__*/_jsx(\"a\",{href:project.urlCotizacionCliente,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500\",children:\"Cot.C\"}),project.urlPOCliente&&/*#__PURE__*/_jsx(\"a\",{href:project.urlPOCliente,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500\",children:\"PO.C\"})]})})]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap\",children:/*#__PURE__*/_jsx(\"span\",{className:\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full \".concat(project.estado==='Activo'?'bg-orange-100 text-orange-800':'bg-gray-100 text-gray-800'),children:project.estado})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm font-medium\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[project.estado==='Cotización'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleActivateProject(project.id),className:\"text-green-600 hover:text-green-900\",children:\"Activar\"}),userRole==='administrador'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setModalProject(project);setModalType('manage');},className:\"text-indigo-600 hover:text-indigo-900\",children:\"Gestionar\"}),userRole==='supervisor'&&project.estado==='Activo'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setModalProject(project);setModalType('assign');},className:\"text-indigo-600 hover:text-indigo-900\",children:\"Asignar\"}),project.estado!=='Terminado'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDeleteProject(project.id,project.npu),className:\"text-red-600 hover:text-red-900\",children:\"Borrar\"})]})})]},project.id))})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-700\",children:[\"P\\xE1gina \",currentPage,\" de \",totalPages]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>paginate(currentPage-1),disabled:currentPage===1,className:\"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50\",children:\"Anterior\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>paginate(currentPage+1),disabled:currentPage===totalPages||totalPages===0,className:\"px-3 py-1 border rounded-md bg-white disabled:opacity-50\",children:\"Siguiente\"})]})]}),modalProject&&modalType==='assign'&&/*#__PURE__*/_jsx(AssignProjectModal,{project:modalProject,onClose:()=>setModalProject(null),onFinalized:onUpdateProject}),modalProject&&modalType==='manage'&&/*#__PURE__*/_jsx(ManageProjectModal,{project:modalProject,onClose:()=>setModalProject(null),onFinalized:onUpdateProject})]});};const ClientProjectsList=_ref0=>{let{projects,onOpenModal}=_ref0;const[activeAccordion,setActiveAccordion]=useState(null);const groupedProjects=projects.reduce((acc,project)=>{const key=project.dependencia||'Sin Dependencia';if(!acc[key])acc[key]=[];acc[key].push(project);return acc;},{});const toggleAccordion=key=>setActiveAccordion(activeAccordion===key?null:key);const formatDate=timestamp=>!timestamp?'---':new Date(timestamp.seconds*1000).toLocaleDateString('es-MX');const getStatusClass=estado=>estado==='Activo'?'bg-orange-100 text-orange-800':'bg-green-100 text-green-800';return/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:Object.entries(groupedProjects).map(_ref1=>{let[dependencia,projs]=_ref1;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>toggleAccordion(dependencia),className:\"w-full p-4 text-left font-bold text-lg text-gray-800 flex justify-between items-center hover:bg-gray-50 transition\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[dependencia,\" \",/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-normal text-gray-500\",children:[\"(\",projs.length,\")\"]})]}),/*#__PURE__*/_jsx(\"span\",{className:\"transform transition-transform duration-300 \".concat(activeAccordion===dependencia?'rotate-180':''),children:\"\\u25BC\"})]}),activeAccordion===dependencia&&/*#__PURE__*/_jsx(\"ul\",{className:\"divide-y divide-gray-200 border-t\",children:projs.map(project=>/*#__PURE__*/_jsxs(\"li\",{className:\"p-4 md:px-6 md:py-4 flex flex-col md:flex-row md:items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 mb-4 md:mb-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-900\",children:project.servicioNombre})}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full md:w-40 mb-4 md:mb-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 hidden md:block\",children:formatDate(project.fechaApertura)})}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full md:w-40 mb-4 md:mb-0\",children:/*#__PURE__*/_jsx(\"span\",{className:\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full \".concat(getStatusClass(project.estadoCliente)),children:project.estadoCliente})}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full md:w-56 flex items-center space-x-4\",children:[project.urlDocumento1&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>onOpenModal(project.urlDocumento1),className:\"text-sm font-medium text-blue-600 hover:text-blue-900\",children:\"Ver Doc. 1\"}),project.urlDocumento2&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>onOpenModal(project.urlDocumento2),className:\"text-sm font-medium text-blue-600 hover:text-blue-900\",children:\"Ver Doc. 2\"}),project.urlNotaPdf1&&/*#__PURE__*/_jsx(\"a\",{href:project.urlNotaPdf1,download:true,className:\"text-sm font-medium text-red-600 hover:text-red-900\",children:\"Nota 1\"}),project.urlNotaPdf2&&/*#__PURE__*/_jsx(\"a\",{href:project.urlNotaPdf2,download:true,className:\"text-sm font-medium text-red-600 hover:text-red-900\",children:\"Nota 2\"})]})]},project.id))})]},dependencia);})});};const ClientDashboard=_ref10=>{let{user,userData}=_ref10;const[projects,setProjects]=useState([]);const[loading,setLoading]=useState(true);const[clientView,setClientView]=useState('shelf');const[modalUrl,setModalUrl]=useState(null);useEffect(()=>{if(!user){setLoading(false);return;}const q=query(collection(db,\"proyectos\"),where(\"clienteId\",\"==\",user.uid),where(\"estadoCliente\",\"in\",[\"Activo\",\"Terminado\"]));const unsubscribe=onSnapshot(q,querySnapshot=>{const projectsData=querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));// Ordenar en el cliente\nprojectsData.sort((a,b)=>b.fechaApertura.seconds-a.fechaApertura.seconds);setProjects(projectsData);setLoading(false);},error=>{console.error(\"Error fetching client projects: \",error);if(error.code==='failed-precondition'){console.error(\"IMPORTANTE: Se requiere un índice compuesto en Firestore. Ve a la URL que aparece en el mensaje de error en la consola para crearlo con un solo clic.\");}setLoading(false);});return()=>unsubscribe();},[user]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-6\",children:[\"Proyectos de \",userData.nombreCompleto]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"nav\",{className:\"-mb-px flex space-x-8\",\"aria-label\":\"Tabs\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setClientView('shelf'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(clientView==='shelf'?'border-blue-500 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:\"Estanter\\xEDa de Proyectos\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setClientView('list'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(clientView==='list'?'border-blue-500 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:\"Lista Detallada\"})]})}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando proyectos...\"}):projects.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-gray-500 mt-8\",children:\"No hay proyectos para mostrar.\"}):clientView==='shelf'?/*#__PURE__*/_jsx(ProjectsShelf,{projects:projects,onOpenModal:setModalUrl}):/*#__PURE__*/_jsx(ClientProjectsList,{projects:projects,onOpenModal:setModalUrl}),modalUrl&&/*#__PURE__*/_jsx(HeyzineViewerModal,{url:modalUrl,onClose:()=>setModalUrl(null)})]});};// ... (Resto de los dashboards esqueleto)\nconst DirectivoDashboard=()=>/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold\",children:\"Dashboard de Directivos\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Pr\\xF3ximamente: Gr\\xE1ficas y reportes.\"})]});const EcotechDashboard=()=>/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold\",children:\"Dashboard de Ecotech\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Pr\\xF3ximamente: Proyectos de Ecotech.\"})]});// **CÓDIGO COMPLETO PARA SupervisorDashboard**\nconst SupervisorDashboard=_ref11=>{let{user,userData}=_ref11;const[projects,setProjects]=useState([]);const[loading,setLoading]=useState(true);const fetchProjects=()=>{setLoading(true);// Por ahora, el supervisor ve todos los proyectos activos.\n// En el futuro, podemos filtrar por los que él asigne.\nconst q=query(collection(db,\"proyectos\"),where(\"estado\",\"==\",\"Activo\"));const unsubscribe=onSnapshot(q,querySnapshot=>{const projectsData=querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setProjects(projectsData);setLoading(false);},error=>{console.error(\"Error fetching projects for supervisor: \",error);setLoading(false);});return unsubscribe;};useEffect(()=>{const unsubscribe=fetchProjects();return()=>unsubscribe();},[]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-800 my-6\",children:\"Proyectos Activos para Asignar\"}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando proyectos...\"}):/*#__PURE__*/// Usamos una versión de la tabla de proyectos\n_jsx(ProjectsTable,{projects:projects,onUpdateProject:fetchProjects,userRole:\"supervisor\"})]});};// **CÓDIGO COMPLETO Y CORREGIDO PARA TecnicoDashboard**\nconst TecnicoDashboard=_ref12=>{let{user,userData}=_ref12;const[projects,setProjects]=useState([]);const[loading,setLoading]=useState(true);const fetchProjects=()=>{setLoading(true);const q=query(collection(db,\"proyectos\"),where(\"estado\",\"==\",\"Activo\"),where(\"asignadoTecnicosIds\",\"array-contains\",user.uid));const unsubscribe=onSnapshot(q,querySnapshot=>{const projectsData=querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setProjects(projectsData);setLoading(false);},error=>{console.error(\"Error fetching projects for tecnico: \",error);setLoading(false);});return unsubscribe;};// **CORRECCIÓN**: Se añade una verificación para asegurar que 'user' no sea nulo\n// y se cambia la dependencia a 'user' en lugar de 'user.uid'.\nuseEffect(()=>{if(user){const unsubscribe=fetchProjects();return()=>unsubscribe();}},[user]);// Dependencia corregida\nreturn/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-6\",children:\"Mis Proyectos Asignados\"}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando mis proyectos...\"}):projects.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-gray-500 mt-8\",children:\"No tienes proyectos activos asignados.\"}):/*#__PURE__*/_jsx(TecnicoProjectsTable,{projects:projects,onUpdateProject:fetchProjects})]});};// **NUEVO COMPONENTE COMPLETO Y CORREGIDO: Tabla de Proyectos para Técnicos**\nconst TecnicoProjectsTable=_ref13=>{let{projects,onUpdateProject}=_ref13;const[modalProject,setModalProject]=useState(null);const ManageTaskModal=_ref14=>{let{project,onClose,onFinalized}=_ref14;const[comments,setComments]=useState('');const[evidenceFile,setEvidenceFile]=useState(null);const[loading,setLoading]=useState(false);const[error,setError]=useState('');const handleFileChange=e=>{if(e.target.files[0]){setEvidenceFile(e.target.files[0]);}};const generateAndSaveNota=async()=>{// **NUEVA VERIFICACIÓN DE SEGURIDAD**\nif(typeof window.jspdf==='undefined'){alert(\"Error Crítico: La librería para generar PDFs (jsPDF) no se ha cargado. Por favor, asegúrese de haber añadido el script a public/index.html y refresque la página.\");throw new Error(\"jsPDF library not loaded.\");}const{jsPDF}=window.jspdf;const doc=new jsPDF();const anioActual=new Date().getFullYear();const contadorRef=doc(db,\"contadores\",\"notas_entrega_\".concat(anioActual));const nuevoConsecutivo=await runTransaction(db,async transaction=>{const contadorDoc=await transaction.get(contadorRef);const nuevoValor=(contadorDoc.exists()?contadorDoc.data().consecutivo:0)+1;transaction.set(contadorRef,{consecutivo:nuevoValor},{merge:true});return nuevoValor;});const numeroNota=\"\".concat(anioActual,\"-\").concat(nuevoConsecutivo.toString().padStart(4,'0'));doc.setFont(\"helvetica\",\"bold\");doc.setFontSize(10);doc.text(\"ECOLOGÍA Y ASESORÍA AMBIENTAL S. DE R.L. DE C.V.\",105,20,{align:'center'});doc.setFont(\"helvetica\",\"normal\");doc.setFontSize(8);doc.text(\"HERMANOS ESCOBAR 6150-2 PARQUE INDUSTRIAL OMEGA\",105,25,{align:'center'});doc.text(\"CP.32410CD. JUÁREZ, CHIHUAHUA. RFC EAA12060765A\",105,29,{align:'center'});doc.setFontSize(16);doc.setFont(\"helvetica\",\"bold\");doc.text(\"NOTA DE ENTREGA\",105,45,{align:'center'});doc.text(numeroNota,180,55);doc.setFontSize(11);doc.setFont(\"helvetica\",\"normal\");doc.text(\"FECHA: \".concat(new Date().toLocaleDateString('es-MX')),20,65);doc.text(\"PROYECTO: \".concat(project.npu),20,75);doc.text(\"NOMBRE/RAZ\\xD3N SOCIAL: \".concat(project.clienteNombre),20,85);doc.rect(15,95,180,20);doc.text(\"DESCRIPCIÓN\",20,101);doc.text(\"CANTIDAD\",170,101);doc.text(project.servicioNombre,20,108);doc.text(\"1\",175,108);doc.text(\"Comentarios:\",20,125);const splitComments=doc.splitTextToSize(comments,170);doc.text(splitComments,20,132);doc.text(\"RECIBIDO POR:\",20,250);doc.line(20,260,100,260);doc.text(\"NOMBRE Y FIRMA\",45,265);return{blob:doc.output('blob'),numeroNota};};const handleCompleteTask=async()=>{if(!evidenceFile){setError(\"Es obligatorio subir el archivo PDF de evidencia.\");return;}setLoading(true);setError('');try{const evidenceRef=ref(storage,\"evidencia_tecnicos/\".concat(project.id,\"/\").concat(evidenceFile.name));const evidenceUploadTask=uploadBytesResumable(evidenceRef,evidenceFile);const evidenceUrl=await getDownloadURL((await evidenceUploadTask).ref);const{blob:notaBlob,numeroNota}=await generateAndSaveNota();const notaRef=ref(storage,\"notas_internas/\".concat(project.id,\"/nota_\").concat(numeroNota,\".pdf\"));const notaUploadTask=uploadBytesResumable(notaRef,notaBlob);const notaUrl=await getDownloadURL((await notaUploadTask).ref);const projectRef=doc(db,\"proyectos\",project.id);await updateDoc(projectRef,{estado:'Terminado Internamente',urlEvidenciaTecnico:evidenceUrl,urlNotaInterna:notaUrl,numeroNotaInterna:numeroNota,comentariosTecnico:comments});onFinalized();onClose();}catch(err){console.error(\"Error al completar la tarea:\",err);setError(\"Ocurrió un error al guardar los datos.\");setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold mb-4\",children:[\"Gestionar Tarea: \",project.npu]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Comentarios Finales (para Nota de Entrega)\"}),/*#__PURE__*/_jsx(\"textarea\",{value:comments,onChange:e=>setComments(e.target.value),rows:\"4\",className:\"mt-1 block w-full px-3 py-2 border rounded-md\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Subir Evidencia T\\xE9cnica (PDF)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".pdf\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]})]}),/*#__PURE__*/_jsx(Alert,{message:error,type:\"error\",onClose:()=>setError('')}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,disabled:loading,className:\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\",children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleCompleteTask,disabled:loading,className:\"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded\",children:loading?'Enviando...':'Generar Nota y Finalizar Tarea'})]})]})});};const formatDate=timestamp=>!timestamp?'---':new Date(timestamp.seconds*1000).toLocaleDateString('es-MX');return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto bg-white rounded-lg shadow\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Cliente\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Servicio\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Fecha L\\xEDmite\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Acciones\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:projects.map(project=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.clienteNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.servicioNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:formatDate(project.fechaEntregaInterna)}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm font-medium\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>setModalProject(project),className:\"text-indigo-600 hover:text-indigo-900\",children:\"Gestionar Tarea\"})})]},project.id))})]})}),modalProject&&/*#__PURE__*/_jsx(ManageTaskModal,{project:modalProject,onClose:()=>setModalProject(null),onFinalized:onUpdateProject})]});};const FinanzasDashboard=()=>/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold\",children:\"Dashboard de Finanzas\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Pr\\xF3ximamente: Cuentas por pagar y por cobrar.\"})]});// **CÓDIGO COMPLETO PARA PracticanteDashboard**\nconst PracticanteDashboard=()=>{const[projects,setProjects]=useState([]);const[loading,setLoading]=useState(true);const[modalProject,setModalProject]=useState(null);const fetchProjects=()=>{setLoading(true);const q=query(collection(db,\"proyectos\"),where(\"estado\",\"in\",[\"Terminado Internamente\",\"En Revisión Final\"]));const unsubscribe=onSnapshot(q,querySnapshot=>{const projectsData=querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setProjects(projectsData);setLoading(false);},error=>{console.error(\"Error fetching projects for practicante: \",error);setLoading(false);});return unsubscribe;};useEffect(()=>{const unsubscribe=fetchProjects();return()=>unsubscribe();},[]);const ManageFinalDeliveryModal=_ref15=>{let{project,onClose,onFinalized}=_ref15;const[formData1,setFormData1]=useState({urlDocumento:project.urlDocumento1||''});const[notaPdfFile1,setNotaPdfFile1]=useState(null);const[formData2,setFormData2]=useState({urlDocumento:project.urlDocumento2||''});const[notaPdfFile2,setNotaPdfFile2]=useState(null);const[loading,setLoading]=useState(false);const handleChange=setter=>e=>setter(prev=>_objectSpread(_objectSpread({},prev),{},{urlDocumento:e.target.value}));const handleFileChange=setter=>e=>{if(e.target.files[0])setter(e.target.files[0]);};const uploadFile=async(file,path)=>{if(!file)return null;const storageRef=ref(storage,path);const uploadTask=uploadBytesResumable(storageRef,file);return getDownloadURL((await uploadTask).ref);};const handleSave=async()=>{setLoading(true);const updatePayload={};const nota1Url=await uploadFile(notaPdfFile1,\"notas_entrega_cliente/\".concat(project.id,\"/nota1_\").concat(notaPdfFile1===null||notaPdfFile1===void 0?void 0:notaPdfFile1.name));const nota2Url=await uploadFile(notaPdfFile2,\"notas_entrega_cliente/\".concat(project.id,\"/nota2_\").concat(notaPdfFile2===null||notaPdfFile2===void 0?void 0:notaPdfFile2.name));if(nota1Url)updatePayload.urlNotaPdf1=nota1Url;if(formData1.urlDocumento)updatePayload.urlDocumento1=formData1.urlDocumento;if(nota2Url)updatePayload.urlNotaPdf2=nota2Url;if(formData2.urlDocumento)updatePayload.urlDocumento2=formData2.urlDocumento;if(Object.keys(updatePayload).length>0){await updateDoc(doc(db,\"proyectos\",project.id),updatePayload);}onFinalized();onClose();};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold mb-4\",children:[\"Gestionar Entrega Final: \",project.npu]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Enlace Heyzine (Doc. 1)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData1.urlDocumento,onChange:handleChange(setFormData1),className:\"mt-1 block w-full border rounded-md p-2\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Nota de Entrega 1 (Firmada)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".pdf\",onChange:handleFileChange(setNotaPdfFile1),className:\"mt-1 block w-full text-sm\"})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Enlace Heyzine (Doc. 2)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData2.urlDocumento,onChange:handleChange(setFormData2),className:\"mt-1 block w-full border rounded-md p-2\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Nota de Entrega 2 (Firmada)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".pdf\",onChange:handleFileChange(setNotaPdfFile2),className:\"mt-1 block w-full text-sm\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded\",children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,className:\"bg-blue-600 text-white font-bold py-2 px-4 rounded\",children:loading?'Guardando...':'Guardar Documentos'})]})]})});};const handleSendToReview=async projectId=>{if(window.confirm(\"¿Estás seguro de que todos los documentos están listos y quieres enviar este proyecto a revisión final?\")){await updateDoc(doc(db,\"proyectos\",projectId),{estado:'En Revisión Final'});}};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-6\",children:\"Proyectos Listos para Documentar\"}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando...\"}):projects.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No hay proyectos pendientes.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto bg-white rounded-lg shadow\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"NPU\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Servicio\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Docs. del T\\xE9cnico\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Acciones\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:projects.map(project=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:project.npu}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:project.servicioNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-4\",children:[/*#__PURE__*/_jsx(\"a\",{href:project.urlEvidenciaTecnico,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-600\",children:\"Ver Evidencia\"}),/*#__PURE__*/_jsx(\"a\",{href:project.urlNotaInterna,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-600\",children:\"Ver Nota Interna\"})]})}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm font-medium\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setModalProject(project),className:\"text-indigo-600 hover:text-indigo-900 mr-4\",children:\"Gestionar Entrega\"}),project.estado==='Terminado Internamente'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleSendToReview(project.id),className:\"text-green-600 hover:text-green-900\",children:\"Enviar a Revisi\\xF3n\"})]})]},project.id))})]})}),modalProject&&/*#__PURE__*/_jsx(ManageFinalDeliveryModal,{project:modalProject,onClose:()=>setModalProject(null),onFinalized:fetchProjects})]});};// --- Componente Principal \"Router\" ---\nconst Dashboard=_ref16=>{let{user,userData}=_ref16;const renderDashboardByRole=()=>{switch(userData.rol){case'administrador':return/*#__PURE__*/_jsx(AdminDashboard,{});case'cliente':return/*#__PURE__*/_jsx(ClientDashboard,{user:user,userData:userData});case'directivo':return/*#__PURE__*/_jsx(DirectivoDashboard,{});case'ecotech':return/*#__PURE__*/_jsx(EcotechDashboard,{});case'supervisor':return/*#__PURE__*/_jsx(SupervisorDashboard,{});case'tecnico':return/*#__PURE__*/_jsx(TecnicoDashboard,{});case'finanzas':return/*#__PURE__*/_jsx(FinanzasDashboard,{});case'practicante':return/*#__PURE__*/_jsx(PracticanteDashboard,{});default:return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold\",children:\"Rol no reconocido\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Contacte al administrador.\"})]});}};return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8\",children:renderDashboardByRole()});};const AuthPage=()=>{const[email,setEmail]=useState('');const[password,setPassword]=useState('');const[error,setError]=useState('');const handleLogin=async e=>{e.preventDefault();setError('');try{await signInWithEmailAndPassword(auth,email,password);}catch(err){setError(\"Email o contraseña incorrectos.\");}};return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-[#cdcdcd]\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-md w-full bg-white p-8 rounded-xl shadow-2xl\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"https://www.grupoevelsa.com/assets/images/Logo Evelsa 2.png\",alt:\"Logo Grupo Evelsa\",className:\"h-16 mx-auto mb-6\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-center text-gray-800 mb-8\",children:\"Acceso al Portal\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLogin,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:email,onChange:e=>setEmail(e.target.value),required:true,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Contrase\\xF1a\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,onChange:e=>setPassword(e.target.value),required:true,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"})]}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 text-sm text-center\",children:error}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-3 px-4 rounded-lg transition duration-300 text-lg\",children:\"Entrar\"})]})]})});};export default function App(){const[user,setUser]=useState(null);const[userData,setUserData]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{const unsubscribe=onAuthStateChanged(auth,async currentUser=>{if(currentUser){const userDocRef=doc(db,\"usuarios\",currentUser.uid);const userDoc=await getDoc(userDocRef);if(userDoc.exists()){setUserData(userDoc.data());setUser(currentUser);}else{console.error(\"Usuario autenticado pero no encontrado en Firestore. Deslogueando...\");signOut(auth);}}else{setUser(null);setUserData(null);}setLoading(false);});return()=>unsubscribe();},[]);if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-[#cdcdcd] text-gray-700\",children:\"Cargando...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-[#c9c9c9] min-h-screen font-sans\",children:[/*#__PURE__*/_jsx(Header,{user:user,userData:userData}),/*#__PURE__*/_jsx(\"main\",{children:user&&userData?/*#__PURE__*/_jsx(Dashboard,{user:user,userData:userData}):/*#__PURE__*/_jsx(AuthPage,{})})]});}","map":{"version":3,"names":["React","useState","useEffect","initializeApp","getAuth","onAuthStateChanged","createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","getFirestore","collection","addDoc","query","where","getDocs","doc","getDoc","updateDoc","onSnapshot","setDoc","Timestamp","runTransaction","orderBy","deleteDoc","getStorage","ref","uploadBytesResumable","getDownloadURL","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","app","auth","db","storage","Alert","_ref","message","type","onClose","baseClasses","typeClasses","error","success","className","concat","role","children","onClick","Header","_ref2","user","userData","logoGrupoEvelsa","rol","logoUrl","src","onError","e","target","onerror","alt","nombreCompleto","split","email","UserManagement","_ref3","onUserAdded","setEmail","password","setPassword","setNombreCompleto","setRol","clienteIdNumerico","setClienteIdNumerico","setLogoUrl","setError","setSuccess","resetForm","handleSubmit","preventDefault","tempApp","Date","getTime","tempAuth","userCredential","uid","padStart","err","onSubmit","value","onChange","placeholder","AdminDashboard","view","setView","projects","setProjects","loading","setLoading","fetchProjects","q","unsubscribe","querySnapshot","projectsData","docs","map","_objectSpread","id","data","console","NewProjectForm","onProjectAdded","ProjectsTable","onUpdateProject","userRole","HeyzineViewerModal","_ref4","url","frameBorder","allowFullScreen","ProjectsShelf","_ref5","onOpenModal","finishedProjects","filter","p","estadoCliente","urlDocumento1","urlDocumento2","coverTemplateUrl","project","clienteNombre","servicioNombre","_ref6","_collections$proveedo","formData","setFormData","clienteId","servicioId","proveedorId","comentariosApertura","fechaApertura","toISOString","precioCotizacionCliente","costoProveedor","files","setFiles","cotizacionClienteFile","poClienteFile","cotizacionProveedorFile","poProveedorFile","collections","setCollections","clientes","servicios","proveedores","isInternalProvider","find","nombre","fetchData","clientesSnap","serviciosSnap","proveedoresSnap","Promise","all","sortByName","a","b","localeCompare","sort","prev","handleChange","name","handleFileChange","inputFiles","uploadFile","file","path","storageRef","uploadTask","snapshot","_files$cotizacionClie","_files$poClienteFile","_files$cotizacionProv","_files$poProveedorFil","urlCotizacionCliente","now","urlPOCliente","urlCotizacionProveedor","urlPOProveedor","anioActual","getFullYear","contadorRef","nuevoConsecutivo","transaction","contadorDoc","get","nuevoValor","exists","consecutivo","set","merge","ultimosDosDigitosAnio","toString","slice","consecutivoFormateado","cliente","c","servicio","s","proveedor","npu","servicioIdNumerico","proveedorIdNumerico","poProveedorAuto","estadoInicial","fromDate","proveedorNombre","estado","dependencia","Number","poProveedor","disabled","_ref7","modalProject","setModalProject","modalType","setModalType","searchTerm","setSearchTerm","currentPage","setCurrentPage","itemsPerPage","setItemsPerPage","AssignProjectModal","_ref8","onFinalized","technicians","setTechnicians","selectedTechnicians","setSelectedTechnicians","asignadoTecnicosIds","deliveryDate","setDeliveryDate","fetchTechnicians","handleCheckboxChange","techId","includes","handleSave","projectRef","fechaAsignacionTecnico","fechaEntregaInterna","tech","checked","htmlFor","ManageProjectModal","_ref9","_files$cotizacionClie2","_files$poClienteFile2","_files$cotizacionProv2","_files$poProveedorFil2","updatePayload","Object","keys","length","href","rel","filteredProjects","toLowerCase","currentItems","totalPages","Math","ceil","paginate","pageNumber","formatDate","timestamp","seconds","toLocaleDateString","handleActivateProject","handleDeleteProject","projectNpu","window","confirm","toFixed","ClientProjectsList","_ref0","activeAccordion","setActiveAccordion","groupedProjects","reduce","acc","key","push","toggleAccordion","getStatusClass","entries","_ref1","projs","urlNotaPdf1","download","urlNotaPdf2","ClientDashboard","_ref10","clientView","setClientView","modalUrl","setModalUrl","code","DirectivoDashboard","EcotechDashboard","SupervisorDashboard","_ref11","TecnicoDashboard","_ref12","TecnicoProjectsTable","_ref13","ManageTaskModal","_ref14","comments","setComments","evidenceFile","setEvidenceFile","generateAndSaveNota","jspdf","alert","Error","jsPDF","numeroNota","setFont","setFontSize","text","align","rect","splitComments","splitTextToSize","line","blob","output","handleCompleteTask","evidenceRef","evidenceUploadTask","evidenceUrl","notaBlob","notaRef","notaUploadTask","notaUrl","urlEvidenciaTecnico","urlNotaInterna","numeroNotaInterna","comentariosTecnico","rows","accept","FinanzasDashboard","PracticanteDashboard","ManageFinalDeliveryModal","_ref15","formData1","setFormData1","urlDocumento","notaPdfFile1","setNotaPdfFile1","formData2","setFormData2","notaPdfFile2","setNotaPdfFile2","setter","nota1Url","nota2Url","handleSendToReview","Dashboard","_ref16","renderDashboardByRole","AuthPage","handleLogin","required","App","setUser","setUserData","currentUser","userDocRef","userDoc"],"sources":["C:/Users/CAD/Documents/portal-evelsa/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { initializeApp } from 'firebase/app';\r\nimport { \r\n    getAuth, \r\n    onAuthStateChanged, \r\n    createUserWithEmailAndPassword, \r\n    signInWithEmailAndPassword, \r\n    signOut \r\n} from 'firebase/auth';\r\nimport { \r\n    getFirestore, \r\n    collection, \r\n    addDoc, \r\n    query, \r\n    where, \r\n    getDocs, \r\n    doc, \r\n    getDoc,\r\n    updateDoc,\r\n    onSnapshot,\r\n    setDoc,\r\n    Timestamp,\r\n    runTransaction,\r\n    orderBy,\r\n    deleteDoc\r\n} from 'firebase/firestore';\r\nimport { \r\n    getStorage, \r\n    ref, \r\n    uploadBytesResumable, \r\n    getDownloadURL \r\n} from 'firebase/storage';\r\n\r\n// --- INSTRUCCIONES DE CONFIGURACIÓN DE FIREBASE ---\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyA7H6G0mXCy9DmoLg3fSW3TrxIRcEzz9jg\",\r\n  authDomain: \"portal-evelsa.firebaseapp.com\",\r\n  projectId: \"portal-evelsa\",\r\n  storageBucket: \"portal-evelsa.firebasestorage.app\",\r\n  messagingSenderId: \"847174487471\",\r\n  appId: \"1:847174487471:web:c3a57fd8315ce619a2335a\"\r\n};\r\n\r\n// --- Inicialización de Firebase ---\r\nconst app = initializeApp(firebaseConfig);\r\nconst auth = getAuth(app);\r\nconst db = getFirestore(app);\r\nconst storage = getStorage(app);\r\n\r\n// --- Componentes Reutilizables ---\r\nconst Alert = ({ message, type, onClose }) => {\r\n    if (!message) return null;\r\n    const baseClasses = \"p-4 mb-4 text-sm rounded-lg relative\";\r\n    const typeClasses = { error: \"bg-red-100 text-red-800\", success: \"bg-green-100 text-green-800\" };\r\n    return (\r\n        <div className={`${baseClasses} ${typeClasses[type]}`} role=\"alert\">\r\n            <span className=\"font-medium\">{message}</span>\r\n            <button onClick={onClose} className=\"absolute top-0 right-0 mt-2 mr-3 text-2xl font-semibold leading-none\">&times;</button>\r\n        </div>\r\n    );\r\n};\r\n\r\n// --- Componente de Cabecera ---\r\nconst Header = ({ user, userData }) => {\r\n    const logoGrupoEvelsa = \"https://www.grupoevelsa.com/assets/images/Logo Evelsa 2.png\";\r\n    return (\r\n        <header className=\"bg-white shadow-md sticky top-0 z-40\">\r\n            <div className=\"max-w-7xl mx-auto py-3 px-4 sm:px-6 lg:px-8 flex justify-between items-center\">\r\n                <div className=\"flex items-center\">\r\n                    {userData && userData.rol === 'cliente' && userData.logoUrl ? (\r\n                        <img src={userData.logoUrl} onError={(e)=>{e.target.onerror = null; e.target.src=\"https://placehold.co/150x50/FFFFFF/000000?text=Logo+Cliente\"}} alt=\"Logo Cliente\" className=\"h-12 w-auto mr-4 object-contain\"/>\r\n                    ) : (\r\n                        <img src={logoGrupoEvelsa} alt=\"Logo Grupo Evelsa\" className=\"h-12 w-auto mr-4\"/>\r\n                    )}\r\n                </div>\r\n                {user && (\r\n                    <div className=\"flex items-center\">\r\n                        <span className=\"text-gray-600 mr-4 hidden sm:block\">\r\n                            Hola, {userData ? userData.nombreCompleto.split(' ')[0] : user.email}\r\n                        </span>\r\n                        <button onClick={() => signOut(auth)} className=\"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300\">\r\n                            Salir\r\n                        </button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </header>\r\n    );\r\n};\r\n\r\n// --- Componentes de Gestión (Para Administradores) ---\r\n\r\nconst UserManagement = ({ onUserAdded }) => {\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [nombreCompleto, setNombreCompleto] = useState('');\r\n    const [rol, setRol] = useState('cliente');\r\n    const [clienteIdNumerico, setClienteIdNumerico] = useState('');\r\n    const [logoUrl, setLogoUrl] = useState('');\r\n    const [error, setError] = useState('');\r\n    const [success, setSuccess] = useState('');\r\n\r\n    const resetForm = () => {\r\n        setEmail(''); setPassword(''); setNombreCompleto(''); setRol('cliente');\r\n        setClienteIdNumerico(''); setLogoUrl('');\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setError(''); setSuccess('');\r\n\r\n        if (!nombreCompleto || !email || !password) {\r\n            setError('Nombre, email y contraseña son obligatorios.');\r\n            return;\r\n        }\r\n        if (rol === 'cliente' && !clienteIdNumerico) {\r\n             setError('Para clientes, el ID Numérico es obligatorio.');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const tempApp = initializeApp(firebaseConfig, `Secondary-${new Date().getTime()}`);\r\n            const tempAuth = getAuth(tempApp);\r\n            const userCredential = await createUserWithEmailAndPassword(tempAuth, email, password);\r\n            \r\n            await setDoc(doc(db, \"usuarios\", userCredential.user.uid), {\r\n                email, rol, nombreCompleto,\r\n                clienteIdNumerico: rol === 'cliente' ? clienteIdNumerico.padStart(3, '0') : '',\r\n                logoUrl: rol === 'cliente' ? logoUrl : '',\r\n            });\r\n\r\n            setSuccess(`¡Usuario ${email} con rol '${rol}' creado con éxito!`);\r\n            resetForm();\r\n            if (onUserAdded) onUserAdded();\r\n        } catch (err) {\r\n            setError(`Error al crear usuario: ${err.message}`);\r\n        }\r\n    };\r\n    \r\n    return (\r\n        <div className=\"bg-white p-6 rounded-xl shadow-lg border border-gray-200\">\r\n            <h3 className=\"text-xl font-bold text-gray-800 mb-4\">Crear Nuevo Usuario</h3>\r\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                 <input type=\"text\" value={nombreCompleto} onChange={e => setNombreCompleto(e.target.value)} placeholder=\"Nombre Completo\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                 <select value={rol} onChange={e => setRol(e.target.value)} className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\">\r\n                    <option value=\"cliente\">Cliente</option>\r\n                    <option value=\"administrador\">Administrador</option>\r\n                    <option value=\"directivo\">Directivo</option>\r\n                    <option value=\"ecotech\">Encargada Ecotech</option>\r\n                    <option value=\"supervisor\">Supervisor de Proyectos</option>\r\n                    <option value=\"tecnico\">Técnico</option>\r\n                    <option value=\"finanzas\">Finanzas</option>\r\n                    <option value=\"practicante\">Practicante</option>\r\n                 </select>\r\n                 <input type=\"email\" value={email} onChange={e => setEmail(e.target.value)} placeholder=\"Email de Acceso\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                 <input type=\"password\" value={password} onChange={e => setPassword(e.target.value)} placeholder=\"Contraseña (mínimo 6 caracteres)\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                 {rol === 'cliente' && (\r\n                     <>\r\n                        <input type=\"text\" value={clienteIdNumerico} onChange={e => setClienteIdNumerico(e.target.value)} placeholder=\"ID Numérico Cliente (ej: 001)\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                        <input type=\"text\" value={logoUrl} onChange={e => setLogoUrl(e.target.value)} placeholder=\"URL del Logo (Opcional)\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                     </>\r\n                 )}\r\n                 <Alert message={error} type=\"error\" onClose={() => setError('')} />\r\n                 <Alert message={success} type=\"success\" onClose={() => setSuccess('')} />\r\n                 <button type=\"submit\" className=\"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg\">Crear Usuario</button>\r\n            </form>\r\n        </div>\r\n    );\r\n};\r\n\r\n// --- Dashboards Esqueleto para cada Rol ---\r\n\r\n// **CÓDIGO CORREGIDO PARA AdminDashboard**\r\nconst AdminDashboard = () => {\r\n    const [view, setView] = useState('projects');\r\n    const [projects, setProjects] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const fetchProjects = () => {\r\n        setLoading(true);\r\n        // El administrador ve TODOS los proyectos\r\n        const q = query(collection(db, \"proyectos\"), orderBy(\"fechaApertura\", \"desc\"));\r\n        \r\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n            const projectsData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            setProjects(projectsData);\r\n            setLoading(false);\r\n        }, (error) => {\r\n            console.error(\"Error fetching projects for admin: \", error);\r\n            setLoading(false);\r\n        });\r\n        \r\n        return unsubscribe;\r\n    };\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = fetchProjects();\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    return (\r\n        <div>\r\n            <div className=\"mb-6 border-b border-gray-200\">\r\n                <nav className=\"-mb-px flex space-x-8\" aria-label=\"Tabs\">\r\n                    <button onClick={() => setView('projects')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'projects' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>Proyectos</button>\r\n                    <button onClick={() => setView('users')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'users' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>Usuarios</button>\r\n                </nav>\r\n            </div>\r\n            \r\n            {view === 'users' && <UserManagement onUserAdded={() => {}} />}\r\n            \r\n            {view === 'projects' && (\r\n                <>\r\n                    <NewProjectForm onProjectAdded={fetchProjects} />\r\n                    <h2 className=\"text-2xl font-bold text-gray-800 my-6\">Todos los Proyectos</h2>\r\n                    {loading ? (\r\n                        <p>Cargando tabla de proyectos...</p>\r\n                    ) : (\r\n                        // Se pasa el rol para que la tabla sepa qué mostrar\r\n                        <ProjectsTable projects={projects} onUpdateProject={fetchProjects} userRole=\"administrador\" />\r\n                    )}\r\n                </>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n// --- Componentes para la Vista de Cliente ---\r\n\r\nconst HeyzineViewerModal = ({ url, onClose }) => {\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center z-50\">\r\n            <div className=\"bg-white rounded-lg shadow-xl w-full h-full max-w-6xl max-h-[90vh] flex flex-col\">\r\n                <div className=\"flex justify-between items-center p-4 border-b\">\r\n                    <h3 className=\"text-lg font-bold\">Visor de Documentos</h3>\r\n                    <button onClick={onClose} className=\"text-gray-600 hover:text-gray-900 text-2xl font-bold\">&times;</button>\r\n                </div>\r\n                <div className=\"flex-grow\">\r\n                    <iframe src={url} className=\"w-full h-full\" frameBorder=\"0\" allowFullScreen></iframe>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst ProjectsShelf = ({ projects, onOpenModal }) => {\r\n    const finishedProjects = projects.filter(p => p.estadoCliente === 'Terminado' && (p.urlDocumento1 || p.urlDocumento2));\r\n    const coverTemplateUrl = \"https://firebasestorage.googleapis.com/v0/b/portal-evelsa.firebasestorage.app/o/portada%20Carpetas.jpeg?alt=media&token=417eb65c-1694-4efc-9e2a-55528d43a8d6\";\r\n\r\n    return (\r\n        <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-8\">\r\n            {finishedProjects.map(project => (\r\n                <button key={project.id} className=\"group text-left focus:outline-none\" onClick={() => onOpenModal(project.urlDocumento2 || project.urlDocumento1)}>\r\n                    <div className=\"relative pt-[141%] bg-gray-200 rounded-lg shadow-lg group-hover:shadow-2xl transition-all duration-300 transform group-hover:-translate-y-1 overflow-hidden\">\r\n                        <img src={coverTemplateUrl} alt=\"Portada de proyecto\" className=\"absolute inset-0 w-full h-full object-cover\"/>\r\n                        <div className=\"absolute inset-0 bg-black bg-opacity-40\"></div>\r\n                        <div className=\"absolute inset-0 flex flex-col justify-center items-center p-4 text-white text-center\">\r\n                            <h4 className=\"font-bold text-lg leading-tight\">{project.clienteNombre}</h4>\r\n                            <hr className=\"w-1/4 my-2 border-gray-400\"/>\r\n                            <p className=\"text-sm\">{project.servicioNombre}</p>\r\n                        </div>\r\n                    </div>\r\n                    <p className=\"text-sm font-semibold text-gray-700 mt-3 truncate group-hover:text-blue-600\">{project.servicioNombre}</p>\r\n                </button>\r\n            ))}\r\n        </div>\r\n    );\r\n};\r\n\r\n// **CÓDIGO COMPLETO Y CORREGIDO PARA NewProjectForm (FASE 2)**\r\nconst NewProjectForm = ({ onProjectAdded }) => {\r\n    const [formData, setFormData] = useState({ \r\n        clienteId: '', \r\n        servicioId: '', \r\n        proveedorId: '', \r\n        comentariosApertura: '',\r\n        fechaApertura: new Date().toISOString().split('T')[0],\r\n        precioCotizacionCliente: '',\r\n        costoProveedor: ''\r\n    });\r\n    const [files, setFiles] = useState({\r\n        cotizacionClienteFile: null,\r\n        poClienteFile: null,\r\n        cotizacionProveedorFile: null,\r\n        poProveedorFile: null // Campo para la PO del proveedor\r\n    });\r\n\r\n    const [collections, setCollections] = useState({ clientes: [], servicios: [], proveedores: [] });\r\n    const [error, setError] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const isInternalProvider = collections.proveedores.find(p => p.id === formData.proveedorId)?.nombre === \"Ecología y asesoría ambiental\";\r\n\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            try {\r\n                const [clientesSnap, serviciosSnap, proveedoresSnap] = await Promise.all([\r\n                    getDocs(query(collection(db, \"usuarios\"), where(\"rol\", \"==\", \"cliente\"))),\r\n                    getDocs(collection(db, \"servicios\")),\r\n                    getDocs(collection(db, \"proveedores\"))\r\n                ]);\r\n                const sortByName = (a, b) => (a.nombreCompleto || a.nombre).localeCompare(b.nombreCompleto || b.nombre);\r\n                setCollections({\r\n                    clientes: clientesSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort(sortByName),\r\n                    servicios: serviciosSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort(sortByName),\r\n                    proveedores: proveedoresSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort(sortByName)\r\n                });\r\n            } catch (e) {\r\n                setError(\"Error al cargar datos maestros.\");\r\n            }\r\n        };\r\n        fetchData();\r\n    }, []);\r\n    \r\n    useEffect(() => {\r\n        if (isInternalProvider) {\r\n            setFormData(prev => ({ ...prev, costoProveedor: '0' }));\r\n        }\r\n    }, [formData.proveedorId, isInternalProvider]);\r\n\r\n\r\n    const handleChange = (e) => {\r\n        const { name, value } = e.target;\r\n        setFormData(prev => ({ ...prev, [name]: value }));\r\n    };\r\n    \r\n    const handleFileChange = (e) => {\r\n        const { name, files: inputFiles } = e.target;\r\n        if (inputFiles[0]) {\r\n            setFiles(prev => ({ ...prev, [name]: inputFiles[0] }));\r\n        }\r\n    };\r\n\r\n    const uploadFile = async (file, path) => {\r\n        if (!file) return null;\r\n        const storageRef = ref(storage, path);\r\n        const uploadTask = uploadBytesResumable(storageRef, file);\r\n        await uploadTask;\r\n        return await getDownloadURL(uploadTask.snapshot.ref);\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (!formData.clienteId || !formData.servicioId || !formData.proveedorId) {\r\n            setError('Cliente, Servicio y Proveedor son obligatorios.');\r\n            return;\r\n        }\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        try {\r\n            const urlCotizacionCliente = await uploadFile(files.cotizacionClienteFile, `cotizaciones_clientes/${Date.now()}_${files.cotizacionClienteFile?.name}`);\r\n            const urlPOCliente = await uploadFile(files.poClienteFile, `po_clientes/${Date.now()}_${files.poClienteFile?.name}`);\r\n            const urlCotizacionProveedor = await uploadFile(files.cotizacionProveedorFile, `cotizaciones_proveedores/${Date.now()}_${files.cotizacionProveedorFile?.name}`);\r\n            const urlPOProveedor = await uploadFile(files.poProveedorFile, `po_proveedores/${Date.now()}_${files.poProveedorFile?.name}`);\r\n\r\n            const anioActual = new Date(formData.fechaApertura).getFullYear();\r\n            const contadorRef = doc(db, \"contadores\", `proyectos_${anioActual}`);\r\n            const nuevoConsecutivo = await runTransaction(db, async (transaction) => {\r\n                const contadorDoc = await transaction.get(contadorRef);\r\n                const nuevoValor = (contadorDoc.exists() ? contadorDoc.data().consecutivo : 0) + 1;\r\n                transaction.set(contadorRef, { consecutivo: nuevoValor }, { merge: true });\r\n                return nuevoValor;\r\n            });\r\n            \r\n            const ultimosDosDigitosAnio = anioActual.toString().slice(-2);\r\n            const consecutivoFormateado = nuevoConsecutivo.toString().padStart(3, '0');\r\n            \r\n            const cliente = collections.clientes.find(c => c.id === formData.clienteId);\r\n            const servicio = collections.servicios.find(s => s.id === formData.servicioId);\r\n            const proveedor = collections.proveedores.find(p => p.id === formData.proveedorId);\r\n\r\n            const npu = `${cliente.clienteIdNumerico}-${servicio.servicioIdNumerico}-${proveedor.proveedorIdNumerico}-${consecutivoFormateado}${ultimosDosDigitosAnio}`;\r\n            const poProveedorAuto = npu.slice(-8);\r\n\r\n            const estadoInicial = urlPOCliente ? 'Activo' : 'Cotización';\r\n\r\n            await addDoc(collection(db, \"proyectos\"), {\r\n                fechaApertura: Timestamp.fromDate(new Date(formData.fechaApertura)),\r\n                npu,\r\n                clienteId: formData.clienteId,\r\n                clienteNombre: cliente.nombreCompleto,\r\n                servicioId: formData.servicioId,\r\n                servicioNombre: servicio.nombre,\r\n                proveedorId: formData.proveedorId,\r\n                proveedorNombre: proveedor.nombre,\r\n                comentariosApertura: formData.comentariosApertura,\r\n                estado: estadoInicial,\r\n                estadoCliente: estadoInicial,\r\n                dependencia: servicio.dependencia || 'Sin Dependencia',\r\n                \r\n                precioCotizacionCliente: Number(formData.precioCotizacionCliente) || 0,\r\n                urlCotizacionCliente: urlCotizacionCliente || '',\r\n                urlPOCliente: urlPOCliente || '',\r\n                \r\n                costoProveedor: Number(formData.costoProveedor) || 0,\r\n                poProveedor: poProveedorAuto,\r\n                urlCotizacionProveedor: urlCotizacionProveedor || '',\r\n                urlPOProveedor: urlPOProveedor || '',\r\n            });\r\n            \r\n            setFormData({ clienteId: '', servicioId: '', proveedorId: '', comentariosApertura: '', fechaApertura: new Date().toISOString().split('T')[0], precioCotizacionCliente: '', costoProveedor: '' });\r\n            setFiles({ cotizacionClienteFile: null, poClienteFile: null, cotizacionProveedorFile: null, poProveedorFile: null });\r\n            if (onProjectAdded) onProjectAdded();\r\n\r\n        } catch (err) {\r\n            console.error(\"Error al crear proyecto:\", err);\r\n            setError(`Ocurrió un error: ${err.message}`);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    return (\r\n        <div className=\"bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-8\">\r\n            <h3 className=\"text-xl font-bold text-gray-800 mb-4\">Crear Nuevo Proyecto</h3>\r\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n                <div className=\"space-y-4\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700\">Fecha de Apertura</label>\r\n                        <input type=\"date\" name=\"fechaApertura\" value={formData.fechaApertura} onChange={handleChange} className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                    </div>\r\n                     <select name=\"clienteId\" value={formData.clienteId} onChange={handleChange} className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\">\r\n                        <option value=\"\">Seleccione un Cliente</option>\r\n                        {collections.clientes.map(c => <option key={c.id} value={c.id}>{c.nombreCompleto}</option>)}\r\n                     </select>\r\n                     <select name=\"servicioId\" value={formData.servicioId} onChange={handleChange} className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\">\r\n                        <option value=\"\">Seleccione un Proyecto/Servicio</option>\r\n                        {collections.servicios.map(s => <option key={s.id} value={s.id}>{s.nombre}</option>)}\r\n                     </select>\r\n                     <select name=\"proveedorId\" value={formData.proveedorId} onChange={handleChange} className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\">\r\n                        <option value=\"\">Seleccione un Proveedor</option>\r\n                        {collections.proveedores.map(p => <option key={p.id} value={p.id}>{p.nombre}</option>)}\r\n                     </select>\r\n                    <textarea name=\"comentariosApertura\" value={formData.comentariosApertura} onChange={handleChange} placeholder=\"Comentarios de apertura\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"></textarea>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 border-t pt-6\">\r\n                    <div className=\"space-y-4\">\r\n                        <h4 className=\"font-semibold text-gray-700\">Información del Cliente</h4>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">Precio Cotización (sin IVA)</label>\r\n                            <input type=\"number\" name=\"precioCotizacionCliente\" value={formData.precioCotizacionCliente} onChange={handleChange} placeholder=\"0.00\" className=\"mt-1 block w-full px-3 py-2 border rounded-md\"/>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">PDF Cotización</label>\r\n                            <input type=\"file\" name=\"cotizacionClienteFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">PDF Orden de Compra (PO)</label>\r\n                            <input type=\"file\" name=\"poClienteFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"space-y-4\">\r\n                        <h4 className=\"font-semibold text-gray-700\">Información del Proveedor</h4>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">Costo (sin IVA)</label>\r\n                            <input type=\"number\" name=\"costoProveedor\" value={formData.costoProveedor} onChange={handleChange} placeholder=\"0.00\" disabled={isInternalProvider} className=\"mt-1 block w-full px-3 py-2 border rounded-md disabled:bg-gray-100\"/>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">{isInternalProvider ? 'Número de Proyecto' : 'PDF Cotización Proveedor'}</label>\r\n                            <input type=\"file\" name=\"cotizacionProveedorFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">PDF Orden de Compra (PO) Proveedor</label>\r\n                            <input type=\"file\" name=\"poProveedorFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <Alert message={error} type=\"error\" onClose={() => setError('')} />\r\n                <button type=\"submit\" disabled={loading} className=\"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg disabled:bg-gray-400\">\r\n                    {loading ? 'Creando...' : 'Crear Proyecto y Generar NPU'}\r\n                </button>\r\n            </form>\r\n        </div>\r\n    );\r\n};\r\n\r\n// **CÓDIGO ACTUALIZADO PARA ProjectsTable (FASE 3)**\r\nconst ProjectsTable = ({ projects, onUpdateProject, userRole }) => {\r\n    const [modalProject, setModalProject] = useState(null);\r\n    const [modalType, setModalType] = useState(''); // 'assign' o 'manage'\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const [itemsPerPage, setItemsPerPage] = useState(10);\r\n\r\n    // Modal para asignar técnicos (para Supervisor)\r\n    const AssignProjectModal = ({ project, onClose, onFinalized }) => {\r\n        const [technicians, setTechnicians] = useState([]);\r\n        const [selectedTechnicians, setSelectedTechnicians] = useState(project.asignadoTecnicosIds || []);\r\n        const [deliveryDate, setDeliveryDate] = useState('');\r\n        const [loading, setLoading] = useState(false);\r\n\r\n        useEffect(() => {\r\n            const fetchTechnicians = async () => {\r\n                const q = query(collection(db, \"usuarios\"), where(\"rol\", \"==\", \"tecnico\"));\r\n                const querySnapshot = await getDocs(q);\r\n                setTechnicians(querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));\r\n            };\r\n            fetchTechnicians();\r\n        }, []);\r\n\r\n        const handleCheckboxChange = (techId) => {\r\n            setSelectedTechnicians(prev => \r\n                prev.includes(techId) ? prev.filter(id => id !== techId) : [...prev, techId]\r\n            );\r\n        };\r\n\r\n        const handleSave = async () => {\r\n            setLoading(true);\r\n            const projectRef = doc(db, \"proyectos\", project.id);\r\n            await updateDoc(projectRef, {\r\n                asignadoTecnicosIds: selectedTechnicians,\r\n                fechaAsignacionTecnico: Timestamp.now(),\r\n                fechaEntregaInterna: deliveryDate ? Timestamp.fromDate(new Date(deliveryDate)) : null\r\n            });\r\n            setLoading(false);\r\n            onFinalized();\r\n            onClose();\r\n        };\r\n\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n                <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-md\">\r\n                    <h3 className=\"text-lg font-bold mb-4\">Asignar Proyecto: {project.npu}</h3>\r\n                    <div className=\"space-y-4\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700\">Técnicos Disponibles</label>\r\n                            <div className=\"mt-2 max-h-48 overflow-y-auto border rounded-md p-2\">\r\n                                {technicians.map(tech => (\r\n                                    <div key={tech.id} className=\"flex items-center\">\r\n                                        <input \r\n                                            type=\"checkbox\" \r\n                                            id={tech.id} \r\n                                            checked={selectedTechnicians.includes(tech.id)}\r\n                                            onChange={() => handleCheckboxChange(tech.id)}\r\n                                            className=\"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500\"\r\n                                        />\r\n                                        <label htmlFor={tech.id} className=\"ml-3 text-sm text-gray-700\">{tech.nombreCompleto}</label>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700\">Fecha Límite de Entrega (Interna)</label>\r\n                            <input type=\"date\" value={deliveryDate} onChange={e => setDeliveryDate(e.target.value)} className=\"mt-1 block w-full px-3 py-2 border rounded-md\"/>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"mt-6 flex justify-end space-x-3\">\r\n                        <button onClick={onClose} disabled={loading} className=\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\">Cancelar</button>\r\n                        <button onClick={handleSave} disabled={loading} className=\"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded\">{loading ? 'Asignando...' : 'Asignar'}</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    // **CÓDIGO RESTAURADO PARA ManageProjectModal**\r\n    const ManageProjectModal = ({ project, onClose, onFinalized }) => {\r\n        const [files, setFiles] = useState({\r\n            cotizacionClienteFile: null,\r\n            poClienteFile: null,\r\n            cotizacionProveedorFile: null,\r\n            poProveedorFile: null\r\n        });\r\n        const [loading, setLoading] = useState(false);\r\n        const [error, setError] = useState('');\r\n\r\n        const handleFileChange = (e) => {\r\n            const { name, files: inputFiles } = e.target;\r\n            if (inputFiles[0]) {\r\n                setFiles(prev => ({ ...prev, [name]: inputFiles[0] }));\r\n            }\r\n        };\r\n\r\n        const uploadFile = async (file, path) => {\r\n            if (!file) return null;\r\n            const storageRef = ref(storage, path);\r\n            const uploadTask = uploadBytesResumable(storageRef, file);\r\n            await uploadTask;\r\n            return await getDownloadURL(uploadTask.snapshot.ref);\r\n        };\r\n\r\n        const handleSave = async () => {\r\n            setLoading(true);\r\n            setError('');\r\n            try {\r\n                const updatePayload = {};\r\n                const urlCotizacionCliente = await uploadFile(files.cotizacionClienteFile, `cotizaciones_clientes/${Date.now()}_${files.cotizacionClienteFile?.name}`);\r\n                const urlPOCliente = await uploadFile(files.poClienteFile, `po_clientes/${Date.now()}_${files.poClienteFile?.name}`);\r\n                const urlCotizacionProveedor = await uploadFile(files.cotizacionProveedorFile, `cotizaciones_proveedores/${Date.now()}_${files.cotizacionProveedorFile?.name}`);\r\n                const urlPOProveedor = await uploadFile(files.poProveedorFile, `po_proveedores/${Date.now()}_${files.poProveedorFile?.name}`);\r\n\r\n                if(urlCotizacionCliente) updatePayload.urlCotizacionCliente = urlCotizacionCliente;\r\n                if(urlPOCliente) updatePayload.urlPOCliente = urlPOCliente;\r\n                if(urlCotizacionProveedor) updatePayload.urlCotizacionProveedor = urlCotizacionProveedor;\r\n                if(urlPOProveedor) updatePayload.urlPOProveedor = urlPOProveedor;\r\n\r\n                if (urlPOCliente) {\r\n                    updatePayload.estado = 'Activo';\r\n                    updatePayload.estadoCliente = 'Activo';\r\n                }\r\n\r\n                if (Object.keys(updatePayload).length > 0) {\r\n                    const projectRef = doc(db, \"proyectos\", project.id);\r\n                    await updateDoc(projectRef, updatePayload);\r\n                }\r\n                \r\n                onFinalized();\r\n                onClose();\r\n\r\n            } catch (err) {\r\n                setError(\"Error al subir documentos.\");\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n                <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\">\r\n                    <h3 className=\"text-lg font-bold mb-4\">Gestionar Documentos: {project.npu}</h3>\r\n                    <div className=\"space-y-4\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">PDF Cotización Cliente</label>\r\n                            {project.urlCotizacionCliente ? <a href={project.urlCotizacionCliente} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500 text-sm\">Ver actual</a> : <input type=\"file\" name=\"cotizacionClienteFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>}\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">PDF Orden de Compra (PO) Cliente</label>\r\n                            {project.urlPOCliente ? <a href={project.urlPOCliente} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500 text-sm\">Ver actual</a> : <input type=\"file\" name=\"poClienteFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>}\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">PDF Cotización Proveedor</label>\r\n                            {project.urlCotizacionProveedor ? <a href={project.urlCotizacionProveedor} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500 text-sm\">Ver actual</a> : <input type=\"file\" name=\"cotizacionProveedorFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>}\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">PDF Orden de Compra (PO) Proveedor</label>\r\n                            {project.urlPOProveedor ? <a href={project.urlPOProveedor} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500 text-sm\">Ver actual</a> : <input type=\"file\" name=\"poProveedorFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>}\r\n                        </div>\r\n                    </div>\r\n                    <Alert message={error} type=\"error\" onClose={() => setError('')} />\r\n                    <div className=\"mt-6 flex justify-end space-x-3\">\r\n                        <button onClick={onClose} disabled={loading} className=\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\">Cancelar</button>\r\n                        <button onClick={handleSave} disabled={loading} className=\"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded\">{loading ? 'Guardando...' : 'Guardar Cambios'}</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const filteredProjects = projects.filter(project => \r\n        (project.npu && project.npu.toLowerCase().includes(searchTerm.toLowerCase())) ||\r\n        (project.clienteNombre && project.clienteNombre.toLowerCase().includes(searchTerm.toLowerCase())) ||\r\n        (project.servicioNombre && project.servicioNombre.toLowerCase().includes(searchTerm.toLowerCase()))\r\n    );\r\n\r\n    const currentItems = filteredProjects.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);\r\n    const totalPages = Math.ceil(filteredProjects.length / itemsPerPage);\r\n\r\n    const paginate = (pageNumber) => setCurrentPage(pageNumber);\r\n    const formatDate = (timestamp) => !timestamp ? '---' : new Date(timestamp.seconds * 1000).toLocaleDateString('es-MX');\r\n\r\n    const handleActivateProject = async (projectId) => {\r\n        await updateDoc(doc(db, \"proyectos\", projectId), { estado: 'Activo', estadoCliente: 'Activo' });\r\n    };\r\n\r\n    const handleDeleteProject = async (projectId, projectNpu) => {\r\n        if (window.confirm(`¿Estás seguro de que quieres borrar el proyecto ${projectNpu}?`)) {\r\n            await deleteDoc(doc(db, \"proyectos\", projectId));\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <div className=\"mb-4 flex flex-col md:flex-row justify-between items-center\">\r\n                <input \r\n                    type=\"text\"\r\n                    placeholder=\"Buscar por NPU, cliente, servicio o dependencia...\"\r\n                    className=\"w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md mb-2 md:mb-0\"\r\n                    onChange={(e) => { setSearchTerm(e.target.value); setCurrentPage(1); }}\r\n                />\r\n                <div className=\"flex items-center\">\r\n                    <span className=\"text-sm mr-2\">Mostrar:</span>\r\n                    <select value={itemsPerPage} onChange={(e) => { setItemsPerPage(Number(e.target.value)); setCurrentPage(1); }} className=\"px-2 py-1 border border-gray-300 rounded-md\">\r\n                        <option value={10}>10</option><option value={25}>25</option><option value={50}>50</option><option value={100}>100</option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"overflow-x-auto bg-white rounded-lg shadow\">\r\n                <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-50\">\r\n                        <tr>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">NPU</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Cliente</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Servicio</th>\r\n                            {userRole === 'administrador' && (\r\n                                <>\r\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">PO Prov.</th>\r\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Precio</th>\r\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Costo</th>\r\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Docs</th>\r\n                                </>\r\n                            )}\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Estado</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Acciones</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                        {currentItems.map(project => (\r\n                             <tr key={project.id}>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">{project.npu}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.clienteNombre}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.servicioNombre}</td>\r\n                                {userRole === 'administrador' && (\r\n                                    <>\r\n                                        <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.poProveedor}</td>\r\n                                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-green-600\">${(project.precioCotizacionCliente || 0).toFixed(2)}</td>\r\n                                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-red-600\">${(project.costoProveedor || 0).toFixed(2)}</td>\r\n                                        <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\r\n                                            <div className=\"flex space-x-2\">\r\n                                                {project.urlCotizacionCliente && <a href={project.urlCotizacionCliente} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500\">Cot.C</a>}\r\n                                                {project.urlPOCliente && <a href={project.urlPOCliente} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500\">PO.C</a>}\r\n                                            </div>\r\n                                        </td>\r\n                                    </>\r\n                                )}\r\n                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                    <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${project.estado === 'Activo' ? 'bg-orange-100 text-orange-800' : 'bg-gray-100 text-gray-800'}`}>{project.estado}</span>\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                                    <div className=\"flex items-center space-x-4\">\r\n                                        {project.estado === 'Cotización' && <button onClick={() => handleActivateProject(project.id)} className=\"text-green-600 hover:text-green-900\">Activar</button>}\r\n                                        {userRole === 'administrador' && <button onClick={() => { setModalProject(project); setModalType('manage'); }} className=\"text-indigo-600 hover:text-indigo-900\">Gestionar</button>}\r\n                                        {userRole === 'supervisor' && project.estado === 'Activo' && <button onClick={() => { setModalProject(project); setModalType('assign'); }} className=\"text-indigo-600 hover:text-indigo-900\">Asignar</button>}\r\n                                        {project.estado !== 'Terminado' && <button onClick={() => handleDeleteProject(project.id, project.npu)} className=\"text-red-600 hover:text-red-900\">Borrar</button>}\r\n                                    </div>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            <div className=\"mt-4 flex justify-between items-center\">\r\n                <span className=\"text-sm text-gray-700\">Página {currentPage} de {totalPages}</span>\r\n                <div>\r\n                    <button onClick={() => paginate(currentPage - 1)} disabled={currentPage === 1} className=\"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50\">Anterior</button>\r\n                    <button onClick={() => paginate(currentPage + 1)} disabled={currentPage === totalPages || totalPages === 0} className=\"px-3 py-1 border rounded-md bg-white disabled:opacity-50\">Siguiente</button>\r\n                </div>\r\n            </div>\r\n            {modalProject && modalType === 'assign' && <AssignProjectModal project={modalProject} onClose={() => setModalProject(null)} onFinalized={onUpdateProject} />}\r\n            {modalProject && modalType === 'manage' && <ManageProjectModal project={modalProject} onClose={() => setModalProject(null)} onFinalized={onUpdateProject} />}\r\n        </>\r\n    );\r\n};\r\n\r\n\r\nconst ClientProjectsList = ({ projects, onOpenModal }) => {\r\n    const [activeAccordion, setActiveAccordion] = useState(null);\r\n    const groupedProjects = projects.reduce((acc, project) => {\r\n        const key = project.dependencia || 'Sin Dependencia';\r\n        if (!acc[key]) acc[key] = [];\r\n        acc[key].push(project);\r\n        return acc;\r\n    }, {});\r\n\r\n    const toggleAccordion = (key) => setActiveAccordion(activeAccordion === key ? null : key);\r\n    const formatDate = (timestamp) => !timestamp ? '---' : new Date(timestamp.seconds * 1000).toLocaleDateString('es-MX');\r\n    const getStatusClass = (estado) => estado === 'Activo' ? 'bg-orange-100 text-orange-800' : 'bg-green-100 text-green-800';\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {Object.entries(groupedProjects).map(([dependencia, projs]) => (\r\n                <div key={dependencia} className=\"bg-white rounded-lg shadow overflow-hidden\">\r\n                    <button onClick={() => toggleAccordion(dependencia)} className=\"w-full p-4 text-left font-bold text-lg text-gray-800 flex justify-between items-center hover:bg-gray-50 transition\">\r\n                        <span>{dependencia} <span className=\"text-sm font-normal text-gray-500\">({projs.length})</span></span>\r\n                        <span className={`transform transition-transform duration-300 ${activeAccordion === dependencia ? 'rotate-180' : ''}`}>▼</span>\r\n                    </button>\r\n                    {activeAccordion === dependencia && (\r\n                        <ul className=\"divide-y divide-gray-200 border-t\">\r\n                            {projs.map(project => (\r\n                                <li key={project.id} className=\"p-4 md:px-6 md:py-4 flex flex-col md:flex-row md:items-center\">\r\n                                    <div className=\"flex-1 mb-4 md:mb-0\"><div className=\"text-sm font-medium text-gray-900\">{project.servicioNombre}</div></div>\r\n                                    <div className=\"w-full md:w-40 mb-4 md:mb-0\"><div className=\"text-sm text-gray-500 hidden md:block\">{formatDate(project.fechaApertura)}</div></div>\r\n                                    <div className=\"w-full md:w-40 mb-4 md:mb-0\"><span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusClass(project.estadoCliente)}`}>{project.estadoCliente}</span></div>\r\n                                    <div className=\"w-full md:w-56 flex items-center space-x-4\">\r\n                                        {project.urlDocumento1 && <button onClick={() => onOpenModal(project.urlDocumento1)} className=\"text-sm font-medium text-blue-600 hover:text-blue-900\">Ver Doc. 1</button>}\r\n                                        {project.urlDocumento2 && <button onClick={() => onOpenModal(project.urlDocumento2)} className=\"text-sm font-medium text-blue-600 hover:text-blue-900\">Ver Doc. 2</button>}\r\n                                        {project.urlNotaPdf1 && <a href={project.urlNotaPdf1} download className=\"text-sm font-medium text-red-600 hover:text-red-900\">Nota 1</a>}\r\n                                        {project.urlNotaPdf2 && <a href={project.urlNotaPdf2} download className=\"text-sm font-medium text-red-600 hover:text-red-900\">Nota 2</a>}\r\n                                    </div>\r\n                                </li>\r\n                            ))}\r\n                        </ul>\r\n                    )}\r\n                </div>\r\n            ))}\r\n        </div>\r\n    );\r\n};\r\n\r\nconst ClientDashboard = ({ user, userData }) => {\r\n    const [projects, setProjects] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [clientView, setClientView] = useState('shelf');\r\n    const [modalUrl, setModalUrl] = useState(null);\r\n\r\n    useEffect(() => {\r\n        if (!user) { setLoading(false); return; }\r\n        \r\n        const q = query(\r\n            collection(db, \"proyectos\"), \r\n            where(\"clienteId\", \"==\", user.uid),\r\n            where(\"estadoCliente\", \"in\", [\"Activo\", \"Terminado\"])\r\n        );\r\n        \r\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n            const projectsData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            // Ordenar en el cliente\r\n            projectsData.sort((a, b) => b.fechaApertura.seconds - a.fechaApertura.seconds);\r\n            setProjects(projectsData);\r\n            setLoading(false);\r\n        }, (error) => {\r\n            console.error(\"Error fetching client projects: \", error);\r\n            if (error.code === 'failed-precondition') {\r\n                 console.error(\"IMPORTANTE: Se requiere un índice compuesto en Firestore. Ve a la URL que aparece en el mensaje de error en la consola para crearlo con un solo clic.\");\r\n            }\r\n            setLoading(false);\r\n        });\r\n        \r\n        return () => unsubscribe();\r\n    }, [user]);\r\n\r\n    return (\r\n        <>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">Proyectos de {userData.nombreCompleto}</h1>\r\n            <div className=\"mb-6 border-b border-gray-200\">\r\n                <nav className=\"-mb-px flex space-x-8\" aria-label=\"Tabs\">\r\n                    <button onClick={() => setClientView('shelf')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${clientView === 'shelf' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}>\r\n                        Estantería de Proyectos\r\n                    </button>\r\n                    <button onClick={() => setClientView('list')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${clientView === 'list' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}>\r\n                        Lista Detallada\r\n                    </button>\r\n                </nav>\r\n            </div>\r\n            \r\n            {loading ? (\r\n                <p>Cargando proyectos...</p>\r\n            ) : projects.length === 0 ? (\r\n                <p className=\"text-center text-gray-500 mt-8\">No hay proyectos para mostrar.</p>\r\n            ) : clientView === 'shelf' ? (\r\n                <ProjectsShelf projects={projects} onOpenModal={setModalUrl} />\r\n            ) : (\r\n                <ClientProjectsList projects={projects} onOpenModal={setModalUrl} />\r\n            )}\r\n\r\n            {modalUrl && <HeyzineViewerModal url={modalUrl} onClose={() => setModalUrl(null)} />}\r\n        </>\r\n    );\r\n};\r\n\r\n// ... (Resto de los dashboards esqueleto)\r\nconst DirectivoDashboard = () => <div><h2 className=\"text-2xl font-bold\">Dashboard de Directivos</h2><p>Próximamente: Gráficas y reportes.</p></div>;\r\nconst EcotechDashboard = () => <div><h2 className=\"text-2xl font-bold\">Dashboard de Ecotech</h2><p>Próximamente: Proyectos de Ecotech.</p></div>;\r\n\r\n// **CÓDIGO COMPLETO PARA SupervisorDashboard**\r\nconst SupervisorDashboard = ({ user, userData }) => {\r\n    const [projects, setProjects] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const fetchProjects = () => {\r\n        setLoading(true);\r\n        // Por ahora, el supervisor ve todos los proyectos activos.\r\n        // En el futuro, podemos filtrar por los que él asigne.\r\n        const q = query(collection(db, \"proyectos\"), where(\"estado\", \"==\", \"Activo\"));\r\n        \r\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n            const projectsData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            setProjects(projectsData);\r\n            setLoading(false);\r\n        }, (error) => {\r\n            console.error(\"Error fetching projects for supervisor: \", error);\r\n            setLoading(false);\r\n        });\r\n        \r\n        return unsubscribe;\r\n    };\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = fetchProjects();\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    return (\r\n        <div>\r\n            <h2 className=\"text-2xl font-bold text-gray-800 my-6\">Proyectos Activos para Asignar</h2>\r\n            {loading ? (\r\n                <p>Cargando proyectos...</p>\r\n            ) : (\r\n                // Usamos una versión de la tabla de proyectos\r\n                <ProjectsTable projects={projects} onUpdateProject={fetchProjects} userRole=\"supervisor\" />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n// **CÓDIGO COMPLETO Y CORREGIDO PARA TecnicoDashboard**\r\nconst TecnicoDashboard = ({ user, userData }) => {\r\n    const [projects, setProjects] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const fetchProjects = () => {\r\n        setLoading(true);\r\n        const q = query(\r\n            collection(db, \"proyectos\"), \r\n            where(\"estado\", \"==\", \"Activo\"),\r\n            where(\"asignadoTecnicosIds\", \"array-contains\", user.uid)\r\n        );\r\n        \r\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n            const projectsData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            setProjects(projectsData);\r\n            setLoading(false);\r\n        }, (error) => {\r\n            console.error(\"Error fetching projects for tecnico: \", error);\r\n            setLoading(false);\r\n        });\r\n        \r\n        return unsubscribe;\r\n    };\r\n\r\n    // **CORRECCIÓN**: Se añade una verificación para asegurar que 'user' no sea nulo\r\n    // y se cambia la dependencia a 'user' en lugar de 'user.uid'.\r\n    useEffect(() => {\r\n        if (user) {\r\n            const unsubscribe = fetchProjects();\r\n            return () => unsubscribe();\r\n        }\r\n    }, [user]); // Dependencia corregida\r\n\r\n    return (\r\n        <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">Mis Proyectos Asignados</h1>\r\n            {loading ? (\r\n                <p>Cargando mis proyectos...</p>\r\n            ) : projects.length === 0 ? (\r\n                 <p className=\"text-center text-gray-500 mt-8\">No tienes proyectos activos asignados.</p>\r\n            ) : (\r\n                <TecnicoProjectsTable projects={projects} onUpdateProject={fetchProjects} />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n// **NUEVO COMPONENTE COMPLETO Y CORREGIDO: Tabla de Proyectos para Técnicos**\r\nconst TecnicoProjectsTable = ({ projects, onUpdateProject }) => {\r\n    const [modalProject, setModalProject] = useState(null);\r\n\r\n    const ManageTaskModal = ({ project, onClose, onFinalized }) => {\r\n        const [comments, setComments] = useState('');\r\n        const [evidenceFile, setEvidenceFile] = useState(null);\r\n        const [loading, setLoading] = useState(false);\r\n        const [error, setError] = useState('');\r\n\r\n        const handleFileChange = (e) => {\r\n            if (e.target.files[0]) {\r\n                setEvidenceFile(e.target.files[0]);\r\n            }\r\n        };\r\n\r\n        const generateAndSaveNota = async () => {\r\n            // **NUEVA VERIFICACIÓN DE SEGURIDAD**\r\n            if (typeof window.jspdf === 'undefined') {\r\n                alert(\"Error Crítico: La librería para generar PDFs (jsPDF) no se ha cargado. Por favor, asegúrese de haber añadido el script a public/index.html y refresque la página.\");\r\n                throw new Error(\"jsPDF library not loaded.\");\r\n            }\r\n            \r\n            const { jsPDF } = window.jspdf;\r\n            const doc = new jsPDF();\r\n\r\n            const anioActual = new Date().getFullYear();\r\n            const contadorRef = doc(db, \"contadores\", `notas_entrega_${anioActual}`);\r\n            const nuevoConsecutivo = await runTransaction(db, async (transaction) => {\r\n                const contadorDoc = await transaction.get(contadorRef);\r\n                const nuevoValor = (contadorDoc.exists() ? contadorDoc.data().consecutivo : 0) + 1;\r\n                transaction.set(contadorRef, { consecutivo: nuevoValor }, { merge: true });\r\n                return nuevoValor;\r\n            });\r\n            const numeroNota = `${anioActual}-${nuevoConsecutivo.toString().padStart(4, '0')}`;\r\n\r\n            doc.setFont(\"helvetica\", \"bold\");\r\n            doc.setFontSize(10);\r\n            doc.text(\"ECOLOGÍA Y ASESORÍA AMBIENTAL S. DE R.L. DE C.V.\", 105, 20, { align: 'center' });\r\n            doc.setFont(\"helvetica\", \"normal\");\r\n            doc.setFontSize(8);\r\n            doc.text(\"HERMANOS ESCOBAR 6150-2 PARQUE INDUSTRIAL OMEGA\", 105, 25, { align: 'center' });\r\n            doc.text(\"CP.32410CD. JUÁREZ, CHIHUAHUA. RFC EAA12060765A\", 105, 29, { align: 'center' });\r\n            doc.setFontSize(16);\r\n            doc.setFont(\"helvetica\", \"bold\");\r\n            doc.text(\"NOTA DE ENTREGA\", 105, 45, { align: 'center' });\r\n            doc.text(numeroNota, 180, 55);\r\n            doc.setFontSize(11);\r\n            doc.setFont(\"helvetica\", \"normal\");\r\n            doc.text(`FECHA: ${new Date().toLocaleDateString('es-MX')}`, 20, 65);\r\n            doc.text(`PROYECTO: ${project.npu}`, 20, 75);\r\n            doc.text(`NOMBRE/RAZÓN SOCIAL: ${project.clienteNombre}`, 20, 85);\r\n            doc.rect(15, 95, 180, 20);\r\n            doc.text(\"DESCRIPCIÓN\", 20, 101);\r\n            doc.text(\"CANTIDAD\", 170, 101);\r\n            doc.text(project.servicioNombre, 20, 108);\r\n            doc.text(\"1\", 175, 108);\r\n            doc.text(\"Comentarios:\", 20, 125);\r\n            const splitComments = doc.splitTextToSize(comments, 170);\r\n            doc.text(splitComments, 20, 132);\r\n            doc.text(\"RECIBIDO POR:\", 20, 250);\r\n            doc.line(20, 260, 100, 260);\r\n            doc.text(\"NOMBRE Y FIRMA\", 45, 265);\r\n\r\n            return { blob: doc.output('blob'), numeroNota };\r\n        };\r\n\r\n        const handleCompleteTask = async () => {\r\n            if (!evidenceFile) {\r\n                setError(\"Es obligatorio subir el archivo PDF de evidencia.\");\r\n                return;\r\n            }\r\n            setLoading(true);\r\n            setError('');\r\n\r\n            try {\r\n                const evidenceRef = ref(storage, `evidencia_tecnicos/${project.id}/${evidenceFile.name}`);\r\n                const evidenceUploadTask = uploadBytesResumable(evidenceRef, evidenceFile);\r\n                const evidenceUrl = await getDownloadURL((await evidenceUploadTask).ref);\r\n\r\n                const { blob: notaBlob, numeroNota } = await generateAndSaveNota();\r\n                const notaRef = ref(storage, `notas_internas/${project.id}/nota_${numeroNota}.pdf`);\r\n                const notaUploadTask = uploadBytesResumable(notaRef, notaBlob);\r\n                const notaUrl = await getDownloadURL((await notaUploadTask).ref);\r\n\r\n                const projectRef = doc(db, \"proyectos\", project.id);\r\n                await updateDoc(projectRef, {\r\n                    estado: 'Terminado Internamente',\r\n                    urlEvidenciaTecnico: evidenceUrl,\r\n                    urlNotaInterna: notaUrl,\r\n                    numeroNotaInterna: numeroNota,\r\n                    comentariosTecnico: comments\r\n                });\r\n                \r\n                onFinalized();\r\n                onClose();\r\n\r\n            } catch (err) {\r\n                console.error(\"Error al completar la tarea:\", err);\r\n                setError(\"Ocurrió un error al guardar los datos.\");\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n                <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\">\r\n                    <h3 className=\"text-lg font-bold mb-4\">Gestionar Tarea: {project.npu}</h3>\r\n                    <div className=\"space-y-4\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700\">Comentarios Finales (para Nota de Entrega)</label>\r\n                            <textarea value={comments} onChange={e => setComments(e.target.value)} rows=\"4\" className=\"mt-1 block w-full px-3 py-2 border rounded-md\"></textarea>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700\">Subir Evidencia Técnica (PDF)</label>\r\n                            <input type=\"file\" accept=\".pdf\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>\r\n                        </div>\r\n                    </div>\r\n                    <Alert message={error} type=\"error\" onClose={() => setError('')} />\r\n                    <div className=\"mt-6 flex justify-end space-x-3\">\r\n                        <button onClick={onClose} disabled={loading} className=\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\">Cancelar</button>\r\n                        <button onClick={handleCompleteTask} disabled={loading} className=\"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded\">{loading ? 'Enviando...' : 'Generar Nota y Finalizar Tarea'}</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const formatDate = (timestamp) => !timestamp ? '---' : new Date(timestamp.seconds * 1000).toLocaleDateString('es-MX');\r\n\r\n    return (\r\n        <>\r\n            <div className=\"overflow-x-auto bg-white rounded-lg shadow\">\r\n                <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-50\">\r\n                        <tr>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Cliente</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Servicio</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Fecha Límite</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Acciones</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                        {projects.map(project => (\r\n                             <tr key={project.id}>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.clienteNombre}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.servicioNombre}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{formatDate(project.fechaEntregaInterna)}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                                    <button onClick={() => setModalProject(project)} className=\"text-indigo-600 hover:text-indigo-900\">Gestionar Tarea</button>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n            {modalProject && <ManageTaskModal project={modalProject} onClose={() => setModalProject(null)} onFinalized={onUpdateProject} />}\r\n        </>\r\n    );\r\n};\r\n\r\nconst FinanzasDashboard = () => <div><h2 className=\"text-2xl font-bold\">Dashboard de Finanzas</h2><p>Próximamente: Cuentas por pagar y por cobrar.</p></div>;\r\n\r\n// **CÓDIGO COMPLETO PARA PracticanteDashboard**\r\nconst PracticanteDashboard = () => {\r\n    const [projects, setProjects] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [modalProject, setModalProject] = useState(null);\r\n\r\n    const fetchProjects = () => {\r\n        setLoading(true);\r\n        const q = query(collection(db, \"proyectos\"), where(\"estado\", \"in\", [\"Terminado Internamente\", \"En Revisión Final\"]));\r\n        \r\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n            const projectsData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            setProjects(projectsData);\r\n            setLoading(false);\r\n        }, (error) => {\r\n            console.error(\"Error fetching projects for practicante: \", error);\r\n            setLoading(false);\r\n        });\r\n        \r\n        return unsubscribe;\r\n    };\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = fetchProjects();\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    const ManageFinalDeliveryModal = ({ project, onClose, onFinalized }) => {\r\n        const [formData1, setFormData1] = useState({ urlDocumento: project.urlDocumento1 || '' });\r\n        const [notaPdfFile1, setNotaPdfFile1] = useState(null);\r\n        const [formData2, setFormData2] = useState({ urlDocumento: project.urlDocumento2 || '' });\r\n        const [notaPdfFile2, setNotaPdfFile2] = useState(null);\r\n        const [loading, setLoading] = useState(false);\r\n\r\n        const handleChange = (setter) => (e) => setter(prev => ({...prev, urlDocumento: e.target.value}));\r\n        const handleFileChange = (setter) => (e) => { if (e.target.files[0]) setter(e.target.files[0]) };\r\n\r\n        const uploadFile = async (file, path) => {\r\n            if (!file) return null;\r\n            const storageRef = ref(storage, path);\r\n            const uploadTask = uploadBytesResumable(storageRef, file);\r\n            return getDownloadURL((await uploadTask).ref);\r\n        };\r\n\r\n        const handleSave = async () => {\r\n            setLoading(true);\r\n            const updatePayload = {};\r\n            const nota1Url = await uploadFile(notaPdfFile1, `notas_entrega_cliente/${project.id}/nota1_${notaPdfFile1?.name}`);\r\n            const nota2Url = await uploadFile(notaPdfFile2, `notas_entrega_cliente/${project.id}/nota2_${notaPdfFile2?.name}`);\r\n\r\n            if (nota1Url) updatePayload.urlNotaPdf1 = nota1Url;\r\n            if (formData1.urlDocumento) updatePayload.urlDocumento1 = formData1.urlDocumento;\r\n            \r\n            if (nota2Url) updatePayload.urlNotaPdf2 = nota2Url;\r\n            if (formData2.urlDocumento) updatePayload.urlDocumento2 = formData2.urlDocumento;\r\n\r\n            if (Object.keys(updatePayload).length > 0) {\r\n                await updateDoc(doc(db, \"proyectos\", project.id), updatePayload);\r\n            }\r\n            onFinalized();\r\n            onClose();\r\n        };\r\n\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n                <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\">\r\n                    <h3 className=\"text-lg font-bold mb-4\">Gestionar Entrega Final: {project.npu}</h3>\r\n                    <div className=\"space-y-4\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">Enlace Heyzine (Doc. 1)</label>\r\n                            <input type=\"text\" value={formData1.urlDocumento} onChange={handleChange(setFormData1)} className=\"mt-1 block w-full border rounded-md p-2\"/>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">Nota de Entrega 1 (Firmada)</label>\r\n                            <input type=\"file\" accept=\".pdf\" onChange={handleFileChange(setNotaPdfFile1)} className=\"mt-1 block w-full text-sm\"/>\r\n                        </div>\r\n                        <hr/>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">Enlace Heyzine (Doc. 2)</label>\r\n                            <input type=\"text\" value={formData2.urlDocumento} onChange={handleChange(setFormData2)} className=\"mt-1 block w-full border rounded-md p-2\"/>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">Nota de Entrega 2 (Firmada)</label>\r\n                            <input type=\"file\" accept=\".pdf\" onChange={handleFileChange(setNotaPdfFile2)} className=\"mt-1 block w-full text-sm\"/>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"mt-6 flex justify-end space-x-3\">\r\n                        <button onClick={onClose} className=\"bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded\">Cancelar</button>\r\n                        <button onClick={handleSave} className=\"bg-blue-600 text-white font-bold py-2 px-4 rounded\">{loading ? 'Guardando...' : 'Guardar Documentos'}</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const handleSendToReview = async (projectId) => {\r\n        if (window.confirm(\"¿Estás seguro de que todos los documentos están listos y quieres enviar este proyecto a revisión final?\")) {\r\n            await updateDoc(doc(db, \"proyectos\", projectId), { estado: 'En Revisión Final' });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">Proyectos Listos para Documentar</h1>\r\n            {loading ? <p>Cargando...</p> : projects.length === 0 ? <p>No hay proyectos pendientes.</p> : (\r\n                <div className=\"overflow-x-auto bg-white rounded-lg shadow\">\r\n                    <table className=\"min-w-full divide-y divide-gray-200\">\r\n                        <thead className=\"bg-gray-50\">\r\n                            <tr>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">NPU</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Servicio</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Docs. del Técnico</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Acciones</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                            {projects.map(project => (\r\n                                 <tr key={project.id}>\r\n                                    <td className=\"px-6 py-4\">{project.npu}</td>\r\n                                    <td className=\"px-6 py-4\">{project.servicioNombre}</td>\r\n                                    <td className=\"px-6 py-4\">\r\n                                        <div className=\"flex space-x-4\">\r\n                                            <a href={project.urlEvidenciaTecnico} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600\">Ver Evidencia</a>\r\n                                            <a href={project.urlNotaInterna} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600\">Ver Nota Interna</a>\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                                        <button onClick={() => setModalProject(project)} className=\"text-indigo-600 hover:text-indigo-900 mr-4\">Gestionar Entrega</button>\r\n                                        {project.estado === 'Terminado Internamente' && <button onClick={() => handleSendToReview(project.id)} className=\"text-green-600 hover:text-green-900\">Enviar a Revisión</button>}\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            )}\r\n            {modalProject && <ManageFinalDeliveryModal project={modalProject} onClose={() => setModalProject(null)} onFinalized={fetchProjects} />}\r\n        </div>\r\n    );\r\n};\r\n\r\n// --- Componente Principal \"Router\" ---\r\nconst Dashboard = ({ user, userData }) => {\r\n    \r\n    const renderDashboardByRole = () => {\r\n        switch (userData.rol) {\r\n            case 'administrador':\r\n                return <AdminDashboard />;\r\n            case 'cliente':\r\n                return <ClientDashboard user={user} userData={userData} />;\r\n            case 'directivo':\r\n                return <DirectivoDashboard />;\r\n            case 'ecotech':\r\n                return <EcotechDashboard />;\r\n            case 'supervisor':\r\n                return <SupervisorDashboard />;\r\n            case 'tecnico':\r\n                return <TecnicoDashboard />;\r\n            case 'finanzas':\r\n                return <FinanzasDashboard />;\r\n            case 'practicante':\r\n                return <PracticanteDashboard />;\r\n            default:\r\n                return <div><h2 className=\"text-2xl font-bold\">Rol no reconocido</h2><p>Contacte al administrador.</p></div>;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8\">\r\n            {renderDashboardByRole()}\r\n        </div>\r\n    );\r\n};\r\n\r\nconst AuthPage = () => {\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [error, setError] = useState('');\r\n\r\n    const handleLogin = async (e) => {\r\n        e.preventDefault();\r\n        setError('');\r\n        try { await signInWithEmailAndPassword(auth, email, password); } \r\n        catch (err) { setError(\"Email o contraseña incorrectos.\"); }\r\n    };\r\n    \r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-[#cdcdcd]\">\r\n            <div className=\"max-w-md w-full bg-white p-8 rounded-xl shadow-2xl\">\r\n                <img src=\"https://www.grupoevelsa.com/assets/images/Logo Evelsa 2.png\" alt=\"Logo Grupo Evelsa\" className=\"h-16 mx-auto mb-6\"/>\r\n                <h2 className=\"text-2xl font-bold text-center text-gray-800 mb-8\">Acceso al Portal</h2>\r\n                <form onSubmit={handleLogin} className=\"space-y-6\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700\">Email</label>\r\n                        <input type=\"email\" value={email} onChange={(e) => setEmail(e.target.value)} required className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700\">Contraseña</label>\r\n                        <input type=\"password\" value={password} onChange={(e) => setPassword(e.target.value)} required className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                    </div>\r\n                    {error && <p className=\"text-red-500 text-sm text-center\">{error}</p>}\r\n                    <button type=\"submit\" className=\"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-3 px-4 rounded-lg transition duration-300 text-lg\">\r\n                        Entrar\r\n                    </button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\nexport default function App() {\r\n    const [user, setUser] = useState(null);\r\n    const [userData, setUserData] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = onAuthStateChanged(auth, async (currentUser) => {\r\n            if (currentUser) {\r\n                const userDocRef = doc(db, \"usuarios\", currentUser.uid);\r\n                const userDoc = await getDoc(userDocRef);\r\n                if (userDoc.exists()) {\r\n                    setUserData(userDoc.data());\r\n                    setUser(currentUser);\r\n                } else { \r\n                    console.error(\"Usuario autenticado pero no encontrado en Firestore. Deslogueando...\");\r\n                    signOut(auth); \r\n                }\r\n            } else {\r\n                setUser(null);\r\n                setUserData(null);\r\n            }\r\n            setLoading(false);\r\n        });\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    if (loading) {\r\n        return <div className=\"min-h-screen flex items-center justify-center bg-[#cdcdcd] text-gray-700\">Cargando...</div>;\r\n    }\r\n    \r\n    return (\r\n        <div className=\"bg-[#c9c9c9] min-h-screen font-sans\">\r\n             <Header user={user} userData={userData}/>\r\n             <main>\r\n                {user && userData ? <Dashboard user={user} userData={userData} /> : <AuthPage />}\r\n             </main>\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}