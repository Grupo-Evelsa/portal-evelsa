{"ast":null,"code":"import _objectSpread from\"C:/Users/CAD/Documents/portal-evelsa/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{initializeApp}from'firebase/app';import{getAuth,onAuthStateChanged,createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut}from'firebase/auth';import{getFirestore,collection,addDoc,query,where,getDocs,doc,getDoc,updateDoc,onSnapshot,setDoc,Timestamp,runTransaction,orderBy,deleteDoc,deleteField,arrayUnion}from'firebase/firestore';import{getStorage,ref,uploadBytesResumable,getDownloadURL}from'firebase/storage';import{Bar}from'react-chartjs-2';import{Chart as ChartJS,CategoryScale,LinearScale,BarElement,LineElement,PointElement,LineController,Title,Tooltip,Legend,ArcElement}from'chart.js';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";ChartJS.register(CategoryScale,LinearScale,BarElement,LineElement,PointElement,LineController,// <-- Añadir aquí\nTitle,Tooltip,Legend,ArcElement);// --- INSTRUCCIONES DE CONFIGURACIÓN DE FIREBASE ---\nconst firebaseConfig={apiKey:\"AIzaSyA7H6G0mXCy9DmoLg3fSW3TrxIRcEzz9jg\",authDomain:\"portal-evelsa.firebaseapp.com\",projectId:\"portal-evelsa\",storageBucket:\"portal-evelsa.firebasestorage.app\",messagingSenderId:\"847174487471\",appId:\"1:847174487471:web:c3a57fd8315ce619a2335a\"};// --- Inicialización de Firebase ---\nconst app=initializeApp(firebaseConfig);const auth=getAuth(app);const db=getFirestore(app);const storage=getStorage(app);// --- Componentes Reutilizables ---\nconst Alert=_ref=>{let{message,type,onClose}=_ref;if(!message)return null;const baseClasses=\"p-4 mb-4 text-sm rounded-lg relative\";const typeClasses={error:\"bg-red-100 text-red-800\",success:\"bg-green-100 text-green-800\"};return/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(baseClasses,\" \").concat(typeClasses[type]),role:\"alert\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:message}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"absolute top-0 right-0 mt-2 mr-3 text-2xl font-semibold leading-none\",children:\"\\xD7\"})]});};// **COMPONENTE REUTILIZABLE PARA CONFIRMACIONES SIMPLES**\nconst ConfirmationModal=_ref2=>{let{title,message,onConfirm,onCancel,confirmText=\"Confirmar\",cancelText=\"Cancelar\",confirmColor=\"bg-green-600\"}=_ref2;return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-sm\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-bold mb-4\",children:title}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 mb-6\",children:message}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onCancel,className:\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\",children:cancelText}),/*#__PURE__*/_jsx(\"button\",{onClick:onConfirm,className:\"\".concat(confirmColor,\" hover:opacity-90 text-white font-bold py-2 px-4 rounded\"),children:confirmText})]})]})});};// **COMPONENTE REUTILIZABLE PARA ACCIONES CON MOTIVO**\nconst ActionWithReasonModal=_ref3=>{let{title,message,onConfirm,onCancel,confirmText=\"Confirmar\",cancelText=\"Cancelar\",confirmColor=\"bg-orange-600\"}=_ref3;const[reason,setReason]=useState('');return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-md\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-bold mb-4\",children:title}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600 mb-4\",children:message}),/*#__PURE__*/_jsx(\"textarea\",{value:reason,onChange:e=>setReason(e.target.value),placeholder:\"Escribe el motivo aqu\\xED...\",rows:\"3\",className:\"w-full p-2 border rounded-md\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end space-x-3 mt-6\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onCancel,className:\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\",children:cancelText}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>onConfirm(reason),className:\"\".concat(confirmColor,\" hover:opacity-90 text-white font-bold py-2 px-4 rounded\"),children:confirmText})]})]})});};// --- COMPONENTE DE CABECERA ---\nconst Header=_ref4=>{let{user,userData}=_ref4;const logoGrupoEvelsa=\"https://www.grupoevelsa.com/assets/images/Logo Evelsa 2.png\";return/*#__PURE__*/_jsx(\"header\",{className:\"bg-white shadow-md sticky top-0 z-40\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-7xl mx-auto py-3 px-4 sm:px-6 lg:px-8 flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center\",children:userData&&userData.rol==='cliente'&&userData.logoUrl?/*#__PURE__*/_jsx(\"img\",{src:userData.logoUrl,onError:e=>{e.target.onerror=null;e.target.src=\"https://placehold.co/150x50/FFFFFF/000000?text=Logo+Cliente\";},alt:\"Logo Cliente\",className:\"h-12 w-auto mr-4 object-contain\"}):/*#__PURE__*/_jsx(\"img\",{src:logoGrupoEvelsa,alt:\"Logo Grupo Evelsa\",className:\"h-12 w-auto mr-4\"})}),user&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-600 mr-4 hidden sm:block\",children:[\"Hola, \",userData?userData.nombreCompleto.split(' ')[0]:user.email]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>signOut(auth),className:\"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300\",children:\"Salir\"})]})]})});};// **CÓDIGO COMPLETO Y CORREGIDO PARA ProjectLogModal**\nconst ProjectLogModal=_ref5=>{let{project,user,userData,onClose}=_ref5;const[logEntries,setLogEntries]=useState([]);const[newNote,setNewNote]=useState('');const[newFile,setNewFile]=useState(null);const[loading,setLoading]=useState(true);const[submitting,setSubmitting]=useState(false);// Estado para el botón de guardar\nconst[error,setError]=useState('');useEffect(()=>{const q=query(collection(db,\"bitacoras_proyectos\"),where(\"projectId\",\"==\",project.id),orderBy(\"fecha\",\"asc\"));const unsubscribe=onSnapshot(q,querySnapshot=>{setLogEntries(querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data())));setLoading(false);},err=>{console.error(\"Error fetching log entries:\",err);setError(\"No se pudo cargar la bit\\xE1cora.\");setLoading(false);});return()=>unsubscribe();},[project.id]);const handleFileChange=e=>{if(e.target.files[0])setNewFile(e.target.files[0]);};const handleSubmitNote=async()=>{if(!newNote&&!newFile)return;setSubmitting(true);setError('');try{let fileUrl='';if(newFile){const storageRef=ref(storage,\"bitacoras/\".concat(project.id,\"/\").concat(Date.now(),\"_\").concat(newFile.name));const uploadTask=uploadBytesResumable(storageRef,newFile);fileUrl=await getDownloadURL((await uploadTask).ref);}await addDoc(collection(db,\"bitacoras_proyectos\"),{projectId:project.id,autorId:user.uid,autorNombre:userData.nombreCompleto,mensaje:newNote,adjuntoUrl:fileUrl,fecha:Timestamp.now()});setNewNote('');setNewFile(null);// Limpiar el input de archivo\nconst fileInput=document.getElementById(\"file-input-\".concat(project.id));if(fileInput)fileInput.value=\"\";}catch(err){console.error(\"Error al guardar en bitácora:\",err);setError(\"No se pudo guardar la nota. Por favor, intente de nuevo.\");}finally{setSubmitting(false);// Esto asegura que el botón se reactive siempre\n}};const formatDate=timestamp=>!timestamp?'---':new Date(timestamp.seconds*1000).toLocaleString('es-MX');return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl h-[90vh] flex flex-col\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-4\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold\",children:[\"Bit\\xE1cora del Proyecto: \",project.npu]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"text-gray-600 hover:text-gray-900 text-2xl font-bold\",children:\"\\xD7\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-grow overflow-y-auto border rounded-md p-4 space-y-4 mb-4 bg-gray-50\",children:loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando bit\\xE1cora...\"}):logEntries.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No hay entradas en la bit\\xE1cora.\"}):logEntries.map(entry=>/*#__PURE__*/_jsxs(\"div\",{className:\"p-3 bg-white rounded-lg shadow-sm\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-800 whitespace-pre-wrap\",children:entry.mensaje}),entry.adjuntoUrl&&/*#__PURE__*/_jsx(\"a\",{href:entry.adjuntoUrl,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-sm text-blue-600 hover:underline\",children:\"Ver adjunto\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-xs text-gray-500 mt-2 text-right\",children:[entry.autorNombre,\" - \",formatDate(entry.fecha)]})]},entry.id))}),/*#__PURE__*/_jsxs(\"div\",{className:\"border-t pt-4\",children:[/*#__PURE__*/_jsx(\"textarea\",{value:newNote,onChange:e=>setNewNote(e.target.value),placeholder:\"A\\xF1adir nueva nota...\",rows:\"3\",className:\"w-full p-2 border rounded-md\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"file-input-\".concat(project.id),onChange:handleFileChange,className:\"w-full text-sm mt-2\"}),/*#__PURE__*/_jsx(Alert,{message:error,type:\"error\",onClose:()=>setError('')}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmitNote,disabled:submitting,className:\"w-full mt-2 bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg disabled:bg-gray-300\",children:submitting?'Guardando...':'Añadir a la Bitácora'})]})]})});};// --- Componentes de Gestión (Para Administradores) ---\nconst UserManagement=_ref6=>{let{onUserAdded}=_ref6;const[email,setEmail]=useState('');const[password,setPassword]=useState('');const[nombreCompleto,setNombreCompleto]=useState('');const[rol,setRol]=useState('cliente');const[clienteIdNumerico,setClienteIdNumerico]=useState('');const[logoUrl,setLogoUrl]=useState('');const[error,setError]=useState('');const[success,setSuccess]=useState('');const resetForm=()=>{setEmail('');setPassword('');setNombreCompleto('');setRol('cliente');setClienteIdNumerico('');setLogoUrl('');};const handleSubmit=async e=>{e.preventDefault();setError('');setSuccess('');if(!nombreCompleto||!email||!password){setError('Nombre, email y contraseña son obligatorios.');return;}if(rol==='cliente'&&!clienteIdNumerico){setError('Para clientes, el ID Numérico es obligatorio.');return;}try{const tempApp=initializeApp(firebaseConfig,\"Secondary-\".concat(new Date().getTime()));const tempAuth=getAuth(tempApp);const userCredential=await createUserWithEmailAndPassword(tempAuth,email,password);await setDoc(doc(db,\"usuarios\",userCredential.user.uid),{email,rol,nombreCompleto,clienteIdNumerico:rol==='cliente'?clienteIdNumerico.padStart(3,'0'):'',logoUrl:rol==='cliente'?logoUrl:''});setSuccess(\"\\xA1Usuario \".concat(email,\" con rol '\").concat(rol,\"' creado con \\xE9xito!\"));resetForm();if(onUserAdded)onUserAdded();}catch(err){setError(\"Error al crear usuario: \".concat(err.message));}};return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-xl shadow-lg border border-gray-200\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-800 mb-4\",children:\"Crear Nuevo Usuario\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:nombreCompleto,onChange:e=>setNombreCompleto(e.target.value),placeholder:\"Nombre Completo\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"}),/*#__PURE__*/_jsxs(\"select\",{value:rol,onChange:e=>setRol(e.target.value),className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"cliente\",children:\"Cliente\"}),/*#__PURE__*/_jsx(\"option\",{value:\"administrador\",children:\"Administrador\"}),/*#__PURE__*/_jsx(\"option\",{value:\"directivo\",children:\"Directivo\"}),/*#__PURE__*/_jsx(\"option\",{value:\"ecotech\",children:\"Encargada Ecotech\"}),/*#__PURE__*/_jsx(\"option\",{value:\"supervisor\",children:\"Supervisor de Proyectos\"}),/*#__PURE__*/_jsx(\"option\",{value:\"tecnico\",children:\"T\\xE9cnico\"}),/*#__PURE__*/_jsx(\"option\",{value:\"finanzas\",children:\"Finanzas\"}),/*#__PURE__*/_jsx(\"option\",{value:\"practicante\",children:\"Practicante\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:email,onChange:e=>setEmail(e.target.value),placeholder:\"Email de Acceso\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,onChange:e=>setPassword(e.target.value),placeholder:\"Contrase\\xF1a (m\\xEDnimo 6 caracteres)\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"}),rol==='cliente'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:clienteIdNumerico,onChange:e=>setClienteIdNumerico(e.target.value),placeholder:\"ID Num\\xE9rico Cliente (ej: 001)\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:logoUrl,onChange:e=>setLogoUrl(e.target.value),placeholder:\"URL del Logo (Opcional)\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"})]}),/*#__PURE__*/_jsx(Alert,{message:error,type:\"error\",onClose:()=>setError('')}),/*#__PURE__*/_jsx(Alert,{message:success,type:\"success\",onClose:()=>setSuccess('')}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg\",children:\"Crear Usuario\"})]})]});};// **NUEVO COMPONENTE REUTILIZABLE PARA GESTIONAR DATOS MAESTROS**\nconst DataManagement=_ref7=>{let{collectionName,title,fields,placeholderTexts}=_ref7;const[items,setItems]=useState([]);const[newItem,setNewItem]=useState({});const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[success,setSuccess]=useState('');useEffect(()=>{const q=query(collection(db,collectionName));const unsubscribe=onSnapshot(q,querySnapshot=>{const itemsData=querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setItems(itemsData);setLoading(false);},err=>{console.error(\"Error fetching \".concat(collectionName,\":\"),err);setError(\"No se pudieron cargar los datos de \".concat(title,\".\"));setLoading(false);});return()=>unsubscribe();},[collectionName,title]);const handleChange=e=>{const{name,value}=e.target;setNewItem(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));};const handleSubmit=async e=>{e.preventDefault();if(fields.some(field=>!newItem[field])){setError('Todos los campos son obligatorios.');return;}setError('');setSuccess('');try{await addDoc(collection(db,collectionName),newItem);setSuccess(\"\\xA1\".concat(title.slice(0,-1),\" a\\xF1adido con \\xE9xito!\"));setNewItem({});}catch(err){setError(\"Error al a\\xF1adir el nuevo \\xEDtem: \".concat(err.message));}};return/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-xl shadow-lg border border-gray-200\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-xl font-bold text-gray-800 mb-4\",children:[\"A\\xF1adir Nuevo \",title.slice(0,-1)]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-4\",children:[fields.map((field,index)=>/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 capitalize\",children:field.replace(/([A-Z])/g,' $1')}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:field,value:newItem[field]||'',onChange:handleChange,placeholder:placeholderTexts[index],className:\"mt-1 block w-full px-3 py-2 border rounded-md\"})]},field)),/*#__PURE__*/_jsx(Alert,{message:error,type:\"error\",onClose:()=>setError('')}),/*#__PURE__*/_jsx(Alert,{message:success,type:\"success\",onClose:()=>setSuccess('')}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg\",children:\"A\\xF1adir\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-xl shadow-lg border border-gray-200\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-xl font-bold text-gray-800 mb-4\",children:[title,\" Existentes\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-y-auto max-h-96\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsx(\"tr\",{children:fields.map(field=>/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-2 text-left text-xs font-medium uppercase\",children:field.replace(/([A-Z])/g,' $1')},field))})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:loading?/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:fields.length,children:\"Cargando...\"})}):items.map(item=>/*#__PURE__*/_jsx(\"tr\",{children:fields.map(field=>/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm\",children:item[field]},\"\".concat(item.id,\"-\").concat(field)))},item.id))})]})})]})]});};// --- Dashboards Esqueleto para cada Rol ---\n// **CÓDIGO ACTUALIZADO PARA AdminDashboard (FASE 2.2)**\nconst AdminDashboard=()=>{const[view,setView]=useState('projects');const[projects,setProjects]=useState([]);const[reviewProjects,setReviewProjects]=useState([]);const[loading,setLoading]=useState(true);// Esta función unificada se encarga de recargar los datos necesarios\nconst refreshData=()=>{setLoading(true);// Carga todos los proyectos para la vista principal\nconst qProjects=query(collection(db,\"proyectos\"),orderBy(\"fechaApertura\",\"desc\"));const unsubscribeProjects=onSnapshot(qProjects,querySnapshot=>{setProjects(querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data())));setLoading(false);// La carga principal termina aquí\n});// Carga solo los proyectos en revisión para el contador de la pestaña\nconst qReview=query(collection(db,\"proyectos\"),where(\"estado\",\"==\",\"En Revisión Final\"));const unsubscribeReview=onSnapshot(qReview,querySnapshot=>{setReviewProjects(querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data())));});// Devuelve una función para limpiar ambos listeners al desmontar el componente\nreturn()=>{unsubscribeProjects();unsubscribeReview();};};useEffect(()=>{const unsubscribe=refreshData();return()=>unsubscribe();},[]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"nav\",{className:\"-mb-px flex space-x-8\",\"aria-label\":\"Tabs\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('projects'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='projects'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:\"Proyectos\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setView('review'),className:\"relative whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='review'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:[\"Revisi\\xF3n Final\",reviewProjects.length>0&&/*#__PURE__*/_jsx(\"span\",{className:\"absolute top-2 -right-4 ml-2 px-2 py-0.5 text-xs font-bold text-white bg-red-500 rounded-full\",children:reviewProjects.length})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('users'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='users'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:\"Usuarios\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('services'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='services'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:\"Servicios\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('providers'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='providers'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:\"Proveedores\"})]})}),view==='users'&&/*#__PURE__*/_jsx(UserManagement,{onUserAdded:()=>{}}),view==='projects'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(NewProjectForm,{onProjectAdded:refreshData}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-800 my-6\",children:\"Todos los Proyectos\"}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando tabla...\"}):/*#__PURE__*/_jsx(ProjectsTable,{projects:projects,onUpdateProject:refreshData,userRole:\"administrador\"})]}),view==='review'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-800 my-6\",children:\"Proyectos Pendientes de Aprobaci\\xF3n Final\"}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando...\"}):reviewProjects.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No hay proyectos en revisi\\xF3n.\"}):/*#__PURE__*/_jsx(ReviewProjectsTable,{projects:reviewProjects,onUpdateProject:refreshData})]}),view==='services'&&/*#__PURE__*/_jsx(DataManagement,{collectionName:\"servicios\",title:\"Servicios\",fields:['nombre','servicioIdNumerico','dependencia'],placeholderTexts:['Nombre del Servicio','ID Numérico (ej: 0001)','Dependencia']}),view==='providers'&&/*#__PURE__*/_jsx(DataManagement,{collectionName:\"proveedores\",title:\"Proveedores\",fields:['nombre','proveedorIdNumerico'],placeholderTexts:['Nombre del Proveedor','ID Numérico (ej: 01)']})]});};// --- Componentes para la Vista de Cliente ---\nconst HeyzineViewerModal=_ref8=>{let{url,onClose}=_ref8;return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-xl w-full h-full max-w-6xl max-h-[90vh] flex flex-col\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-4 border-b\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-bold\",children:\"Visor de Documentos\"}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"text-gray-600 hover:text-gray-900 text-2xl font-bold\",children:\"\\xD7\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-grow\",children:/*#__PURE__*/_jsx(\"iframe\",{src:url,title:\"Visor de Heyzine\",className:\"w-full h-full\",frameBorder:\"0\",allowFullScreen:true})})]})});};const ProjectsShelf=_ref9=>{let{projects,onOpenModal}=_ref9;const finishedProjects=projects.filter(p=>p.estadoCliente==='Terminado'&&(p.urlDocumento1||p.urlDocumento2));const coverTemplateUrl=\"https://firebasestorage.googleapis.com/v0/b/portal-evelsa.firebasestorage.app/o/portada%20Carpetas.jpeg?alt=media&token=417eb65c-1694-4efc-9e2a-55528d43a8d6\";return/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-8\",children:finishedProjects.map(project=>/*#__PURE__*/_jsxs(\"button\",{className:\"group text-left focus:outline-none\",onClick:()=>onOpenModal(project.urlDocumento2||project.urlDocumento1),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative pt-[141%] bg-gray-200 rounded-lg shadow-lg group-hover:shadow-2xl transition-all duration-300 transform group-hover:-translate-y-1 overflow-hidden\",children:[/*#__PURE__*/_jsx(\"img\",{src:coverTemplateUrl,alt:\"Portada de proyecto\",className:\"absolute inset-0 w-full h-full object-cover\"}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-0 bg-black bg-opacity-40\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute inset-0 flex flex-col justify-center items-center p-4 text-white text-center\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-bold text-lg leading-tight\",children:project.clienteNombre}),/*#__PURE__*/_jsx(\"hr\",{className:\"w-1/4 my-2 border-gray-400\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:project.servicioNombre})]})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-semibold text-gray-700 mt-3 truncate group-hover:text-blue-600\",children:project.servicioNombre})]},project.id))});};// **CÓDIGO COMPLETO Y CORREGIDO PARA NewProjectForm**\nconst NewProjectForm=_ref0=>{var _collections$proveedo;let{onProjectAdded}=_ref0;const[formData,setFormData]=useState({clienteId:'',servicioId:'',proveedorId:'',comentariosApertura:'',fechaApertura:new Date().toISOString().split('T')[0],precioCotizacionCliente:'',costoProveedor:''});const[files,setFiles]=useState({cotizacionClienteFile:null,poClienteFile:null,cotizacionProveedorFile:null,poProveedorFile:null});const formRef=React.useRef(null);const[collections,setCollections]=useState({clientes:[],servicios:[],proveedores:[]});const[error,setError]=useState('');const[loading,setLoading]=useState(false);// **LÓGICA MEJORADA**: La comparación ahora es más robusta y flexible\nconst isInternalProvider=((_collections$proveedo=collections.proveedores.find(p=>p.id===formData.proveedorId))===null||_collections$proveedo===void 0?void 0:_collections$proveedo.nombre.toLowerCase().trim())===\"ecologia y asesoria ambiental\";useEffect(()=>{const fetchData=async()=>{try{const[clientesSnap,serviciosSnap,proveedoresSnap]=await Promise.all([getDocs(query(collection(db,\"usuarios\"),where(\"rol\",\"==\",\"cliente\"))),getDocs(collection(db,\"servicios\")),getDocs(collection(db,\"proveedores\"))]);const sortByName=(a,b)=>(a.nombreCompleto||a.nombre).localeCompare(b.nombreCompleto||b.nombre);setCollections({clientes:clientesSnap.docs.map(doc=>_objectSpread({id:doc.id},doc.data())).sort(sortByName),servicios:serviciosSnap.docs.map(doc=>_objectSpread({id:doc.id},doc.data())).sort(sortByName),proveedores:proveedoresSnap.docs.map(doc=>_objectSpread({id:doc.id},doc.data())).sort(sortByName)});}catch(e){setError(\"Error al cargar datos maestros.\");}};fetchData();},[]);useEffect(()=>{if(isInternalProvider){setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{costoProveedor:'0'}));}},[formData.proveedorId,isInternalProvider]);const handleChange=e=>{const{name,value}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));};const handleFileChange=e=>{const{name,files:inputFiles}=e.target;if(inputFiles[0]){setFiles(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:inputFiles[0]}));}};const uploadFile=async(file,path)=>{if(!file)return null;const storageRef=ref(storage,path);const uploadTask=uploadBytesResumable(storageRef,file);await uploadTask;return await getDownloadURL(uploadTask.snapshot.ref);};const handleSubmit=async e=>{e.preventDefault();if(!formData.clienteId||!formData.servicioId||!formData.proveedorId){setError('Cliente, Servicio y Proveedor son obligatorios.');return;}setLoading(true);setError('');try{var _files$cotizacionClie,_files$poClienteFile,_files$cotizacionProv,_files$poProveedorFil;const urlCotizacionCliente=await uploadFile(files.cotizacionClienteFile,\"cotizaciones_clientes/\".concat(Date.now(),\"_\").concat((_files$cotizacionClie=files.cotizacionClienteFile)===null||_files$cotizacionClie===void 0?void 0:_files$cotizacionClie.name));const urlPOCliente=await uploadFile(files.poClienteFile,\"po_clientes/\".concat(Date.now(),\"_\").concat((_files$poClienteFile=files.poClienteFile)===null||_files$poClienteFile===void 0?void 0:_files$poClienteFile.name));const urlCotizacionProveedor=await uploadFile(files.cotizacionProveedorFile,\"cotizaciones_proveedores/\".concat(Date.now(),\"_\").concat((_files$cotizacionProv=files.cotizacionProveedorFile)===null||_files$cotizacionProv===void 0?void 0:_files$cotizacionProv.name));const urlPOProveedor=await uploadFile(files.poProveedorFile,\"po_proveedores/\".concat(Date.now(),\"_\").concat((_files$poProveedorFil=files.poProveedorFile)===null||_files$poProveedorFil===void 0?void 0:_files$poProveedorFil.name));const anioActual=new Date(formData.fechaApertura).getFullYear();const contadorRef=doc(db,\"contadores\",\"proyectos_\".concat(anioActual));const nuevoConsecutivo=await runTransaction(db,async transaction=>{const contadorDoc=await transaction.get(contadorRef);const nuevoValor=(contadorDoc.exists()?contadorDoc.data().consecutivo:0)+1;transaction.set(contadorRef,{consecutivo:nuevoValor},{merge:true});return nuevoValor;});const ultimosDosDigitosAnio=anioActual.toString().slice(-2);const consecutivoFormateado=nuevoConsecutivo.toString().padStart(3,'0');const cliente=collections.clientes.find(c=>c.id===formData.clienteId);const servicio=collections.servicios.find(s=>s.id===formData.servicioId);const proveedor=collections.proveedores.find(p=>p.id===formData.proveedorId);const npu=\"\".concat(cliente.clienteIdNumerico,\"-\").concat(servicio.servicioIdNumerico,\"-\").concat(proveedor.proveedorIdNumerico,\"-\").concat(consecutivoFormateado).concat(ultimosDosDigitosAnio);const poProveedorAuto=isInternalProvider?\"N/A\":npu.slice(-8);const estadoInicial=urlPOCliente?'Activo':'Cotización';await addDoc(collection(db,\"proyectos\"),{fechaApertura:Timestamp.fromDate(new Date(formData.fechaApertura)),npu,clienteId:formData.clienteId,clienteNombre:cliente.nombreCompleto,servicioId:formData.servicioId,servicioNombre:servicio.nombre,proveedorId:formData.proveedorId,proveedorNombre:proveedor.nombre,comentariosApertura:formData.comentariosApertura,estado:estadoInicial,estadoCliente:estadoInicial,dependencia:servicio.dependencia||'Sin Dependencia',asignadoTecnicosIds:[],tecnicosStatus:{},precioCotizacionCliente:Number(formData.precioCotizacionCliente)||0,urlCotizacionCliente:urlCotizacionCliente||'',urlPOCliente:urlPOCliente||'',costoProveedor:Number(formData.costoProveedor)||0,poProveedor:poProveedorAuto,urlCotizacionProveedor:urlCotizacionProveedor||'',urlPOProveedor:urlPOProveedor||''});setFormData({clienteId:'',servicioId:'',proveedorId:'',comentariosApertura:'',fechaApertura:new Date().toISOString().split('T')[0],precioCotizacionCliente:'',costoProveedor:''});formRef.current.reset();if(onProjectAdded)onProjectAdded();}catch(err){console.error(\"Error al crear proyecto:\",err);setError(\"Ocurri\\xF3 un error: \".concat(err.message));}setLoading(false);};return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-8\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-800 mb-4\",children:\"Crear Nuevo Proyecto\"}),/*#__PURE__*/_jsxs(\"form\",{ref:formRef,onSubmit:handleSubmit,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Fecha de Apertura\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"fechaApertura\",value:formData.fechaApertura,onChange:handleChange,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"})]}),/*#__PURE__*/_jsxs(\"select\",{name:\"clienteId\",value:formData.clienteId,onChange:handleChange,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccione un Cliente\"}),collections.clientes.map(c=>/*#__PURE__*/_jsx(\"option\",{value:c.id,children:c.nombreCompleto},c.id))]}),/*#__PURE__*/_jsxs(\"select\",{name:\"servicioId\",value:formData.servicioId,onChange:handleChange,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccione un Proyecto/Servicio\"}),collections.servicios.map(s=>/*#__PURE__*/_jsx(\"option\",{value:s.id,children:s.nombre},s.id))]}),/*#__PURE__*/_jsxs(\"select\",{name:\"proveedorId\",value:formData.proveedorId,onChange:handleChange,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccione un Proveedor\"}),collections.proveedores.map(p=>/*#__PURE__*/_jsx(\"option\",{value:p.id,children:p.nombre},p.id))]}),/*#__PURE__*/_jsx(\"textarea\",{name:\"comentariosApertura\",value:formData.comentariosApertura,onChange:handleChange,placeholder:\"Comentarios de apertura\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6 border-t pt-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-700\",children:\"Informaci\\xF3n del Cliente\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Precio Cotizaci\\xF3n (sin IVA)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"precioCotizacionCliente\",value:formData.precioCotizacionCliente,onChange:handleChange,placeholder:\"0.00\",className:\"mt-1 block w-full px-3 py-2 border rounded-md\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"PDF Cotizaci\\xF3n\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"cotizacionClienteFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"PDF Orden de Compra (PO)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"poClienteFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-700\",children:\"Informaci\\xF3n del Proveedor\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Costo (sin IVA)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"costoProveedor\",value:formData.costoProveedor,onChange:handleChange,placeholder:\"0.00\",disabled:isInternalProvider,className:\"mt-1 block w-full px-3 py-2 border rounded-md disabled:bg-gray-100\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:isInternalProvider?'Número de Proyecto':'PDF Cotización Proveedor'}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"cotizacionProveedorFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"PDF Orden de Compra (PO) Proveedor\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"poProveedorFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]})]})]}),/*#__PURE__*/_jsx(Alert,{message:error,type:\"error\",onClose:()=>setError('')}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,className:\"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg disabled:bg-gray-400\",children:loading?'Creando...':'Crear Proyecto y Generar NPU'})]})]});};// **CÓDIGO ACTUALIZADO PARA ProjectsTable (CON MODAL DE BORRADO)**\nconst ProjectsTable=_ref1=>{let{projects,onUpdateProject,userRole,user,userData}=_ref1;const[modalProject,setModalProject]=useState(null);const[modalType,setModalType]=useState('');const[searchTerm,setSearchTerm]=useState('');const[currentPage,setCurrentPage]=useState(1);const[itemsPerPage,setItemsPerPage]=useState(10);const[techniciansMap,setTechniciansMap]=useState({});const[invoicesMap,setInvoicesMap]=useState({});const[confirmingAction,setConfirmingAction]=useState(null);// Estado para confirmaciones\nuseEffect(()=>{const fetchExtraData=()=>{const qTechs=query(collection(db,\"usuarios\"),where(\"rol\",\"==\",\"tecnico\"));const unsubTechs=onSnapshot(qTechs,snapshot=>{const techMap={};snapshot.forEach(doc=>{techMap[doc.id]=doc.data().nombreCompleto;});setTechniciansMap(techMap);});const qInvoices=query(collection(db,\"facturas\"));const unsubInvoices=onSnapshot(qInvoices,snapshot=>{const invMap={};snapshot.forEach(doc=>{invMap[doc.id]=doc.data().folio;});setInvoicesMap(invMap);});return()=>{unsubTechs();unsubInvoices();};};const unsubscribe=fetchExtraData();return()=>unsubscribe();},[]);const ManageProjectModal=_ref10=>{let{project,onClose,onFinalized}=_ref10;const[files,setFiles]=useState({cotizacionClienteFile:null,poClienteFile:null,cotizacionProveedorFile:null,poProveedorFile:null});const[loading,setLoading]=useState(false);const[error,setError]=useState('');const handleFileChange=e=>{const{name,files:inputFiles}=e.target;if(inputFiles[0])setFiles(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:inputFiles[0]}));};const uploadFile=async(file,path)=>{if(!file)return null;const storageRef=ref(storage,path);const uploadTask=uploadBytesResumable(storageRef,file);await uploadTask;return await getDownloadURL(uploadTask.snapshot.ref);};const handleSave=async()=>{setLoading(true);setError('');try{var _files$cotizacionClie2,_files$poClienteFile2,_files$cotizacionProv2,_files$poProveedorFil2;const updatePayload={};const urlCotizacionCliente=await uploadFile(files.cotizacionClienteFile,\"cotizaciones_clientes/\".concat(Date.now(),\"_\").concat((_files$cotizacionClie2=files.cotizacionClienteFile)===null||_files$cotizacionClie2===void 0?void 0:_files$cotizacionClie2.name));const urlPOCliente=await uploadFile(files.poClienteFile,\"po_clientes/\".concat(Date.now(),\"_\").concat((_files$poClienteFile2=files.poClienteFile)===null||_files$poClienteFile2===void 0?void 0:_files$poClienteFile2.name));const urlCotizacionProveedor=await uploadFile(files.cotizacionProveedorFile,\"cotizaciones_proveedores/\".concat(Date.now(),\"_\").concat((_files$cotizacionProv2=files.cotizacionProveedorFile)===null||_files$cotizacionProv2===void 0?void 0:_files$cotizacionProv2.name));const urlPOProveedor=await uploadFile(files.poProveedorFile,\"po_proveedores/\".concat(Date.now(),\"_\").concat((_files$poProveedorFil2=files.poProveedorFile)===null||_files$poProveedorFil2===void 0?void 0:_files$poProveedorFil2.name));if(urlCotizacionCliente)updatePayload.urlCotizacionCliente=urlCotizacionCliente;if(urlPOCliente)updatePayload.urlPOCliente=urlPOCliente;if(urlCotizacionProveedor)updatePayload.urlCotizacionProveedor=urlCotizacionProveedor;if(urlPOProveedor)updatePayload.urlPOProveedor=urlPOProveedor;if(urlPOCliente){updatePayload.estado='Activo';updatePayload.estadoCliente='Activo';}if(Object.keys(updatePayload).length>0){await updateDoc(doc(db,\"proyectos\",project.id),updatePayload);}onFinalized();onClose();}catch(err){setError(\"Error al subir documentos.\");setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold mb-4\",children:[\"Gestionar Documentos: \",project.npu]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"PDF Cotizaci\\xF3n Cliente\"}),project.urlCotizacionCliente?/*#__PURE__*/_jsx(\"a\",{href:project.urlCotizacionCliente,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500 text-sm\",children:\"Ver actual\"}):/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"cotizacionClienteFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"PDF Orden de Compra (PO) Cliente\"}),project.urlPOCliente?/*#__PURE__*/_jsx(\"a\",{href:project.urlPOCliente,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500 text-sm\",children:\"Ver actual\"}):/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"poClienteFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"PDF Cotizaci\\xF3n Proveedor\"}),project.urlCotizacionProveedor?/*#__PURE__*/_jsx(\"a\",{href:project.urlCotizacionProveedor,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500 text-sm\",children:\"Ver actual\"}):/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"cotizacionProveedorFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"PDF Orden de Compra (PO) Proveedor\"}),project.urlPOProveedor?/*#__PURE__*/_jsx(\"a\",{href:project.urlPOProveedor,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500 text-sm\",children:\"Ver actual\"}):/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"poProveedorFile\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]})]}),/*#__PURE__*/_jsx(Alert,{message:error,type:\"error\",onClose:()=>setError('')}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,disabled:loading,className:\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\",children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,disabled:loading,className:\"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded\",children:loading?'Guardando...':'Guardar Cambios'})]})]})});};const AssignProjectModal=_ref11=>{let{project,onClose,onFinalized}=_ref11;const[technicians,setTechnicians]=useState([]);const[selectedTechnicians,setSelectedTechnicians]=useState(project.asignadoTecnicosIds||[]);const[deliveryDate,setDeliveryDate]=useState(project.fechaEntregaInterna?project.fechaEntregaInterna.toDate().toISOString().split('T')[0]:'');const[loading,setLoading]=useState(false);useEffect(()=>{const fetchTechnicians=async()=>{const q=query(collection(db,\"usuarios\"),where(\"rol\",\"==\",\"tecnico\"));const querySnapshot=await getDocs(q);setTechnicians(querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data())));};fetchTechnicians();},[]);const handleCheckboxChange=techId=>{setSelectedTechnicians(prev=>prev.includes(techId)?prev.filter(id=>id!==techId):[...prev,techId]);};const handleSave=async()=>{setLoading(true);const projectRef=doc(db,\"proyectos\",project.id);const tecnicosStatus={};selectedTechnicians.forEach(techId=>{var _project$tecnicosStat;tecnicosStatus[techId]=((_project$tecnicosStat=project.tecnicosStatus)===null||_project$tecnicosStat===void 0?void 0:_project$tecnicosStat[techId])||\"No Visto\";});await updateDoc(projectRef,{asignadoTecnicosIds:selectedTechnicians,tecnicosStatus:tecnicosStatus,fechaAsignacionTecnico:Timestamp.now(),fechaEntregaInterna:deliveryDate?Timestamp.fromDate(new Date(deliveryDate)):null});setLoading(false);onFinalized();onClose();};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-md\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold mb-4\",children:[\"Asignar Proyecto: \",project.npu]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"T\\xE9cnicos Disponibles\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 max-h-48 overflow-y-auto border rounded-md p-2\",children:technicians.map(tech=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:tech.id,checked:selectedTechnicians.includes(tech.id),onChange:()=>handleCheckboxChange(tech.id),className:\"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:tech.id,className:\"ml-3 text-sm text-gray-700\",children:tech.nombreCompleto})]},tech.id))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Fecha L\\xEDmite de Entrega (Interna)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:deliveryDate,onChange:e=>setDeliveryDate(e.target.value),className:\"mt-1 block w-full px-3 py-2 border rounded-md\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,disabled:loading,className:\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\",children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,disabled:loading,className:\"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded\",children:loading?'Asignando...':'Guardar Asignación'})]})]})});};const filteredProjects=projects.filter(p=>p.npu&&p.npu.toLowerCase().includes(searchTerm.toLowerCase())||p.clienteNombre&&p.clienteNombre.toLowerCase().includes(searchTerm.toLowerCase())||p.servicioNombre&&p.servicioNombre.toLowerCase().includes(searchTerm.toLowerCase()));const currentItems=filteredProjects.slice((currentPage-1)*itemsPerPage,currentPage*itemsPerPage);const totalPages=Math.ceil(filteredProjects.length/itemsPerPage);const paginate=pageNumber=>setCurrentPage(pageNumber);// **FUNCIÓN CORREGIDA PARA MANEJAR ZONAS HORARIAS**\nconst formatDate=timestamp=>{if(!timestamp)return'---';const date=timestamp.toDate();// Ajuste para corregir el desfase de la zona horaria\nconst userTimezoneOffset=date.getTimezoneOffset()*60000;const adjustedDate=new Date(date.getTime()+userTimezoneOffset);return adjustedDate.toLocaleDateString('es-MX',{year:'numeric',month:'2-digit',day:'2-digit'});};// **FUNCIÓN RESTAURADA**\nconst getDueDateColor=timestamp=>{if(!timestamp)return'text-gray-500';const dueDate=timestamp.toDate();const today=new Date();today.setHours(0,0,0,0);const diffTime=dueDate.getTime()-today.getTime();const diffDays=Math.ceil(diffTime/(1000*60*60*24));if(diffDays<0)return'text-red-600 font-bold';// Vencido\nif(diffDays<=3)return'text-orange-500 font-semibold';// Por vencer\nreturn'text-gray-600';// Normal\n};const handleActivateProject=async projectId=>{await updateDoc(doc(db,\"proyectos\",projectId),{estado:'Activo',estadoCliente:'Activo'});};const handleDeleteProject=async projectId=>{await deleteDoc(doc(db,\"proyectos\",projectId));setConfirmingAction(null);// Cierra el modal\n};const promptDeleteProject=(projectId,projectNpu)=>{setConfirmingAction({title:\"Confirmar Eliminación\",message:\"\\xBFEst\\xE1s seguro de que quieres borrar el proyecto \".concat(projectNpu,\"? Esta acci\\xF3n no se puede deshacer.\"),onConfirm:()=>handleDeleteProject(projectId),confirmText:\"Sí, Borrar\",confirmColor:\"bg-red-600\"});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 flex flex-col md:flex-row justify-between items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Buscar por NPU, cliente, servicio o dependencia...\",className:\"w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md mb-2 md:mb-0\",onChange:e=>{setSearchTerm(e.target.value);setCurrentPage(1);}}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm mr-2\",children:\"Mostrar:\"}),/*#__PURE__*/_jsxs(\"select\",{value:itemsPerPage,onChange:e=>{setItemsPerPage(Number(e.target.value));setCurrentPage(1);},className:\"px-2 py-1 border border-gray-300 rounded-md\",children:[/*#__PURE__*/_jsx(\"option\",{value:10,children:\"10\"}),/*#__PURE__*/_jsx(\"option\",{value:25,children:\"25\"}),/*#__PURE__*/_jsx(\"option\",{value:50,children:\"50\"}),/*#__PURE__*/_jsx(\"option\",{value:100,children:\"100\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto bg-white rounded-lg shadow\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Fecha Apertura\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"NPU\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Cliente\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Servicio\"}),userRole==='administrador'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Proveedor\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"N\\xBA Proy. Lab.\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Comentarios\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"PO Prov.\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Precio\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Costo\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Docs Cliente\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Docs Proveedor\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Fact. Cliente\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Fact. Proveedor\"})]}),userRole==='supervisor'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Fecha L\\xEDmite\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Estado T\\xE9cnicos\"})]}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Estado\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Acciones\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:currentItems.map(project=>{var _project$proveedorNom;const isAssigned=project.asignadoTecnicosIds&&project.asignadoTecnicosIds.length>0;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:formatDate(project.fechaApertura)}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm font-medium\",children:project.npu}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm\",children:project.clienteNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm\",children:project.servicioNombre}),userRole==='administrador'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm\",children:project.proveedorNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.numeroProyectoLaboratorio||'---'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 text-sm text-gray-500\",title:project.comentariosApertura,children:/*#__PURE__*/_jsx(\"p\",{className:\"w-32 truncate\",children:project.comentariosApertura||'---'})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm\",children:project.poProveedor}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm text-green-600\",children:[\"$\",(project.precioCotizacionCliente||0).toFixed(2)]}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm text-red-600\",children:[\"$\",(project.costoProveedor||0).toFixed(2)]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[project.urlCotizacionCliente&&/*#__PURE__*/_jsx(\"a\",{href:project.urlCotizacionCliente,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500\",children:\"Cot\"}),project.urlPOCliente&&/*#__PURE__*/_jsx(\"a\",{href:project.urlPOCliente,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500\",children:\"PO\"})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[project.urlCotizacionProveedor&&/*#__PURE__*/_jsx(\"a\",{href:project.urlCotizacionProveedor,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500\",children:\"Cot\"}),project.urlPOProveedor&&/*#__PURE__*/_jsx(\"a\",{href:project.urlPOProveedor,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500\",children:\"PO\"})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm\",children:invoicesMap[project.facturaClienteId]||'---'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm\",children:invoicesMap[project.facturaProveedorId]||(((_project$proveedorNom=project.proveedorNombre)===null||_project$proveedorNom===void 0?void 0:_project$proveedorNom.toLowerCase().trim())===\"ecología y asesoría ambiental\"?'N/A':'---')})]}),userRole==='supervisor'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm\",children:/*#__PURE__*/_jsx(\"span\",{className:getDueDateColor(project.fechaEntregaInterna),children:formatDate(project.fechaEntregaInterna)})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2 whitespace-nowrap text-sm\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col space-y-1\",children:(project.asignadoTecnicosIds||[]).map(techId=>{const status=project.tecnicosStatus?project.tecnicosStatus[techId]||'No Visto':'No Visto';const statusClass=status==='En Proceso'?'bg-green-100 text-green-800':'bg-gray-100 text-gray-600';return/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs p-1 rounded \".concat(statusClass),children:[techniciansMap[techId]||'Cargando...',\": \",status]},techId);})})})]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2\",children:/*#__PURE__*/_jsx(\"span\",{className:\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full \".concat(project.estado==='Activo'?'bg-orange-100 text-orange-800':'bg-gray-100 text-gray-800'),children:project.estado})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[userRole==='administrador'&&project.estado==='Cotización'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleActivateProject(project.id),className:\"text-green-600\",children:\"Activar\"}),userRole==='administrador'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setModalProject(project);setModalType('manage');},className:\"text-indigo-600\",children:\"Gestionar\"}),userRole==='administrador'&&project.estado!=='Terminado'&&project.estado!=='Archivado'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>promptDeleteProject(project.id,project.npu),className:\"text-red-600\",children:\"Borrar\"}),userRole==='supervisor'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setModalProject(project);setModalType('assign');},className:\"text-indigo-600\",children:isAssigned?'Reasignar':'Asignar'}),userRole==='supervisor'&&isAssigned&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setModalProject(project);setModalType('log');},className:\"text-gray-600\",children:\"Bit\\xE1cora\"})]})})]},project.id);})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-700\",children:[\"P\\xE1gina \",currentPage,\" de \",totalPages]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>paginate(currentPage-1),disabled:currentPage===1,className:\"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50\",children:\"Anterior\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>paginate(currentPage+1),disabled:currentPage===totalPages||totalPages===0,className:\"px-3 py-1 border rounded-md bg-white disabled:opacity-50\",children:\"Siguiente\"})]})]}),modalProject&&modalType==='assign'&&/*#__PURE__*/_jsx(AssignProjectModal,{project:modalProject,onClose:()=>setModalProject(null),onFinalized:onUpdateProject}),modalProject&&modalType==='manage'&&/*#__PURE__*/_jsx(ManageProjectModal,{project:modalProject,onClose:()=>setModalProject(null),onFinalized:onUpdateProject}),modalProject&&modalType==='log'&&/*#__PURE__*/_jsx(ProjectLogModal,{project:modalProject,user:user,userData:userData,onClose:()=>setModalProject(null)}),confirmingAction&&/*#__PURE__*/_jsx(ConfirmationModal,{title:confirmingAction.title,message:confirmingAction.message,onConfirm:confirmingAction.onConfirm,onCancel:()=>setConfirmingAction(null),confirmText:confirmingAction.confirmText,confirmColor:confirmingAction.confirmColor})]});};// **CÓDIGO ACTUALIZADO PARA ReviewProjectsTable (CON MODALES CORREGIDOS)**\nconst ReviewProjectsTable=_ref12=>{let{projects,onUpdateProject}=_ref12;const[confirmingAction,setConfirmingAction]=useState(null);// El handler de APROBACIÓN ahora lee el proyecto directamente desde el estado 'confirmingAction'\nconst handleApprove=async()=>{if(!confirmingAction||confirmingAction.action!=='approve')return;const{project}=confirmingAction.payload;// Se obtiene el proyecto del estado\nconst projectRef=doc(db,\"proyectos\",project.id);const isFinalDelivery=!!project.urlDocumento2;try{if(isFinalDelivery){if(project.faseFacturacion==='Preliminar'||project.faseFacturacion==='Fase 2 Pendiente'){await updateDoc(projectRef,{estado:'Archivado',estadoCliente:'Terminado'});}else{await updateDoc(projectRef,{estado:'Pendiente de Factura',estadoCliente:'Terminado'});}}else{await updateDoc(projectRef,{estado:'Pendiente de Factura',faseFacturacion:'Preliminar'});}}catch(error){console.error(\"Error al aprobar proyecto:\",error);alert(\"Ocurrió un error al aprobar el proyecto.\");}finally{setConfirmingAction(null);// Cierra el modal\nonUpdateProject();// Refresca la tabla\n}};// El handler de RECHAZO ahora solo necesita el 'motivo', ya que obtiene el ID del estado\nconst handleReject=async reason=>{if(!confirmingAction||confirmingAction.action!=='reject')return;if(!reason||reason.trim()===''){alert(\"El motivo del rechazo no puede estar vacío.\");return;// No cierra el modal para que el usuario pueda escribir el motivo.\n}const{projectId}=confirmingAction.payload;// Se obtiene el ID del estado\nconst projectRef=doc(db,\"proyectos\",projectId);try{await updateDoc(projectRef,{estado:'Terminado Internamente',motivoRechazo:reason});}catch(error){console.error(\"Error al rechazar proyecto:\",error);alert(\"Ocurrió un error al rechazar el proyecto.\");}finally{setConfirmingAction(null);// Cierra el modal\nonUpdateProject();// Refresca la tabla\n}};// La función que abre el modal de aprobación ahora solo guarda los datos necesarios en el estado.\nconst promptApprove=project=>{const isFinalDelivery=!!project.urlDocumento2;const hasBeenBilled=project.faseFacturacion==='Preliminar'||project.faseFacturacion==='Fase 2 Pendiente';const confirmationMessage=isFinalDelivery?hasBeenBilled?\"Aprobar y finalizar este proyecto? Se archivará y no se volverá a facturar.\":\"Aprobar esta entrega final y enviarla a facturación?\":\"Aprobar esta entrega preliminar y enviarla a facturación?\";setConfirmingAction({action:'approve',payload:{project},// Guardamos el objeto de proyecto completo\ntitle:\"Confirmar Aprobación\",message:confirmationMessage});};// La función que abre el modal de rechazo guarda solo el ID.\nconst promptReject=projectId=>{setConfirmingAction({action:'reject',payload:{projectId},// Guardamos el ID del proyecto\ntitle:\"Rechazar Proyecto\",message:\"Por favor, introduce el motivo del rechazo para notificar al practicante.\",confirmText:\"Rechazar\",confirmColor:\"bg-orange-600\"});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto bg-white rounded-lg shadow\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"NPU\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Servicio\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Documentos Finales\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Acciones\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:projects.map(project=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.npu}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.servicioNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col space-y-1\",children:[project.urlHeyzine&&/*#__PURE__*/_jsx(\"a\",{href:project.urlHeyzine,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-600\",children:\"Ver Proyecto (Heyzine)\"}),project.urlNotaPdf1&&/*#__PURE__*/_jsx(\"a\",{href:project.urlNotaPdf1,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-red-600\",children:\"Ver Nota 1\"}),project.urlNotaPdf2&&/*#__PURE__*/_jsx(\"a\",{href:project.urlNotaPdf2,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-red-600\",children:\"Ver Nota 2\"})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm font-medium\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>promptApprove(project),className:\"text-green-600 hover:text-green-900\",children:\"Aprobar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>promptReject(project.id),className:\"text-orange-600 hover:text-orange-900\",children:\"Rechazar\"})]})})]},project.id))})]})}),(confirmingAction===null||confirmingAction===void 0?void 0:confirmingAction.action)==='approve'&&/*#__PURE__*/_jsx(ConfirmationModal,{title:confirmingAction.title,message:confirmingAction.message,onConfirm:handleApprove// Llama directamente al handler de aprobación\n,onCancel:()=>setConfirmingAction(null)}),(confirmingAction===null||confirmingAction===void 0?void 0:confirmingAction.action)==='reject'&&/*#__PURE__*/_jsx(ActionWithReasonModal,{title:confirmingAction.title,message:confirmingAction.message,onConfirm:handleReject// Llama directamente al handler de rechazo, que recibirá 'reason'\n,onCancel:()=>setConfirmingAction(null),confirmText:confirmingAction.confirmText,confirmColor:confirmingAction.confirmColor})]});};const ClientProjectsList=_ref13=>{let{projects,onOpenModal}=_ref13;const[activeAccordion,setActiveAccordion]=useState(null);const groupedProjects=projects.reduce((acc,project)=>{const key=project.dependencia||'Sin Dependencia';if(!acc[key])acc[key]=[];acc[key].push(project);return acc;},{});const toggleAccordion=key=>setActiveAccordion(activeAccordion===key?null:key);const formatDate=timestamp=>!timestamp?'---':new Date(timestamp.seconds*1000).toLocaleDateString('es-MX');const getStatusClass=estado=>estado==='Activo'?'bg-orange-100 text-orange-800':'bg-green-100 text-green-800';return/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:Object.entries(groupedProjects).map(_ref14=>{let[dependencia,projs]=_ref14;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>toggleAccordion(dependencia),className:\"w-full p-4 text-left font-bold text-lg text-gray-800 flex justify-between items-center hover:bg-gray-50 transition\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[dependencia,\" \",/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-normal text-gray-500\",children:[\"(\",projs.length,\")\"]})]}),/*#__PURE__*/_jsx(\"span\",{className:\"transform transition-transform duration-300 \".concat(activeAccordion===dependencia?'rotate-180':''),children:\"\\u25BC\"})]}),activeAccordion===dependencia&&/*#__PURE__*/_jsx(\"ul\",{className:\"divide-y divide-gray-200 border-t\",children:projs.map(project=>/*#__PURE__*/_jsxs(\"li\",{className:\"p-4 md:px-6 md:py-4 flex flex-col md:flex-row md:items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 mb-4 md:mb-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-900\",children:project.servicioNombre})}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full md:w-40 mb-4 md:mb-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 hidden md:block\",children:formatDate(project.fechaApertura)})}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full md:w-40 mb-4 md:mb-0\",children:/*#__PURE__*/_jsx(\"span\",{className:\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full \".concat(getStatusClass(project.estadoCliente)),children:project.estadoCliente})}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full md:w-56 flex items-center space-x-4\",children:[project.urlHeyzine&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>onOpenModal(project.urlHeyzine),className:\"text-sm font-medium text-blue-600 hover:text-blue-900\",children:\"Ver Proyecto\"}),project.urlNotaPdf1&&/*#__PURE__*/_jsx(\"a\",{href:project.urlNotaPdf1,download:true,className:\"text-sm font-medium text-red-600 hover:text-red-900\",children:\"Nota 1\"}),project.urlNotaPdf2&&/*#__PURE__*/_jsx(\"a\",{href:project.urlNotaPdf2,download:true,className:\"text-sm font-medium text-red-600 hover:text-red-900\",children:\"Nota 2\"})]})]},project.id))})]},dependencia);})});};const ClientDashboard=_ref15=>{let{user,userData}=_ref15;const[projects,setProjects]=useState([]);const[loading,setLoading]=useState(true);const[clientView,setClientView]=useState('shelf');const[modalUrl,setModalUrl]=useState(null);useEffect(()=>{if(!user){setLoading(false);return;}const q=query(collection(db,\"proyectos\"),where(\"clienteId\",\"==\",user.uid),where(\"estadoCliente\",\"in\",[\"Activo\",\"Terminado\"]));const unsubscribe=onSnapshot(q,querySnapshot=>{const projectsData=querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));// Ordenar en el cliente\nprojectsData.sort((a,b)=>b.fechaApertura.seconds-a.fechaApertura.seconds);setProjects(projectsData);setLoading(false);},error=>{console.error(\"Error fetching client projects: \",error);if(error.code==='failed-precondition'){console.error(\"IMPORTANTE: Se requiere un índice compuesto en Firestore. Ve a la URL que aparece en el mensaje de error en la consola para crearlo con un solo clic.\");}setLoading(false);});return()=>unsubscribe();},[user]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-6\",children:[\"Proyectos de \",userData.nombreCompleto]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"nav\",{className:\"-mb-px flex space-x-8\",\"aria-label\":\"Tabs\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setClientView('shelf'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(clientView==='shelf'?'border-blue-500 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:\"Estanter\\xEDa de Proyectos\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setClientView('list'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(clientView==='list'?'border-blue-500 text-blue-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:\"Lista Detallada\"})]})}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando proyectos...\"}):projects.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-gray-500 mt-8\",children:\"No hay proyectos para mostrar.\"}):clientView==='shelf'?/*#__PURE__*/_jsx(ProjectsShelf,{projects:projects,onOpenModal:setModalUrl}):/*#__PURE__*/_jsx(ClientProjectsList,{projects:projects,onOpenModal:setModalUrl}),modalUrl&&/*#__PURE__*/_jsx(HeyzineViewerModal,{url:modalUrl,onClose:()=>setModalUrl(null)})]});};/**\r\n * Componente para renderizar la gráfica de Pipeline de Proyectos.\r\n * Recibe los datos ya procesados y listos para mostrar.\r\n */const PipelineChart=_ref16=>{let{chartData}=_ref16;const data={labels:chartData.labels,datasets:[{label:'Valor en Cotización',data:chartData.cotizacionData,backgroundColor:'rgba(255, 159, 64, 0.7)'// Naranja\n},{label:'Valor Activo',data:chartData.activoData,backgroundColor:'rgba(54, 162, 235, 0.7)'// Azul\n},{label:'Valor Pdto. Factura',data:chartData.pendienteFacturaData,backgroundColor:'rgba(255, 206, 86, 0.7)'// Amarillo\n},{type:'line',// Este dataset es una línea\nlabel:'Valor Total Ofertado',data:chartData.totalData,borderColor:'rgba(75, 192, 192, 1)',// Verde-azulado\nbackgroundColor:'rgba(75, 192, 192, 0.2)',fill:true,tension:0.2,yAxisID:'y1'}]};const options={responsive:true,maintainAspectRatio:false,plugins:{title:{display:false},tooltip:{mode:'index',intersect:false},legend:{position:'bottom'}},scales:{x:{stacked:true},y:{stacked:true,beginAtZero:true},y1:{position:'right',grid:{drawOnChartArea:false},beginAtZero:true}}};return/*#__PURE__*/_jsx(Bar,{options:options,data:data});};/**\r\n * Componente para la gráfica de Salud de Cuentas por Cobrar.\r\n */const AccountsReceivableChart=_ref17=>{let{chartData}=_ref17;const data={labels:chartData.labels,datasets:[{label:'Pagado',data:chartData.pagadoData,backgroundColor:'rgba(75, 192, 192, 0.7)'// Verde\n},{label:'Programado a Pago',data:chartData.programadoData,backgroundColor:'rgba(54, 162, 235, 0.7)'// Azul\n},{label:'Vence Hoy',data:chartData.venceHoyData,backgroundColor:'rgba(255, 159, 64, 0.7)'// Naranja\n},{label:'Vencido',data:chartData.vencidoData,backgroundColor:'rgba(255, 99, 132, 0.7)'// Rojo\n},{label:'Pdte. de Programación',data:chartData.pdteProgramacionData,backgroundColor:'rgba(201, 203, 207, 0.7)'// Gris\n},{type:'line',label:'Total Facturado',data:chartData.totalFacturadoData,borderColor:'#36A2EB',tension:0.2,yAxisID:'y1'}]};const options={responsive:true,maintainAspectRatio:false,plugins:{title:{display:false},tooltip:{mode:'index',intersect:false},legend:{position:'bottom'}},scales:{x:{stacked:true},y:{stacked:true,beginAtZero:true},y1:{position:'right',grid:{drawOnChartArea:false},beginAtZero:true}}};return/*#__PURE__*/_jsx(Bar,{options:options,data:data});};/**\r\n * Componente para la gráfica de Flujo de Caja Proyectado (Semanal).\r\n */const CashFlowChart=_ref18=>{let{chartData}=_ref18;const data={labels:chartData.labels,datasets:[{label:'Ingresos Programados',data:chartData.ingresosData,borderColor:'rgb(54, 162, 235)',backgroundColor:'rgba(54, 162, 235, 0.5)',type:'bar'// Barras para ingresos\n},{label:'Egresos Programados',data:chartData.egresosData,borderColor:'rgb(255, 99, 132)',backgroundColor:'rgba(255, 99, 132, 0.5)',type:'bar'// Barras para egresos\n}]};const options={responsive:true,maintainAspectRatio:false,plugins:{title:{display:false},legend:{position:'bottom'}},scales:{y:{beginAtZero:true}}};return/*#__PURE__*/_jsx(Bar,{options:options,data:data});};//Componente para la gráfica de Productividad por Técnico. \nconst TechnicianProductivityChart=_ref19=>{let{chartData}=_ref19;const data={labels:chartData.labels,// Nombres de los técnicos\ndatasets:[{label:'Proyectos Entregados (Mes Actual)',data:chartData.completedData,// Cantidad de proyectos\nbackgroundColor:'rgba(153, 102, 255, 0.7)',// Morado\nborderColor:'rgba(153, 102, 255, 1)',borderWidth:1}]};const options={indexAxis:'y',// Hace que la gráfica sea horizontal\nresponsive:true,maintainAspectRatio:false,plugins:{legend:{display:false// No es necesaria con una sola barra\n},title:{display:false}},scales:{x:{beginAtZero:true,ticks:{// Asegura que solo se muestren números enteros en el eje\nstepSize:1}}}};return/*#__PURE__*/_jsx(Bar,{options:options,data:data});};//Muestra un indicador clave de rendimiento (KPI) en un widget.\nconst KPIWidget=_ref20=>{let{title,value,unit='',trend=null}=_ref20;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-5 rounded-xl shadow-md\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-bold text-gray-500 truncate\",children:title}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-3xl font-bold mt-2\",children:[value,/*#__PURE__*/_jsx(\"span\",{className:\"text-xl font-semibold ml-1\",children:unit})]})]});};// --- Reemplazar el componente DirectivoDashboard existente por completo ---\nconst DirectivoDashboard=()=>{const[loading,setLoading]=useState(true);const[error,setError]=useState('');const[dashboardData,setDashboardData]=useState(null);/**\r\n     * Procesa los datos crudos de Firestore para generar las métricas del dashboard.\r\n     * @param {Array} projects - Array de todos los proyectos.\r\n     * @param {Array} invoices - Array de todas las facturas.\r\n     * @returns {Object} - Objeto con los datos procesados para las gráficas.\r\n     */// --- Reemplazar la función processDataForDashboard completa ---\nconst processDataForDashboard=(projects,invoices,technicians)=>{const currentYear=new Date().getFullYear();const currentMonth=new Date().getMonth();const labels=['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];const today=new Date();today.setHours(0,0,0,0);const oneDay=1000*60*60*24;// --- Lógica de Gráficas (sin cambios) ---\nconst monthlyProjectsData=Array(12).fill(0).map(()=>({cotizacion:0,activo:0,pendienteFactura:0,total:0}));projects.forEach(p=>{var _p$fechaApertura;if((_p$fechaApertura=p.fechaApertura)!==null&&_p$fechaApertura!==void 0&&_p$fechaApertura.toDate&&p.fechaApertura.toDate().getFullYear()===currentYear){const month=p.fechaApertura.toDate().getMonth();const projectValue=p.precioCotizacionCliente||0;monthlyProjectsData[month].total+=projectValue;switch(p.estado){case'Cotización':monthlyProjectsData[month].cotizacion+=projectValue;break;case'Activo':case'Terminado Internamente':case'En Revisión Final':monthlyProjectsData[month].activo+=projectValue;break;case'Pendiente de Factura':monthlyProjectsData[month].pendienteFactura+=projectValue;break;default:break;}}});const monthlyARData=Array(12).fill(0).map(()=>({totalFacturado:0,pdteProgramacion:0,programado:0,venceHoy:0,vencido:0,pagado:0}));invoices.forEach(inv=>{var _inv$fechaEmision;if(inv.tipo==='cliente'&&(_inv$fechaEmision=inv.fechaEmision)!==null&&_inv$fechaEmision!==void 0&&_inv$fechaEmision.toDate&&inv.fechaEmision.toDate().getFullYear()===currentYear){const month=inv.fechaEmision.toDate().getMonth();const invoiceValue=inv.monto||0;monthlyARData[month].totalFacturado+=invoiceValue;if(inv.estado==='Pagada'){monthlyARData[month].pagado+=invoiceValue;}else if(inv.estado==='Pendiente'){var _inv$fechaPromesaPago;if((_inv$fechaPromesaPago=inv.fechaPromesaPago)!==null&&_inv$fechaPromesaPago!==void 0&&_inv$fechaPromesaPago.toDate){const promiseDate=inv.fechaPromesaPago.toDate();promiseDate.setHours(0,0,0,0);if(promiseDate<today){monthlyARData[month].vencido+=invoiceValue;}else if(promiseDate.getTime()===today.getTime()){monthlyARData[month].venceHoy+=invoiceValue;}else{monthlyARData[month].programado+=invoiceValue;}}else{monthlyARData[month].pdteProgramacion+=invoiceValue;}}}});const weeklyCashFlowData=Array(8).fill(0).map(()=>({ingresos:0,egresos:0}));const weeklyLabels=[];const todayForWeeks=new Date();for(let i=0;i<8;i++){const weekStartDate=new Date(todayForWeeks.getTime()+i*7*oneDay);weeklyLabels.push(\"Sem \".concat(i+1,\" (\").concat(weekStartDate.getDate(),\"/\").concat(weekStartDate.getMonth()+1,\")\"));}invoices.forEach(inv=>{var _inv$fechaPromesaPago2;if(inv.estado==='Pendiente'&&(_inv$fechaPromesaPago2=inv.fechaPromesaPago)!==null&&_inv$fechaPromesaPago2!==void 0&&_inv$fechaPromesaPago2.toDate){const promiseDate=inv.fechaPromesaPago.toDate();const diffDays=Math.floor((promiseDate-todayForWeeks)/oneDay);const weekIndex=Math.floor(diffDays/7);if(weekIndex>=0&&weekIndex<8){if(inv.tipo==='cliente'){weeklyCashFlowData[weekIndex].ingresos+=inv.monto||0;}else if(inv.tipo==='proveedor'){weeklyCashFlowData[weekIndex].egresos+=inv.monto||0;}}}});const techProductivity={};technicians.forEach(t=>{techProductivity[t.id]={name:t.nombreCompleto.split(' ')[0],completed:0};});projects.forEach(p=>{[p.fechaFinTecnico1,p.fechaFinTecnico2].filter(Boolean).forEach(timestamp=>{const completionDate=timestamp.toDate();if(completionDate.getMonth()===currentMonth&&completionDate.getFullYear()===currentYear){(p.asignadoTecnicosIds||[]).forEach(techId=>{if(techProductivity[techId]){techProductivity[techId].completed+=1;}});}});});// --- Nueva Lógica para los KPIs Principales ---\nlet totalMargin=0,projectsWithFinancials=0;let totalDeliveryDays=0,completedProjects=0;let totalActivationDays=0,activatedProjects=0;projects.forEach(p=>{var _p$fechaAsignacionTec,_p$fechaFinTecnico,_p$fechaApertura2,_p$fechaAsignacionTec2;// Margen de beneficio\nif((p.precioCotizacionCliente||0)>0&&(p.costoProveedor||0)>=0){totalMargin+=(p.precioCotizacionCliente-p.costoProveedor)/p.precioCotizacionCliente;projectsWithFinancials++;}// Tiempo de entrega\nif((_p$fechaAsignacionTec=p.fechaAsignacionTecnico)!==null&&_p$fechaAsignacionTec!==void 0&&_p$fechaAsignacionTec.toDate&&(_p$fechaFinTecnico=p.fechaFinTecnico1)!==null&&_p$fechaFinTecnico!==void 0&&_p$fechaFinTecnico.toDate){totalDeliveryDays+=(p.fechaFinTecnico1.toDate()-p.fechaAsignacionTecnico.toDate())/oneDay;completedProjects++;}// Tiempo de activación\nif((_p$fechaApertura2=p.fechaApertura)!==null&&_p$fechaApertura2!==void 0&&_p$fechaApertura2.toDate&&(_p$fechaAsignacionTec2=p.fechaAsignacionTecnico)!==null&&_p$fechaAsignacionTec2!==void 0&&_p$fechaAsignacionTec2.toDate){totalActivationDays+=(p.fechaAsignacionTecnico.toDate()-p.fechaApertura.toDate())/oneDay;activatedProjects++;}});const kpis={avgMargin:projectsWithFinancials>0?(totalMargin/projectsWithFinancials*100).toFixed(1):0,avgDeliveryDays:completedProjects>0?(totalDeliveryDays/completedProjects).toFixed(1):0,avgActivationDays:activatedProjects>0?(totalActivationDays/activatedProjects).toFixed(1):0,invoicedThisMonth:monthlyARData[currentMonth].totalFacturado.toLocaleString('es-MX',{style:'currency',currency:'MXN'})};return{kpis,pipeline:{labels,cotizacionData:monthlyProjectsData.map(m=>m.cotizacion),activoData:monthlyProjectsData.map(m=>m.activo),pendienteFacturaData:monthlyProjectsData.map(m=>m.pendienteFactura),totalData:monthlyProjectsData.map(m=>m.total)},accountsReceivable:{labels,totalFacturadoData:monthlyARData.map(m=>m.totalFacturado),pagadoData:monthlyARData.map(m=>m.pagado),programadoData:monthlyARData.map(m=>m.programado),venceHoyData:monthlyARData.map(m=>m.venceHoy),vencidoData:monthlyARData.map(m=>m.vencido),pdteProgramacionData:monthlyARData.map(m=>m.pdteProgramacion)},cashFlow:{labels:weeklyLabels,ingresosData:weeklyCashFlowData.map(w=>w.ingresos),egresosData:weeklyCashFlowData.map(w=>w.egresos)},technicianProductivity:{labels:Object.values(techProductivity).map(t=>t.name),completedData:Object.values(techProductivity).map(t=>t.completed)}};};useEffect(()=>{const fetchData=async()=>{try{// Añadimos una tercera consulta para obtener los técnicos\nconst projectsQuery=query(collection(db,\"proyectos\"));const invoicesQuery=query(collection(db,\"facturas\"));const techniciansQuery=query(collection(db,\"usuarios\"),where(\"rol\",\"==\",\"tecnico\"));const[projectsSnapshot,invoicesSnapshot,techniciansSnapshot]=await Promise.all([getDocs(projectsQuery),getDocs(invoicesQuery),getDocs(techniciansQuery)// Ejecutamos la nueva consulta\n]);const allProjects=projectsSnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));const allInvoices=invoicesSnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));const allTechnicians=techniciansSnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));// Pasamos los técnicos a la función de procesamiento\nconst processedData=processDataForDashboard(allProjects,allInvoices,allTechnicians);setDashboardData(processedData);}catch(err){console.error(\"Error al obtener datos para el dashboard directivo:\",err);setError(\"No se pudieron cargar las métricas.\");}finally{setLoading(false);}};fetchData();},[]);if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-10\",children:\"Calculando m\\xE9tricas... \\u2699\\uFE0F\"});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-10 text-red-600\",children:error});}// --- Reemplazar solo la sección de return dentro de DirectivoDashboard ---\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-8\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900\",children:\"Dashboard Directivo\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Vista general de la salud y rendimiento del negocio.\"})]}),(dashboardData===null||dashboardData===void 0?void 0:dashboardData.kpis)&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5\",children:[/*#__PURE__*/_jsx(KPIWidget,{title:\"Margen Promedio\",value:dashboardData.kpis.avgMargin,unit:\"%\"}),/*#__PURE__*/_jsx(KPIWidget,{title:\"Tiempo Prom. Entrega\",value:dashboardData.kpis.avgDeliveryDays,unit:\"d\\xEDas\"}),/*#__PURE__*/_jsx(KPIWidget,{title:\"Tiempo Prom. Activaci\\xF3n\",value:dashboardData.kpis.avgActivationDays,unit:\"d\\xEDas\"}),/*#__PURE__*/_jsx(KPIWidget,{title:\"Facturado (Mes Actual)\",value:dashboardData.kpis.invoicedThisMonth})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-xl shadow-md\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-bold text-lg mb-4\",children:\"Pipeline de Proyectos (Mensual)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-80\",children:(dashboardData===null||dashboardData===void 0?void 0:dashboardData.pipeline)&&/*#__PURE__*/_jsx(PipelineChart,{chartData:dashboardData.pipeline})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-xl shadow-md\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-bold text-lg mb-4\",children:\"Salud de Cuentas por Cobrar (Mensual)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-80\",children:(dashboardData===null||dashboardData===void 0?void 0:dashboardData.accountsReceivable)&&/*#__PURE__*/_jsx(AccountsReceivableChart,{chartData:dashboardData.accountsReceivable})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-xl shadow-md\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-bold text-lg mb-4\",children:\"Flujo de Caja Proyectado (Pr\\xF3ximas 8 Semanas)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-80\",children:(dashboardData===null||dashboardData===void 0?void 0:dashboardData.cashFlow)&&/*#__PURE__*/_jsx(CashFlowChart,{chartData:dashboardData.cashFlow})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-xl shadow-md\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-bold text-lg mb-4\",children:\"Productividad por T\\xE9cnico (Mes Actual)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-80\",children:(dashboardData===null||dashboardData===void 0?void 0:dashboardData.technicianProductivity)&&/*#__PURE__*/_jsx(TechnicianProductivityChart,{chartData:dashboardData.technicianProductivity})})]})]})]});};// **CÓDIGO CORREGIDO PARA EcotechDashboard**\nconst EcotechDashboard=()=>{const[projects,setProjects]=useState([]);const[loading,setLoading]=useState(true);const fetchProjects=()=>{setLoading(true);// Busca proyectos activos cuyo proveedor sea \"Ecotech\"\nconst q=query(collection(db,\"proyectos\"),where(\"proveedorNombre\",\"==\",\"Ecotech Ingenieria del Medio Ambiente\"),where(\"estado\",\"!=\",\"Terminado\")// No muestra los proyectos ya terminados\n);const unsubscribe=onSnapshot(q,querySnapshot=>{const projectsData=querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setProjects(projectsData);setLoading(false);},error=>{console.error(\"Error fetching projects for Ecotech: \",error);if(error.code==='failed-precondition'){alert(\"Se requiere una configuración adicional en la base de datos. Por favor, revise la consola del navegador (F12) para encontrar un enlace y crear el índice necesario.\");}setLoading(false);});return unsubscribe;};useEffect(()=>{const unsubscribe=fetchProjects();return()=>unsubscribe();},[]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-6\",children:\"Gesti\\xF3n de Proyectos Ecotech\"}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando proyectos de Ecotech...\"}):projects.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-gray-500 mt-8\",children:\"No hay proyectos de Ecotech activos.\"}):/*#__PURE__*/_jsx(EcotechProjectsTable,{projects:projects,onUpdateProject:fetchProjects})]});};// **CÓDIGO MEJORADO PARA EcotechProjectsTable (CON FILTROS Y PAGINACIÓN)**\nconst EcotechProjectsTable=_ref21=>{let{projects,onUpdateProject}=_ref21;const[modalProject,setModalProject]=useState(null);const[searchTerm,setSearchTerm]=useState('');const[currentPage,setCurrentPage]=useState(1);const[itemsPerPage,setItemsPerPage]=useState(10);const ManageEcotechProjectModal=_ref22=>{let{project,onClose,onFinalized}=_ref22;const[labProjectNumber,setLabProjectNumber]=useState(project.numeroProyectoLaboratorio||'');const[workPoints,setWorkPoints]=useState(project.puntosDeTrabajo||'');const[notes,setNotes]=useState(project.notasEcotech||'');const[status,setStatus]=useState(project.estatusEcotech||'Pendiente');const[guiaEnvio,setGuiaEnvio]=useState(project.numeroGuiaEnvio||'');const[guiaRegreso,setGuiaRegreso]=useState(project.numeroGuiaRegreso||'');const[loading,setLoading]=useState(false);const handleSave=async()=>{setLoading(true);const projectRef=doc(db,\"proyectos\",project.id);await updateDoc(projectRef,{numeroProyectoLaboratorio:labProjectNumber,puntosDeTrabajo:Number(workPoints)||0,notasEcotech:notes,estatusEcotech:status,numeroGuiaEnvio:guiaEnvio,numeroGuiaRegreso:guiaRegreso});setLoading(false);onFinalized();onClose();};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-md\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold mb-4\",children:[\"Gestionar Info de Laboratorio: \",project.npu]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"N\\xFAmero de Proyecto (Laboratorio)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:labProjectNumber,onChange:e=>setLabProjectNumber(e.target.value),className:\"mt-1 block w-full px-3 py-2 border rounded-md\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Puntos de Trabajo Solicitados\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:workPoints,onChange:e=>setWorkPoints(e.target.value),className:\"mt-1 block w-full px-3 py-2 border rounded-md\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"N\\xBA de Gu\\xEDa (Env\\xEDo)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:guiaEnvio,onChange:e=>setGuiaEnvio(e.target.value),className:\"mt-1 block w-full px-3 py-2 border rounded-md\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"N\\xBA de Gu\\xEDa (Regreso)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:guiaRegreso,onChange:e=>setGuiaRegreso(e.target.value),className:\"mt-1 block w-full px-3 py-2 border rounded-md\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Notas\"}),/*#__PURE__*/_jsx(\"textarea\",{value:notes,onChange:e=>setNotes(e.target.value),rows:\"3\",className:\"mt-1 block w-full px-3 py-2 border rounded-md\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Estatus Interno\"}),/*#__PURE__*/_jsxs(\"select\",{value:status,onChange:e=>setStatus(e.target.value),className:\"mt-1 block w-full px-3 py-2 border rounded-md\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"Pendiente\",children:\"Pendiente\"}),/*#__PURE__*/_jsx(\"option\",{value:\"En Proceso\",children:\"En Proceso\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Muestreo Realizado\",children:\"Muestreo Realizado\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Resultados Entregados\",children:\"Resultados Entregados\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,disabled:loading,className:\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\",children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,disabled:loading,className:\"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded\",children:loading?'Guardando...':'Guardar Información'})]})]})});};const filteredProjects=projects.filter(project=>project.npu&&project.npu.toLowerCase().includes(searchTerm.toLowerCase())||project.clienteNombre&&project.clienteNombre.toLowerCase().includes(searchTerm.toLowerCase())||project.servicioNombre&&project.servicioNombre.toLowerCase().includes(searchTerm.toLowerCase()));const indexOfLastItem=currentPage*itemsPerPage;const indexOfFirstItem=indexOfLastItem-itemsPerPage;const currentItems=filteredProjects.slice(indexOfFirstItem,indexOfLastItem);const totalPages=Math.ceil(filteredProjects.length/itemsPerPage);const paginate=pageNumber=>setCurrentPage(pageNumber);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 flex flex-col md:flex-row justify-between items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Buscar por NPU, cliente o servicio...\",className:\"w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md mb-2 md:mb-0\",onChange:e=>{setSearchTerm(e.target.value);setCurrentPage(1);}}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm mr-2\",children:\"Mostrar:\"}),/*#__PURE__*/_jsxs(\"select\",{value:itemsPerPage,onChange:e=>{setItemsPerPage(Number(e.target.value));setCurrentPage(1);},className:\"px-2 py-1 border border-gray-300 rounded-md\",children:[/*#__PURE__*/_jsx(\"option\",{value:10,children:\"10\"}),/*#__PURE__*/_jsx(\"option\",{value:25,children:\"25\"}),/*#__PURE__*/_jsx(\"option\",{value:50,children:\"50\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto bg-white rounded-lg shadow\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"NPU\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Cliente\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Servicio\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"N\\xBA Proyecto Lab.\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Puntos\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Notas\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Gu\\xEDa Env\\xEDo\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Gu\\xEDa Regreso\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Estatus Interno\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Acciones\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:currentItems.map(project=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.npu}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.clienteNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.servicioNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.numeroProyectoLaboratorio||'---'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.puntosDeTrabajo||'---'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 text-sm text-gray-500\",title:project.notasEcotech,children:/*#__PURE__*/_jsx(\"p\",{className:\"w-40 truncate\",children:project.notasEcotech||'---'})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.numeroGuiaEnvio||'---'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.numeroGuiaRegreso||'---'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.estatusEcotech||'Pendiente'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm font-medium\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>setModalProject(project),className:\"text-indigo-600 hover:text-indigo-900\",children:\"Gestionar\"})})]},project.id))})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-700\",children:[\"P\\xE1gina \",currentPage,\" de \",totalPages]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>paginate(currentPage-1),disabled:currentPage===1,className:\"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50\",children:\"Anterior\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>paginate(currentPage+1),disabled:currentPage===totalPages||totalPages===0,className:\"px-3 py-1 border rounded-md bg-white disabled:opacity-50\",children:\"Siguiente\"})]})]}),modalProject&&/*#__PURE__*/_jsx(ManageEcotechProjectModal,{project:modalProject,onClose:()=>setModalProject(null),onFinalized:onUpdateProject})]});};// **CÓDIGO ACTUALIZADO PARA SupervisorDashboard (FASE 3.3)**\nconst SupervisorDashboard=_ref23=>{let{user,userData}=_ref23;const[view,setView]=useState('new');// 'new' o 'assigned'\nconst[allActiveProjects,setAllActiveProjects]=useState([]);const[loading,setLoading]=useState(true);// Estados para el ordenamiento\nconst[sortBy,setSortBy]=useState('fechaApertura');const[sortOrder,setSortOrder]=useState('desc');useEffect(()=>{setLoading(true);// Esta consulta ahora carga TODOS los proyectos activos. El filtrado se hará en el cliente.\nconst q=query(collection(db,\"proyectos\"),where(\"estado\",\"==\",\"Activo\"));const unsubscribe=onSnapshot(q,querySnapshot=>{const projectsData=querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setAllActiveProjects(projectsData);setLoading(false);},error=>{console.error(\"Error fetching active projects for supervisor:\",error);setLoading(false);});return()=>unsubscribe();},[]);// Usamos useMemo para filtrar y ordenar los proyectos de forma eficiente\nconst displayedProjects=React.useMemo(()=>{const filtered=allActiveProjects.filter(p=>{const hasAssignedTechnicians=p.asignadoTecnicosIds&&p.asignadoTecnicosIds.length>0;if(view==='new')return!hasAssignedTechnicians;if(view==='assigned')return hasAssignedTechnicians;return false;});return filtered.sort((a,b)=>{const fieldA=a[sortBy];const fieldB=b[sortBy];if(!fieldA)return 1;// Mover proyectos sin fecha al final\nif(!fieldB)return-1;let comparison=0;if(fieldA.seconds>fieldB.seconds){comparison=1;}else if(fieldA.seconds<fieldB.seconds){comparison=-1;}return sortOrder==='asc'?comparison:-comparison;});},[allActiveProjects,view,sortBy,sortOrder]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-6\",children:\"Panel de Supervisi\\xF3n\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"nav\",{className:\"-mb-px flex space-x-8\",\"aria-label\":\"Tabs\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('new'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='new'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:\"Nuevos por Asignar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('assigned'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='assigned'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:\"Asignados y en Proceso\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end items-center mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"sort-by\",className:\"text-sm font-medium text-gray-700 mr-2\",children:\"Ordenar por:\"}),/*#__PURE__*/_jsxs(\"select\",{id:\"sort-by\",value:sortBy,onChange:e=>setSortBy(e.target.value),className:\"border rounded-md p-1 text-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"fechaApertura\",children:\"Fecha de Apertura\"}),/*#__PURE__*/_jsx(\"option\",{value:\"fechaEntregaInterna\",children:\"Fecha L\\xEDmite\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setSortOrder(sortOrder==='asc'?'desc':'asc'),className:\"ml-2 p-1 border rounded-md text-sm\",children:sortOrder==='asc'?'↑ Asc':'↓ Desc'})]}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando proyectos...\"}):/*#__PURE__*/_jsx(ProjectsTable,{projects:displayedProjects,onUpdateProject:()=>{},userRole:\"supervisor\",user:user,userData:userData})]});};// **CÓDIGO COMPLETO Y CORREGIDO PARA TecnicoDashboard**\nconst TecnicoDashboard=_ref24=>{let{user,userData}=_ref24;const[view,setView]=useState('new');// 'new' o 'inProgress'\nconst[projects,setProjects]=useState([]);const[loading,setLoading]=useState(true);useEffect(()=>{if(!user)return;setLoading(true);const statusToQuery=view==='new'?\"No Visto\":\"En Proceso\";const q=query(collection(db,\"proyectos\"),where(\"estado\",\"==\",\"Activo\"),where(\"tecnicosStatus.\".concat(user.uid),\"==\",statusToQuery));const unsubscribe=onSnapshot(q,querySnapshot=>{const projectsData=querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setProjects(projectsData);setLoading(false);},error=>{console.error(\"Error fetching projects for tecnico in view \".concat(view,\":\"),error);if(error.code==='failed-precondition'){alert(\"Se requiere una configuración adicional en la base de datos. Por favor, revise la consola del navegador (F12) para encontrar un enlace y crear el índice necesario.\");}setLoading(false);});return()=>unsubscribe();},[view,user]);const handleStartProject=async project=>{const projectRef=doc(db,\"proyectos\",project.id);await updateDoc(projectRef,{[\"tecnicosStatus.\".concat(user.uid)]:\"En Proceso\"});};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-6\",children:\"Mis Tareas\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"nav\",{className:\"-mb-px flex space-x-8\",\"aria-label\":\"Tabs\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('new'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='new'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:\"Nuevas Tareas\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('inProgress'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='inProgress'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:\"Tareas en Proceso\"})]})}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando tareas...\"}):/*#__PURE__*/_jsx(TecnicoProjectsTable,{projects:projects,onUpdateProject:()=>{},user:user,userData:userData,handleStartProject:handleStartProject})]});};// **CÓDIGO ACTUALIZADO PARA TecnicoProjectsTable (CON FECHA DE FINALIZACIÓN)**\nconst TecnicoProjectsTable=_ref25=>{let{projects,onUpdateProject,user,userData,handleStartProject}=_ref25;const[modalProject,setModalProject]=useState(null);const[modalType,setModalType]=useState('');// 'task' o 'log'\nconst ManageTaskModal=_ref26=>{let{project,onClose,onFinalized}=_ref26;const[comments,setComments]=useState('');const[evidenceFile,setEvidenceFile]=useState(null);const[loading,setLoading]=useState(false);const[error,setError]=useState('');const handleFileChange=e=>{if(e.target.files[0]){setEvidenceFile(e.target.files[0]);}};const generateAndSaveNota=async()=>{if(typeof window.jspdf==='undefined'){throw new Error(\"La librería para generar PDFs (jsPDF) no se ha cargado.\");}const{jsPDF}=window.jspdf;const pdfDoc=new jsPDF();const anioActual=new Date().getFullYear();const contadorRef=doc(db,\"contadores\",\"notas_entrega_\".concat(anioActual));const nuevoConsecutivo=await runTransaction(db,async transaction=>{const contadorDoc=await transaction.get(contadorRef);const nuevoValor=(contadorDoc.exists()?contadorDoc.data().consecutivo:0)+1;transaction.set(contadorRef,{consecutivo:nuevoValor},{merge:true});return nuevoValor;});const numeroNota=\"\".concat(anioActual,\"-\").concat(nuevoConsecutivo.toString().padStart(4,'0'));pdfDoc.setFont(\"helvetica\",\"bold\");pdfDoc.setFontSize(10);pdfDoc.text(\"ECOLOGÍA Y ASESORÍA AMBIENTAL S. DE R.L. DE C.V.\",105,20,{align:'center'});pdfDoc.setFont(\"helvetica\",\"normal\");pdfDoc.setFontSize(8);pdfDoc.text(\"HERMANOS ESCOBAR 6150-2 PARQUE INDUSTRIAL OMEGA\",105,25,{align:'center'});pdfDoc.text(\"CP.32410CD. JUÁREZ, CHIHUAHUA. RFC EAA12060765A\",105,29,{align:'center'});pdfDoc.setFontSize(16);pdfDoc.setFont(\"helvetica\",\"bold\");pdfDoc.text(\"NOTA DE ENTREGA\",105,45,{align:'center'});pdfDoc.text(numeroNota,180,55);pdfDoc.setFontSize(11);pdfDoc.setFont(\"helvetica\",\"normal\");pdfDoc.text(\"FECHA: \".concat(new Date().toLocaleDateString('es-MX')),20,65);pdfDoc.text(\"PROYECTO: \".concat(project.npu),20,75);pdfDoc.text(\"NOMBRE/RAZ\\xD3N SOCIAL: \".concat(project.clienteNombre),20,85);pdfDoc.rect(15,95,180,20);pdfDoc.text(\"DESCRIPCIÓN\",20,101);pdfDoc.text(\"CANTIDAD\",170,101);pdfDoc.text(project.servicioNombre,20,108);pdfDoc.text(\"1\",175,108);pdfDoc.text(\"Comentarios:\",20,125);const splitComments=pdfDoc.splitTextToSize(comments,170);pdfDoc.text(splitComments,20,132);pdfDoc.text(\"RECIBIDO POR:\",20,250);pdfDoc.line(20,260,100,260);pdfDoc.text(\"NOMBRE Y FIRMA\",45,265);pdfDoc.save(\"Nota_Entrega_\".concat(numeroNota,\".pdf\"));return{numeroNota};};// **NUEVO CÓDIGO PARA LA FUNCIÓN handleCompleteTask**\nconst handleCompleteTask=async()=>{if(!evidenceFile){setError(\"Es obligatorio subir el archivo PDF de evidencia.\");return;}setLoading(true);setError('');try{const evidenceRef=ref(storage,\"evidencia_tecnicos/\".concat(project.id,\"/\").concat(evidenceFile.name));const evidenceUploadTask=uploadBytesResumable(evidenceRef,evidenceFile);const evidenceUrl=await getDownloadURL((await evidenceUploadTask).ref);const{numeroNota}=await generateAndSaveNota();const projectRef=doc(db,\"proyectos\",project.id);const updatePayload={estado:'Terminado Internamente',comentariosTecnico:comments};// Lógica para guardar la fecha de la primera o segunda entrega\nif(!project.urlDocumento1){// Si el documento 1 no existe, esta es la primera entrega\nupdatePayload.urlEvidenciaTecnico1=evidenceUrl;updatePayload.numeroNotaInterna1=numeroNota;updatePayload.fechaFinTecnico1=Timestamp.now();}else{// Si el documento 1 ya existe, esta es la segunda entrega\nupdatePayload.urlEvidenciaTecnico2=evidenceUrl;updatePayload.numeroNotaInterna2=numeroNota;updatePayload.fechaFinTecnico2=Timestamp.now();}await updateDoc(projectRef,updatePayload);onFinalized();onClose();}catch(err){console.error(\"Error al completar la tarea:\",err);setError(err.message||\"Ocurrió un error al guardar los datos.\");setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold mb-4\",children:[\"Gestionar Tarea: \",project.npu]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Comentarios Finales (para Nota de Entrega)\"}),/*#__PURE__*/_jsx(\"textarea\",{value:comments,onChange:e=>setComments(e.target.value),rows:\"4\",className:\"mt-1 block w-full px-3 py-2 border rounded-md\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Subir Evidencia T\\xE9cnica (PDF)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".pdf\",onChange:handleFileChange,className:\"mt-1 block w-full text-sm\"})]})]}),/*#__PURE__*/_jsx(Alert,{message:error,type:\"error\",onClose:()=>setError('')}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,disabled:loading,className:\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\",children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleCompleteTask,disabled:loading,className:\"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded\",children:loading?'Enviando...':'Generar Nota y Finalizar Tarea'})]})]})});};const formatDate=timestamp=>!timestamp?'---':new Date(timestamp.seconds*1000).toLocaleDateString('es-MX');return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto bg-white rounded-lg shadow\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Cliente\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Servicio\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Fecha L\\xEDmite\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Acciones\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:projects.map(project=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.clienteNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.servicioNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:formatDate(project.fechaEntregaInterna)}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[project.tecnicosStatus[user.uid]==='No Visto'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleStartProject(project),className:\"text-green-600 hover:text-green-900\",children:\"Empezar\"}),project.tecnicosStatus[user.uid]==='En Proceso'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setModalProject(project);setModalType('task');},className:\"text-indigo-600\",children:\"Gestionar Tarea\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setModalProject(project);setModalType('log');},className:\"text-gray-600\",children:\"Bit\\xE1cora\"})]})]})})]},project.id))})]})}),modalProject&&modalType==='task'&&/*#__PURE__*/_jsx(ManageTaskModal,{project:modalProject,onClose:()=>setModalProject(null),onFinalized:onUpdateProject}),modalProject&&modalType==='log'&&/*#__PURE__*/_jsx(ProjectLogModal,{project:modalProject,user:user,userData:userData,onClose:()=>setModalProject(null)})]});};// **CÓDIGO COMPLETO Y CORREGIDO PARA FinanzasDashboard (CON REACTIVACIÓN AUTOMÁTICA)**\nconst FinanzasDashboard=_ref27=>{let{user,userData}=_ref27;const[view,setView]=useState('pendientes');const[projects,setProjects]=useState([]);const[loading,setLoading]=useState(true);const fetchPendingProjects=()=>{setLoading(true);const q=query(collection(db,\"proyectos\"),where(\"estado\",\"in\",[\"Pendiente de Factura\",\"Facturado\"]));const unsubscribe=onSnapshot(q,querySnapshot=>{const projectsData=querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));// **NUEVA LÓGICA DE REACTIVACIÓN AUTOMÁTICA**\nprojectsData.forEach(project=>{if(project.estado==='Facturado'&&project.faseFacturacion==='Preliminar'){console.log(\"[AUTO-REACTIVACI\\xD3N] Proyecto \".concat(project.npu,\" detectado para Fase 2.\"));const projectRef=doc(db,\"proyectos\",project.id);const newTecnicosStatus={};if(project.asignadoTecnicosIds){project.asignadoTecnicosIds.forEach(techId=>{newTecnicosStatus[techId]='En Proceso';});}updateDoc(projectRef,{estado:'Activo',tecnicosStatus:newTecnicosStatus,faseFacturacion:'Fase 2 Pendiente'});}});// Filtra los proyectos ya reactivados para no mostrarlos en \"Pendientes\"\nsetProjects(projectsData.filter(p=>p.estado==='Pendiente de Factura'));setLoading(false);});return unsubscribe;};useEffect(()=>{let unsubscribe=()=>{};if(view==='pendientes'){unsubscribe=fetchPendingProjects();}else{setLoading(false);}return()=>unsubscribe();},[view]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-6\",children:\"Panel de Finanzas\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"nav\",{className:\"-mb-px flex space-x-8\",\"aria-label\":\"Tabs\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('pendientes'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='pendientes'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:\"Pendientes de Gesti\\xF3n\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('cobrar'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='cobrar'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:\"Cuentas por Cobrar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('pagar'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='pagar'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:\"Cuentas por Pagar\"})]})}),view==='pendientes'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-800 my-6\",children:\"Proyectos Pendientes de Facturar\"}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando proyectos...\"}):/*#__PURE__*/_jsx(PendingInvoicesTable,{projects:projects,onUpdate:fetchPendingProjects})]}),view==='cobrar'&&/*#__PURE__*/_jsx(InvoicesList,{invoiceType:\"cliente\",onUpdate:()=>{}}),view==='pagar'&&/*#__PURE__*/_jsx(InvoicesList,{invoiceType:\"proveedor\",onUpdate:()=>{}})]});};// **CÓDIGO COMPLETO Y CORREGIDO PARA PendingInvoicesTable**\nconst PendingInvoicesTable=_ref28=>{let{projects,onUpdate}=_ref28;const[modalProject,setModalProject]=useState(null);const[searchTerm,setSearchTerm]=useState('');const[currentPage,setCurrentPage]=useState(1);const[itemsPerPage,setItemsPerPage]=useState(10);const AttachInvoicesModal=_ref29=>{var _project$proveedorNom2;let{project,onClose,onFinalized}=_ref29;const[mode,setMode]=useState('upload');const[clientInvoice,setClientInvoice]=useState({folio:'',monto:project.precioCotizacionCliente||'',fechaEmision:new Date().toISOString().split('T')[0]});const[clientFiles,setClientFiles]=useState({xmlFile:null,pdfFile:null});const[providerInvoice,setProviderInvoice]=useState({folio:'',monto:project.costoProveedor||'',fechaEmision:new Date().toISOString().split('T')[0]});const[providerFiles,setProviderFiles]=useState({xmlFile:null,pdfFile:null});const[linkableInvoices,setLinkableInvoices]=useState([]);const[selectedClientInvoiceId,setSelectedClientInvoiceId]=useState('');const[selectedProviderInvoiceId,setSelectedProviderInvoiceId]=useState('');const[loading,setLoading]=useState(false);const[error,setError]=useState('');const isInternalProvider=(_project$proveedorNom2=project.proveedorNombre)===null||_project$proveedorNom2===void 0?void 0:_project$proveedorNom2.toLowerCase().includes(\"ecologia\");useEffect(()=>{if(mode==='link'){const q=query(collection(db,\"facturas\"),orderBy(\"fechaEmision\",\"desc\"));const unsubscribe=onSnapshot(q,snapshot=>{setLinkableInvoices(snapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data())));});return()=>unsubscribe();}},[mode]);// **FUNCIONES RESTAURADAS**\nconst handleChange=setter=>e=>{const{name,value}=e.target;setter(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));};const handleFileChange=setter=>e=>{const{name,files:inputFiles}=e.target;if(inputFiles[0])setter(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:inputFiles[0]}));};const uploadFile=async(file,path)=>{if(!file)return null;const storageRef=ref(storage,path);const uploadTask=uploadBytesResumable(storageRef,file);return getDownloadURL((await uploadTask).ref);};const handleSave=async()=>{setLoading(true);setError('');try{const projectRef=doc(db,\"proyectos\",project.id);const updatePayload={};let finalFacturaClienteIds=project.facturasClienteIds||[];let finalFacturaProveedorIds=project.facturasProveedorIds||[];if(mode==='upload'){if(clientFiles.xmlFile&&clientFiles.pdfFile&&clientInvoice.folio){const urlXml=await uploadFile(clientFiles.xmlFile,\"facturas_clientes/\".concat(project.id,\"/\").concat(clientFiles.xmlFile.name));const urlPdf=await uploadFile(clientFiles.pdfFile,\"facturas_clientes/\".concat(project.id,\"/\").concat(clientFiles.pdfFile.name));const newInvoiceRef=await addDoc(collection(db,\"facturas\"),{tipo:\"cliente\",proyectoId:project.id,folio:clientInvoice.folio,monto:Number(clientInvoice.monto),fechaEmision:Timestamp.fromDate(new Date(clientInvoice.fechaEmision)),estado:\"Pendiente\",urlXml,urlPdf,clienteNombre:project.clienteNombre});finalFacturaClienteIds.push(newInvoiceRef.id);updatePayload.facturasClienteIds=finalFacturaClienteIds;}if(!isInternalProvider&&providerFiles.xmlFile&&providerFiles.pdfFile&&providerInvoice.folio){const urlXml=await uploadFile(providerFiles.xmlFile,\"facturas_proveedores/\".concat(project.id,\"/\").concat(providerFiles.xmlFile.name));const urlPdf=await uploadFile(providerFiles.pdfFile,\"facturas_proveedores/\".concat(project.id,\"/\").concat(providerFiles.pdfFile.name));const newInvoiceRef=await addDoc(collection(db,\"facturas\"),{tipo:\"proveedor\",proyectoId:project.id,folio:providerInvoice.folio,monto:Number(providerInvoice.monto),fechaEmision:Timestamp.fromDate(new Date(providerInvoice.fechaEmision)),estado:\"Pendiente\",urlXml,urlPdf,proveedorNombre:project.proveedorNombre});finalFacturaProveedorIds.push(newInvoiceRef.id);updatePayload.facturasProveedorIds=finalFacturaProveedorIds;}}else{// mode === 'link'\nif(selectedClientInvoiceId){await updateDoc(doc(db,\"facturas\",selectedClientInvoiceId),{proyectosIds:arrayUnion(project.id)});finalFacturaClienteIds.push(selectedClientInvoiceId);updatePayload.facturasClienteIds=arrayUnion(selectedClientInvoiceId);}if(selectedProviderInvoiceId&&!isInternalProvider){await updateDoc(doc(db,\"facturas\",selectedProviderInvoiceId),{proyectosIds:arrayUnion(project.id)});finalFacturaProveedorIds.push(selectedProviderInvoiceId);updatePayload.facturasProveedorIds=arrayUnion(selectedProviderInvoiceId);}}const isClientInvoiceReady=finalFacturaClienteIds.length>0;const isProviderInvoiceReady=isInternalProvider||finalFacturaProveedorIds.length>0;if(isClientInvoiceReady&&isProviderInvoiceReady){updatePayload.estado='Facturado';}if(Object.keys(updatePayload).length>0){await updateDoc(projectRef,updatePayload);}onFinalized();onClose();}catch(err){console.error(\"Error al guardar la factura:\",err);setError(\"Ocurrió un error al guardar la factura.\");setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold mb-4\",children:[\"Gestionar Facturas: \",project.npu]}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-4 border-b\",children:/*#__PURE__*/_jsxs(\"nav\",{className:\"-mb-px flex space-x-8\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setMode('upload'),className:\"py-2 px-1 border-b-2 font-medium text-sm \".concat(mode==='upload'?'border-blue-500':'border-transparent'),children:\"Subir Nueva Factura\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setMode('link'),className:\"py-2 px-1 border-b-2 font-medium text-sm \".concat(mode==='link'?'border-blue-500':'border-transparent'),children:\"Enlazar Factura Existente\"})]})}),mode==='upload'&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 \".concat(!isInternalProvider?'md:grid-cols-2':'',\" gap-6\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4 p-4 border rounded-lg\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-800\",children:\"Factura a Cliente\"}),project.facturaClienteId?/*#__PURE__*/_jsx(\"p\",{className:\"text-green-600\",children:\"\\u2713 Factura ya adjuntada.\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"folio\",placeholder:\"Folio Factura\",value:clientInvoice.folio,onChange:handleChange(setClientInvoice),className:\"block w-full border rounded-md p-2\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"monto\",placeholder:\"Monto\",value:clientInvoice.monto,onChange:handleChange(setClientInvoice),className:\"block w-full border rounded-md p-2\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"fechaEmision\",value:clientInvoice.fechaEmision,onChange:handleChange(setClientInvoice),className:\"block w-full border rounded-md p-2\"}),/*#__PURE__*/_jsx(\"label\",{className:\"text-xs\",children:\"XML:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"xmlFile\",accept:\".xml\",onChange:handleFileChange(setClientFiles),className:\"block w-full text-sm\"}),/*#__PURE__*/_jsx(\"label\",{className:\"text-xs\",children:\"PDF:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"pdfFile\",accept:\".pdf\",onChange:handleFileChange(setClientFiles),className:\"block w-full text-sm\"})]})]}),!isInternalProvider&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4 p-4 border rounded-lg\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-800\",children:\"Factura de Proveedor\"}),project.facturaProveedorId?/*#__PURE__*/_jsx(\"p\",{className:\"text-green-600\",children:\"\\u2713 Factura ya adjuntada.\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"folio\",placeholder:\"Folio Factura\",value:providerInvoice.folio,onChange:handleChange(setProviderInvoice),className:\"block w-full border rounded-md p-2\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"monto\",placeholder:\"Monto\",value:providerInvoice.monto,onChange:handleChange(setProviderInvoice),className:\"block w-full border rounded-md p-2\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"fechaEmision\",value:providerInvoice.fechaEmision,onChange:handleChange(setProviderInvoice),className:\"block w-full border rounded-md p-2\"}),/*#__PURE__*/_jsx(\"label\",{className:\"text-xs\",children:\"XML:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"xmlFile\",accept:\".xml\",onChange:handleFileChange(setProviderFiles),className:\"block w-full text-sm\"}),/*#__PURE__*/_jsx(\"label\",{className:\"text-xs\",children:\"PDF:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"pdfFile\",accept:\".pdf\",onChange:handleFileChange(setProviderFiles),className:\"block w-full text-sm\"})]})]})]}),mode==='link'&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 \".concat(!isInternalProvider?'md:grid-cols-2':'',\" gap-6\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4 p-4 border rounded-lg\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-800\",children:\"Enlazar Factura de Cliente\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedClientInvoiceId,onChange:e=>setSelectedClientInvoiceId(e.target.value),className:\"block w-full border rounded-md p-2\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccione una factura...\"}),linkableInvoices.filter(inv=>inv.tipo==='cliente').map(inv=>/*#__PURE__*/_jsx(\"option\",{value:inv.id,children:\"Folio: \".concat(inv.folio,\" - \").concat(inv.clienteNombre,\" - $\").concat(inv.monto.toFixed(2))},inv.id))]})]}),!isInternalProvider&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4 p-4 border rounded-lg\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-800\",children:\"Enlazar Factura de Proveedor\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedProviderInvoiceId,onChange:e=>setSelectedProviderInvoiceId(e.target.value),className:\"block w-full border rounded-md p-2\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccione una factura...\"}),linkableInvoices.filter(inv=>inv.tipo==='proveedor').map(inv=>/*#__PURE__*/_jsx(\"option\",{value:inv.id,children:\"Folio: \".concat(inv.folio,\" - \").concat(inv.proveedorNombre,\" - $\").concat(inv.monto.toFixed(2))},inv.id))]})]})]}),/*#__PURE__*/_jsx(Alert,{message:error,type:\"error\",onClose:()=>setError('')}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded\",children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,className:\"bg-[#b0ef26] text-black font-bold py-2 px-4 rounded\",children:loading?'Guardando...':'Guardar Cambios'})]})]})});};const filteredProjects=projects.filter(p=>p.npu&&p.npu.toLowerCase().includes(searchTerm.toLowerCase())||p.clienteNombre&&p.clienteNombre.toLowerCase().includes(searchTerm.toLowerCase())||p.servicioNombre&&p.servicioNombre.toLowerCase().includes(searchTerm.toLowerCase()));const currentItems=filteredProjects.slice((currentPage-1)*itemsPerPage,currentPage*itemsPerPage);const totalPages=Math.ceil(filteredProjects.length/itemsPerPage);const paginate=pageNumber=>setCurrentPage(pageNumber);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 flex flex-col md:flex-row justify-between items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Buscar por NPU, cliente o servicio...\",className:\"w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md mb-2 md:mb-0\",onChange:e=>{setSearchTerm(e.target.value);setCurrentPage(1);}}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm mr-2\",children:\"Mostrar:\"}),/*#__PURE__*/_jsxs(\"select\",{value:itemsPerPage,onChange:e=>{setItemsPerPage(Number(e.target.value));setCurrentPage(1);},className:\"px-2 py-1 border border-gray-300 rounded-md\",children:[/*#__PURE__*/_jsx(\"option\",{value:10,children:\"10\"}),/*#__PURE__*/_jsx(\"option\",{value:25,children:\"25\"}),/*#__PURE__*/_jsx(\"option\",{value:50,children:\"50\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto bg-white rounded-lg shadow\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"NPU\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Cliente\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Servicio\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Docs Admin\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Factura Cliente\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Factura Proveedor\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Acciones\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:currentItems.map(project=>{var _project$proveedorNom3;return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:project.npu}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:project.clienteNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:project.servicioNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2 text-sm\",children:[project.urlCotizacionCliente&&/*#__PURE__*/_jsx(\"a\",{href:project.urlCotizacionCliente,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500\",children:\"Cot.C\"}),project.urlPOCliente&&/*#__PURE__*/_jsx(\"a\",{href:project.urlPOCliente,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-500\",children:\"PO.C\"})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:project.facturaClienteId?/*#__PURE__*/_jsx(\"span\",{className:\"text-green-600\",children:\"\\u2713 Adjuntada\"}):/*#__PURE__*/_jsx(\"span\",{className:\"text-orange-500\",children:\"Pendiente\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:(_project$proveedorNom3=project.proveedorNombre)!==null&&_project$proveedorNom3!==void 0&&_project$proveedorNom3.toLowerCase().includes(\"ecologia\")?/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"N/A\"}):project.facturaProveedorId?/*#__PURE__*/_jsx(\"span\",{className:\"text-green-600\",children:\"\\u2713 Adjuntada\"}):/*#__PURE__*/_jsx(\"span\",{className:\"text-orange-500\",children:\"Pendiente\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>setModalProject(project),className:\"text-indigo-600 hover:text-indigo-900\",children:\"Gestionar Facturas\"})})]},project.id);})})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-700\",children:[\"P\\xE1gina \",currentPage,\" de \",totalPages]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>paginate(currentPage-1),disabled:currentPage===1,className:\"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50\",children:\"Anterior\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>paginate(currentPage+1),disabled:currentPage===totalPages||totalPages===0,className:\"px-3 py-1 border rounded-md bg-white disabled:opacity-50\",children:\"Siguiente\"})]})]}),modalProject&&/*#__PURE__*/_jsx(AttachInvoicesModal,{project:modalProject,onClose:()=>setModalProject(null),onFinalized:onUpdate})]});};// **CÓDIGO MEJORADO Y COMPLETO PARA InvoicesList**\nconst InvoicesList=_ref30=>{let{invoiceType,onUpdate}=_ref30;const[invoices,setInvoices]=useState([]);const[loading,setLoading]=useState(true);const[showAddModal,setShowAddModal]=useState(false);const[modalInvoice,setModalInvoice]=useState(null);const[searchTerm,setSearchTerm]=useState('');const[currentPage,setCurrentPage]=useState(1);const[itemsPerPage,setItemsPerPage]=useState(10);useEffect(()=>{setLoading(true);const q=query(collection(db,\"facturas\"),where(\"tipo\",\"==\",invoiceType),orderBy(\"fechaEmision\",\"desc\"));const unsubscribe=onSnapshot(q,querySnapshot=>{setInvoices(querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data())));setLoading(false);});return()=>unsubscribe();},[invoiceType]);const filteredInvoices=invoices.filter(invoice=>invoice.folio&&invoice.folio.toLowerCase().includes(searchTerm.toLowerCase())||invoice.clienteNombre&&invoice.clienteNombre.toLowerCase().includes(searchTerm.toLowerCase())||invoice.proveedorNombre&&invoice.proveedorNombre.toLowerCase().includes(searchTerm.toLowerCase())||invoice.descripcion&&invoice.descripcion.toLowerCase().includes(searchTerm.toLowerCase()));const indexOfLastItem=currentPage*itemsPerPage;const indexOfFirstItem=indexOfLastItem-itemsPerPage;const currentItems=filteredInvoices.slice(indexOfFirstItem,indexOfLastItem);const totalPages=Math.ceil(filteredInvoices.length/itemsPerPage);const paginate=pageNumber=>setCurrentPage(pageNumber);const AddGeneralInvoiceModal=_ref31=>{let{onClose,onFinalized}=_ref31;const[formData,setFormData]=useState({folio:'',monto:'',fechaEmision:new Date().toISOString().split('T')[0],entidadId:'',descripcion:''});const[files,setFiles]=useState({xmlFile:null,pdfFile:null});const[entities,setEntities]=useState([]);const[otherEntityName,setOtherEntityName]=useState('');const[loading,setLoading]=useState(false);const[error,setError]=useState('');useEffect(()=>{let q;if(invoiceType==='cliente'){q=query(collection(db,\"usuarios\"),where(\"rol\",\"==\",\"cliente\"));}else{q=query(collection(db,\"proveedores\"));}getDocs(q).then(snapshot=>{const entityList=snapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));const sortedEntities=entityList.sort((a,b)=>(a.nombreCompleto||a.nombre).localeCompare(b.nombreCompleto||b.nombre));setEntities(sortedEntities);});},[]);const handleChange=e=>{const{name,value}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));};const handleFileChange=e=>{const{name,files:inputFiles}=e.target;if(inputFiles[0]){setFiles(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:inputFiles[0]}));}};const uploadFile=async(file,path)=>{if(!file)return null;const storageRef=ref(storage,path);const uploadTask=uploadBytesResumable(storageRef,file);return getDownloadURL((await uploadTask).ref);};const handleSave=async()=>{if(!formData.folio||!formData.monto||!files.xmlFile||!files.pdfFile||formData.entidadId===''||formData.entidadId==='otro'&&!otherEntityName){setError(\"Todos los campos y archivos son obligatorios.\");return;}setLoading(true);try{var _entities$find,_entities$find2;const urlXml=await uploadFile(files.xmlFile,\"facturas_\".concat(invoiceType,\"/\").concat(Date.now(),\"/\").concat(files.xmlFile.name));const urlPdf=await uploadFile(files.pdfFile,\"facturas_\".concat(invoiceType,\"/\").concat(Date.now(),\"/\").concat(files.pdfFile.name));const entityName=formData.entidadId==='otro'?otherEntityName:((_entities$find=entities.find(e=>e.id===formData.entidadId))===null||_entities$find===void 0?void 0:_entities$find.nombreCompleto)||((_entities$find2=entities.find(e=>e.id===formData.entidadId))===null||_entities$find2===void 0?void 0:_entities$find2.nombre);await addDoc(collection(db,\"facturas\"),{tipo:invoiceType,proyectoId:\"general\",folio:formData.folio,monto:Number(formData.monto),fechaEmision:Timestamp.fromDate(new Date(formData.fechaEmision)),estado:\"Pendiente\",descripcion:formData.descripcion||'',urlXml,urlPdf,[invoiceType==='cliente'?'clienteNombre':'proveedorNombre']:entityName});onFinalized();onClose();}catch(err){console.error(\"Error al guardar factura general:\",err);setError(\"Ocurrió un error al guardar.\");setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold mb-4\",children:[\"A\\xF1adir Factura General (\",invoiceType,\")\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"select\",{value:formData.entidadId,onChange:handleChange,name:\"entidadId\",className:\"block w-full border rounded-md p-2\",children:[/*#__PURE__*/_jsxs(\"option\",{value:\"\",children:[\"Seleccione un \",invoiceType]}),entities.map(e=>/*#__PURE__*/_jsx(\"option\",{value:e.id,children:e.nombreCompleto||e.nombre},e.id)),/*#__PURE__*/_jsx(\"option\",{value:\"otro\",children:\"Otro (especificar)\"})]}),formData.entidadId==='otro'&&/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:otherEntityName,onChange:e=>setOtherEntityName(e.target.value),placeholder:\"Nombre del \".concat(invoiceType),className:\"block w-full border rounded-md p-2\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"descripcion\",placeholder:\"Descripci\\xF3n (ej: Renta de oficina)\",value:formData.descripcion,onChange:handleChange,className:\"block w-full border rounded-md p-2\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"folio\",placeholder:\"Folio\",value:formData.folio,onChange:handleChange,className:\"block w-full border rounded-md p-2\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"monto\",placeholder:\"Monto\",value:formData.monto,onChange:handleChange,className:\"block w-full border rounded-md p-2\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"fechaEmision\",value:formData.fechaEmision,onChange:handleChange,className:\"block w-full border rounded-md p-2\"}),/*#__PURE__*/_jsx(\"label\",{className:\"text-xs\",children:\"XML:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"xmlFile\",accept:\".xml\",onChange:handleFileChange,className:\"block w-full text-sm\"}),/*#__PURE__*/_jsx(\"label\",{className:\"text-xs\",children:\"PDF:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",name:\"pdfFile\",accept:\".pdf\",onChange:handleFileChange,className:\"block w-full text-sm\"})]}),/*#__PURE__*/_jsx(Alert,{message:error,type:\"error\",onClose:()=>setError('')}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,className:\"bg-[#b0ef26] text-black font-bold py-2 px-4 rounded\",children:loading?'Guardando...':'Guardar'})]})]})});};const ManageInvoiceModal=_ref32=>{let{invoice,onClose,onFinalized}=_ref32;const[formData,setFormData]=useState({fechaPromesaPago:invoice.fechaPromesaPago?invoice.fechaPromesaPago.toDate().toISOString().split('T')[0]:'',fechaPagoReal:invoice.fechaPagoReal?invoice.fechaPagoReal.toDate().toISOString().split('T')[0]:''});const[loading,setLoading]=useState(false);const handleSave=async()=>{setLoading(true);const updatePayload={fechaPromesaPago:formData.fechaPromesaPago?Timestamp.fromDate(new Date(formData.fechaPromesaPago)):null,fechaPagoReal:formData.fechaPagoReal?Timestamp.fromDate(new Date(formData.fechaPagoReal)):null};if(formData.fechaPagoReal){updatePayload.estado=\"Pagada\";}else if(invoice.estado===\"Pagada\"){updatePayload.estado=\"Pendiente\";}await updateDoc(doc(db,\"facturas\",invoice.id),updatePayload);onFinalized();onClose();};const handleCancelInvoice=async()=>{if(window.confirm(\"¿Estás seguro de que quieres cancelar esta factura? Esta acción es irreversible.\")){setLoading(true);await updateDoc(doc(db,\"facturas\",invoice.id),{estado:\"Cancelada\"});if(invoice.proyectoId&&invoice.proyectoId!=='general'){const fieldToUpdate=invoice.tipo==='cliente'?'facturaClienteId':'facturaProveedorId';await updateDoc(doc(db,\"proyectos\",invoice.proyectoId),{[fieldToUpdate]:deleteField(),estado:'Pendiente de Factura'});}onFinalized();onClose();}};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold mb-4\",children:[\"Gestionar Factura: \",invoice.folio]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Fecha Promesa de Pago\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:formData.fechaPromesaPago,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{fechaPromesaPago:e.target.value})),className:\"mt-1 block w-full border rounded-md p-2\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Fecha de Pago Real\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:formData.fechaPagoReal,onChange:e=>setFormData(_objectSpread(_objectSpread({},formData),{},{fechaPagoReal:e.target.value})),className:\"mt-1 block w-full border rounded-md p-2\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleCancelInvoice,disabled:loading,className:\"bg-red-600 text-white font-bold py-2 px-4 rounded disabled:bg-red-300\",children:\"Cancelar Factura\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,disabled:loading,className:\"bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded mr-2\",children:\"Cerrar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,disabled:loading,className:\"bg-[#b0ef26] text-black font-bold py-2 px-4 rounded\",children:loading?'Guardando...':'Guardar'})]})]})]})});};const formatDate=timestamp=>!timestamp?'---':new Date(timestamp.seconds*1000).toLocaleDateString('es-MX');const getStatusClass=invoice=>{if(invoice.estado==='Pagada')return'bg-green-100 text-green-800';if(invoice.estado==='Cancelada')return'bg-gray-100 text-gray-500 line-through';if(invoice.fechaVencimiento&&invoice.fechaVencimiento.toDate()<new Date())return'bg-red-100 text-red-800';return'bg-orange-100 text-orange-800';};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4 flex flex-col md:flex-row justify-between items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Buscar por folio, cliente/prov. o descripci\\xF3n...\",className:\"w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md mb-2 md:mb-0\",onChange:e=>{setSearchTerm(e.target.value);setCurrentPage(1);}}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm mr-2\",children:\"Mostrar:\"}),/*#__PURE__*/_jsxs(\"select\",{value:itemsPerPage,onChange:e=>{setItemsPerPage(Number(e.target.value));setCurrentPage(1);},className:\"px-2 py-1 border border-gray-300 rounded-md\",children:[/*#__PURE__*/_jsx(\"option\",{value:10,children:\"10\"}),/*#__PURE__*/_jsx(\"option\",{value:25,children:\"25\"}),/*#__PURE__*/_jsx(\"option\",{value:50,children:\"50\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowAddModal(true),className:\"ml-4 bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg\",children:\"+ A\\xF1adir Factura General\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto bg-white rounded-lg shadow\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium uppercase\",children:\"Folio\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium uppercase\",children:invoiceType==='cliente'?'Cliente':'Proveedor'}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium uppercase\",children:\"Descripci\\xF3n\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium uppercase\",children:\"Monto\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium uppercase\",children:\"Fecha Emisi\\xF3n\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium uppercase\",children:\"Fecha Promesa Pago\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium uppercase\",children:\"Fecha Pago\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium uppercase\",children:\"Estado\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium uppercase\",children:\"Acciones\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:loading?/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"9\",children:\"Cargando...\"})}):currentItems.map(invoice=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:invoice.folio}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:invoice.clienteNombre||invoice.proveedorNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:invoice.descripcion||(invoice.proyectoId!=='general'?'Gasto de Proyecto':'---')}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4\",children:[\"$\",(invoice.monto||0).toFixed(2)]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:formatDate(invoice.fechaEmision)}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:formatDate(invoice.fechaPromesaPago)}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:formatDate(invoice.fechaPagoReal)}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsx(\"span\",{className:\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full \".concat(getStatusClass(invoice)),children:invoice.estado})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>setModalInvoice(invoice),className:\"text-indigo-600\",children:\"Gestionar\"})})]},invoice.id))})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-700\",children:[\"P\\xE1gina \",currentPage,\" de \",totalPages]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>paginate(currentPage-1),disabled:currentPage===1,className:\"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50\",children:\"Anterior\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>paginate(currentPage+1),disabled:currentPage===totalPages||totalPages===0,className:\"px-3 py-1 border rounded-md bg-white disabled:opacity-50\",children:\"Siguiente\"})]})]}),showAddModal&&/*#__PURE__*/_jsx(AddGeneralInvoiceModal,{onClose:()=>setShowAddModal(false),onFinalized:onUpdate}),modalInvoice&&/*#__PURE__*/_jsx(ManageInvoiceModal,{invoice:modalInvoice,onClose:()=>setModalInvoice(null),onFinalized:onUpdate})]});};// **CÓDIGO COMPLETO Y CORREGIDO PARA PracticanteDashboard**\nconst PracticanteDashboard=()=>{const[projects,setProjects]=useState([]);const[loading,setLoading]=useState(true);const[modalProject,setModalProject]=useState(null);const[submittingId,setSubmittingId]=useState(null);const[confirmingAction,setConfirmingAction]=useState(null);const fetchProjects=()=>{setLoading(true);const q=query(collection(db,\"proyectos\"),where(\"estado\",\"in\",[\"Terminado Internamente\",\"En Revisión Final\"]));const unsubscribe=onSnapshot(q,querySnapshot=>{const projectsData=querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setProjects(projectsData);setLoading(false);},error=>{console.error(\"Error fetching projects for practicante: \",error);setLoading(false);});return unsubscribe;};useEffect(()=>{const unsubscribe=fetchProjects();return()=>unsubscribe();},[]);// **CÓDIGO ACTUALIZADO PARA ManageFinalDeliveryModal**\nconst ManageFinalDeliveryModal=_ref33=>{let{project,onClose,onFinalized}=_ref33;const[heyzineUrl,setHeyzineUrl]=useState(project.urlHeyzine||'');const[notaPdfFile1,setNotaPdfFile1]=useState(null);const[notaPdfFile2,setNotaPdfFile2]=useState(null);const[loading,setLoading]=useState(false);const handleFileChange=setter=>e=>{if(e.target.files[0])setter(e.target.files[0]);};const uploadFile=async(file,path)=>{if(!file)return null;const storageRef=ref(storage,path);const uploadTask=uploadBytesResumable(storageRef,file);return getDownloadURL((await uploadTask).ref);};const handleSave=async()=>{setLoading(true);const updatePayload={urlHeyzine:heyzineUrl// Siempre actualiza el enlace principal\n};const nota1Url=await uploadFile(notaPdfFile1,\"notas_entrega_cliente/\".concat(project.id,\"/nota1_\").concat(notaPdfFile1===null||notaPdfFile1===void 0?void 0:notaPdfFile1.name));const nota2Url=await uploadFile(notaPdfFile2,\"notas_entrega_cliente/\".concat(project.id,\"/nota2_\").concat(notaPdfFile2===null||notaPdfFile2===void 0?void 0:notaPdfFile2.name));if(nota1Url)updatePayload.urlNotaPdf1=nota1Url;if(nota2Url)updatePayload.urlNotaPdf2=nota2Url;if(Object.keys(updatePayload).length>0){await updateDoc(doc(db,\"proyectos\",project.id),updatePayload);}onFinalized();onClose();};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold mb-4\",children:[\"Gestionar Entrega Final: \",project.npu]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Enlace Heyzine (\\xDAnico)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:heyzineUrl,onChange:e=>setHeyzineUrl(e.target.value),className:\"mt-1 block w-full border rounded-md p-2\"})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Subir/Reemplazar Nota de Entrega 1 (Firmada)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".pdf\",onChange:handleFileChange(setNotaPdfFile1),className:\"mt-1 block w-full text-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Subir/Reemplazar Nota de Entrega 2 (Firmada)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".pdf\",onChange:handleFileChange(setNotaPdfFile2),className:\"mt-1 block w-full text-sm\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded\",children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,className:\"bg-blue-600 text-white font-bold py-2 px-4 rounded\",children:loading?'Guardando...':'Guardar Documentos'})]})]})});};const handleSendToReview=async projectId=>{setSubmittingId(projectId);try{await updateDoc(doc(db,\"proyectos\",projectId),{estado:'En Revisión Final',motivoRechazo:deleteField()});}catch(error){console.error(\"Error sending project to review:\",error);alert(\"Ocurrió un error al enviar el proyecto a revisión.\");}finally{setSubmittingId(null);}};const promptSendToReview=projectId=>{setConfirmingAction({title:\"Confirmar Envío\",message:\"¿Estás seguro de que todos los documentos están listos y quieres enviar este proyecto a revisión final?\",onConfirm:()=>handleSendToReview(projectId)});};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-6\",children:\"Proyectos Listos para Documentar\"}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando...\"}):projects.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No hay proyectos pendientes.\"}):/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto bg-white rounded-lg shadow\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"NPU\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Cliente\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Servicio\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Documentos del T\\xE9cnico\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\",children:\"Acciones\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:projects.map(project=>/*#__PURE__*/_jsxs(\"tr\",{className:project.motivoRechazo?\"bg-orange-50\":\"\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.npu}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.clienteNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm\",children:project.servicioNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col space-y-1 text-sm\",children:[project.urlEvidenciaTecnico1&&/*#__PURE__*/_jsxs(\"div\",{className:\"p-2 border-b\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold text-xs\",children:\"Fase 1:\"}),/*#__PURE__*/_jsx(\"a\",{href:project.urlEvidenciaTecnico1,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-600\",children:\"Ver Evidencia 1\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Nota Interna 1: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:project.numeroNotaInterna1||'N/A'})]})]}),project.urlEvidenciaTecnico2&&/*#__PURE__*/_jsxs(\"div\",{className:\"p-2\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-semibold text-xs\",children:\"Fase 2:\"}),/*#__PURE__*/_jsx(\"a\",{href:project.urlEvidenciaTecnico2,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-600\",children:\"Ver Evidencia 2\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Nota Interna 2: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:project.numeroNotaInterna2||'N/A'})]})]}),project.urlEvidenciaTecnico&&!project.urlEvidenciaTecnico1&&/*#__PURE__*/_jsx(\"a\",{href:project.urlEvidenciaTecnico,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-600\",children:\"Ver Evidencia\"}),project.motivoRechazo&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 p-2 bg-orange-100 text-orange-800 rounded-md\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-bold text-xs\",children:\"Correcciones Pendientes:\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs\",children:project.motivoRechazo})]})]})}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm font-medium\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setModalProject(project),className:\"text-indigo-600 hover:text-indigo-900 mr-4\",children:\"Gestionar Entrega\"}),project.estado==='Terminado Internamente'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>promptSendToReview(project.id),disabled:submittingId===project.id,className:\"text-green-600 hover:text-green-900 disabled:opacity-50\",children:submittingId===project.id?'Enviando...':'Enviar a Revisión'})]})]},project.id))})]})}),modalProject&&/*#__PURE__*/_jsx(ManageFinalDeliveryModal,{project:modalProject,onClose:()=>setModalProject(null),onFinalized:fetchProjects}),confirmingAction&&/*#__PURE__*/_jsx(ConfirmationModal,{title:confirmingAction.title,message:confirmingAction.message,onConfirm:confirmingAction.onConfirm,onCancel:()=>setConfirmingAction(null)})]});};// --- COMPONENTE \"ROUTER\" PRINCIPAL ---\nconst Dashboard=_ref34=>{let{user,userData}=_ref34;// Esta función actúa como un \"router\" interno, mostrando el panel correcto para cada rol.\nconst renderDashboardByRole=()=>{switch(userData.rol){case'administrador':return/*#__PURE__*/_jsx(AdminDashboard,{user:user,userData:userData});case'cliente':return/*#__PURE__*/_jsx(ClientDashboard,{user:user,userData:userData});case'directivo':return/*#__PURE__*/_jsx(DirectivoDashboard,{user:user,userData:userData});case'ecotech':return/*#__PURE__*/_jsx(EcotechDashboard,{user:user,userData:userData});case'supervisor':return/*#__PURE__*/_jsx(SupervisorDashboard,{user:user,userData:userData});case'tecnico':return/*#__PURE__*/_jsx(TecnicoDashboard,{user:user,userData:userData});case'finanzas':return/*#__PURE__*/_jsx(FinanzasDashboard,{user:user,userData:userData});case'practicante':// El practicante no necesita los datos del usuario para su función actual\nreturn/*#__PURE__*/_jsx(PracticanteDashboard,{});default:return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold\",children:\"Rol no reconocido\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Contacte al administrador.\"})]});}};return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8\",children:renderDashboardByRole()});};const AuthPage=()=>{const[email,setEmail]=useState('');const[password,setPassword]=useState('');const[error,setError]=useState('');const handleLogin=async e=>{e.preventDefault();setError('');try{await signInWithEmailAndPassword(auth,email,password);}catch(err){setError(\"Email o contraseña incorrectos.\");}};return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-[#cdcdcd]\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-md w-full bg-white p-8 rounded-xl shadow-2xl\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"https://www.grupoevelsa.com/assets/images/Logo Evelsa 2.png\",alt:\"Logo Grupo Evelsa\",className:\"h-16 mx-auto mb-6\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-center text-gray-800 mb-8\",children:\"Acceso al Portal\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLogin,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:email,onChange:e=>setEmail(e.target.value),required:true,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Contrase\\xF1a\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,onChange:e=>setPassword(e.target.value),required:true,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"})]}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 text-sm text-center\",children:error}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-3 px-4 rounded-lg transition duration-300 text-lg\",children:\"Entrar\"})]})]})});};export default function App(){const[user,setUser]=useState(null);const[userData,setUserData]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{const unsubscribe=onAuthStateChanged(auth,async currentUser=>{if(currentUser){const userDocRef=doc(db,\"usuarios\",currentUser.uid);const userDoc=await getDoc(userDocRef);if(userDoc.exists()){setUserData(userDoc.data());setUser(currentUser);}else{console.error(\"Usuario autenticado pero no encontrado en Firestore. Deslogueando...\");signOut(auth);}}else{setUser(null);setUserData(null);}setLoading(false);});return()=>unsubscribe();},[]);if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-[#cdcdcd] text-gray-700\",children:\"Cargando...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-[#c9c9c9] min-h-screen font-sans\",children:[/*#__PURE__*/_jsx(Header,{user:user,userData:userData}),/*#__PURE__*/_jsx(\"main\",{children:user&&userData?/*#__PURE__*/_jsx(Dashboard,{user:user,userData:userData}):/*#__PURE__*/_jsx(AuthPage,{})})]});}","map":{"version":3,"names":["React","useState","useEffect","initializeApp","getAuth","onAuthStateChanged","createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","getFirestore","collection","addDoc","query","where","getDocs","doc","getDoc","updateDoc","onSnapshot","setDoc","Timestamp","runTransaction","orderBy","deleteDoc","deleteField","arrayUnion","getStorage","ref","uploadBytesResumable","getDownloadURL","Bar","Chart","ChartJS","CategoryScale","LinearScale","BarElement","LineElement","PointElement","LineController","Title","Tooltip","Legend","ArcElement","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","register","firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","app","auth","db","storage","Alert","_ref","message","type","onClose","baseClasses","typeClasses","error","success","className","concat","role","children","onClick","ConfirmationModal","_ref2","title","onConfirm","onCancel","confirmText","cancelText","confirmColor","ActionWithReasonModal","_ref3","reason","setReason","value","onChange","e","target","placeholder","rows","Header","_ref4","user","userData","logoGrupoEvelsa","rol","logoUrl","src","onError","onerror","alt","nombreCompleto","split","email","ProjectLogModal","_ref5","project","logEntries","setLogEntries","newNote","setNewNote","newFile","setNewFile","loading","setLoading","submitting","setSubmitting","setError","q","id","unsubscribe","querySnapshot","docs","map","_objectSpread","data","err","console","handleFileChange","files","handleSubmitNote","fileUrl","storageRef","Date","now","name","uploadTask","autorId","uid","autorNombre","mensaje","adjuntoUrl","fecha","fileInput","document","getElementById","formatDate","timestamp","seconds","toLocaleString","npu","length","entry","href","rel","disabled","UserManagement","_ref6","onUserAdded","setEmail","password","setPassword","setNombreCompleto","setRol","clienteIdNumerico","setClienteIdNumerico","setLogoUrl","setSuccess","resetForm","handleSubmit","preventDefault","tempApp","getTime","tempAuth","userCredential","padStart","onSubmit","DataManagement","_ref7","collectionName","fields","placeholderTexts","items","setItems","newItem","setNewItem","itemsData","handleChange","prev","some","field","slice","index","replace","colSpan","item","AdminDashboard","view","setView","projects","setProjects","reviewProjects","setReviewProjects","refreshData","qProjects","unsubscribeProjects","qReview","unsubscribeReview","NewProjectForm","onProjectAdded","ProjectsTable","onUpdateProject","userRole","ReviewProjectsTable","HeyzineViewerModal","_ref8","url","frameBorder","allowFullScreen","ProjectsShelf","_ref9","onOpenModal","finishedProjects","filter","p","estadoCliente","urlDocumento1","urlDocumento2","coverTemplateUrl","clienteNombre","servicioNombre","_ref0","_collections$proveedo","formData","setFormData","clienteId","servicioId","proveedorId","comentariosApertura","fechaApertura","toISOString","precioCotizacionCliente","costoProveedor","setFiles","cotizacionClienteFile","poClienteFile","cotizacionProveedorFile","poProveedorFile","formRef","useRef","collections","setCollections","clientes","servicios","proveedores","isInternalProvider","find","nombre","toLowerCase","trim","fetchData","clientesSnap","serviciosSnap","proveedoresSnap","Promise","all","sortByName","a","b","localeCompare","sort","inputFiles","uploadFile","file","path","snapshot","_files$cotizacionClie","_files$poClienteFile","_files$cotizacionProv","_files$poProveedorFil","urlCotizacionCliente","urlPOCliente","urlCotizacionProveedor","urlPOProveedor","anioActual","getFullYear","contadorRef","nuevoConsecutivo","transaction","contadorDoc","get","nuevoValor","exists","consecutivo","set","merge","ultimosDosDigitosAnio","toString","consecutivoFormateado","cliente","c","servicio","s","proveedor","servicioIdNumerico","proveedorIdNumerico","poProveedorAuto","estadoInicial","fromDate","proveedorNombre","estado","dependencia","asignadoTecnicosIds","tecnicosStatus","Number","poProveedor","current","reset","_ref1","modalProject","setModalProject","modalType","setModalType","searchTerm","setSearchTerm","currentPage","setCurrentPage","itemsPerPage","setItemsPerPage","techniciansMap","setTechniciansMap","invoicesMap","setInvoicesMap","confirmingAction","setConfirmingAction","fetchExtraData","qTechs","unsubTechs","techMap","forEach","qInvoices","unsubInvoices","invMap","folio","ManageProjectModal","_ref10","onFinalized","handleSave","_files$cotizacionClie2","_files$poClienteFile2","_files$cotizacionProv2","_files$poProveedorFil2","updatePayload","Object","keys","AssignProjectModal","_ref11","technicians","setTechnicians","selectedTechnicians","setSelectedTechnicians","deliveryDate","setDeliveryDate","fechaEntregaInterna","toDate","fetchTechnicians","handleCheckboxChange","techId","includes","projectRef","_project$tecnicosStat","fechaAsignacionTecnico","tech","checked","htmlFor","filteredProjects","currentItems","totalPages","Math","ceil","paginate","pageNumber","date","userTimezoneOffset","getTimezoneOffset","adjustedDate","toLocaleDateString","year","month","day","getDueDateColor","dueDate","today","setHours","diffTime","diffDays","handleActivateProject","handleDeleteProject","promptDeleteProject","projectNpu","_project$proveedorNom","isAssigned","numeroProyectoLaboratorio","toFixed","facturaClienteId","facturaProveedorId","status","statusClass","_ref12","handleApprove","action","payload","isFinalDelivery","faseFacturacion","alert","handleReject","motivoRechazo","promptApprove","hasBeenBilled","confirmationMessage","promptReject","urlHeyzine","urlNotaPdf1","urlNotaPdf2","ClientProjectsList","_ref13","activeAccordion","setActiveAccordion","groupedProjects","reduce","acc","key","push","toggleAccordion","getStatusClass","entries","_ref14","projs","download","ClientDashboard","_ref15","clientView","setClientView","modalUrl","setModalUrl","projectsData","code","PipelineChart","_ref16","chartData","labels","datasets","label","cotizacionData","backgroundColor","activoData","pendienteFacturaData","totalData","borderColor","fill","tension","yAxisID","options","responsive","maintainAspectRatio","plugins","display","tooltip","mode","intersect","legend","position","scales","x","stacked","y","beginAtZero","y1","grid","drawOnChartArea","AccountsReceivableChart","_ref17","pagadoData","programadoData","venceHoyData","vencidoData","pdteProgramacionData","totalFacturadoData","CashFlowChart","_ref18","ingresosData","egresosData","TechnicianProductivityChart","_ref19","completedData","borderWidth","indexAxis","ticks","stepSize","KPIWidget","_ref20","unit","trend","DirectivoDashboard","dashboardData","setDashboardData","processDataForDashboard","invoices","currentYear","currentMonth","getMonth","oneDay","monthlyProjectsData","Array","cotizacion","activo","pendienteFactura","total","_p$fechaApertura","projectValue","monthlyARData","totalFacturado","pdteProgramacion","programado","venceHoy","vencido","pagado","inv","_inv$fechaEmision","tipo","fechaEmision","invoiceValue","monto","_inv$fechaPromesaPago","fechaPromesaPago","promiseDate","weeklyCashFlowData","ingresos","egresos","weeklyLabels","todayForWeeks","i","weekStartDate","getDate","_inv$fechaPromesaPago2","floor","weekIndex","techProductivity","t","completed","fechaFinTecnico1","fechaFinTecnico2","Boolean","completionDate","totalMargin","projectsWithFinancials","totalDeliveryDays","completedProjects","totalActivationDays","activatedProjects","_p$fechaAsignacionTec","_p$fechaFinTecnico","_p$fechaApertura2","_p$fechaAsignacionTec2","kpis","avgMargin","avgDeliveryDays","avgActivationDays","invoicedThisMonth","style","currency","pipeline","m","accountsReceivable","cashFlow","w","technicianProductivity","values","projectsQuery","invoicesQuery","techniciansQuery","projectsSnapshot","invoicesSnapshot","techniciansSnapshot","allProjects","allInvoices","allTechnicians","processedData","EcotechDashboard","fetchProjects","EcotechProjectsTable","_ref21","ManageEcotechProjectModal","_ref22","labProjectNumber","setLabProjectNumber","workPoints","setWorkPoints","puntosDeTrabajo","notes","setNotes","notasEcotech","setStatus","estatusEcotech","guiaEnvio","setGuiaEnvio","numeroGuiaEnvio","guiaRegreso","setGuiaRegreso","numeroGuiaRegreso","indexOfLastItem","indexOfFirstItem","SupervisorDashboard","_ref23","allActiveProjects","setAllActiveProjects","sortBy","setSortBy","sortOrder","setSortOrder","displayedProjects","useMemo","filtered","hasAssignedTechnicians","fieldA","fieldB","comparison","TecnicoDashboard","_ref24","statusToQuery","handleStartProject","TecnicoProjectsTable","_ref25","ManageTaskModal","_ref26","comments","setComments","evidenceFile","setEvidenceFile","generateAndSaveNota","window","jspdf","Error","jsPDF","pdfDoc","numeroNota","setFont","setFontSize","text","align","rect","splitComments","splitTextToSize","line","save","handleCompleteTask","evidenceRef","evidenceUploadTask","evidenceUrl","comentariosTecnico","urlEvidenciaTecnico1","numeroNotaInterna1","urlEvidenciaTecnico2","numeroNotaInterna2","accept","FinanzasDashboard","_ref27","fetchPendingProjects","log","newTecnicosStatus","PendingInvoicesTable","onUpdate","InvoicesList","invoiceType","_ref28","AttachInvoicesModal","_ref29","_project$proveedorNom2","setMode","clientInvoice","setClientInvoice","clientFiles","setClientFiles","xmlFile","pdfFile","providerInvoice","setProviderInvoice","providerFiles","setProviderFiles","linkableInvoices","setLinkableInvoices","selectedClientInvoiceId","setSelectedClientInvoiceId","selectedProviderInvoiceId","setSelectedProviderInvoiceId","setter","finalFacturaClienteIds","facturasClienteIds","finalFacturaProveedorIds","facturasProveedorIds","urlXml","urlPdf","newInvoiceRef","proyectoId","proyectosIds","isClientInvoiceReady","isProviderInvoiceReady","_project$proveedorNom3","_ref30","setInvoices","showAddModal","setShowAddModal","modalInvoice","setModalInvoice","filteredInvoices","invoice","descripcion","AddGeneralInvoiceModal","_ref31","entidadId","entities","setEntities","otherEntityName","setOtherEntityName","then","entityList","sortedEntities","_entities$find","_entities$find2","entityName","ManageInvoiceModal","_ref32","fechaPagoReal","handleCancelInvoice","confirm","fieldToUpdate","fechaVencimiento","PracticanteDashboard","submittingId","setSubmittingId","ManageFinalDeliveryModal","_ref33","heyzineUrl","setHeyzineUrl","notaPdfFile1","setNotaPdfFile1","notaPdfFile2","setNotaPdfFile2","nota1Url","nota2Url","handleSendToReview","promptSendToReview","urlEvidenciaTecnico","Dashboard","_ref34","renderDashboardByRole","AuthPage","handleLogin","required","App","setUser","setUserData","currentUser","userDocRef","userDoc"],"sources":["C:/Users/CAD/Documents/portal-evelsa/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { initializeApp } from 'firebase/app';\r\nimport { \r\n    getAuth, \r\n    onAuthStateChanged, \r\n    createUserWithEmailAndPassword, \r\n    signInWithEmailAndPassword, \r\n    signOut \r\n} from 'firebase/auth';\r\nimport { \r\n    getFirestore, \r\n    collection, \r\n    addDoc, \r\n    query, \r\n    where, \r\n    getDocs, \r\n    doc, \r\n    getDoc,\r\n    updateDoc,\r\n    onSnapshot,\r\n    setDoc,\r\n    Timestamp,\r\n    runTransaction,\r\n    orderBy,\r\n    deleteDoc,\r\n    deleteField,\r\n    arrayUnion\r\n} from 'firebase/firestore';\r\nimport { \r\n    getStorage, \r\n    ref, \r\n    uploadBytesResumable, \r\n    getDownloadURL \r\n} from 'firebase/storage';\r\n\r\nimport { Bar } from 'react-chartjs-2';\r\n\r\nimport { Chart as ChartJS, CategoryScale, LinearScale, BarElement, LineElement, PointElement, LineController, Title, Tooltip, Legend, ArcElement } from 'chart.js';\r\n\r\nChartJS.register(\r\n  CategoryScale,\r\n  LinearScale,\r\n  BarElement,\r\n  LineElement,\r\n  PointElement,\r\n  LineController, // <-- Añadir aquí\r\n  Title,\r\n  Tooltip,\r\n  Legend,\r\n  ArcElement\r\n);\r\n\r\n// --- INSTRUCCIONES DE CONFIGURACIÓN DE FIREBASE ---\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyA7H6G0mXCy9DmoLg3fSW3TrxIRcEzz9jg\",\r\n  authDomain: \"portal-evelsa.firebaseapp.com\",\r\n  projectId: \"portal-evelsa\",\r\n  storageBucket: \"portal-evelsa.firebasestorage.app\",\r\n  messagingSenderId: \"847174487471\",\r\n  appId: \"1:847174487471:web:c3a57fd8315ce619a2335a\"\r\n};\r\n\r\n// --- Inicialización de Firebase ---\r\nconst app = initializeApp(firebaseConfig);\r\nconst auth = getAuth(app);\r\nconst db = getFirestore(app);\r\nconst storage = getStorage(app);\r\n\r\n// --- Componentes Reutilizables ---\r\nconst Alert = ({ message, type, onClose }) => {\r\n    if (!message) return null;\r\n    const baseClasses = \"p-4 mb-4 text-sm rounded-lg relative\";\r\n    const typeClasses = { error: \"bg-red-100 text-red-800\", success: \"bg-green-100 text-green-800\" };\r\n    return (\r\n        <div className={`${baseClasses} ${typeClasses[type]}`} role=\"alert\">\r\n            <span className=\"font-medium\">{message}</span>\r\n            <button onClick={onClose} className=\"absolute top-0 right-0 mt-2 mr-3 text-2xl font-semibold leading-none\">&times;</button>\r\n        </div>\r\n    );\r\n};\r\n\r\n// **COMPONENTE REUTILIZABLE PARA CONFIRMACIONES SIMPLES**\r\nconst ConfirmationModal = ({ title, message, onConfirm, onCancel, confirmText = \"Confirmar\", cancelText = \"Cancelar\", confirmColor = \"bg-green-600\" }) => {\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n            <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-sm\">\r\n                <h3 className=\"text-lg font-bold mb-4\">{title}</h3>\r\n                <p className=\"text-sm text-gray-600 mb-6\">{message}</p>\r\n                <div className=\"flex justify-end space-x-3\">\r\n                    <button onClick={onCancel} className=\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\">{cancelText}</button>\r\n                    <button onClick={onConfirm} className={`${confirmColor} hover:opacity-90 text-white font-bold py-2 px-4 rounded`}>{confirmText}</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// **COMPONENTE REUTILIZABLE PARA ACCIONES CON MOTIVO**\r\nconst ActionWithReasonModal = ({ title, message, onConfirm, onCancel, confirmText = \"Confirmar\", cancelText = \"Cancelar\", confirmColor = \"bg-orange-600\" }) => {\r\n    const [reason, setReason] = useState('');\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n            <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-md\">\r\n                <h3 className=\"text-lg font-bold mb-4\">{title}</h3>\r\n                <p className=\"text-sm text-gray-600 mb-4\">{message}</p>\r\n                <textarea \r\n                    value={reason} \r\n                    onChange={(e) => setReason(e.target.value)} \r\n                    placeholder=\"Escribe el motivo aquí...\" \r\n                    rows=\"3\"\r\n                    className=\"w-full p-2 border rounded-md\"\r\n                ></textarea>\r\n                <div className=\"flex justify-end space-x-3 mt-6\">\r\n                    <button onClick={onCancel} className=\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\">{cancelText}</button>\r\n                    <button onClick={() => onConfirm(reason)} className={`${confirmColor} hover:opacity-90 text-white font-bold py-2 px-4 rounded`}>{confirmText}</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// --- COMPONENTE DE CABECERA ---\r\nconst Header = ({ user, userData }) => {\r\n    const logoGrupoEvelsa = \"https://www.grupoevelsa.com/assets/images/Logo Evelsa 2.png\";\r\n    return (\r\n        <header className=\"bg-white shadow-md sticky top-0 z-40\">\r\n            <div className=\"max-w-7xl mx-auto py-3 px-4 sm:px-6 lg:px-8 flex justify-between items-center\">\r\n                <div className=\"flex items-center\">\r\n                    {/* Esta es la lógica corregida */}\r\n                    {userData && userData.rol === 'cliente' && userData.logoUrl ? (\r\n                        <img src={userData.logoUrl} onError={(e)=>{e.target.onerror = null; e.target.src=\"https://placehold.co/150x50/FFFFFF/000000?text=Logo+Cliente\"}} alt=\"Logo Cliente\" className=\"h-12 w-auto mr-4 object-contain\"/>\r\n                    ) : (\r\n                        <img src={logoGrupoEvelsa} alt=\"Logo Grupo Evelsa\" className=\"h-12 w-auto mr-4\"/>\r\n                    )}\r\n                </div>\r\n                {user && (\r\n                    <div className=\"flex items-center\">\r\n                        <span className=\"text-gray-600 mr-4 hidden sm:block\">\r\n                            Hola, {userData ? userData.nombreCompleto.split(' ')[0] : user.email}\r\n                        </span>\r\n                        <button onClick={() => signOut(auth)} className=\"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300\">\r\n                            Salir\r\n                        </button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </header>\r\n    );\r\n};\r\n\r\n// **CÓDIGO COMPLETO Y CORREGIDO PARA ProjectLogModal**\r\nconst ProjectLogModal = ({ project, user, userData, onClose }) => {\r\n    const [logEntries, setLogEntries] = useState([]);\r\n    const [newNote, setNewNote] = useState('');\r\n    const [newFile, setNewFile] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [submitting, setSubmitting] = useState(false); // Estado para el botón de guardar\r\n    const [error, setError] = useState('');\r\n\r\n    useEffect(() => {\r\n        const q = query(collection(db, \"bitacoras_proyectos\"), where(\"projectId\", \"==\", project.id), orderBy(\"fecha\", \"asc\"));\r\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n            setLogEntries(querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));\r\n            setLoading(false);\r\n        }, (err) => {\r\n            console.error(`Error fetching log entries:`, err);\r\n            setError(`No se pudo cargar la bitácora.`);\r\n            setLoading(false);\r\n        });\r\n        return () => unsubscribe();\r\n    }, [project.id]);\r\n\r\n    const handleFileChange = (e) => {\r\n        if (e.target.files[0]) setNewFile(e.target.files[0]);\r\n    };\r\n\r\n    const handleSubmitNote = async () => {\r\n        if (!newNote && !newFile) return;\r\n        setSubmitting(true);\r\n        setError('');\r\n\r\n        try {\r\n            let fileUrl = '';\r\n            if (newFile) {\r\n                const storageRef = ref(storage, `bitacoras/${project.id}/${Date.now()}_${newFile.name}`);\r\n                const uploadTask = uploadBytesResumable(storageRef, newFile);\r\n                fileUrl = await getDownloadURL((await uploadTask).ref);\r\n            }\r\n\r\n            await addDoc(collection(db, \"bitacoras_proyectos\"), {\r\n                projectId: project.id,\r\n                autorId: user.uid,\r\n                autorNombre: userData.nombreCompleto,\r\n                mensaje: newNote,\r\n                adjuntoUrl: fileUrl,\r\n                fecha: Timestamp.now()\r\n            });\r\n\r\n            setNewNote('');\r\n            setNewFile(null);\r\n            // Limpiar el input de archivo\r\n            const fileInput = document.getElementById(`file-input-${project.id}`);\r\n            if(fileInput) fileInput.value = \"\";\r\n\r\n        } catch (err) {\r\n            console.error(\"Error al guardar en bitácora:\", err);\r\n            setError(\"No se pudo guardar la nota. Por favor, intente de nuevo.\");\r\n        } finally {\r\n            setSubmitting(false); // Esto asegura que el botón se reactive siempre\r\n        }\r\n    };\r\n\r\n    const formatDate = (timestamp) => !timestamp ? '---' : new Date(timestamp.seconds * 1000).toLocaleString('es-MX');\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n            <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl h-[90vh] flex flex-col\">\r\n                <div className=\"flex justify-between items-center mb-4\">\r\n                    <h3 className=\"text-lg font-bold\">Bitácora del Proyecto: {project.npu}</h3>\r\n                    <button onClick={onClose} className=\"text-gray-600 hover:text-gray-900 text-2xl font-bold\">&times;</button>\r\n                </div>\r\n                \r\n                <div className=\"flex-grow overflow-y-auto border rounded-md p-4 space-y-4 mb-4 bg-gray-50\">\r\n                    {loading ? <p>Cargando bitácora...</p> : logEntries.length === 0 ? <p>No hay entradas en la bitácora.</p> :\r\n                        logEntries.map(entry => (\r\n                            <div key={entry.id} className=\"p-3 bg-white rounded-lg shadow-sm\">\r\n                                <p className=\"text-sm text-gray-800 whitespace-pre-wrap\">{entry.mensaje}</p>\r\n                                {entry.adjuntoUrl && <a href={entry.adjuntoUrl} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-sm text-blue-600 hover:underline\">Ver adjunto</a>}\r\n                                <p className=\"text-xs text-gray-500 mt-2 text-right\">{entry.autorNombre} - {formatDate(entry.fecha)}</p>\r\n                            </div>\r\n                        ))\r\n                    }\r\n                </div>\r\n\r\n                <div className=\"border-t pt-4\">\r\n                    <textarea value={newNote} onChange={e => setNewNote(e.target.value)} placeholder=\"Añadir nueva nota...\" rows=\"3\" className=\"w-full p-2 border rounded-md\"></textarea>\r\n                    <input type=\"file\" id={`file-input-${project.id}`} onChange={handleFileChange} className=\"w-full text-sm mt-2\"/>\r\n                    <Alert message={error} type=\"error\" onClose={() => setError('')} />\r\n                    <button onClick={handleSubmitNote} disabled={submitting} className=\"w-full mt-2 bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg disabled:bg-gray-300\">\r\n                        {submitting ? 'Guardando...' : 'Añadir a la Bitácora'}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// --- Componentes de Gestión (Para Administradores) ---\r\n\r\nconst UserManagement = ({ onUserAdded }) => {\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [nombreCompleto, setNombreCompleto] = useState('');\r\n    const [rol, setRol] = useState('cliente');\r\n    const [clienteIdNumerico, setClienteIdNumerico] = useState('');\r\n    const [logoUrl, setLogoUrl] = useState('');\r\n    const [error, setError] = useState('');\r\n    const [success, setSuccess] = useState('');\r\n\r\n    const resetForm = () => {\r\n        setEmail(''); setPassword(''); setNombreCompleto(''); setRol('cliente');\r\n        setClienteIdNumerico(''); setLogoUrl('');\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setError(''); setSuccess('');\r\n\r\n        if (!nombreCompleto || !email || !password) {\r\n            setError('Nombre, email y contraseña son obligatorios.');\r\n            return;\r\n        }\r\n        if (rol === 'cliente' && !clienteIdNumerico) {\r\n             setError('Para clientes, el ID Numérico es obligatorio.');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const tempApp = initializeApp(firebaseConfig, `Secondary-${new Date().getTime()}`);\r\n            const tempAuth = getAuth(tempApp);\r\n            const userCredential = await createUserWithEmailAndPassword(tempAuth, email, password);\r\n            \r\n            await setDoc(doc(db, \"usuarios\", userCredential.user.uid), {\r\n                email, rol, nombreCompleto,\r\n                clienteIdNumerico: rol === 'cliente' ? clienteIdNumerico.padStart(3, '0') : '',\r\n                logoUrl: rol === 'cliente' ? logoUrl : '',\r\n            });\r\n\r\n            setSuccess(`¡Usuario ${email} con rol '${rol}' creado con éxito!`);\r\n            resetForm();\r\n            if (onUserAdded) onUserAdded();\r\n        } catch (err) {\r\n            setError(`Error al crear usuario: ${err.message}`);\r\n        }\r\n    };\r\n    \r\n    return (\r\n        <div className=\"bg-white p-6 rounded-xl shadow-lg border border-gray-200\">\r\n            <h3 className=\"text-xl font-bold text-gray-800 mb-4\">Crear Nuevo Usuario</h3>\r\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                 <input type=\"text\" value={nombreCompleto} onChange={e => setNombreCompleto(e.target.value)} placeholder=\"Nombre Completo\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                 <select value={rol} onChange={e => setRol(e.target.value)} className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\">\r\n                    <option value=\"cliente\">Cliente</option>\r\n                    <option value=\"administrador\">Administrador</option>\r\n                    <option value=\"directivo\">Directivo</option>\r\n                    <option value=\"ecotech\">Encargada Ecotech</option>\r\n                    <option value=\"supervisor\">Supervisor de Proyectos</option>\r\n                    <option value=\"tecnico\">Técnico</option>\r\n                    <option value=\"finanzas\">Finanzas</option>\r\n                    <option value=\"practicante\">Practicante</option>\r\n                 </select>\r\n                 <input type=\"email\" value={email} onChange={e => setEmail(e.target.value)} placeholder=\"Email de Acceso\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                 <input type=\"password\" value={password} onChange={e => setPassword(e.target.value)} placeholder=\"Contraseña (mínimo 6 caracteres)\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                 {rol === 'cliente' && (\r\n                     <>\r\n                        <input type=\"text\" value={clienteIdNumerico} onChange={e => setClienteIdNumerico(e.target.value)} placeholder=\"ID Numérico Cliente (ej: 001)\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                        <input type=\"text\" value={logoUrl} onChange={e => setLogoUrl(e.target.value)} placeholder=\"URL del Logo (Opcional)\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                     </>\r\n                 )}\r\n                 <Alert message={error} type=\"error\" onClose={() => setError('')} />\r\n                 <Alert message={success} type=\"success\" onClose={() => setSuccess('')} />\r\n                 <button type=\"submit\" className=\"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg\">Crear Usuario</button>\r\n            </form>\r\n        </div>\r\n    );\r\n};\r\n\r\n// **NUEVO COMPONENTE REUTILIZABLE PARA GESTIONAR DATOS MAESTROS**\r\nconst DataManagement = ({ collectionName, title, fields, placeholderTexts }) => {\r\n    const [items, setItems] = useState([]);\r\n    const [newItem, setNewItem] = useState({});\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState('');\r\n    const [success, setSuccess] = useState('');\r\n\r\n    useEffect(() => {\r\n        const q = query(collection(db, collectionName));\r\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n            const itemsData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            setItems(itemsData);\r\n            setLoading(false);\r\n        }, (err) => {\r\n            console.error(`Error fetching ${collectionName}:`, err);\r\n            setError(`No se pudieron cargar los datos de ${title}.`);\r\n            setLoading(false);\r\n        });\r\n        return () => unsubscribe();\r\n    }, [collectionName, title]);\r\n\r\n    const handleChange = (e) => {\r\n        const { name, value } = e.target;\r\n        setNewItem(prev => ({ ...prev, [name]: value }));\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (fields.some(field => !newItem[field])) {\r\n            setError('Todos los campos son obligatorios.');\r\n            return;\r\n        }\r\n        setError('');\r\n        setSuccess('');\r\n\r\n        try {\r\n            await addDoc(collection(db, collectionName), newItem);\r\n            setSuccess(`¡${title.slice(0, -1)} añadido con éxito!`);\r\n            setNewItem({});\r\n        } catch (err) {\r\n            setError(`Error al añadir el nuevo ítem: ${err.message}`);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n            <div className=\"bg-white p-6 rounded-xl shadow-lg border border-gray-200\">\r\n                <h3 className=\"text-xl font-bold text-gray-800 mb-4\">Añadir Nuevo {title.slice(0, -1)}</h3>\r\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                    {fields.map((field, index) => (\r\n                        <div key={field}>\r\n                            <label className=\"block text-sm font-medium text-gray-700 capitalize\">{field.replace(/([A-Z])/g, ' $1')}</label>\r\n                            <input \r\n                                type=\"text\" \r\n                                name={field} \r\n                                value={newItem[field] || ''} \r\n                                onChange={handleChange}\r\n                                placeholder={placeholderTexts[index]}\r\n                                className=\"mt-1 block w-full px-3 py-2 border rounded-md\"\r\n                            />\r\n                        </div>\r\n                    ))}\r\n                    <Alert message={error} type=\"error\" onClose={() => setError('')} />\r\n                    <Alert message={success} type=\"success\" onClose={() => setSuccess('')} />\r\n                    <button type=\"submit\" className=\"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg\">Añadir</button>\r\n                </form>\r\n            </div>\r\n            <div className=\"bg-white p-6 rounded-xl shadow-lg border border-gray-200\">\r\n                 <h3 className=\"text-xl font-bold text-gray-800 mb-4\">{title} Existentes</h3>\r\n                 <div className=\"overflow-y-auto max-h-96\">\r\n                    <table className=\"min-w-full divide-y divide-gray-200\">\r\n                        <thead className=\"bg-gray-50\">\r\n                            <tr>\r\n                                {fields.map(field => <th key={field} className=\"px-4 py-2 text-left text-xs font-medium uppercase\">{field.replace(/([A-Z])/g, ' $1')}</th>)}\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                            {loading ? <tr><td colSpan={fields.length}>Cargando...</td></tr> : items.map(item => (\r\n                                <tr key={item.id}>\r\n                                    {fields.map(field => <td key={`${item.id}-${field}`} className=\"px-4 py-2 whitespace-nowrap text-sm\">{item[field]}</td>)}\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                 </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// --- Dashboards Esqueleto para cada Rol ---\r\n\r\n// **CÓDIGO ACTUALIZADO PARA AdminDashboard (FASE 2.2)**\r\nconst AdminDashboard = () => {\r\n    const [view, setView] = useState('projects');\r\n    const [projects, setProjects] = useState([]);\r\n    const [reviewProjects, setReviewProjects] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Esta función unificada se encarga de recargar los datos necesarios\r\n    const refreshData = () => {\r\n        setLoading(true);\r\n        // Carga todos los proyectos para la vista principal\r\n        const qProjects = query(collection(db, \"proyectos\"), orderBy(\"fechaApertura\", \"desc\"));\r\n        const unsubscribeProjects = onSnapshot(qProjects, (querySnapshot) => {\r\n            setProjects(querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));\r\n            setLoading(false); // La carga principal termina aquí\r\n        });\r\n        \r\n        // Carga solo los proyectos en revisión para el contador de la pestaña\r\n        const qReview = query(collection(db, \"proyectos\"), where(\"estado\", \"==\", \"En Revisión Final\"));\r\n        const unsubscribeReview = onSnapshot(qReview, (querySnapshot) => {\r\n            setReviewProjects(querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));\r\n        });\r\n        \r\n        // Devuelve una función para limpiar ambos listeners al desmontar el componente\r\n        return () => {\r\n            unsubscribeProjects();\r\n            unsubscribeReview();\r\n        };\r\n    };\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = refreshData();\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    return (\r\n        <div>\r\n            <div className=\"mb-6 border-b border-gray-200\">\r\n                <nav className=\"-mb-px flex space-x-8\" aria-label=\"Tabs\">\r\n                    <button onClick={() => setView('projects')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'projects' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>Proyectos</button>\r\n                    <button onClick={() => setView('review')} className={`relative whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'review' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>\r\n                        Revisión Final\r\n                        {reviewProjects.length > 0 && <span className=\"absolute top-2 -right-4 ml-2 px-2 py-0.5 text-xs font-bold text-white bg-red-500 rounded-full\">{reviewProjects.length}</span>}\r\n                    </button>\r\n                    <button onClick={() => setView('users')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'users' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>Usuarios</button>\r\n                    <button onClick={() => setView('services')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'services' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>Servicios</button>\r\n                    <button onClick={() => setView('providers')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'providers' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>Proveedores</button>\r\n                </nav>\r\n            </div>\r\n            \r\n            {view === 'users' && <UserManagement onUserAdded={() => {}} />}\r\n            \r\n            {view === 'projects' && (\r\n                <>\r\n                    <NewProjectForm onProjectAdded={refreshData} />\r\n                    <h2 className=\"text-2xl font-bold text-gray-800 my-6\">Todos los Proyectos</h2>\r\n                    {loading ? <p>Cargando tabla...</p> : <ProjectsTable projects={projects} onUpdateProject={refreshData} userRole=\"administrador\" />}\r\n                </>\r\n            )}\r\n\r\n            {view === 'review' && (\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-gray-800 my-6\">Proyectos Pendientes de Aprobación Final</h2>\r\n                    {loading ? <p>Cargando...</p> : reviewProjects.length === 0 ? <p>No hay proyectos en revisión.</p> : <ReviewProjectsTable projects={reviewProjects} onUpdateProject={refreshData} />}\r\n                </div>\r\n            )}\r\n\r\n            {view === 'services' && <DataManagement collectionName=\"servicios\" title=\"Servicios\" fields={['nombre', 'servicioIdNumerico', 'dependencia']} placeholderTexts={['Nombre del Servicio', 'ID Numérico (ej: 0001)', 'Dependencia']} />}\r\n            {view === 'providers' && <DataManagement collectionName=\"proveedores\" title=\"Proveedores\" fields={['nombre', 'proveedorIdNumerico']} placeholderTexts={['Nombre del Proveedor', 'ID Numérico (ej: 01)']} />}\r\n        </div>\r\n    );\r\n};\r\n\r\n// --- Componentes para la Vista de Cliente ---\r\nconst HeyzineViewerModal = ({ url, onClose }) => {\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center z-50\">\r\n            <div className=\"bg-white rounded-lg shadow-xl w-full h-full max-w-6xl max-h-[90vh] flex flex-col\">\r\n                <div className=\"flex justify-between items-center p-4 border-b\">\r\n                    <h3 className=\"text-lg font-bold\">Visor de Documentos</h3>\r\n                    <button onClick={onClose} className=\"text-gray-600 hover:text-gray-900 text-2xl font-bold\">&times;</button>\r\n                </div>\r\n                <div className=\"flex-grow\">\r\n                    <iframe src={url} title=\"Visor de Heyzine\" className=\"w-full h-full\" frameBorder=\"0\" allowFullScreen></iframe>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst ProjectsShelf = ({ projects, onOpenModal }) => {\r\n    const finishedProjects = projects.filter(p => p.estadoCliente === 'Terminado' && (p.urlDocumento1 || p.urlDocumento2));\r\n    const coverTemplateUrl = \"https://firebasestorage.googleapis.com/v0/b/portal-evelsa.firebasestorage.app/o/portada%20Carpetas.jpeg?alt=media&token=417eb65c-1694-4efc-9e2a-55528d43a8d6\";\r\n\r\n    return (\r\n        <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-8\">\r\n            {finishedProjects.map(project => (\r\n                <button key={project.id} className=\"group text-left focus:outline-none\" onClick={() => onOpenModal(project.urlDocumento2 || project.urlDocumento1)}>\r\n                    <div className=\"relative pt-[141%] bg-gray-200 rounded-lg shadow-lg group-hover:shadow-2xl transition-all duration-300 transform group-hover:-translate-y-1 overflow-hidden\">\r\n                        <img src={coverTemplateUrl} alt=\"Portada de proyecto\" className=\"absolute inset-0 w-full h-full object-cover\"/>\r\n                        <div className=\"absolute inset-0 bg-black bg-opacity-40\"></div>\r\n                        <div className=\"absolute inset-0 flex flex-col justify-center items-center p-4 text-white text-center\">\r\n                            <h4 className=\"font-bold text-lg leading-tight\">{project.clienteNombre}</h4>\r\n                            <hr className=\"w-1/4 my-2 border-gray-400\"/>\r\n                            <p className=\"text-sm\">{project.servicioNombre}</p>\r\n                        </div>\r\n                    </div>\r\n                    <p className=\"text-sm font-semibold text-gray-700 mt-3 truncate group-hover:text-blue-600\">{project.servicioNombre}</p>\r\n                </button>\r\n            ))}\r\n        </div>\r\n    );\r\n};\r\n\r\n// **CÓDIGO COMPLETO Y CORREGIDO PARA NewProjectForm**\r\nconst NewProjectForm = ({ onProjectAdded }) => {\r\n    const [formData, setFormData] = useState({ \r\n        clienteId: '', \r\n        servicioId: '', \r\n        proveedorId: '', \r\n        comentariosApertura: '',\r\n        fechaApertura: new Date().toISOString().split('T')[0],\r\n        precioCotizacionCliente: '',\r\n        costoProveedor: ''\r\n    });\r\n    const [files, setFiles] = useState({\r\n        cotizacionClienteFile: null,\r\n        poClienteFile: null,\r\n        cotizacionProveedorFile: null,\r\n        poProveedorFile: null\r\n    });\r\n    const formRef = React.useRef(null);\r\n\r\n    const [collections, setCollections] = useState({ clientes: [], servicios: [], proveedores: [] });\r\n    const [error, setError] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // **LÓGICA MEJORADA**: La comparación ahora es más robusta y flexible\r\n    const isInternalProvider = collections.proveedores.find(p => p.id === formData.proveedorId)?.nombre.toLowerCase().trim() === \"ecologia y asesoria ambiental\";\r\n\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            try {\r\n                const [clientesSnap, serviciosSnap, proveedoresSnap] = await Promise.all([\r\n                    getDocs(query(collection(db, \"usuarios\"), where(\"rol\", \"==\", \"cliente\"))),\r\n                    getDocs(collection(db, \"servicios\")),\r\n                    getDocs(collection(db, \"proveedores\"))\r\n                ]);\r\n                const sortByName = (a, b) => (a.nombreCompleto || a.nombre).localeCompare(b.nombreCompleto || b.nombre);\r\n                setCollections({\r\n                    clientes: clientesSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort(sortByName),\r\n                    servicios: serviciosSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort(sortByName),\r\n                    proveedores: proveedoresSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })).sort(sortByName)\r\n                });\r\n            } catch (e) {\r\n                setError(\"Error al cargar datos maestros.\");\r\n            }\r\n        };\r\n        fetchData();\r\n    }, []);\r\n    \r\n    useEffect(() => {\r\n        if (isInternalProvider) {\r\n            setFormData(prev => ({ ...prev, costoProveedor: '0' }));\r\n        }\r\n    }, [formData.proveedorId, isInternalProvider]);\r\n\r\n\r\n    const handleChange = (e) => {\r\n        const { name, value } = e.target;\r\n        setFormData(prev => ({ ...prev, [name]: value }));\r\n    };\r\n    \r\n    const handleFileChange = (e) => {\r\n        const { name, files: inputFiles } = e.target;\r\n        if (inputFiles[0]) {\r\n            setFiles(prev => ({ ...prev, [name]: inputFiles[0] }));\r\n        }\r\n    };\r\n\r\n    const uploadFile = async (file, path) => {\r\n        if (!file) return null;\r\n        const storageRef = ref(storage, path);\r\n        const uploadTask = uploadBytesResumable(storageRef, file);\r\n        await uploadTask;\r\n        return await getDownloadURL(uploadTask.snapshot.ref);\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (!formData.clienteId || !formData.servicioId || !formData.proveedorId) {\r\n            setError('Cliente, Servicio y Proveedor son obligatorios.');\r\n            return;\r\n        }\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        try {\r\n            const urlCotizacionCliente = await uploadFile(files.cotizacionClienteFile, `cotizaciones_clientes/${Date.now()}_${files.cotizacionClienteFile?.name}`);\r\n            const urlPOCliente = await uploadFile(files.poClienteFile, `po_clientes/${Date.now()}_${files.poClienteFile?.name}`);\r\n            const urlCotizacionProveedor = await uploadFile(files.cotizacionProveedorFile, `cotizaciones_proveedores/${Date.now()}_${files.cotizacionProveedorFile?.name}`);\r\n            const urlPOProveedor = await uploadFile(files.poProveedorFile, `po_proveedores/${Date.now()}_${files.poProveedorFile?.name}`);\r\n\r\n            const anioActual = new Date(formData.fechaApertura).getFullYear();\r\n            const contadorRef = doc(db, \"contadores\", `proyectos_${anioActual}`);\r\n            const nuevoConsecutivo = await runTransaction(db, async (transaction) => {\r\n                const contadorDoc = await transaction.get(contadorRef);\r\n                const nuevoValor = (contadorDoc.exists() ? contadorDoc.data().consecutivo : 0) + 1;\r\n                transaction.set(contadorRef, { consecutivo: nuevoValor }, { merge: true });\r\n                return nuevoValor;\r\n            });\r\n            \r\n            const ultimosDosDigitosAnio = anioActual.toString().slice(-2);\r\n            const consecutivoFormateado = nuevoConsecutivo.toString().padStart(3, '0');\r\n            \r\n            const cliente = collections.clientes.find(c => c.id === formData.clienteId);\r\n            const servicio = collections.servicios.find(s => s.id === formData.servicioId);\r\n            const proveedor = collections.proveedores.find(p => p.id === formData.proveedorId);\r\n\r\n            const npu = `${cliente.clienteIdNumerico}-${servicio.servicioIdNumerico}-${proveedor.proveedorIdNumerico}-${consecutivoFormateado}${ultimosDosDigitosAnio}`;\r\n            const poProveedorAuto = isInternalProvider ? \"N/A\" : npu.slice(-8);\r\n            const estadoInicial = urlPOCliente ? 'Activo' : 'Cotización';\r\n\r\n            await addDoc(collection(db, \"proyectos\"), {\r\n                fechaApertura: Timestamp.fromDate(new Date(formData.fechaApertura)),\r\n                npu,\r\n                clienteId: formData.clienteId,\r\n                clienteNombre: cliente.nombreCompleto,\r\n                servicioId: formData.servicioId,\r\n                servicioNombre: servicio.nombre,\r\n                proveedorId: formData.proveedorId,\r\n                proveedorNombre: proveedor.nombre,\r\n                comentariosApertura: formData.comentariosApertura,\r\n                estado: estadoInicial,\r\n                estadoCliente: estadoInicial,\r\n                dependencia: servicio.dependencia || 'Sin Dependencia',\r\n                asignadoTecnicosIds: [],\r\n                tecnicosStatus: {},\r\n                precioCotizacionCliente: Number(formData.precioCotizacionCliente) || 0,\r\n                urlCotizacionCliente: urlCotizacionCliente || '',\r\n                urlPOCliente: urlPOCliente || '',\r\n                costoProveedor: Number(formData.costoProveedor) || 0,\r\n                poProveedor: poProveedorAuto,\r\n                urlCotizacionProveedor: urlCotizacionProveedor || '',\r\n                urlPOProveedor: urlPOProveedor || '',\r\n            });\r\n            \r\n            setFormData({ clienteId: '', servicioId: '', proveedorId: '', comentariosApertura: '', fechaApertura: new Date().toISOString().split('T')[0], precioCotizacionCliente: '', costoProveedor: '' });\r\n            formRef.current.reset();\r\n            if (onProjectAdded) onProjectAdded();\r\n\r\n        } catch (err) {\r\n            console.error(\"Error al crear proyecto:\", err);\r\n            setError(`Ocurrió un error: ${err.message}`);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    return (\r\n        <div className=\"bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-8\">\r\n            <h3 className=\"text-xl font-bold text-gray-800 mb-4\">Crear Nuevo Proyecto</h3>\r\n            <form ref={formRef} onSubmit={handleSubmit} className=\"space-y-6\">\r\n                <div className=\"space-y-4\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700\">Fecha de Apertura</label>\r\n                        <input type=\"date\" name=\"fechaApertura\" value={formData.fechaApertura} onChange={handleChange} className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                    </div>\r\n                     <select name=\"clienteId\" value={formData.clienteId} onChange={handleChange} className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\">\r\n                        <option value=\"\">Seleccione un Cliente</option>\r\n                        {collections.clientes.map(c => <option key={c.id} value={c.id}>{c.nombreCompleto}</option>)}\r\n                     </select>\r\n                     <select name=\"servicioId\" value={formData.servicioId} onChange={handleChange} className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\">\r\n                        <option value=\"\">Seleccione un Proyecto/Servicio</option>\r\n                        {collections.servicios.map(s => <option key={s.id} value={s.id}>{s.nombre}</option>)}\r\n                     </select>\r\n                     <select name=\"proveedorId\" value={formData.proveedorId} onChange={handleChange} className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\">\r\n                        <option value=\"\">Seleccione un Proveedor</option>\r\n                        {collections.proveedores.map(p => <option key={p.id} value={p.id}>{p.nombre}</option>)}\r\n                     </select>\r\n                    <textarea name=\"comentariosApertura\" value={formData.comentariosApertura} onChange={handleChange} placeholder=\"Comentarios de apertura\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"></textarea>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 border-t pt-6\">\r\n                    <div className=\"space-y-4\">\r\n                        <h4 className=\"font-semibold text-gray-700\">Información del Cliente</h4>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">Precio Cotización (sin IVA)</label>\r\n                            <input type=\"number\" name=\"precioCotizacionCliente\" value={formData.precioCotizacionCliente} onChange={handleChange} placeholder=\"0.00\" className=\"mt-1 block w-full px-3 py-2 border rounded-md\"/>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">PDF Cotización</label>\r\n                            <input type=\"file\" name=\"cotizacionClienteFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">PDF Orden de Compra (PO)</label>\r\n                            <input type=\"file\" name=\"poClienteFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"space-y-4\">\r\n                        <h4 className=\"font-semibold text-gray-700\">Información del Proveedor</h4>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">Costo (sin IVA)</label>\r\n                            <input type=\"number\" name=\"costoProveedor\" value={formData.costoProveedor} onChange={handleChange} placeholder=\"0.00\" disabled={isInternalProvider} className=\"mt-1 block w-full px-3 py-2 border rounded-md disabled:bg-gray-100\"/>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">{isInternalProvider ? 'Número de Proyecto' : 'PDF Cotización Proveedor'}</label>\r\n                            <input type=\"file\" name=\"cotizacionProveedorFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">PDF Orden de Compra (PO) Proveedor</label>\r\n                            <input type=\"file\" name=\"poProveedorFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <Alert message={error} type=\"error\" onClose={() => setError('')} />\r\n                <button type=\"submit\" disabled={loading} className=\"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg disabled:bg-gray-400\">\r\n                    {loading ? 'Creando...' : 'Crear Proyecto y Generar NPU'}\r\n                </button>\r\n            </form>\r\n        </div>\r\n    );\r\n};\r\n\r\n// **CÓDIGO ACTUALIZADO PARA ProjectsTable (CON MODAL DE BORRADO)**\r\nconst ProjectsTable = ({ projects, onUpdateProject, userRole, user, userData }) => {\r\n    const [modalProject, setModalProject] = useState(null);\r\n    const [modalType, setModalType] = useState('');\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const [itemsPerPage, setItemsPerPage] = useState(10);\r\n    const [techniciansMap, setTechniciansMap] = useState({});\r\n    const [invoicesMap, setInvoicesMap] = useState({});\r\n    const [confirmingAction, setConfirmingAction] = useState(null); // Estado para confirmaciones\r\n\r\n\r\n    useEffect(() => {\r\n        const fetchExtraData = () => {\r\n            const qTechs = query(collection(db, \"usuarios\"), where(\"rol\", \"==\", \"tecnico\"));\r\n            const unsubTechs = onSnapshot(qTechs, (snapshot) => {\r\n                const techMap = {};\r\n                snapshot.forEach(doc => { techMap[doc.id] = doc.data().nombreCompleto; });\r\n                setTechniciansMap(techMap);\r\n            });\r\n\r\n            const qInvoices = query(collection(db, \"facturas\"));\r\n            const unsubInvoices = onSnapshot(qInvoices, (snapshot) => {\r\n                const invMap = {};\r\n                snapshot.forEach(doc => { invMap[doc.id] = doc.data().folio; });\r\n                setInvoicesMap(invMap);\r\n            });\r\n\r\n            return () => {\r\n                unsubTechs();\r\n                unsubInvoices();\r\n            };\r\n        };\r\n        const unsubscribe = fetchExtraData();\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    const ManageProjectModal = ({ project, onClose, onFinalized }) => {\r\n        const [files, setFiles] = useState({ cotizacionClienteFile: null, poClienteFile: null, cotizacionProveedorFile: null, poProveedorFile: null });\r\n        const [loading, setLoading] = useState(false);\r\n        const [error, setError] = useState('');\r\n\r\n        const handleFileChange = (e) => {\r\n            const { name, files: inputFiles } = e.target;\r\n            if (inputFiles[0]) setFiles(prev => ({ ...prev, [name]: inputFiles[0] }));\r\n        };\r\n\r\n        const uploadFile = async (file, path) => {\r\n            if (!file) return null;\r\n            const storageRef = ref(storage, path);\r\n            const uploadTask = uploadBytesResumable(storageRef, file);\r\n            await uploadTask;\r\n            return await getDownloadURL(uploadTask.snapshot.ref);\r\n        };\r\n\r\n        const handleSave = async () => {\r\n            setLoading(true);\r\n            setError('');\r\n            try {\r\n                const updatePayload = {};\r\n                const urlCotizacionCliente = await uploadFile(files.cotizacionClienteFile, `cotizaciones_clientes/${Date.now()}_${files.cotizacionClienteFile?.name}`);\r\n                const urlPOCliente = await uploadFile(files.poClienteFile, `po_clientes/${Date.now()}_${files.poClienteFile?.name}`);\r\n                const urlCotizacionProveedor = await uploadFile(files.cotizacionProveedorFile, `cotizaciones_proveedores/${Date.now()}_${files.cotizacionProveedorFile?.name}`);\r\n                const urlPOProveedor = await uploadFile(files.poProveedorFile, `po_proveedores/${Date.now()}_${files.poProveedorFile?.name}`);\r\n\r\n                if(urlCotizacionCliente) updatePayload.urlCotizacionCliente = urlCotizacionCliente;\r\n                if(urlPOCliente) updatePayload.urlPOCliente = urlPOCliente;\r\n                if(urlCotizacionProveedor) updatePayload.urlCotizacionProveedor = urlCotizacionProveedor;\r\n                if(urlPOProveedor) updatePayload.urlPOProveedor = urlPOProveedor;\r\n\r\n                if (urlPOCliente) {\r\n                    updatePayload.estado = 'Activo';\r\n                    updatePayload.estadoCliente = 'Activo';\r\n                }\r\n\r\n                if (Object.keys(updatePayload).length > 0) {\r\n                    await updateDoc(doc(db, \"proyectos\", project.id), updatePayload);\r\n                }\r\n                \r\n                onFinalized();\r\n                onClose();\r\n            } catch (err) {\r\n                setError(\"Error al subir documentos.\");\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n                <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\">\r\n                    <h3 className=\"text-lg font-bold mb-4\">Gestionar Documentos: {project.npu}</h3>\r\n                    <div className=\"space-y-4\">\r\n                        <div><label className=\"block text-sm font-medium\">PDF Cotización Cliente</label>{project.urlCotizacionCliente ? <a href={project.urlCotizacionCliente} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500 text-sm\">Ver actual</a> : <input type=\"file\" name=\"cotizacionClienteFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>}</div>\r\n                        <div><label className=\"block text-sm font-medium\">PDF Orden de Compra (PO) Cliente</label>{project.urlPOCliente ? <a href={project.urlPOCliente} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500 text-sm\">Ver actual</a> : <input type=\"file\" name=\"poClienteFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>}</div>\r\n                        <div><label className=\"block text-sm font-medium\">PDF Cotización Proveedor</label>{project.urlCotizacionProveedor ? <a href={project.urlCotizacionProveedor} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500 text-sm\">Ver actual</a> : <input type=\"file\" name=\"cotizacionProveedorFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>}</div>\r\n                        <div><label className=\"block text-sm font-medium\">PDF Orden de Compra (PO) Proveedor</label>{project.urlPOProveedor ? <a href={project.urlPOProveedor} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500 text-sm\">Ver actual</a> : <input type=\"file\" name=\"poProveedorFile\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>}</div>\r\n                    </div>\r\n                    <Alert message={error} type=\"error\" onClose={() => setError('')} />\r\n                    <div className=\"mt-6 flex justify-end space-x-3\"><button onClick={onClose} disabled={loading} className=\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\">Cancelar</button><button onClick={handleSave} disabled={loading} className=\"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded\">{loading ? 'Guardando...' : 'Guardar Cambios'}</button></div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n    \r\n    const AssignProjectModal = ({ project, onClose, onFinalized }) => {\r\n        const [technicians, setTechnicians] = useState([]);\r\n        const [selectedTechnicians, setSelectedTechnicians] = useState(project.asignadoTecnicosIds || []);\r\n        const [deliveryDate, setDeliveryDate] = useState(project.fechaEntregaInterna ? project.fechaEntregaInterna.toDate().toISOString().split('T')[0] : '');\r\n        const [loading, setLoading] = useState(false);\r\n\r\n        useEffect(() => {\r\n            const fetchTechnicians = async () => {\r\n                const q = query(collection(db, \"usuarios\"), where(\"rol\", \"==\", \"tecnico\"));\r\n                const querySnapshot = await getDocs(q);\r\n                setTechnicians(querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));\r\n            };\r\n            fetchTechnicians();\r\n        }, []);\r\n\r\n        const handleCheckboxChange = (techId) => {\r\n            setSelectedTechnicians(prev => \r\n                prev.includes(techId) ? prev.filter(id => id !== techId) : [...prev, techId]\r\n            );\r\n        };\r\n\r\n        const handleSave = async () => {\r\n            setLoading(true);\r\n            const projectRef = doc(db, \"proyectos\", project.id);\r\n            \r\n            const tecnicosStatus = {};\r\n            selectedTechnicians.forEach(techId => {\r\n                tecnicosStatus[techId] = project.tecnicosStatus?.[techId] || \"No Visto\";\r\n            });\r\n\r\n            await updateDoc(projectRef, {\r\n                asignadoTecnicosIds: selectedTechnicians,\r\n                tecnicosStatus: tecnicosStatus,\r\n                fechaAsignacionTecnico: Timestamp.now(),\r\n                fechaEntregaInterna: deliveryDate ? Timestamp.fromDate(new Date(deliveryDate)) : null\r\n            });\r\n            setLoading(false);\r\n            onFinalized();\r\n            onClose();\r\n        };\r\n\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n                <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-md\">\r\n                    <h3 className=\"text-lg font-bold mb-4\">Asignar Proyecto: {project.npu}</h3>\r\n                    <div className=\"space-y-4\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700\">Técnicos Disponibles</label>\r\n                            <div className=\"mt-2 max-h-48 overflow-y-auto border rounded-md p-2\">\r\n                                {technicians.map(tech => (\r\n                                    <div key={tech.id} className=\"flex items-center\">\r\n                                        <input \r\n                                            type=\"checkbox\" \r\n                                            id={tech.id} \r\n                                            checked={selectedTechnicians.includes(tech.id)}\r\n                                            onChange={() => handleCheckboxChange(tech.id)}\r\n                                            className=\"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500\"\r\n                                        />\r\n                                        <label htmlFor={tech.id} className=\"ml-3 text-sm text-gray-700\">{tech.nombreCompleto}</label>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700\">Fecha Límite de Entrega (Interna)</label>\r\n                            <input type=\"date\" value={deliveryDate} onChange={e => setDeliveryDate(e.target.value)} className=\"mt-1 block w-full px-3 py-2 border rounded-md\"/>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"mt-6 flex justify-end space-x-3\">\r\n                        <button onClick={onClose} disabled={loading} className=\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\">Cancelar</button>\r\n                        <button onClick={handleSave} disabled={loading} className=\"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded\">{loading ? 'Asignando...' : 'Guardar Asignación'}</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const filteredProjects = projects.filter(p => \r\n        (p.npu && p.npu.toLowerCase().includes(searchTerm.toLowerCase())) ||\r\n        (p.clienteNombre && p.clienteNombre.toLowerCase().includes(searchTerm.toLowerCase())) ||\r\n        (p.servicioNombre && p.servicioNombre.toLowerCase().includes(searchTerm.toLowerCase()))\r\n    );\r\n\r\n    const currentItems = filteredProjects.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);\r\n    const totalPages = Math.ceil(filteredProjects.length / itemsPerPage);\r\n\r\n    const paginate = (pageNumber) => setCurrentPage(pageNumber);\r\n    // **FUNCIÓN CORREGIDA PARA MANEJAR ZONAS HORARIAS**\r\n    const formatDate = (timestamp) => {\r\n        if (!timestamp) return '---';\r\n        const date = timestamp.toDate();\r\n        // Ajuste para corregir el desfase de la zona horaria\r\n        const userTimezoneOffset = date.getTimezoneOffset() * 60000;\r\n        const adjustedDate = new Date(date.getTime() + userTimezoneOffset);\r\n        return adjustedDate.toLocaleDateString('es-MX', {\r\n            year: 'numeric', month: '2-digit', day: '2-digit'\r\n        });\r\n    };\r\n\r\n    // **FUNCIÓN RESTAURADA**\r\n    const getDueDateColor = (timestamp) => {\r\n        if (!timestamp) return 'text-gray-500';\r\n        const dueDate = timestamp.toDate();\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        \r\n        const diffTime = dueDate.getTime() - today.getTime();\r\n        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n        if (diffDays < 0) return 'text-red-600 font-bold'; // Vencido\r\n        if (diffDays <= 3) return 'text-orange-500 font-semibold'; // Por vencer\r\n        return 'text-gray-600'; // Normal\r\n    };\r\n\r\n    const handleActivateProject = async (projectId) => {\r\n        await updateDoc(doc(db, \"proyectos\", projectId), { estado: 'Activo', estadoCliente: 'Activo' });\r\n    };\r\n\r\n    const handleDeleteProject = async (projectId) => {\r\n        await deleteDoc(doc(db, \"proyectos\", projectId));\r\n        setConfirmingAction(null); // Cierra el modal\r\n    };\r\n\r\n    const promptDeleteProject = (projectId, projectNpu) => {\r\n        setConfirmingAction({\r\n            title: \"Confirmar Eliminación\",\r\n            message: `¿Estás seguro de que quieres borrar el proyecto ${projectNpu}? Esta acción no se puede deshacer.`,\r\n            onConfirm: () => handleDeleteProject(projectId),\r\n            confirmText: \"Sí, Borrar\",\r\n            confirmColor: \"bg-red-600\"\r\n        });\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <div className=\"mb-4 flex flex-col md:flex-row justify-between items-center\">\r\n                <input \r\n                    type=\"text\"\r\n                    placeholder=\"Buscar por NPU, cliente, servicio o dependencia...\"\r\n                    className=\"w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md mb-2 md:mb-0\"\r\n                    onChange={(e) => { setSearchTerm(e.target.value); setCurrentPage(1); }}\r\n                />\r\n                <div className=\"flex items-center\">\r\n                    <span className=\"text-sm mr-2\">Mostrar:</span>\r\n                    <select value={itemsPerPage} onChange={(e) => { setItemsPerPage(Number(e.target.value)); setCurrentPage(1); }} className=\"px-2 py-1 border border-gray-300 rounded-md\">\r\n                        <option value={10}>10</option><option value={25}>25</option><option value={50}>50</option><option value={100}>100</option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"overflow-x-auto bg-white rounded-lg shadow\">\r\n                <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-50\">\r\n                        <tr>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Fecha Apertura</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">NPU</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Cliente</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Servicio</th>\r\n                            {userRole === 'administrador' && (\r\n                                <>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Proveedor</th>\r\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Nº Proy. Lab.</th>\r\n                                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Comentarios</th>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">PO Prov.</th>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Precio</th>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Costo</th>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Docs Cliente</th>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Docs Proveedor</th>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Fact. Cliente</th>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Fact. Proveedor</th>\r\n                                </>\r\n                            )}\r\n                            {userRole === 'supervisor' && (\r\n                                <>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Fecha Límite</th>\r\n                                    <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Estado Técnicos</th>\r\n                                </>\r\n                            )}\r\n                            <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Estado</th>\r\n                            <th className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Acciones</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                        {currentItems.map(project => {\r\n                            const isAssigned = project.asignadoTecnicosIds && project.asignadoTecnicosIds.length > 0;\r\n                            return (\r\n                                 <tr key={project.id}>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{formatDate(project.fechaApertura)}</td>\r\n                                    <td className=\"px-4 py-2 whitespace-nowrap text-sm font-medium\">{project.npu}</td>\r\n                                    <td className=\"px-4 py-2 whitespace-nowrap text-sm\">{project.clienteNombre}</td>\r\n                                    <td className=\"px-4 py-2 whitespace-nowrap text-sm\">{project.servicioNombre}</td>\r\n                                    {userRole === 'administrador' && (\r\n                                        <>\r\n                                            <td className=\"px-4 py-2 whitespace-nowrap text-sm\">{project.proveedorNombre}</td>\r\n                                            <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.numeroProyectoLaboratorio || '---'}</td>\r\n                                            <td className=\"px-6 py-4 text-sm text-gray-500\" title={project.comentariosApertura}>\r\n                                                <p className=\"w-32 truncate\">{project.comentariosApertura || '---'}</p>\r\n                                            </td>\r\n                                            <td className=\"px-4 py-2 whitespace-nowrap text-sm\">{project.poProveedor}</td>\r\n                                            <td className=\"px-4 py-2 whitespace-nowrap text-sm text-green-600\">${(project.precioCotizacionCliente || 0).toFixed(2)}</td>\r\n                                            <td className=\"px-4 py-2 whitespace-nowrap text-sm text-red-600\">${(project.costoProveedor || 0).toFixed(2)}</td>\r\n                                            <td className=\"px-4 py-2\"><div className=\"flex space-x-2\">{project.urlCotizacionCliente && <a href={project.urlCotizacionCliente} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500\">Cot</a>}{project.urlPOCliente && <a href={project.urlPOCliente} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500\">PO</a>}</div></td>\r\n                                            <td className=\"px-4 py-2\"><div className=\"flex space-x-2\">{project.urlCotizacionProveedor && <a href={project.urlCotizacionProveedor} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500\">Cot</a>}{project.urlPOProveedor && <a href={project.urlPOProveedor} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500\">PO</a>}</div></td>\r\n                                            <td className=\"px-4 py-2 whitespace-nowrap text-sm\">{invoicesMap[project.facturaClienteId] || '---'}</td>\r\n                                            <td className=\"px-4 py-2 whitespace-nowrap text-sm\">{invoicesMap[project.facturaProveedorId] || (project.proveedorNombre?.toLowerCase().trim() === \"ecología y asesoría ambiental\" ? 'N/A' : '---')}</td>\r\n                                        </>\r\n                                    )}\r\n                                    {userRole === 'supervisor' && (\r\n                                        <>\r\n                                            <td className=\"px-4 py-2 whitespace-nowrap text-sm\"><span className={getDueDateColor(project.fechaEntregaInterna)}>{formatDate(project.fechaEntregaInterna)}</span></td>\r\n                                            <td className=\"px-4 py-2 whitespace-nowrap text-sm\">\r\n                                                <div className=\"flex flex-col space-y-1\">\r\n                                                    {(project.asignadoTecnicosIds || []).map(techId => {\r\n                                                        const status = project.tecnicosStatus ? (project.tecnicosStatus[techId] || 'No Visto') : 'No Visto';\r\n                                                        const statusClass = status === 'En Proceso' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600';\r\n                                                        return (<span key={techId} className={`text-xs p-1 rounded ${statusClass}`}>{techniciansMap[techId] || 'Cargando...'}: {status}</span>);\r\n                                                    })}\r\n                                                </div>\r\n                                            </td>\r\n                                        </>\r\n                                    )}\r\n                                    <td className=\"px-4 py-2\"><span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${project.estado === 'Activo' ? 'bg-orange-100 text-orange-800' : 'bg-gray-100 text-gray-800'}`}>{project.estado}</span></td>\r\n                                    <td className=\"px-4 py-2\">\r\n                                        <div className=\"flex items-center space-x-4\">\r\n                                            {userRole === 'administrador' && project.estado === 'Cotización' && <button onClick={() => handleActivateProject(project.id)} className=\"text-green-600\">Activar</button>}\r\n                                            {userRole === 'administrador' && <button onClick={() => { setModalProject(project); setModalType('manage'); }} className=\"text-indigo-600\">Gestionar</button>}\r\n                                            {userRole === 'administrador' && project.estado !== 'Terminado' && project.estado !== 'Archivado' && <button onClick={() => promptDeleteProject(project.id, project.npu)} className=\"text-red-600\">Borrar</button>}\r\n                                            \r\n                                            {userRole === 'supervisor' && <button onClick={() => { setModalProject(project); setModalType('assign'); }} className=\"text-indigo-600\">{isAssigned ? 'Reasignar' : 'Asignar'}</button>}\r\n                                            {userRole === 'supervisor' && isAssigned && <button onClick={() => { setModalProject(project); setModalType('log'); }} className=\"text-gray-600\">Bitácora</button>}\r\n                                        </div>\r\n                                    </td>\r\n                                </tr>\r\n                            );\r\n                        })}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            <div className=\"mt-4 flex justify-between items-center\">\r\n                <span className=\"text-sm text-gray-700\">Página {currentPage} de {totalPages}</span>\r\n                <div>\r\n                    <button onClick={() => paginate(currentPage - 1)} disabled={currentPage === 1} className=\"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50\">Anterior</button>\r\n                    <button onClick={() => paginate(currentPage + 1)} disabled={currentPage === totalPages || totalPages === 0} className=\"px-3 py-1 border rounded-md bg-white disabled:opacity-50\">Siguiente</button>\r\n                </div>\r\n            </div>\r\n            {modalProject && modalType === 'assign' && <AssignProjectModal project={modalProject} onClose={() => setModalProject(null)} onFinalized={onUpdateProject} />}\r\n            {modalProject && modalType === 'manage' && <ManageProjectModal project={modalProject} onClose={() => setModalProject(null)} onFinalized={onUpdateProject} />}\r\n            {modalProject && modalType === 'log' && <ProjectLogModal project={modalProject} user={user} userData={userData} onClose={() => setModalProject(null)} />}\r\n            {confirmingAction && (\r\n                <ConfirmationModal \r\n                    title={confirmingAction.title}\r\n                    message={confirmingAction.message}\r\n                    onConfirm={confirmingAction.onConfirm}\r\n                    onCancel={() => setConfirmingAction(null)}\r\n                    confirmText={confirmingAction.confirmText}\r\n                    confirmColor={confirmingAction.confirmColor}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\n// **CÓDIGO ACTUALIZADO PARA ReviewProjectsTable (CON MODALES CORREGIDOS)**\r\nconst ReviewProjectsTable = ({ projects, onUpdateProject }) => {\r\n    const [confirmingAction, setConfirmingAction] = useState(null);\r\n\r\n    // El handler de APROBACIÓN ahora lee el proyecto directamente desde el estado 'confirmingAction'\r\n    const handleApprove = async () => {\r\n        if (!confirmingAction || confirmingAction.action !== 'approve') return;\r\n        \r\n        const { project } = confirmingAction.payload; // Se obtiene el proyecto del estado\r\n        const projectRef = doc(db, \"proyectos\", project.id);\r\n        const isFinalDelivery = !!project.urlDocumento2;\r\n\r\n        try {\r\n            if (isFinalDelivery) {\r\n                if (project.faseFacturacion === 'Preliminar' || project.faseFacturacion === 'Fase 2 Pendiente') {\r\n                    await updateDoc(projectRef, { estado: 'Archivado', estadoCliente: 'Terminado' });\r\n                } else {\r\n                    await updateDoc(projectRef, { estado: 'Pendiente de Factura', estadoCliente: 'Terminado' });\r\n                }\r\n            } else {\r\n                await updateDoc(projectRef, { estado: 'Pendiente de Factura', faseFacturacion: 'Preliminar' });\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error al aprobar proyecto:\", error);\r\n            alert(\"Ocurrió un error al aprobar el proyecto.\");\r\n        } finally {\r\n            setConfirmingAction(null); // Cierra el modal\r\n            onUpdateProject(); // Refresca la tabla\r\n        }\r\n    };\r\n\r\n    // El handler de RECHAZO ahora solo necesita el 'motivo', ya que obtiene el ID del estado\r\n    const handleReject = async (reason) => {\r\n        if (!confirmingAction || confirmingAction.action !== 'reject') return;\r\n        \r\n        if (!reason || reason.trim() === '') {\r\n            alert(\"El motivo del rechazo no puede estar vacío.\");\r\n            return; // No cierra el modal para que el usuario pueda escribir el motivo.\r\n        }\r\n\r\n        const { projectId } = confirmingAction.payload; // Se obtiene el ID del estado\r\n        const projectRef = doc(db, \"proyectos\", projectId);\r\n        \r\n        try {\r\n            await updateDoc(projectRef, { estado: 'Terminado Internamente', motivoRechazo: reason });\r\n        } catch (error) {\r\n            console.error(\"Error al rechazar proyecto:\", error);\r\n            alert(\"Ocurrió un error al rechazar el proyecto.\");\r\n        } finally {\r\n            setConfirmingAction(null); // Cierra el modal\r\n            onUpdateProject(); // Refresca la tabla\r\n        }\r\n    };\r\n\r\n    // La función que abre el modal de aprobación ahora solo guarda los datos necesarios en el estado.\r\n    const promptApprove = (project) => {\r\n        const isFinalDelivery = !!project.urlDocumento2;\r\n        const hasBeenBilled = project.faseFacturacion === 'Preliminar' || project.faseFacturacion === 'Fase 2 Pendiente';\r\n        \r\n        const confirmationMessage = isFinalDelivery \r\n            ? (hasBeenBilled ? \"Aprobar y finalizar este proyecto? Se archivará y no se volverá a facturar.\" : \"Aprobar esta entrega final y enviarla a facturación?\")\r\n            : \"Aprobar esta entrega preliminar y enviarla a facturación?\";\r\n        \r\n        setConfirmingAction({\r\n            action: 'approve',\r\n            payload: { project }, // Guardamos el objeto de proyecto completo\r\n            title: \"Confirmar Aprobación\",\r\n            message: confirmationMessage,\r\n        });\r\n    };\r\n\r\n    // La función que abre el modal de rechazo guarda solo el ID.\r\n    const promptReject = (projectId) => {\r\n        setConfirmingAction({\r\n            action: 'reject',\r\n            payload: { projectId }, // Guardamos el ID del proyecto\r\n            title: \"Rechazar Proyecto\",\r\n            message: \"Por favor, introduce el motivo del rechazo para notificar al practicante.\",\r\n            confirmText: \"Rechazar\",\r\n            confirmColor: \"bg-orange-600\"\r\n        });\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <div className=\"overflow-x-auto bg-white rounded-lg shadow\">\r\n                <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-50\">\r\n                        <tr>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">NPU</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Servicio</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Documentos Finales</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Acciones</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                        {projects.map(project => (\r\n                             <tr key={project.id}>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.npu}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.servicioNombre}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\r\n                                    <div className=\"flex flex-col space-y-1\">\r\n                                        {project.urlHeyzine && <a href={project.urlHeyzine} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600\">Ver Proyecto (Heyzine)</a>}\r\n                                        {project.urlNotaPdf1 && <a href={project.urlNotaPdf1} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-red-600\">Ver Nota 1</a>}\r\n                                        {project.urlNotaPdf2 && <a href={project.urlNotaPdf2} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-red-600\">Ver Nota 2</a>}\r\n                                    </div>\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                                    <div className=\"flex space-x-4\">\r\n                                        {/* Los botones ahora llaman a las funciones 'prompt' correctas */}\r\n                                        <button onClick={() => promptApprove(project)} className=\"text-green-600 hover:text-green-900\">Aprobar</button>\r\n                                        <button onClick={() => promptReject(project.id)} className=\"text-orange-600 hover:text-orange-900\">Rechazar</button>\r\n                                    </div>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            {/* El JSX para renderizar los modales ahora es más limpio y correcto. */}\r\n            {confirmingAction?.action === 'approve' && (\r\n                <ConfirmationModal \r\n                    title={confirmingAction.title}\r\n                    message={confirmingAction.message}\r\n                    onConfirm={handleApprove} // Llama directamente al handler de aprobación\r\n                    onCancel={() => setConfirmingAction(null)}\r\n                />\r\n            )}\r\n            \r\n            {confirmingAction?.action === 'reject' && (\r\n                <ActionWithReasonModal \r\n                    title={confirmingAction.title}\r\n                    message={confirmingAction.message}\r\n                    onConfirm={handleReject} // Llama directamente al handler de rechazo, que recibirá 'reason'\r\n                    onCancel={() => setConfirmingAction(null)}\r\n                    confirmText={confirmingAction.confirmText}\r\n                    confirmColor={confirmingAction.confirmColor}\r\n                />\r\n            )}\r\n        </>\r\n    );\r\n};\r\n\r\nconst ClientProjectsList = ({ projects, onOpenModal }) => {\r\n    const [activeAccordion, setActiveAccordion] = useState(null);\r\n    const groupedProjects = projects.reduce((acc, project) => {\r\n        const key = project.dependencia || 'Sin Dependencia';\r\n        if (!acc[key]) acc[key] = [];\r\n        acc[key].push(project);\r\n        return acc;\r\n    }, {});\r\n\r\n    const toggleAccordion = (key) => setActiveAccordion(activeAccordion === key ? null : key);\r\n    const formatDate = (timestamp) => !timestamp ? '---' : new Date(timestamp.seconds * 1000).toLocaleDateString('es-MX');\r\n    const getStatusClass = (estado) => estado === 'Activo' ? 'bg-orange-100 text-orange-800' : 'bg-green-100 text-green-800';\r\n\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            {Object.entries(groupedProjects).map(([dependencia, projs]) => (\r\n                <div key={dependencia} className=\"bg-white rounded-lg shadow overflow-hidden\">\r\n                    <button onClick={() => toggleAccordion(dependencia)} className=\"w-full p-4 text-left font-bold text-lg text-gray-800 flex justify-between items-center hover:bg-gray-50 transition\">\r\n                        <span>{dependencia} <span className=\"text-sm font-normal text-gray-500\">({projs.length})</span></span>\r\n                        <span className={`transform transition-transform duration-300 ${activeAccordion === dependencia ? 'rotate-180' : ''}`}>▼</span>\r\n                    </button>\r\n                    {activeAccordion === dependencia && (\r\n                        <ul className=\"divide-y divide-gray-200 border-t\">\r\n                            {projs.map(project => (\r\n                                <li key={project.id} className=\"p-4 md:px-6 md:py-4 flex flex-col md:flex-row md:items-center\">\r\n                                    <div className=\"flex-1 mb-4 md:mb-0\"><div className=\"text-sm font-medium text-gray-900\">{project.servicioNombre}</div></div>\r\n                                    <div className=\"w-full md:w-40 mb-4 md:mb-0\"><div className=\"text-sm text-gray-500 hidden md:block\">{formatDate(project.fechaApertura)}</div></div>\r\n                                    <div className=\"w-full md:w-40 mb-4 md:mb-0\"><span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusClass(project.estadoCliente)}`}>{project.estadoCliente}</span></div>\r\n                                    <div className=\"w-full md:w-56 flex items-center space-x-4\">\r\n                                        {project.urlHeyzine && <button onClick={() => onOpenModal(project.urlHeyzine)} className=\"text-sm font-medium text-blue-600 hover:text-blue-900\">Ver Proyecto</button>}\r\n                                        {project.urlNotaPdf1 && <a href={project.urlNotaPdf1} download className=\"text-sm font-medium text-red-600 hover:text-red-900\">Nota 1</a>}\r\n                                        {project.urlNotaPdf2 && <a href={project.urlNotaPdf2} download className=\"text-sm font-medium text-red-600 hover:text-red-900\">Nota 2</a>}\r\n                                    </div>\r\n                                </li>\r\n                            ))}\r\n                        </ul>\r\n                    )}\r\n                </div>\r\n            ))}\r\n        </div>\r\n    );\r\n};\r\n\r\nconst ClientDashboard = ({ user, userData }) => {\r\n    const [projects, setProjects] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [clientView, setClientView] = useState('shelf');\r\n    const [modalUrl, setModalUrl] = useState(null);\r\n\r\n    useEffect(() => {\r\n        if (!user) { setLoading(false); return; }\r\n        \r\n        const q = query(\r\n            collection(db, \"proyectos\"), \r\n            where(\"clienteId\", \"==\", user.uid),\r\n            where(\"estadoCliente\", \"in\", [\"Activo\", \"Terminado\"])\r\n        );\r\n        \r\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n            const projectsData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            // Ordenar en el cliente\r\n            projectsData.sort((a, b) => b.fechaApertura.seconds - a.fechaApertura.seconds);\r\n            setProjects(projectsData);\r\n            setLoading(false);\r\n        }, (error) => {\r\n            console.error(\"Error fetching client projects: \", error);\r\n            if (error.code === 'failed-precondition') {\r\n                 console.error(\"IMPORTANTE: Se requiere un índice compuesto en Firestore. Ve a la URL que aparece en el mensaje de error en la consola para crearlo con un solo clic.\");\r\n            }\r\n            setLoading(false);\r\n        });\r\n        \r\n        return () => unsubscribe();\r\n    }, [user]);\r\n\r\n    return (\r\n        <>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">Proyectos de {userData.nombreCompleto}</h1>\r\n            <div className=\"mb-6 border-b border-gray-200\">\r\n                <nav className=\"-mb-px flex space-x-8\" aria-label=\"Tabs\">\r\n                    <button onClick={() => setClientView('shelf')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${clientView === 'shelf' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}>\r\n                        Estantería de Proyectos\r\n                    </button>\r\n                    <button onClick={() => setClientView('list')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${clientView === 'list' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}`}>\r\n                        Lista Detallada\r\n                    </button>\r\n                </nav>\r\n            </div>\r\n            \r\n            {loading ? (\r\n                <p>Cargando proyectos...</p>\r\n            ) : projects.length === 0 ? (\r\n                <p className=\"text-center text-gray-500 mt-8\">No hay proyectos para mostrar.</p>\r\n            ) : clientView === 'shelf' ? (\r\n                <ProjectsShelf projects={projects} onOpenModal={setModalUrl} />\r\n            ) : (\r\n                <ClientProjectsList projects={projects} onOpenModal={setModalUrl} />\r\n            )}\r\n\r\n            {modalUrl && <HeyzineViewerModal url={modalUrl} onClose={() => setModalUrl(null)} />}\r\n        </>\r\n    );\r\n};\r\n\r\n/**\r\n * Componente para renderizar la gráfica de Pipeline de Proyectos.\r\n * Recibe los datos ya procesados y listos para mostrar.\r\n */\r\nconst PipelineChart = ({ chartData }) => {\r\n    const data = {\r\n        labels: chartData.labels,\r\n        datasets: [\r\n            {\r\n                label: 'Valor en Cotización',\r\n                data: chartData.cotizacionData,\r\n                backgroundColor: 'rgba(255, 159, 64, 0.7)', // Naranja\r\n            },\r\n            {\r\n                label: 'Valor Activo',\r\n                data: chartData.activoData,\r\n                backgroundColor: 'rgba(54, 162, 235, 0.7)', // Azul\r\n            },\r\n            {\r\n                label: 'Valor Pdto. Factura',\r\n                data: chartData.pendienteFacturaData,\r\n                backgroundColor: 'rgba(255, 206, 86, 0.7)', // Amarillo\r\n            },\r\n            {\r\n                type: 'line', // Este dataset es una línea\r\n                label: 'Valor Total Ofertado',\r\n                data: chartData.totalData,\r\n                borderColor: 'rgba(75, 192, 192, 1)', // Verde-azulado\r\n                backgroundColor: 'rgba(75, 192, 192, 0.2)',\r\n                fill: true,\r\n                tension: 0.2,\r\n                yAxisID: 'y1',\r\n            }\r\n        ]\r\n    };\r\n\r\n    const options = {\r\n        responsive: true,\r\n        maintainAspectRatio: false,\r\n        plugins: {\r\n            title: {\r\n                display: false,\r\n            },\r\n            tooltip: {\r\n                mode: 'index',\r\n                intersect: false,\r\n            },\r\n            legend: {\r\n                position: 'bottom',\r\n            }\r\n        },\r\n        scales: {\r\n            x: {\r\n                stacked: true,\r\n            },\r\n            y: {\r\n                stacked: true,\r\n                beginAtZero: true\r\n            },\r\n            y1: {\r\n                position: 'right',\r\n                grid: {\r\n                    drawOnChartArea: false,\r\n                },\r\n                beginAtZero: true,\r\n            }\r\n        },\r\n    };\r\n\r\n    return <Bar options={options} data={data} />;\r\n};\r\n\r\n/**\r\n * Componente para la gráfica de Salud de Cuentas por Cobrar.\r\n */\r\nconst AccountsReceivableChart = ({ chartData }) => {\r\n    const data = {\r\n        labels: chartData.labels,\r\n        datasets: [\r\n            {\r\n                label: 'Pagado',\r\n                data: chartData.pagadoData,\r\n                backgroundColor: 'rgba(75, 192, 192, 0.7)', // Verde\r\n            },\r\n            {\r\n                label: 'Programado a Pago',\r\n                data: chartData.programadoData,\r\n                backgroundColor: 'rgba(54, 162, 235, 0.7)', // Azul\r\n            },\r\n            {\r\n                label: 'Vence Hoy',\r\n                data: chartData.venceHoyData,\r\n                backgroundColor: 'rgba(255, 159, 64, 0.7)', // Naranja\r\n            },\r\n            {\r\n                label: 'Vencido',\r\n                data: chartData.vencidoData,\r\n                backgroundColor: 'rgba(255, 99, 132, 0.7)', // Rojo\r\n            },\r\n            {\r\n                label: 'Pdte. de Programación',\r\n                data: chartData.pdteProgramacionData,\r\n                backgroundColor: 'rgba(201, 203, 207, 0.7)', // Gris\r\n            },\r\n            {\r\n                type: 'line',\r\n                label: 'Total Facturado',\r\n                data: chartData.totalFacturadoData,\r\n                borderColor: '#36A2EB',\r\n                tension: 0.2,\r\n                yAxisID: 'y1',\r\n            }\r\n        ]\r\n    };\r\n\r\n    const options = {\r\n        responsive: true,\r\n        maintainAspectRatio: false,\r\n        plugins: {\r\n            title: { display: false },\r\n            tooltip: { mode: 'index', intersect: false },\r\n            legend: { position: 'bottom' }\r\n        },\r\n        scales: {\r\n            x: { stacked: true },\r\n            y: { stacked: true, beginAtZero: true },\r\n            y1: {\r\n                position: 'right',\r\n                grid: { drawOnChartArea: false },\r\n                beginAtZero: true,\r\n            }\r\n        },\r\n    };\r\n\r\n    return <Bar options={options} data={data} />;\r\n};\r\n\r\n/**\r\n * Componente para la gráfica de Flujo de Caja Proyectado (Semanal).\r\n */\r\nconst CashFlowChart = ({ chartData }) => {\r\n    const data = {\r\n        labels: chartData.labels,\r\n        datasets: [\r\n            {\r\n                label: 'Ingresos Programados',\r\n                data: chartData.ingresosData,\r\n                borderColor: 'rgb(54, 162, 235)',\r\n                backgroundColor: 'rgba(54, 162, 235, 0.5)',\r\n                type: 'bar', // Barras para ingresos\r\n            },\r\n            {\r\n                label: 'Egresos Programados',\r\n                data: chartData.egresosData,\r\n                borderColor: 'rgb(255, 99, 132)',\r\n                backgroundColor: 'rgba(255, 99, 132, 0.5)',\r\n                type: 'bar', // Barras para egresos\r\n            }\r\n        ]\r\n    };\r\n\r\n    const options = {\r\n        responsive: true,\r\n        maintainAspectRatio: false,\r\n        plugins: {\r\n            title: { display: false },\r\n            legend: { position: 'bottom' }\r\n        },\r\n        scales: {\r\n            y: { beginAtZero: true }\r\n        }\r\n    };\r\n\r\n    return <Bar options={options} data={data} />;\r\n};\r\n\r\n//Componente para la gráfica de Productividad por Técnico. \r\nconst TechnicianProductivityChart = ({ chartData }) => {\r\n    const data = {\r\n        labels: chartData.labels, // Nombres de los técnicos\r\n        datasets: [\r\n            {\r\n                label: 'Proyectos Entregados (Mes Actual)',\r\n                data: chartData.completedData, // Cantidad de proyectos\r\n                backgroundColor: 'rgba(153, 102, 255, 0.7)', // Morado\r\n                borderColor: 'rgba(153, 102, 255, 1)',\r\n                borderWidth: 1,\r\n            },\r\n        ],\r\n    };\r\n\r\n    const options = {\r\n        indexAxis: 'y', // Hace que la gráfica sea horizontal\r\n        responsive: true,\r\n        maintainAspectRatio: false,\r\n        plugins: {\r\n            legend: {\r\n                display: false, // No es necesaria con una sola barra\r\n            },\r\n            title: {\r\n                display: false,\r\n            },\r\n        },\r\n        scales: {\r\n            x: {\r\n                beginAtZero: true,\r\n                ticks: {\r\n                    // Asegura que solo se muestren números enteros en el eje\r\n                    stepSize: 1,\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    return <Bar options={options} data={data} />;\r\n};\r\n\r\n//Muestra un indicador clave de rendimiento (KPI) en un widget.\r\nconst KPIWidget = ({ title, value, unit = '', trend = null }) => {\r\n    return (\r\n        <div className=\"bg-white p-5 rounded-xl shadow-md\">\r\n            <h3 className=\"font-bold text-gray-500 truncate\">{title}</h3>\r\n            <p className=\"text-3xl font-bold mt-2\">\r\n                {value}\r\n                <span className=\"text-xl font-semibold ml-1\">{unit}</span>\r\n            </p>\r\n            {/* Próximamente se podría añadir un indicador de tendencia */}\r\n        </div>\r\n    );\r\n};\r\n\r\n// --- Reemplazar el componente DirectivoDashboard existente por completo ---\r\nconst DirectivoDashboard = () => {\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState('');\r\n    const [dashboardData, setDashboardData] = useState(null);\r\n\r\n    /**\r\n     * Procesa los datos crudos de Firestore para generar las métricas del dashboard.\r\n     * @param {Array} projects - Array de todos los proyectos.\r\n     * @param {Array} invoices - Array de todas las facturas.\r\n     * @returns {Object} - Objeto con los datos procesados para las gráficas.\r\n     */\r\n// --- Reemplazar la función processDataForDashboard completa ---\r\n\r\n    const processDataForDashboard = (projects, invoices, technicians) => {\r\n        const currentYear = new Date().getFullYear();\r\n        const currentMonth = new Date().getMonth();\r\n        const labels = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];\r\n        const today = new Date();\r\n        today.setHours(0, 0, 0, 0);\r\n        const oneDay = 1000 * 60 * 60 * 24;\r\n\r\n        // --- Lógica de Gráficas (sin cambios) ---\r\n        const monthlyProjectsData = Array(12).fill(0).map(() => ({ cotizacion: 0, activo: 0, pendienteFactura: 0, total: 0 }));\r\n        projects.forEach(p => {\r\n            if (p.fechaApertura?.toDate && p.fechaApertura.toDate().getFullYear() === currentYear) {\r\n                const month = p.fechaApertura.toDate().getMonth();\r\n                const projectValue = p.precioCotizacionCliente || 0;\r\n                monthlyProjectsData[month].total += projectValue;\r\n                switch (p.estado) {\r\n                    case 'Cotización': monthlyProjectsData[month].cotizacion += projectValue; break;\r\n                    case 'Activo': case 'Terminado Internamente': case 'En Revisión Final': monthlyProjectsData[month].activo += projectValue; break;\r\n                    case 'Pendiente de Factura': monthlyProjectsData[month].pendienteFactura += projectValue; break;\r\n                    default: break;\r\n                }\r\n            }\r\n        });\r\n\r\n        const monthlyARData = Array(12).fill(0).map(() => ({ totalFacturado: 0, pdteProgramacion: 0, programado: 0, venceHoy: 0, vencido: 0, pagado: 0 }));\r\n        invoices.forEach(inv => {\r\n            if (inv.tipo === 'cliente' && inv.fechaEmision?.toDate && inv.fechaEmision.toDate().getFullYear() === currentYear) {\r\n                const month = inv.fechaEmision.toDate().getMonth();\r\n                const invoiceValue = inv.monto || 0;\r\n                monthlyARData[month].totalFacturado += invoiceValue;\r\n                if (inv.estado === 'Pagada') { monthlyARData[month].pagado += invoiceValue; }\r\n                else if (inv.estado === 'Pendiente') {\r\n                    if (inv.fechaPromesaPago?.toDate) {\r\n                        const promiseDate = inv.fechaPromesaPago.toDate();\r\n                        promiseDate.setHours(0, 0, 0, 0);\r\n                        if (promiseDate < today) { monthlyARData[month].vencido += invoiceValue; }\r\n                        else if (promiseDate.getTime() === today.getTime()) { monthlyARData[month].venceHoy += invoiceValue; }\r\n                        else { monthlyARData[month].programado += invoiceValue; }\r\n                    } else { monthlyARData[month].pdteProgramacion += invoiceValue; }\r\n                }\r\n            }\r\n        });\r\n\r\n        const weeklyCashFlowData = Array(8).fill(0).map(() => ({ ingresos: 0, egresos: 0 }));\r\n        const weeklyLabels = [];\r\n        const todayForWeeks = new Date();\r\n        for (let i = 0; i < 8; i++) {\r\n            const weekStartDate = new Date(todayForWeeks.getTime() + (i * 7 * oneDay));\r\n            weeklyLabels.push(`Sem ${i + 1} (${weekStartDate.getDate()}/${weekStartDate.getMonth() + 1})`);\r\n        }\r\n        invoices.forEach(inv => {\r\n            if (inv.estado === 'Pendiente' && inv.fechaPromesaPago?.toDate) {\r\n                const promiseDate = inv.fechaPromesaPago.toDate();\r\n                const diffDays = Math.floor((promiseDate - todayForWeeks) / oneDay);\r\n                const weekIndex = Math.floor(diffDays / 7);\r\n                if (weekIndex >= 0 && weekIndex < 8) {\r\n                    if (inv.tipo === 'cliente') { weeklyCashFlowData[weekIndex].ingresos += inv.monto || 0; }\r\n                    else if (inv.tipo === 'proveedor') { weeklyCashFlowData[weekIndex].egresos += inv.monto || 0; }\r\n                }\r\n            }\r\n        });\r\n\r\n        const techProductivity = {};\r\n        technicians.forEach(t => { techProductivity[t.id] = { name: t.nombreCompleto.split(' ')[0], completed: 0 }; });\r\n        projects.forEach(p => {\r\n            [p.fechaFinTecnico1, p.fechaFinTecnico2].filter(Boolean).forEach(timestamp => {\r\n                const completionDate = timestamp.toDate();\r\n                if (completionDate.getMonth() === currentMonth && completionDate.getFullYear() === currentYear) {\r\n                    (p.asignadoTecnicosIds || []).forEach(techId => {\r\n                        if (techProductivity[techId]) { techProductivity[techId].completed += 1; }\r\n                    });\r\n                }\r\n            });\r\n        });\r\n\r\n        // --- Nueva Lógica para los KPIs Principales ---\r\n        let totalMargin = 0, projectsWithFinancials = 0;\r\n        let totalDeliveryDays = 0, completedProjects = 0;\r\n        let totalActivationDays = 0, activatedProjects = 0;\r\n\r\n        projects.forEach(p => {\r\n            // Margen de beneficio\r\n            if ((p.precioCotizacionCliente || 0) > 0 && (p.costoProveedor || 0) >= 0) {\r\n                totalMargin += (p.precioCotizacionCliente - p.costoProveedor) / p.precioCotizacionCliente;\r\n                projectsWithFinancials++;\r\n            }\r\n            // Tiempo de entrega\r\n            if (p.fechaAsignacionTecnico?.toDate && p.fechaFinTecnico1?.toDate) {\r\n                totalDeliveryDays += (p.fechaFinTecnico1.toDate() - p.fechaAsignacionTecnico.toDate()) / oneDay;\r\n                completedProjects++;\r\n            }\r\n            // Tiempo de activación\r\n            if (p.fechaApertura?.toDate && p.fechaAsignacionTecnico?.toDate) {\r\n                totalActivationDays += (p.fechaAsignacionTecnico.toDate() - p.fechaApertura.toDate()) / oneDay;\r\n                activatedProjects++;\r\n            }\r\n        });\r\n\r\n        const kpis = {\r\n            avgMargin: projectsWithFinancials > 0 ? ((totalMargin / projectsWithFinancials) * 100).toFixed(1) : 0,\r\n            avgDeliveryDays: completedProjects > 0 ? (totalDeliveryDays / completedProjects).toFixed(1) : 0,\r\n            avgActivationDays: activatedProjects > 0 ? (totalActivationDays / activatedProjects).toFixed(1) : 0,\r\n            invoicedThisMonth: (monthlyARData[currentMonth].totalFacturado).toLocaleString('es-MX', { style: 'currency', currency: 'MXN' })\r\n        };\r\n\r\n        return {\r\n            kpis,\r\n            pipeline: { labels, cotizacionData: monthlyProjectsData.map(m => m.cotizacion), activoData: monthlyProjectsData.map(m => m.activo), pendienteFacturaData: monthlyProjectsData.map(m => m.pendienteFactura), totalData: monthlyProjectsData.map(m => m.total) },\r\n            accountsReceivable: { labels, totalFacturadoData: monthlyARData.map(m => m.totalFacturado), pagadoData: monthlyARData.map(m => m.pagado), programadoData: monthlyARData.map(m => m.programado), venceHoyData: monthlyARData.map(m => m.venceHoy), vencidoData: monthlyARData.map(m => m.vencido), pdteProgramacionData: monthlyARData.map(m => m.pdteProgramacion) },\r\n            cashFlow: { labels: weeklyLabels, ingresosData: weeklyCashFlowData.map(w => w.ingresos), egresosData: weeklyCashFlowData.map(w => w.egresos) },\r\n            technicianProductivity: { labels: Object.values(techProductivity).map(t => t.name), completedData: Object.values(techProductivity).map(t => t.completed) }\r\n        };\r\n    };\r\n\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            try {\r\n                // Añadimos una tercera consulta para obtener los técnicos\r\n                const projectsQuery = query(collection(db, \"proyectos\"));\r\n                const invoicesQuery = query(collection(db, \"facturas\"));\r\n                const techniciansQuery = query(collection(db, \"usuarios\"), where(\"rol\", \"==\", \"tecnico\"));\r\n\r\n                const [projectsSnapshot, invoicesSnapshot, techniciansSnapshot] = await Promise.all([\r\n                    getDocs(projectsQuery),\r\n                    getDocs(invoicesQuery),\r\n                    getDocs(techniciansQuery) // Ejecutamos la nueva consulta\r\n                ]);\r\n\r\n                const allProjects = projectsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n                const allInvoices = invoicesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n                const allTechnicians = techniciansSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n                \r\n                // Pasamos los técnicos a la función de procesamiento\r\n                const processedData = processDataForDashboard(allProjects, allInvoices, allTechnicians);\r\n                setDashboardData(processedData);\r\n\r\n            } catch (err) {\r\n                console.error(\"Error al obtener datos para el dashboard directivo:\", err);\r\n                setError(\"No se pudieron cargar las métricas.\");\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchData();\r\n    }, []);\r\n\r\n    if (loading) {\r\n        return <div className=\"text-center py-10\">Calculando métricas... ⚙️</div>;\r\n    }\r\n\r\n    if (error) {\r\n        return <div className=\"text-center py-10 text-red-600\">{error}</div>;\r\n    }\r\n\r\n// --- Reemplazar solo la sección de return dentro de DirectivoDashboard ---\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            <div>\r\n                <h1 className=\"text-3xl font-bold text-gray-900\">Dashboard Directivo</h1>\r\n                <p className=\"text-gray-600\">Vista general de la salud y rendimiento del negocio.</p>\r\n            </div>\r\n\r\n            {/* Fila de KPIs Principales (Widgets) */}\r\n            {dashboardData?.kpis && (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5\">\r\n                    <KPIWidget title=\"Margen Promedio\" value={dashboardData.kpis.avgMargin} unit=\"%\" />\r\n                    <KPIWidget title=\"Tiempo Prom. Entrega\" value={dashboardData.kpis.avgDeliveryDays} unit=\"días\" />\r\n                    <KPIWidget title=\"Tiempo Prom. Activación\" value={dashboardData.kpis.avgActivationDays} unit=\"días\" />\r\n                    <KPIWidget title=\"Facturado (Mes Actual)\" value={dashboardData.kpis.invoicedThisMonth} />\r\n                </div>\r\n            )}\r\n\r\n            {/* Sección de Gráficas */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\r\n                <div className=\"bg-white p-6 rounded-xl shadow-md\">\r\n                    <h3 className=\"font-bold text-lg mb-4\">Pipeline de Proyectos (Mensual)</h3>\r\n                    <div className=\"h-80\">\r\n                        {dashboardData?.pipeline && <PipelineChart chartData={dashboardData.pipeline} />}\r\n                    </div>\r\n                </div>\r\n                <div className=\"bg-white p-6 rounded-xl shadow-md\">\r\n                    <h3 className=\"font-bold text-lg mb-4\">Salud de Cuentas por Cobrar (Mensual)</h3>\r\n                    <div className=\"h-80\">\r\n                        {dashboardData?.accountsReceivable && <AccountsReceivableChart chartData={dashboardData.accountsReceivable} />}\r\n                    </div>\r\n                </div>\r\n                <div className=\"bg-white p-6 rounded-xl shadow-md\">\r\n                    <h3 className=\"font-bold text-lg mb-4\">Flujo de Caja Proyectado (Próximas 8 Semanas)</h3>\r\n                    <div className=\"h-80\">\r\n                        {dashboardData?.cashFlow && <CashFlowChart chartData={dashboardData.cashFlow} />}\r\n                    </div>\r\n                </div>\r\n                <div className=\"bg-white p-6 rounded-xl shadow-md\">\r\n                    <h3 className=\"font-bold text-lg mb-4\">Productividad por Técnico (Mes Actual)</h3>\r\n                    <div className=\"h-80\">\r\n                        {dashboardData?.technicianProductivity && <TechnicianProductivityChart chartData={dashboardData.technicianProductivity} />}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// **CÓDIGO CORREGIDO PARA EcotechDashboard**\r\nconst EcotechDashboard = () => {\r\n    const [projects, setProjects] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const fetchProjects = () => {\r\n        setLoading(true);\r\n        // Busca proyectos activos cuyo proveedor sea \"Ecotech\"\r\n        const q = query(\r\n            collection(db, \"proyectos\"), \r\n            where(\"proveedorNombre\", \"==\", \"Ecotech Ingenieria del Medio Ambiente\"),\r\n            where(\"estado\", \"!=\", \"Terminado\") // No muestra los proyectos ya terminados\r\n        );\r\n        \r\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n            const projectsData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            setProjects(projectsData);\r\n            setLoading(false);\r\n        }, (error) => {\r\n            console.error(\"Error fetching projects for Ecotech: \", error);\r\n            if (error.code === 'failed-precondition') {\r\n                alert(\"Se requiere una configuración adicional en la base de datos. Por favor, revise la consola del navegador (F12) para encontrar un enlace y crear el índice necesario.\");\r\n            }\r\n            setLoading(false);\r\n        });\r\n        \r\n        return unsubscribe;\r\n    };\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = fetchProjects();\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    return (\r\n        <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">Gestión de Proyectos Ecotech</h1>\r\n            {loading ? (\r\n                <p>Cargando proyectos de Ecotech...</p>\r\n            ) : projects.length === 0 ? (\r\n                 <p className=\"text-center text-gray-500 mt-8\">No hay proyectos de Ecotech activos.</p>\r\n            ) : (\r\n                <EcotechProjectsTable projects={projects} onUpdateProject={fetchProjects} />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n// **CÓDIGO MEJORADO PARA EcotechProjectsTable (CON FILTROS Y PAGINACIÓN)**\r\nconst EcotechProjectsTable = ({ projects, onUpdateProject }) => {\r\n    const [modalProject, setModalProject] = useState(null);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const [itemsPerPage, setItemsPerPage] = useState(10);\r\n\r\n    const ManageEcotechProjectModal = ({ project, onClose, onFinalized }) => {\r\n        const [labProjectNumber, setLabProjectNumber] = useState(project.numeroProyectoLaboratorio || '');\r\n        const [workPoints, setWorkPoints] = useState(project.puntosDeTrabajo || '');\r\n        const [notes, setNotes] = useState(project.notasEcotech || '');\r\n        const [status, setStatus] = useState(project.estatusEcotech || 'Pendiente');\r\n        const [guiaEnvio, setGuiaEnvio] = useState(project.numeroGuiaEnvio || '');\r\n        const [guiaRegreso, setGuiaRegreso] = useState(project.numeroGuiaRegreso || '');\r\n        const [loading, setLoading] = useState(false);\r\n\r\n        const handleSave = async () => {\r\n            setLoading(true);\r\n            const projectRef = doc(db, \"proyectos\", project.id);\r\n            await updateDoc(projectRef, {\r\n                numeroProyectoLaboratorio: labProjectNumber,\r\n                puntosDeTrabajo: Number(workPoints) || 0,\r\n                notasEcotech: notes,\r\n                estatusEcotech: status,\r\n                numeroGuiaEnvio: guiaEnvio,\r\n                numeroGuiaRegreso: guiaRegreso\r\n            });\r\n            setLoading(false);\r\n            onFinalized();\r\n            onClose();\r\n        };\r\n\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n                <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-md\">\r\n                    <h3 className=\"text-lg font-bold mb-4\">Gestionar Info de Laboratorio: {project.npu}</h3>\r\n                    <div className=\"space-y-4\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700\">Número de Proyecto (Laboratorio)</label>\r\n                            <input type=\"text\" value={labProjectNumber} onChange={e => setLabProjectNumber(e.target.value)} className=\"mt-1 block w-full px-3 py-2 border rounded-md\"/>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700\">Puntos de Trabajo Solicitados</label>\r\n                            <input type=\"number\" value={workPoints} onChange={e => setWorkPoints(e.target.value)} className=\"mt-1 block w-full px-3 py-2 border rounded-md\"/>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700\">Nº de Guía (Envío)</label>\r\n                            <input type=\"text\" value={guiaEnvio} onChange={e => setGuiaEnvio(e.target.value)} className=\"mt-1 block w-full px-3 py-2 border rounded-md\"/>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700\">Nº de Guía (Regreso)</label>\r\n                            <input type=\"text\" value={guiaRegreso} onChange={e => setGuiaRegreso(e.target.value)} className=\"mt-1 block w-full px-3 py-2 border rounded-md\"/>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700\">Notas</label>\r\n                            <textarea value={notes} onChange={e => setNotes(e.target.value)} rows=\"3\" className=\"mt-1 block w-full px-3 py-2 border rounded-md\"></textarea>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700\">Estatus Interno</label>\r\n                            <select value={status} onChange={e => setStatus(e.target.value)} className=\"mt-1 block w-full px-3 py-2 border rounded-md\">\r\n                                <option value=\"Pendiente\">Pendiente</option>\r\n                                <option value=\"En Proceso\">En Proceso</option>\r\n                                <option value=\"Muestreo Realizado\">Muestreo Realizado</option>\r\n                                <option value=\"Resultados Entregados\">Resultados Entregados</option>\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"mt-6 flex justify-end space-x-3\">\r\n                        <button onClick={onClose} disabled={loading} className=\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\">Cancelar</button>\r\n                        <button onClick={handleSave} disabled={loading} className=\"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded\">{loading ? 'Guardando...' : 'Guardar Información'}</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n    \r\n    const filteredProjects = projects.filter(project => \r\n        (project.npu && project.npu.toLowerCase().includes(searchTerm.toLowerCase())) ||\r\n        (project.clienteNombre && project.clienteNombre.toLowerCase().includes(searchTerm.toLowerCase())) ||\r\n        (project.servicioNombre && project.servicioNombre.toLowerCase().includes(searchTerm.toLowerCase()))\r\n    );\r\n\r\n    const indexOfLastItem = currentPage * itemsPerPage;\r\n    const indexOfFirstItem = indexOfLastItem - itemsPerPage;\r\n    const currentItems = filteredProjects.slice(indexOfFirstItem, indexOfLastItem);\r\n    const totalPages = Math.ceil(filteredProjects.length / itemsPerPage);\r\n\r\n    const paginate = (pageNumber) => setCurrentPage(pageNumber);\r\n\r\n    return (\r\n        <>\r\n            <div className=\"mb-4 flex flex-col md:flex-row justify-between items-center\">\r\n                <input \r\n                    type=\"text\"\r\n                    placeholder=\"Buscar por NPU, cliente o servicio...\"\r\n                    className=\"w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md mb-2 md:mb-0\"\r\n                    onChange={(e) => { setSearchTerm(e.target.value); setCurrentPage(1); }}\r\n                />\r\n                <div className=\"flex items-center\">\r\n                    <span className=\"text-sm mr-2\">Mostrar:</span>\r\n                    <select value={itemsPerPage} onChange={(e) => { setItemsPerPage(Number(e.target.value)); setCurrentPage(1); }} className=\"px-2 py-1 border border-gray-300 rounded-md\">\r\n                        <option value={10}>10</option>\r\n                        <option value={25}>25</option>\r\n                        <option value={50}>50</option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"overflow-x-auto bg-white rounded-lg shadow\">\r\n                <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-50\">\r\n                        <tr>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">NPU</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Cliente</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Servicio</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Nº Proyecto Lab.</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Puntos</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Notas</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Guía Envío</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Guía Regreso</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Estatus Interno</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Acciones</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                        {currentItems.map(project => (\r\n                             <tr key={project.id}>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.npu}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.clienteNombre}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.servicioNombre}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.numeroProyectoLaboratorio || '---'}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.puntosDeTrabajo || '---'}</td>\r\n                                <td className=\"px-6 py-4 text-sm text-gray-500\" title={project.notasEcotech}>\r\n                                    <p className=\"w-40 truncate\">{project.notasEcotech || '---'}</p>\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.numeroGuiaEnvio || '---'}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.numeroGuiaRegreso || '---'}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.estatusEcotech || 'Pendiente'}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                                    <button onClick={() => setModalProject(project)} className=\"text-indigo-600 hover:text-indigo-900\">Gestionar</button>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            <div className=\"mt-4 flex justify-between items-center\">\r\n                <span className=\"text-sm text-gray-700\">Página {currentPage} de {totalPages}</span>\r\n                <div>\r\n                    <button onClick={() => paginate(currentPage - 1)} disabled={currentPage === 1} className=\"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50\">Anterior</button>\r\n                    <button onClick={() => paginate(currentPage + 1)} disabled={currentPage === totalPages || totalPages === 0} className=\"px-3 py-1 border rounded-md bg-white disabled:opacity-50\">Siguiente</button>\r\n                </div>\r\n            </div>\r\n            \r\n            {modalProject && <ManageEcotechProjectModal project={modalProject} onClose={() => setModalProject(null)} onFinalized={onUpdateProject} />}\r\n        </>\r\n    );\r\n};\r\n\r\n// **CÓDIGO ACTUALIZADO PARA SupervisorDashboard (FASE 3.3)**\r\nconst SupervisorDashboard = ({ user, userData }) => {\r\n    const [view, setView] = useState('new'); // 'new' o 'assigned'\r\n    const [allActiveProjects, setAllActiveProjects] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    // Estados para el ordenamiento\r\n    const [sortBy, setSortBy] = useState('fechaApertura');\r\n    const [sortOrder, setSortOrder] = useState('desc');\r\n\r\n    useEffect(() => {\r\n        setLoading(true);\r\n        // Esta consulta ahora carga TODOS los proyectos activos. El filtrado se hará en el cliente.\r\n        const q = query(collection(db, \"proyectos\"), where(\"estado\", \"==\", \"Activo\"));\r\n        \r\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n            const projectsData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            setAllActiveProjects(projectsData);\r\n            setLoading(false);\r\n        }, (error) => {\r\n            console.error(\"Error fetching active projects for supervisor:\", error);\r\n            setLoading(false);\r\n        });\r\n        \r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    // Usamos useMemo para filtrar y ordenar los proyectos de forma eficiente\r\n    const displayedProjects = React.useMemo(() => {\r\n        const filtered = allActiveProjects.filter(p => {\r\n            const hasAssignedTechnicians = p.asignadoTecnicosIds && p.asignadoTecnicosIds.length > 0;\r\n            if (view === 'new') return !hasAssignedTechnicians;\r\n            if (view === 'assigned') return hasAssignedTechnicians;\r\n            return false;\r\n        });\r\n\r\n        return filtered.sort((a, b) => {\r\n            const fieldA = a[sortBy];\r\n            const fieldB = b[sortBy];\r\n            \r\n            if (!fieldA) return 1; // Mover proyectos sin fecha al final\r\n            if (!fieldB) return -1;\r\n\r\n            let comparison = 0;\r\n            if (fieldA.seconds > fieldB.seconds) {\r\n                comparison = 1;\r\n            } else if (fieldA.seconds < fieldB.seconds) {\r\n                comparison = -1;\r\n            }\r\n            return sortOrder === 'asc' ? comparison : -comparison;\r\n        });\r\n    }, [allActiveProjects, view, sortBy, sortOrder]);\r\n\r\n    return (\r\n        <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">Panel de Supervisión</h1>\r\n            <div className=\"mb-6 border-b border-gray-200\">\r\n                <nav className=\"-mb-px flex space-x-8\" aria-label=\"Tabs\">\r\n                    <button onClick={() => setView('new')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'new' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>Nuevos por Asignar</button>\r\n                    <button onClick={() => setView('assigned')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'assigned' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>Asignados y en Proceso</button>\r\n                </nav>\r\n            </div>\r\n\r\n            {/* Controles de Ordenamiento */}\r\n            <div className=\"flex justify-end items-center mb-4\">\r\n                <label htmlFor=\"sort-by\" className=\"text-sm font-medium text-gray-700 mr-2\">Ordenar por:</label>\r\n                <select id=\"sort-by\" value={sortBy} onChange={e => setSortBy(e.target.value)} className=\"border rounded-md p-1 text-sm\">\r\n                    <option value=\"fechaApertura\">Fecha de Apertura</option>\r\n                    <option value=\"fechaEntregaInterna\">Fecha Límite</option>\r\n                </select>\r\n                <button onClick={() => setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc')} className=\"ml-2 p-1 border rounded-md text-sm\">\r\n                    {sortOrder === 'asc' ? '↑ Asc' : '↓ Desc'}\r\n                </button>\r\n            </div>\r\n\r\n            {loading ? <p>Cargando proyectos...</p> : <ProjectsTable projects={displayedProjects} onUpdateProject={() => {}} userRole=\"supervisor\" user={user} userData={userData} />}\r\n        </div>\r\n    );\r\n};\r\n\r\n// **CÓDIGO COMPLETO Y CORREGIDO PARA TecnicoDashboard**\r\nconst TecnicoDashboard = ({ user, userData }) => {\r\n    const [view, setView] = useState('new'); // 'new' o 'inProgress'\r\n    const [projects, setProjects] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (!user) return;\r\n        setLoading(true);\r\n        \r\n        const statusToQuery = view === 'new' ? \"No Visto\" : \"En Proceso\";\r\n        \r\n        const q = query(\r\n            collection(db, \"proyectos\"),\r\n            where(\"estado\", \"==\", \"Activo\"),\r\n            where(`tecnicosStatus.${user.uid}`, \"==\", statusToQuery)\r\n        );\r\n        \r\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n            const projectsData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            setProjects(projectsData);\r\n            setLoading(false);\r\n        }, (error) => {\r\n            console.error(`Error fetching projects for tecnico in view ${view}:`, error);\r\n            if (error.code === 'failed-precondition') {\r\n                alert(\"Se requiere una configuración adicional en la base de datos. Por favor, revise la consola del navegador (F12) para encontrar un enlace y crear el índice necesario.\");\r\n            }\r\n            setLoading(false);\r\n        });\r\n        \r\n        return () => unsubscribe();\r\n    }, [view, user]);\r\n\r\n    const handleStartProject = async (project) => {\r\n        const projectRef = doc(db, \"proyectos\", project.id);\r\n        await updateDoc(projectRef, {\r\n            [`tecnicosStatus.${user.uid}`]: \"En Proceso\"\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">Mis Tareas</h1>\r\n            <div className=\"mb-6 border-b border-gray-200\">\r\n                <nav className=\"-mb-px flex space-x-8\" aria-label=\"Tabs\">\r\n                    <button onClick={() => setView('new')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'new' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>Nuevas Tareas</button>\r\n                    <button onClick={() => setView('inProgress')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'inProgress' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>Tareas en Proceso</button>\r\n                </nav>\r\n            </div>\r\n\r\n            {loading ? <p>Cargando tareas...</p> : (\r\n                <TecnicoProjectsTable \r\n                    projects={projects} \r\n                    onUpdateProject={() => {}} \r\n                    user={user} \r\n                    userData={userData} \r\n                    handleStartProject={handleStartProject} \r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n// **CÓDIGO ACTUALIZADO PARA TecnicoProjectsTable (CON FECHA DE FINALIZACIÓN)**\r\nconst TecnicoProjectsTable = ({ projects, onUpdateProject, user, userData, handleStartProject }) => {\r\n    const [modalProject, setModalProject] = useState(null);\r\n    const [modalType, setModalType] = useState(''); // 'task' o 'log'\r\n\r\n    const ManageTaskModal = ({ project, onClose, onFinalized }) => {\r\n        const [comments, setComments] = useState('');\r\n        const [evidenceFile, setEvidenceFile] = useState(null);\r\n        const [loading, setLoading] = useState(false);\r\n        const [error, setError] = useState('');\r\n\r\n        const handleFileChange = (e) => {\r\n            if (e.target.files[0]) {\r\n                setEvidenceFile(e.target.files[0]);\r\n            }\r\n        };\r\n\r\n        const generateAndSaveNota = async () => {\r\n            if (typeof window.jspdf === 'undefined') {\r\n                throw new Error(\"La librería para generar PDFs (jsPDF) no se ha cargado.\");\r\n            }\r\n            const { jsPDF } = window.jspdf;\r\n            const pdfDoc = new jsPDF();\r\n            const anioActual = new Date().getFullYear();\r\n            const contadorRef = doc(db, \"contadores\", `notas_entrega_${anioActual}`);\r\n            const nuevoConsecutivo = await runTransaction(db, async (transaction) => {\r\n                const contadorDoc = await transaction.get(contadorRef);\r\n                const nuevoValor = (contadorDoc.exists() ? contadorDoc.data().consecutivo : 0) + 1;\r\n                transaction.set(contadorRef, { consecutivo: nuevoValor }, { merge: true });\r\n                return nuevoValor;\r\n            });\r\n            const numeroNota = `${anioActual}-${nuevoConsecutivo.toString().padStart(4, '0')}`;\r\n\r\n            pdfDoc.setFont(\"helvetica\", \"bold\");\r\n            pdfDoc.setFontSize(10);\r\n            pdfDoc.text(\"ECOLOGÍA Y ASESORÍA AMBIENTAL S. DE R.L. DE C.V.\", 105, 20, { align: 'center' });\r\n            pdfDoc.setFont(\"helvetica\", \"normal\");\r\n            pdfDoc.setFontSize(8);\r\n            pdfDoc.text(\"HERMANOS ESCOBAR 6150-2 PARQUE INDUSTRIAL OMEGA\", 105, 25, { align: 'center' });\r\n            pdfDoc.text(\"CP.32410CD. JUÁREZ, CHIHUAHUA. RFC EAA12060765A\", 105, 29, { align: 'center' });\r\n            pdfDoc.setFontSize(16);\r\n            pdfDoc.setFont(\"helvetica\", \"bold\");\r\n            pdfDoc.text(\"NOTA DE ENTREGA\", 105, 45, { align: 'center' });\r\n            pdfDoc.text(numeroNota, 180, 55);\r\n            pdfDoc.setFontSize(11);\r\n            pdfDoc.setFont(\"helvetica\", \"normal\");\r\n            pdfDoc.text(`FECHA: ${new Date().toLocaleDateString('es-MX')}`, 20, 65);\r\n            pdfDoc.text(`PROYECTO: ${project.npu}`, 20, 75);\r\n            pdfDoc.text(`NOMBRE/RAZÓN SOCIAL: ${project.clienteNombre}`, 20, 85);\r\n            pdfDoc.rect(15, 95, 180, 20);\r\n            pdfDoc.text(\"DESCRIPCIÓN\", 20, 101);\r\n            pdfDoc.text(\"CANTIDAD\", 170, 101);\r\n            pdfDoc.text(project.servicioNombre, 20, 108);\r\n            pdfDoc.text(\"1\", 175, 108);\r\n            pdfDoc.text(\"Comentarios:\", 20, 125);\r\n            const splitComments = pdfDoc.splitTextToSize(comments, 170);\r\n            pdfDoc.text(splitComments, 20, 132);\r\n            pdfDoc.text(\"RECIBIDO POR:\", 20, 250);\r\n            pdfDoc.line(20, 260, 100, 260);\r\n            pdfDoc.text(\"NOMBRE Y FIRMA\", 45, 265);\r\n\r\n            pdfDoc.save(`Nota_Entrega_${numeroNota}.pdf`);\r\n            return { numeroNota };\r\n        };\r\n\r\n        // **NUEVO CÓDIGO PARA LA FUNCIÓN handleCompleteTask**\r\n        const handleCompleteTask = async () => {\r\n            if (!evidenceFile) {\r\n                setError(\"Es obligatorio subir el archivo PDF de evidencia.\");\r\n                return;\r\n            }\r\n            setLoading(true);\r\n            setError('');\r\n\r\n            try {\r\n                const evidenceRef = ref(storage, `evidencia_tecnicos/${project.id}/${evidenceFile.name}`);\r\n                const evidenceUploadTask = uploadBytesResumable(evidenceRef, evidenceFile);\r\n                const evidenceUrl = await getDownloadURL((await evidenceUploadTask).ref);\r\n\r\n                const { numeroNota } = await generateAndSaveNota();\r\n                \r\n                const projectRef = doc(db, \"proyectos\", project.id);\r\n                const updatePayload = {\r\n                    estado: 'Terminado Internamente',\r\n                    comentariosTecnico: comments\r\n                };\r\n\r\n                // Lógica para guardar la fecha de la primera o segunda entrega\r\n                if (!project.urlDocumento1) { // Si el documento 1 no existe, esta es la primera entrega\r\n                    updatePayload.urlEvidenciaTecnico1 = evidenceUrl;\r\n                    updatePayload.numeroNotaInterna1 = numeroNota;\r\n                    updatePayload.fechaFinTecnico1 = Timestamp.now();\r\n                } else { // Si el documento 1 ya existe, esta es la segunda entrega\r\n                    updatePayload.urlEvidenciaTecnico2 = evidenceUrl;\r\n                    updatePayload.numeroNotaInterna2 = numeroNota;\r\n                    updatePayload.fechaFinTecnico2 = Timestamp.now();\r\n                }\r\n\r\n                await updateDoc(projectRef, updatePayload);\r\n                \r\n                onFinalized();\r\n                onClose();\r\n\r\n            } catch (err) {\r\n                console.error(\"Error al completar la tarea:\", err);\r\n                setError(err.message || \"Ocurrió un error al guardar los datos.\");\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n                <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\">\r\n                    <h3 className=\"text-lg font-bold mb-4\">Gestionar Tarea: {project.npu}</h3>\r\n                    <div className=\"space-y-4\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700\">Comentarios Finales (para Nota de Entrega)</label>\r\n                            <textarea value={comments} onChange={e => setComments(e.target.value)} rows=\"4\" className=\"mt-1 block w-full px-3 py-2 border rounded-md\"></textarea>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700\">Subir Evidencia Técnica (PDF)</label>\r\n                            <input type=\"file\" accept=\".pdf\" onChange={handleFileChange} className=\"mt-1 block w-full text-sm\"/>\r\n                        </div>\r\n                    </div>\r\n                    <Alert message={error} type=\"error\" onClose={() => setError('')} />\r\n                    <div className=\"mt-6 flex justify-end space-x-3\">\r\n                        <button onClick={onClose} disabled={loading} className=\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded\">Cancelar</button>\r\n                        <button onClick={handleCompleteTask} disabled={loading} className=\"bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded\">{loading ? 'Enviando...' : 'Generar Nota y Finalizar Tarea'}</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const formatDate = (timestamp) => !timestamp ? '---' : new Date(timestamp.seconds * 1000).toLocaleDateString('es-MX');\r\n\r\n    return (\r\n        <>\r\n            <div className=\"overflow-x-auto bg-white rounded-lg shadow\">\r\n                <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-50\">\r\n                        <tr>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Cliente</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Servicio</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Fecha Límite</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Acciones</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                        {projects.map(project => (\r\n                             <tr key={project.id}>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.clienteNombre}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.servicioNombre}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{formatDate(project.fechaEntregaInterna)}</td>\r\n                                <td className=\"px-6 py-4\">\r\n                                    <div className=\"flex items-center space-x-4\">\r\n                                        {project.tecnicosStatus[user.uid] === 'No Visto' && <button onClick={() => handleStartProject(project)} className=\"text-green-600 hover:text-green-900\">Empezar</button>}\r\n                                        {project.tecnicosStatus[user.uid] === 'En Proceso' && (\r\n                                            <>\r\n                                                <button onClick={() => { setModalProject(project); setModalType('task'); }} className=\"text-indigo-600\">Gestionar Tarea</button>\r\n                                                <button onClick={() => { setModalProject(project); setModalType('log'); }} className=\"text-gray-600\">Bitácora</button>\r\n                                            </>\r\n                                        )}\r\n                                    </div>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n            {modalProject && modalType === 'task' && <ManageTaskModal project={modalProject} onClose={() => setModalProject(null)} onFinalized={onUpdateProject} />}\r\n            {modalProject && modalType === 'log' && <ProjectLogModal project={modalProject} user={user} userData={userData} onClose={() => setModalProject(null)} />}\r\n        </>\r\n    );\r\n};\r\n\r\n// **CÓDIGO COMPLETO Y CORREGIDO PARA FinanzasDashboard (CON REACTIVACIÓN AUTOMÁTICA)**\r\nconst FinanzasDashboard = ({ user, userData }) => {\r\n    const [view, setView] = useState('pendientes');\r\n    const [projects, setProjects] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const fetchPendingProjects = () => {\r\n        setLoading(true);\r\n        const q = query(collection(db, \"proyectos\"), where(\"estado\", \"in\", [\"Pendiente de Factura\", \"Facturado\"]));\r\n        \r\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n            const projectsData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            \r\n            // **NUEVA LÓGICA DE REACTIVACIÓN AUTOMÁTICA**\r\n            projectsData.forEach(project => {\r\n                if (project.estado === 'Facturado' && project.faseFacturacion === 'Preliminar') {\r\n                    console.log(`[AUTO-REACTIVACIÓN] Proyecto ${project.npu} detectado para Fase 2.`);\r\n                    const projectRef = doc(db, \"proyectos\", project.id);\r\n                    const newTecnicosStatus = {};\r\n                    if (project.asignadoTecnicosIds) {\r\n                        project.asignadoTecnicosIds.forEach(techId => {\r\n                            newTecnicosStatus[techId] = 'En Proceso';\r\n                        });\r\n                    }\r\n                    updateDoc(projectRef, {\r\n                        estado: 'Activo',\r\n                        tecnicosStatus: newTecnicosStatus,\r\n                        faseFacturacion: 'Fase 2 Pendiente'\r\n                    });\r\n                }\r\n            });\r\n\r\n            // Filtra los proyectos ya reactivados para no mostrarlos en \"Pendientes\"\r\n            setProjects(projectsData.filter(p => p.estado === 'Pendiente de Factura'));\r\n            setLoading(false);\r\n        });\r\n        \r\n        return unsubscribe;\r\n    };\r\n\r\n    useEffect(() => {\r\n        let unsubscribe = () => {};\r\n        if (view === 'pendientes') {\r\n            unsubscribe = fetchPendingProjects();\r\n        } else {\r\n            setLoading(false);\r\n        }\r\n        return () => unsubscribe();\r\n    }, [view]);\r\n\r\n    return (\r\n        <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">Panel de Finanzas</h1>\r\n            <div className=\"mb-6 border-b border-gray-200\">\r\n                <nav className=\"-mb-px flex space-x-8\" aria-label=\"Tabs\">\r\n                    <button onClick={() => setView('pendientes')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'pendientes' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>\r\n                        Pendientes de Gestión\r\n                    </button>\r\n                    <button onClick={() => setView('cobrar')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'cobrar' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>\r\n                        Cuentas por Cobrar\r\n                    </button>\r\n                    <button onClick={() => setView('pagar')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'pagar' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>\r\n                        Cuentas por Pagar\r\n                    </button>\r\n                </nav>\r\n            </div>\r\n\r\n            {view === 'pendientes' && (\r\n                <div>\r\n                    <h2 className=\"text-2xl font-bold text-gray-800 my-6\">Proyectos Pendientes de Facturar</h2>\r\n                    {loading ? <p>Cargando proyectos...</p> : \r\n                        <PendingInvoicesTable projects={projects} onUpdate={fetchPendingProjects} />\r\n                    }\r\n                </div>\r\n            )}\r\n            {view === 'cobrar' && <InvoicesList invoiceType=\"cliente\" onUpdate={() => {}} />}\r\n            {view === 'pagar' && <InvoicesList invoiceType=\"proveedor\" onUpdate={() => {}} />}\r\n        </div>\r\n    );\r\n};\r\n\r\n// **CÓDIGO COMPLETO Y CORREGIDO PARA PendingInvoicesTable**\r\nconst PendingInvoicesTable = ({ projects, onUpdate }) => {\r\n    const [modalProject, setModalProject] = useState(null);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const [itemsPerPage, setItemsPerPage] = useState(10);\r\n\r\n    const AttachInvoicesModal = ({ project, onClose, onFinalized }) => {\r\n        const [mode, setMode] = useState('upload');\r\n        const [clientInvoice, setClientInvoice] = useState({ folio: '', monto: project.precioCotizacionCliente || '', fechaEmision: new Date().toISOString().split('T')[0] });\r\n        const [clientFiles, setClientFiles] = useState({ xmlFile: null, pdfFile: null });\r\n        const [providerInvoice, setProviderInvoice] = useState({ folio: '', monto: project.costoProveedor || '', fechaEmision: new Date().toISOString().split('T')[0] });\r\n        const [providerFiles, setProviderFiles] = useState({ xmlFile: null, pdfFile: null });\r\n        const [linkableInvoices, setLinkableInvoices] = useState([]);\r\n        const [selectedClientInvoiceId, setSelectedClientInvoiceId] = useState('');\r\n        const [selectedProviderInvoiceId, setSelectedProviderInvoiceId] = useState('');\r\n        const [loading, setLoading] = useState(false);\r\n        const [error, setError] = useState('');\r\n        \r\n        const isInternalProvider = project.proveedorNombre?.toLowerCase().includes(\"ecologia\");\r\n\r\n        useEffect(() => {\r\n            if (mode === 'link') {\r\n                const q = query(collection(db, \"facturas\"), orderBy(\"fechaEmision\", \"desc\"));\r\n                const unsubscribe = onSnapshot(q, (snapshot) => {\r\n                    setLinkableInvoices(snapshot.docs.map(doc => ({id: doc.id, ...doc.data()})));\r\n                });\r\n                return () => unsubscribe();\r\n            }\r\n        }, [mode]);\r\n        \r\n        // **FUNCIONES RESTAURADAS**\r\n        const handleChange = (setter) => (e) => {\r\n            const { name, value } = e.target;\r\n            setter(prev => ({ ...prev, [name]: value }));\r\n        };\r\n\r\n        const handleFileChange = (setter) => (e) => {\r\n            const { name, files: inputFiles } = e.target;\r\n            if (inputFiles[0]) setter(prev => ({ ...prev, [name]: inputFiles[0] }));\r\n        };\r\n        \r\n        const uploadFile = async (file, path) => {\r\n            if (!file) return null;\r\n            const storageRef = ref(storage, path);\r\n            const uploadTask = uploadBytesResumable(storageRef, file);\r\n            return getDownloadURL((await uploadTask).ref);\r\n        };\r\n\r\n        const handleSave = async () => {\r\n            setLoading(true);\r\n            setError('');\r\n            try {\r\n                const projectRef = doc(db, \"proyectos\", project.id);\r\n                const updatePayload = {};\r\n                let finalFacturaClienteIds = project.facturasClienteIds || [];\r\n                let finalFacturaProveedorIds = project.facturasProveedorIds || [];\r\n\r\n                if (mode === 'upload') {\r\n                    if (clientFiles.xmlFile && clientFiles.pdfFile && clientInvoice.folio) {\r\n                        const urlXml = await uploadFile(clientFiles.xmlFile, `facturas_clientes/${project.id}/${clientFiles.xmlFile.name}`);\r\n                        const urlPdf = await uploadFile(clientFiles.pdfFile, `facturas_clientes/${project.id}/${clientFiles.pdfFile.name}`);\r\n                        const newInvoiceRef = await addDoc(collection(db, \"facturas\"), {\r\n                            tipo: \"cliente\", proyectoId: project.id, folio: clientInvoice.folio, monto: Number(clientInvoice.monto),\r\n                            fechaEmision: Timestamp.fromDate(new Date(clientInvoice.fechaEmision)), estado: \"Pendiente\", urlXml, urlPdf,\r\n                            clienteNombre: project.clienteNombre\r\n                        });\r\n                        finalFacturaClienteIds.push(newInvoiceRef.id);\r\n                        updatePayload.facturasClienteIds = finalFacturaClienteIds;\r\n                    }\r\n                    if (!isInternalProvider && providerFiles.xmlFile && providerFiles.pdfFile && providerInvoice.folio) {\r\n                        const urlXml = await uploadFile(providerFiles.xmlFile, `facturas_proveedores/${project.id}/${providerFiles.xmlFile.name}`);\r\n                        const urlPdf = await uploadFile(providerFiles.pdfFile, `facturas_proveedores/${project.id}/${providerFiles.pdfFile.name}`);\r\n                        const newInvoiceRef = await addDoc(collection(db, \"facturas\"), {\r\n                            tipo: \"proveedor\", proyectoId: project.id, folio: providerInvoice.folio, monto: Number(providerInvoice.monto),\r\n                            fechaEmision: Timestamp.fromDate(new Date(providerInvoice.fechaEmision)), estado: \"Pendiente\", urlXml, urlPdf,\r\n                            proveedorNombre: project.proveedorNombre\r\n                        });\r\n                        finalFacturaProveedorIds.push(newInvoiceRef.id);\r\n                        updatePayload.facturasProveedorIds = finalFacturaProveedorIds;\r\n                    }\r\n                } else { // mode === 'link'\r\n                    if (selectedClientInvoiceId) {\r\n                        await updateDoc(doc(db, \"facturas\", selectedClientInvoiceId), { proyectosIds: arrayUnion(project.id) });\r\n                        finalFacturaClienteIds.push(selectedClientInvoiceId);\r\n                        updatePayload.facturasClienteIds = arrayUnion(selectedClientInvoiceId);\r\n                    }\r\n                    if (selectedProviderInvoiceId && !isInternalProvider) {\r\n                        await updateDoc(doc(db, \"facturas\", selectedProviderInvoiceId), { proyectosIds: arrayUnion(project.id) });\r\n                        finalFacturaProveedorIds.push(selectedProviderInvoiceId);\r\n                        updatePayload.facturasProveedorIds = arrayUnion(selectedProviderInvoiceId);\r\n                    }\r\n                }\r\n                \r\n                const isClientInvoiceReady = finalFacturaClienteIds.length > 0;\r\n                const isProviderInvoiceReady = isInternalProvider || finalFacturaProveedorIds.length > 0;\r\n\r\n                if (isClientInvoiceReady && isProviderInvoiceReady) {\r\n                    updatePayload.estado = 'Facturado';\r\n                }\r\n                \r\n                if (Object.keys(updatePayload).length > 0) {\r\n                    await updateDoc(projectRef, updatePayload);\r\n                }\r\n                \r\n                onFinalized();\r\n                onClose();\r\n\r\n            } catch (err) {\r\n                console.error(\"Error al guardar la factura:\", err);\r\n                setError(\"Ocurrió un error al guardar la factura.\");\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n                <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl\">\r\n                    <h3 className=\"text-lg font-bold mb-4\">Gestionar Facturas: {project.npu}</h3>\r\n                    \r\n                    <div className=\"mb-4 border-b\">\r\n                        <nav className=\"-mb-px flex space-x-8\">\r\n                            <button onClick={() => setMode('upload')} className={`py-2 px-1 border-b-2 font-medium text-sm ${mode === 'upload' ? 'border-blue-500' : 'border-transparent'}`}>Subir Nueva Factura</button>\r\n                            <button onClick={() => setMode('link')} className={`py-2 px-1 border-b-2 font-medium text-sm ${mode === 'link' ? 'border-blue-500' : 'border-transparent'}`}>Enlazar Factura Existente</button>\r\n                        </nav>\r\n                    </div>\r\n\r\n                    {mode === 'upload' && (\r\n                        <div className={`grid grid-cols-1 ${!isInternalProvider ? 'md:grid-cols-2' : ''} gap-6`}>\r\n                            <div className=\"space-y-4 p-4 border rounded-lg\">\r\n                                <h4 className=\"font-semibold text-gray-800\">Factura a Cliente</h4>\r\n                                {project.facturaClienteId ? <p className=\"text-green-600\">✓ Factura ya adjuntada.</p> : <>\r\n                                    <input type=\"text\" name=\"folio\" placeholder=\"Folio Factura\" value={clientInvoice.folio} onChange={handleChange(setClientInvoice)} className=\"block w-full border rounded-md p-2\"/>\r\n                                    <input type=\"number\" name=\"monto\" placeholder=\"Monto\" value={clientInvoice.monto} onChange={handleChange(setClientInvoice)} className=\"block w-full border rounded-md p-2\"/>\r\n                                    <input type=\"date\" name=\"fechaEmision\" value={clientInvoice.fechaEmision} onChange={handleChange(setClientInvoice)} className=\"block w-full border rounded-md p-2\"/>\r\n                                    <label className=\"text-xs\">XML:</label><input type=\"file\" name=\"xmlFile\" accept=\".xml\" onChange={handleFileChange(setClientFiles)} className=\"block w-full text-sm\"/>\r\n                                    <label className=\"text-xs\">PDF:</label><input type=\"file\" name=\"pdfFile\" accept=\".pdf\" onChange={handleFileChange(setClientFiles)} className=\"block w-full text-sm\"/>\r\n                                </>}\r\n                            </div>\r\n                            {!isInternalProvider && (\r\n                                <div className=\"space-y-4 p-4 border rounded-lg\">\r\n                                    <h4 className=\"font-semibold text-gray-800\">Factura de Proveedor</h4>\r\n                                    {project.facturaProveedorId ? <p className=\"text-green-600\">✓ Factura ya adjuntada.</p> : <>\r\n                                        <input type=\"text\" name=\"folio\" placeholder=\"Folio Factura\" value={providerInvoice.folio} onChange={handleChange(setProviderInvoice)} className=\"block w-full border rounded-md p-2\"/>\r\n                                        <input type=\"number\" name=\"monto\" placeholder=\"Monto\" value={providerInvoice.monto} onChange={handleChange(setProviderInvoice)} className=\"block w-full border rounded-md p-2\"/>\r\n                                        <input type=\"date\" name=\"fechaEmision\" value={providerInvoice.fechaEmision} onChange={handleChange(setProviderInvoice)} className=\"block w-full border rounded-md p-2\"/>\r\n                                        <label className=\"text-xs\">XML:</label><input type=\"file\" name=\"xmlFile\" accept=\".xml\" onChange={handleFileChange(setProviderFiles)} className=\"block w-full text-sm\"/>\r\n                                        <label className=\"text-xs\">PDF:</label><input type=\"file\" name=\"pdfFile\" accept=\".pdf\" onChange={handleFileChange(setProviderFiles)} className=\"block w-full text-sm\"/>\r\n                                    </>}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n\r\n                    {mode === 'link' && (\r\n                        <div className={`grid grid-cols-1 ${!isInternalProvider ? 'md:grid-cols-2' : ''} gap-6`}>\r\n                            <div className=\"space-y-4 p-4 border rounded-lg\">\r\n                                <h4 className=\"font-semibold text-gray-800\">Enlazar Factura de Cliente</h4>\r\n                                <select value={selectedClientInvoiceId} onChange={(e) => setSelectedClientInvoiceId(e.target.value)} className=\"block w-full border rounded-md p-2\">\r\n                                    <option value=\"\">Seleccione una factura...</option>\r\n                                    {linkableInvoices.filter(inv => inv.tipo === 'cliente').map(inv => (\r\n                                        <option key={inv.id} value={inv.id}>\r\n                                            {`Folio: ${inv.folio} - ${inv.clienteNombre} - $${inv.monto.toFixed(2)}`}\r\n                                        </option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n                            {!isInternalProvider && (\r\n                                <div className=\"space-y-4 p-4 border rounded-lg\">\r\n                                    <h4 className=\"font-semibold text-gray-800\">Enlazar Factura de Proveedor</h4>\r\n                                    <select value={selectedProviderInvoiceId} onChange={(e) => setSelectedProviderInvoiceId(e.target.value)} className=\"block w-full border rounded-md p-2\">\r\n                                        <option value=\"\">Seleccione una factura...</option>\r\n                                        {linkableInvoices.filter(inv => inv.tipo === 'proveedor').map(inv => (\r\n                                            <option key={inv.id} value={inv.id}>\r\n                                                {`Folio: ${inv.folio} - ${inv.proveedorNombre} - $${inv.monto.toFixed(2)}`}\r\n                                            </option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n\r\n                    <Alert message={error} type=\"error\" onClose={() => setError('')} />\r\n                    <div className=\"mt-6 flex justify-end space-x-3\">\r\n                        <button onClick={onClose} className=\"bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded\">Cancelar</button>\r\n                        <button onClick={handleSave} className=\"bg-[#b0ef26] text-black font-bold py-2 px-4 rounded\">{loading ? 'Guardando...' : 'Guardar Cambios'}</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const filteredProjects = projects.filter(p => (p.npu && p.npu.toLowerCase().includes(searchTerm.toLowerCase())) || (p.clienteNombre && p.clienteNombre.toLowerCase().includes(searchTerm.toLowerCase())) || (p.servicioNombre && p.servicioNombre.toLowerCase().includes(searchTerm.toLowerCase())));\r\n    const currentItems = filteredProjects.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage);\r\n    const totalPages = Math.ceil(filteredProjects.length / itemsPerPage);\r\n    const paginate = (pageNumber) => setCurrentPage(pageNumber);\r\n\r\n    return (\r\n        <>\r\n            <div className=\"mb-4 flex flex-col md:flex-row justify-between items-center\">\r\n                <input type=\"text\" placeholder=\"Buscar por NPU, cliente o servicio...\" className=\"w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md mb-2 md:mb-0\" onChange={(e) => { setSearchTerm(e.target.value); setCurrentPage(1); }}/>\r\n                <div className=\"flex items-center\">\r\n                    <span className=\"text-sm mr-2\">Mostrar:</span>\r\n                    <select value={itemsPerPage} onChange={(e) => { setItemsPerPage(Number(e.target.value)); setCurrentPage(1); }} className=\"px-2 py-1 border border-gray-300 rounded-md\">\r\n                        <option value={10}>10</option><option value={25}>25</option><option value={50}>50</option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n            <div className=\"overflow-x-auto bg-white rounded-lg shadow\">\r\n                <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-50\">\r\n                        <tr>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">NPU</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Cliente</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Servicio</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Docs Admin</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Factura Cliente</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Factura Proveedor</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Acciones</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                        {currentItems.map(project => (\r\n                             <tr key={project.id}>\r\n                                <td className=\"px-6 py-4\">{project.npu}</td>\r\n                                <td className=\"px-6 py-4\">{project.clienteNombre}</td>\r\n                                <td className=\"px-6 py-4\">{project.servicioNombre}</td>\r\n                                <td className=\"px-6 py-4\"><div className=\"flex space-x-2 text-sm\">{project.urlCotizacionCliente && <a href={project.urlCotizacionCliente} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500\">Cot.C</a>}{project.urlPOCliente && <a href={project.urlPOCliente} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-500\">PO.C</a>}</div></td>\r\n                                <td className=\"px-6 py-4\">{project.facturaClienteId ? <span className=\"text-green-600\">✓ Adjuntada</span> : <span className=\"text-orange-500\">Pendiente</span>}</td>\r\n                                <td className=\"px-6 py-4\">{project.proveedorNombre?.toLowerCase().includes(\"ecologia\") ? <span className=\"text-gray-500\">N/A</span> : project.facturaProveedorId ? <span className=\"text-green-600\">✓ Adjuntada</span> : <span className=\"text-orange-500\">Pendiente</span>}</td>\r\n                                <td className=\"px-6 py-4\"><button onClick={() => setModalProject(project)} className=\"text-indigo-600 hover:text-indigo-900\">Gestionar Facturas</button></td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n            <div className=\"mt-4 flex justify-between items-center\">\r\n                <span className=\"text-sm text-gray-700\">Página {currentPage} de {totalPages}</span>\r\n                <div>\r\n                    <button onClick={() => paginate(currentPage - 1)} disabled={currentPage === 1} className=\"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50\">Anterior</button>\r\n                    <button onClick={() => paginate(currentPage + 1)} disabled={currentPage === totalPages || totalPages === 0} className=\"px-3 py-1 border rounded-md bg-white disabled:opacity-50\">Siguiente</button>\r\n                </div>\r\n            </div>\r\n            {modalProject && <AttachInvoicesModal project={modalProject} onClose={() => setModalProject(null)} onFinalized={onUpdate} />}\r\n        </>\r\n    );\r\n};\r\n\r\n// **CÓDIGO MEJORADO Y COMPLETO PARA InvoicesList**\r\nconst InvoicesList = ({ invoiceType, onUpdate }) => {\r\n    const [invoices, setInvoices] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [showAddModal, setShowAddModal] = useState(false);\r\n    const [modalInvoice, setModalInvoice] = useState(null);\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const [itemsPerPage, setItemsPerPage] = useState(10);\r\n\r\n    useEffect(() => {\r\n        setLoading(true);\r\n        const q = query(collection(db, \"facturas\"), where(\"tipo\", \"==\", invoiceType), orderBy(\"fechaEmision\", \"desc\"));\r\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n            setInvoices(querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));\r\n            setLoading(false);\r\n        });\r\n        return () => unsubscribe();\r\n    }, [invoiceType]);\r\n\r\n    const filteredInvoices = invoices.filter(invoice => \r\n        (invoice.folio && invoice.folio.toLowerCase().includes(searchTerm.toLowerCase())) ||\r\n        (invoice.clienteNombre && invoice.clienteNombre.toLowerCase().includes(searchTerm.toLowerCase())) ||\r\n        (invoice.proveedorNombre && invoice.proveedorNombre.toLowerCase().includes(searchTerm.toLowerCase())) ||\r\n        (invoice.descripcion && invoice.descripcion.toLowerCase().includes(searchTerm.toLowerCase()))\r\n    );\r\n\r\n    const indexOfLastItem = currentPage * itemsPerPage;\r\n    const indexOfFirstItem = indexOfLastItem - itemsPerPage;\r\n    const currentItems = filteredInvoices.slice(indexOfFirstItem, indexOfLastItem);\r\n    const totalPages = Math.ceil(filteredInvoices.length / itemsPerPage);\r\n\r\n    const paginate = (pageNumber) => setCurrentPage(pageNumber);\r\n\r\n    const AddGeneralInvoiceModal = ({ onClose, onFinalized }) => {\r\n        const [formData, setFormData] = useState({ folio: '', monto: '', fechaEmision: new Date().toISOString().split('T')[0], entidadId: '', descripcion: '' });\r\n        const [files, setFiles] = useState({ xmlFile: null, pdfFile: null });\r\n        const [entities, setEntities] = useState([]);\r\n        const [otherEntityName, setOtherEntityName] = useState('');\r\n        const [loading, setLoading] = useState(false);\r\n        const [error, setError] = useState('');\r\n\r\n        useEffect(() => {\r\n            let q;\r\n            if (invoiceType === 'cliente') {\r\n                q = query(collection(db, \"usuarios\"), where(\"rol\", \"==\", \"cliente\"));\r\n            } else {\r\n                q = query(collection(db, \"proveedores\"));\r\n            }\r\n            getDocs(q).then(snapshot => {\r\n                const entityList = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n                const sortedEntities = entityList.sort((a, b) => (a.nombreCompleto || a.nombre).localeCompare(b.nombreCompleto || b.nombre));\r\n                setEntities(sortedEntities);\r\n            });\r\n        }, []);\r\n        \r\n        const handleChange = (e) => {\r\n            const { name, value } = e.target;\r\n            setFormData(prev => ({ ...prev, [name]: value }));\r\n        };\r\n\r\n        const handleFileChange = (e) => {\r\n            const { name, files: inputFiles } = e.target;\r\n            if (inputFiles[0]) {\r\n                setFiles(prev => ({ ...prev, [name]: inputFiles[0] }));\r\n            }\r\n        };\r\n\r\n        const uploadFile = async (file, path) => {\r\n            if (!file) return null;\r\n            const storageRef = ref(storage, path);\r\n            const uploadTask = uploadBytesResumable(storageRef, file);\r\n            return getDownloadURL((await uploadTask).ref);\r\n        };\r\n\r\n        const handleSave = async () => {\r\n            if (!formData.folio || !formData.monto || !files.xmlFile || !files.pdfFile || (formData.entidadId === '' || (formData.entidadId === 'otro' && !otherEntityName))) {\r\n                setError(\"Todos los campos y archivos son obligatorios.\");\r\n                return;\r\n            }\r\n            setLoading(true);\r\n            try {\r\n                const urlXml = await uploadFile(files.xmlFile, `facturas_${invoiceType}/${Date.now()}/${files.xmlFile.name}`);\r\n                const urlPdf = await uploadFile(files.pdfFile, `facturas_${invoiceType}/${Date.now()}/${files.pdfFile.name}`);\r\n                \r\n                const entityName = formData.entidadId === 'otro' \r\n                    ? otherEntityName \r\n                    : entities.find(e => e.id === formData.entidadId)?.nombreCompleto || entities.find(e => e.id === formData.entidadId)?.nombre;\r\n\r\n                await addDoc(collection(db, \"facturas\"), {\r\n                    tipo: invoiceType,\r\n                    proyectoId: \"general\",\r\n                    folio: formData.folio,\r\n                    monto: Number(formData.monto),\r\n                    fechaEmision: Timestamp.fromDate(new Date(formData.fechaEmision)),\r\n                    estado: \"Pendiente\",\r\n                    descripcion: formData.descripcion || '',\r\n                    urlXml,\r\n                    urlPdf,\r\n                    [invoiceType === 'cliente' ? 'clienteNombre' : 'proveedorNombre']: entityName\r\n                });\r\n                onFinalized();\r\n                onClose();\r\n            } catch (err) {\r\n                console.error(\"Error al guardar factura general:\", err);\r\n                setError(\"Ocurrió un error al guardar.\");\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n                <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\">\r\n                    <h3 className=\"text-lg font-bold mb-4\">Añadir Factura General ({invoiceType})</h3>\r\n                    <div className=\"space-y-4\">\r\n                        <select value={formData.entidadId} onChange={handleChange} name=\"entidadId\" className=\"block w-full border rounded-md p-2\">\r\n                            <option value=\"\">Seleccione un {invoiceType}</option>\r\n                            {entities.map(e => <option key={e.id} value={e.id}>{e.nombreCompleto || e.nombre}</option>)}\r\n                            <option value=\"otro\">Otro (especificar)</option>\r\n                        </select>\r\n                        {formData.entidadId === 'otro' && (\r\n                            <input type=\"text\" value={otherEntityName} onChange={(e) => setOtherEntityName(e.target.value)} placeholder={`Nombre del ${invoiceType}`} className=\"block w-full border rounded-md p-2\"/>\r\n                        )}\r\n                        <input type=\"text\" name=\"descripcion\" placeholder=\"Descripción (ej: Renta de oficina)\" value={formData.descripcion} onChange={handleChange} className=\"block w-full border rounded-md p-2\"/>\r\n                        <input type=\"text\" name=\"folio\" placeholder=\"Folio\" value={formData.folio} onChange={handleChange} className=\"block w-full border rounded-md p-2\"/>\r\n                        <input type=\"number\" name=\"monto\" placeholder=\"Monto\" value={formData.monto} onChange={handleChange} className=\"block w-full border rounded-md p-2\"/>\r\n                        <input type=\"date\" name=\"fechaEmision\" value={formData.fechaEmision} onChange={handleChange} className=\"block w-full border rounded-md p-2\"/>\r\n                        <label className=\"text-xs\">XML:</label><input type=\"file\" name=\"xmlFile\" accept=\".xml\" onChange={handleFileChange} className=\"block w-full text-sm\"/>\r\n                        <label className=\"text-xs\">PDF:</label><input type=\"file\" name=\"pdfFile\" accept=\".pdf\" onChange={handleFileChange} className=\"block w-full text-sm\"/>\r\n                    </div>\r\n                     <Alert message={error} type=\"error\" onClose={() => setError('')} />\r\n                    <div className=\"mt-6 flex justify-end space-x-3\">\r\n                        <button onClick={onClose}>Cancelar</button>\r\n                        <button onClick={handleSave} className=\"bg-[#b0ef26] text-black font-bold py-2 px-4 rounded\">{loading ? 'Guardando...' : 'Guardar'}</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const ManageInvoiceModal = ({ invoice, onClose, onFinalized }) => {\r\n        const [formData, setFormData] = useState({\r\n            fechaPromesaPago: invoice.fechaPromesaPago ? invoice.fechaPromesaPago.toDate().toISOString().split('T')[0] : '',\r\n            fechaPagoReal: invoice.fechaPagoReal ? invoice.fechaPagoReal.toDate().toISOString().split('T')[0] : ''\r\n        });\r\n        const [loading, setLoading] = useState(false);\r\n\r\n        const handleSave = async () => {\r\n            setLoading(true);\r\n            const updatePayload = {\r\n                fechaPromesaPago: formData.fechaPromesaPago ? Timestamp.fromDate(new Date(formData.fechaPromesaPago)) : null,\r\n                fechaPagoReal: formData.fechaPagoReal ? Timestamp.fromDate(new Date(formData.fechaPagoReal)) : null,\r\n            };\r\n            if (formData.fechaPagoReal) {\r\n                updatePayload.estado = \"Pagada\";\r\n            } else if (invoice.estado === \"Pagada\") {\r\n                updatePayload.estado = \"Pendiente\";\r\n            }\r\n            await updateDoc(doc(db, \"facturas\", invoice.id), updatePayload);\r\n            onFinalized();\r\n            onClose();\r\n        };\r\n        \r\n        const handleCancelInvoice = async () => {\r\n            if (window.confirm(\"¿Estás seguro de que quieres cancelar esta factura? Esta acción es irreversible.\")) {\r\n                setLoading(true);\r\n                await updateDoc(doc(db, \"facturas\", invoice.id), { estado: \"Cancelada\" });\r\n                if (invoice.proyectoId && invoice.proyectoId !== 'general') {\r\n                    const fieldToUpdate = invoice.tipo === 'cliente' ? 'facturaClienteId' : 'facturaProveedorId';\r\n                    await updateDoc(doc(db, \"proyectos\", invoice.proyectoId), { \r\n                        [fieldToUpdate]: deleteField(),\r\n                        estado: 'Pendiente de Factura'\r\n                    });\r\n                }\r\n                onFinalized();\r\n                onClose();\r\n            }\r\n        };\r\n\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n                <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\">\r\n                    <h3 className=\"text-lg font-bold mb-4\">Gestionar Factura: {invoice.folio}</h3>\r\n                    <div className=\"space-y-4\">\r\n                        <div><label className=\"block text-sm font-medium\">Fecha Promesa de Pago</label><input type=\"date\" value={formData.fechaPromesaPago} onChange={e => setFormData({...formData, fechaPromesaPago: e.target.value})} className=\"mt-1 block w-full border rounded-md p-2\"/></div>\r\n                        <div><label className=\"block text-sm font-medium\">Fecha de Pago Real</label><input type=\"date\" value={formData.fechaPagoReal} onChange={e => setFormData({...formData, fechaPagoReal: e.target.value})} className=\"mt-1 block w-full border rounded-md p-2\"/></div>\r\n                    </div>\r\n                    <div className=\"mt-6 flex justify-between items-center\">\r\n                        <button onClick={handleCancelInvoice} disabled={loading} className=\"bg-red-600 text-white font-bold py-2 px-4 rounded disabled:bg-red-300\">Cancelar Factura</button>\r\n                        <div>\r\n                            <button onClick={onClose} disabled={loading} className=\"bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded mr-2\">Cerrar</button>\r\n                            <button onClick={handleSave} disabled={loading} className=\"bg-[#b0ef26] text-black font-bold py-2 px-4 rounded\">{loading ? 'Guardando...' : 'Guardar'}</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const formatDate = (timestamp) => !timestamp ? '---' : new Date(timestamp.seconds * 1000).toLocaleDateString('es-MX');\r\n    \r\n    const getStatusClass = (invoice) => {\r\n        if (invoice.estado === 'Pagada') return 'bg-green-100 text-green-800';\r\n        if (invoice.estado === 'Cancelada') return 'bg-gray-100 text-gray-500 line-through';\r\n        if (invoice.fechaVencimiento && invoice.fechaVencimiento.toDate() < new Date()) return 'bg-red-100 text-red-800';\r\n        return 'bg-orange-100 text-orange-800';\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <div className=\"mb-4 flex flex-col md:flex-row justify-between items-center\">\r\n                <input \r\n                    type=\"text\"\r\n                    placeholder=\"Buscar por folio, cliente/prov. o descripción...\"\r\n                    className=\"w-full md:w-1/3 px-3 py-2 border border-gray-300 rounded-md mb-2 md:mb-0\"\r\n                    onChange={(e) => { setSearchTerm(e.target.value); setCurrentPage(1); }}\r\n                />\r\n                <div className=\"flex items-center\">\r\n                    <span className=\"text-sm mr-2\">Mostrar:</span>\r\n                    <select value={itemsPerPage} onChange={(e) => { setItemsPerPage(Number(e.target.value)); setCurrentPage(1); }} className=\"px-2 py-1 border border-gray-300 rounded-md\">\r\n                        <option value={10}>10</option>\r\n                        <option value={25}>25</option>\r\n                        <option value={50}>50</option>\r\n                    </select>\r\n                    <button onClick={() => setShowAddModal(true)} className=\"ml-4 bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-2 px-4 rounded-lg\">\r\n                        + Añadir Factura General\r\n                    </button>\r\n                </div>\r\n            </div>\r\n            <div className=\"overflow-x-auto bg-white rounded-lg shadow\">\r\n                <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-50\">\r\n                        <tr>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium uppercase\">Folio</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium uppercase\">{invoiceType === 'cliente' ? 'Cliente' : 'Proveedor'}</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium uppercase\">Descripción</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium uppercase\">Monto</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium uppercase\">Fecha Emisión</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium uppercase\">Fecha Promesa Pago</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium uppercase\">Fecha Pago</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium uppercase\">Estado</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium uppercase\">Acciones</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                        {loading ? <tr><td colSpan=\"9\">Cargando...</td></tr> : currentItems.map(invoice => (\r\n                            <tr key={invoice.id}>\r\n                                <td className=\"px-6 py-4\">{invoice.folio}</td>\r\n                                <td className=\"px-6 py-4\">{invoice.clienteNombre || invoice.proveedorNombre}</td>\r\n                                <td className=\"px-6 py-4\">{invoice.descripcion || (invoice.proyectoId !== 'general' ? 'Gasto de Proyecto' : '---')}</td>\r\n                                <td className=\"px-6 py-4\">${(invoice.monto || 0).toFixed(2)}</td>\r\n                                <td className=\"px-6 py-4\">{formatDate(invoice.fechaEmision)}</td>\r\n                                <td className=\"px-6 py-4\">{formatDate(invoice.fechaPromesaPago)}</td>\r\n                                <td className=\"px-6 py-4\">{formatDate(invoice.fechaPagoReal)}</td>\r\n                                <td className=\"px-6 py-4\"><span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusClass(invoice)}`}>{invoice.estado}</span></td>\r\n                                <td className=\"px-6 py-4\"><button onClick={() => setModalInvoice(invoice)} className=\"text-indigo-600\">Gestionar</button></td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n            <div className=\"mt-4 flex justify-between items-center\">\r\n                <span className=\"text-sm text-gray-700\">Página {currentPage} de {totalPages}</span>\r\n                <div>\r\n                    <button onClick={() => paginate(currentPage - 1)} disabled={currentPage === 1} className=\"px-3 py-1 border rounded-md bg-white mr-2 disabled:opacity-50\">Anterior</button>\r\n                    <button onClick={() => paginate(currentPage + 1)} disabled={currentPage === totalPages || totalPages === 0} className=\"px-3 py-1 border rounded-md bg-white disabled:opacity-50\">Siguiente</button>\r\n                </div>\r\n            </div>\r\n            {showAddModal && <AddGeneralInvoiceModal onClose={() => setShowAddModal(false)} onFinalized={onUpdate} />}\r\n            {modalInvoice && <ManageInvoiceModal invoice={modalInvoice} onClose={() => setModalInvoice(null)} onFinalized={onUpdate} />}\r\n        </div>\r\n    );\r\n};\r\n\r\n// **CÓDIGO COMPLETO Y CORREGIDO PARA PracticanteDashboard**\r\nconst PracticanteDashboard = () => {\r\n    const [projects, setProjects] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [modalProject, setModalProject] = useState(null);\r\n    const [submittingId, setSubmittingId] = useState(null);\r\n    const [confirmingAction, setConfirmingAction] = useState(null);\r\n\r\n    const fetchProjects = () => {\r\n        setLoading(true);\r\n        const q = query(collection(db, \"proyectos\"), where(\"estado\", \"in\", [\"Terminado Internamente\", \"En Revisión Final\"]));\r\n        \r\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n            const projectsData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            setProjects(projectsData);\r\n            setLoading(false);\r\n        }, (error) => {\r\n            console.error(\"Error fetching projects for practicante: \", error);\r\n            setLoading(false);\r\n        });\r\n        \r\n        return unsubscribe;\r\n    };\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = fetchProjects();\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    // **CÓDIGO ACTUALIZADO PARA ManageFinalDeliveryModal**\r\n    const ManageFinalDeliveryModal = ({ project, onClose, onFinalized }) => {\r\n        const [heyzineUrl, setHeyzineUrl] = useState(project.urlHeyzine || '');\r\n        const [notaPdfFile1, setNotaPdfFile1] = useState(null);\r\n        const [notaPdfFile2, setNotaPdfFile2] = useState(null);\r\n        const [loading, setLoading] = useState(false);\r\n\r\n        const handleFileChange = (setter) => (e) => { if (e.target.files[0]) setter(e.target.files[0]) };\r\n\r\n        const uploadFile = async (file, path) => {\r\n            if (!file) return null;\r\n            const storageRef = ref(storage, path);\r\n            const uploadTask = uploadBytesResumable(storageRef, file);\r\n            return getDownloadURL((await uploadTask).ref);\r\n        };\r\n\r\n        const handleSave = async () => {\r\n            setLoading(true);\r\n            const updatePayload = {\r\n                urlHeyzine: heyzineUrl // Siempre actualiza el enlace principal\r\n            };\r\n            const nota1Url = await uploadFile(notaPdfFile1, `notas_entrega_cliente/${project.id}/nota1_${notaPdfFile1?.name}`);\r\n            const nota2Url = await uploadFile(notaPdfFile2, `notas_entrega_cliente/${project.id}/nota2_${notaPdfFile2?.name}`);\r\n\r\n            if (nota1Url) updatePayload.urlNotaPdf1 = nota1Url;\r\n            if (nota2Url) updatePayload.urlNotaPdf2 = nota2Url;\r\n\r\n            if (Object.keys(updatePayload).length > 0) {\r\n                await updateDoc(doc(db, \"proyectos\", project.id), updatePayload);\r\n            }\r\n            onFinalized();\r\n            onClose();\r\n        };\r\n\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n                <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\">\r\n                    <h3 className=\"text-lg font-bold mb-4\">Gestionar Entrega Final: {project.npu}</h3>\r\n                    <div className=\"space-y-4\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">Enlace Heyzine (Único)</label>\r\n                            <input type=\"text\" value={heyzineUrl} onChange={(e) => setHeyzineUrl(e.target.value)} className=\"mt-1 block w-full border rounded-md p-2\"/>\r\n                        </div>\r\n                        <hr/>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">Subir/Reemplazar Nota de Entrega 1 (Firmada)</label>\r\n                            <input type=\"file\" accept=\".pdf\" onChange={handleFileChange(setNotaPdfFile1)} className=\"mt-1 block w-full text-sm\"/>\r\n                        </div>\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium\">Subir/Reemplazar Nota de Entrega 2 (Firmada)</label>\r\n                            <input type=\"file\" accept=\".pdf\" onChange={handleFileChange(setNotaPdfFile2)} className=\"mt-1 block w-full text-sm\"/>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"mt-6 flex justify-end space-x-3\">\r\n                        <button onClick={onClose} className=\"bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded\">Cancelar</button>\r\n                        <button onClick={handleSave} className=\"bg-blue-600 text-white font-bold py-2 px-4 rounded\">{loading ? 'Guardando...' : 'Guardar Documentos'}</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const handleSendToReview = async (projectId) => {\r\n        setSubmittingId(projectId);\r\n        try {\r\n            await updateDoc(doc(db, \"proyectos\", projectId), { \r\n                estado: 'En Revisión Final',\r\n                motivoRechazo: deleteField()\r\n            });\r\n        } catch (error) {\r\n            console.error(\"Error sending project to review:\", error);\r\n            alert(\"Ocurrió un error al enviar el proyecto a revisión.\");\r\n        } finally {\r\n            setSubmittingId(null);\r\n        }\r\n    };\r\n\r\n    const promptSendToReview = (projectId) => {\r\n        setConfirmingAction({\r\n            title: \"Confirmar Envío\",\r\n            message: \"¿Estás seguro de que todos los documentos están listos y quieres enviar este proyecto a revisión final?\",\r\n            onConfirm: () => handleSendToReview(projectId)\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">Proyectos Listos para Documentar</h1>\r\n            {loading ? <p>Cargando...</p> : projects.length === 0 ? <p>No hay proyectos pendientes.</p> : (\r\n                <div className=\"overflow-x-auto bg-white rounded-lg shadow\">\r\n                    <table className=\"min-w-full divide-y divide-gray-200\">\r\n                        <thead className=\"bg-gray-50\">\r\n                            <tr>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">NPU</th>\r\n                                {/* **COLUMNA AÑADIDA** */}\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Cliente</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Servicio</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Documentos del Técnico</th>\r\n                                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Acciones</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                            {projects.map(project => (\r\n                                 <tr key={project.id} className={project.motivoRechazo ? \"bg-orange-50\" : \"\"}>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.npu}</td>\r\n                                    {/* **CELDA AÑADIDA** */}\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.clienteNombre}</td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm\">{project.servicioNombre}</td>\r\n                                    <td className=\"px-6 py-4\">\r\n                                        <div className=\"flex flex-col space-y-1 text-sm\">\r\n                                            {project.urlEvidenciaTecnico1 && (\r\n                                                <div className=\"p-2 border-b\">\r\n                                                    <p className=\"font-semibold text-xs\">Fase 1:</p>\r\n                                                    <a href={project.urlEvidenciaTecnico1} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600\">Ver Evidencia 1</a>\r\n                                                    <p>Nota Interna 1: <span className=\"font-semibold\">{project.numeroNotaInterna1 || 'N/A'}</span></p>\r\n                                                </div>\r\n                                            )}\r\n                                            {project.urlEvidenciaTecnico2 && (\r\n                                                <div className=\"p-2\">\r\n                                                    <p className=\"font-semibold text-xs\">Fase 2:</p>\r\n                                                    <a href={project.urlEvidenciaTecnico2} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600\">Ver Evidencia 2</a>\r\n                                                    <p>Nota Interna 2: <span className=\"font-semibold\">{project.numeroNotaInterna2 || 'N/A'}</span></p>\r\n                                                </div>\r\n                                            )}\r\n                                            {project.urlEvidenciaTecnico && !project.urlEvidenciaTecnico1 && (\r\n                                                 <a href={project.urlEvidenciaTecnico} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600\">Ver Evidencia</a>\r\n                                            )}\r\n                                            \r\n                                            {project.motivoRechazo && (\r\n                                                <div className=\"mt-2 p-2 bg-orange-100 text-orange-800 rounded-md\">\r\n                                                    <p className=\"font-bold text-xs\">Correcciones Pendientes:</p>\r\n                                                    <p className=\"text-xs\">{project.motivoRechazo}</p>\r\n                                                </div>\r\n                                            )}\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                                        <button onClick={() => setModalProject(project)} className=\"text-indigo-600 hover:text-indigo-900 mr-4\">Gestionar Entrega</button>\r\n                                        {project.estado === 'Terminado Internamente' && (\r\n                                            <button \r\n                                                onClick={() => promptSendToReview(project.id)} \r\n                                                disabled={submittingId === project.id}\r\n                                                className=\"text-green-600 hover:text-green-900 disabled:opacity-50\"\r\n                                            >\r\n                                                {submittingId === project.id ? 'Enviando...' : 'Enviar a Revisión'}\r\n                                            </button>\r\n                                        )}\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            )}\r\n            {modalProject && <ManageFinalDeliveryModal project={modalProject} onClose={() => setModalProject(null)} onFinalized={fetchProjects} />}\r\n            {confirmingAction && (\r\n                <ConfirmationModal \r\n                    title={confirmingAction.title}\r\n                    message={confirmingAction.message}\r\n                    onConfirm={confirmingAction.onConfirm}\r\n                    onCancel={() => setConfirmingAction(null)}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\n// --- COMPONENTE \"ROUTER\" PRINCIPAL ---\r\nconst Dashboard = ({ user, userData }) => {\r\n    \r\n    // Esta función actúa como un \"router\" interno, mostrando el panel correcto para cada rol.\r\n    const renderDashboardByRole = () => {\r\n        switch (userData.rol) {\r\n            case 'administrador':\r\n                return <AdminDashboard user={user} userData={userData} />;\r\n            case 'cliente':\r\n                return <ClientDashboard user={user} userData={userData} />;\r\n            case 'directivo':\r\n                return <DirectivoDashboard user={user} userData={userData} />;\r\n            case 'ecotech':\r\n                return <EcotechDashboard user={user} userData={userData} />;\r\n            case 'supervisor':\r\n                return <SupervisorDashboard user={user} userData={userData} />;\r\n            case 'tecnico':\r\n                return <TecnicoDashboard user={user} userData={userData} />;\r\n            case 'finanzas':\r\n                return <FinanzasDashboard user={user} userData={userData} />;\r\n            case 'practicante':\r\n                // El practicante no necesita los datos del usuario para su función actual\r\n                return <PracticanteDashboard />;\r\n            default:\r\n                return <div><h2 className=\"text-2xl font-bold\">Rol no reconocido</h2><p>Contacte al administrador.</p></div>;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8\">\r\n            {renderDashboardByRole()}\r\n        </div>\r\n    );\r\n};\r\n\r\nconst AuthPage = () => {\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [error, setError] = useState('');\r\n\r\n    const handleLogin = async (e) => {\r\n        e.preventDefault();\r\n        setError('');\r\n        try { \r\n            await signInWithEmailAndPassword(auth, email, password); \r\n        } catch (err) { \r\n            setError(\"Email o contraseña incorrectos.\"); \r\n        }\r\n    };\r\n    \r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-[#cdcdcd]\">\r\n            <div className=\"max-w-md w-full bg-white p-8 rounded-xl shadow-2xl\">\r\n                <img src=\"https://www.grupoevelsa.com/assets/images/Logo Evelsa 2.png\" alt=\"Logo Grupo Evelsa\" className=\"h-16 mx-auto mb-6\"/>\r\n                <h2 className=\"text-2xl font-bold text-center text-gray-800 mb-8\">Acceso al Portal</h2>\r\n                <form onSubmit={handleLogin} className=\"space-y-6\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700\">Email</label>\r\n                        <input type=\"email\" value={email} onChange={(e) => setEmail(e.target.value)} required className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700\">Contraseña</label>\r\n                        <input type=\"password\" value={password} onChange={(e) => setPassword(e.target.value)} required className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                    </div>\r\n                    {error && <p className=\"text-red-500 text-sm text-center\">{error}</p>}\r\n                    <button type=\"submit\" className=\"w-full bg-[#b0ef26] hover:bg-[#9ac91e] text-black font-bold py-3 px-4 rounded-lg transition duration-300 text-lg\">\r\n                        Entrar\r\n                    </button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\nexport default function App() {\r\n    const [user, setUser] = useState(null);\r\n    const [userData, setUserData] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = onAuthStateChanged(auth, async (currentUser) => {\r\n            if (currentUser) {\r\n                const userDocRef = doc(db, \"usuarios\", currentUser.uid);\r\n                const userDoc = await getDoc(userDocRef);\r\n                if (userDoc.exists()) {\r\n                    setUserData(userDoc.data());\r\n                    setUser(currentUser);\r\n                } else { \r\n                    console.error(\"Usuario autenticado pero no encontrado en Firestore. Deslogueando...\");\r\n                    signOut(auth); \r\n                }\r\n            } else {\r\n                setUser(null);\r\n                setUserData(null);\r\n            }\r\n            setLoading(false);\r\n        });\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    if (loading) {\r\n        return <div className=\"min-h-screen flex items-center justify-center bg-[#cdcdcd] text-gray-700\">Cargando...</div>;\r\n    }\r\n    \r\n    return (\r\n        <div className=\"bg-[#c9c9c9] min-h-screen font-sans\">\r\n             <Header user={user} userData={userData}/>\r\n             <main>\r\n                {user && userData ? <Dashboard user={user} userData={userData} /> : <AuthPage />}\r\n             </main>\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":"yHAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,OAASC,aAAa,KAAQ,cAAc,CAC5C,OACIC,OAAO,CACPC,kBAAkB,CAClBC,8BAA8B,CAC9BC,0BAA0B,CAC1BC,OAAO,KACJ,eAAe,CACtB,OACIC,YAAY,CACZC,UAAU,CACVC,MAAM,CACNC,KAAK,CACLC,KAAK,CACLC,OAAO,CACPC,GAAG,CACHC,MAAM,CACNC,SAAS,CACTC,UAAU,CACVC,MAAM,CACNC,SAAS,CACTC,cAAc,CACdC,OAAO,CACPC,SAAS,CACTC,WAAW,CACXC,UAAU,KACP,oBAAoB,CAC3B,OACIC,UAAU,CACVC,GAAG,CACHC,oBAAoB,CACpBC,cAAc,KACX,kBAAkB,CAEzB,OAASC,GAAG,KAAQ,iBAAiB,CAErC,OAASC,KAAK,GAAI,CAAAC,OAAO,CAAEC,aAAa,CAAEC,WAAW,CAAEC,UAAU,CAAEC,WAAW,CAAEC,YAAY,CAAEC,cAAc,CAAEC,KAAK,CAAEC,OAAO,CAAEC,MAAM,CAAEC,UAAU,KAAQ,UAAU,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAEnKhB,OAAO,CAACiB,QAAQ,CACdhB,aAAa,CACbC,WAAW,CACXC,UAAU,CACVC,WAAW,CACXC,YAAY,CACZC,cAAc,CAAE;AAChBC,KAAK,CACLC,OAAO,CACPC,MAAM,CACNC,UACF,CAAC,CAED;AACA,KAAM,CAAAQ,cAAc,CAAG,CACrBC,MAAM,CAAE,yCAAyC,CACjDC,UAAU,CAAE,+BAA+B,CAC3CC,SAAS,CAAE,eAAe,CAC1BC,aAAa,CAAE,mCAAmC,CAClDC,iBAAiB,CAAE,cAAc,CACjCC,KAAK,CAAE,2CACT,CAAC,CAED;AACA,KAAM,CAAAC,GAAG,CAAGtD,aAAa,CAAC+C,cAAc,CAAC,CACzC,KAAM,CAAAQ,IAAI,CAAGtD,OAAO,CAACqD,GAAG,CAAC,CACzB,KAAM,CAAAE,EAAE,CAAGlD,YAAY,CAACgD,GAAG,CAAC,CAC5B,KAAM,CAAAG,OAAO,CAAGlC,UAAU,CAAC+B,GAAG,CAAC,CAE/B;AACA,KAAM,CAAAI,KAAK,CAAGC,IAAA,EAAgC,IAA/B,CAAEC,OAAO,CAAEC,IAAI,CAAEC,OAAQ,CAAC,CAAAH,IAAA,CACrC,GAAI,CAACC,OAAO,CAAE,MAAO,KAAI,CACzB,KAAM,CAAAG,WAAW,CAAG,sCAAsC,CAC1D,KAAM,CAAAC,WAAW,CAAG,CAAEC,KAAK,CAAE,yBAAyB,CAAEC,OAAO,CAAE,6BAA8B,CAAC,CAChG,mBACIvB,KAAA,QAAKwB,SAAS,IAAAC,MAAA,CAAKL,WAAW,MAAAK,MAAA,CAAIJ,WAAW,CAACH,IAAI,CAAC,CAAG,CAACQ,IAAI,CAAC,OAAO,CAAAC,QAAA,eAC/D7B,IAAA,SAAM0B,SAAS,CAAC,aAAa,CAAAG,QAAA,CAAEV,OAAO,CAAO,CAAC,cAC9CnB,IAAA,WAAQ8B,OAAO,CAAET,OAAQ,CAACK,SAAS,CAAC,sEAAsE,CAAAG,QAAA,CAAC,MAAO,CAAQ,CAAC,EAC1H,CAAC,CAEd,CAAC,CAED;AACA,KAAM,CAAAE,iBAAiB,CAAGC,KAAA,EAAgI,IAA/H,CAAEC,KAAK,CAAEd,OAAO,CAAEe,SAAS,CAAEC,QAAQ,CAAEC,WAAW,CAAG,WAAW,CAAEC,UAAU,CAAG,UAAU,CAAEC,YAAY,CAAG,cAAe,CAAC,CAAAN,KAAA,CACjJ,mBACIhC,IAAA,QAAK0B,SAAS,CAAC,gFAAgF,CAAAG,QAAA,cAC3F3B,KAAA,QAAKwB,SAAS,CAAC,mDAAmD,CAAAG,QAAA,eAC9D7B,IAAA,OAAI0B,SAAS,CAAC,wBAAwB,CAAAG,QAAA,CAAEI,KAAK,CAAK,CAAC,cACnDjC,IAAA,MAAG0B,SAAS,CAAC,4BAA4B,CAAAG,QAAA,CAAEV,OAAO,CAAI,CAAC,cACvDjB,KAAA,QAAKwB,SAAS,CAAC,4BAA4B,CAAAG,QAAA,eACvC7B,IAAA,WAAQ8B,OAAO,CAAEK,QAAS,CAACT,SAAS,CAAC,yEAAyE,CAAAG,QAAA,CAAEQ,UAAU,CAAS,CAAC,cACpIrC,IAAA,WAAQ8B,OAAO,CAAEI,SAAU,CAACR,SAAS,IAAAC,MAAA,CAAKW,YAAY,4DAA2D,CAAAT,QAAA,CAAEO,WAAW,CAAS,CAAC,EACvI,CAAC,EACL,CAAC,CACL,CAAC,CAEd,CAAC,CAED;AACA,KAAM,CAAAG,qBAAqB,CAAGC,KAAA,EAAiI,IAAhI,CAAEP,KAAK,CAAEd,OAAO,CAAEe,SAAS,CAAEC,QAAQ,CAAEC,WAAW,CAAG,WAAW,CAAEC,UAAU,CAAG,UAAU,CAAEC,YAAY,CAAG,eAAgB,CAAC,CAAAE,KAAA,CACtJ,KAAM,CAACC,MAAM,CAAEC,SAAS,CAAC,CAAGrF,QAAQ,CAAC,EAAE,CAAC,CACxC,mBACI2C,IAAA,QAAK0B,SAAS,CAAC,gFAAgF,CAAAG,QAAA,cAC3F3B,KAAA,QAAKwB,SAAS,CAAC,mDAAmD,CAAAG,QAAA,eAC9D7B,IAAA,OAAI0B,SAAS,CAAC,wBAAwB,CAAAG,QAAA,CAAEI,KAAK,CAAK,CAAC,cACnDjC,IAAA,MAAG0B,SAAS,CAAC,4BAA4B,CAAAG,QAAA,CAAEV,OAAO,CAAI,CAAC,cACvDnB,IAAA,aACI2C,KAAK,CAAEF,MAAO,CACdG,QAAQ,CAAGC,CAAC,EAAKH,SAAS,CAACG,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAC3CI,WAAW,CAAC,8BAA2B,CACvCC,IAAI,CAAC,GAAG,CACRtB,SAAS,CAAC,8BAA8B,CACjC,CAAC,cACZxB,KAAA,QAAKwB,SAAS,CAAC,iCAAiC,CAAAG,QAAA,eAC5C7B,IAAA,WAAQ8B,OAAO,CAAEK,QAAS,CAACT,SAAS,CAAC,yEAAyE,CAAAG,QAAA,CAAEQ,UAAU,CAAS,CAAC,cACpIrC,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMI,SAAS,CAACO,MAAM,CAAE,CAACf,SAAS,IAAAC,MAAA,CAAKW,YAAY,4DAA2D,CAAAT,QAAA,CAAEO,WAAW,CAAS,CAAC,EACrJ,CAAC,EACL,CAAC,CACL,CAAC,CAEd,CAAC,CAED;AACA,KAAM,CAAAa,MAAM,CAAGC,KAAA,EAAwB,IAAvB,CAAEC,IAAI,CAAEC,QAAS,CAAC,CAAAF,KAAA,CAC9B,KAAM,CAAAG,eAAe,CAAG,6DAA6D,CACrF,mBACIrD,IAAA,WAAQ0B,SAAS,CAAC,sCAAsC,CAAAG,QAAA,cACpD3B,KAAA,QAAKwB,SAAS,CAAC,+EAA+E,CAAAG,QAAA,eAC1F7B,IAAA,QAAK0B,SAAS,CAAC,mBAAmB,CAAAG,QAAA,CAE7BuB,QAAQ,EAAIA,QAAQ,CAACE,GAAG,GAAK,SAAS,EAAIF,QAAQ,CAACG,OAAO,cACvDvD,IAAA,QAAKwD,GAAG,CAAEJ,QAAQ,CAACG,OAAQ,CAACE,OAAO,CAAGZ,CAAC,EAAG,CAACA,CAAC,CAACC,MAAM,CAACY,OAAO,CAAG,IAAI,CAAEb,CAAC,CAACC,MAAM,CAACU,GAAG,CAAC,6DAA6D,EAAE,CAACG,GAAG,CAAC,cAAc,CAACjC,SAAS,CAAC,iCAAiC,CAAC,CAAC,cAEjN1B,IAAA,QAAKwD,GAAG,CAAEH,eAAgB,CAACM,GAAG,CAAC,mBAAmB,CAACjC,SAAS,CAAC,kBAAkB,CAAC,CACnF,CACA,CAAC,CACLyB,IAAI,eACDjD,KAAA,QAAKwB,SAAS,CAAC,mBAAmB,CAAAG,QAAA,eAC9B3B,KAAA,SAAMwB,SAAS,CAAC,oCAAoC,CAAAG,QAAA,EAAC,QAC3C,CAACuB,QAAQ,CAAGA,QAAQ,CAACQ,cAAc,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAGV,IAAI,CAACW,KAAK,EAClE,CAAC,cACP9D,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMlE,OAAO,CAACkD,IAAI,CAAE,CAACY,SAAS,CAAC,+FAA+F,CAAAG,QAAA,CAAC,OAEhJ,CAAQ,CAAC,EACR,CACR,EACA,CAAC,CACF,CAAC,CAEjB,CAAC,CAED;AACA,KAAM,CAAAkC,eAAe,CAAGC,KAAA,EAA0C,IAAzC,CAAEC,OAAO,CAAEd,IAAI,CAAEC,QAAQ,CAAE/B,OAAQ,CAAC,CAAA2C,KAAA,CACzD,KAAM,CAACE,UAAU,CAAEC,aAAa,CAAC,CAAG9G,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAAC+G,OAAO,CAAEC,UAAU,CAAC,CAAGhH,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAACiH,OAAO,CAAEC,UAAU,CAAC,CAAGlH,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACqH,UAAU,CAAEC,aAAa,CAAC,CAAGtH,QAAQ,CAAC,KAAK,CAAC,CAAE;AACrD,KAAM,CAACmE,KAAK,CAAEoD,QAAQ,CAAC,CAAGvH,QAAQ,CAAC,EAAE,CAAC,CAEtCC,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAuH,CAAC,CAAG7G,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,qBAAqB,CAAC,CAAE9C,KAAK,CAAC,WAAW,CAAE,IAAI,CAAEgG,OAAO,CAACa,EAAE,CAAC,CAAEpG,OAAO,CAAC,OAAO,CAAE,KAAK,CAAC,CAAC,CACrH,KAAM,CAAAqG,WAAW,CAAGzG,UAAU,CAACuG,CAAC,CAAGG,aAAa,EAAK,CACjDb,aAAa,CAACa,aAAa,CAACC,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CAAC,CAC7EX,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAGY,GAAG,EAAK,CACRC,OAAO,CAAC9D,KAAK,+BAAgC6D,GAAG,CAAC,CACjDT,QAAQ,oCAAiC,CAAC,CAC1CH,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAC,CACF,MAAO,IAAMM,WAAW,CAAC,CAAC,CAC9B,CAAC,CAAE,CAACd,OAAO,CAACa,EAAE,CAAC,CAAC,CAEhB,KAAM,CAAAS,gBAAgB,CAAI1C,CAAC,EAAK,CAC5B,GAAIA,CAAC,CAACC,MAAM,CAAC0C,KAAK,CAAC,CAAC,CAAC,CAAEjB,UAAU,CAAC1B,CAAC,CAACC,MAAM,CAAC0C,KAAK,CAAC,CAAC,CAAC,CAAC,CACxD,CAAC,CAED,KAAM,CAAAC,gBAAgB,CAAG,KAAAA,CAAA,GAAY,CACjC,GAAI,CAACrB,OAAO,EAAI,CAACE,OAAO,CAAE,OAC1BK,aAAa,CAAC,IAAI,CAAC,CACnBC,QAAQ,CAAC,EAAE,CAAC,CAEZ,GAAI,CACA,GAAI,CAAAc,OAAO,CAAG,EAAE,CAChB,GAAIpB,OAAO,CAAE,CACT,KAAM,CAAAqB,UAAU,CAAG5G,GAAG,CAACiC,OAAO,cAAAW,MAAA,CAAesC,OAAO,CAACa,EAAE,MAAAnD,MAAA,CAAIiE,IAAI,CAACC,GAAG,CAAC,CAAC,MAAAlE,MAAA,CAAI2C,OAAO,CAACwB,IAAI,CAAE,CAAC,CACxF,KAAM,CAAAC,UAAU,CAAG/G,oBAAoB,CAAC2G,UAAU,CAAErB,OAAO,CAAC,CAC5DoB,OAAO,CAAG,KAAM,CAAAzG,cAAc,CAAC,CAAC,KAAM,CAAA8G,UAAU,EAAEhH,GAAG,CAAC,CAC1D,CAEA,KAAM,CAAAhB,MAAM,CAACD,UAAU,CAACiD,EAAE,CAAE,qBAAqB,CAAC,CAAE,CAChDN,SAAS,CAAEwD,OAAO,CAACa,EAAE,CACrBkB,OAAO,CAAE7C,IAAI,CAAC8C,GAAG,CACjBC,WAAW,CAAE9C,QAAQ,CAACQ,cAAc,CACpCuC,OAAO,CAAE/B,OAAO,CAChBgC,UAAU,CAAEV,OAAO,CACnBW,KAAK,CAAE7H,SAAS,CAACqH,GAAG,CAAC,CACzB,CAAC,CAAC,CAEFxB,UAAU,CAAC,EAAE,CAAC,CACdE,UAAU,CAAC,IAAI,CAAC,CAChB;AACA,KAAM,CAAA+B,SAAS,CAAGC,QAAQ,CAACC,cAAc,eAAA7E,MAAA,CAAesC,OAAO,CAACa,EAAE,CAAE,CAAC,CACrE,GAAGwB,SAAS,CAAEA,SAAS,CAAC3D,KAAK,CAAG,EAAE,CAEtC,CAAE,MAAO0C,GAAG,CAAE,CACVC,OAAO,CAAC9D,KAAK,CAAC,+BAA+B,CAAE6D,GAAG,CAAC,CACnDT,QAAQ,CAAC,0DAA0D,CAAC,CACxE,CAAC,OAAS,CACND,aAAa,CAAC,KAAK,CAAC,CAAE;AAC1B,CACJ,CAAC,CAED,KAAM,CAAA8B,UAAU,CAAIC,SAAS,EAAK,CAACA,SAAS,CAAG,KAAK,CAAG,GAAI,CAAAd,IAAI,CAACc,SAAS,CAACC,OAAO,CAAG,IAAI,CAAC,CAACC,cAAc,CAAC,OAAO,CAAC,CAEjH,mBACI5G,IAAA,QAAK0B,SAAS,CAAC,gFAAgF,CAAAG,QAAA,cAC3F3B,KAAA,QAAKwB,SAAS,CAAC,2EAA2E,CAAAG,QAAA,eACtF3B,KAAA,QAAKwB,SAAS,CAAC,wCAAwC,CAAAG,QAAA,eACnD3B,KAAA,OAAIwB,SAAS,CAAC,mBAAmB,CAAAG,QAAA,EAAC,4BAAuB,CAACoC,OAAO,CAAC4C,GAAG,EAAK,CAAC,cAC3E7G,IAAA,WAAQ8B,OAAO,CAAET,OAAQ,CAACK,SAAS,CAAC,sDAAsD,CAAAG,QAAA,CAAC,MAAO,CAAQ,CAAC,EAC1G,CAAC,cAEN7B,IAAA,QAAK0B,SAAS,CAAC,2EAA2E,CAAAG,QAAA,CACrF2C,OAAO,cAAGxE,IAAA,MAAA6B,QAAA,CAAG,yBAAoB,CAAG,CAAC,CAAGqC,UAAU,CAAC4C,MAAM,GAAK,CAAC,cAAG9G,IAAA,MAAA6B,QAAA,CAAG,oCAA+B,CAAG,CAAC,CACrGqC,UAAU,CAACgB,GAAG,CAAC6B,KAAK,eAChB7G,KAAA,QAAoBwB,SAAS,CAAC,mCAAmC,CAAAG,QAAA,eAC7D7B,IAAA,MAAG0B,SAAS,CAAC,2CAA2C,CAAAG,QAAA,CAAEkF,KAAK,CAACZ,OAAO,CAAI,CAAC,CAC3EY,KAAK,CAACX,UAAU,eAAIpG,IAAA,MAAGgH,IAAI,CAAED,KAAK,CAACX,UAAW,CAACtD,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,uCAAuC,CAAAG,QAAA,CAAC,aAAW,CAAG,CAAC,cAC3J3B,KAAA,MAAGwB,SAAS,CAAC,uCAAuC,CAAAG,QAAA,EAAEkF,KAAK,CAACb,WAAW,CAAC,KAAG,CAACO,UAAU,CAACM,KAAK,CAACV,KAAK,CAAC,EAAI,CAAC,GAHlGU,KAAK,CAACjC,EAIX,CACR,CAAC,CAEL,CAAC,cAEN5E,KAAA,QAAKwB,SAAS,CAAC,eAAe,CAAAG,QAAA,eAC1B7B,IAAA,aAAU2C,KAAK,CAAEyB,OAAQ,CAACxB,QAAQ,CAAEC,CAAC,EAAIwB,UAAU,CAACxB,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACI,WAAW,CAAC,yBAAsB,CAACC,IAAI,CAAC,GAAG,CAACtB,SAAS,CAAC,8BAA8B,CAAW,CAAC,cACrK1B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0D,EAAE,eAAAnD,MAAA,CAAgBsC,OAAO,CAACa,EAAE,CAAG,CAAClC,QAAQ,CAAE2C,gBAAiB,CAAC7D,SAAS,CAAC,qBAAqB,CAAC,CAAC,cAChH1B,IAAA,CAACiB,KAAK,EAACE,OAAO,CAAEK,KAAM,CAACJ,IAAI,CAAC,OAAO,CAACC,OAAO,CAAEA,CAAA,GAAMuD,QAAQ,CAAC,EAAE,CAAE,CAAE,CAAC,cACnE5E,IAAA,WAAQ8B,OAAO,CAAE2D,gBAAiB,CAACyB,QAAQ,CAAExC,UAAW,CAAChD,SAAS,CAAC,4GAA4G,CAAAG,QAAA,CAC1K6C,UAAU,CAAG,cAAc,CAAG,sBAAsB,CACjD,CAAC,EACR,CAAC,EACL,CAAC,CACL,CAAC,CAEd,CAAC,CAED;AAEA,KAAM,CAAAyC,cAAc,CAAGC,KAAA,EAAqB,IAApB,CAAEC,WAAY,CAAC,CAAAD,KAAA,CACnC,KAAM,CAACtD,KAAK,CAAEwD,QAAQ,CAAC,CAAGjK,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACkK,QAAQ,CAAEC,WAAW,CAAC,CAAGnK,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACuG,cAAc,CAAE6D,iBAAiB,CAAC,CAAGpK,QAAQ,CAAC,EAAE,CAAC,CACxD,KAAM,CAACiG,GAAG,CAAEoE,MAAM,CAAC,CAAGrK,QAAQ,CAAC,SAAS,CAAC,CACzC,KAAM,CAACsK,iBAAiB,CAAEC,oBAAoB,CAAC,CAAGvK,QAAQ,CAAC,EAAE,CAAC,CAC9D,KAAM,CAACkG,OAAO,CAAEsE,UAAU,CAAC,CAAGxK,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAACmE,KAAK,CAAEoD,QAAQ,CAAC,CAAGvH,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACoE,OAAO,CAAEqG,UAAU,CAAC,CAAGzK,QAAQ,CAAC,EAAE,CAAC,CAE1C,KAAM,CAAA0K,SAAS,CAAGA,CAAA,GAAM,CACpBT,QAAQ,CAAC,EAAE,CAAC,CAAEE,WAAW,CAAC,EAAE,CAAC,CAAEC,iBAAiB,CAAC,EAAE,CAAC,CAAEC,MAAM,CAAC,SAAS,CAAC,CACvEE,oBAAoB,CAAC,EAAE,CAAC,CAAEC,UAAU,CAAC,EAAE,CAAC,CAC5C,CAAC,CAED,KAAM,CAAAG,YAAY,CAAG,KAAO,CAAAnF,CAAC,EAAK,CAC9BA,CAAC,CAACoF,cAAc,CAAC,CAAC,CAClBrD,QAAQ,CAAC,EAAE,CAAC,CAAEkD,UAAU,CAAC,EAAE,CAAC,CAE5B,GAAI,CAAClE,cAAc,EAAI,CAACE,KAAK,EAAI,CAACyD,QAAQ,CAAE,CACxC3C,QAAQ,CAAC,8CAA8C,CAAC,CACxD,OACJ,CACA,GAAItB,GAAG,GAAK,SAAS,EAAI,CAACqE,iBAAiB,CAAE,CACxC/C,QAAQ,CAAC,+CAA+C,CAAC,CAC1D,OACJ,CAEA,GAAI,CACA,KAAM,CAAAsD,OAAO,CAAG3K,aAAa,CAAC+C,cAAc,cAAAqB,MAAA,CAAe,GAAI,CAAAiE,IAAI,CAAC,CAAC,CAACuC,OAAO,CAAC,CAAC,CAAE,CAAC,CAClF,KAAM,CAAAC,QAAQ,CAAG5K,OAAO,CAAC0K,OAAO,CAAC,CACjC,KAAM,CAAAG,cAAc,CAAG,KAAM,CAAA3K,8BAA8B,CAAC0K,QAAQ,CAAEtE,KAAK,CAAEyD,QAAQ,CAAC,CAEtF,KAAM,CAAAhJ,MAAM,CAACJ,GAAG,CAAC4C,EAAE,CAAE,UAAU,CAAEsH,cAAc,CAAClF,IAAI,CAAC8C,GAAG,CAAC,CAAE,CACvDnC,KAAK,CAAER,GAAG,CAAEM,cAAc,CAC1B+D,iBAAiB,CAAErE,GAAG,GAAK,SAAS,CAAGqE,iBAAiB,CAACW,QAAQ,CAAC,CAAC,CAAE,GAAG,CAAC,CAAG,EAAE,CAC9E/E,OAAO,CAAED,GAAG,GAAK,SAAS,CAAGC,OAAO,CAAG,EAC3C,CAAC,CAAC,CAEFuE,UAAU,gBAAAnG,MAAA,CAAamC,KAAK,eAAAnC,MAAA,CAAa2B,GAAG,0BAAqB,CAAC,CAClEyE,SAAS,CAAC,CAAC,CACX,GAAIV,WAAW,CAAEA,WAAW,CAAC,CAAC,CAClC,CAAE,MAAOhC,GAAG,CAAE,CACVT,QAAQ,4BAAAjD,MAAA,CAA4B0D,GAAG,CAAClE,OAAO,CAAE,CAAC,CACtD,CACJ,CAAC,CAED,mBACIjB,KAAA,QAAKwB,SAAS,CAAC,0DAA0D,CAAAG,QAAA,eACrE7B,IAAA,OAAI0B,SAAS,CAAC,sCAAsC,CAAAG,QAAA,CAAC,qBAAmB,CAAI,CAAC,cAC7E3B,KAAA,SAAMqI,QAAQ,CAAEP,YAAa,CAACtG,SAAS,CAAC,WAAW,CAAAG,QAAA,eAC9C7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAACuB,KAAK,CAAEiB,cAAe,CAAChB,QAAQ,CAAEC,CAAC,EAAI4E,iBAAiB,CAAC5E,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACI,WAAW,CAAC,iBAAiB,CAACrB,SAAS,CAAC,kFAAkF,CAAC,CAAC,cACxNxB,KAAA,WAAQyC,KAAK,CAAEW,GAAI,CAACV,QAAQ,CAAEC,CAAC,EAAI6E,MAAM,CAAC7E,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACjB,SAAS,CAAC,kFAAkF,CAAAG,QAAA,eACpJ7B,IAAA,WAAQ2C,KAAK,CAAC,SAAS,CAAAd,QAAA,CAAC,SAAO,CAAQ,CAAC,cACxC7B,IAAA,WAAQ2C,KAAK,CAAC,eAAe,CAAAd,QAAA,CAAC,eAAa,CAAQ,CAAC,cACpD7B,IAAA,WAAQ2C,KAAK,CAAC,WAAW,CAAAd,QAAA,CAAC,WAAS,CAAQ,CAAC,cAC5C7B,IAAA,WAAQ2C,KAAK,CAAC,SAAS,CAAAd,QAAA,CAAC,mBAAiB,CAAQ,CAAC,cAClD7B,IAAA,WAAQ2C,KAAK,CAAC,YAAY,CAAAd,QAAA,CAAC,yBAAuB,CAAQ,CAAC,cAC3D7B,IAAA,WAAQ2C,KAAK,CAAC,SAAS,CAAAd,QAAA,CAAC,YAAO,CAAQ,CAAC,cACxC7B,IAAA,WAAQ2C,KAAK,CAAC,UAAU,CAAAd,QAAA,CAAC,UAAQ,CAAQ,CAAC,cAC1C7B,IAAA,WAAQ2C,KAAK,CAAC,aAAa,CAAAd,QAAA,CAAC,aAAW,CAAQ,CAAC,EAC3C,CAAC,cACT7B,IAAA,UAAOoB,IAAI,CAAC,OAAO,CAACuB,KAAK,CAAEmB,KAAM,CAAClB,QAAQ,CAAEC,CAAC,EAAIyE,QAAQ,CAACzE,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACI,WAAW,CAAC,iBAAiB,CAACrB,SAAS,CAAC,kFAAkF,CAAC,CAAC,cACvM1B,IAAA,UAAOoB,IAAI,CAAC,UAAU,CAACuB,KAAK,CAAE4E,QAAS,CAAC3E,QAAQ,CAAEC,CAAC,EAAI2E,WAAW,CAAC3E,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACI,WAAW,CAAC,wCAAkC,CAACrB,SAAS,CAAC,kFAAkF,CAAC,CAAC,CAChO4B,GAAG,GAAK,SAAS,eACdpD,KAAA,CAAAE,SAAA,EAAAyB,QAAA,eACG7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAACuB,KAAK,CAAEgF,iBAAkB,CAAC/E,QAAQ,CAAEC,CAAC,EAAI+E,oBAAoB,CAAC/E,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACI,WAAW,CAAC,kCAA+B,CAACrB,SAAS,CAAC,kFAAkF,CAAC,CAAC,cAC5O1B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAACuB,KAAK,CAAEY,OAAQ,CAACX,QAAQ,CAAEC,CAAC,EAAIgF,UAAU,CAAChF,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACI,WAAW,CAAC,yBAAyB,CAACrB,SAAS,CAAC,kFAAkF,CAAC,CAAC,EACnN,CACL,cACD1B,IAAA,CAACiB,KAAK,EAACE,OAAO,CAAEK,KAAM,CAACJ,IAAI,CAAC,OAAO,CAACC,OAAO,CAAEA,CAAA,GAAMuD,QAAQ,CAAC,EAAE,CAAE,CAAE,CAAC,cACnE5E,IAAA,CAACiB,KAAK,EAACE,OAAO,CAAEM,OAAQ,CAACL,IAAI,CAAC,SAAS,CAACC,OAAO,CAAEA,CAAA,GAAMyG,UAAU,CAAC,EAAE,CAAE,CAAE,CAAC,cACzE9H,IAAA,WAAQoB,IAAI,CAAC,QAAQ,CAACM,SAAS,CAAC,kFAAkF,CAAAG,QAAA,CAAC,eAAa,CAAQ,CAAC,EACxI,CAAC,EACN,CAAC,CAEd,CAAC,CAED;AACA,KAAM,CAAA2G,cAAc,CAAGC,KAAA,EAAyD,IAAxD,CAAEC,cAAc,CAAEzG,KAAK,CAAE0G,MAAM,CAAEC,gBAAiB,CAAC,CAAAH,KAAA,CACvE,KAAM,CAACI,KAAK,CAAEC,QAAQ,CAAC,CAAGzL,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAAC0L,OAAO,CAAEC,UAAU,CAAC,CAAG3L,QAAQ,CAAC,CAAC,CAAC,CAAC,CAC1C,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACmE,KAAK,CAAEoD,QAAQ,CAAC,CAAGvH,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACoE,OAAO,CAAEqG,UAAU,CAAC,CAAGzK,QAAQ,CAAC,EAAE,CAAC,CAE1CC,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAuH,CAAC,CAAG7G,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE2H,cAAc,CAAC,CAAC,CAC/C,KAAM,CAAA3D,WAAW,CAAGzG,UAAU,CAACuG,CAAC,CAAGG,aAAa,EAAK,CACjD,KAAM,CAAAiE,SAAS,CAAGjE,aAAa,CAACC,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CAChF0D,QAAQ,CAACG,SAAS,CAAC,CACnBxE,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAGY,GAAG,EAAK,CACRC,OAAO,CAAC9D,KAAK,mBAAAG,MAAA,CAAmB+G,cAAc,MAAKrD,GAAG,CAAC,CACvDT,QAAQ,uCAAAjD,MAAA,CAAuCM,KAAK,KAAG,CAAC,CACxDwC,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAC,CACF,MAAO,IAAMM,WAAW,CAAC,CAAC,CAC9B,CAAC,CAAE,CAAC2D,cAAc,CAAEzG,KAAK,CAAC,CAAC,CAE3B,KAAM,CAAAiH,YAAY,CAAIrG,CAAC,EAAK,CACxB,KAAM,CAAEiD,IAAI,CAAEnD,KAAM,CAAC,CAAGE,CAAC,CAACC,MAAM,CAChCkG,UAAU,CAACG,IAAI,EAAAhE,aAAA,CAAAA,aAAA,IAAUgE,IAAI,MAAE,CAACrD,IAAI,EAAGnD,KAAK,EAAG,CAAC,CACpD,CAAC,CAED,KAAM,CAAAqF,YAAY,CAAG,KAAO,CAAAnF,CAAC,EAAK,CAC9BA,CAAC,CAACoF,cAAc,CAAC,CAAC,CAClB,GAAIU,MAAM,CAACS,IAAI,CAACC,KAAK,EAAI,CAACN,OAAO,CAACM,KAAK,CAAC,CAAC,CAAE,CACvCzE,QAAQ,CAAC,oCAAoC,CAAC,CAC9C,OACJ,CACAA,QAAQ,CAAC,EAAE,CAAC,CACZkD,UAAU,CAAC,EAAE,CAAC,CAEd,GAAI,CACA,KAAM,CAAA/J,MAAM,CAACD,UAAU,CAACiD,EAAE,CAAE2H,cAAc,CAAC,CAAEK,OAAO,CAAC,CACrDjB,UAAU,QAAAnG,MAAA,CAAKM,KAAK,CAACqH,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC,6BAAqB,CAAC,CACvDN,UAAU,CAAC,CAAC,CAAC,CAAC,CAClB,CAAE,MAAO3D,GAAG,CAAE,CACVT,QAAQ,yCAAAjD,MAAA,CAAmC0D,GAAG,CAAClE,OAAO,CAAE,CAAC,CAC7D,CACJ,CAAC,CAED,mBACIjB,KAAA,QAAKwB,SAAS,CAAC,uCAAuC,CAAAG,QAAA,eAClD3B,KAAA,QAAKwB,SAAS,CAAC,0DAA0D,CAAAG,QAAA,eACrE3B,KAAA,OAAIwB,SAAS,CAAC,sCAAsC,CAAAG,QAAA,EAAC,kBAAa,CAACI,KAAK,CAACqH,KAAK,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC,EAAK,CAAC,cAC3FpJ,KAAA,SAAMqI,QAAQ,CAAEP,YAAa,CAACtG,SAAS,CAAC,WAAW,CAAAG,QAAA,EAC9C8G,MAAM,CAACzD,GAAG,CAAC,CAACmE,KAAK,CAAEE,KAAK,gBACrBrJ,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,oDAAoD,CAAAG,QAAA,CAAEwH,KAAK,CAACG,OAAO,CAAC,UAAU,CAAE,KAAK,CAAC,CAAQ,CAAC,cAChHxJ,IAAA,UACIoB,IAAI,CAAC,MAAM,CACX0E,IAAI,CAAEuD,KAAM,CACZ1G,KAAK,CAAEoG,OAAO,CAACM,KAAK,CAAC,EAAI,EAAG,CAC5BzG,QAAQ,CAAEsG,YAAa,CACvBnG,WAAW,CAAE6F,gBAAgB,CAACW,KAAK,CAAE,CACrC7H,SAAS,CAAC,+CAA+C,CAC5D,CAAC,GATI2H,KAUL,CACR,CAAC,cACFrJ,IAAA,CAACiB,KAAK,EAACE,OAAO,CAAEK,KAAM,CAACJ,IAAI,CAAC,OAAO,CAACC,OAAO,CAAEA,CAAA,GAAMuD,QAAQ,CAAC,EAAE,CAAE,CAAE,CAAC,cACnE5E,IAAA,CAACiB,KAAK,EAACE,OAAO,CAAEM,OAAQ,CAACL,IAAI,CAAC,SAAS,CAACC,OAAO,CAAEA,CAAA,GAAMyG,UAAU,CAAC,EAAE,CAAE,CAAE,CAAC,cACzE9H,IAAA,WAAQoB,IAAI,CAAC,QAAQ,CAACM,SAAS,CAAC,kFAAkF,CAAAG,QAAA,CAAC,WAAM,CAAQ,CAAC,EAChI,CAAC,EACN,CAAC,cACN3B,KAAA,QAAKwB,SAAS,CAAC,0DAA0D,CAAAG,QAAA,eACpE3B,KAAA,OAAIwB,SAAS,CAAC,sCAAsC,CAAAG,QAAA,EAAEI,KAAK,CAAC,aAAW,EAAI,CAAC,cAC5EjC,IAAA,QAAK0B,SAAS,CAAC,0BAA0B,CAAAG,QAAA,cACtC3B,KAAA,UAAOwB,SAAS,CAAC,qCAAqC,CAAAG,QAAA,eAClD7B,IAAA,UAAO0B,SAAS,CAAC,YAAY,CAAAG,QAAA,cACzB7B,IAAA,OAAA6B,QAAA,CACK8G,MAAM,CAACzD,GAAG,CAACmE,KAAK,eAAIrJ,IAAA,OAAgB0B,SAAS,CAAC,mDAAmD,CAAAG,QAAA,CAAEwH,KAAK,CAACG,OAAO,CAAC,UAAU,CAAE,KAAK,CAAC,EAAtGH,KAA2G,CAAC,CAAC,CAC3I,CAAC,CACF,CAAC,cACRrJ,IAAA,UAAO0B,SAAS,CAAC,mCAAmC,CAAAG,QAAA,CAC/C2C,OAAO,cAAGxE,IAAA,OAAA6B,QAAA,cAAI7B,IAAA,OAAIyJ,OAAO,CAAEd,MAAM,CAAC7B,MAAO,CAAAjF,QAAA,CAAC,aAAW,CAAI,CAAC,CAAI,CAAC,CAAGgH,KAAK,CAAC3D,GAAG,CAACwE,IAAI,eAC7E1J,IAAA,OAAA6B,QAAA,CACK8G,MAAM,CAACzD,GAAG,CAACmE,KAAK,eAAIrJ,IAAA,OAAgC0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAE6H,IAAI,CAACL,KAAK,CAAC,KAAA1H,MAAA,CAAhF+H,IAAI,CAAC5E,EAAE,MAAAnD,MAAA,CAAI0H,KAAK,CAAqE,CAAC,CAAC,EADnHK,IAAI,CAAC5E,EAEV,CACP,CAAC,CACC,CAAC,EACL,CAAC,CACN,CAAC,EACN,CAAC,EACL,CAAC,CAEd,CAAC,CAED;AAEA;AACA,KAAM,CAAA6E,cAAc,CAAGA,CAAA,GAAM,CACzB,KAAM,CAACC,IAAI,CAAEC,OAAO,CAAC,CAAGxM,QAAQ,CAAC,UAAU,CAAC,CAC5C,KAAM,CAACyM,QAAQ,CAAEC,WAAW,CAAC,CAAG1M,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAAC2M,cAAc,CAAEC,iBAAiB,CAAC,CAAG5M,QAAQ,CAAC,EAAE,CAAC,CACxD,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,IAAI,CAAC,CAE5C;AACA,KAAM,CAAA6M,WAAW,CAAGA,CAAA,GAAM,CACtBzF,UAAU,CAAC,IAAI,CAAC,CAChB;AACA,KAAM,CAAA0F,SAAS,CAAGnM,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,WAAW,CAAC,CAAErC,OAAO,CAAC,eAAe,CAAE,MAAM,CAAC,CAAC,CACtF,KAAM,CAAA0L,mBAAmB,CAAG9L,UAAU,CAAC6L,SAAS,CAAGnF,aAAa,EAAK,CACjE+E,WAAW,CAAC/E,aAAa,CAACC,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CAAC,CAC3EX,UAAU,CAAC,KAAK,CAAC,CAAE;AACvB,CAAC,CAAC,CAEF;AACA,KAAM,CAAA4F,OAAO,CAAGrM,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,WAAW,CAAC,CAAE9C,KAAK,CAAC,QAAQ,CAAE,IAAI,CAAE,mBAAmB,CAAC,CAAC,CAC9F,KAAM,CAAAqM,iBAAiB,CAAGhM,UAAU,CAAC+L,OAAO,CAAGrF,aAAa,EAAK,CAC7DiF,iBAAiB,CAACjF,aAAa,CAACC,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CAAC,CACrF,CAAC,CAAC,CAEF;AACA,MAAO,IAAM,CACTgF,mBAAmB,CAAC,CAAC,CACrBE,iBAAiB,CAAC,CAAC,CACvB,CAAC,CACL,CAAC,CAEDhN,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAyH,WAAW,CAAGmF,WAAW,CAAC,CAAC,CACjC,MAAO,IAAMnF,WAAW,CAAC,CAAC,CAC9B,CAAC,CAAE,EAAE,CAAC,CAEN,mBACI7E,KAAA,QAAA2B,QAAA,eACI7B,IAAA,QAAK0B,SAAS,CAAC,+BAA+B,CAAAG,QAAA,cAC1C3B,KAAA,QAAKwB,SAAS,CAAC,uBAAuB,CAAC,aAAW,MAAM,CAAAG,QAAA,eACpD7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM+H,OAAO,CAAC,UAAU,CAAE,CAACnI,SAAS,+DAAAC,MAAA,CAAgEiI,IAAI,GAAK,UAAU,CAAG,+BAA+B,CAAG,kCAAkC,CAAG,CAAA/H,QAAA,CAAC,WAAS,CAAQ,CAAC,cACrO3B,KAAA,WAAQ4B,OAAO,CAAEA,CAAA,GAAM+H,OAAO,CAAC,QAAQ,CAAE,CAACnI,SAAS,wEAAAC,MAAA,CAAyEiI,IAAI,GAAK,QAAQ,CAAG,+BAA+B,CAAG,kCAAkC,CAAG,CAAA/H,QAAA,EAAC,mBAEpN,CAACmI,cAAc,CAAClD,MAAM,CAAG,CAAC,eAAI9G,IAAA,SAAM0B,SAAS,CAAC,+FAA+F,CAAAG,QAAA,CAAEmI,cAAc,CAAClD,MAAM,CAAO,CAAC,EACxK,CAAC,cACT9G,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM+H,OAAO,CAAC,OAAO,CAAE,CAACnI,SAAS,+DAAAC,MAAA,CAAgEiI,IAAI,GAAK,OAAO,CAAG,+BAA+B,CAAG,kCAAkC,CAAG,CAAA/H,QAAA,CAAC,UAAQ,CAAQ,CAAC,cAC9N7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM+H,OAAO,CAAC,UAAU,CAAE,CAACnI,SAAS,+DAAAC,MAAA,CAAgEiI,IAAI,GAAK,UAAU,CAAG,+BAA+B,CAAG,kCAAkC,CAAG,CAAA/H,QAAA,CAAC,WAAS,CAAQ,CAAC,cACrO7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM+H,OAAO,CAAC,WAAW,CAAE,CAACnI,SAAS,+DAAAC,MAAA,CAAgEiI,IAAI,GAAK,WAAW,CAAG,+BAA+B,CAAG,kCAAkC,CAAG,CAAA/H,QAAA,CAAC,aAAW,CAAQ,CAAC,EACxO,CAAC,CACL,CAAC,CAEL+H,IAAI,GAAK,OAAO,eAAI5J,IAAA,CAACmH,cAAc,EAACE,WAAW,CAAEA,CAAA,GAAM,CAAC,CAAE,CAAE,CAAC,CAE7DuC,IAAI,GAAK,UAAU,eAChB1J,KAAA,CAAAE,SAAA,EAAAyB,QAAA,eACI7B,IAAA,CAACuK,cAAc,EAACC,cAAc,CAAEN,WAAY,CAAE,CAAC,cAC/ClK,IAAA,OAAI0B,SAAS,CAAC,uCAAuC,CAAAG,QAAA,CAAC,qBAAmB,CAAI,CAAC,CAC7E2C,OAAO,cAAGxE,IAAA,MAAA6B,QAAA,CAAG,mBAAiB,CAAG,CAAC,cAAG7B,IAAA,CAACyK,aAAa,EAACX,QAAQ,CAAEA,QAAS,CAACY,eAAe,CAAER,WAAY,CAACS,QAAQ,CAAC,eAAe,CAAE,CAAC,EACpI,CACL,CAEAf,IAAI,GAAK,QAAQ,eACd1J,KAAA,QAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,uCAAuC,CAAAG,QAAA,CAAC,6CAAwC,CAAI,CAAC,CAClG2C,OAAO,cAAGxE,IAAA,MAAA6B,QAAA,CAAG,aAAW,CAAG,CAAC,CAAGmI,cAAc,CAAClD,MAAM,GAAK,CAAC,cAAG9G,IAAA,MAAA6B,QAAA,CAAG,kCAA6B,CAAG,CAAC,cAAG7B,IAAA,CAAC4K,mBAAmB,EAACd,QAAQ,CAAEE,cAAe,CAACU,eAAe,CAAER,WAAY,CAAE,CAAC,EACnL,CACR,CAEAN,IAAI,GAAK,UAAU,eAAI5J,IAAA,CAACwI,cAAc,EAACE,cAAc,CAAC,WAAW,CAACzG,KAAK,CAAC,WAAW,CAAC0G,MAAM,CAAE,CAAC,QAAQ,CAAE,oBAAoB,CAAE,aAAa,CAAE,CAACC,gBAAgB,CAAE,CAAC,qBAAqB,CAAE,wBAAwB,CAAE,aAAa,CAAE,CAAE,CAAC,CACnOgB,IAAI,GAAK,WAAW,eAAI5J,IAAA,CAACwI,cAAc,EAACE,cAAc,CAAC,aAAa,CAACzG,KAAK,CAAC,aAAa,CAAC0G,MAAM,CAAE,CAAC,QAAQ,CAAE,qBAAqB,CAAE,CAACC,gBAAgB,CAAE,CAAC,sBAAsB,CAAE,sBAAsB,CAAE,CAAE,CAAC,EAC1M,CAAC,CAEd,CAAC,CAED;AACA,KAAM,CAAAiC,kBAAkB,CAAGC,KAAA,EAAsB,IAArB,CAAEC,GAAG,CAAE1J,OAAQ,CAAC,CAAAyJ,KAAA,CACxC,mBACI9K,IAAA,QAAK0B,SAAS,CAAC,4EAA4E,CAAAG,QAAA,cACvF3B,KAAA,QAAKwB,SAAS,CAAC,kFAAkF,CAAAG,QAAA,eAC7F3B,KAAA,QAAKwB,SAAS,CAAC,gDAAgD,CAAAG,QAAA,eAC3D7B,IAAA,OAAI0B,SAAS,CAAC,mBAAmB,CAAAG,QAAA,CAAC,qBAAmB,CAAI,CAAC,cAC1D7B,IAAA,WAAQ8B,OAAO,CAAET,OAAQ,CAACK,SAAS,CAAC,sDAAsD,CAAAG,QAAA,CAAC,MAAO,CAAQ,CAAC,EAC1G,CAAC,cACN7B,IAAA,QAAK0B,SAAS,CAAC,WAAW,CAAAG,QAAA,cACtB7B,IAAA,WAAQwD,GAAG,CAAEuH,GAAI,CAAC9I,KAAK,CAAC,kBAAkB,CAACP,SAAS,CAAC,eAAe,CAACsJ,WAAW,CAAC,GAAG,CAACC,eAAe,MAAS,CAAC,CAC7G,CAAC,EACL,CAAC,CACL,CAAC,CAEd,CAAC,CAED,KAAM,CAAAC,aAAa,CAAGC,KAAA,EAA+B,IAA9B,CAAErB,QAAQ,CAAEsB,WAAY,CAAC,CAAAD,KAAA,CAC5C,KAAM,CAAAE,gBAAgB,CAAGvB,QAAQ,CAACwB,MAAM,CAACC,CAAC,EAAIA,CAAC,CAACC,aAAa,GAAK,WAAW,GAAKD,CAAC,CAACE,aAAa,EAAIF,CAAC,CAACG,aAAa,CAAC,CAAC,CACtH,KAAM,CAAAC,gBAAgB,CAAG,8JAA8J,CAEvL,mBACI3L,IAAA,QAAK0B,SAAS,CAAC,qEAAqE,CAAAG,QAAA,CAC/EwJ,gBAAgB,CAACnG,GAAG,CAACjB,OAAO,eACzB/D,KAAA,WAAyBwB,SAAS,CAAC,oCAAoC,CAACI,OAAO,CAAEA,CAAA,GAAMsJ,WAAW,CAACnH,OAAO,CAACyH,aAAa,EAAIzH,OAAO,CAACwH,aAAa,CAAE,CAAA5J,QAAA,eAC/I3B,KAAA,QAAKwB,SAAS,CAAC,6JAA6J,CAAAG,QAAA,eACxK7B,IAAA,QAAKwD,GAAG,CAAEmI,gBAAiB,CAAChI,GAAG,CAAC,qBAAqB,CAACjC,SAAS,CAAC,6CAA6C,CAAC,CAAC,cAC/G1B,IAAA,QAAK0B,SAAS,CAAC,yCAAyC,CAAM,CAAC,cAC/DxB,KAAA,QAAKwB,SAAS,CAAC,uFAAuF,CAAAG,QAAA,eAClG7B,IAAA,OAAI0B,SAAS,CAAC,iCAAiC,CAAAG,QAAA,CAAEoC,OAAO,CAAC2H,aAAa,CAAK,CAAC,cAC5E5L,IAAA,OAAI0B,SAAS,CAAC,4BAA4B,CAAC,CAAC,cAC5C1B,IAAA,MAAG0B,SAAS,CAAC,SAAS,CAAAG,QAAA,CAAEoC,OAAO,CAAC4H,cAAc,CAAI,CAAC,EAClD,CAAC,EACL,CAAC,cACN7L,IAAA,MAAG0B,SAAS,CAAC,6EAA6E,CAAAG,QAAA,CAAEoC,OAAO,CAAC4H,cAAc,CAAI,CAAC,GAV9G5H,OAAO,CAACa,EAWb,CACX,CAAC,CACD,CAAC,CAEd,CAAC,CAED;AACA,KAAM,CAAAyF,cAAc,CAAGuB,KAAA,EAAwB,KAAAC,qBAAA,IAAvB,CAAEvB,cAAe,CAAC,CAAAsB,KAAA,CACtC,KAAM,CAACE,QAAQ,CAAEC,WAAW,CAAC,CAAG5O,QAAQ,CAAC,CACrC6O,SAAS,CAAE,EAAE,CACbC,UAAU,CAAE,EAAE,CACdC,WAAW,CAAE,EAAE,CACfC,mBAAmB,CAAE,EAAE,CACvBC,aAAa,CAAE,GAAI,CAAA1G,IAAI,CAAC,CAAC,CAAC2G,WAAW,CAAC,CAAC,CAAC1I,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CACrD2I,uBAAuB,CAAE,EAAE,CAC3BC,cAAc,CAAE,EACpB,CAAC,CAAC,CACF,KAAM,CAACjH,KAAK,CAAEkH,QAAQ,CAAC,CAAGrP,QAAQ,CAAC,CAC/BsP,qBAAqB,CAAE,IAAI,CAC3BC,aAAa,CAAE,IAAI,CACnBC,uBAAuB,CAAE,IAAI,CAC7BC,eAAe,CAAE,IACrB,CAAC,CAAC,CACF,KAAM,CAAAC,OAAO,CAAG3P,KAAK,CAAC4P,MAAM,CAAC,IAAI,CAAC,CAElC,KAAM,CAACC,WAAW,CAAEC,cAAc,CAAC,CAAG7P,QAAQ,CAAC,CAAE8P,QAAQ,CAAE,EAAE,CAAEC,SAAS,CAAE,EAAE,CAAEC,WAAW,CAAE,EAAG,CAAC,CAAC,CAChG,KAAM,CAAC7L,KAAK,CAAEoD,QAAQ,CAAC,CAAGvH,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,KAAK,CAAC,CAE7C;AACA,KAAM,CAAAiQ,kBAAkB,CAAG,EAAAvB,qBAAA,CAAAkB,WAAW,CAACI,WAAW,CAACE,IAAI,CAAChC,CAAC,EAAIA,CAAC,CAACzG,EAAE,GAAKkH,QAAQ,CAACI,WAAW,CAAC,UAAAL,qBAAA,iBAAhEA,qBAAA,CAAkEyB,MAAM,CAACC,WAAW,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC,IAAK,+BAA+B,CAE5JpQ,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAqQ,SAAS,CAAG,KAAAA,CAAA,GAAY,CAC1B,GAAI,CACA,KAAM,CAACC,YAAY,CAAEC,aAAa,CAAEC,eAAe,CAAC,CAAG,KAAM,CAAAC,OAAO,CAACC,GAAG,CAAC,CACrE9P,OAAO,CAACF,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,UAAU,CAAC,CAAE9C,KAAK,CAAC,KAAK,CAAE,IAAI,CAAE,SAAS,CAAC,CAAC,CAAC,CACzEC,OAAO,CAACJ,UAAU,CAACiD,EAAE,CAAE,WAAW,CAAC,CAAC,CACpC7C,OAAO,CAACJ,UAAU,CAACiD,EAAE,CAAE,aAAa,CAAC,CAAC,CACzC,CAAC,CACF,KAAM,CAAAkN,UAAU,CAAGA,CAACC,CAAC,CAAEC,CAAC,GAAK,CAACD,CAAC,CAACtK,cAAc,EAAIsK,CAAC,CAACV,MAAM,EAAEY,aAAa,CAACD,CAAC,CAACvK,cAAc,EAAIuK,CAAC,CAACX,MAAM,CAAC,CACvGN,cAAc,CAAC,CACXC,QAAQ,CAAES,YAAY,CAAC3I,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CAACiJ,IAAI,CAACJ,UAAU,CAAC,CACxFb,SAAS,CAAES,aAAa,CAAC5I,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CAACiJ,IAAI,CAACJ,UAAU,CAAC,CAC1FZ,WAAW,CAAES,eAAe,CAAC7I,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CAACiJ,IAAI,CAACJ,UAAU,CACjG,CAAC,CAAC,CACN,CAAE,MAAOpL,CAAC,CAAE,CACR+B,QAAQ,CAAC,iCAAiC,CAAC,CAC/C,CACJ,CAAC,CACD+I,SAAS,CAAC,CAAC,CACf,CAAC,CAAE,EAAE,CAAC,CAENrQ,SAAS,CAAC,IAAM,CACZ,GAAIgQ,kBAAkB,CAAE,CACpBrB,WAAW,CAAC9C,IAAI,EAAAhE,aAAA,CAAAA,aAAA,IAAUgE,IAAI,MAAEsD,cAAc,CAAE,GAAG,EAAG,CAAC,CAC3D,CACJ,CAAC,CAAE,CAACT,QAAQ,CAACI,WAAW,CAAEkB,kBAAkB,CAAC,CAAC,CAG9C,KAAM,CAAApE,YAAY,CAAIrG,CAAC,EAAK,CACxB,KAAM,CAAEiD,IAAI,CAAEnD,KAAM,CAAC,CAAGE,CAAC,CAACC,MAAM,CAChCmJ,WAAW,CAAC9C,IAAI,EAAAhE,aAAA,CAAAA,aAAA,IAAUgE,IAAI,MAAE,CAACrD,IAAI,EAAGnD,KAAK,EAAG,CAAC,CACrD,CAAC,CAED,KAAM,CAAA4C,gBAAgB,CAAI1C,CAAC,EAAK,CAC5B,KAAM,CAAEiD,IAAI,CAAEN,KAAK,CAAE8I,UAAW,CAAC,CAAGzL,CAAC,CAACC,MAAM,CAC5C,GAAIwL,UAAU,CAAC,CAAC,CAAC,CAAE,CACf5B,QAAQ,CAACvD,IAAI,EAAAhE,aAAA,CAAAA,aAAA,IAAUgE,IAAI,MAAE,CAACrD,IAAI,EAAGwI,UAAU,CAAC,CAAC,CAAC,EAAG,CAAC,CAC1D,CACJ,CAAC,CAED,KAAM,CAAAC,UAAU,CAAG,KAAAA,CAAOC,IAAI,CAAEC,IAAI,GAAK,CACrC,GAAI,CAACD,IAAI,CAAE,MAAO,KAAI,CACtB,KAAM,CAAA7I,UAAU,CAAG5G,GAAG,CAACiC,OAAO,CAAEyN,IAAI,CAAC,CACrC,KAAM,CAAA1I,UAAU,CAAG/G,oBAAoB,CAAC2G,UAAU,CAAE6I,IAAI,CAAC,CACzD,KAAM,CAAAzI,UAAU,CAChB,MAAO,MAAM,CAAA9G,cAAc,CAAC8G,UAAU,CAAC2I,QAAQ,CAAC3P,GAAG,CAAC,CACxD,CAAC,CAED,KAAM,CAAAiJ,YAAY,CAAG,KAAO,CAAAnF,CAAC,EAAK,CAC9BA,CAAC,CAACoF,cAAc,CAAC,CAAC,CAClB,GAAI,CAAC+D,QAAQ,CAACE,SAAS,EAAI,CAACF,QAAQ,CAACG,UAAU,EAAI,CAACH,QAAQ,CAACI,WAAW,CAAE,CACtExH,QAAQ,CAAC,iDAAiD,CAAC,CAC3D,OACJ,CACAH,UAAU,CAAC,IAAI,CAAC,CAChBG,QAAQ,CAAC,EAAE,CAAC,CAEZ,GAAI,KAAA+J,qBAAA,CAAAC,oBAAA,CAAAC,qBAAA,CAAAC,qBAAA,CACA,KAAM,CAAAC,oBAAoB,CAAG,KAAM,CAAAR,UAAU,CAAC/I,KAAK,CAACmH,qBAAqB,0BAAAhL,MAAA,CAA2BiE,IAAI,CAACC,GAAG,CAAC,CAAC,MAAAlE,MAAA,EAAAgN,qBAAA,CAAInJ,KAAK,CAACmH,qBAAqB,UAAAgC,qBAAA,iBAA3BA,qBAAA,CAA6B7I,IAAI,CAAE,CAAC,CACtJ,KAAM,CAAAkJ,YAAY,CAAG,KAAM,CAAAT,UAAU,CAAC/I,KAAK,CAACoH,aAAa,gBAAAjL,MAAA,CAAiBiE,IAAI,CAACC,GAAG,CAAC,CAAC,MAAAlE,MAAA,EAAAiN,oBAAA,CAAIpJ,KAAK,CAACoH,aAAa,UAAAgC,oBAAA,iBAAnBA,oBAAA,CAAqB9I,IAAI,CAAE,CAAC,CACpH,KAAM,CAAAmJ,sBAAsB,CAAG,KAAM,CAAAV,UAAU,CAAC/I,KAAK,CAACqH,uBAAuB,6BAAAlL,MAAA,CAA8BiE,IAAI,CAACC,GAAG,CAAC,CAAC,MAAAlE,MAAA,EAAAkN,qBAAA,CAAIrJ,KAAK,CAACqH,uBAAuB,UAAAgC,qBAAA,iBAA7BA,qBAAA,CAA+B/I,IAAI,CAAE,CAAC,CAC/J,KAAM,CAAAoJ,cAAc,CAAG,KAAM,CAAAX,UAAU,CAAC/I,KAAK,CAACsH,eAAe,mBAAAnL,MAAA,CAAoBiE,IAAI,CAACC,GAAG,CAAC,CAAC,MAAAlE,MAAA,EAAAmN,qBAAA,CAAItJ,KAAK,CAACsH,eAAe,UAAAgC,qBAAA,iBAArBA,qBAAA,CAAuBhJ,IAAI,CAAE,CAAC,CAE7H,KAAM,CAAAqJ,UAAU,CAAG,GAAI,CAAAvJ,IAAI,CAACoG,QAAQ,CAACM,aAAa,CAAC,CAAC8C,WAAW,CAAC,CAAC,CACjE,KAAM,CAAAC,WAAW,CAAGlR,GAAG,CAAC4C,EAAE,CAAE,YAAY,cAAAY,MAAA,CAAewN,UAAU,CAAE,CAAC,CACpE,KAAM,CAAAG,gBAAgB,CAAG,KAAM,CAAA7Q,cAAc,CAACsC,EAAE,CAAE,KAAO,CAAAwO,WAAW,EAAK,CACrE,KAAM,CAAAC,WAAW,CAAG,KAAM,CAAAD,WAAW,CAACE,GAAG,CAACJ,WAAW,CAAC,CACtD,KAAM,CAAAK,UAAU,CAAG,CAACF,WAAW,CAACG,MAAM,CAAC,CAAC,CAAGH,WAAW,CAACpK,IAAI,CAAC,CAAC,CAACwK,WAAW,CAAG,CAAC,EAAI,CAAC,CAClFL,WAAW,CAACM,GAAG,CAACR,WAAW,CAAE,CAAEO,WAAW,CAAEF,UAAW,CAAC,CAAE,CAAEI,KAAK,CAAE,IAAK,CAAC,CAAC,CAC1E,MAAO,CAAAJ,UAAU,CACrB,CAAC,CAAC,CAEF,KAAM,CAAAK,qBAAqB,CAAGZ,UAAU,CAACa,QAAQ,CAAC,CAAC,CAAC1G,KAAK,CAAC,CAAC,CAAC,CAAC,CAC7D,KAAM,CAAA2G,qBAAqB,CAAGX,gBAAgB,CAACU,QAAQ,CAAC,CAAC,CAAC1H,QAAQ,CAAC,CAAC,CAAE,GAAG,CAAC,CAE1E,KAAM,CAAA4H,OAAO,CAAGjD,WAAW,CAACE,QAAQ,CAACI,IAAI,CAAC4C,CAAC,EAAIA,CAAC,CAACrL,EAAE,GAAKkH,QAAQ,CAACE,SAAS,CAAC,CAC3E,KAAM,CAAAkE,QAAQ,CAAGnD,WAAW,CAACG,SAAS,CAACG,IAAI,CAAC8C,CAAC,EAAIA,CAAC,CAACvL,EAAE,GAAKkH,QAAQ,CAACG,UAAU,CAAC,CAC9E,KAAM,CAAAmE,SAAS,CAAGrD,WAAW,CAACI,WAAW,CAACE,IAAI,CAAChC,CAAC,EAAIA,CAAC,CAACzG,EAAE,GAAKkH,QAAQ,CAACI,WAAW,CAAC,CAElF,KAAM,CAAAvF,GAAG,IAAAlF,MAAA,CAAMuO,OAAO,CAACvI,iBAAiB,MAAAhG,MAAA,CAAIyO,QAAQ,CAACG,kBAAkB,MAAA5O,MAAA,CAAI2O,SAAS,CAACE,mBAAmB,MAAA7O,MAAA,CAAIsO,qBAAqB,EAAAtO,MAAA,CAAGoO,qBAAqB,CAAE,CAC3J,KAAM,CAAAU,eAAe,CAAGnD,kBAAkB,CAAG,KAAK,CAAGzG,GAAG,CAACyC,KAAK,CAAC,CAAC,CAAC,CAAC,CAClE,KAAM,CAAAoH,aAAa,CAAG1B,YAAY,CAAG,QAAQ,CAAG,YAAY,CAE5D,KAAM,CAAAjR,MAAM,CAACD,UAAU,CAACiD,EAAE,CAAE,WAAW,CAAC,CAAE,CACtCuL,aAAa,CAAE9N,SAAS,CAACmS,QAAQ,CAAC,GAAI,CAAA/K,IAAI,CAACoG,QAAQ,CAACM,aAAa,CAAC,CAAC,CACnEzF,GAAG,CACHqF,SAAS,CAAEF,QAAQ,CAACE,SAAS,CAC7BN,aAAa,CAAEsE,OAAO,CAACtM,cAAc,CACrCuI,UAAU,CAAEH,QAAQ,CAACG,UAAU,CAC/BN,cAAc,CAAEuE,QAAQ,CAAC5C,MAAM,CAC/BpB,WAAW,CAAEJ,QAAQ,CAACI,WAAW,CACjCwE,eAAe,CAAEN,SAAS,CAAC9C,MAAM,CACjCnB,mBAAmB,CAAEL,QAAQ,CAACK,mBAAmB,CACjDwE,MAAM,CAAEH,aAAa,CACrBlF,aAAa,CAAEkF,aAAa,CAC5BI,WAAW,CAAEV,QAAQ,CAACU,WAAW,EAAI,iBAAiB,CACtDC,mBAAmB,CAAE,EAAE,CACvBC,cAAc,CAAE,CAAC,CAAC,CAClBxE,uBAAuB,CAAEyE,MAAM,CAACjF,QAAQ,CAACQ,uBAAuB,CAAC,EAAI,CAAC,CACtEuC,oBAAoB,CAAEA,oBAAoB,EAAI,EAAE,CAChDC,YAAY,CAAEA,YAAY,EAAI,EAAE,CAChCvC,cAAc,CAAEwE,MAAM,CAACjF,QAAQ,CAACS,cAAc,CAAC,EAAI,CAAC,CACpDyE,WAAW,CAAET,eAAe,CAC5BxB,sBAAsB,CAAEA,sBAAsB,EAAI,EAAE,CACpDC,cAAc,CAAEA,cAAc,EAAI,EACtC,CAAC,CAAC,CAEFjD,WAAW,CAAC,CAAEC,SAAS,CAAE,EAAE,CAAEC,UAAU,CAAE,EAAE,CAAEC,WAAW,CAAE,EAAE,CAAEC,mBAAmB,CAAE,EAAE,CAAEC,aAAa,CAAE,GAAI,CAAA1G,IAAI,CAAC,CAAC,CAAC2G,WAAW,CAAC,CAAC,CAAC1I,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAE2I,uBAAuB,CAAE,EAAE,CAAEC,cAAc,CAAE,EAAG,CAAC,CAAC,CAChMM,OAAO,CAACoE,OAAO,CAACC,KAAK,CAAC,CAAC,CACvB,GAAI5G,cAAc,CAAEA,cAAc,CAAC,CAAC,CAExC,CAAE,MAAOnF,GAAG,CAAE,CACVC,OAAO,CAAC9D,KAAK,CAAC,0BAA0B,CAAE6D,GAAG,CAAC,CAC9CT,QAAQ,yBAAAjD,MAAA,CAAsB0D,GAAG,CAAClE,OAAO,CAAE,CAAC,CAChD,CACAsD,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAED,mBACIvE,KAAA,QAAKwB,SAAS,CAAC,+DAA+D,CAAAG,QAAA,eAC1E7B,IAAA,OAAI0B,SAAS,CAAC,sCAAsC,CAAAG,QAAA,CAAC,sBAAoB,CAAI,CAAC,cAC9E3B,KAAA,SAAMnB,GAAG,CAAEgO,OAAQ,CAACxE,QAAQ,CAAEP,YAAa,CAACtG,SAAS,CAAC,WAAW,CAAAG,QAAA,eAC7D3B,KAAA,QAAKwB,SAAS,CAAC,WAAW,CAAAG,QAAA,eACtB3B,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,yCAAyC,CAAAG,QAAA,CAAC,mBAAiB,CAAO,CAAC,cACpF7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,eAAe,CAACnD,KAAK,CAAEqJ,QAAQ,CAACM,aAAc,CAAC1J,QAAQ,CAAEsG,YAAa,CAACxH,SAAS,CAAC,kFAAkF,CAAC,CAAC,EAC5L,CAAC,cACLxB,KAAA,WAAQ4F,IAAI,CAAC,WAAW,CAACnD,KAAK,CAAEqJ,QAAQ,CAACE,SAAU,CAACtJ,QAAQ,CAAEsG,YAAa,CAACxH,SAAS,CAAC,kFAAkF,CAAAG,QAAA,eACrK7B,IAAA,WAAQ2C,KAAK,CAAC,EAAE,CAAAd,QAAA,CAAC,uBAAqB,CAAQ,CAAC,CAC9CoL,WAAW,CAACE,QAAQ,CAACjI,GAAG,CAACiL,CAAC,eAAInQ,IAAA,WAAmB2C,KAAK,CAAEwN,CAAC,CAACrL,EAAG,CAAAjD,QAAA,CAAEsO,CAAC,CAACvM,cAAc,EAApCuM,CAAC,CAACrL,EAA2C,CAAC,CAAC,EACtF,CAAC,cACT5E,KAAA,WAAQ4F,IAAI,CAAC,YAAY,CAACnD,KAAK,CAAEqJ,QAAQ,CAACG,UAAW,CAACvJ,QAAQ,CAAEsG,YAAa,CAACxH,SAAS,CAAC,kFAAkF,CAAAG,QAAA,eACvK7B,IAAA,WAAQ2C,KAAK,CAAC,EAAE,CAAAd,QAAA,CAAC,iCAA+B,CAAQ,CAAC,CACxDoL,WAAW,CAACG,SAAS,CAAClI,GAAG,CAACmL,CAAC,eAAIrQ,IAAA,WAAmB2C,KAAK,CAAE0N,CAAC,CAACvL,EAAG,CAAAjD,QAAA,CAAEwO,CAAC,CAAC7C,MAAM,EAA5B6C,CAAC,CAACvL,EAAmC,CAAC,CAAC,EAC/E,CAAC,cACT5E,KAAA,WAAQ4F,IAAI,CAAC,aAAa,CAACnD,KAAK,CAAEqJ,QAAQ,CAACI,WAAY,CAACxJ,QAAQ,CAAEsG,YAAa,CAACxH,SAAS,CAAC,kFAAkF,CAAAG,QAAA,eACzK7B,IAAA,WAAQ2C,KAAK,CAAC,EAAE,CAAAd,QAAA,CAAC,yBAAuB,CAAQ,CAAC,CAChDoL,WAAW,CAACI,WAAW,CAACnI,GAAG,CAACqG,CAAC,eAAIvL,IAAA,WAAmB2C,KAAK,CAAE4I,CAAC,CAACzG,EAAG,CAAAjD,QAAA,CAAE0J,CAAC,CAACiC,MAAM,EAA5BjC,CAAC,CAACzG,EAAmC,CAAC,CAAC,EACjF,CAAC,cACV9E,IAAA,aAAU8F,IAAI,CAAC,qBAAqB,CAACnD,KAAK,CAAEqJ,QAAQ,CAACK,mBAAoB,CAACzJ,QAAQ,CAAEsG,YAAa,CAACnG,WAAW,CAAC,yBAAyB,CAACrB,SAAS,CAAC,kFAAkF,CAAW,CAAC,EAC/O,CAAC,cAENxB,KAAA,QAAKwB,SAAS,CAAC,qDAAqD,CAAAG,QAAA,eAChE3B,KAAA,QAAKwB,SAAS,CAAC,WAAW,CAAAG,QAAA,eACtB7B,IAAA,OAAI0B,SAAS,CAAC,6BAA6B,CAAAG,QAAA,CAAC,4BAAuB,CAAI,CAAC,cACxE3B,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,2BAA2B,CAAAG,QAAA,CAAC,gCAA2B,CAAO,CAAC,cAChF7B,IAAA,UAAOoB,IAAI,CAAC,QAAQ,CAAC0E,IAAI,CAAC,yBAAyB,CAACnD,KAAK,CAAEqJ,QAAQ,CAACQ,uBAAwB,CAAC5J,QAAQ,CAAEsG,YAAa,CAACnG,WAAW,CAAC,MAAM,CAACrB,SAAS,CAAC,+CAA+C,CAAC,CAAC,EAClM,CAAC,cACNxB,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,2BAA2B,CAAAG,QAAA,CAAC,mBAAc,CAAO,CAAC,cACnE7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,uBAAuB,CAAClD,QAAQ,CAAE2C,gBAAiB,CAAC7D,SAAS,CAAC,2BAA2B,CAAC,CAAC,EAClH,CAAC,cACNxB,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,2BAA2B,CAAAG,QAAA,CAAC,0BAAwB,CAAO,CAAC,cAC7E7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,eAAe,CAAClD,QAAQ,CAAE2C,gBAAiB,CAAC7D,SAAS,CAAC,2BAA2B,CAAC,CAAC,EAC1G,CAAC,EACL,CAAC,cACNxB,KAAA,QAAKwB,SAAS,CAAC,WAAW,CAAAG,QAAA,eACtB7B,IAAA,OAAI0B,SAAS,CAAC,6BAA6B,CAAAG,QAAA,CAAC,8BAAyB,CAAI,CAAC,cAC1E3B,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,2BAA2B,CAAAG,QAAA,CAAC,iBAAe,CAAO,CAAC,cACpE7B,IAAA,UAAOoB,IAAI,CAAC,QAAQ,CAAC0E,IAAI,CAAC,gBAAgB,CAACnD,KAAK,CAAEqJ,QAAQ,CAACS,cAAe,CAAC7J,QAAQ,CAAEsG,YAAa,CAACnG,WAAW,CAAC,MAAM,CAACmE,QAAQ,CAAEoG,kBAAmB,CAAC5L,SAAS,CAAC,oEAAoE,CAAC,CAAC,EACnO,CAAC,cACNxB,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,2BAA2B,CAAAG,QAAA,CAAEyL,kBAAkB,CAAG,oBAAoB,CAAG,0BAA0B,CAAQ,CAAC,cAC7HtN,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,yBAAyB,CAAClD,QAAQ,CAAE2C,gBAAiB,CAAC7D,SAAS,CAAC,2BAA2B,CAAC,CAAC,EACpH,CAAC,cACNxB,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,2BAA2B,CAAAG,QAAA,CAAC,oCAAkC,CAAO,CAAC,cACvF7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,iBAAiB,CAAClD,QAAQ,CAAE2C,gBAAiB,CAAC7D,SAAS,CAAC,2BAA2B,CAAC,CAAC,EAC5G,CAAC,EACL,CAAC,EACL,CAAC,cAEN1B,IAAA,CAACiB,KAAK,EAACE,OAAO,CAAEK,KAAM,CAACJ,IAAI,CAAC,OAAO,CAACC,OAAO,CAAEA,CAAA,GAAMuD,QAAQ,CAAC,EAAE,CAAE,CAAE,CAAC,cACnE5E,IAAA,WAAQoB,IAAI,CAAC,QAAQ,CAAC8F,QAAQ,CAAE1C,OAAQ,CAAC9C,SAAS,CAAC,uGAAuG,CAAAG,QAAA,CACrJ2C,OAAO,CAAG,YAAY,CAAG,8BAA8B,CACpD,CAAC,EACP,CAAC,EACN,CAAC,CAEd,CAAC,CAED;AACA,KAAM,CAAAiG,aAAa,CAAG4G,KAAA,EAA6D,IAA5D,CAAEvH,QAAQ,CAAEY,eAAe,CAAEC,QAAQ,CAAExH,IAAI,CAAEC,QAAS,CAAC,CAAAiO,KAAA,CAC1E,KAAM,CAACC,YAAY,CAAEC,eAAe,CAAC,CAAGlU,QAAQ,CAAC,IAAI,CAAC,CACtD,KAAM,CAACmU,SAAS,CAAEC,YAAY,CAAC,CAAGpU,QAAQ,CAAC,EAAE,CAAC,CAC9C,KAAM,CAACqU,UAAU,CAAEC,aAAa,CAAC,CAAGtU,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAACuU,WAAW,CAAEC,cAAc,CAAC,CAAGxU,QAAQ,CAAC,CAAC,CAAC,CACjD,KAAM,CAACyU,YAAY,CAAEC,eAAe,CAAC,CAAG1U,QAAQ,CAAC,EAAE,CAAC,CACpD,KAAM,CAAC2U,cAAc,CAAEC,iBAAiB,CAAC,CAAG5U,QAAQ,CAAC,CAAC,CAAC,CAAC,CACxD,KAAM,CAAC6U,WAAW,CAAEC,cAAc,CAAC,CAAG9U,QAAQ,CAAC,CAAC,CAAC,CAAC,CAClD,KAAM,CAAC+U,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGhV,QAAQ,CAAC,IAAI,CAAC,CAAE;AAGhEC,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAgV,cAAc,CAAGA,CAAA,GAAM,CACzB,KAAM,CAAAC,MAAM,CAAGvU,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,UAAU,CAAC,CAAE9C,KAAK,CAAC,KAAK,CAAE,IAAI,CAAE,SAAS,CAAC,CAAC,CAC/E,KAAM,CAAAuU,UAAU,CAAGlU,UAAU,CAACiU,MAAM,CAAG7D,QAAQ,EAAK,CAChD,KAAM,CAAA+D,OAAO,CAAG,CAAC,CAAC,CAClB/D,QAAQ,CAACgE,OAAO,CAACvU,GAAG,EAAI,CAAEsU,OAAO,CAACtU,GAAG,CAAC2G,EAAE,CAAC,CAAG3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAACxB,cAAc,CAAE,CAAC,CAAC,CACzEqO,iBAAiB,CAACQ,OAAO,CAAC,CAC9B,CAAC,CAAC,CAEF,KAAM,CAAAE,SAAS,CAAG3U,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,UAAU,CAAC,CAAC,CACnD,KAAM,CAAA6R,aAAa,CAAGtU,UAAU,CAACqU,SAAS,CAAGjE,QAAQ,EAAK,CACtD,KAAM,CAAAmE,MAAM,CAAG,CAAC,CAAC,CACjBnE,QAAQ,CAACgE,OAAO,CAACvU,GAAG,EAAI,CAAE0U,MAAM,CAAC1U,GAAG,CAAC2G,EAAE,CAAC,CAAG3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAC0N,KAAK,CAAE,CAAC,CAAC,CAC/DX,cAAc,CAACU,MAAM,CAAC,CAC1B,CAAC,CAAC,CAEF,MAAO,IAAM,CACTL,UAAU,CAAC,CAAC,CACZI,aAAa,CAAC,CAAC,CACnB,CAAC,CACL,CAAC,CACD,KAAM,CAAA7N,WAAW,CAAGuN,cAAc,CAAC,CAAC,CACpC,MAAO,IAAMvN,WAAW,CAAC,CAAC,CAC9B,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAgO,kBAAkB,CAAGC,MAAA,EAAuC,IAAtC,CAAE/O,OAAO,CAAE5C,OAAO,CAAE4R,WAAY,CAAC,CAAAD,MAAA,CACzD,KAAM,CAACxN,KAAK,CAAEkH,QAAQ,CAAC,CAAGrP,QAAQ,CAAC,CAAEsP,qBAAqB,CAAE,IAAI,CAAEC,aAAa,CAAE,IAAI,CAAEC,uBAAuB,CAAE,IAAI,CAAEC,eAAe,CAAE,IAAK,CAAC,CAAC,CAC9I,KAAM,CAACtI,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACmE,KAAK,CAAEoD,QAAQ,CAAC,CAAGvH,QAAQ,CAAC,EAAE,CAAC,CAEtC,KAAM,CAAAkI,gBAAgB,CAAI1C,CAAC,EAAK,CAC5B,KAAM,CAAEiD,IAAI,CAAEN,KAAK,CAAE8I,UAAW,CAAC,CAAGzL,CAAC,CAACC,MAAM,CAC5C,GAAIwL,UAAU,CAAC,CAAC,CAAC,CAAE5B,QAAQ,CAACvD,IAAI,EAAAhE,aAAA,CAAAA,aAAA,IAAUgE,IAAI,MAAE,CAACrD,IAAI,EAAGwI,UAAU,CAAC,CAAC,CAAC,EAAG,CAAC,CAC7E,CAAC,CAED,KAAM,CAAAC,UAAU,CAAG,KAAAA,CAAOC,IAAI,CAAEC,IAAI,GAAK,CACrC,GAAI,CAACD,IAAI,CAAE,MAAO,KAAI,CACtB,KAAM,CAAA7I,UAAU,CAAG5G,GAAG,CAACiC,OAAO,CAAEyN,IAAI,CAAC,CACrC,KAAM,CAAA1I,UAAU,CAAG/G,oBAAoB,CAAC2G,UAAU,CAAE6I,IAAI,CAAC,CACzD,KAAM,CAAAzI,UAAU,CAChB,MAAO,MAAM,CAAA9G,cAAc,CAAC8G,UAAU,CAAC2I,QAAQ,CAAC3P,GAAG,CAAC,CACxD,CAAC,CAED,KAAM,CAAAmU,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC3BzO,UAAU,CAAC,IAAI,CAAC,CAChBG,QAAQ,CAAC,EAAE,CAAC,CACZ,GAAI,KAAAuO,sBAAA,CAAAC,qBAAA,CAAAC,sBAAA,CAAAC,sBAAA,CACA,KAAM,CAAAC,aAAa,CAAG,CAAC,CAAC,CACxB,KAAM,CAAAxE,oBAAoB,CAAG,KAAM,CAAAR,UAAU,CAAC/I,KAAK,CAACmH,qBAAqB,0BAAAhL,MAAA,CAA2BiE,IAAI,CAACC,GAAG,CAAC,CAAC,MAAAlE,MAAA,EAAAwR,sBAAA,CAAI3N,KAAK,CAACmH,qBAAqB,UAAAwG,sBAAA,iBAA3BA,sBAAA,CAA6BrN,IAAI,CAAE,CAAC,CACtJ,KAAM,CAAAkJ,YAAY,CAAG,KAAM,CAAAT,UAAU,CAAC/I,KAAK,CAACoH,aAAa,gBAAAjL,MAAA,CAAiBiE,IAAI,CAACC,GAAG,CAAC,CAAC,MAAAlE,MAAA,EAAAyR,qBAAA,CAAI5N,KAAK,CAACoH,aAAa,UAAAwG,qBAAA,iBAAnBA,qBAAA,CAAqBtN,IAAI,CAAE,CAAC,CACpH,KAAM,CAAAmJ,sBAAsB,CAAG,KAAM,CAAAV,UAAU,CAAC/I,KAAK,CAACqH,uBAAuB,6BAAAlL,MAAA,CAA8BiE,IAAI,CAACC,GAAG,CAAC,CAAC,MAAAlE,MAAA,EAAA0R,sBAAA,CAAI7N,KAAK,CAACqH,uBAAuB,UAAAwG,sBAAA,iBAA7BA,sBAAA,CAA+BvN,IAAI,CAAE,CAAC,CAC/J,KAAM,CAAAoJ,cAAc,CAAG,KAAM,CAAAX,UAAU,CAAC/I,KAAK,CAACsH,eAAe,mBAAAnL,MAAA,CAAoBiE,IAAI,CAACC,GAAG,CAAC,CAAC,MAAAlE,MAAA,EAAA2R,sBAAA,CAAI9N,KAAK,CAACsH,eAAe,UAAAwG,sBAAA,iBAArBA,sBAAA,CAAuBxN,IAAI,CAAE,CAAC,CAE7H,GAAGiJ,oBAAoB,CAAEwE,aAAa,CAACxE,oBAAoB,CAAGA,oBAAoB,CAClF,GAAGC,YAAY,CAAEuE,aAAa,CAACvE,YAAY,CAAGA,YAAY,CAC1D,GAAGC,sBAAsB,CAAEsE,aAAa,CAACtE,sBAAsB,CAAGA,sBAAsB,CACxF,GAAGC,cAAc,CAAEqE,aAAa,CAACrE,cAAc,CAAGA,cAAc,CAEhE,GAAIF,YAAY,CAAE,CACduE,aAAa,CAAC1C,MAAM,CAAG,QAAQ,CAC/B0C,aAAa,CAAC/H,aAAa,CAAG,QAAQ,CAC1C,CAEA,GAAIgI,MAAM,CAACC,IAAI,CAACF,aAAa,CAAC,CAACzM,MAAM,CAAG,CAAC,CAAE,CACvC,KAAM,CAAAzI,SAAS,CAACF,GAAG,CAAC4C,EAAE,CAAE,WAAW,CAAEkD,OAAO,CAACa,EAAE,CAAC,CAAEyO,aAAa,CAAC,CACpE,CAEAN,WAAW,CAAC,CAAC,CACb5R,OAAO,CAAC,CAAC,CACb,CAAE,MAAOgE,GAAG,CAAE,CACVT,QAAQ,CAAC,4BAA4B,CAAC,CACtCH,UAAU,CAAC,KAAK,CAAC,CACrB,CACJ,CAAC,CAED,mBACIzE,IAAA,QAAK0B,SAAS,CAAC,gFAAgF,CAAAG,QAAA,cAC3F3B,KAAA,QAAKwB,SAAS,CAAC,mDAAmD,CAAAG,QAAA,eAC9D3B,KAAA,OAAIwB,SAAS,CAAC,wBAAwB,CAAAG,QAAA,EAAC,wBAAsB,CAACoC,OAAO,CAAC4C,GAAG,EAAK,CAAC,cAC/E3G,KAAA,QAAKwB,SAAS,CAAC,WAAW,CAAAG,QAAA,eACtB3B,KAAA,QAAA2B,QAAA,eAAK7B,IAAA,UAAO0B,SAAS,CAAC,2BAA2B,CAAAG,QAAA,CAAC,2BAAsB,CAAO,CAAC,CAACoC,OAAO,CAAC8K,oBAAoB,cAAG/O,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAAC8K,oBAAqB,CAACjM,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,uBAAuB,CAAAG,QAAA,CAAC,YAAU,CAAG,CAAC,cAAG7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,uBAAuB,CAAClD,QAAQ,CAAE2C,gBAAiB,CAAC7D,SAAS,CAAC,2BAA2B,CAAC,CAAC,EAAM,CAAC,cAC9WxB,KAAA,QAAA2B,QAAA,eAAK7B,IAAA,UAAO0B,SAAS,CAAC,2BAA2B,CAAAG,QAAA,CAAC,kCAAgC,CAAO,CAAC,CAACoC,OAAO,CAAC+K,YAAY,cAAGhP,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAAC+K,YAAa,CAAClM,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,uBAAuB,CAAAG,QAAA,CAAC,YAAU,CAAG,CAAC,cAAG7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,eAAe,CAAClD,QAAQ,CAAE2C,gBAAiB,CAAC7D,SAAS,CAAC,2BAA2B,CAAC,CAAC,EAAM,CAAC,cAChWxB,KAAA,QAAA2B,QAAA,eAAK7B,IAAA,UAAO0B,SAAS,CAAC,2BAA2B,CAAAG,QAAA,CAAC,6BAAwB,CAAO,CAAC,CAACoC,OAAO,CAACgL,sBAAsB,cAAGjP,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAACgL,sBAAuB,CAACnM,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,uBAAuB,CAAAG,QAAA,CAAC,YAAU,CAAG,CAAC,cAAG7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,yBAAyB,CAAClD,QAAQ,CAAE2C,gBAAiB,CAAC7D,SAAS,CAAC,2BAA2B,CAAC,CAAC,EAAM,CAAC,cACtXxB,KAAA,QAAA2B,QAAA,eAAK7B,IAAA,UAAO0B,SAAS,CAAC,2BAA2B,CAAAG,QAAA,CAAC,oCAAkC,CAAO,CAAC,CAACoC,OAAO,CAACiL,cAAc,cAAGlP,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAACiL,cAAe,CAACpM,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,uBAAuB,CAAAG,QAAA,CAAC,YAAU,CAAG,CAAC,cAAG7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,iBAAiB,CAAClD,QAAQ,CAAE2C,gBAAiB,CAAC7D,SAAS,CAAC,2BAA2B,CAAC,CAAC,EAAM,CAAC,EACvW,CAAC,cACN1B,IAAA,CAACiB,KAAK,EAACE,OAAO,CAAEK,KAAM,CAACJ,IAAI,CAAC,OAAO,CAACC,OAAO,CAAEA,CAAA,GAAMuD,QAAQ,CAAC,EAAE,CAAE,CAAE,CAAC,cACnE1E,KAAA,QAAKwB,SAAS,CAAC,iCAAiC,CAAAG,QAAA,eAAC7B,IAAA,WAAQ8B,OAAO,CAAET,OAAQ,CAAC6F,QAAQ,CAAE1C,OAAQ,CAAC9C,SAAS,CAAC,yEAAyE,CAAAG,QAAA,CAAC,UAAQ,CAAQ,CAAC,cAAA7B,IAAA,WAAQ8B,OAAO,CAAEoR,UAAW,CAAChM,QAAQ,CAAE1C,OAAQ,CAAC9C,SAAS,CAAC,wEAAwE,CAAAG,QAAA,CAAE2C,OAAO,CAAG,cAAc,CAAG,iBAAiB,CAAS,CAAC,EAAK,CAAC,EAClY,CAAC,CACL,CAAC,CAEd,CAAC,CAED,KAAM,CAAAkP,kBAAkB,CAAGC,MAAA,EAAuC,IAAtC,CAAE1P,OAAO,CAAE5C,OAAO,CAAE4R,WAAY,CAAC,CAAAU,MAAA,CACzD,KAAM,CAACC,WAAW,CAAEC,cAAc,CAAC,CAAGxW,QAAQ,CAAC,EAAE,CAAC,CAClD,KAAM,CAACyW,mBAAmB,CAAEC,sBAAsB,CAAC,CAAG1W,QAAQ,CAAC4G,OAAO,CAAC8M,mBAAmB,EAAI,EAAE,CAAC,CACjG,KAAM,CAACiD,YAAY,CAAEC,eAAe,CAAC,CAAG5W,QAAQ,CAAC4G,OAAO,CAACiQ,mBAAmB,CAAGjQ,OAAO,CAACiQ,mBAAmB,CAACC,MAAM,CAAC,CAAC,CAAC5H,WAAW,CAAC,CAAC,CAAC1I,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAG,EAAE,CAAC,CACrJ,KAAM,CAACW,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,KAAK,CAAC,CAE7CC,SAAS,CAAC,IAAM,CACZ,KAAM,CAAA8W,gBAAgB,CAAG,KAAAA,CAAA,GAAY,CACjC,KAAM,CAAAvP,CAAC,CAAG7G,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,UAAU,CAAC,CAAE9C,KAAK,CAAC,KAAK,CAAE,IAAI,CAAE,SAAS,CAAC,CAAC,CAC1E,KAAM,CAAA+G,aAAa,CAAG,KAAM,CAAA9G,OAAO,CAAC2G,CAAC,CAAC,CACtCgP,cAAc,CAAC7O,aAAa,CAACC,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CAAC,CAClF,CAAC,CACDgP,gBAAgB,CAAC,CAAC,CACtB,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAC,oBAAoB,CAAIC,MAAM,EAAK,CACrCP,sBAAsB,CAAC5K,IAAI,EACvBA,IAAI,CAACoL,QAAQ,CAACD,MAAM,CAAC,CAAGnL,IAAI,CAACmC,MAAM,CAACxG,EAAE,EAAIA,EAAE,GAAKwP,MAAM,CAAC,CAAG,CAAC,GAAGnL,IAAI,CAAEmL,MAAM,CAC/E,CAAC,CACL,CAAC,CAED,KAAM,CAAApB,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC3BzO,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAA+P,UAAU,CAAGrW,GAAG,CAAC4C,EAAE,CAAE,WAAW,CAAEkD,OAAO,CAACa,EAAE,CAAC,CAEnD,KAAM,CAAAkM,cAAc,CAAG,CAAC,CAAC,CACzB8C,mBAAmB,CAACpB,OAAO,CAAC4B,MAAM,EAAI,KAAAG,qBAAA,CAClCzD,cAAc,CAACsD,MAAM,CAAC,CAAG,EAAAG,qBAAA,CAAAxQ,OAAO,CAAC+M,cAAc,UAAAyD,qBAAA,iBAAtBA,qBAAA,CAAyBH,MAAM,CAAC,GAAI,UAAU,CAC3E,CAAC,CAAC,CAEF,KAAM,CAAAjW,SAAS,CAACmW,UAAU,CAAE,CACxBzD,mBAAmB,CAAE+C,mBAAmB,CACxC9C,cAAc,CAAEA,cAAc,CAC9B0D,sBAAsB,CAAElW,SAAS,CAACqH,GAAG,CAAC,CAAC,CACvCqO,mBAAmB,CAAEF,YAAY,CAAGxV,SAAS,CAACmS,QAAQ,CAAC,GAAI,CAAA/K,IAAI,CAACoO,YAAY,CAAC,CAAC,CAAG,IACrF,CAAC,CAAC,CACFvP,UAAU,CAAC,KAAK,CAAC,CACjBwO,WAAW,CAAC,CAAC,CACb5R,OAAO,CAAC,CAAC,CACb,CAAC,CAED,mBACIrB,IAAA,QAAK0B,SAAS,CAAC,gFAAgF,CAAAG,QAAA,cAC3F3B,KAAA,QAAKwB,SAAS,CAAC,mDAAmD,CAAAG,QAAA,eAC9D3B,KAAA,OAAIwB,SAAS,CAAC,wBAAwB,CAAAG,QAAA,EAAC,oBAAkB,CAACoC,OAAO,CAAC4C,GAAG,EAAK,CAAC,cAC3E3G,KAAA,QAAKwB,SAAS,CAAC,WAAW,CAAAG,QAAA,eACtB3B,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,yCAAyC,CAAAG,QAAA,CAAC,yBAAoB,CAAO,CAAC,cACvF7B,IAAA,QAAK0B,SAAS,CAAC,qDAAqD,CAAAG,QAAA,CAC/D+R,WAAW,CAAC1O,GAAG,CAACyP,IAAI,eACjBzU,KAAA,QAAmBwB,SAAS,CAAC,mBAAmB,CAAAG,QAAA,eAC5C7B,IAAA,UACIoB,IAAI,CAAC,UAAU,CACf0D,EAAE,CAAE6P,IAAI,CAAC7P,EAAG,CACZ8P,OAAO,CAAEd,mBAAmB,CAACS,QAAQ,CAACI,IAAI,CAAC7P,EAAE,CAAE,CAC/ClC,QAAQ,CAAEA,CAAA,GAAMyR,oBAAoB,CAACM,IAAI,CAAC7P,EAAE,CAAE,CAC9CpD,SAAS,CAAC,uEAAuE,CACpF,CAAC,cACF1B,IAAA,UAAO6U,OAAO,CAAEF,IAAI,CAAC7P,EAAG,CAACpD,SAAS,CAAC,4BAA4B,CAAAG,QAAA,CAAE8S,IAAI,CAAC/Q,cAAc,CAAQ,CAAC,GARvF+Q,IAAI,CAAC7P,EASV,CACR,CAAC,CACD,CAAC,EACL,CAAC,cACN5E,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,yCAAyC,CAAAG,QAAA,CAAC,sCAAiC,CAAO,CAAC,cACpG7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAACuB,KAAK,CAAEqR,YAAa,CAACpR,QAAQ,CAAEC,CAAC,EAAIoR,eAAe,CAACpR,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACjB,SAAS,CAAC,+CAA+C,CAAC,CAAC,EAClJ,CAAC,EACL,CAAC,cACNxB,KAAA,QAAKwB,SAAS,CAAC,iCAAiC,CAAAG,QAAA,eAC5C7B,IAAA,WAAQ8B,OAAO,CAAET,OAAQ,CAAC6F,QAAQ,CAAE1C,OAAQ,CAAC9C,SAAS,CAAC,yEAAyE,CAAAG,QAAA,CAAC,UAAQ,CAAQ,CAAC,cAClJ7B,IAAA,WAAQ8B,OAAO,CAAEoR,UAAW,CAAChM,QAAQ,CAAE1C,OAAQ,CAAC9C,SAAS,CAAC,wEAAwE,CAAAG,QAAA,CAAE2C,OAAO,CAAG,cAAc,CAAG,oBAAoB,CAAS,CAAC,EAC5L,CAAC,EACL,CAAC,CACL,CAAC,CAEd,CAAC,CAED,KAAM,CAAAsQ,gBAAgB,CAAGhL,QAAQ,CAACwB,MAAM,CAACC,CAAC,EACrCA,CAAC,CAAC1E,GAAG,EAAI0E,CAAC,CAAC1E,GAAG,CAAC4G,WAAW,CAAC,CAAC,CAAC8G,QAAQ,CAAC7C,UAAU,CAACjE,WAAW,CAAC,CAAC,CAAC,EAC/DlC,CAAC,CAACK,aAAa,EAAIL,CAAC,CAACK,aAAa,CAAC6B,WAAW,CAAC,CAAC,CAAC8G,QAAQ,CAAC7C,UAAU,CAACjE,WAAW,CAAC,CAAC,CAAE,EACpFlC,CAAC,CAACM,cAAc,EAAIN,CAAC,CAACM,cAAc,CAAC4B,WAAW,CAAC,CAAC,CAAC8G,QAAQ,CAAC7C,UAAU,CAACjE,WAAW,CAAC,CAAC,CACzF,CAAC,CAED,KAAM,CAAAsH,YAAY,CAAGD,gBAAgB,CAACxL,KAAK,CAAC,CAACsI,WAAW,CAAG,CAAC,EAAIE,YAAY,CAAEF,WAAW,CAAGE,YAAY,CAAC,CACzG,KAAM,CAAAkD,UAAU,CAAGC,IAAI,CAACC,IAAI,CAACJ,gBAAgB,CAAChO,MAAM,CAAGgL,YAAY,CAAC,CAEpE,KAAM,CAAAqD,QAAQ,CAAIC,UAAU,EAAKvD,cAAc,CAACuD,UAAU,CAAC,CAC3D;AACA,KAAM,CAAA3O,UAAU,CAAIC,SAAS,EAAK,CAC9B,GAAI,CAACA,SAAS,CAAE,MAAO,KAAK,CAC5B,KAAM,CAAA2O,IAAI,CAAG3O,SAAS,CAACyN,MAAM,CAAC,CAAC,CAC/B;AACA,KAAM,CAAAmB,kBAAkB,CAAGD,IAAI,CAACE,iBAAiB,CAAC,CAAC,CAAG,KAAK,CAC3D,KAAM,CAAAC,YAAY,CAAG,GAAI,CAAA5P,IAAI,CAACyP,IAAI,CAAClN,OAAO,CAAC,CAAC,CAAGmN,kBAAkB,CAAC,CAClE,MAAO,CAAAE,YAAY,CAACC,kBAAkB,CAAC,OAAO,CAAE,CAC5CC,IAAI,CAAE,SAAS,CAAEC,KAAK,CAAE,SAAS,CAAEC,GAAG,CAAE,SAC5C,CAAC,CAAC,CACN,CAAC,CAED;AACA,KAAM,CAAAC,eAAe,CAAInP,SAAS,EAAK,CACnC,GAAI,CAACA,SAAS,CAAE,MAAO,eAAe,CACtC,KAAM,CAAAoP,OAAO,CAAGpP,SAAS,CAACyN,MAAM,CAAC,CAAC,CAClC,KAAM,CAAA4B,KAAK,CAAG,GAAI,CAAAnQ,IAAI,CAAC,CAAC,CACxBmQ,KAAK,CAACC,QAAQ,CAAC,CAAC,CAAE,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC,CAE1B,KAAM,CAAAC,QAAQ,CAAGH,OAAO,CAAC3N,OAAO,CAAC,CAAC,CAAG4N,KAAK,CAAC5N,OAAO,CAAC,CAAC,CACpD,KAAM,CAAA+N,QAAQ,CAAGjB,IAAI,CAACC,IAAI,CAACe,QAAQ,EAAI,IAAI,CAAG,EAAE,CAAG,EAAE,CAAG,EAAE,CAAC,CAAC,CAE5D,GAAIC,QAAQ,CAAG,CAAC,CAAE,MAAO,wBAAwB,CAAE;AACnD,GAAIA,QAAQ,EAAI,CAAC,CAAE,MAAO,+BAA+B,CAAE;AAC3D,MAAO,eAAe,CAAE;AAC5B,CAAC,CAED,KAAM,CAAAC,qBAAqB,CAAG,KAAO,CAAA1V,SAAS,EAAK,CAC/C,KAAM,CAAApC,SAAS,CAACF,GAAG,CAAC4C,EAAE,CAAE,WAAW,CAAEN,SAAS,CAAC,CAAE,CAAEoQ,MAAM,CAAE,QAAQ,CAAErF,aAAa,CAAE,QAAS,CAAC,CAAC,CACnG,CAAC,CAED,KAAM,CAAA4K,mBAAmB,CAAG,KAAO,CAAA3V,SAAS,EAAK,CAC7C,KAAM,CAAA9B,SAAS,CAACR,GAAG,CAAC4C,EAAE,CAAE,WAAW,CAAEN,SAAS,CAAC,CAAC,CAChD4R,mBAAmB,CAAC,IAAI,CAAC,CAAE;AAC/B,CAAC,CAED,KAAM,CAAAgE,mBAAmB,CAAGA,CAAC5V,SAAS,CAAE6V,UAAU,GAAK,CACnDjE,mBAAmB,CAAC,CAChBpQ,KAAK,CAAE,uBAAuB,CAC9Bd,OAAO,0DAAAQ,MAAA,CAAqD2U,UAAU,0CAAqC,CAC3GpU,SAAS,CAAEA,CAAA,GAAMkU,mBAAmB,CAAC3V,SAAS,CAAC,CAC/C2B,WAAW,CAAE,YAAY,CACzBE,YAAY,CAAE,YAClB,CAAC,CAAC,CACN,CAAC,CAED,mBACIpC,KAAA,CAAAE,SAAA,EAAAyB,QAAA,eACI3B,KAAA,QAAKwB,SAAS,CAAC,6DAA6D,CAAAG,QAAA,eACxE7B,IAAA,UACIoB,IAAI,CAAC,MAAM,CACX2B,WAAW,CAAC,oDAAoD,CAChErB,SAAS,CAAC,0EAA0E,CACpFkB,QAAQ,CAAGC,CAAC,EAAK,CAAE8O,aAAa,CAAC9O,CAAC,CAACC,MAAM,CAACH,KAAK,CAAC,CAAEkP,cAAc,CAAC,CAAC,CAAC,CAAE,CAAE,CAC1E,CAAC,cACF3R,KAAA,QAAKwB,SAAS,CAAC,mBAAmB,CAAAG,QAAA,eAC9B7B,IAAA,SAAM0B,SAAS,CAAC,cAAc,CAAAG,QAAA,CAAC,UAAQ,CAAM,CAAC,cAC9C3B,KAAA,WAAQyC,KAAK,CAAEmP,YAAa,CAAClP,QAAQ,CAAGC,CAAC,EAAK,CAAEkP,eAAe,CAACd,MAAM,CAACpO,CAAC,CAACC,MAAM,CAACH,KAAK,CAAC,CAAC,CAAEkP,cAAc,CAAC,CAAC,CAAC,CAAE,CAAE,CAACnQ,SAAS,CAAC,6CAA6C,CAAAG,QAAA,eAClK7B,IAAA,WAAQ2C,KAAK,CAAE,EAAG,CAAAd,QAAA,CAAC,IAAE,CAAQ,CAAC,cAAA7B,IAAA,WAAQ2C,KAAK,CAAE,EAAG,CAAAd,QAAA,CAAC,IAAE,CAAQ,CAAC,cAAA7B,IAAA,WAAQ2C,KAAK,CAAE,EAAG,CAAAd,QAAA,CAAC,IAAE,CAAQ,CAAC,cAAA7B,IAAA,WAAQ2C,KAAK,CAAE,GAAI,CAAAd,QAAA,CAAC,KAAG,CAAQ,CAAC,EACtH,CAAC,EACR,CAAC,EACL,CAAC,cAEN7B,IAAA,QAAK0B,SAAS,CAAC,4CAA4C,CAAAG,QAAA,cACvD3B,KAAA,UAAOwB,SAAS,CAAC,qCAAqC,CAAAG,QAAA,eAClD7B,IAAA,UAAO0B,SAAS,CAAC,YAAY,CAAAG,QAAA,cACzB3B,KAAA,OAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,gBAAc,CAAI,CAAC,cACnG7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,KAAG,CAAI,CAAC,cACxF7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,SAAO,CAAI,CAAC,cAC5F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,UAAQ,CAAI,CAAC,CAC5F8I,QAAQ,GAAK,eAAe,eACzBzK,KAAA,CAAAE,SAAA,EAAAyB,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,WAAS,CAAI,CAAC,cAC9F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,kBAAa,CAAI,CAAC,cAClG7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,aAAW,CAAI,CAAC,cAChG7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,UAAQ,CAAI,CAAC,cAC7F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,QAAM,CAAI,CAAC,cAC3F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,OAAK,CAAI,CAAC,cAC1F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,cAAY,CAAI,CAAC,cACjG7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,gBAAc,CAAI,CAAC,cACnG7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,eAAa,CAAI,CAAC,cAClG7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,iBAAe,CAAI,CAAC,EACtG,CACL,CACA8I,QAAQ,GAAK,YAAY,eACtBzK,KAAA,CAAAE,SAAA,EAAAyB,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,iBAAY,CAAI,CAAC,cACjG7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,oBAAe,CAAI,CAAC,EACtG,CACL,cACD7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,QAAM,CAAI,CAAC,cAC3F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,UAAQ,CAAI,CAAC,EAC7F,CAAC,CACF,CAAC,cACR7B,IAAA,UAAO0B,SAAS,CAAC,mCAAmC,CAAAG,QAAA,CAC/CkT,YAAY,CAAC7P,GAAG,CAACjB,OAAO,EAAI,KAAAsS,qBAAA,CACzB,KAAM,CAAAC,UAAU,CAAGvS,OAAO,CAAC8M,mBAAmB,EAAI9M,OAAO,CAAC8M,mBAAmB,CAACjK,MAAM,CAAG,CAAC,CACxF,mBACK5G,KAAA,OAAA2B,QAAA,eACG7B,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAE4E,UAAU,CAACxC,OAAO,CAACqI,aAAa,CAAC,CAAK,CAAC,cAC5FtM,IAAA,OAAI0B,SAAS,CAAC,iDAAiD,CAAAG,QAAA,CAAEoC,OAAO,CAAC4C,GAAG,CAAK,CAAC,cAClF7G,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAAC2H,aAAa,CAAK,CAAC,cAChF5L,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAAC4H,cAAc,CAAK,CAAC,CAChFlB,QAAQ,GAAK,eAAe,eACzBzK,KAAA,CAAAE,SAAA,EAAAyB,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAAC2M,eAAe,CAAK,CAAC,cAClF5Q,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAACwS,yBAAyB,EAAI,KAAK,CAAK,CAAC,cACrGzW,IAAA,OAAI0B,SAAS,CAAC,iCAAiC,CAACO,KAAK,CAAEgC,OAAO,CAACoI,mBAAoB,CAAAxK,QAAA,cAC/E7B,IAAA,MAAG0B,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAEoC,OAAO,CAACoI,mBAAmB,EAAI,KAAK,CAAI,CAAC,CACvE,CAAC,cACLrM,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAACiN,WAAW,CAAK,CAAC,cAC9EhR,KAAA,OAAIwB,SAAS,CAAC,oDAAoD,CAAAG,QAAA,EAAC,GAAC,CAAC,CAACoC,OAAO,CAACuI,uBAAuB,EAAI,CAAC,EAAEkK,OAAO,CAAC,CAAC,CAAC,EAAK,CAAC,cAC5HxW,KAAA,OAAIwB,SAAS,CAAC,kDAAkD,CAAAG,QAAA,EAAC,GAAC,CAAC,CAACoC,OAAO,CAACwI,cAAc,EAAI,CAAC,EAAEiK,OAAO,CAAC,CAAC,CAAC,EAAK,CAAC,cACjH1W,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,cAAC3B,KAAA,QAAKwB,SAAS,CAAC,gBAAgB,CAAAG,QAAA,EAAEoC,OAAO,CAAC8K,oBAAoB,eAAI/O,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAAC8K,oBAAqB,CAACjM,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAC,KAAG,CAAG,CAAC,CAAEoC,OAAO,CAAC+K,YAAY,eAAIhP,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAAC+K,YAAa,CAAClM,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAC,IAAE,CAAG,CAAC,EAAM,CAAC,CAAI,CAAC,cAC5V7B,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,cAAC3B,KAAA,QAAKwB,SAAS,CAAC,gBAAgB,CAAAG,QAAA,EAAEoC,OAAO,CAACgL,sBAAsB,eAAIjP,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAACgL,sBAAuB,CAACnM,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAC,KAAG,CAAG,CAAC,CAAEoC,OAAO,CAACiL,cAAc,eAAIlP,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAACiL,cAAe,CAACpM,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAC,IAAE,CAAG,CAAC,EAAM,CAAC,CAAI,CAAC,cACpW7B,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEqQ,WAAW,CAACjO,OAAO,CAAC0S,gBAAgB,CAAC,EAAI,KAAK,CAAK,CAAC,cACzG3W,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEqQ,WAAW,CAACjO,OAAO,CAAC2S,kBAAkB,CAAC,GAAK,EAAAL,qBAAA,CAAAtS,OAAO,CAAC2M,eAAe,UAAA2F,qBAAA,iBAAvBA,qBAAA,CAAyB9I,WAAW,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC,IAAK,+BAA+B,CAAG,KAAK,CAAG,KAAK,CAAC,CAAK,CAAC,EAC3M,CACL,CACA/C,QAAQ,GAAK,YAAY,eACtBzK,KAAA,CAAAE,SAAA,EAAAyB,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,cAAC7B,IAAA,SAAM0B,SAAS,CAAEmU,eAAe,CAAC5R,OAAO,CAACiQ,mBAAmB,CAAE,CAAArS,QAAA,CAAE4E,UAAU,CAACxC,OAAO,CAACiQ,mBAAmB,CAAC,CAAO,CAAC,CAAI,CAAC,cACxKlU,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,cAC/C7B,IAAA,QAAK0B,SAAS,CAAC,yBAAyB,CAAAG,QAAA,CACnC,CAACoC,OAAO,CAAC8M,mBAAmB,EAAI,EAAE,EAAE7L,GAAG,CAACoP,MAAM,EAAI,CAC/C,KAAM,CAAAuC,MAAM,CAAG5S,OAAO,CAAC+M,cAAc,CAAI/M,OAAO,CAAC+M,cAAc,CAACsD,MAAM,CAAC,EAAI,UAAU,CAAI,UAAU,CACnG,KAAM,CAAAwC,WAAW,CAAGD,MAAM,GAAK,YAAY,CAAG,6BAA6B,CAAG,2BAA2B,CACzG,mBAAQ3W,KAAA,SAAmBwB,SAAS,wBAAAC,MAAA,CAAyBmV,WAAW,CAAG,CAAAjV,QAAA,EAAEmQ,cAAc,CAACsC,MAAM,CAAC,EAAI,aAAa,CAAC,IAAE,CAACuC,MAAM,GAA3GvC,MAAkH,CAAC,CAC1I,CAAC,CAAC,CACD,CAAC,CACN,CAAC,EACP,CACL,cACDtU,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,cAAC7B,IAAA,SAAM0B,SAAS,kEAAAC,MAAA,CAAmEsC,OAAO,CAAC4M,MAAM,GAAK,QAAQ,CAAG,+BAA+B,CAAG,2BAA2B,CAAG,CAAAhP,QAAA,CAAEoC,OAAO,CAAC4M,MAAM,CAAO,CAAC,CAAI,CAAC,cACvO7Q,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,cACrB3B,KAAA,QAAKwB,SAAS,CAAC,6BAA6B,CAAAG,QAAA,EACvC8I,QAAQ,GAAK,eAAe,EAAI1G,OAAO,CAAC4M,MAAM,GAAK,YAAY,eAAI7Q,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMqU,qBAAqB,CAAClS,OAAO,CAACa,EAAE,CAAE,CAACpD,SAAS,CAAC,gBAAgB,CAAAG,QAAA,CAAC,SAAO,CAAQ,CAAC,CACxK8I,QAAQ,GAAK,eAAe,eAAI3K,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM,CAAEyP,eAAe,CAACtN,OAAO,CAAC,CAAEwN,YAAY,CAAC,QAAQ,CAAC,CAAE,CAAE,CAAC/P,SAAS,CAAC,iBAAiB,CAAAG,QAAA,CAAC,WAAS,CAAQ,CAAC,CAC5J8I,QAAQ,GAAK,eAAe,EAAI1G,OAAO,CAAC4M,MAAM,GAAK,WAAW,EAAI5M,OAAO,CAAC4M,MAAM,GAAK,WAAW,eAAI7Q,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMuU,mBAAmB,CAACpS,OAAO,CAACa,EAAE,CAAEb,OAAO,CAAC4C,GAAG,CAAE,CAACnF,SAAS,CAAC,cAAc,CAAAG,QAAA,CAAC,QAAM,CAAQ,CAAC,CAEjN8I,QAAQ,GAAK,YAAY,eAAI3K,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM,CAAEyP,eAAe,CAACtN,OAAO,CAAC,CAAEwN,YAAY,CAAC,QAAQ,CAAC,CAAE,CAAE,CAAC/P,SAAS,CAAC,iBAAiB,CAAAG,QAAA,CAAE2U,UAAU,CAAG,WAAW,CAAG,SAAS,CAAS,CAAC,CACtL7L,QAAQ,GAAK,YAAY,EAAI6L,UAAU,eAAIxW,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM,CAAEyP,eAAe,CAACtN,OAAO,CAAC,CAAEwN,YAAY,CAAC,KAAK,CAAC,CAAE,CAAE,CAAC/P,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAC,aAAQ,CAAQ,CAAC,EACjK,CAAC,CACN,CAAC,GA7CCoC,OAAO,CAACa,EA8Cd,CAAC,CAEb,CAAC,CAAC,CACC,CAAC,EACL,CAAC,CACP,CAAC,cAEN5E,KAAA,QAAKwB,SAAS,CAAC,wCAAwC,CAAAG,QAAA,eACnD3B,KAAA,SAAMwB,SAAS,CAAC,uBAAuB,CAAAG,QAAA,EAAC,YAAO,CAAC+P,WAAW,CAAC,MAAI,CAACoD,UAAU,EAAO,CAAC,cACnF9U,KAAA,QAAA2B,QAAA,eACI7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMqT,QAAQ,CAACvD,WAAW,CAAG,CAAC,CAAE,CAAC1K,QAAQ,CAAE0K,WAAW,GAAK,CAAE,CAAClQ,SAAS,CAAC,+DAA+D,CAAAG,QAAA,CAAC,UAAQ,CAAQ,CAAC,cAC1K7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMqT,QAAQ,CAACvD,WAAW,CAAG,CAAC,CAAE,CAAC1K,QAAQ,CAAE0K,WAAW,GAAKoD,UAAU,EAAIA,UAAU,GAAK,CAAE,CAACtT,SAAS,CAAC,0DAA0D,CAAAG,QAAA,CAAC,WAAS,CAAQ,CAAC,EAClM,CAAC,EACL,CAAC,CACLyP,YAAY,EAAIE,SAAS,GAAK,QAAQ,eAAIxR,IAAA,CAAC0T,kBAAkB,EAACzP,OAAO,CAAEqN,YAAa,CAACjQ,OAAO,CAAEA,CAAA,GAAMkQ,eAAe,CAAC,IAAI,CAAE,CAAC0B,WAAW,CAAEvI,eAAgB,CAAE,CAAC,CAC3J4G,YAAY,EAAIE,SAAS,GAAK,QAAQ,eAAIxR,IAAA,CAAC+S,kBAAkB,EAAC9O,OAAO,CAAEqN,YAAa,CAACjQ,OAAO,CAAEA,CAAA,GAAMkQ,eAAe,CAAC,IAAI,CAAE,CAAC0B,WAAW,CAAEvI,eAAgB,CAAE,CAAC,CAC3J4G,YAAY,EAAIE,SAAS,GAAK,KAAK,eAAIxR,IAAA,CAAC+D,eAAe,EAACE,OAAO,CAAEqN,YAAa,CAACnO,IAAI,CAAEA,IAAK,CAACC,QAAQ,CAAEA,QAAS,CAAC/B,OAAO,CAAEA,CAAA,GAAMkQ,eAAe,CAAC,IAAI,CAAE,CAAE,CAAC,CACvJa,gBAAgB,eACbpS,IAAA,CAAC+B,iBAAiB,EACdE,KAAK,CAAEmQ,gBAAgB,CAACnQ,KAAM,CAC9Bd,OAAO,CAAEiR,gBAAgB,CAACjR,OAAQ,CAClCe,SAAS,CAAEkQ,gBAAgB,CAAClQ,SAAU,CACtCC,QAAQ,CAAEA,CAAA,GAAMkQ,mBAAmB,CAAC,IAAI,CAAE,CAC1CjQ,WAAW,CAAEgQ,gBAAgB,CAAChQ,WAAY,CAC1CE,YAAY,CAAE8P,gBAAgB,CAAC9P,YAAa,CAC/C,CACJ,EACH,CAAC,CAEX,CAAC,CAED;AACA,KAAM,CAAAsI,mBAAmB,CAAGmM,MAAA,EAAmC,IAAlC,CAAEjN,QAAQ,CAAEY,eAAgB,CAAC,CAAAqM,MAAA,CACtD,KAAM,CAAC3E,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGhV,QAAQ,CAAC,IAAI,CAAC,CAE9D;AACA,KAAM,CAAA2Z,aAAa,CAAG,KAAAA,CAAA,GAAY,CAC9B,GAAI,CAAC5E,gBAAgB,EAAIA,gBAAgB,CAAC6E,MAAM,GAAK,SAAS,CAAE,OAEhE,KAAM,CAAEhT,OAAQ,CAAC,CAAGmO,gBAAgB,CAAC8E,OAAO,CAAE;AAC9C,KAAM,CAAA1C,UAAU,CAAGrW,GAAG,CAAC4C,EAAE,CAAE,WAAW,CAAEkD,OAAO,CAACa,EAAE,CAAC,CACnD,KAAM,CAAAqS,eAAe,CAAG,CAAC,CAAClT,OAAO,CAACyH,aAAa,CAE/C,GAAI,CACA,GAAIyL,eAAe,CAAE,CACjB,GAAIlT,OAAO,CAACmT,eAAe,GAAK,YAAY,EAAInT,OAAO,CAACmT,eAAe,GAAK,kBAAkB,CAAE,CAC5F,KAAM,CAAA/Y,SAAS,CAACmW,UAAU,CAAE,CAAE3D,MAAM,CAAE,WAAW,CAAErF,aAAa,CAAE,WAAY,CAAC,CAAC,CACpF,CAAC,IAAM,CACH,KAAM,CAAAnN,SAAS,CAACmW,UAAU,CAAE,CAAE3D,MAAM,CAAE,sBAAsB,CAAErF,aAAa,CAAE,WAAY,CAAC,CAAC,CAC/F,CACJ,CAAC,IAAM,CACH,KAAM,CAAAnN,SAAS,CAACmW,UAAU,CAAE,CAAE3D,MAAM,CAAE,sBAAsB,CAAEuG,eAAe,CAAE,YAAa,CAAC,CAAC,CAClG,CACJ,CAAE,MAAO5V,KAAK,CAAE,CACZ8D,OAAO,CAAC9D,KAAK,CAAC,4BAA4B,CAAEA,KAAK,CAAC,CAClD6V,KAAK,CAAC,0CAA0C,CAAC,CACrD,CAAC,OAAS,CACNhF,mBAAmB,CAAC,IAAI,CAAC,CAAE;AAC3B3H,eAAe,CAAC,CAAC,CAAE;AACvB,CACJ,CAAC,CAED;AACA,KAAM,CAAA4M,YAAY,CAAG,KAAO,CAAA7U,MAAM,EAAK,CACnC,GAAI,CAAC2P,gBAAgB,EAAIA,gBAAgB,CAAC6E,MAAM,GAAK,QAAQ,CAAE,OAE/D,GAAI,CAACxU,MAAM,EAAIA,MAAM,CAACiL,IAAI,CAAC,CAAC,GAAK,EAAE,CAAE,CACjC2J,KAAK,CAAC,6CAA6C,CAAC,CACpD,OAAQ;AACZ,CAEA,KAAM,CAAE5W,SAAU,CAAC,CAAG2R,gBAAgB,CAAC8E,OAAO,CAAE;AAChD,KAAM,CAAA1C,UAAU,CAAGrW,GAAG,CAAC4C,EAAE,CAAE,WAAW,CAAEN,SAAS,CAAC,CAElD,GAAI,CACA,KAAM,CAAApC,SAAS,CAACmW,UAAU,CAAE,CAAE3D,MAAM,CAAE,wBAAwB,CAAE0G,aAAa,CAAE9U,MAAO,CAAC,CAAC,CAC5F,CAAE,MAAOjB,KAAK,CAAE,CACZ8D,OAAO,CAAC9D,KAAK,CAAC,6BAA6B,CAAEA,KAAK,CAAC,CACnD6V,KAAK,CAAC,2CAA2C,CAAC,CACtD,CAAC,OAAS,CACNhF,mBAAmB,CAAC,IAAI,CAAC,CAAE;AAC3B3H,eAAe,CAAC,CAAC,CAAE;AACvB,CACJ,CAAC,CAED;AACA,KAAM,CAAA8M,aAAa,CAAIvT,OAAO,EAAK,CAC/B,KAAM,CAAAkT,eAAe,CAAG,CAAC,CAAClT,OAAO,CAACyH,aAAa,CAC/C,KAAM,CAAA+L,aAAa,CAAGxT,OAAO,CAACmT,eAAe,GAAK,YAAY,EAAInT,OAAO,CAACmT,eAAe,GAAK,kBAAkB,CAEhH,KAAM,CAAAM,mBAAmB,CAAGP,eAAe,CACpCM,aAAa,CAAG,6EAA6E,CAAG,sDAAsD,CACvJ,2DAA2D,CAEjEpF,mBAAmB,CAAC,CAChB4E,MAAM,CAAE,SAAS,CACjBC,OAAO,CAAE,CAAEjT,OAAQ,CAAC,CAAE;AACtBhC,KAAK,CAAE,sBAAsB,CAC7Bd,OAAO,CAAEuW,mBACb,CAAC,CAAC,CACN,CAAC,CAED;AACA,KAAM,CAAAC,YAAY,CAAIlX,SAAS,EAAK,CAChC4R,mBAAmB,CAAC,CAChB4E,MAAM,CAAE,QAAQ,CAChBC,OAAO,CAAE,CAAEzW,SAAU,CAAC,CAAE;AACxBwB,KAAK,CAAE,mBAAmB,CAC1Bd,OAAO,CAAE,2EAA2E,CACpFiB,WAAW,CAAE,UAAU,CACvBE,YAAY,CAAE,eAClB,CAAC,CAAC,CACN,CAAC,CAED,mBACIpC,KAAA,CAAAE,SAAA,EAAAyB,QAAA,eACI7B,IAAA,QAAK0B,SAAS,CAAC,4CAA4C,CAAAG,QAAA,cACvD3B,KAAA,UAAOwB,SAAS,CAAC,qCAAqC,CAAAG,QAAA,eAClD7B,IAAA,UAAO0B,SAAS,CAAC,YAAY,CAAAG,QAAA,cACzB3B,KAAA,OAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,KAAG,CAAI,CAAC,cACxF7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,UAAQ,CAAI,CAAC,cAC7F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,oBAAkB,CAAI,CAAC,cACvG7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,UAAQ,CAAI,CAAC,EAC7F,CAAC,CACF,CAAC,cACR7B,IAAA,UAAO0B,SAAS,CAAC,mCAAmC,CAAAG,QAAA,CAC/CiI,QAAQ,CAAC5E,GAAG,CAACjB,OAAO,eAChB/D,KAAA,OAAA2B,QAAA,eACG7B,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAAC4C,GAAG,CAAK,CAAC,cACtE7G,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAAC4H,cAAc,CAAK,CAAC,cACjF7L,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,cAC/C3B,KAAA,QAAKwB,SAAS,CAAC,yBAAyB,CAAAG,QAAA,EACnCoC,OAAO,CAAC2T,UAAU,eAAI5X,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAAC2T,UAAW,CAAC9U,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAC,wBAAsB,CAAG,CAAC,CACjJoC,OAAO,CAAC4T,WAAW,eAAI7X,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAAC4T,WAAY,CAAC/U,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,cAAc,CAAAG,QAAA,CAAC,YAAU,CAAG,CAAC,CACtIoC,OAAO,CAAC6T,WAAW,eAAI9X,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAAC6T,WAAY,CAAChV,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,cAAc,CAAAG,QAAA,CAAC,YAAU,CAAG,CAAC,EACtI,CAAC,CACN,CAAC,cACL7B,IAAA,OAAI0B,SAAS,CAAC,iDAAiD,CAAAG,QAAA,cAC3D3B,KAAA,QAAKwB,SAAS,CAAC,gBAAgB,CAAAG,QAAA,eAE3B7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM0V,aAAa,CAACvT,OAAO,CAAE,CAACvC,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAC,SAAO,CAAQ,CAAC,cAC/G7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM6V,YAAY,CAAC1T,OAAO,CAACa,EAAE,CAAE,CAACpD,SAAS,CAAC,uCAAuC,CAAAG,QAAA,CAAC,UAAQ,CAAQ,CAAC,EACnH,CAAC,CACN,CAAC,GAhBCoC,OAAO,CAACa,EAiBd,CACP,CAAC,CACC,CAAC,EACL,CAAC,CACP,CAAC,CAGL,CAAAsN,gBAAgB,SAAhBA,gBAAgB,iBAAhBA,gBAAgB,CAAE6E,MAAM,IAAK,SAAS,eACnCjX,IAAA,CAAC+B,iBAAiB,EACdE,KAAK,CAAEmQ,gBAAgB,CAACnQ,KAAM,CAC9Bd,OAAO,CAAEiR,gBAAgB,CAACjR,OAAQ,CAClCe,SAAS,CAAE8U,aAAe;AAAA,CAC1B7U,QAAQ,CAAEA,CAAA,GAAMkQ,mBAAmB,CAAC,IAAI,CAAE,CAC7C,CACJ,CAEA,CAAAD,gBAAgB,SAAhBA,gBAAgB,iBAAhBA,gBAAgB,CAAE6E,MAAM,IAAK,QAAQ,eAClCjX,IAAA,CAACuC,qBAAqB,EAClBN,KAAK,CAAEmQ,gBAAgB,CAACnQ,KAAM,CAC9Bd,OAAO,CAAEiR,gBAAgB,CAACjR,OAAQ,CAClCe,SAAS,CAAEoV,YAAc;AAAA,CACzBnV,QAAQ,CAAEA,CAAA,GAAMkQ,mBAAmB,CAAC,IAAI,CAAE,CAC1CjQ,WAAW,CAAEgQ,gBAAgB,CAAChQ,WAAY,CAC1CE,YAAY,CAAE8P,gBAAgB,CAAC9P,YAAa,CAC/C,CACJ,EACH,CAAC,CAEX,CAAC,CAED,KAAM,CAAAyV,kBAAkB,CAAGC,MAAA,EAA+B,IAA9B,CAAElO,QAAQ,CAAEsB,WAAY,CAAC,CAAA4M,MAAA,CACjD,KAAM,CAACC,eAAe,CAAEC,kBAAkB,CAAC,CAAG7a,QAAQ,CAAC,IAAI,CAAC,CAC5D,KAAM,CAAA8a,eAAe,CAAGrO,QAAQ,CAACsO,MAAM,CAAC,CAACC,GAAG,CAAEpU,OAAO,GAAK,CACtD,KAAM,CAAAqU,GAAG,CAAGrU,OAAO,CAAC6M,WAAW,EAAI,iBAAiB,CACpD,GAAI,CAACuH,GAAG,CAACC,GAAG,CAAC,CAAED,GAAG,CAACC,GAAG,CAAC,CAAG,EAAE,CAC5BD,GAAG,CAACC,GAAG,CAAC,CAACC,IAAI,CAACtU,OAAO,CAAC,CACtB,MAAO,CAAAoU,GAAG,CACd,CAAC,CAAE,CAAC,CAAC,CAAC,CAEN,KAAM,CAAAG,eAAe,CAAIF,GAAG,EAAKJ,kBAAkB,CAACD,eAAe,GAAKK,GAAG,CAAG,IAAI,CAAGA,GAAG,CAAC,CACzF,KAAM,CAAA7R,UAAU,CAAIC,SAAS,EAAK,CAACA,SAAS,CAAG,KAAK,CAAG,GAAI,CAAAd,IAAI,CAACc,SAAS,CAACC,OAAO,CAAG,IAAI,CAAC,CAAC8O,kBAAkB,CAAC,OAAO,CAAC,CACrH,KAAM,CAAAgD,cAAc,CAAI5H,MAAM,EAAKA,MAAM,GAAK,QAAQ,CAAG,+BAA+B,CAAG,6BAA6B,CAExH,mBACI7Q,IAAA,QAAK0B,SAAS,CAAC,WAAW,CAAAG,QAAA,CACrB2R,MAAM,CAACkF,OAAO,CAACP,eAAe,CAAC,CAACjT,GAAG,CAACyT,MAAA,MAAC,CAAC7H,WAAW,CAAE8H,KAAK,CAAC,CAAAD,MAAA,oBACtDzY,KAAA,QAAuBwB,SAAS,CAAC,4CAA4C,CAAAG,QAAA,eACzE3B,KAAA,WAAQ4B,OAAO,CAAEA,CAAA,GAAM0W,eAAe,CAAC1H,WAAW,CAAE,CAACpP,SAAS,CAAC,oHAAoH,CAAAG,QAAA,eAC/K3B,KAAA,SAAA2B,QAAA,EAAOiP,WAAW,CAAC,GAAC,cAAA5Q,KAAA,SAAMwB,SAAS,CAAC,mCAAmC,CAAAG,QAAA,EAAC,GAAC,CAAC+W,KAAK,CAAC9R,MAAM,CAAC,GAAC,EAAM,CAAC,EAAM,CAAC,cACtG9G,IAAA,SAAM0B,SAAS,gDAAAC,MAAA,CAAiDsW,eAAe,GAAKnH,WAAW,CAAG,YAAY,CAAG,EAAE,CAAG,CAAAjP,QAAA,CAAC,QAAC,CAAM,CAAC,EAC3H,CAAC,CACRoW,eAAe,GAAKnH,WAAW,eAC5B9Q,IAAA,OAAI0B,SAAS,CAAC,mCAAmC,CAAAG,QAAA,CAC5C+W,KAAK,CAAC1T,GAAG,CAACjB,OAAO,eACd/D,KAAA,OAAqBwB,SAAS,CAAC,+DAA+D,CAAAG,QAAA,eAC1F7B,IAAA,QAAK0B,SAAS,CAAC,qBAAqB,CAAAG,QAAA,cAAC7B,IAAA,QAAK0B,SAAS,CAAC,mCAAmC,CAAAG,QAAA,CAAEoC,OAAO,CAAC4H,cAAc,CAAM,CAAC,CAAK,CAAC,cAC5H7L,IAAA,QAAK0B,SAAS,CAAC,6BAA6B,CAAAG,QAAA,cAAC7B,IAAA,QAAK0B,SAAS,CAAC,uCAAuC,CAAAG,QAAA,CAAE4E,UAAU,CAACxC,OAAO,CAACqI,aAAa,CAAC,CAAM,CAAC,CAAK,CAAC,cACnJtM,IAAA,QAAK0B,SAAS,CAAC,6BAA6B,CAAAG,QAAA,cAAC7B,IAAA,SAAM0B,SAAS,kEAAAC,MAAA,CAAmE8W,cAAc,CAACxU,OAAO,CAACuH,aAAa,CAAC,CAAG,CAAA3J,QAAA,CAAEoC,OAAO,CAACuH,aAAa,CAAO,CAAC,CAAK,CAAC,cAC5MtL,KAAA,QAAKwB,SAAS,CAAC,4CAA4C,CAAAG,QAAA,EACtDoC,OAAO,CAAC2T,UAAU,eAAI5X,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMsJ,WAAW,CAACnH,OAAO,CAAC2T,UAAU,CAAE,CAAClW,SAAS,CAAC,uDAAuD,CAAAG,QAAA,CAAC,cAAY,CAAQ,CAAC,CACrKoC,OAAO,CAAC4T,WAAW,eAAI7X,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAAC4T,WAAY,CAACgB,QAAQ,MAACnX,SAAS,CAAC,qDAAqD,CAAAG,QAAA,CAAC,QAAM,CAAG,CAAC,CACxIoC,OAAO,CAAC6T,WAAW,eAAI9X,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAAC6T,WAAY,CAACe,QAAQ,MAACnX,SAAS,CAAC,qDAAqD,CAAAG,QAAA,CAAC,QAAM,CAAG,CAAC,EACxI,CAAC,GARDoC,OAAO,CAACa,EASb,CACP,CAAC,CACF,CACP,GApBKgM,WAqBL,CAAC,EACT,CAAC,CACD,CAAC,CAEd,CAAC,CAED,KAAM,CAAAgI,eAAe,CAAGC,MAAA,EAAwB,IAAvB,CAAE5V,IAAI,CAAEC,QAAS,CAAC,CAAA2V,MAAA,CACvC,KAAM,CAACjP,QAAQ,CAAEC,WAAW,CAAC,CAAG1M,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAAC2b,UAAU,CAAEC,aAAa,CAAC,CAAG5b,QAAQ,CAAC,OAAO,CAAC,CACrD,KAAM,CAAC6b,QAAQ,CAAEC,WAAW,CAAC,CAAG9b,QAAQ,CAAC,IAAI,CAAC,CAE9CC,SAAS,CAAC,IAAM,CACZ,GAAI,CAAC6F,IAAI,CAAE,CAAEsB,UAAU,CAAC,KAAK,CAAC,CAAE,OAAQ,CAExC,KAAM,CAAAI,CAAC,CAAG7G,KAAK,CACXF,UAAU,CAACiD,EAAE,CAAE,WAAW,CAAC,CAC3B9C,KAAK,CAAC,WAAW,CAAE,IAAI,CAAEkF,IAAI,CAAC8C,GAAG,CAAC,CAClChI,KAAK,CAAC,eAAe,CAAE,IAAI,CAAE,CAAC,QAAQ,CAAE,WAAW,CAAC,CACxD,CAAC,CAED,KAAM,CAAA8G,WAAW,CAAGzG,UAAU,CAACuG,CAAC,CAAGG,aAAa,EAAK,CACjD,KAAM,CAAAoU,YAAY,CAAGpU,aAAa,CAACC,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CACnF;AACAgU,YAAY,CAAC/K,IAAI,CAAC,CAACH,CAAC,CAAEC,CAAC,GAAKA,CAAC,CAAC7B,aAAa,CAAC3F,OAAO,CAAGuH,CAAC,CAAC5B,aAAa,CAAC3F,OAAO,CAAC,CAC9EoD,WAAW,CAACqP,YAAY,CAAC,CACzB3U,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAGjD,KAAK,EAAK,CACV8D,OAAO,CAAC9D,KAAK,CAAC,kCAAkC,CAAEA,KAAK,CAAC,CACxD,GAAIA,KAAK,CAAC6X,IAAI,GAAK,qBAAqB,CAAE,CACrC/T,OAAO,CAAC9D,KAAK,CAAC,uJAAuJ,CAAC,CAC3K,CACAiD,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAC,CAEF,MAAO,IAAMM,WAAW,CAAC,CAAC,CAC9B,CAAC,CAAE,CAAC5B,IAAI,CAAC,CAAC,CAEV,mBACIjD,KAAA,CAAAE,SAAA,EAAAyB,QAAA,eACI3B,KAAA,OAAIwB,SAAS,CAAC,uCAAuC,CAAAG,QAAA,EAAC,eAAa,CAACuB,QAAQ,CAACQ,cAAc,EAAK,CAAC,cACjG5D,IAAA,QAAK0B,SAAS,CAAC,+BAA+B,CAAAG,QAAA,cAC1C3B,KAAA,QAAKwB,SAAS,CAAC,uBAAuB,CAAC,aAAW,MAAM,CAAAG,QAAA,eACpD7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMmX,aAAa,CAAC,OAAO,CAAE,CAACvX,SAAS,+DAAAC,MAAA,CAAgEqX,UAAU,GAAK,OAAO,CAAG,+BAA+B,CAAG,4EAA4E,CAAG,CAAAnX,QAAA,CAAC,4BAEnQ,CAAQ,CAAC,cACT7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMmX,aAAa,CAAC,MAAM,CAAE,CAACvX,SAAS,+DAAAC,MAAA,CAAgEqX,UAAU,GAAK,MAAM,CAAG,+BAA+B,CAAG,4EAA4E,CAAG,CAAAnX,QAAA,CAAC,iBAEjQ,CAAQ,CAAC,EACR,CAAC,CACL,CAAC,CAEL2C,OAAO,cACJxE,IAAA,MAAA6B,QAAA,CAAG,uBAAqB,CAAG,CAAC,CAC5BiI,QAAQ,CAAChD,MAAM,GAAK,CAAC,cACrB9G,IAAA,MAAG0B,SAAS,CAAC,gCAAgC,CAAAG,QAAA,CAAC,gCAA8B,CAAG,CAAC,CAChFmX,UAAU,GAAK,OAAO,cACtBhZ,IAAA,CAACkL,aAAa,EAACpB,QAAQ,CAAEA,QAAS,CAACsB,WAAW,CAAE+N,WAAY,CAAE,CAAC,cAE/DnZ,IAAA,CAAC+X,kBAAkB,EAACjO,QAAQ,CAAEA,QAAS,CAACsB,WAAW,CAAE+N,WAAY,CAAE,CACtE,CAEAD,QAAQ,eAAIlZ,IAAA,CAAC6K,kBAAkB,EAACE,GAAG,CAAEmO,QAAS,CAAC7X,OAAO,CAAEA,CAAA,GAAM8X,WAAW,CAAC,IAAI,CAAE,CAAE,CAAC,EACtF,CAAC,CAEX,CAAC,CAED;AACA;AACA;AACA,GACA,KAAM,CAAAG,aAAa,CAAGC,MAAA,EAAmB,IAAlB,CAAEC,SAAU,CAAC,CAAAD,MAAA,CAChC,KAAM,CAAAnU,IAAI,CAAG,CACTqU,MAAM,CAAED,SAAS,CAACC,MAAM,CACxBC,QAAQ,CAAE,CACN,CACIC,KAAK,CAAE,qBAAqB,CAC5BvU,IAAI,CAAEoU,SAAS,CAACI,cAAc,CAC9BC,eAAe,CAAE,yBAA2B;AAChD,CAAC,CACD,CACIF,KAAK,CAAE,cAAc,CACrBvU,IAAI,CAAEoU,SAAS,CAACM,UAAU,CAC1BD,eAAe,CAAE,yBAA2B;AAChD,CAAC,CACD,CACIF,KAAK,CAAE,qBAAqB,CAC5BvU,IAAI,CAAEoU,SAAS,CAACO,oBAAoB,CACpCF,eAAe,CAAE,yBAA2B;AAChD,CAAC,CACD,CACIzY,IAAI,CAAE,MAAM,CAAE;AACduY,KAAK,CAAE,sBAAsB,CAC7BvU,IAAI,CAAEoU,SAAS,CAACQ,SAAS,CACzBC,WAAW,CAAE,uBAAuB,CAAE;AACtCJ,eAAe,CAAE,yBAAyB,CAC1CK,IAAI,CAAE,IAAI,CACVC,OAAO,CAAE,GAAG,CACZC,OAAO,CAAE,IACb,CAAC,CAET,CAAC,CAED,KAAM,CAAAC,OAAO,CAAG,CACZC,UAAU,CAAE,IAAI,CAChBC,mBAAmB,CAAE,KAAK,CAC1BC,OAAO,CAAE,CACLvY,KAAK,CAAE,CACHwY,OAAO,CAAE,KACb,CAAC,CACDC,OAAO,CAAE,CACLC,IAAI,CAAE,OAAO,CACbC,SAAS,CAAE,KACf,CAAC,CACDC,MAAM,CAAE,CACJC,QAAQ,CAAE,QACd,CACJ,CAAC,CACDC,MAAM,CAAE,CACJC,CAAC,CAAE,CACCC,OAAO,CAAE,IACb,CAAC,CACDC,CAAC,CAAE,CACCD,OAAO,CAAE,IAAI,CACbE,WAAW,CAAE,IACjB,CAAC,CACDC,EAAE,CAAE,CACAN,QAAQ,CAAE,OAAO,CACjBO,IAAI,CAAE,CACFC,eAAe,CAAE,KACrB,CAAC,CACDH,WAAW,CAAE,IACjB,CACJ,CACJ,CAAC,CAED,mBAAOnb,IAAA,CAACd,GAAG,EAACmb,OAAO,CAAEA,OAAQ,CAACjV,IAAI,CAAEA,IAAK,CAAE,CAAC,CAChD,CAAC,CAED;AACA;AACA,GACA,KAAM,CAAAmW,uBAAuB,CAAGC,MAAA,EAAmB,IAAlB,CAAEhC,SAAU,CAAC,CAAAgC,MAAA,CAC1C,KAAM,CAAApW,IAAI,CAAG,CACTqU,MAAM,CAAED,SAAS,CAACC,MAAM,CACxBC,QAAQ,CAAE,CACN,CACIC,KAAK,CAAE,QAAQ,CACfvU,IAAI,CAAEoU,SAAS,CAACiC,UAAU,CAC1B5B,eAAe,CAAE,yBAA2B;AAChD,CAAC,CACD,CACIF,KAAK,CAAE,mBAAmB,CAC1BvU,IAAI,CAAEoU,SAAS,CAACkC,cAAc,CAC9B7B,eAAe,CAAE,yBAA2B;AAChD,CAAC,CACD,CACIF,KAAK,CAAE,WAAW,CAClBvU,IAAI,CAAEoU,SAAS,CAACmC,YAAY,CAC5B9B,eAAe,CAAE,yBAA2B;AAChD,CAAC,CACD,CACIF,KAAK,CAAE,SAAS,CAChBvU,IAAI,CAAEoU,SAAS,CAACoC,WAAW,CAC3B/B,eAAe,CAAE,yBAA2B;AAChD,CAAC,CACD,CACIF,KAAK,CAAE,uBAAuB,CAC9BvU,IAAI,CAAEoU,SAAS,CAACqC,oBAAoB,CACpChC,eAAe,CAAE,0BAA4B;AACjD,CAAC,CACD,CACIzY,IAAI,CAAE,MAAM,CACZuY,KAAK,CAAE,iBAAiB,CACxBvU,IAAI,CAAEoU,SAAS,CAACsC,kBAAkB,CAClC7B,WAAW,CAAE,SAAS,CACtBE,OAAO,CAAE,GAAG,CACZC,OAAO,CAAE,IACb,CAAC,CAET,CAAC,CAED,KAAM,CAAAC,OAAO,CAAG,CACZC,UAAU,CAAE,IAAI,CAChBC,mBAAmB,CAAE,KAAK,CAC1BC,OAAO,CAAE,CACLvY,KAAK,CAAE,CAAEwY,OAAO,CAAE,KAAM,CAAC,CACzBC,OAAO,CAAE,CAAEC,IAAI,CAAE,OAAO,CAAEC,SAAS,CAAE,KAAM,CAAC,CAC5CC,MAAM,CAAE,CAAEC,QAAQ,CAAE,QAAS,CACjC,CAAC,CACDC,MAAM,CAAE,CACJC,CAAC,CAAE,CAAEC,OAAO,CAAE,IAAK,CAAC,CACpBC,CAAC,CAAE,CAAED,OAAO,CAAE,IAAI,CAAEE,WAAW,CAAE,IAAK,CAAC,CACvCC,EAAE,CAAE,CACAN,QAAQ,CAAE,OAAO,CACjBO,IAAI,CAAE,CAAEC,eAAe,CAAE,KAAM,CAAC,CAChCH,WAAW,CAAE,IACjB,CACJ,CACJ,CAAC,CAED,mBAAOnb,IAAA,CAACd,GAAG,EAACmb,OAAO,CAAEA,OAAQ,CAACjV,IAAI,CAAEA,IAAK,CAAE,CAAC,CAChD,CAAC,CAED;AACA;AACA,GACA,KAAM,CAAA2W,aAAa,CAAGC,MAAA,EAAmB,IAAlB,CAAExC,SAAU,CAAC,CAAAwC,MAAA,CAChC,KAAM,CAAA5W,IAAI,CAAG,CACTqU,MAAM,CAAED,SAAS,CAACC,MAAM,CACxBC,QAAQ,CAAE,CACN,CACIC,KAAK,CAAE,sBAAsB,CAC7BvU,IAAI,CAAEoU,SAAS,CAACyC,YAAY,CAC5BhC,WAAW,CAAE,mBAAmB,CAChCJ,eAAe,CAAE,yBAAyB,CAC1CzY,IAAI,CAAE,KAAO;AACjB,CAAC,CACD,CACIuY,KAAK,CAAE,qBAAqB,CAC5BvU,IAAI,CAAEoU,SAAS,CAAC0C,WAAW,CAC3BjC,WAAW,CAAE,mBAAmB,CAChCJ,eAAe,CAAE,yBAAyB,CAC1CzY,IAAI,CAAE,KAAO;AACjB,CAAC,CAET,CAAC,CAED,KAAM,CAAAiZ,OAAO,CAAG,CACZC,UAAU,CAAE,IAAI,CAChBC,mBAAmB,CAAE,KAAK,CAC1BC,OAAO,CAAE,CACLvY,KAAK,CAAE,CAAEwY,OAAO,CAAE,KAAM,CAAC,CACzBI,MAAM,CAAE,CAAEC,QAAQ,CAAE,QAAS,CACjC,CAAC,CACDC,MAAM,CAAE,CACJG,CAAC,CAAE,CAAEC,WAAW,CAAE,IAAK,CAC3B,CACJ,CAAC,CAED,mBAAOnb,IAAA,CAACd,GAAG,EAACmb,OAAO,CAAEA,OAAQ,CAACjV,IAAI,CAAEA,IAAK,CAAE,CAAC,CAChD,CAAC,CAED;AACA,KAAM,CAAA+W,2BAA2B,CAAGC,MAAA,EAAmB,IAAlB,CAAE5C,SAAU,CAAC,CAAA4C,MAAA,CAC9C,KAAM,CAAAhX,IAAI,CAAG,CACTqU,MAAM,CAAED,SAAS,CAACC,MAAM,CAAE;AAC1BC,QAAQ,CAAE,CACN,CACIC,KAAK,CAAE,mCAAmC,CAC1CvU,IAAI,CAAEoU,SAAS,CAAC6C,aAAa,CAAE;AAC/BxC,eAAe,CAAE,0BAA0B,CAAE;AAC7CI,WAAW,CAAE,wBAAwB,CACrCqC,WAAW,CAAE,CACjB,CAAC,CAET,CAAC,CAED,KAAM,CAAAjC,OAAO,CAAG,CACZkC,SAAS,CAAE,GAAG,CAAE;AAChBjC,UAAU,CAAE,IAAI,CAChBC,mBAAmB,CAAE,KAAK,CAC1BC,OAAO,CAAE,CACLK,MAAM,CAAE,CACJJ,OAAO,CAAE,KAAO;AACpB,CAAC,CACDxY,KAAK,CAAE,CACHwY,OAAO,CAAE,KACb,CACJ,CAAC,CACDM,MAAM,CAAE,CACJC,CAAC,CAAE,CACCG,WAAW,CAAE,IAAI,CACjBqB,KAAK,CAAE,CACH;AACAC,QAAQ,CAAE,CACd,CACJ,CACJ,CACJ,CAAC,CAED,mBAAOzc,IAAA,CAACd,GAAG,EAACmb,OAAO,CAAEA,OAAQ,CAACjV,IAAI,CAAEA,IAAK,CAAE,CAAC,CAChD,CAAC,CAED;AACA,KAAM,CAAAsX,SAAS,CAAGC,MAAA,EAA+C,IAA9C,CAAE1a,KAAK,CAAEU,KAAK,CAAEia,IAAI,CAAG,EAAE,CAAEC,KAAK,CAAG,IAAK,CAAC,CAAAF,MAAA,CACxD,mBACIzc,KAAA,QAAKwB,SAAS,CAAC,mCAAmC,CAAAG,QAAA,eAC9C7B,IAAA,OAAI0B,SAAS,CAAC,kCAAkC,CAAAG,QAAA,CAAEI,KAAK,CAAK,CAAC,cAC7D/B,KAAA,MAAGwB,SAAS,CAAC,yBAAyB,CAAAG,QAAA,EACjCc,KAAK,cACN3C,IAAA,SAAM0B,SAAS,CAAC,4BAA4B,CAAAG,QAAA,CAAE+a,IAAI,CAAO,CAAC,EAC3D,CAAC,EAEH,CAAC,CAEd,CAAC,CAED;AACA,KAAM,CAAAE,kBAAkB,CAAGA,CAAA,GAAM,CAC7B,KAAM,CAACtY,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACmE,KAAK,CAAEoD,QAAQ,CAAC,CAAGvH,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAAC0f,aAAa,CAAEC,gBAAgB,CAAC,CAAG3f,QAAQ,CAAC,IAAI,CAAC,CAExD;AACJ;AACA;AACA;AACA;AACA,OACA;AAEI,KAAM,CAAA4f,uBAAuB,CAAGA,CAACnT,QAAQ,CAAEoT,QAAQ,CAAEtJ,WAAW,GAAK,CACjE,KAAM,CAAAuJ,WAAW,CAAG,GAAI,CAAAvX,IAAI,CAAC,CAAC,CAACwJ,WAAW,CAAC,CAAC,CAC5C,KAAM,CAAAgO,YAAY,CAAG,GAAI,CAAAxX,IAAI,CAAC,CAAC,CAACyX,QAAQ,CAAC,CAAC,CAC1C,KAAM,CAAA5D,MAAM,CAAG,CAAC,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAE,KAAK,CAAC,CACnG,KAAM,CAAA1D,KAAK,CAAG,GAAI,CAAAnQ,IAAI,CAAC,CAAC,CACxBmQ,KAAK,CAACC,QAAQ,CAAC,CAAC,CAAE,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC,CAC1B,KAAM,CAAAsH,MAAM,CAAG,IAAI,CAAG,EAAE,CAAG,EAAE,CAAG,EAAE,CAElC;AACA,KAAM,CAAAC,mBAAmB,CAAGC,KAAK,CAAC,EAAE,CAAC,CAACtD,IAAI,CAAC,CAAC,CAAC,CAAChV,GAAG,CAAC,KAAO,CAAEuY,UAAU,CAAE,CAAC,CAAEC,MAAM,CAAE,CAAC,CAAEC,gBAAgB,CAAE,CAAC,CAAEC,KAAK,CAAE,CAAE,CAAC,CAAC,CAAC,CACtH9T,QAAQ,CAAC4I,OAAO,CAACnH,CAAC,EAAI,KAAAsS,gBAAA,CAClB,GAAI,CAAAA,gBAAA,CAAAtS,CAAC,CAACe,aAAa,UAAAuR,gBAAA,WAAfA,gBAAA,CAAiB1J,MAAM,EAAI5I,CAAC,CAACe,aAAa,CAAC6H,MAAM,CAAC,CAAC,CAAC/E,WAAW,CAAC,CAAC,GAAK+N,WAAW,CAAE,CACnF,KAAM,CAAAxH,KAAK,CAAGpK,CAAC,CAACe,aAAa,CAAC6H,MAAM,CAAC,CAAC,CAACkJ,QAAQ,CAAC,CAAC,CACjD,KAAM,CAAAS,YAAY,CAAGvS,CAAC,CAACiB,uBAAuB,EAAI,CAAC,CACnD+Q,mBAAmB,CAAC5H,KAAK,CAAC,CAACiI,KAAK,EAAIE,YAAY,CAChD,OAAQvS,CAAC,CAACsF,MAAM,EACZ,IAAK,YAAY,CAAE0M,mBAAmB,CAAC5H,KAAK,CAAC,CAAC8H,UAAU,EAAIK,YAAY,CAAE,MAC1E,IAAK,QAAQ,CAAE,IAAK,wBAAwB,CAAE,IAAK,mBAAmB,CAAEP,mBAAmB,CAAC5H,KAAK,CAAC,CAAC+H,MAAM,EAAII,YAAY,CAAE,MAC3H,IAAK,sBAAsB,CAAEP,mBAAmB,CAAC5H,KAAK,CAAC,CAACgI,gBAAgB,EAAIG,YAAY,CAAE,MAC1F,QAAS,MACb,CACJ,CACJ,CAAC,CAAC,CAEF,KAAM,CAAAC,aAAa,CAAGP,KAAK,CAAC,EAAE,CAAC,CAACtD,IAAI,CAAC,CAAC,CAAC,CAAChV,GAAG,CAAC,KAAO,CAAE8Y,cAAc,CAAE,CAAC,CAAEC,gBAAgB,CAAE,CAAC,CAAEC,UAAU,CAAE,CAAC,CAAEC,QAAQ,CAAE,CAAC,CAAEC,OAAO,CAAE,CAAC,CAAEC,MAAM,CAAE,CAAE,CAAC,CAAC,CAAC,CAClJnB,QAAQ,CAACxK,OAAO,CAAC4L,GAAG,EAAI,KAAAC,iBAAA,CACpB,GAAID,GAAG,CAACE,IAAI,GAAK,SAAS,GAAAD,iBAAA,CAAID,GAAG,CAACG,YAAY,UAAAF,iBAAA,WAAhBA,iBAAA,CAAkBpK,MAAM,EAAImK,GAAG,CAACG,YAAY,CAACtK,MAAM,CAAC,CAAC,CAAC/E,WAAW,CAAC,CAAC,GAAK+N,WAAW,CAAE,CAC/G,KAAM,CAAAxH,KAAK,CAAG2I,GAAG,CAACG,YAAY,CAACtK,MAAM,CAAC,CAAC,CAACkJ,QAAQ,CAAC,CAAC,CAClD,KAAM,CAAAqB,YAAY,CAAGJ,GAAG,CAACK,KAAK,EAAI,CAAC,CACnCZ,aAAa,CAACpI,KAAK,CAAC,CAACqI,cAAc,EAAIU,YAAY,CACnD,GAAIJ,GAAG,CAACzN,MAAM,GAAK,QAAQ,CAAE,CAAEkN,aAAa,CAACpI,KAAK,CAAC,CAAC0I,MAAM,EAAIK,YAAY,CAAE,CAAC,IACxE,IAAIJ,GAAG,CAACzN,MAAM,GAAK,WAAW,CAAE,KAAA+N,qBAAA,CACjC,IAAAA,qBAAA,CAAIN,GAAG,CAACO,gBAAgB,UAAAD,qBAAA,WAApBA,qBAAA,CAAsBzK,MAAM,CAAE,CAC9B,KAAM,CAAA2K,WAAW,CAAGR,GAAG,CAACO,gBAAgB,CAAC1K,MAAM,CAAC,CAAC,CACjD2K,WAAW,CAAC9I,QAAQ,CAAC,CAAC,CAAE,CAAC,CAAE,CAAC,CAAE,CAAC,CAAC,CAChC,GAAI8I,WAAW,CAAG/I,KAAK,CAAE,CAAEgI,aAAa,CAACpI,KAAK,CAAC,CAACyI,OAAO,EAAIM,YAAY,CAAE,CAAC,IACrE,IAAII,WAAW,CAAC3W,OAAO,CAAC,CAAC,GAAK4N,KAAK,CAAC5N,OAAO,CAAC,CAAC,CAAE,CAAE4V,aAAa,CAACpI,KAAK,CAAC,CAACwI,QAAQ,EAAIO,YAAY,CAAE,CAAC,IACjG,CAAEX,aAAa,CAACpI,KAAK,CAAC,CAACuI,UAAU,EAAIQ,YAAY,CAAE,CAC5D,CAAC,IAAM,CAAEX,aAAa,CAACpI,KAAK,CAAC,CAACsI,gBAAgB,EAAIS,YAAY,CAAE,CACpE,CACJ,CACJ,CAAC,CAAC,CAEF,KAAM,CAAAK,kBAAkB,CAAGvB,KAAK,CAAC,CAAC,CAAC,CAACtD,IAAI,CAAC,CAAC,CAAC,CAAChV,GAAG,CAAC,KAAO,CAAE8Z,QAAQ,CAAE,CAAC,CAAEC,OAAO,CAAE,CAAE,CAAC,CAAC,CAAC,CACpF,KAAM,CAAAC,YAAY,CAAG,EAAE,CACvB,KAAM,CAAAC,aAAa,CAAG,GAAI,CAAAvZ,IAAI,CAAC,CAAC,CAChC,IAAK,GAAI,CAAAwZ,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAG,CAAC,CAAEA,CAAC,EAAE,CAAE,CACxB,KAAM,CAAAC,aAAa,CAAG,GAAI,CAAAzZ,IAAI,CAACuZ,aAAa,CAAChX,OAAO,CAAC,CAAC,CAAIiX,CAAC,CAAG,CAAC,CAAG9B,MAAO,CAAC,CAC1E4B,YAAY,CAAC3G,IAAI,QAAA5W,MAAA,CAAQyd,CAAC,CAAG,CAAC,OAAAzd,MAAA,CAAK0d,aAAa,CAACC,OAAO,CAAC,CAAC,MAAA3d,MAAA,CAAI0d,aAAa,CAAChC,QAAQ,CAAC,CAAC,CAAG,CAAC,KAAG,CAAC,CAClG,CACAH,QAAQ,CAACxK,OAAO,CAAC4L,GAAG,EAAI,KAAAiB,sBAAA,CACpB,GAAIjB,GAAG,CAACzN,MAAM,GAAK,WAAW,GAAA0O,sBAAA,CAAIjB,GAAG,CAACO,gBAAgB,UAAAU,sBAAA,WAApBA,sBAAA,CAAsBpL,MAAM,CAAE,CAC5D,KAAM,CAAA2K,WAAW,CAAGR,GAAG,CAACO,gBAAgB,CAAC1K,MAAM,CAAC,CAAC,CACjD,KAAM,CAAA+B,QAAQ,CAAGjB,IAAI,CAACuK,KAAK,CAAC,CAACV,WAAW,CAAGK,aAAa,EAAI7B,MAAM,CAAC,CACnE,KAAM,CAAAmC,SAAS,CAAGxK,IAAI,CAACuK,KAAK,CAACtJ,QAAQ,CAAG,CAAC,CAAC,CAC1C,GAAIuJ,SAAS,EAAI,CAAC,EAAIA,SAAS,CAAG,CAAC,CAAE,CACjC,GAAInB,GAAG,CAACE,IAAI,GAAK,SAAS,CAAE,CAAEO,kBAAkB,CAACU,SAAS,CAAC,CAACT,QAAQ,EAAIV,GAAG,CAACK,KAAK,EAAI,CAAC,CAAE,CAAC,IACpF,IAAIL,GAAG,CAACE,IAAI,GAAK,WAAW,CAAE,CAAEO,kBAAkB,CAACU,SAAS,CAAC,CAACR,OAAO,EAAIX,GAAG,CAACK,KAAK,EAAI,CAAC,CAAE,CAClG,CACJ,CACJ,CAAC,CAAC,CAEF,KAAM,CAAAe,gBAAgB,CAAG,CAAC,CAAC,CAC3B9L,WAAW,CAAClB,OAAO,CAACiN,CAAC,EAAI,CAAED,gBAAgB,CAACC,CAAC,CAAC7a,EAAE,CAAC,CAAG,CAAEgB,IAAI,CAAE6Z,CAAC,CAAC/b,cAAc,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAE+b,SAAS,CAAE,CAAE,CAAC,CAAE,CAAC,CAAC,CAC9G9V,QAAQ,CAAC4I,OAAO,CAACnH,CAAC,EAAI,CAClB,CAACA,CAAC,CAACsU,gBAAgB,CAAEtU,CAAC,CAACuU,gBAAgB,CAAC,CAACxU,MAAM,CAACyU,OAAO,CAAC,CAACrN,OAAO,CAAChM,SAAS,EAAI,CAC1E,KAAM,CAAAsZ,cAAc,CAAGtZ,SAAS,CAACyN,MAAM,CAAC,CAAC,CACzC,GAAI6L,cAAc,CAAC3C,QAAQ,CAAC,CAAC,GAAKD,YAAY,EAAI4C,cAAc,CAAC5Q,WAAW,CAAC,CAAC,GAAK+N,WAAW,CAAE,CAC5F,CAAC5R,CAAC,CAACwF,mBAAmB,EAAI,EAAE,EAAE2B,OAAO,CAAC4B,MAAM,EAAI,CAC5C,GAAIoL,gBAAgB,CAACpL,MAAM,CAAC,CAAE,CAAEoL,gBAAgB,CAACpL,MAAM,CAAC,CAACsL,SAAS,EAAI,CAAC,CAAE,CAC7E,CAAC,CAAC,CACN,CACJ,CAAC,CAAC,CACN,CAAC,CAAC,CAEF;AACA,GAAI,CAAAK,WAAW,CAAG,CAAC,CAAEC,sBAAsB,CAAG,CAAC,CAC/C,GAAI,CAAAC,iBAAiB,CAAG,CAAC,CAAEC,iBAAiB,CAAG,CAAC,CAChD,GAAI,CAAAC,mBAAmB,CAAG,CAAC,CAAEC,iBAAiB,CAAG,CAAC,CAElDxW,QAAQ,CAAC4I,OAAO,CAACnH,CAAC,EAAI,KAAAgV,qBAAA,CAAAC,kBAAA,CAAAC,iBAAA,CAAAC,sBAAA,CAClB;AACA,GAAI,CAACnV,CAAC,CAACiB,uBAAuB,EAAI,CAAC,EAAI,CAAC,EAAI,CAACjB,CAAC,CAACkB,cAAc,EAAI,CAAC,GAAK,CAAC,CAAE,CACtEwT,WAAW,EAAI,CAAC1U,CAAC,CAACiB,uBAAuB,CAAGjB,CAAC,CAACkB,cAAc,EAAIlB,CAAC,CAACiB,uBAAuB,CACzF0T,sBAAsB,EAAE,CAC5B,CACA;AACA,GAAI,CAAAK,qBAAA,CAAAhV,CAAC,CAACmJ,sBAAsB,UAAA6L,qBAAA,WAAxBA,qBAAA,CAA0BpM,MAAM,GAAAqM,kBAAA,CAAIjV,CAAC,CAACsU,gBAAgB,UAAAW,kBAAA,WAAlBA,kBAAA,CAAoBrM,MAAM,CAAE,CAChEgM,iBAAiB,EAAI,CAAC5U,CAAC,CAACsU,gBAAgB,CAAC1L,MAAM,CAAC,CAAC,CAAG5I,CAAC,CAACmJ,sBAAsB,CAACP,MAAM,CAAC,CAAC,EAAImJ,MAAM,CAC/F8C,iBAAiB,EAAE,CACvB,CACA;AACA,GAAI,CAAAK,iBAAA,CAAAlV,CAAC,CAACe,aAAa,UAAAmU,iBAAA,WAAfA,iBAAA,CAAiBtM,MAAM,GAAAuM,sBAAA,CAAInV,CAAC,CAACmJ,sBAAsB,UAAAgM,sBAAA,WAAxBA,sBAAA,CAA0BvM,MAAM,CAAE,CAC7DkM,mBAAmB,EAAI,CAAC9U,CAAC,CAACmJ,sBAAsB,CAACP,MAAM,CAAC,CAAC,CAAG5I,CAAC,CAACe,aAAa,CAAC6H,MAAM,CAAC,CAAC,EAAImJ,MAAM,CAC9FgD,iBAAiB,EAAE,CACvB,CACJ,CAAC,CAAC,CAEF,KAAM,CAAAK,IAAI,CAAG,CACTC,SAAS,CAAEV,sBAAsB,CAAG,CAAC,CAAG,CAAED,WAAW,CAAGC,sBAAsB,CAAI,GAAG,EAAExJ,OAAO,CAAC,CAAC,CAAC,CAAG,CAAC,CACrGmK,eAAe,CAAET,iBAAiB,CAAG,CAAC,CAAG,CAACD,iBAAiB,CAAGC,iBAAiB,EAAE1J,OAAO,CAAC,CAAC,CAAC,CAAG,CAAC,CAC/FoK,iBAAiB,CAAER,iBAAiB,CAAG,CAAC,CAAG,CAACD,mBAAmB,CAAGC,iBAAiB,EAAE5J,OAAO,CAAC,CAAC,CAAC,CAAG,CAAC,CACnGqK,iBAAiB,CAAGhD,aAAa,CAACX,YAAY,CAAC,CAACY,cAAc,CAAEpX,cAAc,CAAC,OAAO,CAAE,CAAEoa,KAAK,CAAE,UAAU,CAAEC,QAAQ,CAAE,KAAM,CAAC,CAClI,CAAC,CAED,MAAO,CACHN,IAAI,CACJO,QAAQ,CAAE,CAAEzH,MAAM,CAAEG,cAAc,CAAE2D,mBAAmB,CAACrY,GAAG,CAACic,CAAC,EAAIA,CAAC,CAAC1D,UAAU,CAAC,CAAE3D,UAAU,CAAEyD,mBAAmB,CAACrY,GAAG,CAACic,CAAC,EAAIA,CAAC,CAACzD,MAAM,CAAC,CAAE3D,oBAAoB,CAAEwD,mBAAmB,CAACrY,GAAG,CAACic,CAAC,EAAIA,CAAC,CAACxD,gBAAgB,CAAC,CAAE3D,SAAS,CAAEuD,mBAAmB,CAACrY,GAAG,CAACic,CAAC,EAAIA,CAAC,CAACvD,KAAK,CAAE,CAAC,CAC9PwD,kBAAkB,CAAE,CAAE3H,MAAM,CAAEqC,kBAAkB,CAAEiC,aAAa,CAAC7Y,GAAG,CAACic,CAAC,EAAIA,CAAC,CAACnD,cAAc,CAAC,CAAEvC,UAAU,CAAEsC,aAAa,CAAC7Y,GAAG,CAACic,CAAC,EAAIA,CAAC,CAAC9C,MAAM,CAAC,CAAE3C,cAAc,CAAEqC,aAAa,CAAC7Y,GAAG,CAACic,CAAC,EAAIA,CAAC,CAACjD,UAAU,CAAC,CAAEvC,YAAY,CAAEoC,aAAa,CAAC7Y,GAAG,CAACic,CAAC,EAAIA,CAAC,CAAChD,QAAQ,CAAC,CAAEvC,WAAW,CAAEmC,aAAa,CAAC7Y,GAAG,CAACic,CAAC,EAAIA,CAAC,CAAC/C,OAAO,CAAC,CAAEvC,oBAAoB,CAAEkC,aAAa,CAAC7Y,GAAG,CAACic,CAAC,EAAIA,CAAC,CAAClD,gBAAgB,CAAE,CAAC,CACpWoD,QAAQ,CAAE,CAAE5H,MAAM,CAAEyF,YAAY,CAAEjD,YAAY,CAAE8C,kBAAkB,CAAC7Z,GAAG,CAACoc,CAAC,EAAIA,CAAC,CAACtC,QAAQ,CAAC,CAAE9C,WAAW,CAAE6C,kBAAkB,CAAC7Z,GAAG,CAACoc,CAAC,EAAIA,CAAC,CAACrC,OAAO,CAAE,CAAC,CAC9IsC,sBAAsB,CAAE,CAAE9H,MAAM,CAAEjG,MAAM,CAACgO,MAAM,CAAC9B,gBAAgB,CAAC,CAACxa,GAAG,CAACya,CAAC,EAAIA,CAAC,CAAC7Z,IAAI,CAAC,CAAEuW,aAAa,CAAE7I,MAAM,CAACgO,MAAM,CAAC9B,gBAAgB,CAAC,CAACxa,GAAG,CAACya,CAAC,EAAIA,CAAC,CAACC,SAAS,CAAE,CAC7J,CAAC,CACL,CAAC,CAEDtiB,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAqQ,SAAS,CAAG,KAAAA,CAAA,GAAY,CAC1B,GAAI,CACA;AACA,KAAM,CAAA8T,aAAa,CAAGzjB,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,WAAW,CAAC,CAAC,CACxD,KAAM,CAAA2gB,aAAa,CAAG1jB,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,UAAU,CAAC,CAAC,CACvD,KAAM,CAAA4gB,gBAAgB,CAAG3jB,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,UAAU,CAAC,CAAE9C,KAAK,CAAC,KAAK,CAAE,IAAI,CAAE,SAAS,CAAC,CAAC,CAEzF,KAAM,CAAC2jB,gBAAgB,CAAEC,gBAAgB,CAAEC,mBAAmB,CAAC,CAAG,KAAM,CAAA/T,OAAO,CAACC,GAAG,CAAC,CAChF9P,OAAO,CAACujB,aAAa,CAAC,CACtBvjB,OAAO,CAACwjB,aAAa,CAAC,CACtBxjB,OAAO,CAACyjB,gBAAgB,CAAE;AAAA,CAC7B,CAAC,CAEF,KAAM,CAAAI,WAAW,CAAGH,gBAAgB,CAAC3c,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CACrF,KAAM,CAAA4c,WAAW,CAAGH,gBAAgB,CAAC5c,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CACrF,KAAM,CAAA6c,cAAc,CAAGH,mBAAmB,CAAC7c,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CAE3F;AACA,KAAM,CAAA8c,aAAa,CAAGjF,uBAAuB,CAAC8E,WAAW,CAAEC,WAAW,CAAEC,cAAc,CAAC,CACvFjF,gBAAgB,CAACkF,aAAa,CAAC,CAEnC,CAAE,MAAO7c,GAAG,CAAE,CACVC,OAAO,CAAC9D,KAAK,CAAC,qDAAqD,CAAE6D,GAAG,CAAC,CACzET,QAAQ,CAAC,qCAAqC,CAAC,CACnD,CAAC,OAAS,CACNH,UAAU,CAAC,KAAK,CAAC,CACrB,CACJ,CAAC,CAEDkJ,SAAS,CAAC,CAAC,CACf,CAAC,CAAE,EAAE,CAAC,CAEN,GAAInJ,OAAO,CAAE,CACT,mBAAOxE,IAAA,QAAK0B,SAAS,CAAC,mBAAmB,CAAAG,QAAA,CAAC,wCAAyB,CAAK,CAAC,CAC7E,CAEA,GAAIL,KAAK,CAAE,CACP,mBAAOxB,IAAA,QAAK0B,SAAS,CAAC,gCAAgC,CAAAG,QAAA,CAAEL,KAAK,CAAM,CAAC,CACxE,CAEJ;AAEI,mBACItB,KAAA,QAAKwB,SAAS,CAAC,WAAW,CAAAG,QAAA,eACtB3B,KAAA,QAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,kCAAkC,CAAAG,QAAA,CAAC,qBAAmB,CAAI,CAAC,cACzE7B,IAAA,MAAG0B,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAC,sDAAoD,CAAG,CAAC,EACpF,CAAC,CAGL,CAAAkb,aAAa,SAAbA,aAAa,iBAAbA,aAAa,CAAE4D,IAAI,gBAChBzgB,KAAA,QAAKwB,SAAS,CAAC,sDAAsD,CAAAG,QAAA,eACjE7B,IAAA,CAAC0c,SAAS,EAACza,KAAK,CAAC,iBAAiB,CAACU,KAAK,CAAEoa,aAAa,CAAC4D,IAAI,CAACC,SAAU,CAAChE,IAAI,CAAC,GAAG,CAAE,CAAC,cACnF5c,IAAA,CAAC0c,SAAS,EAACza,KAAK,CAAC,sBAAsB,CAACU,KAAK,CAAEoa,aAAa,CAAC4D,IAAI,CAACE,eAAgB,CAACjE,IAAI,CAAC,SAAM,CAAE,CAAC,cACjG5c,IAAA,CAAC0c,SAAS,EAACza,KAAK,CAAC,4BAAyB,CAACU,KAAK,CAAEoa,aAAa,CAAC4D,IAAI,CAACG,iBAAkB,CAAClE,IAAI,CAAC,SAAM,CAAE,CAAC,cACtG5c,IAAA,CAAC0c,SAAS,EAACza,KAAK,CAAC,wBAAwB,CAACU,KAAK,CAAEoa,aAAa,CAAC4D,IAAI,CAACI,iBAAkB,CAAE,CAAC,EACxF,CACR,cAGD7gB,KAAA,QAAKwB,SAAS,CAAC,uCAAuC,CAAAG,QAAA,eAClD3B,KAAA,QAAKwB,SAAS,CAAC,mCAAmC,CAAAG,QAAA,eAC9C7B,IAAA,OAAI0B,SAAS,CAAC,wBAAwB,CAAAG,QAAA,CAAC,iCAA+B,CAAI,CAAC,cAC3E7B,IAAA,QAAK0B,SAAS,CAAC,MAAM,CAAAG,QAAA,CAChB,CAAAkb,aAAa,SAAbA,aAAa,iBAAbA,aAAa,CAAEmE,QAAQ,gBAAIlhB,IAAA,CAACsZ,aAAa,EAACE,SAAS,CAAEuD,aAAa,CAACmE,QAAS,CAAE,CAAC,CAC/E,CAAC,EACL,CAAC,cACNhhB,KAAA,QAAKwB,SAAS,CAAC,mCAAmC,CAAAG,QAAA,eAC9C7B,IAAA,OAAI0B,SAAS,CAAC,wBAAwB,CAAAG,QAAA,CAAC,uCAAqC,CAAI,CAAC,cACjF7B,IAAA,QAAK0B,SAAS,CAAC,MAAM,CAAAG,QAAA,CAChB,CAAAkb,aAAa,SAAbA,aAAa,iBAAbA,aAAa,CAAEqE,kBAAkB,gBAAIphB,IAAA,CAACub,uBAAuB,EAAC/B,SAAS,CAAEuD,aAAa,CAACqE,kBAAmB,CAAE,CAAC,CAC7G,CAAC,EACL,CAAC,cACNlhB,KAAA,QAAKwB,SAAS,CAAC,mCAAmC,CAAAG,QAAA,eAC9C7B,IAAA,OAAI0B,SAAS,CAAC,wBAAwB,CAAAG,QAAA,CAAC,kDAA6C,CAAI,CAAC,cACzF7B,IAAA,QAAK0B,SAAS,CAAC,MAAM,CAAAG,QAAA,CAChB,CAAAkb,aAAa,SAAbA,aAAa,iBAAbA,aAAa,CAAEsE,QAAQ,gBAAIrhB,IAAA,CAAC+b,aAAa,EAACvC,SAAS,CAAEuD,aAAa,CAACsE,QAAS,CAAE,CAAC,CAC/E,CAAC,EACL,CAAC,cACNnhB,KAAA,QAAKwB,SAAS,CAAC,mCAAmC,CAAAG,QAAA,eAC9C7B,IAAA,OAAI0B,SAAS,CAAC,wBAAwB,CAAAG,QAAA,CAAC,2CAAsC,CAAI,CAAC,cAClF7B,IAAA,QAAK0B,SAAS,CAAC,MAAM,CAAAG,QAAA,CAChB,CAAAkb,aAAa,SAAbA,aAAa,iBAAbA,aAAa,CAAEwE,sBAAsB,gBAAIvhB,IAAA,CAACmc,2BAA2B,EAAC3C,SAAS,CAAEuD,aAAa,CAACwE,sBAAuB,CAAE,CAAC,CACzH,CAAC,EACL,CAAC,EACL,CAAC,EACL,CAAC,CAEd,CAAC,CAED;AACA,KAAM,CAAAY,gBAAgB,CAAGA,CAAA,GAAM,CAC3B,KAAM,CAACrY,QAAQ,CAAEC,WAAW,CAAC,CAAG1M,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,IAAI,CAAC,CAE5C,KAAM,CAAA+kB,aAAa,CAAGA,CAAA,GAAM,CACxB3d,UAAU,CAAC,IAAI,CAAC,CAChB;AACA,KAAM,CAAAI,CAAC,CAAG7G,KAAK,CACXF,UAAU,CAACiD,EAAE,CAAE,WAAW,CAAC,CAC3B9C,KAAK,CAAC,iBAAiB,CAAE,IAAI,CAAE,uCAAuC,CAAC,CACvEA,KAAK,CAAC,QAAQ,CAAE,IAAI,CAAE,WAAW,CAAE;AACvC,CAAC,CAED,KAAM,CAAA8G,WAAW,CAAGzG,UAAU,CAACuG,CAAC,CAAGG,aAAa,EAAK,CACjD,KAAM,CAAAoU,YAAY,CAAGpU,aAAa,CAACC,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CACnF2E,WAAW,CAACqP,YAAY,CAAC,CACzB3U,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAGjD,KAAK,EAAK,CACV8D,OAAO,CAAC9D,KAAK,CAAC,uCAAuC,CAAEA,KAAK,CAAC,CAC7D,GAAIA,KAAK,CAAC6X,IAAI,GAAK,qBAAqB,CAAE,CACtChC,KAAK,CAAC,qKAAqK,CAAC,CAChL,CACA5S,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAC,CAEF,MAAO,CAAAM,WAAW,CACtB,CAAC,CAEDzH,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAyH,WAAW,CAAGqd,aAAa,CAAC,CAAC,CACnC,MAAO,IAAMrd,WAAW,CAAC,CAAC,CAC9B,CAAC,CAAE,EAAE,CAAC,CAEN,mBACI7E,KAAA,QAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,uCAAuC,CAAAG,QAAA,CAAC,iCAA4B,CAAI,CAAC,CACtF2C,OAAO,cACJxE,IAAA,MAAA6B,QAAA,CAAG,kCAAgC,CAAG,CAAC,CACvCiI,QAAQ,CAAChD,MAAM,GAAK,CAAC,cACpB9G,IAAA,MAAG0B,SAAS,CAAC,gCAAgC,CAAAG,QAAA,CAAC,sCAAoC,CAAG,CAAC,cAEvF7B,IAAA,CAACqiB,oBAAoB,EAACvY,QAAQ,CAAEA,QAAS,CAACY,eAAe,CAAE0X,aAAc,CAAE,CAC9E,EACA,CAAC,CAEd,CAAC,CAED;AACA,KAAM,CAAAC,oBAAoB,CAAGC,MAAA,EAAmC,IAAlC,CAAExY,QAAQ,CAAEY,eAAgB,CAAC,CAAA4X,MAAA,CACvD,KAAM,CAAChR,YAAY,CAAEC,eAAe,CAAC,CAAGlU,QAAQ,CAAC,IAAI,CAAC,CACtD,KAAM,CAACqU,UAAU,CAAEC,aAAa,CAAC,CAAGtU,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAACuU,WAAW,CAAEC,cAAc,CAAC,CAAGxU,QAAQ,CAAC,CAAC,CAAC,CACjD,KAAM,CAACyU,YAAY,CAAEC,eAAe,CAAC,CAAG1U,QAAQ,CAAC,EAAE,CAAC,CAEpD,KAAM,CAAAklB,yBAAyB,CAAGC,MAAA,EAAuC,IAAtC,CAAEve,OAAO,CAAE5C,OAAO,CAAE4R,WAAY,CAAC,CAAAuP,MAAA,CAChE,KAAM,CAACC,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGrlB,QAAQ,CAAC4G,OAAO,CAACwS,yBAAyB,EAAI,EAAE,CAAC,CACjG,KAAM,CAACkM,UAAU,CAAEC,aAAa,CAAC,CAAGvlB,QAAQ,CAAC4G,OAAO,CAAC4e,eAAe,EAAI,EAAE,CAAC,CAC3E,KAAM,CAACC,KAAK,CAAEC,QAAQ,CAAC,CAAG1lB,QAAQ,CAAC4G,OAAO,CAAC+e,YAAY,EAAI,EAAE,CAAC,CAC9D,KAAM,CAACnM,MAAM,CAAEoM,SAAS,CAAC,CAAG5lB,QAAQ,CAAC4G,OAAO,CAACif,cAAc,EAAI,WAAW,CAAC,CAC3E,KAAM,CAACC,SAAS,CAAEC,YAAY,CAAC,CAAG/lB,QAAQ,CAAC4G,OAAO,CAACof,eAAe,EAAI,EAAE,CAAC,CACzE,KAAM,CAACC,WAAW,CAAEC,cAAc,CAAC,CAAGlmB,QAAQ,CAAC4G,OAAO,CAACuf,iBAAiB,EAAI,EAAE,CAAC,CAC/E,KAAM,CAAChf,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,KAAK,CAAC,CAE7C,KAAM,CAAA6V,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC3BzO,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAA+P,UAAU,CAAGrW,GAAG,CAAC4C,EAAE,CAAE,WAAW,CAAEkD,OAAO,CAACa,EAAE,CAAC,CACnD,KAAM,CAAAzG,SAAS,CAACmW,UAAU,CAAE,CACxBiC,yBAAyB,CAAEgM,gBAAgB,CAC3CI,eAAe,CAAE5R,MAAM,CAAC0R,UAAU,CAAC,EAAI,CAAC,CACxCK,YAAY,CAAEF,KAAK,CACnBI,cAAc,CAAErM,MAAM,CACtBwM,eAAe,CAAEF,SAAS,CAC1BK,iBAAiB,CAAEF,WACvB,CAAC,CAAC,CACF7e,UAAU,CAAC,KAAK,CAAC,CACjBwO,WAAW,CAAC,CAAC,CACb5R,OAAO,CAAC,CAAC,CACb,CAAC,CAED,mBACIrB,IAAA,QAAK0B,SAAS,CAAC,gFAAgF,CAAAG,QAAA,cAC3F3B,KAAA,QAAKwB,SAAS,CAAC,mDAAmD,CAAAG,QAAA,eAC9D3B,KAAA,OAAIwB,SAAS,CAAC,wBAAwB,CAAAG,QAAA,EAAC,iCAA+B,CAACoC,OAAO,CAAC4C,GAAG,EAAK,CAAC,cACxF3G,KAAA,QAAKwB,SAAS,CAAC,WAAW,CAAAG,QAAA,eACtB3B,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,yCAAyC,CAAAG,QAAA,CAAC,qCAAgC,CAAO,CAAC,cACnG7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAACuB,KAAK,CAAE8f,gBAAiB,CAAC7f,QAAQ,CAAEC,CAAC,EAAI6f,mBAAmB,CAAC7f,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACjB,SAAS,CAAC,+CAA+C,CAAC,CAAC,EAC1J,CAAC,cACNxB,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,yCAAyC,CAAAG,QAAA,CAAC,+BAA6B,CAAO,CAAC,cAChG7B,IAAA,UAAOoB,IAAI,CAAC,QAAQ,CAACuB,KAAK,CAAEggB,UAAW,CAAC/f,QAAQ,CAAEC,CAAC,EAAI+f,aAAa,CAAC/f,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACjB,SAAS,CAAC,+CAA+C,CAAC,CAAC,EAChJ,CAAC,cACNxB,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,yCAAyC,CAAAG,QAAA,CAAC,6BAAkB,CAAO,CAAC,cACrF7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAACuB,KAAK,CAAEwgB,SAAU,CAACvgB,QAAQ,CAAEC,CAAC,EAAIugB,YAAY,CAACvgB,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACjB,SAAS,CAAC,+CAA+C,CAAC,CAAC,EAC5I,CAAC,cACNxB,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,yCAAyC,CAAAG,QAAA,CAAC,4BAAoB,CAAO,CAAC,cACvF7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAACuB,KAAK,CAAE2gB,WAAY,CAAC1gB,QAAQ,CAAEC,CAAC,EAAI0gB,cAAc,CAAC1gB,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACjB,SAAS,CAAC,+CAA+C,CAAC,CAAC,EAChJ,CAAC,cACNxB,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,yCAAyC,CAAAG,QAAA,CAAC,OAAK,CAAO,CAAC,cACxE7B,IAAA,aAAU2C,KAAK,CAAEmgB,KAAM,CAAClgB,QAAQ,CAAEC,CAAC,EAAIkgB,QAAQ,CAAClgB,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACK,IAAI,CAAC,GAAG,CAACtB,SAAS,CAAC,+CAA+C,CAAW,CAAC,EAC9I,CAAC,cACNxB,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,yCAAyC,CAAAG,QAAA,CAAC,iBAAe,CAAO,CAAC,cAClF3B,KAAA,WAAQyC,KAAK,CAAEkU,MAAO,CAACjU,QAAQ,CAAEC,CAAC,EAAIogB,SAAS,CAACpgB,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACjB,SAAS,CAAC,+CAA+C,CAAAG,QAAA,eACtH7B,IAAA,WAAQ2C,KAAK,CAAC,WAAW,CAAAd,QAAA,CAAC,WAAS,CAAQ,CAAC,cAC5C7B,IAAA,WAAQ2C,KAAK,CAAC,YAAY,CAAAd,QAAA,CAAC,YAAU,CAAQ,CAAC,cAC9C7B,IAAA,WAAQ2C,KAAK,CAAC,oBAAoB,CAAAd,QAAA,CAAC,oBAAkB,CAAQ,CAAC,cAC9D7B,IAAA,WAAQ2C,KAAK,CAAC,uBAAuB,CAAAd,QAAA,CAAC,uBAAqB,CAAQ,CAAC,EAChE,CAAC,EACR,CAAC,EACL,CAAC,cACN3B,KAAA,QAAKwB,SAAS,CAAC,iCAAiC,CAAAG,QAAA,eAC5C7B,IAAA,WAAQ8B,OAAO,CAAET,OAAQ,CAAC6F,QAAQ,CAAE1C,OAAQ,CAAC9C,SAAS,CAAC,yEAAyE,CAAAG,QAAA,CAAC,UAAQ,CAAQ,CAAC,cAClJ7B,IAAA,WAAQ8B,OAAO,CAAEoR,UAAW,CAAChM,QAAQ,CAAE1C,OAAQ,CAAC9C,SAAS,CAAC,wEAAwE,CAAAG,QAAA,CAAE2C,OAAO,CAAG,cAAc,CAAG,qBAAqB,CAAS,CAAC,EAC7L,CAAC,EACL,CAAC,CACL,CAAC,CAEd,CAAC,CAED,KAAM,CAAAsQ,gBAAgB,CAAGhL,QAAQ,CAACwB,MAAM,CAACrH,OAAO,EAC3CA,OAAO,CAAC4C,GAAG,EAAI5C,OAAO,CAAC4C,GAAG,CAAC4G,WAAW,CAAC,CAAC,CAAC8G,QAAQ,CAAC7C,UAAU,CAACjE,WAAW,CAAC,CAAC,CAAC,EAC3ExJ,OAAO,CAAC2H,aAAa,EAAI3H,OAAO,CAAC2H,aAAa,CAAC6B,WAAW,CAAC,CAAC,CAAC8G,QAAQ,CAAC7C,UAAU,CAACjE,WAAW,CAAC,CAAC,CAAE,EAChGxJ,OAAO,CAAC4H,cAAc,EAAI5H,OAAO,CAAC4H,cAAc,CAAC4B,WAAW,CAAC,CAAC,CAAC8G,QAAQ,CAAC7C,UAAU,CAACjE,WAAW,CAAC,CAAC,CACrG,CAAC,CAED,KAAM,CAAAgW,eAAe,CAAG7R,WAAW,CAAGE,YAAY,CAClD,KAAM,CAAA4R,gBAAgB,CAAGD,eAAe,CAAG3R,YAAY,CACvD,KAAM,CAAAiD,YAAY,CAAGD,gBAAgB,CAACxL,KAAK,CAACoa,gBAAgB,CAAED,eAAe,CAAC,CAC9E,KAAM,CAAAzO,UAAU,CAAGC,IAAI,CAACC,IAAI,CAACJ,gBAAgB,CAAChO,MAAM,CAAGgL,YAAY,CAAC,CAEpE,KAAM,CAAAqD,QAAQ,CAAIC,UAAU,EAAKvD,cAAc,CAACuD,UAAU,CAAC,CAE3D,mBACIlV,KAAA,CAAAE,SAAA,EAAAyB,QAAA,eACI3B,KAAA,QAAKwB,SAAS,CAAC,6DAA6D,CAAAG,QAAA,eACxE7B,IAAA,UACIoB,IAAI,CAAC,MAAM,CACX2B,WAAW,CAAC,uCAAuC,CACnDrB,SAAS,CAAC,0EAA0E,CACpFkB,QAAQ,CAAGC,CAAC,EAAK,CAAE8O,aAAa,CAAC9O,CAAC,CAACC,MAAM,CAACH,KAAK,CAAC,CAAEkP,cAAc,CAAC,CAAC,CAAC,CAAE,CAAE,CAC1E,CAAC,cACF3R,KAAA,QAAKwB,SAAS,CAAC,mBAAmB,CAAAG,QAAA,eAC9B7B,IAAA,SAAM0B,SAAS,CAAC,cAAc,CAAAG,QAAA,CAAC,UAAQ,CAAM,CAAC,cAC9C3B,KAAA,WAAQyC,KAAK,CAAEmP,YAAa,CAAClP,QAAQ,CAAGC,CAAC,EAAK,CAAEkP,eAAe,CAACd,MAAM,CAACpO,CAAC,CAACC,MAAM,CAACH,KAAK,CAAC,CAAC,CAAEkP,cAAc,CAAC,CAAC,CAAC,CAAE,CAAE,CAACnQ,SAAS,CAAC,6CAA6C,CAAAG,QAAA,eAClK7B,IAAA,WAAQ2C,KAAK,CAAE,EAAG,CAAAd,QAAA,CAAC,IAAE,CAAQ,CAAC,cAC9B7B,IAAA,WAAQ2C,KAAK,CAAE,EAAG,CAAAd,QAAA,CAAC,IAAE,CAAQ,CAAC,cAC9B7B,IAAA,WAAQ2C,KAAK,CAAE,EAAG,CAAAd,QAAA,CAAC,IAAE,CAAQ,CAAC,EAC1B,CAAC,EACR,CAAC,EACL,CAAC,cAEN7B,IAAA,QAAK0B,SAAS,CAAC,4CAA4C,CAAAG,QAAA,cACvD3B,KAAA,UAAOwB,SAAS,CAAC,qCAAqC,CAAAG,QAAA,eAClD7B,IAAA,UAAO0B,SAAS,CAAC,YAAY,CAAAG,QAAA,cACzB3B,KAAA,OAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,KAAG,CAAI,CAAC,cACxF7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,SAAO,CAAI,CAAC,cAC5F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,UAAQ,CAAI,CAAC,cAC7F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,qBAAgB,CAAI,CAAC,cACrG7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,QAAM,CAAI,CAAC,cAC3F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,OAAK,CAAI,CAAC,cAC1F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,kBAAU,CAAI,CAAC,cAC/F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,iBAAY,CAAI,CAAC,cACjG7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,iBAAe,CAAI,CAAC,cACpG7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,UAAQ,CAAI,CAAC,EAC7F,CAAC,CACF,CAAC,cACR7B,IAAA,UAAO0B,SAAS,CAAC,mCAAmC,CAAAG,QAAA,CAC/CkT,YAAY,CAAC7P,GAAG,CAACjB,OAAO,eACpB/D,KAAA,OAAA2B,QAAA,eACG7B,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAAC4C,GAAG,CAAK,CAAC,cACtE7G,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAAC2H,aAAa,CAAK,CAAC,cAChF5L,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAAC4H,cAAc,CAAK,CAAC,cACjF7L,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAACwS,yBAAyB,EAAI,KAAK,CAAK,CAAC,cACrGzW,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAAC4e,eAAe,EAAI,KAAK,CAAK,CAAC,cAC3F7iB,IAAA,OAAI0B,SAAS,CAAC,iCAAiC,CAACO,KAAK,CAAEgC,OAAO,CAAC+e,YAAa,CAAAnhB,QAAA,cACxE7B,IAAA,MAAG0B,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAEoC,OAAO,CAAC+e,YAAY,EAAI,KAAK,CAAI,CAAC,CAChE,CAAC,cACLhjB,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAACof,eAAe,EAAI,KAAK,CAAK,CAAC,cAC3FrjB,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAACuf,iBAAiB,EAAI,KAAK,CAAK,CAAC,cAC7FxjB,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAACif,cAAc,EAAI,WAAW,CAAK,CAAC,cAChGljB,IAAA,OAAI0B,SAAS,CAAC,iDAAiD,CAAAG,QAAA,cAC3D7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMyP,eAAe,CAACtN,OAAO,CAAE,CAACvC,SAAS,CAAC,uCAAuC,CAAAG,QAAA,CAAC,WAAS,CAAQ,CAAC,CACrH,CAAC,GAdCoC,OAAO,CAACa,EAed,CACP,CAAC,CACC,CAAC,EACL,CAAC,CACP,CAAC,cAEN5E,KAAA,QAAKwB,SAAS,CAAC,wCAAwC,CAAAG,QAAA,eACnD3B,KAAA,SAAMwB,SAAS,CAAC,uBAAuB,CAAAG,QAAA,EAAC,YAAO,CAAC+P,WAAW,CAAC,MAAI,CAACoD,UAAU,EAAO,CAAC,cACnF9U,KAAA,QAAA2B,QAAA,eACI7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMqT,QAAQ,CAACvD,WAAW,CAAG,CAAC,CAAE,CAAC1K,QAAQ,CAAE0K,WAAW,GAAK,CAAE,CAAClQ,SAAS,CAAC,+DAA+D,CAAAG,QAAA,CAAC,UAAQ,CAAQ,CAAC,cAC1K7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMqT,QAAQ,CAACvD,WAAW,CAAG,CAAC,CAAE,CAAC1K,QAAQ,CAAE0K,WAAW,GAAKoD,UAAU,EAAIA,UAAU,GAAK,CAAE,CAACtT,SAAS,CAAC,0DAA0D,CAAAG,QAAA,CAAC,WAAS,CAAQ,CAAC,EAClM,CAAC,EACL,CAAC,CAELyP,YAAY,eAAItR,IAAA,CAACuiB,yBAAyB,EAACte,OAAO,CAAEqN,YAAa,CAACjQ,OAAO,CAAEA,CAAA,GAAMkQ,eAAe,CAAC,IAAI,CAAE,CAAC0B,WAAW,CAAEvI,eAAgB,CAAE,CAAC,EAC3I,CAAC,CAEX,CAAC,CAED;AACA,KAAM,CAAAiZ,mBAAmB,CAAGC,MAAA,EAAwB,IAAvB,CAAEzgB,IAAI,CAAEC,QAAS,CAAC,CAAAwgB,MAAA,CAC3C,KAAM,CAACha,IAAI,CAAEC,OAAO,CAAC,CAAGxM,QAAQ,CAAC,KAAK,CAAC,CAAE;AACzC,KAAM,CAACwmB,iBAAiB,CAAEC,oBAAoB,CAAC,CAAGzmB,QAAQ,CAAC,EAAE,CAAC,CAC9D,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,IAAI,CAAC,CAC5C;AACA,KAAM,CAAC0mB,MAAM,CAAEC,SAAS,CAAC,CAAG3mB,QAAQ,CAAC,eAAe,CAAC,CACrD,KAAM,CAAC4mB,SAAS,CAAEC,YAAY,CAAC,CAAG7mB,QAAQ,CAAC,MAAM,CAAC,CAElDC,SAAS,CAAC,IAAM,CACZmH,UAAU,CAAC,IAAI,CAAC,CAChB;AACA,KAAM,CAAAI,CAAC,CAAG7G,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,WAAW,CAAC,CAAE9C,KAAK,CAAC,QAAQ,CAAE,IAAI,CAAE,QAAQ,CAAC,CAAC,CAE7E,KAAM,CAAA8G,WAAW,CAAGzG,UAAU,CAACuG,CAAC,CAAGG,aAAa,EAAK,CACjD,KAAM,CAAAoU,YAAY,CAAGpU,aAAa,CAACC,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CACnF0e,oBAAoB,CAAC1K,YAAY,CAAC,CAClC3U,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAGjD,KAAK,EAAK,CACV8D,OAAO,CAAC9D,KAAK,CAAC,gDAAgD,CAAEA,KAAK,CAAC,CACtEiD,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAC,CAEF,MAAO,IAAMM,WAAW,CAAC,CAAC,CAC9B,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAof,iBAAiB,CAAG/mB,KAAK,CAACgnB,OAAO,CAAC,IAAM,CAC1C,KAAM,CAAAC,QAAQ,CAAGR,iBAAiB,CAACvY,MAAM,CAACC,CAAC,EAAI,CAC3C,KAAM,CAAA+Y,sBAAsB,CAAG/Y,CAAC,CAACwF,mBAAmB,EAAIxF,CAAC,CAACwF,mBAAmB,CAACjK,MAAM,CAAG,CAAC,CACxF,GAAI8C,IAAI,GAAK,KAAK,CAAE,MAAO,CAAC0a,sBAAsB,CAClD,GAAI1a,IAAI,GAAK,UAAU,CAAE,MAAO,CAAA0a,sBAAsB,CACtD,MAAO,MAAK,CAChB,CAAC,CAAC,CAEF,MAAO,CAAAD,QAAQ,CAAChW,IAAI,CAAC,CAACH,CAAC,CAAEC,CAAC,GAAK,CAC3B,KAAM,CAAAoW,MAAM,CAAGrW,CAAC,CAAC6V,MAAM,CAAC,CACxB,KAAM,CAAAS,MAAM,CAAGrW,CAAC,CAAC4V,MAAM,CAAC,CAExB,GAAI,CAACQ,MAAM,CAAE,MAAO,EAAC,CAAE;AACvB,GAAI,CAACC,MAAM,CAAE,MAAO,CAAC,CAAC,CAEtB,GAAI,CAAAC,UAAU,CAAG,CAAC,CAClB,GAAIF,MAAM,CAAC5d,OAAO,CAAG6d,MAAM,CAAC7d,OAAO,CAAE,CACjC8d,UAAU,CAAG,CAAC,CAClB,CAAC,IAAM,IAAIF,MAAM,CAAC5d,OAAO,CAAG6d,MAAM,CAAC7d,OAAO,CAAE,CACxC8d,UAAU,CAAG,CAAC,CAAC,CACnB,CACA,MAAO,CAAAR,SAAS,GAAK,KAAK,CAAGQ,UAAU,CAAG,CAACA,UAAU,CACzD,CAAC,CAAC,CACN,CAAC,CAAE,CAACZ,iBAAiB,CAAEja,IAAI,CAAEma,MAAM,CAAEE,SAAS,CAAC,CAAC,CAEhD,mBACI/jB,KAAA,QAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,uCAAuC,CAAAG,QAAA,CAAC,yBAAoB,CAAI,CAAC,cAC/E7B,IAAA,QAAK0B,SAAS,CAAC,+BAA+B,CAAAG,QAAA,cAC1C3B,KAAA,QAAKwB,SAAS,CAAC,uBAAuB,CAAC,aAAW,MAAM,CAAAG,QAAA,eACpD7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM+H,OAAO,CAAC,KAAK,CAAE,CAACnI,SAAS,+DAAAC,MAAA,CAAgEiI,IAAI,GAAK,KAAK,CAAG,+BAA+B,CAAG,kCAAkC,CAAG,CAAA/H,QAAA,CAAC,oBAAkB,CAAQ,CAAC,cACpO7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM+H,OAAO,CAAC,UAAU,CAAE,CAACnI,SAAS,+DAAAC,MAAA,CAAgEiI,IAAI,GAAK,UAAU,CAAG,+BAA+B,CAAG,kCAAkC,CAAG,CAAA/H,QAAA,CAAC,wBAAsB,CAAQ,CAAC,EACjP,CAAC,CACL,CAAC,cAGN3B,KAAA,QAAKwB,SAAS,CAAC,oCAAoC,CAAAG,QAAA,eAC/C7B,IAAA,UAAO6U,OAAO,CAAC,SAAS,CAACnT,SAAS,CAAC,wCAAwC,CAAAG,QAAA,CAAC,cAAY,CAAO,CAAC,cAChG3B,KAAA,WAAQ4E,EAAE,CAAC,SAAS,CAACnC,KAAK,CAAEohB,MAAO,CAACnhB,QAAQ,CAAEC,CAAC,EAAImhB,SAAS,CAACnhB,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACjB,SAAS,CAAC,+BAA+B,CAAAG,QAAA,eACnH7B,IAAA,WAAQ2C,KAAK,CAAC,eAAe,CAAAd,QAAA,CAAC,mBAAiB,CAAQ,CAAC,cACxD7B,IAAA,WAAQ2C,KAAK,CAAC,qBAAqB,CAAAd,QAAA,CAAC,iBAAY,CAAQ,CAAC,EACrD,CAAC,cACT7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMoiB,YAAY,CAACD,SAAS,GAAK,KAAK,CAAG,MAAM,CAAG,KAAK,CAAE,CAACviB,SAAS,CAAC,oCAAoC,CAAAG,QAAA,CACpHoiB,SAAS,GAAK,KAAK,CAAG,OAAO,CAAG,QAAQ,CACrC,CAAC,EACR,CAAC,CAELzf,OAAO,cAAGxE,IAAA,MAAA6B,QAAA,CAAG,uBAAqB,CAAG,CAAC,cAAG7B,IAAA,CAACyK,aAAa,EAACX,QAAQ,CAAEqa,iBAAkB,CAACzZ,eAAe,CAAEA,CAAA,GAAM,CAAC,CAAE,CAACC,QAAQ,CAAC,YAAY,CAACxH,IAAI,CAAEA,IAAK,CAACC,QAAQ,CAAEA,QAAS,CAAE,CAAC,EACxK,CAAC,CAEd,CAAC,CAED;AACA,KAAM,CAAAshB,gBAAgB,CAAGC,MAAA,EAAwB,IAAvB,CAAExhB,IAAI,CAAEC,QAAS,CAAC,CAAAuhB,MAAA,CACxC,KAAM,CAAC/a,IAAI,CAAEC,OAAO,CAAC,CAAGxM,QAAQ,CAAC,KAAK,CAAC,CAAE;AACzC,KAAM,CAACyM,QAAQ,CAAEC,WAAW,CAAC,CAAG1M,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,IAAI,CAAC,CAE5CC,SAAS,CAAC,IAAM,CACZ,GAAI,CAAC6F,IAAI,CAAE,OACXsB,UAAU,CAAC,IAAI,CAAC,CAEhB,KAAM,CAAAmgB,aAAa,CAAGhb,IAAI,GAAK,KAAK,CAAG,UAAU,CAAG,YAAY,CAEhE,KAAM,CAAA/E,CAAC,CAAG7G,KAAK,CACXF,UAAU,CAACiD,EAAE,CAAE,WAAW,CAAC,CAC3B9C,KAAK,CAAC,QAAQ,CAAE,IAAI,CAAE,QAAQ,CAAC,CAC/BA,KAAK,mBAAA0D,MAAA,CAAmBwB,IAAI,CAAC8C,GAAG,EAAI,IAAI,CAAE2e,aAAa,CAC3D,CAAC,CAED,KAAM,CAAA7f,WAAW,CAAGzG,UAAU,CAACuG,CAAC,CAAGG,aAAa,EAAK,CACjD,KAAM,CAAAoU,YAAY,CAAGpU,aAAa,CAACC,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CACnF2E,WAAW,CAACqP,YAAY,CAAC,CACzB3U,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAGjD,KAAK,EAAK,CACV8D,OAAO,CAAC9D,KAAK,gDAAAG,MAAA,CAAgDiI,IAAI,MAAKpI,KAAK,CAAC,CAC5E,GAAIA,KAAK,CAAC6X,IAAI,GAAK,qBAAqB,CAAE,CACtChC,KAAK,CAAC,qKAAqK,CAAC,CAChL,CACA5S,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAC,CAEF,MAAO,IAAMM,WAAW,CAAC,CAAC,CAC9B,CAAC,CAAE,CAAC6E,IAAI,CAAEzG,IAAI,CAAC,CAAC,CAEhB,KAAM,CAAA0hB,kBAAkB,CAAG,KAAO,CAAA5gB,OAAO,EAAK,CAC1C,KAAM,CAAAuQ,UAAU,CAAGrW,GAAG,CAAC4C,EAAE,CAAE,WAAW,CAAEkD,OAAO,CAACa,EAAE,CAAC,CACnD,KAAM,CAAAzG,SAAS,CAACmW,UAAU,CAAE,CACxB,mBAAA7S,MAAA,CAAmBwB,IAAI,CAAC8C,GAAG,GAAK,YACpC,CAAC,CAAC,CACN,CAAC,CAED,mBACI/F,KAAA,QAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,uCAAuC,CAAAG,QAAA,CAAC,YAAU,CAAI,CAAC,cACrE7B,IAAA,QAAK0B,SAAS,CAAC,+BAA+B,CAAAG,QAAA,cAC1C3B,KAAA,QAAKwB,SAAS,CAAC,uBAAuB,CAAC,aAAW,MAAM,CAAAG,QAAA,eACpD7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM+H,OAAO,CAAC,KAAK,CAAE,CAACnI,SAAS,+DAAAC,MAAA,CAAgEiI,IAAI,GAAK,KAAK,CAAG,+BAA+B,CAAG,kCAAkC,CAAG,CAAA/H,QAAA,CAAC,eAAa,CAAQ,CAAC,cAC/N7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM+H,OAAO,CAAC,YAAY,CAAE,CAACnI,SAAS,+DAAAC,MAAA,CAAgEiI,IAAI,GAAK,YAAY,CAAG,+BAA+B,CAAG,kCAAkC,CAAG,CAAA/H,QAAA,CAAC,mBAAiB,CAAQ,CAAC,EAChP,CAAC,CACL,CAAC,CAEL2C,OAAO,cAAGxE,IAAA,MAAA6B,QAAA,CAAG,oBAAkB,CAAG,CAAC,cAChC7B,IAAA,CAAC8kB,oBAAoB,EACjBhb,QAAQ,CAAEA,QAAS,CACnBY,eAAe,CAAEA,CAAA,GAAM,CAAC,CAAE,CAC1BvH,IAAI,CAAEA,IAAK,CACXC,QAAQ,CAAEA,QAAS,CACnByhB,kBAAkB,CAAEA,kBAAmB,CAC1C,CACJ,EACA,CAAC,CAEd,CAAC,CAED;AACA,KAAM,CAAAC,oBAAoB,CAAGC,MAAA,EAAuE,IAAtE,CAAEjb,QAAQ,CAAEY,eAAe,CAAEvH,IAAI,CAAEC,QAAQ,CAAEyhB,kBAAmB,CAAC,CAAAE,MAAA,CAC3F,KAAM,CAACzT,YAAY,CAAEC,eAAe,CAAC,CAAGlU,QAAQ,CAAC,IAAI,CAAC,CACtD,KAAM,CAACmU,SAAS,CAAEC,YAAY,CAAC,CAAGpU,QAAQ,CAAC,EAAE,CAAC,CAAE;AAEhD,KAAM,CAAA2nB,eAAe,CAAGC,MAAA,EAAuC,IAAtC,CAAEhhB,OAAO,CAAE5C,OAAO,CAAE4R,WAAY,CAAC,CAAAgS,MAAA,CACtD,KAAM,CAACC,QAAQ,CAAEC,WAAW,CAAC,CAAG9nB,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAAC+nB,YAAY,CAAEC,eAAe,CAAC,CAAGhoB,QAAQ,CAAC,IAAI,CAAC,CACtD,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACmE,KAAK,CAAEoD,QAAQ,CAAC,CAAGvH,QAAQ,CAAC,EAAE,CAAC,CAEtC,KAAM,CAAAkI,gBAAgB,CAAI1C,CAAC,EAAK,CAC5B,GAAIA,CAAC,CAACC,MAAM,CAAC0C,KAAK,CAAC,CAAC,CAAC,CAAE,CACnB6f,eAAe,CAACxiB,CAAC,CAACC,MAAM,CAAC0C,KAAK,CAAC,CAAC,CAAC,CAAC,CACtC,CACJ,CAAC,CAED,KAAM,CAAA8f,mBAAmB,CAAG,KAAAA,CAAA,GAAY,CACpC,GAAI,MAAO,CAAAC,MAAM,CAACC,KAAK,GAAK,WAAW,CAAE,CACrC,KAAM,IAAI,CAAAC,KAAK,CAAC,yDAAyD,CAAC,CAC9E,CACA,KAAM,CAAEC,KAAM,CAAC,CAAGH,MAAM,CAACC,KAAK,CAC9B,KAAM,CAAAG,MAAM,CAAG,GAAI,CAAAD,KAAK,CAAC,CAAC,CAC1B,KAAM,CAAAvW,UAAU,CAAG,GAAI,CAAAvJ,IAAI,CAAC,CAAC,CAACwJ,WAAW,CAAC,CAAC,CAC3C,KAAM,CAAAC,WAAW,CAAGlR,GAAG,CAAC4C,EAAE,CAAE,YAAY,kBAAAY,MAAA,CAAmBwN,UAAU,CAAE,CAAC,CACxE,KAAM,CAAAG,gBAAgB,CAAG,KAAM,CAAA7Q,cAAc,CAACsC,EAAE,CAAE,KAAO,CAAAwO,WAAW,EAAK,CACrE,KAAM,CAAAC,WAAW,CAAG,KAAM,CAAAD,WAAW,CAACE,GAAG,CAACJ,WAAW,CAAC,CACtD,KAAM,CAAAK,UAAU,CAAG,CAACF,WAAW,CAACG,MAAM,CAAC,CAAC,CAAGH,WAAW,CAACpK,IAAI,CAAC,CAAC,CAACwK,WAAW,CAAG,CAAC,EAAI,CAAC,CAClFL,WAAW,CAACM,GAAG,CAACR,WAAW,CAAE,CAAEO,WAAW,CAAEF,UAAW,CAAC,CAAE,CAAEI,KAAK,CAAE,IAAK,CAAC,CAAC,CAC1E,MAAO,CAAAJ,UAAU,CACrB,CAAC,CAAC,CACF,KAAM,CAAAkW,UAAU,IAAAjkB,MAAA,CAAMwN,UAAU,MAAAxN,MAAA,CAAI2N,gBAAgB,CAACU,QAAQ,CAAC,CAAC,CAAC1H,QAAQ,CAAC,CAAC,CAAE,GAAG,CAAC,CAAE,CAElFqd,MAAM,CAACE,OAAO,CAAC,WAAW,CAAE,MAAM,CAAC,CACnCF,MAAM,CAACG,WAAW,CAAC,EAAE,CAAC,CACtBH,MAAM,CAACI,IAAI,CAAC,kDAAkD,CAAE,GAAG,CAAE,EAAE,CAAE,CAAEC,KAAK,CAAE,QAAS,CAAC,CAAC,CAC7FL,MAAM,CAACE,OAAO,CAAC,WAAW,CAAE,QAAQ,CAAC,CACrCF,MAAM,CAACG,WAAW,CAAC,CAAC,CAAC,CACrBH,MAAM,CAACI,IAAI,CAAC,iDAAiD,CAAE,GAAG,CAAE,EAAE,CAAE,CAAEC,KAAK,CAAE,QAAS,CAAC,CAAC,CAC5FL,MAAM,CAACI,IAAI,CAAC,iDAAiD,CAAE,GAAG,CAAE,EAAE,CAAE,CAAEC,KAAK,CAAE,QAAS,CAAC,CAAC,CAC5FL,MAAM,CAACG,WAAW,CAAC,EAAE,CAAC,CACtBH,MAAM,CAACE,OAAO,CAAC,WAAW,CAAE,MAAM,CAAC,CACnCF,MAAM,CAACI,IAAI,CAAC,iBAAiB,CAAE,GAAG,CAAE,EAAE,CAAE,CAAEC,KAAK,CAAE,QAAS,CAAC,CAAC,CAC5DL,MAAM,CAACI,IAAI,CAACH,UAAU,CAAE,GAAG,CAAE,EAAE,CAAC,CAChCD,MAAM,CAACG,WAAW,CAAC,EAAE,CAAC,CACtBH,MAAM,CAACE,OAAO,CAAC,WAAW,CAAE,QAAQ,CAAC,CACrCF,MAAM,CAACI,IAAI,WAAApkB,MAAA,CAAW,GAAI,CAAAiE,IAAI,CAAC,CAAC,CAAC6P,kBAAkB,CAAC,OAAO,CAAC,EAAI,EAAE,CAAE,EAAE,CAAC,CACvEkQ,MAAM,CAACI,IAAI,cAAApkB,MAAA,CAAcsC,OAAO,CAAC4C,GAAG,EAAI,EAAE,CAAE,EAAE,CAAC,CAC/C8e,MAAM,CAACI,IAAI,4BAAApkB,MAAA,CAAyBsC,OAAO,CAAC2H,aAAa,EAAI,EAAE,CAAE,EAAE,CAAC,CACpE+Z,MAAM,CAACM,IAAI,CAAC,EAAE,CAAE,EAAE,CAAE,GAAG,CAAE,EAAE,CAAC,CAC5BN,MAAM,CAACI,IAAI,CAAC,aAAa,CAAE,EAAE,CAAE,GAAG,CAAC,CACnCJ,MAAM,CAACI,IAAI,CAAC,UAAU,CAAE,GAAG,CAAE,GAAG,CAAC,CACjCJ,MAAM,CAACI,IAAI,CAAC9hB,OAAO,CAAC4H,cAAc,CAAE,EAAE,CAAE,GAAG,CAAC,CAC5C8Z,MAAM,CAACI,IAAI,CAAC,GAAG,CAAE,GAAG,CAAE,GAAG,CAAC,CAC1BJ,MAAM,CAACI,IAAI,CAAC,cAAc,CAAE,EAAE,CAAE,GAAG,CAAC,CACpC,KAAM,CAAAG,aAAa,CAAGP,MAAM,CAACQ,eAAe,CAACjB,QAAQ,CAAE,GAAG,CAAC,CAC3DS,MAAM,CAACI,IAAI,CAACG,aAAa,CAAE,EAAE,CAAE,GAAG,CAAC,CACnCP,MAAM,CAACI,IAAI,CAAC,eAAe,CAAE,EAAE,CAAE,GAAG,CAAC,CACrCJ,MAAM,CAACS,IAAI,CAAC,EAAE,CAAE,GAAG,CAAE,GAAG,CAAE,GAAG,CAAC,CAC9BT,MAAM,CAACI,IAAI,CAAC,gBAAgB,CAAE,EAAE,CAAE,GAAG,CAAC,CAEtCJ,MAAM,CAACU,IAAI,iBAAA1kB,MAAA,CAAiBikB,UAAU,QAAM,CAAC,CAC7C,MAAO,CAAEA,UAAW,CAAC,CACzB,CAAC,CAED;AACA,KAAM,CAAAU,kBAAkB,CAAG,KAAAA,CAAA,GAAY,CACnC,GAAI,CAAClB,YAAY,CAAE,CACfxgB,QAAQ,CAAC,mDAAmD,CAAC,CAC7D,OACJ,CACAH,UAAU,CAAC,IAAI,CAAC,CAChBG,QAAQ,CAAC,EAAE,CAAC,CAEZ,GAAI,CACA,KAAM,CAAA2hB,WAAW,CAAGxnB,GAAG,CAACiC,OAAO,uBAAAW,MAAA,CAAwBsC,OAAO,CAACa,EAAE,MAAAnD,MAAA,CAAIyjB,YAAY,CAACtf,IAAI,CAAE,CAAC,CACzF,KAAM,CAAA0gB,kBAAkB,CAAGxnB,oBAAoB,CAACunB,WAAW,CAAEnB,YAAY,CAAC,CAC1E,KAAM,CAAAqB,WAAW,CAAG,KAAM,CAAAxnB,cAAc,CAAC,CAAC,KAAM,CAAAunB,kBAAkB,EAAEznB,GAAG,CAAC,CAExE,KAAM,CAAE6mB,UAAW,CAAC,CAAG,KAAM,CAAAN,mBAAmB,CAAC,CAAC,CAElD,KAAM,CAAA9Q,UAAU,CAAGrW,GAAG,CAAC4C,EAAE,CAAE,WAAW,CAAEkD,OAAO,CAACa,EAAE,CAAC,CACnD,KAAM,CAAAyO,aAAa,CAAG,CAClB1C,MAAM,CAAE,wBAAwB,CAChC6V,kBAAkB,CAAExB,QACxB,CAAC,CAED;AACA,GAAI,CAACjhB,OAAO,CAACwH,aAAa,CAAE,CAAE;AAC1B8H,aAAa,CAACoT,oBAAoB,CAAGF,WAAW,CAChDlT,aAAa,CAACqT,kBAAkB,CAAGhB,UAAU,CAC7CrS,aAAa,CAACsM,gBAAgB,CAAGrhB,SAAS,CAACqH,GAAG,CAAC,CAAC,CACpD,CAAC,IAAM,CAAE;AACL0N,aAAa,CAACsT,oBAAoB,CAAGJ,WAAW,CAChDlT,aAAa,CAACuT,kBAAkB,CAAGlB,UAAU,CAC7CrS,aAAa,CAACuM,gBAAgB,CAAGthB,SAAS,CAACqH,GAAG,CAAC,CAAC,CACpD,CAEA,KAAM,CAAAxH,SAAS,CAACmW,UAAU,CAAEjB,aAAa,CAAC,CAE1CN,WAAW,CAAC,CAAC,CACb5R,OAAO,CAAC,CAAC,CAEb,CAAE,MAAOgE,GAAG,CAAE,CACVC,OAAO,CAAC9D,KAAK,CAAC,8BAA8B,CAAE6D,GAAG,CAAC,CAClDT,QAAQ,CAACS,GAAG,CAAClE,OAAO,EAAI,wCAAwC,CAAC,CACjEsD,UAAU,CAAC,KAAK,CAAC,CACrB,CACJ,CAAC,CAED,mBACIzE,IAAA,QAAK0B,SAAS,CAAC,gFAAgF,CAAAG,QAAA,cAC3F3B,KAAA,QAAKwB,SAAS,CAAC,mDAAmD,CAAAG,QAAA,eAC9D3B,KAAA,OAAIwB,SAAS,CAAC,wBAAwB,CAAAG,QAAA,EAAC,mBAAiB,CAACoC,OAAO,CAAC4C,GAAG,EAAK,CAAC,cAC1E3G,KAAA,QAAKwB,SAAS,CAAC,WAAW,CAAAG,QAAA,eACtB3B,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,yCAAyC,CAAAG,QAAA,CAAC,4CAA0C,CAAO,CAAC,cAC7G7B,IAAA,aAAU2C,KAAK,CAAEuiB,QAAS,CAACtiB,QAAQ,CAAEC,CAAC,EAAIsiB,WAAW,CAACtiB,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACK,IAAI,CAAC,GAAG,CAACtB,SAAS,CAAC,+CAA+C,CAAW,CAAC,EACpJ,CAAC,cACNxB,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,yCAAyC,CAAAG,QAAA,CAAC,kCAA6B,CAAO,CAAC,cAChG7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC2lB,MAAM,CAAC,MAAM,CAACnkB,QAAQ,CAAE2C,gBAAiB,CAAC7D,SAAS,CAAC,2BAA2B,CAAC,CAAC,EACnG,CAAC,EACL,CAAC,cACN1B,IAAA,CAACiB,KAAK,EAACE,OAAO,CAAEK,KAAM,CAACJ,IAAI,CAAC,OAAO,CAACC,OAAO,CAAEA,CAAA,GAAMuD,QAAQ,CAAC,EAAE,CAAE,CAAE,CAAC,cACnE1E,KAAA,QAAKwB,SAAS,CAAC,iCAAiC,CAAAG,QAAA,eAC5C7B,IAAA,WAAQ8B,OAAO,CAAET,OAAQ,CAAC6F,QAAQ,CAAE1C,OAAQ,CAAC9C,SAAS,CAAC,yEAAyE,CAAAG,QAAA,CAAC,UAAQ,CAAQ,CAAC,cAClJ7B,IAAA,WAAQ8B,OAAO,CAAEwkB,kBAAmB,CAACpf,QAAQ,CAAE1C,OAAQ,CAAC9C,SAAS,CAAC,wEAAwE,CAAAG,QAAA,CAAE2C,OAAO,CAAG,aAAa,CAAG,gCAAgC,CAAS,CAAC,EAC/M,CAAC,EACL,CAAC,CACL,CAAC,CAEd,CAAC,CAED,KAAM,CAAAiC,UAAU,CAAIC,SAAS,EAAK,CAACA,SAAS,CAAG,KAAK,CAAG,GAAI,CAAAd,IAAI,CAACc,SAAS,CAACC,OAAO,CAAG,IAAI,CAAC,CAAC8O,kBAAkB,CAAC,OAAO,CAAC,CAErH,mBACIvV,KAAA,CAAAE,SAAA,EAAAyB,QAAA,eACI7B,IAAA,QAAK0B,SAAS,CAAC,4CAA4C,CAAAG,QAAA,cACvD3B,KAAA,UAAOwB,SAAS,CAAC,qCAAqC,CAAAG,QAAA,eAClD7B,IAAA,UAAO0B,SAAS,CAAC,YAAY,CAAAG,QAAA,cACzB3B,KAAA,OAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,SAAO,CAAI,CAAC,cAC5F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,UAAQ,CAAI,CAAC,cAC7F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,iBAAY,CAAI,CAAC,cACjG7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,UAAQ,CAAI,CAAC,EAC7F,CAAC,CACF,CAAC,cACR7B,IAAA,UAAO0B,SAAS,CAAC,mCAAmC,CAAAG,QAAA,CAC/CiI,QAAQ,CAAC5E,GAAG,CAACjB,OAAO,eAChB/D,KAAA,OAAA2B,QAAA,eACG7B,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAAC2H,aAAa,CAAK,CAAC,cAChF5L,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAAC4H,cAAc,CAAK,CAAC,cACjF7L,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAE4E,UAAU,CAACxC,OAAO,CAACiQ,mBAAmB,CAAC,CAAK,CAAC,cAClGlU,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,cACrB3B,KAAA,QAAKwB,SAAS,CAAC,6BAA6B,CAAAG,QAAA,EACvCoC,OAAO,CAAC+M,cAAc,CAAC7N,IAAI,CAAC8C,GAAG,CAAC,GAAK,UAAU,eAAIjG,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM+iB,kBAAkB,CAAC5gB,OAAO,CAAE,CAACvC,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAC,SAAO,CAAQ,CAAC,CACvKoC,OAAO,CAAC+M,cAAc,CAAC7N,IAAI,CAAC8C,GAAG,CAAC,GAAK,YAAY,eAC9C/F,KAAA,CAAAE,SAAA,EAAAyB,QAAA,eACI7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM,CAAEyP,eAAe,CAACtN,OAAO,CAAC,CAAEwN,YAAY,CAAC,MAAM,CAAC,CAAE,CAAE,CAAC/P,SAAS,CAAC,iBAAiB,CAAAG,QAAA,CAAC,iBAAe,CAAQ,CAAC,cAChI7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM,CAAEyP,eAAe,CAACtN,OAAO,CAAC,CAAEwN,YAAY,CAAC,KAAK,CAAC,CAAE,CAAE,CAAC/P,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAC,aAAQ,CAAQ,CAAC,EACxH,CACL,EACA,CAAC,CACN,CAAC,GAdCoC,OAAO,CAACa,EAed,CACP,CAAC,CACC,CAAC,EACL,CAAC,CACP,CAAC,CACLwM,YAAY,EAAIE,SAAS,GAAK,MAAM,eAAIxR,IAAA,CAACglB,eAAe,EAAC/gB,OAAO,CAAEqN,YAAa,CAACjQ,OAAO,CAAEA,CAAA,GAAMkQ,eAAe,CAAC,IAAI,CAAE,CAAC0B,WAAW,CAAEvI,eAAgB,CAAE,CAAC,CACtJ4G,YAAY,EAAIE,SAAS,GAAK,KAAK,eAAIxR,IAAA,CAAC+D,eAAe,EAACE,OAAO,CAAEqN,YAAa,CAACnO,IAAI,CAAEA,IAAK,CAACC,QAAQ,CAAEA,QAAS,CAAC/B,OAAO,CAAEA,CAAA,GAAMkQ,eAAe,CAAC,IAAI,CAAE,CAAE,CAAC,EAC1J,CAAC,CAEX,CAAC,CAED;AACA,KAAM,CAAAyV,iBAAiB,CAAGC,MAAA,EAAwB,IAAvB,CAAE9jB,IAAI,CAAEC,QAAS,CAAC,CAAA6jB,MAAA,CACzC,KAAM,CAACrd,IAAI,CAAEC,OAAO,CAAC,CAAGxM,QAAQ,CAAC,YAAY,CAAC,CAC9C,KAAM,CAACyM,QAAQ,CAAEC,WAAW,CAAC,CAAG1M,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,IAAI,CAAC,CAE5C,KAAM,CAAA6pB,oBAAoB,CAAGA,CAAA,GAAM,CAC/BziB,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAAI,CAAC,CAAG7G,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,WAAW,CAAC,CAAE9C,KAAK,CAAC,QAAQ,CAAE,IAAI,CAAE,CAAC,sBAAsB,CAAE,WAAW,CAAC,CAAC,CAAC,CAE1G,KAAM,CAAA8G,WAAW,CAAGzG,UAAU,CAACuG,CAAC,CAAGG,aAAa,EAAK,CACjD,KAAM,CAAAoU,YAAY,CAAGpU,aAAa,CAACC,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CAEnF;AACAgU,YAAY,CAAC1G,OAAO,CAACzO,OAAO,EAAI,CAC5B,GAAIA,OAAO,CAAC4M,MAAM,GAAK,WAAW,EAAI5M,OAAO,CAACmT,eAAe,GAAK,YAAY,CAAE,CAC5E9R,OAAO,CAAC6hB,GAAG,oCAAAxlB,MAAA,CAAiCsC,OAAO,CAAC4C,GAAG,2BAAyB,CAAC,CACjF,KAAM,CAAA2N,UAAU,CAAGrW,GAAG,CAAC4C,EAAE,CAAE,WAAW,CAAEkD,OAAO,CAACa,EAAE,CAAC,CACnD,KAAM,CAAAsiB,iBAAiB,CAAG,CAAC,CAAC,CAC5B,GAAInjB,OAAO,CAAC8M,mBAAmB,CAAE,CAC7B9M,OAAO,CAAC8M,mBAAmB,CAAC2B,OAAO,CAAC4B,MAAM,EAAI,CAC1C8S,iBAAiB,CAAC9S,MAAM,CAAC,CAAG,YAAY,CAC5C,CAAC,CAAC,CACN,CACAjW,SAAS,CAACmW,UAAU,CAAE,CAClB3D,MAAM,CAAE,QAAQ,CAChBG,cAAc,CAAEoW,iBAAiB,CACjChQ,eAAe,CAAE,kBACrB,CAAC,CAAC,CACN,CACJ,CAAC,CAAC,CAEF;AACArN,WAAW,CAACqP,YAAY,CAAC9N,MAAM,CAACC,CAAC,EAAIA,CAAC,CAACsF,MAAM,GAAK,sBAAsB,CAAC,CAAC,CAC1EpM,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAC,CAEF,MAAO,CAAAM,WAAW,CACtB,CAAC,CAEDzH,SAAS,CAAC,IAAM,CACZ,GAAI,CAAAyH,WAAW,CAAGA,CAAA,GAAM,CAAC,CAAC,CAC1B,GAAI6E,IAAI,GAAK,YAAY,CAAE,CACvB7E,WAAW,CAAGmiB,oBAAoB,CAAC,CAAC,CACxC,CAAC,IAAM,CACHziB,UAAU,CAAC,KAAK,CAAC,CACrB,CACA,MAAO,IAAMM,WAAW,CAAC,CAAC,CAC9B,CAAC,CAAE,CAAC6E,IAAI,CAAC,CAAC,CAEV,mBACI1J,KAAA,QAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,uCAAuC,CAAAG,QAAA,CAAC,mBAAiB,CAAI,CAAC,cAC5E7B,IAAA,QAAK0B,SAAS,CAAC,+BAA+B,CAAAG,QAAA,cAC1C3B,KAAA,QAAKwB,SAAS,CAAC,uBAAuB,CAAC,aAAW,MAAM,CAAAG,QAAA,eACpD7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM+H,OAAO,CAAC,YAAY,CAAE,CAACnI,SAAS,+DAAAC,MAAA,CAAgEiI,IAAI,GAAK,YAAY,CAAG,+BAA+B,CAAG,kCAAkC,CAAG,CAAA/H,QAAA,CAAC,0BAEvN,CAAQ,CAAC,cACT7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM+H,OAAO,CAAC,QAAQ,CAAE,CAACnI,SAAS,+DAAAC,MAAA,CAAgEiI,IAAI,GAAK,QAAQ,CAAG,+BAA+B,CAAG,kCAAkC,CAAG,CAAA/H,QAAA,CAAC,oBAE/M,CAAQ,CAAC,cACT7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM+H,OAAO,CAAC,OAAO,CAAE,CAACnI,SAAS,+DAAAC,MAAA,CAAgEiI,IAAI,GAAK,OAAO,CAAG,+BAA+B,CAAG,kCAAkC,CAAG,CAAA/H,QAAA,CAAC,mBAE7M,CAAQ,CAAC,EACR,CAAC,CACL,CAAC,CAEL+H,IAAI,GAAK,YAAY,eAClB1J,KAAA,QAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,uCAAuC,CAAAG,QAAA,CAAC,kCAAgC,CAAI,CAAC,CAC1F2C,OAAO,cAAGxE,IAAA,MAAA6B,QAAA,CAAG,uBAAqB,CAAG,CAAC,cACnC7B,IAAA,CAACqnB,oBAAoB,EAACvd,QAAQ,CAAEA,QAAS,CAACwd,QAAQ,CAAEJ,oBAAqB,CAAE,CAAC,EAE/E,CACR,CACAtd,IAAI,GAAK,QAAQ,eAAI5J,IAAA,CAACunB,YAAY,EAACC,WAAW,CAAC,SAAS,CAACF,QAAQ,CAAEA,CAAA,GAAM,CAAC,CAAE,CAAE,CAAC,CAC/E1d,IAAI,GAAK,OAAO,eAAI5J,IAAA,CAACunB,YAAY,EAACC,WAAW,CAAC,WAAW,CAACF,QAAQ,CAAEA,CAAA,GAAM,CAAC,CAAE,CAAE,CAAC,EAChF,CAAC,CAEd,CAAC,CAED;AACA,KAAM,CAAAD,oBAAoB,CAAGI,MAAA,EAA4B,IAA3B,CAAE3d,QAAQ,CAAEwd,QAAS,CAAC,CAAAG,MAAA,CAChD,KAAM,CAACnW,YAAY,CAAEC,eAAe,CAAC,CAAGlU,QAAQ,CAAC,IAAI,CAAC,CACtD,KAAM,CAACqU,UAAU,CAAEC,aAAa,CAAC,CAAGtU,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAACuU,WAAW,CAAEC,cAAc,CAAC,CAAGxU,QAAQ,CAAC,CAAC,CAAC,CACjD,KAAM,CAACyU,YAAY,CAAEC,eAAe,CAAC,CAAG1U,QAAQ,CAAC,EAAE,CAAC,CAEpD,KAAM,CAAAqqB,mBAAmB,CAAGC,MAAA,EAAuC,KAAAC,sBAAA,IAAtC,CAAE3jB,OAAO,CAAE5C,OAAO,CAAE4R,WAAY,CAAC,CAAA0U,MAAA,CAC1D,KAAM,CAAChN,IAAI,CAAEkN,OAAO,CAAC,CAAGxqB,QAAQ,CAAC,QAAQ,CAAC,CAC1C,KAAM,CAACyqB,aAAa,CAAEC,gBAAgB,CAAC,CAAG1qB,QAAQ,CAAC,CAAEyV,KAAK,CAAE,EAAE,CAAE6L,KAAK,CAAE1a,OAAO,CAACuI,uBAAuB,EAAI,EAAE,CAAEiS,YAAY,CAAE,GAAI,CAAA7Y,IAAI,CAAC,CAAC,CAAC2G,WAAW,CAAC,CAAC,CAAC1I,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAE,CAAC,CAAC,CACrK,KAAM,CAACmkB,WAAW,CAAEC,cAAc,CAAC,CAAG5qB,QAAQ,CAAC,CAAE6qB,OAAO,CAAE,IAAI,CAAEC,OAAO,CAAE,IAAK,CAAC,CAAC,CAChF,KAAM,CAACC,eAAe,CAAEC,kBAAkB,CAAC,CAAGhrB,QAAQ,CAAC,CAAEyV,KAAK,CAAE,EAAE,CAAE6L,KAAK,CAAE1a,OAAO,CAACwI,cAAc,EAAI,EAAE,CAAEgS,YAAY,CAAE,GAAI,CAAA7Y,IAAI,CAAC,CAAC,CAAC2G,WAAW,CAAC,CAAC,CAAC1I,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAE,CAAC,CAAC,CAChK,KAAM,CAACykB,aAAa,CAAEC,gBAAgB,CAAC,CAAGlrB,QAAQ,CAAC,CAAE6qB,OAAO,CAAE,IAAI,CAAEC,OAAO,CAAE,IAAK,CAAC,CAAC,CACpF,KAAM,CAACK,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGprB,QAAQ,CAAC,EAAE,CAAC,CAC5D,KAAM,CAACqrB,uBAAuB,CAAEC,0BAA0B,CAAC,CAAGtrB,QAAQ,CAAC,EAAE,CAAC,CAC1E,KAAM,CAACurB,yBAAyB,CAAEC,4BAA4B,CAAC,CAAGxrB,QAAQ,CAAC,EAAE,CAAC,CAC9E,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACmE,KAAK,CAAEoD,QAAQ,CAAC,CAAGvH,QAAQ,CAAC,EAAE,CAAC,CAEtC,KAAM,CAAAiQ,kBAAkB,EAAAsa,sBAAA,CAAG3jB,OAAO,CAAC2M,eAAe,UAAAgX,sBAAA,iBAAvBA,sBAAA,CAAyBna,WAAW,CAAC,CAAC,CAAC8G,QAAQ,CAAC,UAAU,CAAC,CAEtFjX,SAAS,CAAC,IAAM,CACZ,GAAIqd,IAAI,GAAK,MAAM,CAAE,CACjB,KAAM,CAAA9V,CAAC,CAAG7G,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,UAAU,CAAC,CAAErC,OAAO,CAAC,cAAc,CAAE,MAAM,CAAC,CAAC,CAC5E,KAAM,CAAAqG,WAAW,CAAGzG,UAAU,CAACuG,CAAC,CAAG6J,QAAQ,EAAK,CAC5C+Z,mBAAmB,CAAC/Z,QAAQ,CAACzJ,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAML,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAE,CAAC,CAAC,CAChF,CAAC,CAAC,CACF,MAAO,IAAML,WAAW,CAAC,CAAC,CAC9B,CACJ,CAAC,CAAE,CAAC4V,IAAI,CAAC,CAAC,CAEV;AACA,KAAM,CAAAzR,YAAY,CAAI4f,MAAM,EAAMjmB,CAAC,EAAK,CACpC,KAAM,CAAEiD,IAAI,CAAEnD,KAAM,CAAC,CAAGE,CAAC,CAACC,MAAM,CAChCgmB,MAAM,CAAC3f,IAAI,EAAAhE,aAAA,CAAAA,aAAA,IAAUgE,IAAI,MAAE,CAACrD,IAAI,EAAGnD,KAAK,EAAG,CAAC,CAChD,CAAC,CAED,KAAM,CAAA4C,gBAAgB,CAAIujB,MAAM,EAAMjmB,CAAC,EAAK,CACxC,KAAM,CAAEiD,IAAI,CAAEN,KAAK,CAAE8I,UAAW,CAAC,CAAGzL,CAAC,CAACC,MAAM,CAC5C,GAAIwL,UAAU,CAAC,CAAC,CAAC,CAAEwa,MAAM,CAAC3f,IAAI,EAAAhE,aAAA,CAAAA,aAAA,IAAUgE,IAAI,MAAE,CAACrD,IAAI,EAAGwI,UAAU,CAAC,CAAC,CAAC,EAAG,CAAC,CAC3E,CAAC,CAED,KAAM,CAAAC,UAAU,CAAG,KAAAA,CAAOC,IAAI,CAAEC,IAAI,GAAK,CACrC,GAAI,CAACD,IAAI,CAAE,MAAO,KAAI,CACtB,KAAM,CAAA7I,UAAU,CAAG5G,GAAG,CAACiC,OAAO,CAAEyN,IAAI,CAAC,CACrC,KAAM,CAAA1I,UAAU,CAAG/G,oBAAoB,CAAC2G,UAAU,CAAE6I,IAAI,CAAC,CACzD,MAAO,CAAAvP,cAAc,CAAC,CAAC,KAAM,CAAA8G,UAAU,EAAEhH,GAAG,CAAC,CACjD,CAAC,CAED,KAAM,CAAAmU,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC3BzO,UAAU,CAAC,IAAI,CAAC,CAChBG,QAAQ,CAAC,EAAE,CAAC,CACZ,GAAI,CACA,KAAM,CAAA4P,UAAU,CAAGrW,GAAG,CAAC4C,EAAE,CAAE,WAAW,CAAEkD,OAAO,CAACa,EAAE,CAAC,CACnD,KAAM,CAAAyO,aAAa,CAAG,CAAC,CAAC,CACxB,GAAI,CAAAwV,sBAAsB,CAAG9kB,OAAO,CAAC+kB,kBAAkB,EAAI,EAAE,CAC7D,GAAI,CAAAC,wBAAwB,CAAGhlB,OAAO,CAACilB,oBAAoB,EAAI,EAAE,CAEjE,GAAIvO,IAAI,GAAK,QAAQ,CAAE,CACnB,GAAIqN,WAAW,CAACE,OAAO,EAAIF,WAAW,CAACG,OAAO,EAAIL,aAAa,CAAChV,KAAK,CAAE,CACnE,KAAM,CAAAqW,MAAM,CAAG,KAAM,CAAA5a,UAAU,CAACyZ,WAAW,CAACE,OAAO,sBAAAvmB,MAAA,CAAuBsC,OAAO,CAACa,EAAE,MAAAnD,MAAA,CAAIqmB,WAAW,CAACE,OAAO,CAACpiB,IAAI,CAAE,CAAC,CACnH,KAAM,CAAAsjB,MAAM,CAAG,KAAM,CAAA7a,UAAU,CAACyZ,WAAW,CAACG,OAAO,sBAAAxmB,MAAA,CAAuBsC,OAAO,CAACa,EAAE,MAAAnD,MAAA,CAAIqmB,WAAW,CAACG,OAAO,CAACriB,IAAI,CAAE,CAAC,CACnH,KAAM,CAAAujB,aAAa,CAAG,KAAM,CAAAtrB,MAAM,CAACD,UAAU,CAACiD,EAAE,CAAE,UAAU,CAAC,CAAE,CAC3Dyd,IAAI,CAAE,SAAS,CAAE8K,UAAU,CAAErlB,OAAO,CAACa,EAAE,CAAEgO,KAAK,CAAEgV,aAAa,CAAChV,KAAK,CAAE6L,KAAK,CAAE1N,MAAM,CAAC6W,aAAa,CAACnJ,KAAK,CAAC,CACvGF,YAAY,CAAEjgB,SAAS,CAACmS,QAAQ,CAAC,GAAI,CAAA/K,IAAI,CAACkiB,aAAa,CAACrJ,YAAY,CAAC,CAAC,CAAE5N,MAAM,CAAE,WAAW,CAAEsY,MAAM,CAAEC,MAAM,CAC3Gxd,aAAa,CAAE3H,OAAO,CAAC2H,aAC3B,CAAC,CAAC,CACFmd,sBAAsB,CAACxQ,IAAI,CAAC8Q,aAAa,CAACvkB,EAAE,CAAC,CAC7CyO,aAAa,CAACyV,kBAAkB,CAAGD,sBAAsB,CAC7D,CACA,GAAI,CAACzb,kBAAkB,EAAIgb,aAAa,CAACJ,OAAO,EAAII,aAAa,CAACH,OAAO,EAAIC,eAAe,CAACtV,KAAK,CAAE,CAChG,KAAM,CAAAqW,MAAM,CAAG,KAAM,CAAA5a,UAAU,CAAC+Z,aAAa,CAACJ,OAAO,yBAAAvmB,MAAA,CAA0BsC,OAAO,CAACa,EAAE,MAAAnD,MAAA,CAAI2mB,aAAa,CAACJ,OAAO,CAACpiB,IAAI,CAAE,CAAC,CAC1H,KAAM,CAAAsjB,MAAM,CAAG,KAAM,CAAA7a,UAAU,CAAC+Z,aAAa,CAACH,OAAO,yBAAAxmB,MAAA,CAA0BsC,OAAO,CAACa,EAAE,MAAAnD,MAAA,CAAI2mB,aAAa,CAACH,OAAO,CAACriB,IAAI,CAAE,CAAC,CAC1H,KAAM,CAAAujB,aAAa,CAAG,KAAM,CAAAtrB,MAAM,CAACD,UAAU,CAACiD,EAAE,CAAE,UAAU,CAAC,CAAE,CAC3Dyd,IAAI,CAAE,WAAW,CAAE8K,UAAU,CAAErlB,OAAO,CAACa,EAAE,CAAEgO,KAAK,CAAEsV,eAAe,CAACtV,KAAK,CAAE6L,KAAK,CAAE1N,MAAM,CAACmX,eAAe,CAACzJ,KAAK,CAAC,CAC7GF,YAAY,CAAEjgB,SAAS,CAACmS,QAAQ,CAAC,GAAI,CAAA/K,IAAI,CAACwiB,eAAe,CAAC3J,YAAY,CAAC,CAAC,CAAE5N,MAAM,CAAE,WAAW,CAAEsY,MAAM,CAAEC,MAAM,CAC7GxY,eAAe,CAAE3M,OAAO,CAAC2M,eAC7B,CAAC,CAAC,CACFqY,wBAAwB,CAAC1Q,IAAI,CAAC8Q,aAAa,CAACvkB,EAAE,CAAC,CAC/CyO,aAAa,CAAC2V,oBAAoB,CAAGD,wBAAwB,CACjE,CACJ,CAAC,IAAM,CAAE;AACL,GAAIP,uBAAuB,CAAE,CACzB,KAAM,CAAArqB,SAAS,CAACF,GAAG,CAAC4C,EAAE,CAAE,UAAU,CAAE2nB,uBAAuB,CAAC,CAAE,CAAEa,YAAY,CAAE1qB,UAAU,CAACoF,OAAO,CAACa,EAAE,CAAE,CAAC,CAAC,CACvGikB,sBAAsB,CAACxQ,IAAI,CAACmQ,uBAAuB,CAAC,CACpDnV,aAAa,CAACyV,kBAAkB,CAAGnqB,UAAU,CAAC6pB,uBAAuB,CAAC,CAC1E,CACA,GAAIE,yBAAyB,EAAI,CAACtb,kBAAkB,CAAE,CAClD,KAAM,CAAAjP,SAAS,CAACF,GAAG,CAAC4C,EAAE,CAAE,UAAU,CAAE6nB,yBAAyB,CAAC,CAAE,CAAEW,YAAY,CAAE1qB,UAAU,CAACoF,OAAO,CAACa,EAAE,CAAE,CAAC,CAAC,CACzGmkB,wBAAwB,CAAC1Q,IAAI,CAACqQ,yBAAyB,CAAC,CACxDrV,aAAa,CAAC2V,oBAAoB,CAAGrqB,UAAU,CAAC+pB,yBAAyB,CAAC,CAC9E,CACJ,CAEA,KAAM,CAAAY,oBAAoB,CAAGT,sBAAsB,CAACjiB,MAAM,CAAG,CAAC,CAC9D,KAAM,CAAA2iB,sBAAsB,CAAGnc,kBAAkB,EAAI2b,wBAAwB,CAACniB,MAAM,CAAG,CAAC,CAExF,GAAI0iB,oBAAoB,EAAIC,sBAAsB,CAAE,CAChDlW,aAAa,CAAC1C,MAAM,CAAG,WAAW,CACtC,CAEA,GAAI2C,MAAM,CAACC,IAAI,CAACF,aAAa,CAAC,CAACzM,MAAM,CAAG,CAAC,CAAE,CACvC,KAAM,CAAAzI,SAAS,CAACmW,UAAU,CAAEjB,aAAa,CAAC,CAC9C,CAEAN,WAAW,CAAC,CAAC,CACb5R,OAAO,CAAC,CAAC,CAEb,CAAE,MAAOgE,GAAG,CAAE,CACVC,OAAO,CAAC9D,KAAK,CAAC,8BAA8B,CAAE6D,GAAG,CAAC,CAClDT,QAAQ,CAAC,yCAAyC,CAAC,CACnDH,UAAU,CAAC,KAAK,CAAC,CACrB,CACJ,CAAC,CAED,mBACIzE,IAAA,QAAK0B,SAAS,CAAC,gFAAgF,CAAAG,QAAA,cAC3F3B,KAAA,QAAKwB,SAAS,CAAC,oDAAoD,CAAAG,QAAA,eAC/D3B,KAAA,OAAIwB,SAAS,CAAC,wBAAwB,CAAAG,QAAA,EAAC,sBAAoB,CAACoC,OAAO,CAAC4C,GAAG,EAAK,CAAC,cAE7E7G,IAAA,QAAK0B,SAAS,CAAC,eAAe,CAAAG,QAAA,cAC1B3B,KAAA,QAAKwB,SAAS,CAAC,uBAAuB,CAAAG,QAAA,eAClC7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM+lB,OAAO,CAAC,QAAQ,CAAE,CAACnmB,SAAS,6CAAAC,MAAA,CAA8CgZ,IAAI,GAAK,QAAQ,CAAG,iBAAiB,CAAG,oBAAoB,CAAG,CAAA9Y,QAAA,CAAC,qBAAmB,CAAQ,CAAC,cAC7L7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAM+lB,OAAO,CAAC,MAAM,CAAE,CAACnmB,SAAS,6CAAAC,MAAA,CAA8CgZ,IAAI,GAAK,MAAM,CAAG,iBAAiB,CAAG,oBAAoB,CAAG,CAAA9Y,QAAA,CAAC,2BAAyB,CAAQ,CAAC,EAC9L,CAAC,CACL,CAAC,CAEL8Y,IAAI,GAAK,QAAQ,eACdza,KAAA,QAAKwB,SAAS,qBAAAC,MAAA,CAAsB,CAAC2L,kBAAkB,CAAG,gBAAgB,CAAG,EAAE,UAAS,CAAAzL,QAAA,eACpF3B,KAAA,QAAKwB,SAAS,CAAC,iCAAiC,CAAAG,QAAA,eAC5C7B,IAAA,OAAI0B,SAAS,CAAC,6BAA6B,CAAAG,QAAA,CAAC,mBAAiB,CAAI,CAAC,CACjEoC,OAAO,CAAC0S,gBAAgB,cAAG3W,IAAA,MAAG0B,SAAS,CAAC,gBAAgB,CAAAG,QAAA,CAAC,8BAAuB,CAAG,CAAC,cAAG3B,KAAA,CAAAE,SAAA,EAAAyB,QAAA,eACpF7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,OAAO,CAAC/C,WAAW,CAAC,eAAe,CAACJ,KAAK,CAAEmlB,aAAa,CAAChV,KAAM,CAAClQ,QAAQ,CAAEsG,YAAY,CAAC6e,gBAAgB,CAAE,CAACrmB,SAAS,CAAC,oCAAoC,CAAC,CAAC,cAClL1B,IAAA,UAAOoB,IAAI,CAAC,QAAQ,CAAC0E,IAAI,CAAC,OAAO,CAAC/C,WAAW,CAAC,OAAO,CAACJ,KAAK,CAAEmlB,aAAa,CAACnJ,KAAM,CAAC/b,QAAQ,CAAEsG,YAAY,CAAC6e,gBAAgB,CAAE,CAACrmB,SAAS,CAAC,oCAAoC,CAAC,CAAC,cAC5K1B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,cAAc,CAACnD,KAAK,CAAEmlB,aAAa,CAACrJ,YAAa,CAAC7b,QAAQ,CAAEsG,YAAY,CAAC6e,gBAAgB,CAAE,CAACrmB,SAAS,CAAC,oCAAoC,CAAC,CAAC,cACpK1B,IAAA,UAAO0B,SAAS,CAAC,SAAS,CAAAG,QAAA,CAAC,MAAI,CAAO,CAAC,cAAA7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,SAAS,CAACihB,MAAM,CAAC,MAAM,CAACnkB,QAAQ,CAAE2C,gBAAgB,CAAC0iB,cAAc,CAAE,CAACvmB,SAAS,CAAC,sBAAsB,CAAC,CAAC,cACrK1B,IAAA,UAAO0B,SAAS,CAAC,SAAS,CAAAG,QAAA,CAAC,MAAI,CAAO,CAAC,cAAA7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,SAAS,CAACihB,MAAM,CAAC,MAAM,CAACnkB,QAAQ,CAAE2C,gBAAgB,CAAC0iB,cAAc,CAAE,CAACvmB,SAAS,CAAC,sBAAsB,CAAC,CAAC,EACvK,CAAC,EACF,CAAC,CACL,CAAC4L,kBAAkB,eAChBpN,KAAA,QAAKwB,SAAS,CAAC,iCAAiC,CAAAG,QAAA,eAC5C7B,IAAA,OAAI0B,SAAS,CAAC,6BAA6B,CAAAG,QAAA,CAAC,sBAAoB,CAAI,CAAC,CACpEoC,OAAO,CAAC2S,kBAAkB,cAAG5W,IAAA,MAAG0B,SAAS,CAAC,gBAAgB,CAAAG,QAAA,CAAC,8BAAuB,CAAG,CAAC,cAAG3B,KAAA,CAAAE,SAAA,EAAAyB,QAAA,eACtF7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,OAAO,CAAC/C,WAAW,CAAC,eAAe,CAACJ,KAAK,CAAEylB,eAAe,CAACtV,KAAM,CAAClQ,QAAQ,CAAEsG,YAAY,CAACmf,kBAAkB,CAAE,CAAC3mB,SAAS,CAAC,oCAAoC,CAAC,CAAC,cACtL1B,IAAA,UAAOoB,IAAI,CAAC,QAAQ,CAAC0E,IAAI,CAAC,OAAO,CAAC/C,WAAW,CAAC,OAAO,CAACJ,KAAK,CAAEylB,eAAe,CAACzJ,KAAM,CAAC/b,QAAQ,CAAEsG,YAAY,CAACmf,kBAAkB,CAAE,CAAC3mB,SAAS,CAAC,oCAAoC,CAAC,CAAC,cAChL1B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,cAAc,CAACnD,KAAK,CAAEylB,eAAe,CAAC3J,YAAa,CAAC7b,QAAQ,CAAEsG,YAAY,CAACmf,kBAAkB,CAAE,CAAC3mB,SAAS,CAAC,oCAAoC,CAAC,CAAC,cACxK1B,IAAA,UAAO0B,SAAS,CAAC,SAAS,CAAAG,QAAA,CAAC,MAAI,CAAO,CAAC,cAAA7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,SAAS,CAACihB,MAAM,CAAC,MAAM,CAACnkB,QAAQ,CAAE2C,gBAAgB,CAACgjB,gBAAgB,CAAE,CAAC7mB,SAAS,CAAC,sBAAsB,CAAC,CAAC,cACvK1B,IAAA,UAAO0B,SAAS,CAAC,SAAS,CAAAG,QAAA,CAAC,MAAI,CAAO,CAAC,cAAA7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,SAAS,CAACihB,MAAM,CAAC,MAAM,CAACnkB,QAAQ,CAAE2C,gBAAgB,CAACgjB,gBAAgB,CAAE,CAAC7mB,SAAS,CAAC,sBAAsB,CAAC,CAAC,EACzK,CAAC,EACF,CACR,EACA,CACR,CAEAiZ,IAAI,GAAK,MAAM,eACZza,KAAA,QAAKwB,SAAS,qBAAAC,MAAA,CAAsB,CAAC2L,kBAAkB,CAAG,gBAAgB,CAAG,EAAE,UAAS,CAAAzL,QAAA,eACpF3B,KAAA,QAAKwB,SAAS,CAAC,iCAAiC,CAAAG,QAAA,eAC5C7B,IAAA,OAAI0B,SAAS,CAAC,6BAA6B,CAAAG,QAAA,CAAC,4BAA0B,CAAI,CAAC,cAC3E3B,KAAA,WAAQyC,KAAK,CAAE+lB,uBAAwB,CAAC9lB,QAAQ,CAAGC,CAAC,EAAK8lB,0BAA0B,CAAC9lB,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACjB,SAAS,CAAC,oCAAoC,CAAAG,QAAA,eAC/I7B,IAAA,WAAQ2C,KAAK,CAAC,EAAE,CAAAd,QAAA,CAAC,2BAAyB,CAAQ,CAAC,CAClD2mB,gBAAgB,CAACld,MAAM,CAACgT,GAAG,EAAIA,GAAG,CAACE,IAAI,GAAK,SAAS,CAAC,CAACtZ,GAAG,CAACoZ,GAAG,eAC3Dte,IAAA,WAAqB2C,KAAK,CAAE2b,GAAG,CAACxZ,EAAG,CAAAjD,QAAA,WAAAF,MAAA,CACpB2c,GAAG,CAACxL,KAAK,QAAAnR,MAAA,CAAM2c,GAAG,CAAC1S,aAAa,SAAAjK,MAAA,CAAO2c,GAAG,CAACK,KAAK,CAACjI,OAAO,CAAC,CAAC,CAAC,GAD7D4H,GAAG,CAACxZ,EAET,CACX,CAAC,EACE,CAAC,EACR,CAAC,CACL,CAACwI,kBAAkB,eAChBpN,KAAA,QAAKwB,SAAS,CAAC,iCAAiC,CAAAG,QAAA,eAC5C7B,IAAA,OAAI0B,SAAS,CAAC,6BAA6B,CAAAG,QAAA,CAAC,8BAA4B,CAAI,CAAC,cAC7E3B,KAAA,WAAQyC,KAAK,CAAEimB,yBAA0B,CAAChmB,QAAQ,CAAGC,CAAC,EAAKgmB,4BAA4B,CAAChmB,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACjB,SAAS,CAAC,oCAAoC,CAAAG,QAAA,eACnJ7B,IAAA,WAAQ2C,KAAK,CAAC,EAAE,CAAAd,QAAA,CAAC,2BAAyB,CAAQ,CAAC,CAClD2mB,gBAAgB,CAACld,MAAM,CAACgT,GAAG,EAAIA,GAAG,CAACE,IAAI,GAAK,WAAW,CAAC,CAACtZ,GAAG,CAACoZ,GAAG,eAC7Dte,IAAA,WAAqB2C,KAAK,CAAE2b,GAAG,CAACxZ,EAAG,CAAAjD,QAAA,WAAAF,MAAA,CACpB2c,GAAG,CAACxL,KAAK,QAAAnR,MAAA,CAAM2c,GAAG,CAAC1N,eAAe,SAAAjP,MAAA,CAAO2c,GAAG,CAACK,KAAK,CAACjI,OAAO,CAAC,CAAC,CAAC,GAD/D4H,GAAG,CAACxZ,EAET,CACX,CAAC,EACE,CAAC,EACR,CACR,EACA,CACR,cAED9E,IAAA,CAACiB,KAAK,EAACE,OAAO,CAAEK,KAAM,CAACJ,IAAI,CAAC,OAAO,CAACC,OAAO,CAAEA,CAAA,GAAMuD,QAAQ,CAAC,EAAE,CAAE,CAAE,CAAC,cACnE1E,KAAA,QAAKwB,SAAS,CAAC,iCAAiC,CAAAG,QAAA,eAC5C7B,IAAA,WAAQ8B,OAAO,CAAET,OAAQ,CAACK,SAAS,CAAC,uDAAuD,CAAAG,QAAA,CAAC,UAAQ,CAAQ,CAAC,cAC7G7B,IAAA,WAAQ8B,OAAO,CAAEoR,UAAW,CAACxR,SAAS,CAAC,qDAAqD,CAAAG,QAAA,CAAE2C,OAAO,CAAG,cAAc,CAAG,iBAAiB,CAAS,CAAC,EACnJ,CAAC,EACL,CAAC,CACL,CAAC,CAEd,CAAC,CAED,KAAM,CAAAsQ,gBAAgB,CAAGhL,QAAQ,CAACwB,MAAM,CAACC,CAAC,EAAKA,CAAC,CAAC1E,GAAG,EAAI0E,CAAC,CAAC1E,GAAG,CAAC4G,WAAW,CAAC,CAAC,CAAC8G,QAAQ,CAAC7C,UAAU,CAACjE,WAAW,CAAC,CAAC,CAAC,EAAMlC,CAAC,CAACK,aAAa,EAAIL,CAAC,CAACK,aAAa,CAAC6B,WAAW,CAAC,CAAC,CAAC8G,QAAQ,CAAC7C,UAAU,CAACjE,WAAW,CAAC,CAAC,CAAE,EAAKlC,CAAC,CAACM,cAAc,EAAIN,CAAC,CAACM,cAAc,CAAC4B,WAAW,CAAC,CAAC,CAAC8G,QAAQ,CAAC7C,UAAU,CAACjE,WAAW,CAAC,CAAC,CAAE,CAAC,CACpS,KAAM,CAAAsH,YAAY,CAAGD,gBAAgB,CAACxL,KAAK,CAAC,CAACsI,WAAW,CAAG,CAAC,EAAIE,YAAY,CAAEF,WAAW,CAAGE,YAAY,CAAC,CACzG,KAAM,CAAAkD,UAAU,CAAGC,IAAI,CAACC,IAAI,CAACJ,gBAAgB,CAAChO,MAAM,CAAGgL,YAAY,CAAC,CACpE,KAAM,CAAAqD,QAAQ,CAAIC,UAAU,EAAKvD,cAAc,CAACuD,UAAU,CAAC,CAE3D,mBACIlV,KAAA,CAAAE,SAAA,EAAAyB,QAAA,eACI3B,KAAA,QAAKwB,SAAS,CAAC,6DAA6D,CAAAG,QAAA,eACxE7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC2B,WAAW,CAAC,uCAAuC,CAACrB,SAAS,CAAC,0EAA0E,CAACkB,QAAQ,CAAGC,CAAC,EAAK,CAAE8O,aAAa,CAAC9O,CAAC,CAACC,MAAM,CAACH,KAAK,CAAC,CAAEkP,cAAc,CAAC,CAAC,CAAC,CAAE,CAAE,CAAC,CAAC,cACrO3R,KAAA,QAAKwB,SAAS,CAAC,mBAAmB,CAAAG,QAAA,eAC9B7B,IAAA,SAAM0B,SAAS,CAAC,cAAc,CAAAG,QAAA,CAAC,UAAQ,CAAM,CAAC,cAC9C3B,KAAA,WAAQyC,KAAK,CAAEmP,YAAa,CAAClP,QAAQ,CAAGC,CAAC,EAAK,CAAEkP,eAAe,CAACd,MAAM,CAACpO,CAAC,CAACC,MAAM,CAACH,KAAK,CAAC,CAAC,CAAEkP,cAAc,CAAC,CAAC,CAAC,CAAE,CAAE,CAACnQ,SAAS,CAAC,6CAA6C,CAAAG,QAAA,eAClK7B,IAAA,WAAQ2C,KAAK,CAAE,EAAG,CAAAd,QAAA,CAAC,IAAE,CAAQ,CAAC,cAAA7B,IAAA,WAAQ2C,KAAK,CAAE,EAAG,CAAAd,QAAA,CAAC,IAAE,CAAQ,CAAC,cAAA7B,IAAA,WAAQ2C,KAAK,CAAE,EAAG,CAAAd,QAAA,CAAC,IAAE,CAAQ,CAAC,EACtF,CAAC,EACR,CAAC,EACL,CAAC,cACN7B,IAAA,QAAK0B,SAAS,CAAC,4CAA4C,CAAAG,QAAA,cACvD3B,KAAA,UAAOwB,SAAS,CAAC,qCAAqC,CAAAG,QAAA,eAClD7B,IAAA,UAAO0B,SAAS,CAAC,YAAY,CAAAG,QAAA,cACzB3B,KAAA,OAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,KAAG,CAAI,CAAC,cACxF7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,SAAO,CAAI,CAAC,cAC5F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,UAAQ,CAAI,CAAC,cAC7F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,YAAU,CAAI,CAAC,cAC/F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,iBAAe,CAAI,CAAC,cACpG7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,mBAAiB,CAAI,CAAC,cACtG7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,UAAQ,CAAI,CAAC,EAC7F,CAAC,CACF,CAAC,cACR7B,IAAA,UAAO0B,SAAS,CAAC,mCAAmC,CAAAG,QAAA,CAC/CkT,YAAY,CAAC7P,GAAG,CAACjB,OAAO,OAAAylB,sBAAA,oBACpBxpB,KAAA,OAAA2B,QAAA,eACG7B,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,CAAEoC,OAAO,CAAC4C,GAAG,CAAK,CAAC,cAC5C7G,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,CAAEoC,OAAO,CAAC2H,aAAa,CAAK,CAAC,cACtD5L,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,CAAEoC,OAAO,CAAC4H,cAAc,CAAK,CAAC,cACvD7L,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,cAAC3B,KAAA,QAAKwB,SAAS,CAAC,wBAAwB,CAAAG,QAAA,EAAEoC,OAAO,CAAC8K,oBAAoB,eAAI/O,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAAC8K,oBAAqB,CAACjM,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAC,OAAK,CAAG,CAAC,CAAEoC,OAAO,CAAC+K,YAAY,eAAIhP,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAAC+K,YAAa,CAAClM,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAC,MAAI,CAAG,CAAC,EAAM,CAAC,CAAI,CAAC,cACxW7B,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,CAAEoC,OAAO,CAAC0S,gBAAgB,cAAG3W,IAAA,SAAM0B,SAAS,CAAC,gBAAgB,CAAAG,QAAA,CAAC,kBAAW,CAAM,CAAC,cAAG7B,IAAA,SAAM0B,SAAS,CAAC,iBAAiB,CAAAG,QAAA,CAAC,WAAS,CAAM,CAAC,CAAK,CAAC,cACpK7B,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,CAAE,CAAA6nB,sBAAA,CAAAzlB,OAAO,CAAC2M,eAAe,UAAA8Y,sBAAA,WAAvBA,sBAAA,CAAyBjc,WAAW,CAAC,CAAC,CAAC8G,QAAQ,CAAC,UAAU,CAAC,cAAGvU,IAAA,SAAM0B,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAC,KAAG,CAAM,CAAC,CAAGoC,OAAO,CAAC2S,kBAAkB,cAAG5W,IAAA,SAAM0B,SAAS,CAAC,gBAAgB,CAAAG,QAAA,CAAC,kBAAW,CAAM,CAAC,cAAG7B,IAAA,SAAM0B,SAAS,CAAC,iBAAiB,CAAAG,QAAA,CAAC,WAAS,CAAM,CAAC,CAAK,CAAC,cACjR7B,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,cAAC7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMyP,eAAe,CAACtN,OAAO,CAAE,CAACvC,SAAS,CAAC,uCAAuC,CAAAG,QAAA,CAAC,oBAAkB,CAAQ,CAAC,CAAI,CAAC,GAPvJoC,OAAO,CAACa,EAQd,CAAC,EACR,CAAC,CACC,CAAC,EACL,CAAC,CACP,CAAC,cACN5E,KAAA,QAAKwB,SAAS,CAAC,wCAAwC,CAAAG,QAAA,eACnD3B,KAAA,SAAMwB,SAAS,CAAC,uBAAuB,CAAAG,QAAA,EAAC,YAAO,CAAC+P,WAAW,CAAC,MAAI,CAACoD,UAAU,EAAO,CAAC,cACnF9U,KAAA,QAAA2B,QAAA,eACI7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMqT,QAAQ,CAACvD,WAAW,CAAG,CAAC,CAAE,CAAC1K,QAAQ,CAAE0K,WAAW,GAAK,CAAE,CAAClQ,SAAS,CAAC,+DAA+D,CAAAG,QAAA,CAAC,UAAQ,CAAQ,CAAC,cAC1K7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMqT,QAAQ,CAACvD,WAAW,CAAG,CAAC,CAAE,CAAC1K,QAAQ,CAAE0K,WAAW,GAAKoD,UAAU,EAAIA,UAAU,GAAK,CAAE,CAACtT,SAAS,CAAC,0DAA0D,CAAAG,QAAA,CAAC,WAAS,CAAQ,CAAC,EAClM,CAAC,EACL,CAAC,CACLyP,YAAY,eAAItR,IAAA,CAAC0nB,mBAAmB,EAACzjB,OAAO,CAAEqN,YAAa,CAACjQ,OAAO,CAAEA,CAAA,GAAMkQ,eAAe,CAAC,IAAI,CAAE,CAAC0B,WAAW,CAAEqU,QAAS,CAAE,CAAC,EAC9H,CAAC,CAEX,CAAC,CAED;AACA,KAAM,CAAAC,YAAY,CAAGoC,MAAA,EAA+B,IAA9B,CAAEnC,WAAW,CAAEF,QAAS,CAAC,CAAAqC,MAAA,CAC3C,KAAM,CAACzM,QAAQ,CAAE0M,WAAW,CAAC,CAAGvsB,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACwsB,YAAY,CAAEC,eAAe,CAAC,CAAGzsB,QAAQ,CAAC,KAAK,CAAC,CACvD,KAAM,CAAC0sB,YAAY,CAAEC,eAAe,CAAC,CAAG3sB,QAAQ,CAAC,IAAI,CAAC,CACtD,KAAM,CAACqU,UAAU,CAAEC,aAAa,CAAC,CAAGtU,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAACuU,WAAW,CAAEC,cAAc,CAAC,CAAGxU,QAAQ,CAAC,CAAC,CAAC,CACjD,KAAM,CAACyU,YAAY,CAAEC,eAAe,CAAC,CAAG1U,QAAQ,CAAC,EAAE,CAAC,CAEpDC,SAAS,CAAC,IAAM,CACZmH,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAAI,CAAC,CAAG7G,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,UAAU,CAAC,CAAE9C,KAAK,CAAC,MAAM,CAAE,IAAI,CAAEupB,WAAW,CAAC,CAAE9oB,OAAO,CAAC,cAAc,CAAE,MAAM,CAAC,CAAC,CAC9G,KAAM,CAAAqG,WAAW,CAAGzG,UAAU,CAACuG,CAAC,CAAGG,aAAa,EAAK,CACjD4kB,WAAW,CAAC5kB,aAAa,CAACC,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CAAC,CAC3EX,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAC,CACF,MAAO,IAAMM,WAAW,CAAC,CAAC,CAC9B,CAAC,CAAE,CAACyiB,WAAW,CAAC,CAAC,CAEjB,KAAM,CAAAyC,gBAAgB,CAAG/M,QAAQ,CAAC5R,MAAM,CAAC4e,OAAO,EAC3CA,OAAO,CAACpX,KAAK,EAAIoX,OAAO,CAACpX,KAAK,CAACrF,WAAW,CAAC,CAAC,CAAC8G,QAAQ,CAAC7C,UAAU,CAACjE,WAAW,CAAC,CAAC,CAAC,EAC/Eyc,OAAO,CAACte,aAAa,EAAIse,OAAO,CAACte,aAAa,CAAC6B,WAAW,CAAC,CAAC,CAAC8G,QAAQ,CAAC7C,UAAU,CAACjE,WAAW,CAAC,CAAC,CAAE,EAChGyc,OAAO,CAACtZ,eAAe,EAAIsZ,OAAO,CAACtZ,eAAe,CAACnD,WAAW,CAAC,CAAC,CAAC8G,QAAQ,CAAC7C,UAAU,CAACjE,WAAW,CAAC,CAAC,CAAE,EACpGyc,OAAO,CAACC,WAAW,EAAID,OAAO,CAACC,WAAW,CAAC1c,WAAW,CAAC,CAAC,CAAC8G,QAAQ,CAAC7C,UAAU,CAACjE,WAAW,CAAC,CAAC,CAC/F,CAAC,CAED,KAAM,CAAAgW,eAAe,CAAG7R,WAAW,CAAGE,YAAY,CAClD,KAAM,CAAA4R,gBAAgB,CAAGD,eAAe,CAAG3R,YAAY,CACvD,KAAM,CAAAiD,YAAY,CAAGkV,gBAAgB,CAAC3gB,KAAK,CAACoa,gBAAgB,CAAED,eAAe,CAAC,CAC9E,KAAM,CAAAzO,UAAU,CAAGC,IAAI,CAACC,IAAI,CAAC+U,gBAAgB,CAACnjB,MAAM,CAAGgL,YAAY,CAAC,CAEpE,KAAM,CAAAqD,QAAQ,CAAIC,UAAU,EAAKvD,cAAc,CAACuD,UAAU,CAAC,CAE3D,KAAM,CAAAgV,sBAAsB,CAAGC,MAAA,EAA8B,IAA7B,CAAEhpB,OAAO,CAAE4R,WAAY,CAAC,CAAAoX,MAAA,CACpD,KAAM,CAACre,QAAQ,CAAEC,WAAW,CAAC,CAAG5O,QAAQ,CAAC,CAAEyV,KAAK,CAAE,EAAE,CAAE6L,KAAK,CAAE,EAAE,CAAEF,YAAY,CAAE,GAAI,CAAA7Y,IAAI,CAAC,CAAC,CAAC2G,WAAW,CAAC,CAAC,CAAC1I,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAEymB,SAAS,CAAE,EAAE,CAAEH,WAAW,CAAE,EAAG,CAAC,CAAC,CACxJ,KAAM,CAAC3kB,KAAK,CAAEkH,QAAQ,CAAC,CAAGrP,QAAQ,CAAC,CAAE6qB,OAAO,CAAE,IAAI,CAAEC,OAAO,CAAE,IAAK,CAAC,CAAC,CACpE,KAAM,CAACoC,QAAQ,CAAEC,WAAW,CAAC,CAAGntB,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACotB,eAAe,CAAEC,kBAAkB,CAAC,CAAGrtB,QAAQ,CAAC,EAAE,CAAC,CAC1D,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACmE,KAAK,CAAEoD,QAAQ,CAAC,CAAGvH,QAAQ,CAAC,EAAE,CAAC,CAEtCC,SAAS,CAAC,IAAM,CACZ,GAAI,CAAAuH,CAAC,CACL,GAAI2iB,WAAW,GAAK,SAAS,CAAE,CAC3B3iB,CAAC,CAAG7G,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,UAAU,CAAC,CAAE9C,KAAK,CAAC,KAAK,CAAE,IAAI,CAAE,SAAS,CAAC,CAAC,CACxE,CAAC,IAAM,CACH4G,CAAC,CAAG7G,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,aAAa,CAAC,CAAC,CAC5C,CACA7C,OAAO,CAAC2G,CAAC,CAAC,CAAC8lB,IAAI,CAACjc,QAAQ,EAAI,CACxB,KAAM,CAAAkc,UAAU,CAAGlc,QAAQ,CAACzJ,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CAC5E,KAAM,CAAAylB,cAAc,CAAGD,UAAU,CAACvc,IAAI,CAAC,CAACH,CAAC,CAAEC,CAAC,GAAK,CAACD,CAAC,CAACtK,cAAc,EAAIsK,CAAC,CAACV,MAAM,EAAEY,aAAa,CAACD,CAAC,CAACvK,cAAc,EAAIuK,CAAC,CAACX,MAAM,CAAC,CAAC,CAC5Hgd,WAAW,CAACK,cAAc,CAAC,CAC/B,CAAC,CAAC,CACN,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAA3hB,YAAY,CAAIrG,CAAC,EAAK,CACxB,KAAM,CAAEiD,IAAI,CAAEnD,KAAM,CAAC,CAAGE,CAAC,CAACC,MAAM,CAChCmJ,WAAW,CAAC9C,IAAI,EAAAhE,aAAA,CAAAA,aAAA,IAAUgE,IAAI,MAAE,CAACrD,IAAI,EAAGnD,KAAK,EAAG,CAAC,CACrD,CAAC,CAED,KAAM,CAAA4C,gBAAgB,CAAI1C,CAAC,EAAK,CAC5B,KAAM,CAAEiD,IAAI,CAAEN,KAAK,CAAE8I,UAAW,CAAC,CAAGzL,CAAC,CAACC,MAAM,CAC5C,GAAIwL,UAAU,CAAC,CAAC,CAAC,CAAE,CACf5B,QAAQ,CAACvD,IAAI,EAAAhE,aAAA,CAAAA,aAAA,IAAUgE,IAAI,MAAE,CAACrD,IAAI,EAAGwI,UAAU,CAAC,CAAC,CAAC,EAAG,CAAC,CAC1D,CACJ,CAAC,CAED,KAAM,CAAAC,UAAU,CAAG,KAAAA,CAAOC,IAAI,CAAEC,IAAI,GAAK,CACrC,GAAI,CAACD,IAAI,CAAE,MAAO,KAAI,CACtB,KAAM,CAAA7I,UAAU,CAAG5G,GAAG,CAACiC,OAAO,CAAEyN,IAAI,CAAC,CACrC,KAAM,CAAA1I,UAAU,CAAG/G,oBAAoB,CAAC2G,UAAU,CAAE6I,IAAI,CAAC,CACzD,MAAO,CAAAvP,cAAc,CAAC,CAAC,KAAM,CAAA8G,UAAU,EAAEhH,GAAG,CAAC,CACjD,CAAC,CAED,KAAM,CAAAmU,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC3B,GAAI,CAAClH,QAAQ,CAAC8G,KAAK,EAAI,CAAC9G,QAAQ,CAAC2S,KAAK,EAAI,CAACnZ,KAAK,CAAC0iB,OAAO,EAAI,CAAC1iB,KAAK,CAAC2iB,OAAO,EAAKnc,QAAQ,CAACse,SAAS,GAAK,EAAE,EAAKte,QAAQ,CAACse,SAAS,GAAK,MAAM,EAAI,CAACG,eAAiB,CAAE,CAC9J7lB,QAAQ,CAAC,+CAA+C,CAAC,CACzD,OACJ,CACAH,UAAU,CAAC,IAAI,CAAC,CAChB,GAAI,KAAAqmB,cAAA,CAAAC,eAAA,CACA,KAAM,CAAA5B,MAAM,CAAG,KAAM,CAAA5a,UAAU,CAAC/I,KAAK,CAAC0iB,OAAO,aAAAvmB,MAAA,CAAc6lB,WAAW,MAAA7lB,MAAA,CAAIiE,IAAI,CAACC,GAAG,CAAC,CAAC,MAAAlE,MAAA,CAAI6D,KAAK,CAAC0iB,OAAO,CAACpiB,IAAI,CAAE,CAAC,CAC7G,KAAM,CAAAsjB,MAAM,CAAG,KAAM,CAAA7a,UAAU,CAAC/I,KAAK,CAAC2iB,OAAO,aAAAxmB,MAAA,CAAc6lB,WAAW,MAAA7lB,MAAA,CAAIiE,IAAI,CAACC,GAAG,CAAC,CAAC,MAAAlE,MAAA,CAAI6D,KAAK,CAAC2iB,OAAO,CAACriB,IAAI,CAAE,CAAC,CAE7G,KAAM,CAAAklB,UAAU,CAAGhf,QAAQ,CAACse,SAAS,GAAK,MAAM,CAC1CG,eAAe,CACf,EAAAK,cAAA,CAAAP,QAAQ,CAAChd,IAAI,CAAC1K,CAAC,EAAIA,CAAC,CAACiC,EAAE,GAAKkH,QAAQ,CAACse,SAAS,CAAC,UAAAQ,cAAA,iBAA/CA,cAAA,CAAiDlnB,cAAc,KAAAmnB,eAAA,CAAIR,QAAQ,CAAChd,IAAI,CAAC1K,CAAC,EAAIA,CAAC,CAACiC,EAAE,GAAKkH,QAAQ,CAACse,SAAS,CAAC,UAAAS,eAAA,iBAA/CA,eAAA,CAAiDvd,MAAM,EAEhI,KAAM,CAAAzP,MAAM,CAACD,UAAU,CAACiD,EAAE,CAAE,UAAU,CAAC,CAAE,CACrCyd,IAAI,CAAEgJ,WAAW,CACjB8B,UAAU,CAAE,SAAS,CACrBxW,KAAK,CAAE9G,QAAQ,CAAC8G,KAAK,CACrB6L,KAAK,CAAE1N,MAAM,CAACjF,QAAQ,CAAC2S,KAAK,CAAC,CAC7BF,YAAY,CAAEjgB,SAAS,CAACmS,QAAQ,CAAC,GAAI,CAAA/K,IAAI,CAACoG,QAAQ,CAACyS,YAAY,CAAC,CAAC,CACjE5N,MAAM,CAAE,WAAW,CACnBsZ,WAAW,CAAEne,QAAQ,CAACme,WAAW,EAAI,EAAE,CACvChB,MAAM,CACNC,MAAM,CACN,CAAC5B,WAAW,GAAK,SAAS,CAAG,eAAe,CAAG,iBAAiB,EAAGwD,UACvE,CAAC,CAAC,CACF/X,WAAW,CAAC,CAAC,CACb5R,OAAO,CAAC,CAAC,CACb,CAAE,MAAOgE,GAAG,CAAE,CACVC,OAAO,CAAC9D,KAAK,CAAC,mCAAmC,CAAE6D,GAAG,CAAC,CACvDT,QAAQ,CAAC,8BAA8B,CAAC,CACxCH,UAAU,CAAC,KAAK,CAAC,CACrB,CACJ,CAAC,CAED,mBACIzE,IAAA,QAAK0B,SAAS,CAAC,gFAAgF,CAAAG,QAAA,cAC3F3B,KAAA,QAAKwB,SAAS,CAAC,mDAAmD,CAAAG,QAAA,eAC9D3B,KAAA,OAAIwB,SAAS,CAAC,wBAAwB,CAAAG,QAAA,EAAC,6BAAwB,CAAC2lB,WAAW,CAAC,GAAC,EAAI,CAAC,cAClFtnB,KAAA,QAAKwB,SAAS,CAAC,WAAW,CAAAG,QAAA,eACtB3B,KAAA,WAAQyC,KAAK,CAAEqJ,QAAQ,CAACse,SAAU,CAAC1nB,QAAQ,CAAEsG,YAAa,CAACpD,IAAI,CAAC,WAAW,CAACpE,SAAS,CAAC,oCAAoC,CAAAG,QAAA,eACtH3B,KAAA,WAAQyC,KAAK,CAAC,EAAE,CAAAd,QAAA,EAAC,gBAAc,CAAC2lB,WAAW,EAAS,CAAC,CACpD+C,QAAQ,CAACrlB,GAAG,CAACrC,CAAC,eAAI7C,IAAA,WAAmB2C,KAAK,CAAEE,CAAC,CAACiC,EAAG,CAAAjD,QAAA,CAAEgB,CAAC,CAACe,cAAc,EAAIf,CAAC,CAAC2K,MAAM,EAAhD3K,CAAC,CAACiC,EAAuD,CAAC,CAAC,cAC3F9E,IAAA,WAAQ2C,KAAK,CAAC,MAAM,CAAAd,QAAA,CAAC,oBAAkB,CAAQ,CAAC,EAC5C,CAAC,CACRmK,QAAQ,CAACse,SAAS,GAAK,MAAM,eAC1BtqB,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAACuB,KAAK,CAAE8nB,eAAgB,CAAC7nB,QAAQ,CAAGC,CAAC,EAAK6nB,kBAAkB,CAAC7nB,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACI,WAAW,eAAApB,MAAA,CAAgB6lB,WAAW,CAAG,CAAC9lB,SAAS,CAAC,oCAAoC,CAAC,CAC5L,cACD1B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,aAAa,CAAC/C,WAAW,CAAC,uCAAoC,CAACJ,KAAK,CAAEqJ,QAAQ,CAACme,WAAY,CAACvnB,QAAQ,CAAEsG,YAAa,CAACxH,SAAS,CAAC,oCAAoC,CAAC,CAAC,cAC5L1B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,OAAO,CAAC/C,WAAW,CAAC,OAAO,CAACJ,KAAK,CAAEqJ,QAAQ,CAAC8G,KAAM,CAAClQ,QAAQ,CAAEsG,YAAa,CAACxH,SAAS,CAAC,oCAAoC,CAAC,CAAC,cACnJ1B,IAAA,UAAOoB,IAAI,CAAC,QAAQ,CAAC0E,IAAI,CAAC,OAAO,CAAC/C,WAAW,CAAC,OAAO,CAACJ,KAAK,CAAEqJ,QAAQ,CAAC2S,KAAM,CAAC/b,QAAQ,CAAEsG,YAAa,CAACxH,SAAS,CAAC,oCAAoC,CAAC,CAAC,cACrJ1B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,cAAc,CAACnD,KAAK,CAAEqJ,QAAQ,CAACyS,YAAa,CAAC7b,QAAQ,CAAEsG,YAAa,CAACxH,SAAS,CAAC,oCAAoC,CAAC,CAAC,cAC7I1B,IAAA,UAAO0B,SAAS,CAAC,SAAS,CAAAG,QAAA,CAAC,MAAI,CAAO,CAAC,cAAA7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,SAAS,CAACihB,MAAM,CAAC,MAAM,CAACnkB,QAAQ,CAAE2C,gBAAiB,CAAC7D,SAAS,CAAC,sBAAsB,CAAC,CAAC,cACrJ1B,IAAA,UAAO0B,SAAS,CAAC,SAAS,CAAAG,QAAA,CAAC,MAAI,CAAO,CAAC,cAAA7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC0E,IAAI,CAAC,SAAS,CAACihB,MAAM,CAAC,MAAM,CAACnkB,QAAQ,CAAE2C,gBAAiB,CAAC7D,SAAS,CAAC,sBAAsB,CAAC,CAAC,EACpJ,CAAC,cACL1B,IAAA,CAACiB,KAAK,EAACE,OAAO,CAAEK,KAAM,CAACJ,IAAI,CAAC,OAAO,CAACC,OAAO,CAAEA,CAAA,GAAMuD,QAAQ,CAAC,EAAE,CAAE,CAAE,CAAC,cACpE1E,KAAA,QAAKwB,SAAS,CAAC,iCAAiC,CAAAG,QAAA,eAC5C7B,IAAA,WAAQ8B,OAAO,CAAET,OAAQ,CAAAQ,QAAA,CAAC,UAAQ,CAAQ,CAAC,cAC3C7B,IAAA,WAAQ8B,OAAO,CAAEoR,UAAW,CAACxR,SAAS,CAAC,qDAAqD,CAAAG,QAAA,CAAE2C,OAAO,CAAG,cAAc,CAAG,SAAS,CAAS,CAAC,EAC3I,CAAC,EACL,CAAC,CACL,CAAC,CAEd,CAAC,CAED,KAAM,CAAAymB,kBAAkB,CAAGC,MAAA,EAAuC,IAAtC,CAAEhB,OAAO,CAAE7oB,OAAO,CAAE4R,WAAY,CAAC,CAAAiY,MAAA,CACzD,KAAM,CAAClf,QAAQ,CAAEC,WAAW,CAAC,CAAG5O,QAAQ,CAAC,CACrCwhB,gBAAgB,CAAEqL,OAAO,CAACrL,gBAAgB,CAAGqL,OAAO,CAACrL,gBAAgB,CAAC1K,MAAM,CAAC,CAAC,CAAC5H,WAAW,CAAC,CAAC,CAAC1I,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAG,EAAE,CAC/GsnB,aAAa,CAAEjB,OAAO,CAACiB,aAAa,CAAGjB,OAAO,CAACiB,aAAa,CAAChX,MAAM,CAAC,CAAC,CAAC5H,WAAW,CAAC,CAAC,CAAC1I,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAG,EACxG,CAAC,CAAC,CACF,KAAM,CAACW,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,KAAK,CAAC,CAE7C,KAAM,CAAA6V,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC3BzO,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAA8O,aAAa,CAAG,CAClBsL,gBAAgB,CAAE7S,QAAQ,CAAC6S,gBAAgB,CAAGrgB,SAAS,CAACmS,QAAQ,CAAC,GAAI,CAAA/K,IAAI,CAACoG,QAAQ,CAAC6S,gBAAgB,CAAC,CAAC,CAAG,IAAI,CAC5GsM,aAAa,CAAEnf,QAAQ,CAACmf,aAAa,CAAG3sB,SAAS,CAACmS,QAAQ,CAAC,GAAI,CAAA/K,IAAI,CAACoG,QAAQ,CAACmf,aAAa,CAAC,CAAC,CAAG,IACnG,CAAC,CACD,GAAInf,QAAQ,CAACmf,aAAa,CAAE,CACxB5X,aAAa,CAAC1C,MAAM,CAAG,QAAQ,CACnC,CAAC,IAAM,IAAIqZ,OAAO,CAACrZ,MAAM,GAAK,QAAQ,CAAE,CACpC0C,aAAa,CAAC1C,MAAM,CAAG,WAAW,CACtC,CACA,KAAM,CAAAxS,SAAS,CAACF,GAAG,CAAC4C,EAAE,CAAE,UAAU,CAAEmpB,OAAO,CAACplB,EAAE,CAAC,CAAEyO,aAAa,CAAC,CAC/DN,WAAW,CAAC,CAAC,CACb5R,OAAO,CAAC,CAAC,CACb,CAAC,CAED,KAAM,CAAA+pB,mBAAmB,CAAG,KAAAA,CAAA,GAAY,CACpC,GAAI7F,MAAM,CAAC8F,OAAO,CAAC,kFAAkF,CAAC,CAAE,CACpG5mB,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAApG,SAAS,CAACF,GAAG,CAAC4C,EAAE,CAAE,UAAU,CAAEmpB,OAAO,CAACplB,EAAE,CAAC,CAAE,CAAE+L,MAAM,CAAE,WAAY,CAAC,CAAC,CACzE,GAAIqZ,OAAO,CAACZ,UAAU,EAAIY,OAAO,CAACZ,UAAU,GAAK,SAAS,CAAE,CACxD,KAAM,CAAAgC,aAAa,CAAGpB,OAAO,CAAC1L,IAAI,GAAK,SAAS,CAAG,kBAAkB,CAAG,oBAAoB,CAC5F,KAAM,CAAAngB,SAAS,CAACF,GAAG,CAAC4C,EAAE,CAAE,WAAW,CAAEmpB,OAAO,CAACZ,UAAU,CAAC,CAAE,CACtD,CAACgC,aAAa,EAAG1sB,WAAW,CAAC,CAAC,CAC9BiS,MAAM,CAAE,sBACZ,CAAC,CAAC,CACN,CACAoC,WAAW,CAAC,CAAC,CACb5R,OAAO,CAAC,CAAC,CACb,CACJ,CAAC,CAED,mBACIrB,IAAA,QAAK0B,SAAS,CAAC,gFAAgF,CAAAG,QAAA,cAC3F3B,KAAA,QAAKwB,SAAS,CAAC,mDAAmD,CAAAG,QAAA,eAC9D3B,KAAA,OAAIwB,SAAS,CAAC,wBAAwB,CAAAG,QAAA,EAAC,qBAAmB,CAACqoB,OAAO,CAACpX,KAAK,EAAK,CAAC,cAC9E5S,KAAA,QAAKwB,SAAS,CAAC,WAAW,CAAAG,QAAA,eACtB3B,KAAA,QAAA2B,QAAA,eAAK7B,IAAA,UAAO0B,SAAS,CAAC,2BAA2B,CAAAG,QAAA,CAAC,uBAAqB,CAAO,CAAC,cAAA7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAACuB,KAAK,CAAEqJ,QAAQ,CAAC6S,gBAAiB,CAACjc,QAAQ,CAAEC,CAAC,EAAIoJ,WAAW,CAAA9G,aAAA,CAAAA,aAAA,IAAK6G,QAAQ,MAAE6S,gBAAgB,CAAEhc,CAAC,CAACC,MAAM,CAACH,KAAK,EAAC,CAAE,CAACjB,SAAS,CAAC,yCAAyC,CAAC,CAAC,EAAK,CAAC,cAC5QxB,KAAA,QAAA2B,QAAA,eAAK7B,IAAA,UAAO0B,SAAS,CAAC,2BAA2B,CAAAG,QAAA,CAAC,oBAAkB,CAAO,CAAC,cAAA7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAACuB,KAAK,CAAEqJ,QAAQ,CAACmf,aAAc,CAACvoB,QAAQ,CAAEC,CAAC,EAAIoJ,WAAW,CAAA9G,aAAA,CAAAA,aAAA,IAAK6G,QAAQ,MAAEmf,aAAa,CAAEtoB,CAAC,CAACC,MAAM,CAACH,KAAK,EAAC,CAAE,CAACjB,SAAS,CAAC,yCAAyC,CAAC,CAAC,EAAK,CAAC,EAClQ,CAAC,cACNxB,KAAA,QAAKwB,SAAS,CAAC,wCAAwC,CAAAG,QAAA,eACnD7B,IAAA,WAAQ8B,OAAO,CAAEspB,mBAAoB,CAAClkB,QAAQ,CAAE1C,OAAQ,CAAC9C,SAAS,CAAC,uEAAuE,CAAAG,QAAA,CAAC,kBAAgB,CAAQ,CAAC,cACpK3B,KAAA,QAAA2B,QAAA,eACI7B,IAAA,WAAQ8B,OAAO,CAAET,OAAQ,CAAC6F,QAAQ,CAAE1C,OAAQ,CAAC9C,SAAS,CAAC,4DAA4D,CAAAG,QAAA,CAAC,QAAM,CAAQ,CAAC,cACnI7B,IAAA,WAAQ8B,OAAO,CAAEoR,UAAW,CAAChM,QAAQ,CAAE1C,OAAQ,CAAC9C,SAAS,CAAC,qDAAqD,CAAAG,QAAA,CAAE2C,OAAO,CAAG,cAAc,CAAG,SAAS,CAAS,CAAC,EAC9J,CAAC,EACL,CAAC,EACL,CAAC,CACL,CAAC,CAEd,CAAC,CAED,KAAM,CAAAiC,UAAU,CAAIC,SAAS,EAAK,CAACA,SAAS,CAAG,KAAK,CAAG,GAAI,CAAAd,IAAI,CAACc,SAAS,CAACC,OAAO,CAAG,IAAI,CAAC,CAAC8O,kBAAkB,CAAC,OAAO,CAAC,CAErH,KAAM,CAAAgD,cAAc,CAAIyR,OAAO,EAAK,CAChC,GAAIA,OAAO,CAACrZ,MAAM,GAAK,QAAQ,CAAE,MAAO,6BAA6B,CACrE,GAAIqZ,OAAO,CAACrZ,MAAM,GAAK,WAAW,CAAE,MAAO,wCAAwC,CACnF,GAAIqZ,OAAO,CAACqB,gBAAgB,EAAIrB,OAAO,CAACqB,gBAAgB,CAACpX,MAAM,CAAC,CAAC,CAAG,GAAI,CAAAvO,IAAI,CAAC,CAAC,CAAE,MAAO,yBAAyB,CAChH,MAAO,+BAA+B,CAC1C,CAAC,CAED,mBACI1F,KAAA,QAAA2B,QAAA,eACI3B,KAAA,QAAKwB,SAAS,CAAC,6DAA6D,CAAAG,QAAA,eACxE7B,IAAA,UACIoB,IAAI,CAAC,MAAM,CACX2B,WAAW,CAAC,qDAAkD,CAC9DrB,SAAS,CAAC,0EAA0E,CACpFkB,QAAQ,CAAGC,CAAC,EAAK,CAAE8O,aAAa,CAAC9O,CAAC,CAACC,MAAM,CAACH,KAAK,CAAC,CAAEkP,cAAc,CAAC,CAAC,CAAC,CAAE,CAAE,CAC1E,CAAC,cACF3R,KAAA,QAAKwB,SAAS,CAAC,mBAAmB,CAAAG,QAAA,eAC9B7B,IAAA,SAAM0B,SAAS,CAAC,cAAc,CAAAG,QAAA,CAAC,UAAQ,CAAM,CAAC,cAC9C3B,KAAA,WAAQyC,KAAK,CAAEmP,YAAa,CAAClP,QAAQ,CAAGC,CAAC,EAAK,CAAEkP,eAAe,CAACd,MAAM,CAACpO,CAAC,CAACC,MAAM,CAACH,KAAK,CAAC,CAAC,CAAEkP,cAAc,CAAC,CAAC,CAAC,CAAE,CAAE,CAACnQ,SAAS,CAAC,6CAA6C,CAAAG,QAAA,eAClK7B,IAAA,WAAQ2C,KAAK,CAAE,EAAG,CAAAd,QAAA,CAAC,IAAE,CAAQ,CAAC,cAC9B7B,IAAA,WAAQ2C,KAAK,CAAE,EAAG,CAAAd,QAAA,CAAC,IAAE,CAAQ,CAAC,cAC9B7B,IAAA,WAAQ2C,KAAK,CAAE,EAAG,CAAAd,QAAA,CAAC,IAAE,CAAQ,CAAC,EAC1B,CAAC,cACT7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMgoB,eAAe,CAAC,IAAI,CAAE,CAACpoB,SAAS,CAAC,gFAAgF,CAAAG,QAAA,CAAC,6BAEzI,CAAQ,CAAC,EACR,CAAC,EACL,CAAC,cACN7B,IAAA,QAAK0B,SAAS,CAAC,4CAA4C,CAAAG,QAAA,cACvD3B,KAAA,UAAOwB,SAAS,CAAC,qCAAqC,CAAAG,QAAA,eAClD7B,IAAA,UAAO0B,SAAS,CAAC,YAAY,CAAAG,QAAA,cACzB3B,KAAA,OAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,mDAAmD,CAAAG,QAAA,CAAC,OAAK,CAAI,CAAC,cAC5E7B,IAAA,OAAI0B,SAAS,CAAC,mDAAmD,CAAAG,QAAA,CAAE2lB,WAAW,GAAK,SAAS,CAAG,SAAS,CAAG,WAAW,CAAK,CAAC,cAC5HxnB,IAAA,OAAI0B,SAAS,CAAC,mDAAmD,CAAAG,QAAA,CAAC,gBAAW,CAAI,CAAC,cAClF7B,IAAA,OAAI0B,SAAS,CAAC,mDAAmD,CAAAG,QAAA,CAAC,OAAK,CAAI,CAAC,cAC5E7B,IAAA,OAAI0B,SAAS,CAAC,mDAAmD,CAAAG,QAAA,CAAC,kBAAa,CAAI,CAAC,cACpF7B,IAAA,OAAI0B,SAAS,CAAC,mDAAmD,CAAAG,QAAA,CAAC,oBAAkB,CAAI,CAAC,cACzF7B,IAAA,OAAI0B,SAAS,CAAC,mDAAmD,CAAAG,QAAA,CAAC,YAAU,CAAI,CAAC,cACjF7B,IAAA,OAAI0B,SAAS,CAAC,mDAAmD,CAAAG,QAAA,CAAC,QAAM,CAAI,CAAC,cAC7E7B,IAAA,OAAI0B,SAAS,CAAC,mDAAmD,CAAAG,QAAA,CAAC,UAAQ,CAAI,CAAC,EAC/E,CAAC,CACF,CAAC,cACR7B,IAAA,UAAO0B,SAAS,CAAC,mCAAmC,CAAAG,QAAA,CAC/C2C,OAAO,cAAGxE,IAAA,OAAA6B,QAAA,cAAI7B,IAAA,OAAIyJ,OAAO,CAAC,GAAG,CAAA5H,QAAA,CAAC,aAAW,CAAI,CAAC,CAAI,CAAC,CAAGkT,YAAY,CAAC7P,GAAG,CAACglB,OAAO,eAC3EhqB,KAAA,OAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,CAAEqoB,OAAO,CAACpX,KAAK,CAAK,CAAC,cAC9C9S,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,CAAEqoB,OAAO,CAACte,aAAa,EAAIse,OAAO,CAACtZ,eAAe,CAAK,CAAC,cACjF5Q,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,CAAEqoB,OAAO,CAACC,WAAW,GAAKD,OAAO,CAACZ,UAAU,GAAK,SAAS,CAAG,mBAAmB,CAAG,KAAK,CAAC,CAAK,CAAC,cACxHppB,KAAA,OAAIwB,SAAS,CAAC,WAAW,CAAAG,QAAA,EAAC,GAAC,CAAC,CAACqoB,OAAO,CAACvL,KAAK,EAAI,CAAC,EAAEjI,OAAO,CAAC,CAAC,CAAC,EAAK,CAAC,cACjE1W,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,CAAE4E,UAAU,CAACyjB,OAAO,CAACzL,YAAY,CAAC,CAAK,CAAC,cACjEze,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,CAAE4E,UAAU,CAACyjB,OAAO,CAACrL,gBAAgB,CAAC,CAAK,CAAC,cACrE7e,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,CAAE4E,UAAU,CAACyjB,OAAO,CAACiB,aAAa,CAAC,CAAK,CAAC,cAClEnrB,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,cAAC7B,IAAA,SAAM0B,SAAS,kEAAAC,MAAA,CAAmE8W,cAAc,CAACyR,OAAO,CAAC,CAAG,CAAAroB,QAAA,CAAEqoB,OAAO,CAACrZ,MAAM,CAAO,CAAC,CAAI,CAAC,cACnK7Q,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,cAAC7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMkoB,eAAe,CAACE,OAAO,CAAE,CAACxoB,SAAS,CAAC,iBAAiB,CAAAG,QAAA,CAAC,WAAS,CAAQ,CAAC,CAAI,CAAC,GATzHqoB,OAAO,CAACplB,EAUb,CACP,CAAC,CACC,CAAC,EACL,CAAC,CACP,CAAC,cACN5E,KAAA,QAAKwB,SAAS,CAAC,wCAAwC,CAAAG,QAAA,eACnD3B,KAAA,SAAMwB,SAAS,CAAC,uBAAuB,CAAAG,QAAA,EAAC,YAAO,CAAC+P,WAAW,CAAC,MAAI,CAACoD,UAAU,EAAO,CAAC,cACnF9U,KAAA,QAAA2B,QAAA,eACI7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMqT,QAAQ,CAACvD,WAAW,CAAG,CAAC,CAAE,CAAC1K,QAAQ,CAAE0K,WAAW,GAAK,CAAE,CAAClQ,SAAS,CAAC,+DAA+D,CAAAG,QAAA,CAAC,UAAQ,CAAQ,CAAC,cAC1K7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMqT,QAAQ,CAACvD,WAAW,CAAG,CAAC,CAAE,CAAC1K,QAAQ,CAAE0K,WAAW,GAAKoD,UAAU,EAAIA,UAAU,GAAK,CAAE,CAACtT,SAAS,CAAC,0DAA0D,CAAAG,QAAA,CAAC,WAAS,CAAQ,CAAC,EAClM,CAAC,EACL,CAAC,CACLgoB,YAAY,eAAI7pB,IAAA,CAACoqB,sBAAsB,EAAC/oB,OAAO,CAAEA,CAAA,GAAMyoB,eAAe,CAAC,KAAK,CAAE,CAAC7W,WAAW,CAAEqU,QAAS,CAAE,CAAC,CACxGyC,YAAY,eAAI/pB,IAAA,CAACirB,kBAAkB,EAACf,OAAO,CAAEH,YAAa,CAAC1oB,OAAO,CAAEA,CAAA,GAAM2oB,eAAe,CAAC,IAAI,CAAE,CAAC/W,WAAW,CAAEqU,QAAS,CAAE,CAAC,EAC1H,CAAC,CAEd,CAAC,CAED;AACA,KAAM,CAAAkE,oBAAoB,CAAGA,CAAA,GAAM,CAC/B,KAAM,CAAC1hB,QAAQ,CAAEC,WAAW,CAAC,CAAG1M,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACiU,YAAY,CAAEC,eAAe,CAAC,CAAGlU,QAAQ,CAAC,IAAI,CAAC,CACtD,KAAM,CAACouB,YAAY,CAAEC,eAAe,CAAC,CAAGruB,QAAQ,CAAC,IAAI,CAAC,CACtD,KAAM,CAAC+U,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGhV,QAAQ,CAAC,IAAI,CAAC,CAE9D,KAAM,CAAA+kB,aAAa,CAAGA,CAAA,GAAM,CACxB3d,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAAI,CAAC,CAAG7G,KAAK,CAACF,UAAU,CAACiD,EAAE,CAAE,WAAW,CAAC,CAAE9C,KAAK,CAAC,QAAQ,CAAE,IAAI,CAAE,CAAC,wBAAwB,CAAE,mBAAmB,CAAC,CAAC,CAAC,CAEpH,KAAM,CAAA8G,WAAW,CAAGzG,UAAU,CAACuG,CAAC,CAAGG,aAAa,EAAK,CACjD,KAAM,CAAAoU,YAAY,CAAGpU,aAAa,CAACC,IAAI,CAACC,GAAG,CAAC/G,GAAG,EAAAgH,aAAA,EAAOL,EAAE,CAAE3G,GAAG,CAAC2G,EAAE,EAAK3G,GAAG,CAACiH,IAAI,CAAC,CAAC,CAAG,CAAC,CACnF2E,WAAW,CAACqP,YAAY,CAAC,CACzB3U,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAGjD,KAAK,EAAK,CACV8D,OAAO,CAAC9D,KAAK,CAAC,2CAA2C,CAAEA,KAAK,CAAC,CACjEiD,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAC,CAEF,MAAO,CAAAM,WAAW,CACtB,CAAC,CAEDzH,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAyH,WAAW,CAAGqd,aAAa,CAAC,CAAC,CACnC,MAAO,IAAMrd,WAAW,CAAC,CAAC,CAC9B,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAA4mB,wBAAwB,CAAGC,MAAA,EAAuC,IAAtC,CAAE3nB,OAAO,CAAE5C,OAAO,CAAE4R,WAAY,CAAC,CAAA2Y,MAAA,CAC/D,KAAM,CAACC,UAAU,CAAEC,aAAa,CAAC,CAAGzuB,QAAQ,CAAC4G,OAAO,CAAC2T,UAAU,EAAI,EAAE,CAAC,CACtE,KAAM,CAACmU,YAAY,CAAEC,eAAe,CAAC,CAAG3uB,QAAQ,CAAC,IAAI,CAAC,CACtD,KAAM,CAAC4uB,YAAY,CAAEC,eAAe,CAAC,CAAG7uB,QAAQ,CAAC,IAAI,CAAC,CACtD,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,KAAK,CAAC,CAE7C,KAAM,CAAAkI,gBAAgB,CAAIujB,MAAM,EAAMjmB,CAAC,EAAK,CAAE,GAAIA,CAAC,CAACC,MAAM,CAAC0C,KAAK,CAAC,CAAC,CAAC,CAAEsjB,MAAM,CAACjmB,CAAC,CAACC,MAAM,CAAC0C,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAEhG,KAAM,CAAA+I,UAAU,CAAG,KAAAA,CAAOC,IAAI,CAAEC,IAAI,GAAK,CACrC,GAAI,CAACD,IAAI,CAAE,MAAO,KAAI,CACtB,KAAM,CAAA7I,UAAU,CAAG5G,GAAG,CAACiC,OAAO,CAAEyN,IAAI,CAAC,CACrC,KAAM,CAAA1I,UAAU,CAAG/G,oBAAoB,CAAC2G,UAAU,CAAE6I,IAAI,CAAC,CACzD,MAAO,CAAAvP,cAAc,CAAC,CAAC,KAAM,CAAA8G,UAAU,EAAEhH,GAAG,CAAC,CACjD,CAAC,CAED,KAAM,CAAAmU,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC3BzO,UAAU,CAAC,IAAI,CAAC,CAChB,KAAM,CAAA8O,aAAa,CAAG,CAClBqE,UAAU,CAAEiU,UAAW;AAC3B,CAAC,CACD,KAAM,CAAAM,QAAQ,CAAG,KAAM,CAAA5d,UAAU,CAACwd,YAAY,0BAAApqB,MAAA,CAA2BsC,OAAO,CAACa,EAAE,YAAAnD,MAAA,CAAUoqB,YAAY,SAAZA,YAAY,iBAAZA,YAAY,CAAEjmB,IAAI,CAAE,CAAC,CAClH,KAAM,CAAAsmB,QAAQ,CAAG,KAAM,CAAA7d,UAAU,CAAC0d,YAAY,0BAAAtqB,MAAA,CAA2BsC,OAAO,CAACa,EAAE,YAAAnD,MAAA,CAAUsqB,YAAY,SAAZA,YAAY,iBAAZA,YAAY,CAAEnmB,IAAI,CAAE,CAAC,CAElH,GAAIqmB,QAAQ,CAAE5Y,aAAa,CAACsE,WAAW,CAAGsU,QAAQ,CAClD,GAAIC,QAAQ,CAAE7Y,aAAa,CAACuE,WAAW,CAAGsU,QAAQ,CAElD,GAAI5Y,MAAM,CAACC,IAAI,CAACF,aAAa,CAAC,CAACzM,MAAM,CAAG,CAAC,CAAE,CACvC,KAAM,CAAAzI,SAAS,CAACF,GAAG,CAAC4C,EAAE,CAAE,WAAW,CAAEkD,OAAO,CAACa,EAAE,CAAC,CAAEyO,aAAa,CAAC,CACpE,CACAN,WAAW,CAAC,CAAC,CACb5R,OAAO,CAAC,CAAC,CACb,CAAC,CAED,mBACIrB,IAAA,QAAK0B,SAAS,CAAC,gFAAgF,CAAAG,QAAA,cAC3F3B,KAAA,QAAKwB,SAAS,CAAC,mDAAmD,CAAAG,QAAA,eAC9D3B,KAAA,OAAIwB,SAAS,CAAC,wBAAwB,CAAAG,QAAA,EAAC,2BAAyB,CAACoC,OAAO,CAAC4C,GAAG,EAAK,CAAC,cAClF3G,KAAA,QAAKwB,SAAS,CAAC,WAAW,CAAAG,QAAA,eACtB3B,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,2BAA2B,CAAAG,QAAA,CAAC,2BAAsB,CAAO,CAAC,cAC3E7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAACuB,KAAK,CAAEkpB,UAAW,CAACjpB,QAAQ,CAAGC,CAAC,EAAKipB,aAAa,CAACjpB,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACjB,SAAS,CAAC,yCAAyC,CAAC,CAAC,EAC1I,CAAC,cACN1B,IAAA,QAAI,CAAC,cACLE,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,2BAA2B,CAAAG,QAAA,CAAC,8CAA4C,CAAO,CAAC,cACjG7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC2lB,MAAM,CAAC,MAAM,CAACnkB,QAAQ,CAAE2C,gBAAgB,CAACymB,eAAe,CAAE,CAACtqB,SAAS,CAAC,2BAA2B,CAAC,CAAC,EACpH,CAAC,cACNxB,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,2BAA2B,CAAAG,QAAA,CAAC,8CAA4C,CAAO,CAAC,cACjG7B,IAAA,UAAOoB,IAAI,CAAC,MAAM,CAAC2lB,MAAM,CAAC,MAAM,CAACnkB,QAAQ,CAAE2C,gBAAgB,CAAC2mB,eAAe,CAAE,CAACxqB,SAAS,CAAC,2BAA2B,CAAC,CAAC,EACpH,CAAC,EACL,CAAC,cACNxB,KAAA,QAAKwB,SAAS,CAAC,iCAAiC,CAAAG,QAAA,eAC5C7B,IAAA,WAAQ8B,OAAO,CAAET,OAAQ,CAACK,SAAS,CAAC,uDAAuD,CAAAG,QAAA,CAAC,UAAQ,CAAQ,CAAC,cAC7G7B,IAAA,WAAQ8B,OAAO,CAAEoR,UAAW,CAACxR,SAAS,CAAC,oDAAoD,CAAAG,QAAA,CAAE2C,OAAO,CAAG,cAAc,CAAG,oBAAoB,CAAS,CAAC,EACrJ,CAAC,EACL,CAAC,CACL,CAAC,CAEd,CAAC,CAED,KAAM,CAAA6nB,kBAAkB,CAAG,KAAO,CAAA5rB,SAAS,EAAK,CAC5CirB,eAAe,CAACjrB,SAAS,CAAC,CAC1B,GAAI,CACA,KAAM,CAAApC,SAAS,CAACF,GAAG,CAAC4C,EAAE,CAAE,WAAW,CAAEN,SAAS,CAAC,CAAE,CAC7CoQ,MAAM,CAAE,mBAAmB,CAC3B0G,aAAa,CAAE3Y,WAAW,CAAC,CAC/B,CAAC,CAAC,CACN,CAAE,MAAO4C,KAAK,CAAE,CACZ8D,OAAO,CAAC9D,KAAK,CAAC,kCAAkC,CAAEA,KAAK,CAAC,CACxD6V,KAAK,CAAC,oDAAoD,CAAC,CAC/D,CAAC,OAAS,CACNqU,eAAe,CAAC,IAAI,CAAC,CACzB,CACJ,CAAC,CAED,KAAM,CAAAY,kBAAkB,CAAI7rB,SAAS,EAAK,CACtC4R,mBAAmB,CAAC,CAChBpQ,KAAK,CAAE,iBAAiB,CACxBd,OAAO,CAAE,yGAAyG,CAClHe,SAAS,CAAEA,CAAA,GAAMmqB,kBAAkB,CAAC5rB,SAAS,CACjD,CAAC,CAAC,CACN,CAAC,CAED,mBACIP,KAAA,QAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,uCAAuC,CAAAG,QAAA,CAAC,kCAAgC,CAAI,CAAC,CAC1F2C,OAAO,cAAGxE,IAAA,MAAA6B,QAAA,CAAG,aAAW,CAAG,CAAC,CAAGiI,QAAQ,CAAChD,MAAM,GAAK,CAAC,cAAG9G,IAAA,MAAA6B,QAAA,CAAG,8BAA4B,CAAG,CAAC,cACvF7B,IAAA,QAAK0B,SAAS,CAAC,4CAA4C,CAAAG,QAAA,cACvD3B,KAAA,UAAOwB,SAAS,CAAC,qCAAqC,CAAAG,QAAA,eAClD7B,IAAA,UAAO0B,SAAS,CAAC,YAAY,CAAAG,QAAA,cACzB3B,KAAA,OAAA2B,QAAA,eACI7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,KAAG,CAAI,CAAC,cAExF7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,SAAO,CAAI,CAAC,cAC5F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,UAAQ,CAAI,CAAC,cAC7F7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,2BAAsB,CAAI,CAAC,cAC3G7B,IAAA,OAAI0B,SAAS,CAAC,iEAAiE,CAAAG,QAAA,CAAC,UAAQ,CAAI,CAAC,EAC7F,CAAC,CACF,CAAC,cACR7B,IAAA,UAAO0B,SAAS,CAAC,mCAAmC,CAAAG,QAAA,CAC/CiI,QAAQ,CAAC5E,GAAG,CAACjB,OAAO,eAChB/D,KAAA,OAAqBwB,SAAS,CAAEuC,OAAO,CAACsT,aAAa,CAAG,cAAc,CAAG,EAAG,CAAA1V,QAAA,eACzE7B,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAAC4C,GAAG,CAAK,CAAC,cAEtE7G,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAAC2H,aAAa,CAAK,CAAC,cAChF5L,IAAA,OAAI0B,SAAS,CAAC,qCAAqC,CAAAG,QAAA,CAAEoC,OAAO,CAAC4H,cAAc,CAAK,CAAC,cACjF7L,IAAA,OAAI0B,SAAS,CAAC,WAAW,CAAAG,QAAA,cACrB3B,KAAA,QAAKwB,SAAS,CAAC,iCAAiC,CAAAG,QAAA,EAC3CoC,OAAO,CAAC0iB,oBAAoB,eACzBzmB,KAAA,QAAKwB,SAAS,CAAC,cAAc,CAAAG,QAAA,eACzB7B,IAAA,MAAG0B,SAAS,CAAC,uBAAuB,CAAAG,QAAA,CAAC,SAAO,CAAG,CAAC,cAChD7B,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAAC0iB,oBAAqB,CAAC7jB,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAC,iBAAe,CAAG,CAAC,cAC9H3B,KAAA,MAAA2B,QAAA,EAAG,kBAAgB,cAAA7B,IAAA,SAAM0B,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAEoC,OAAO,CAAC2iB,kBAAkB,EAAI,KAAK,CAAO,CAAC,EAAG,CAAC,EAClG,CACR,CACA3iB,OAAO,CAAC4iB,oBAAoB,eACzB3mB,KAAA,QAAKwB,SAAS,CAAC,KAAK,CAAAG,QAAA,eAChB7B,IAAA,MAAG0B,SAAS,CAAC,uBAAuB,CAAAG,QAAA,CAAC,SAAO,CAAG,CAAC,cAChD7B,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAAC4iB,oBAAqB,CAAC/jB,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAC,iBAAe,CAAG,CAAC,cAC9H3B,KAAA,MAAA2B,QAAA,EAAG,kBAAgB,cAAA7B,IAAA,SAAM0B,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAEoC,OAAO,CAAC6iB,kBAAkB,EAAI,KAAK,CAAO,CAAC,EAAG,CAAC,EAClG,CACR,CACA7iB,OAAO,CAACsoB,mBAAmB,EAAI,CAACtoB,OAAO,CAAC0iB,oBAAoB,eACxD3mB,IAAA,MAAGgH,IAAI,CAAE/C,OAAO,CAACsoB,mBAAoB,CAACzpB,MAAM,CAAC,QAAQ,CAACmE,GAAG,CAAC,qBAAqB,CAACvF,SAAS,CAAC,eAAe,CAAAG,QAAA,CAAC,eAAa,CAAG,CAC9H,CAEAoC,OAAO,CAACsT,aAAa,eAClBrX,KAAA,QAAKwB,SAAS,CAAC,mDAAmD,CAAAG,QAAA,eAC9D7B,IAAA,MAAG0B,SAAS,CAAC,mBAAmB,CAAAG,QAAA,CAAC,0BAAwB,CAAG,CAAC,cAC7D7B,IAAA,MAAG0B,SAAS,CAAC,SAAS,CAAAG,QAAA,CAAEoC,OAAO,CAACsT,aAAa,CAAI,CAAC,EACjD,CACR,EACA,CAAC,CACN,CAAC,cACLrX,KAAA,OAAIwB,SAAS,CAAC,iDAAiD,CAAAG,QAAA,eAC3D7B,IAAA,WAAQ8B,OAAO,CAAEA,CAAA,GAAMyP,eAAe,CAACtN,OAAO,CAAE,CAACvC,SAAS,CAAC,4CAA4C,CAAAG,QAAA,CAAC,mBAAiB,CAAQ,CAAC,CACjIoC,OAAO,CAAC4M,MAAM,GAAK,wBAAwB,eACxC7Q,IAAA,WACI8B,OAAO,CAAEA,CAAA,GAAMwqB,kBAAkB,CAACroB,OAAO,CAACa,EAAE,CAAE,CAC9CoC,QAAQ,CAAEukB,YAAY,GAAKxnB,OAAO,CAACa,EAAG,CACtCpD,SAAS,CAAC,yDAAyD,CAAAG,QAAA,CAElE4pB,YAAY,GAAKxnB,OAAO,CAACa,EAAE,CAAG,aAAa,CAAG,mBAAmB,CAC9D,CACX,EACD,CAAC,GA5CCb,OAAO,CAACa,EA6Cd,CACP,CAAC,CACC,CAAC,EACL,CAAC,CACP,CACR,CACAwM,YAAY,eAAItR,IAAA,CAAC2rB,wBAAwB,EAAC1nB,OAAO,CAAEqN,YAAa,CAACjQ,OAAO,CAAEA,CAAA,GAAMkQ,eAAe,CAAC,IAAI,CAAE,CAAC0B,WAAW,CAAEmP,aAAc,CAAE,CAAC,CACrIhQ,gBAAgB,eACbpS,IAAA,CAAC+B,iBAAiB,EACdE,KAAK,CAAEmQ,gBAAgB,CAACnQ,KAAM,CAC9Bd,OAAO,CAAEiR,gBAAgB,CAACjR,OAAQ,CAClCe,SAAS,CAAEkQ,gBAAgB,CAAClQ,SAAU,CACtCC,QAAQ,CAAEA,CAAA,GAAMkQ,mBAAmB,CAAC,IAAI,CAAE,CAC7C,CACJ,EACA,CAAC,CAEd,CAAC,CAED;AACA,KAAM,CAAAma,SAAS,CAAGC,MAAA,EAAwB,IAAvB,CAAEtpB,IAAI,CAAEC,QAAS,CAAC,CAAAqpB,MAAA,CAEjC;AACA,KAAM,CAAAC,qBAAqB,CAAGA,CAAA,GAAM,CAChC,OAAQtpB,QAAQ,CAACE,GAAG,EAChB,IAAK,eAAe,CAChB,mBAAOtD,IAAA,CAAC2J,cAAc,EAACxG,IAAI,CAAEA,IAAK,CAACC,QAAQ,CAAEA,QAAS,CAAE,CAAC,CAC7D,IAAK,SAAS,CACV,mBAAOpD,IAAA,CAAC8Y,eAAe,EAAC3V,IAAI,CAAEA,IAAK,CAACC,QAAQ,CAAEA,QAAS,CAAE,CAAC,CAC9D,IAAK,WAAW,CACZ,mBAAOpD,IAAA,CAAC8c,kBAAkB,EAAC3Z,IAAI,CAAEA,IAAK,CAACC,QAAQ,CAAEA,QAAS,CAAE,CAAC,CACjE,IAAK,SAAS,CACV,mBAAOpD,IAAA,CAACmiB,gBAAgB,EAAChf,IAAI,CAAEA,IAAK,CAACC,QAAQ,CAAEA,QAAS,CAAE,CAAC,CAC/D,IAAK,YAAY,CACb,mBAAOpD,IAAA,CAAC2jB,mBAAmB,EAACxgB,IAAI,CAAEA,IAAK,CAACC,QAAQ,CAAEA,QAAS,CAAE,CAAC,CAClE,IAAK,SAAS,CACV,mBAAOpD,IAAA,CAAC0kB,gBAAgB,EAACvhB,IAAI,CAAEA,IAAK,CAACC,QAAQ,CAAEA,QAAS,CAAE,CAAC,CAC/D,IAAK,UAAU,CACX,mBAAOpD,IAAA,CAACgnB,iBAAiB,EAAC7jB,IAAI,CAAEA,IAAK,CAACC,QAAQ,CAAEA,QAAS,CAAE,CAAC,CAChE,IAAK,aAAa,CACd;AACA,mBAAOpD,IAAA,CAACwrB,oBAAoB,GAAE,CAAC,CACnC,QACI,mBAAOtrB,KAAA,QAAA2B,QAAA,eAAK7B,IAAA,OAAI0B,SAAS,CAAC,oBAAoB,CAAAG,QAAA,CAAC,mBAAiB,CAAI,CAAC,cAAA7B,IAAA,MAAA6B,QAAA,CAAG,4BAA0B,CAAG,CAAC,EAAK,CAAC,CACpH,CACJ,CAAC,CAED,mBACI7B,IAAA,QAAK0B,SAAS,CAAC,wCAAwC,CAAAG,QAAA,CAClD6qB,qBAAqB,CAAC,CAAC,CACvB,CAAC,CAEd,CAAC,CAED,KAAM,CAAAC,QAAQ,CAAGA,CAAA,GAAM,CACnB,KAAM,CAAC7oB,KAAK,CAAEwD,QAAQ,CAAC,CAAGjK,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACkK,QAAQ,CAAEC,WAAW,CAAC,CAAGnK,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACmE,KAAK,CAAEoD,QAAQ,CAAC,CAAGvH,QAAQ,CAAC,EAAE,CAAC,CAEtC,KAAM,CAAAuvB,WAAW,CAAG,KAAO,CAAA/pB,CAAC,EAAK,CAC7BA,CAAC,CAACoF,cAAc,CAAC,CAAC,CAClBrD,QAAQ,CAAC,EAAE,CAAC,CACZ,GAAI,CACA,KAAM,CAAAjH,0BAA0B,CAACmD,IAAI,CAAEgD,KAAK,CAAEyD,QAAQ,CAAC,CAC3D,CAAE,MAAOlC,GAAG,CAAE,CACVT,QAAQ,CAAC,iCAAiC,CAAC,CAC/C,CACJ,CAAC,CAED,mBACI5E,IAAA,QAAK0B,SAAS,CAAC,4DAA4D,CAAAG,QAAA,cACvE3B,KAAA,QAAKwB,SAAS,CAAC,oDAAoD,CAAAG,QAAA,eAC/D7B,IAAA,QAAKwD,GAAG,CAAC,6DAA6D,CAACG,GAAG,CAAC,mBAAmB,CAACjC,SAAS,CAAC,mBAAmB,CAAC,CAAC,cAC9H1B,IAAA,OAAI0B,SAAS,CAAC,mDAAmD,CAAAG,QAAA,CAAC,kBAAgB,CAAI,CAAC,cACvF3B,KAAA,SAAMqI,QAAQ,CAAEqkB,WAAY,CAAClrB,SAAS,CAAC,WAAW,CAAAG,QAAA,eAC9C3B,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,yCAAyC,CAAAG,QAAA,CAAC,OAAK,CAAO,CAAC,cACxE7B,IAAA,UAAOoB,IAAI,CAAC,OAAO,CAACuB,KAAK,CAAEmB,KAAM,CAAClB,QAAQ,CAAGC,CAAC,EAAKyE,QAAQ,CAACzE,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACkqB,QAAQ,MAACnrB,SAAS,CAAC,kFAAkF,CAAC,CAAC,EACnL,CAAC,cACNxB,KAAA,QAAA2B,QAAA,eACI7B,IAAA,UAAO0B,SAAS,CAAC,yCAAyC,CAAAG,QAAA,CAAC,eAAU,CAAO,CAAC,cAC7E7B,IAAA,UAAOoB,IAAI,CAAC,UAAU,CAACuB,KAAK,CAAE4E,QAAS,CAAC3E,QAAQ,CAAGC,CAAC,EAAK2E,WAAW,CAAC3E,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAACkqB,QAAQ,MAACnrB,SAAS,CAAC,kFAAkF,CAAC,CAAC,EAC5L,CAAC,CACLF,KAAK,eAAIxB,IAAA,MAAG0B,SAAS,CAAC,kCAAkC,CAAAG,QAAA,CAAEL,KAAK,CAAI,CAAC,cACrExB,IAAA,WAAQoB,IAAI,CAAC,QAAQ,CAACM,SAAS,CAAC,kHAAkH,CAAAG,QAAA,CAAC,QAEnJ,CAAQ,CAAC,EACP,CAAC,EACN,CAAC,CACL,CAAC,CAEd,CAAC,CAGD,cAAe,SAAS,CAAAirB,GAAGA,CAAA,CAAG,CAC1B,KAAM,CAAC3pB,IAAI,CAAE4pB,OAAO,CAAC,CAAG1vB,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAAC+F,QAAQ,CAAE4pB,WAAW,CAAC,CAAG3vB,QAAQ,CAAC,IAAI,CAAC,CAC9C,KAAM,CAACmH,OAAO,CAAEC,UAAU,CAAC,CAAGpH,QAAQ,CAAC,IAAI,CAAC,CAE5CC,SAAS,CAAC,IAAM,CACZ,KAAM,CAAAyH,WAAW,CAAGtH,kBAAkB,CAACqD,IAAI,CAAE,KAAO,CAAAmsB,WAAW,EAAK,CAChE,GAAIA,WAAW,CAAE,CACb,KAAM,CAAAC,UAAU,CAAG/uB,GAAG,CAAC4C,EAAE,CAAE,UAAU,CAAEksB,WAAW,CAAChnB,GAAG,CAAC,CACvD,KAAM,CAAAknB,OAAO,CAAG,KAAM,CAAA/uB,MAAM,CAAC8uB,UAAU,CAAC,CACxC,GAAIC,OAAO,CAACxd,MAAM,CAAC,CAAC,CAAE,CAClBqd,WAAW,CAACG,OAAO,CAAC/nB,IAAI,CAAC,CAAC,CAAC,CAC3B2nB,OAAO,CAACE,WAAW,CAAC,CACxB,CAAC,IAAM,CACH3nB,OAAO,CAAC9D,KAAK,CAAC,sEAAsE,CAAC,CACrF5D,OAAO,CAACkD,IAAI,CAAC,CACjB,CACJ,CAAC,IAAM,CACHisB,OAAO,CAAC,IAAI,CAAC,CACbC,WAAW,CAAC,IAAI,CAAC,CACrB,CACAvoB,UAAU,CAAC,KAAK,CAAC,CACrB,CAAC,CAAC,CACF,MAAO,IAAMM,WAAW,CAAC,CAAC,CAC9B,CAAC,CAAE,EAAE,CAAC,CAEN,GAAIP,OAAO,CAAE,CACT,mBAAOxE,IAAA,QAAK0B,SAAS,CAAC,0EAA0E,CAAAG,QAAA,CAAC,aAAW,CAAK,CAAC,CACtH,CAEA,mBACI3B,KAAA,QAAKwB,SAAS,CAAC,qCAAqC,CAAAG,QAAA,eAC/C7B,IAAA,CAACiD,MAAM,EAACE,IAAI,CAAEA,IAAK,CAACC,QAAQ,CAAEA,QAAS,CAAC,CAAC,cACzCpD,IAAA,SAAA6B,QAAA,CACIsB,IAAI,EAAIC,QAAQ,cAAGpD,IAAA,CAACwsB,SAAS,EAACrpB,IAAI,CAAEA,IAAK,CAACC,QAAQ,CAAEA,QAAS,CAAE,CAAC,cAAGpD,IAAA,CAAC2sB,QAAQ,GAAE,CAAC,CAC7E,CAAC,EACP,CAAC,CAEd","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}