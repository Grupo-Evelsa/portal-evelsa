{"ast":null,"code":"import _objectSpread from\"C:/Users/CAD/Documents/portal-evelsa/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{initializeApp}from'firebase/app';import{getAuth,onAuthStateChanged,createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut}from'firebase/auth';import{getFirestore,collection,addDoc,query,where,getDocs,doc,getDoc,updateDoc,onSnapshot,setDoc,Timestamp,runTransaction,orderBy,deleteDoc}from'firebase/firestore';import{getStorage,ref,uploadBytesResumable,getDownloadURL}from'firebase/storage';// --- INSTRUCCIONES DE CONFIGURACIÓN DE FIREBASE ---\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const firebaseConfig={apiKey:\"AIzaSyA7H6G0mXCy9DmoLg3fSW3TrxIRcEzz9jg\",authDomain:\"portal-evelsa.firebaseapp.com\",projectId:\"portal-evelsa\",storageBucket:\"portal-evelsa.firebasestorage.app\",messagingSenderId:\"847174487471\",appId:\"1:847174487471:web:c3a57fd8315ce619a2335a\"};// --- Inicialización de Firebase ---\nconst app=initializeApp(firebaseConfig);const auth=getAuth(app);const db=getFirestore(app);const storage=getStorage(app);// --- Componentes Reutilizables ---\nconst Alert=_ref=>{let{message,type,onClose}=_ref;if(!message)return null;const baseClasses=\"p-4 mb-4 text-sm rounded-lg relative\";const typeClasses={error:\"bg-red-100 text-red-700\",success:\"bg-green-100 text-green-700\"};return/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(baseClasses,\" \").concat(typeClasses[type]),role:\"alert\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:message}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"absolute top-0 right-0 mt-2 mr-3 text-2xl font-semibold leading-none\",children:\"\\xD7\"})]});};// --- Componente de Cabecera ---\nconst Header=_ref2=>{let{user,userData}=_ref2;return/*#__PURE__*/_jsx(\"header\",{className:\"bg-white shadow-md sticky top-0 z-40\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[userData&&userData.rol==='cliente'&&userData.logoUrl?/*#__PURE__*/_jsx(\"img\",{src:userData.logoUrl,onError:e=>{e.target.onerror=null;e.target.src=\"https://placehold.co/100x40/003366/FFFFFF?text=Logo\";},alt:\"Logo Cliente\",className:\"h-10 w-auto mr-3 object-contain\"}):/*#__PURE__*/_jsx(\"svg\",{className:\"w-10 h-10 text-blue-800 mr-3\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",xmlns:\"http://www.w3.org/2000/svg\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z\"})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-800\",children:\"Portal Grupo Evelsa\"})]}),user&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-600 mr-4\",children:[\"Hola, \",userData?userData.nombreCompleto:user.email]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>signOut(auth),className:\"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300\",children:\"Cerrar Sesi\\xF3n\"})]})]})});};// --- Componentes de Empleado ---\nconst UserManagement=_ref3=>{let{onUserAdded}=_ref3;const[email,setEmail]=useState('');const[password,setPassword]=useState('');const[nombreCompleto,setNombreCompleto]=useState('');const[rol,setRol]=useState('cliente');const[clienteIdNumerico,setClienteIdNumerico]=useState('');const[logoUrl,setLogoUrl]=useState('');const[error,setError]=useState('');const[success,setSuccess]=useState('');const resetForm=()=>{setEmail('');setPassword('');setNombreCompleto('');setRol('cliente');setClienteIdNumerico('');setLogoUrl('');};const handleSubmit=async e=>{e.preventDefault();setError('');setSuccess('');if(!nombreCompleto||!email||!password||rol==='cliente'&&!clienteIdNumerico){setError('Por favor, complete todos los campos requeridos.');return;}try{// Creamos una instancia de Auth temporal para no desloguear al admin\nconst tempApp=initializeApp(firebaseConfig,\"Secondary-\".concat(new Date().getTime()));const tempAuth=getAuth(tempApp);const userCredential=await createUserWithEmailAndPassword(tempAuth,email,password);await setDoc(doc(db,\"usuarios\",userCredential.user.uid),{email,rol,nombreCompleto,clienteIdNumerico:rol==='cliente'?clienteIdNumerico.padStart(3,'0'):'',logoUrl:rol==='cliente'?logoUrl:''});setSuccess(\"\\xA1Usuario \".concat(email,\" creado con \\xE9xito!\"));resetForm();if(onUserAdded)onUserAdded();}catch(err){setError(\"Error al crear usuario: \".concat(err.message));}};return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-xl shadow-lg border border-gray-200\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-800 mb-4\",children:\"Crear Usuario (Cliente o Empleado)\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:nombreCompleto,onChange:e=>setNombreCompleto(e.target.value),placeholder:\"Nombre Completo\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"}),/*#__PURE__*/_jsxs(\"select\",{value:rol,onChange:e=>setRol(e.target.value),className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"cliente\",children:\"Cliente\"}),/*#__PURE__*/_jsx(\"option\",{value:\"empleado\",children:\"Empleado\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:email,onChange:e=>setEmail(e.target.value),placeholder:\"Email de Acceso\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,onChange:e=>setPassword(e.target.value),placeholder:\"Contrase\\xF1a (m\\xEDnimo 6 caracteres)\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"}),rol==='cliente'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:clienteIdNumerico,onChange:e=>setClienteIdNumerico(e.target.value),placeholder:\"ID Num\\xE9rico Cliente (ej: 001)\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:logoUrl,onChange:e=>setLogoUrl(e.target.value),placeholder:\"URL del Logo (Opcional)\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"})]}),/*#__PURE__*/_jsx(Alert,{message:error,type:\"error\",onClose:()=>setError('')}),/*#__PURE__*/_jsx(Alert,{message:success,type:\"success\",onClose:()=>setSuccess('')}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg\",children:\"Crear Usuario\"})]})]});};const NewProjectForm=_ref4=>{let{onProjectAdded}=_ref4;const[formData,setFormData]=useState({clienteId:'',servicioId:'',proveedorId:'',comentarios:'',fechaApertura:new Date().toISOString().split('T')[0]});const[collections,setCollections]=useState({clientes:[],servicios:[],proveedores:[]});const[error,setError]=useState('');const[loading,setLoading]=useState(false);useEffect(()=>{const fetchData=async()=>{try{const[clientesSnap,serviciosSnap,proveedoresSnap]=await Promise.all([getDocs(query(collection(db,\"usuarios\"),where(\"rol\",\"==\",\"cliente\"))),getDocs(collection(db,\"servicios\")),getDocs(collection(db,\"proveedores\"))]);setCollections({clientes:clientesSnap.docs.map(doc=>_objectSpread({id:doc.id},doc.data())),servicios:serviciosSnap.docs.map(doc=>_objectSpread({id:doc.id},doc.data())),proveedores:proveedoresSnap.docs.map(doc=>_objectSpread({id:doc.id},doc.data()))});}catch(e){setError(\"Error al cargar datos. Asegúrese de que las colecciones 'servicios' y 'proveedores' existan.\");}};fetchData();},[]);const handleChange=e=>{const{name,value}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));};const handleSubmit=async e=>{e.preventDefault();if(!formData.clienteId||!formData.servicioId||!formData.proveedorId||!formData.fechaApertura){setError('Todos los campos son obligatorios.');return;}setLoading(true);setError('');try{const anioActual=new Date(formData.fechaApertura).getFullYear();const contadorRef=doc(db,\"contadores\",\"proyectos_\".concat(anioActual));const nuevoConsecutivo=await runTransaction(db,async transaction=>{const contadorDoc=await transaction.get(contadorRef);if(!contadorDoc.exists()){transaction.set(contadorRef,{consecutivo:1});return 1;}const nuevoValor=contadorDoc.data().consecutivo+1;transaction.update(contadorRef,{consecutivo:nuevoValor});return nuevoValor;});const ultimosDosDigitosAnio=anioActual.toString().slice(-2);const consecutivoFormateado=nuevoConsecutivo.toString().padStart(3,'0');const cliente=collections.clientes.find(c=>c.id===formData.clienteId);const servicio=collections.servicios.find(s=>s.id===formData.servicioId);const proveedor=collections.proveedores.find(p=>p.id===formData.proveedorId);const npu=\"\".concat(cliente.clienteIdNumerico,\"-\").concat(servicio.servicioIdNumerico,\"-\").concat(proveedor.proveedorIdNumerico,\"-\").concat(consecutivoFormateado).concat(ultimosDosDigitosAnio);await addDoc(collection(db,\"proyectos\"),{fechaApertura:Timestamp.fromDate(new Date(formData.fechaApertura)),npu,clienteId:cliente.id,clienteNombre:cliente.nombreCompleto,servicioId:servicio.id,servicioNombre:servicio.nombre,proveedorId:proveedor.id,proveedorNombre:proveedor.nombre,comentarios:formData.comentarios,estado:'Cotización',fechaEntrega:null,notaEntrega:'',urlNotaPdf:'',urlDocumento1:'',urlDocumento2:''});setFormData({clienteId:'',servicioId:'',proveedorId:'',comentarios:'',fechaApertura:new Date().toISOString().split('T')[0]});if(onProjectAdded)onProjectAdded();}catch(err){console.error(\"Error al crear proyecto:\",err);setError(\"Ocurri\\xF3 un error: \".concat(err.message));}setLoading(false);};return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-8\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-800 mb-4\",children:\"Crear Nuevo Proyecto\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Fecha de Apertura\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"fechaApertura\",value:formData.fechaApertura,onChange:handleChange,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"})]}),/*#__PURE__*/_jsxs(\"select\",{name:\"clienteId\",value:formData.clienteId,onChange:handleChange,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccione un Cliente\"}),collections.clientes.map(c=>/*#__PURE__*/_jsx(\"option\",{value:c.id,children:c.nombreCompleto},c.id))]}),/*#__PURE__*/_jsxs(\"select\",{name:\"servicioId\",value:formData.servicioId,onChange:handleChange,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccione un Proyecto/Servicio\"}),collections.servicios.map(s=>/*#__PURE__*/_jsx(\"option\",{value:s.id,children:s.nombre},s.id))]}),/*#__PURE__*/_jsxs(\"select\",{name:\"proveedorId\",value:formData.proveedorId,onChange:handleChange,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Seleccione un Proveedor\"}),collections.proveedores.map(p=>/*#__PURE__*/_jsx(\"option\",{value:p.id,children:p.nombre},p.id))]}),/*#__PURE__*/_jsx(\"textarea\",{name:\"comentarios\",value:formData.comentarios,onChange:handleChange,placeholder:\"Comentarios\",className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"}),/*#__PURE__*/_jsx(Alert,{message:error,type:\"error\",onClose:()=>setError('')}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,className:\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg disabled:bg-gray-400\",children:loading?'Creando...':'Crear Proyecto y Generar NPU'})]})]});};const ProjectsTable=_ref5=>{let{projects,onUpdateProject}=_ref5;const ManageDeliveryModal=_ref6=>{let{project,onClose,onFinalized}=_ref6;// Carga los datos existentes del proyecto o inicia campos vacíos\nconst[formData,setFormData]=useState({fechaEntrega:project.fechaEntrega?project.fechaEntrega.toDate().toISOString().split('T')[0]:'',notaEntrega:project.notaEntrega||''});const[notaPdfFile,setNotaPdfFile]=useState(null);const[documento1File,setDocumento1File]=useState(null);const[documento2File,setDocumento2File]=useState(null);const[error,setError]=useState('');const[loading,setLoading]=useState(false);const[uploadProgress,setUploadProgress]=useState(0);const handleChange=e=>{const{name,value}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));};const handleFileChange=setter=>e=>{if(e.target.files[0])setter(e.target.files[0]);};const uploadFile=async(file,path)=>{if(!file)return null;const storageRef=ref(storage,path);const uploadTask=uploadBytesResumable(storageRef,file);return new Promise((resolve,reject)=>{uploadTask.on('state_changed',snapshot=>setUploadProgress(snapshot.bytesTransferred/snapshot.totalBytes*100),error=>reject(error),async()=>{const downloadURL=await getDownloadURL(uploadTask.snapshot.ref);resolve(downloadURL);});});};const handleSave=async()=>{// La validación solo se aplica si se está subiendo el Documento 2 (finalización)\nif(documento2File&&(!formData.fechaEntrega||!formData.notaEntrega||!notaPdfFile&&!project.urlNotaPdf)){setError(\"Al subir el Documento 2, debe completar toda la información de entrega (fecha, nota y PDF de la nota).\");return;}setLoading(true);setError('');try{const doc1Url=await uploadFile(documento1File,\"proyectos/\".concat(project.id,\"/documento1/\").concat(documento1File===null||documento1File===void 0?void 0:documento1File.name));const doc2Url=await uploadFile(documento2File,\"proyectos/\".concat(project.id,\"/documento2/\").concat(documento2File===null||documento2File===void 0?void 0:documento2File.name));const notaUrl=await uploadFile(notaPdfFile,\"notas_entrega/\".concat(project.id,\"/\").concat(notaPdfFile===null||notaPdfFile===void 0?void 0:notaPdfFile.name));const updatePayload={};// Añadir nuevos archivos al payload\nif(doc1Url)updatePayload.urlDocumento1=doc1Url;if(doc2Url)updatePayload.urlDocumento2=doc2Url;if(notaUrl)updatePayload.urlNotaPdf=notaUrl;// Añadir siempre la información del formulario de entrega al payload\nupdatePayload.fechaEntrega=formData.fechaEntrega?Timestamp.fromDate(new Date(formData.fechaEntrega)):null;updatePayload.notaEntrega=formData.notaEntrega;// Si se sube el documento 2, se finaliza el proyecto\nif(documento2File){updatePayload.estado='Terminado';}if(Object.keys(updatePayload).length>0){const projectRef=doc(db,\"proyectos\",project.id);await updateDoc(projectRef,updatePayload);}onFinalized();onClose();}catch(err){setError(\"Error al guardar: \".concat(err.message));setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-bold mb-4\",children:[\"Gestionar Documentos y Entrega: \",project.npu]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border rounded-lg mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-800\",children:\"Documento 1 (Intermedio)\"}),project.urlDocumento1?/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 text-sm\",children:[\"\\u2713 Ya subido. \",/*#__PURE__*/_jsx(\"a\",{href:project.urlDocumento1,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-600\",children:\"Ver documento\"})]}):/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".pdf\",onChange:handleFileChange(setDocumento1File),className:\"mt-2 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:font-semibold file:bg-gray-50 file:text-gray-700 hover:file:bg-gray-100\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border rounded-lg mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-800\",children:\"Documento 2 (Final)\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"Subir este documento marcar\\xE1 el proyecto como \\\"Terminado\\\".\"}),project.urlDocumento2?/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 text-sm\",children:[\"\\u2713 Ya subido. \",/*#__PURE__*/_jsx(\"a\",{href:project.urlDocumento2,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-600\",children:\"Ver documento\"})]}):/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".pdf\",onChange:handleFileChange(setDocumento2File),className:\"mt-2 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:font-semibold file:bg-gray-50 file:text-gray-700 hover:file:bg-gray-100\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border border-gray-300 bg-gray-50 rounded-lg space-y-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-gray-800\",children:\"Informaci\\xF3n de Entrega\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"Esta informaci\\xF3n se puede a\\xF1adir en cualquier momento, pero es obligatoria al finalizar.\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"Fecha de Entrega\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",name:\"fechaEntrega\",value:formData.fechaEntrega,onChange:handleChange,className:\"mt-1 block w-full px-3 py-2 border rounded-md\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"N\\xFAmero de Nota de Entrega\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"notaEntrega\",value:formData.notaEntrega,onChange:handleChange,className:\"mt-1 block w-full px-3 py-2 border rounded-md\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium\",children:\"PDF de la Nota de Entrega\"}),project.urlNotaPdf&&!notaPdfFile&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm mt-1\",children:[\"\\u2713 Ya hay un PDF subido. \",/*#__PURE__*/_jsx(\"a\",{href:project.urlNotaPdf,target:\"_blank\",rel:\"noopener noreferrer\",className:\"text-blue-600\",children:\"Ver nota\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".pdf\",onChange:handleFileChange(setNotaPdfFile),className:\"mt-1 block w-full text-sm\"})]})]}),loading&&uploadProgress>0&&/*#__PURE__*/_jsx(\"div\",{className:\"w-full bg-gray-200 rounded-full h-2.5 mt-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-600 h-2.5 rounded-full\",style:{width:\"\".concat(uploadProgress,\"%\")}})}),/*#__PURE__*/_jsx(Alert,{message:error,type:\"error\",onClose:()=>setError('')}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-end space-x-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,disabled:loading,className:\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded disabled:bg-gray-200\",children:\"Cancelar\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,disabled:loading,className:\"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded disabled:bg-gray-400\",children:loading?'Guardando...':'Guardar Cambios'})]})]})});};const[modalProject,setModalProject]=useState(null);const formatDate=timestamp=>{if(!timestamp)return'---';return new Date(timestamp.seconds*1000).toLocaleDateString('es-MX');};const handleActivateProject=async projectId=>{const projectRef=doc(db,\"proyectos\",projectId);await updateDoc(projectRef,{estado:'Activo'});onUpdateProject();};const handleDeleteProject=async(projectId,projectNpu)=>{if(window.confirm(\"\\xBFEst\\xE1s seguro de que quieres borrar el proyecto \".concat(projectNpu,\"?\\n\\nEsta acci\\xF3n no se puede deshacer.\"))){try{await deleteDoc(doc(db,\"proyectos\",projectId));}catch(error){console.error(\"Error al borrar el proyecto: \",error);}}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto bg-white rounded-lg shadow\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"NPU\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Cliente\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Servicio\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Fecha Apertura\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Estado\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Acciones\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:projects.map(project=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\",children:project.npu}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:project.clienteNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:project.servicioNombre}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\",children:formatDate(project.fechaApertura)}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap\",children:/*#__PURE__*/_jsx(\"span\",{className:\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full \".concat(project.estado==='Activo'?'bg-orange-100 text-orange-800':project.estado==='Terminado'?'bg-green-100 text-green-800':'bg-gray-100 text-gray-800'),children:project.estado})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 whitespace-nowrap text-sm font-medium\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[project.estado==='Cotización'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleActivateProject(project.id),className:\"text-green-600 hover:text-green-900\",children:\"Activar\"}),project.estado==='Activo'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>setModalProject(project),className:\"text-indigo-600 hover:text-indigo-900\",children:\"Gestionar\"}),project.estado==='Terminado'&&/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400\",children:\"Finalizado\"}),project.estado!=='Terminado'&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDeleteProject(project.id,project.npu),className:\"text-red-600 hover:text-red-900\",children:\"Borrar\"})]})})]},project.id))})]})}),modalProject&&/*#__PURE__*/_jsx(ManageDeliveryModal,{project:modalProject,onClose:()=>setModalProject(null),onFinalized:onUpdateProject})]});};// --- Componentes de Cliente (Actualizados) ---\n// **NUEVO CÓDIGO ROBUSTO PARA PDFFlipbookViewer**\nconst PDFFlipbookViewer=_ref7=>{let{pdfUrl,onClose}=_ref7;const flipbookRef=React.useRef(null);const[statusMessage,setStatusMessage]=useState(\"Iniciando visor...\");const[isError,setIsError]=useState(false);useEffect(()=>{let isMounted=true;const loadScript=src=>{return new Promise((resolve,reject)=>{const script=document.createElement('script');script.src=src;script.async=true;script.onload=resolve;script.onerror=reject;script.id=src;// Asignar un ID para poder encontrarlo y removerlo\ndocument.body.appendChild(script);});};const cleanup=()=>{// Limpiar scripts\nconst scriptIds=[\"https://code.jquery.com/jquery-3.7.1.min.js\",\"https://cdn.jsdelivr.net/npm/turn.js@4.1.0/turn.min.js\",\"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js\"];scriptIds.forEach(id=>{const scriptEl=document.getElementById(id);if(scriptEl)document.body.removeChild(scriptEl);});// Destruir instancia de turn.js\nif(window.$&&flipbookRef.current&&window.$(flipbookRef.current).turn('instance')){window.$(flipbookRef.current).turn('destroy');}};const initializeViewer=async()=>{if(!isMounted)return;try{// 1. Cargar las librerías en orden\nsetStatusMessage(\"Cargando componentes (1/3)...\");await loadScript(\"https://code.jquery.com/jquery-3.7.1.min.js\");if(!isMounted)return;setStatusMessage(\"Cargando componentes (2/3)...\");await loadScript(\"https://cdn.jsdelivr.net/npm/turn.js@4.1.0/turn.min.js\");if(!isMounted)return;setStatusMessage(\"Cargando componentes (3/3)...\");await loadScript(\"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js\");if(!isMounted)return;// 2. Ahora que todo está cargado, procesar el PDF\nsetStatusMessage(\"Configurando worker de PDF...\");const pdfjsLib=window['pdfjs-dist/build/pdf'];pdfjsLib.GlobalWorkerOptions.workerSrc=\"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js\";if(!isMounted)return;setStatusMessage(\"Descargando documento PDF...\");const loadingTask=pdfjsLib.getDocument({url:pdfUrl});const pdf=await loadingTask.promise;if(!isMounted)return;setStatusMessage(\"Procesando \".concat(pdf.numPages,\" p\\xE1ginas...\"));const flipbookEl=flipbookRef.current;flipbookEl.innerHTML='';const pagePromises=[];for(let num=1;num<=pdf.numPages;num++){pagePromises.push(pdf.getPage(num).then(page=>{const viewport=page.getViewport({scale:1.5});const canvas=document.createElement('canvas');// **LÍNEA CORREGIDA**\nconst context=canvas.getContext('2d');canvas.height=viewport.height;canvas.width=viewport.width;const pageDiv=document.createElement('div');pageDiv.appendChild(canvas);flipbookEl.appendChild(pageDiv);return page.render({canvasContext:context,viewport:viewport}).promise;}));}await Promise.all(pagePromises);if(!isMounted)return;setStatusMessage(\"Creando libro interactivo...\");window.$(flipbookEl).turn({width:flipbookEl.children[0].children[0].width,height:flipbookEl.children[0].children[0].height,autoCenter:true,elevation:50,duration:800});if(isMounted){setStatusMessage(\"\");// Éxito\n}}catch(error){console.error(\"Error en el visor de PDF:\",error);if(isMounted){setStatusMessage(\"Error: No se pudo cargar el libro interactivo.\");setIsError(true);}}};initializeViewer();return()=>{isMounted=false;cleanup();};},[pdfUrl]);return/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-xl w-full h-full max-w-6xl max-h-[90vh] flex flex-col p-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:onClose,className:\"self-end text-gray-600 hover:text-gray-900 text-3xl font-light leading-none z-10\",children:\"\\xD7\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow flex items-center justify-center relative -mt-10\",children:[statusMessage&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center font-semibold \".concat(isError?'text-red-600':'text-gray-700'),children:[statusMessage,isError&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-normal mt-2\",children:\"Puedes cerrar esta ventana y volver a intentarlo. Si el error persiste, el archivo podr\\xEDa estar da\\xF1ado.\"})]}),/*#__PURE__*/_jsx(\"div\",{ref:flipbookRef,style:{display:statusMessage?'none':'block',width:'100%',height:'100%'}})]})]})});};const ClientProjectsList=_ref8=>{let{projects}=_ref8;const[pdfToView,setPdfToView]=useState(null);const formatDate=timestamp=>{if(!timestamp)return'---';return new Date(timestamp.seconds*1000).toLocaleDateString('es-MX');};const getStatusClass=estado=>{switch(estado){case'Activo':return'bg-orange-100 text-orange-800';case'Terminado':return'bg-green-100 text-green-800';default:return'bg-gray-100 text-gray-800';}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"hidden md:flex bg-gray-50 border-b border-gray-200\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider flex-1\",children:\"Servicio\"}),/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-40\",children:\"Fecha Apertura\"}),/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-40\",children:\"Estado\"}),/*#__PURE__*/_jsx(\"div\",{className:\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-56\",children:\"Acciones\"})]}),/*#__PURE__*/_jsx(\"ul\",{className:\"divide-y divide-gray-200\",children:projects.map(project=>/*#__PURE__*/_jsxs(\"li\",{className:\"p-4 md:px-6 md:py-4 flex flex-col md:flex-row md:items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 mb-4 md:mb-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm font-medium text-gray-900\",children:project.servicioNombre}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500 md:hidden mt-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-bold\",children:\"Fecha:\"}),\" \",formatDate(project.fechaApertura)]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full md:w-40 mb-4 md:mb-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 hidden md:block\",children:formatDate(project.fechaApertura)})}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full md:w-40 mb-4 md:mb-0\",children:/*#__PURE__*/_jsx(\"span\",{className:\"px-2 inline-flex text-xs leading-5 font-semibold rounded-full \".concat(getStatusClass(project.estado)),children:project.estado})}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-full md:w-56 flex items-center space-x-4\",children:[project.urlDocumento1&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>setPdfToView(project.urlDocumento1),className:\"text-sm font-medium text-blue-600 hover:text-blue-900\",children:\"Ver Doc. 1\"}),project.urlDocumento2&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>setPdfToView(project.urlDocumento2),className:\"text-sm font-medium text-blue-600 hover:text-blue-900\",children:\"Ver Doc. 2\"}),project.urlNotaPdf&&/*#__PURE__*/_jsx(\"a\",{href:project.urlNotaPdf,target:\"_blank\",rel:\"noopener noreferrer\",download:true,className:\"text-sm font-medium text-red-600 hover:text-red-900\",children:\"Descargar Nota\"}),project.estado==='Activo'&&!project.urlDocumento1&&/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-400\",children:\"En proceso\"})]})]},project.id))})]}),pdfToView&&/*#__PURE__*/_jsx(PDFFlipbookViewer,{pdfUrl:pdfToView,onClose:()=>setPdfToView(null)})]});};// --- Componente Principal y de Autenticación ---\nconst Dashboard=_ref9=>{let{user,userData}=_ref9;const[projects,setProjects]=useState([]);const[loading,setLoading]=useState(true);const[view,setView]=useState('projects');useEffect(()=>{if(!user||!userData){setLoading(false);return;}let q;if(userData.rol==='empleado'){q=query(collection(db,\"proyectos\"),orderBy(\"fechaApertura\",\"desc\"));}else{q=query(collection(db,\"proyectos\"),where(\"clienteId\",\"==\",user.uid),where(\"estado\",\"in\",[\"Activo\",\"Terminado\"]),orderBy(\"fechaApertura\",\"desc\"));}const unsubscribe=onSnapshot(q,querySnapshot=>{const projectsData=querySnapshot.docs.map(doc=>_objectSpread({id:doc.id},doc.data()));setProjects(projectsData);setLoading(false);},error=>{console.error(\"Error fetching projects: \",error);if(error.code==='failed-precondition')console.error(\"IMPORTANTE: Se requiere un índice compuesto en Firestore. Ve a la URL en la consola para crearlo.\");setLoading(false);});return()=>unsubscribe();},[user,userData]);const EmployeeView=()=>/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"nav\",{className:\"-mb-px flex space-x-8\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('projects'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='projects'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:\"Proyectos\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setView('users'),className:\"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm \".concat(view==='users'?'border-blue-500 text-blue-600':'border-transparent text-gray-500'),children:\"Usuarios\"})]})}),view==='projects'&&/*#__PURE__*/_jsxs(_Fragment,{children:[\" \",/*#__PURE__*/_jsx(NewProjectForm,{onProjectAdded:()=>{}}),\" \",/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-800 my-6\",children:\"Todos los Proyectos\"}),\" \",/*#__PURE__*/_jsx(ProjectsTable,{projects:projects,onUpdateProject:()=>{}}),\" \"]}),view==='users'&&/*#__PURE__*/_jsx(UserManagement,{onUserAdded:()=>{}})]});return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-6\",children:userData.rol==='empleado'?'Panel de Administración':\"Proyectos de \".concat(userData.nombreCompleto)}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Cargando proyectos...\"}):userData.rol==='empleado'?/*#__PURE__*/_jsx(EmployeeView,{}):/*#__PURE__*/_jsx(ClientProjectsList,{projects:projects}),!loading&&projects.length===0&&/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-gray-500 mt-8\",children:\"No hay proyectos para mostrar.\"})]});};const AuthPage=()=>{const[email,setEmail]=useState('');const[password,setPassword]=useState('');const[error,setError]=useState('');const handleLogin=async e=>{e.preventDefault();setError('');try{await signInWithEmailAndPassword(auth,email,password);}catch(err){setError(\"Email o contraseña incorrectos.\");}};return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-100\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-md w-full bg-white p-8 rounded-xl shadow-lg\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-3xl font-bold text-center text-gray-800 mb-6\",children:\"Iniciar Sesi\\xF3n\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLogin,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:email,onChange:e=>setEmail(e.target.value),required:true,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Contrase\\xF1a\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,onChange:e=>setPassword(e.target.value),required:true,className:\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"})]}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500 text-sm text-center\",children:error}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg\",children:\"Entrar\"})]})]})});};export default function App(){const[user,setUser]=useState(null);const[userData,setUserData]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{const unsubscribe=onAuthStateChanged(auth,async currentUser=>{if(currentUser){const userDocRef=doc(db,\"usuarios\",currentUser.uid);const userDoc=await getDoc(userDocRef);if(userDoc.exists()){setUserData(userDoc.data());setUser(currentUser);}else{signOut(auth);}}else{setUser(null);setUserData(null);}setLoading(false);});return()=>unsubscribe();},[]);if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-50 text-gray-700\",children:\"Cargando...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 min-h-screen font-sans\",children:[/*#__PURE__*/_jsx(Header,{user:user,userData:userData}),/*#__PURE__*/_jsx(\"main\",{children:user&&userData?/*#__PURE__*/_jsx(Dashboard,{user:user,userData:userData}):/*#__PURE__*/_jsx(AuthPage,{})})]});}","map":{"version":3,"names":["React","useState","useEffect","initializeApp","getAuth","onAuthStateChanged","createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","getFirestore","collection","addDoc","query","where","getDocs","doc","getDoc","updateDoc","onSnapshot","setDoc","Timestamp","runTransaction","orderBy","deleteDoc","getStorage","ref","uploadBytesResumable","getDownloadURL","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","app","auth","db","storage","Alert","_ref","message","type","onClose","baseClasses","typeClasses","error","success","className","concat","role","children","onClick","Header","_ref2","user","userData","rol","logoUrl","src","onError","e","target","onerror","alt","fill","stroke","viewBox","xmlns","strokeLinecap","strokeLinejoin","strokeWidth","d","nombreCompleto","email","UserManagement","_ref3","onUserAdded","setEmail","password","setPassword","setNombreCompleto","setRol","clienteIdNumerico","setClienteIdNumerico","setLogoUrl","setError","setSuccess","resetForm","handleSubmit","preventDefault","tempApp","Date","getTime","tempAuth","userCredential","uid","padStart","err","onSubmit","value","onChange","placeholder","NewProjectForm","_ref4","onProjectAdded","formData","setFormData","clienteId","servicioId","proveedorId","comentarios","fechaApertura","toISOString","split","collections","setCollections","clientes","servicios","proveedores","loading","setLoading","fetchData","clientesSnap","serviciosSnap","proveedoresSnap","Promise","all","docs","map","_objectSpread","id","data","handleChange","name","prev","anioActual","getFullYear","contadorRef","nuevoConsecutivo","transaction","contadorDoc","get","exists","set","consecutivo","nuevoValor","update","ultimosDosDigitosAnio","toString","slice","consecutivoFormateado","cliente","find","c","servicio","s","proveedor","p","npu","servicioIdNumerico","proveedorIdNumerico","fromDate","clienteNombre","servicioNombre","nombre","proveedorNombre","estado","fechaEntrega","notaEntrega","urlNotaPdf","urlDocumento1","urlDocumento2","console","disabled","ProjectsTable","_ref5","projects","onUpdateProject","ManageDeliveryModal","_ref6","project","onFinalized","toDate","notaPdfFile","setNotaPdfFile","documento1File","setDocumento1File","documento2File","setDocumento2File","uploadProgress","setUploadProgress","handleFileChange","setter","files","uploadFile","file","path","storageRef","uploadTask","resolve","reject","on","snapshot","bytesTransferred","totalBytes","downloadURL","handleSave","doc1Url","doc2Url","notaUrl","updatePayload","Object","keys","length","projectRef","href","rel","accept","style","width","modalProject","setModalProject","formatDate","timestamp","seconds","toLocaleDateString","handleActivateProject","handleDeleteProject","projectNpu","window","confirm","PDFFlipbookViewer","_ref7","pdfUrl","flipbookRef","useRef","statusMessage","setStatusMessage","isError","setIsError","isMounted","loadScript","script","document","createElement","async","onload","body","appendChild","cleanup","scriptIds","forEach","scriptEl","getElementById","removeChild","$","current","turn","initializeViewer","pdfjsLib","GlobalWorkerOptions","workerSrc","loadingTask","getDocument","url","pdf","promise","numPages","flipbookEl","innerHTML","pagePromises","num","push","getPage","then","page","viewport","getViewport","scale","canvas","context","getContext","height","pageDiv","render","canvasContext","autoCenter","elevation","duration","display","ClientProjectsList","_ref8","pdfToView","setPdfToView","getStatusClass","download","Dashboard","_ref9","setProjects","view","setView","q","unsubscribe","querySnapshot","projectsData","code","EmployeeView","AuthPage","handleLogin","required","App","setUser","setUserData","currentUser","userDocRef","userDoc"],"sources":["C:/Users/CAD/Documents/portal-evelsa/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { initializeApp } from 'firebase/app';\r\nimport { \r\n    getAuth, \r\n    onAuthStateChanged, \r\n    createUserWithEmailAndPassword, \r\n    signInWithEmailAndPassword, \r\n    signOut \r\n} from 'firebase/auth';\r\nimport { \r\n    getFirestore, \r\n    collection, \r\n    addDoc, \r\n    query, \r\n    where, \r\n    getDocs, \r\n    doc, \r\n    getDoc,\r\n    updateDoc,\r\n    onSnapshot,\r\n    setDoc,\r\n    Timestamp,\r\n    runTransaction,\r\n    orderBy,\r\n    deleteDoc\r\n} from 'firebase/firestore';\r\nimport { \r\n    getStorage, \r\n    ref, \r\n    uploadBytesResumable, \r\n    getDownloadURL \r\n} from 'firebase/storage';\r\n\r\n// --- INSTRUCCIONES DE CONFIGURACIÓN DE FIREBASE ---\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyA7H6G0mXCy9DmoLg3fSW3TrxIRcEzz9jg\",\r\n  authDomain: \"portal-evelsa.firebaseapp.com\",\r\n  projectId: \"portal-evelsa\",\r\n  storageBucket: \"portal-evelsa.firebasestorage.app\",\r\n  messagingSenderId: \"847174487471\",\r\n  appId: \"1:847174487471:web:c3a57fd8315ce619a2335a\"\r\n};\r\n\r\n// --- Inicialización de Firebase ---\r\nconst app = initializeApp(firebaseConfig);\r\nconst auth = getAuth(app);\r\nconst db = getFirestore(app);\r\nconst storage = getStorage(app);\r\n\r\n// --- Componentes Reutilizables ---\r\nconst Alert = ({ message, type, onClose }) => {\r\n    if (!message) return null;\r\n    const baseClasses = \"p-4 mb-4 text-sm rounded-lg relative\";\r\n    const typeClasses = { error: \"bg-red-100 text-red-700\", success: \"bg-green-100 text-green-700\" };\r\n    return (\r\n        <div className={`${baseClasses} ${typeClasses[type]}`} role=\"alert\">\r\n            <span className=\"font-medium\">{message}</span>\r\n            <button onClick={onClose} className=\"absolute top-0 right-0 mt-2 mr-3 text-2xl font-semibold leading-none\">&times;</button>\r\n        </div>\r\n    );\r\n};\r\n\r\n// --- Componente de Cabecera ---\r\nconst Header = ({ user, userData }) => (\r\n    <header className=\"bg-white shadow-md sticky top-0 z-40\">\r\n        <div className=\"max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center\">\r\n            <div className=\"flex items-center\">\r\n                 {userData && userData.rol === 'cliente' && userData.logoUrl ? (\r\n                    <img src={userData.logoUrl} onError={(e)=>{e.target.onerror = null; e.target.src=\"https://placehold.co/100x40/003366/FFFFFF?text=Logo\"}} alt=\"Logo Cliente\" className=\"h-10 w-auto mr-3 object-contain\"/>\r\n                ) : (\r\n                    <svg className=\"w-10 h-10 text-blue-800 mr-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z\"></path></svg>\r\n                )}\r\n                <h1 className=\"text-2xl font-bold text-gray-800\">Portal Grupo Evelsa</h1>\r\n            </div>\r\n            {user && (\r\n                <div className=\"flex items-center\">\r\n                    <span className=\"text-gray-600 mr-4\">Hola, {userData ? userData.nombreCompleto : user.email}</span>\r\n                    <button onClick={() => signOut(auth)} className=\"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300\">Cerrar Sesión</button>\r\n                </div>\r\n            )}\r\n        </div>\r\n    </header>\r\n);\r\n\r\n// --- Componentes de Empleado ---\r\nconst UserManagement = ({ onUserAdded }) => {\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [nombreCompleto, setNombreCompleto] = useState('');\r\n    const [rol, setRol] = useState('cliente');\r\n    const [clienteIdNumerico, setClienteIdNumerico] = useState('');\r\n    const [logoUrl, setLogoUrl] = useState('');\r\n    const [error, setError] = useState('');\r\n    const [success, setSuccess] = useState('');\r\n\r\n    const resetForm = () => {\r\n        setEmail(''); setPassword(''); setNombreCompleto(''); setRol('cliente');\r\n        setClienteIdNumerico(''); setLogoUrl('');\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setError(''); setSuccess('');\r\n\r\n        if (!nombreCompleto || !email || !password || (rol === 'cliente' && !clienteIdNumerico)) {\r\n            setError('Por favor, complete todos los campos requeridos.');\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Creamos una instancia de Auth temporal para no desloguear al admin\r\n            const tempApp = initializeApp(firebaseConfig, `Secondary-${new Date().getTime()}`);\r\n            const tempAuth = getAuth(tempApp);\r\n            const userCredential = await createUserWithEmailAndPassword(tempAuth, email, password);\r\n            \r\n            await setDoc(doc(db, \"usuarios\", userCredential.user.uid), {\r\n                email, rol, nombreCompleto,\r\n                clienteIdNumerico: rol === 'cliente' ? clienteIdNumerico.padStart(3, '0') : '',\r\n                logoUrl: rol === 'cliente' ? logoUrl : '',\r\n            });\r\n\r\n            setSuccess(`¡Usuario ${email} creado con éxito!`);\r\n            resetForm();\r\n            if (onUserAdded) onUserAdded();\r\n        } catch (err) {\r\n            setError(`Error al crear usuario: ${err.message}`);\r\n        }\r\n    };\r\n    \r\n    return (\r\n        <div className=\"bg-white p-6 rounded-xl shadow-lg border border-gray-200\">\r\n            <h3 className=\"text-xl font-bold text-gray-800 mb-4\">Crear Usuario (Cliente o Empleado)</h3>\r\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                 <input type=\"text\" value={nombreCompleto} onChange={e => setNombreCompleto(e.target.value)} placeholder=\"Nombre Completo\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                 <select value={rol} onChange={e => setRol(e.target.value)} className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\">\r\n                    <option value=\"cliente\">Cliente</option>\r\n                    <option value=\"empleado\">Empleado</option>\r\n                 </select>\r\n                 <input type=\"email\" value={email} onChange={e => setEmail(e.target.value)} placeholder=\"Email de Acceso\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                 <input type=\"password\" value={password} onChange={e => setPassword(e.target.value)} placeholder=\"Contraseña (mínimo 6 caracteres)\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                 {rol === 'cliente' && (\r\n                     <>\r\n                        <input type=\"text\" value={clienteIdNumerico} onChange={e => setClienteIdNumerico(e.target.value)} placeholder=\"ID Numérico Cliente (ej: 001)\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                        <input type=\"text\" value={logoUrl} onChange={e => setLogoUrl(e.target.value)} placeholder=\"URL del Logo (Opcional)\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                     </>\r\n                 )}\r\n                 <Alert message={error} type=\"error\" onClose={() => setError('')} />\r\n                 <Alert message={success} type=\"success\" onClose={() => setSuccess('')} />\r\n                 <button type=\"submit\" className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg\">Crear Usuario</button>\r\n            </form>\r\n        </div>\r\n    );\r\n};\r\n\r\nconst NewProjectForm = ({ onProjectAdded }) => {\r\n    const [formData, setFormData] = useState({ \r\n        clienteId: '', \r\n        servicioId: '', \r\n        proveedorId: '', \r\n        comentarios: '',\r\n        fechaApertura: new Date().toISOString().split('T')[0]\r\n    });\r\n    const [collections, setCollections] = useState({ clientes: [], servicios: [], proveedores: [] });\r\n    const [error, setError] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            try {\r\n                const [clientesSnap, serviciosSnap, proveedoresSnap] = await Promise.all([\r\n                    getDocs(query(collection(db, \"usuarios\"), where(\"rol\", \"==\", \"cliente\"))),\r\n                    getDocs(collection(db, \"servicios\")),\r\n                    getDocs(collection(db, \"proveedores\"))\r\n                ]);\r\n                setCollections({\r\n                    clientes: clientesSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })),\r\n                    servicios: serviciosSnap.docs.map(doc => ({ id: doc.id, ...doc.data() })),\r\n                    proveedores: proveedoresSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }))\r\n                });\r\n            } catch (e) {\r\n                setError(\"Error al cargar datos. Asegúrese de que las colecciones 'servicios' y 'proveedores' existan.\");\r\n            }\r\n        };\r\n        fetchData();\r\n    }, []);\r\n\r\n    const handleChange = (e) => {\r\n        const { name, value } = e.target;\r\n        setFormData(prev => ({ ...prev, [name]: value }));\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (!formData.clienteId || !formData.servicioId || !formData.proveedorId || !formData.fechaApertura) {\r\n            setError('Todos los campos son obligatorios.');\r\n            return;\r\n        }\r\n        setLoading(true);\r\n        setError('');\r\n\r\n        try {\r\n            const anioActual = new Date(formData.fechaApertura).getFullYear();\r\n            const contadorRef = doc(db, \"contadores\", `proyectos_${anioActual}`);\r\n            \r\n            const nuevoConsecutivo = await runTransaction(db, async (transaction) => {\r\n                const contadorDoc = await transaction.get(contadorRef);\r\n                if (!contadorDoc.exists()) {\r\n                    transaction.set(contadorRef, { consecutivo: 1 });\r\n                    return 1;\r\n                }\r\n                const nuevoValor = contadorDoc.data().consecutivo + 1;\r\n                transaction.update(contadorRef, { consecutivo: nuevoValor });\r\n                return nuevoValor;\r\n            });\r\n            \r\n            const ultimosDosDigitosAnio = anioActual.toString().slice(-2);\r\n            const consecutivoFormateado = nuevoConsecutivo.toString().padStart(3, '0');\r\n            \r\n            const cliente = collections.clientes.find(c => c.id === formData.clienteId);\r\n            const servicio = collections.servicios.find(s => s.id === formData.servicioId);\r\n            const proveedor = collections.proveedores.find(p => p.id === formData.proveedorId);\r\n\r\n            const npu = `${cliente.clienteIdNumerico}-${servicio.servicioIdNumerico}-${proveedor.proveedorIdNumerico}-${consecutivoFormateado}${ultimosDosDigitosAnio}`;\r\n\r\n            await addDoc(collection(db, \"proyectos\"), {\r\n                fechaApertura: Timestamp.fromDate(new Date(formData.fechaApertura)),\r\n                npu,\r\n                clienteId: cliente.id,\r\n                clienteNombre: cliente.nombreCompleto,\r\n                servicioId: servicio.id,\r\n                servicioNombre: servicio.nombre,\r\n                proveedorId: proveedor.id,\r\n                proveedorNombre: proveedor.nombre,\r\n                comentarios: formData.comentarios,\r\n                estado: 'Cotización',\r\n                fechaEntrega: null,\r\n                notaEntrega: '',\r\n                urlNotaPdf: '',\r\n                urlDocumento1: '',\r\n                urlDocumento2: ''\r\n            });\r\n            \r\n            setFormData({ clienteId: '', servicioId: '', proveedorId: '', comentarios: '', fechaApertura: new Date().toISOString().split('T')[0] });\r\n            if (onProjectAdded) onProjectAdded();\r\n\r\n        } catch (err) {\r\n            console.error(\"Error al crear proyecto:\", err);\r\n            setError(`Ocurrió un error: ${err.message}`);\r\n        }\r\n        setLoading(false);\r\n    };\r\n\r\n    return (\r\n        <div className=\"bg-white p-6 rounded-xl shadow-lg border border-gray-200 mb-8\">\r\n            <h3 className=\"text-xl font-bold text-gray-800 mb-4\">Crear Nuevo Proyecto</h3>\r\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                <div>\r\n                    <label className=\"block text-sm font-medium text-gray-700\">Fecha de Apertura</label>\r\n                    <input type=\"date\" name=\"fechaApertura\" value={formData.fechaApertura} onChange={handleChange} className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                </div>\r\n                 <select name=\"clienteId\" value={formData.clienteId} onChange={handleChange} className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\">\r\n                    <option value=\"\">Seleccione un Cliente</option>\r\n                    {collections.clientes.map(c => <option key={c.id} value={c.id}>{c.nombreCompleto}</option>)}\r\n                 </select>\r\n                 <select name=\"servicioId\" value={formData.servicioId} onChange={handleChange} className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\">\r\n                    <option value=\"\">Seleccione un Proyecto/Servicio</option>\r\n                    {collections.servicios.map(s => <option key={s.id} value={s.id}>{s.nombre}</option>)}\r\n                 </select>\r\n                 <select name=\"proveedorId\" value={formData.proveedorId} onChange={handleChange} className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\">\r\n                    <option value=\"\">Seleccione un Proveedor</option>\r\n                    {collections.proveedores.map(p => <option key={p.id} value={p.id}>{p.nombre}</option>)}\r\n                 </select>\r\n                <textarea name=\"comentarios\" value={formData.comentarios} onChange={handleChange} placeholder=\"Comentarios\" className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"></textarea>\r\n                <Alert message={error} type=\"error\" onClose={() => setError('')} />\r\n                <button type=\"submit\" disabled={loading} className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg disabled:bg-gray-400\">\r\n                    {loading ? 'Creando...' : 'Crear Proyecto y Generar NPU'}\r\n                </button>\r\n            </form>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\nconst ProjectsTable = ({ projects, onUpdateProject }) => {\r\n    \r\n    const ManageDeliveryModal = ({ project, onClose, onFinalized }) => {\r\n    // Carga los datos existentes del proyecto o inicia campos vacíos\r\n        const [formData, setFormData] = useState({\r\n            fechaEntrega: project.fechaEntrega ? project.fechaEntrega.toDate().toISOString().split('T')[0] : '',\r\n            notaEntrega: project.notaEntrega || '',\r\n        });\r\n        const [notaPdfFile, setNotaPdfFile] = useState(null);\r\n        const [documento1File, setDocumento1File] = useState(null);\r\n        const [documento2File, setDocumento2File] = useState(null);\r\n        \r\n        const [error, setError] = useState('');\r\n        const [loading, setLoading] = useState(false);\r\n        const [uploadProgress, setUploadProgress] = useState(0);\r\n\r\n        const handleChange = (e) => {\r\n            const { name, value } = e.target;\r\n            setFormData(prev => ({ ...prev, [name]: value }));\r\n        };\r\n\r\n        const handleFileChange = (setter) => (e) => {\r\n            if (e.target.files[0]) setter(e.target.files[0]);\r\n        };\r\n\r\n        const uploadFile = async (file, path) => {\r\n            if (!file) return null;\r\n            const storageRef = ref(storage, path);\r\n            const uploadTask = uploadBytesResumable(storageRef, file);\r\n            \r\n            return new Promise((resolve, reject) => {\r\n                uploadTask.on('state_changed',\r\n                    (snapshot) => setUploadProgress((snapshot.bytesTransferred / snapshot.totalBytes) * 100),\r\n                    (error) => reject(error),\r\n                    async () => {\r\n                        const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);\r\n                        resolve(downloadURL);\r\n                    }\r\n                );\r\n            });\r\n        };\r\n\r\n        const handleSave = async () => {\r\n            // La validación solo se aplica si se está subiendo el Documento 2 (finalización)\r\n            if (documento2File && (!formData.fechaEntrega || !formData.notaEntrega || (!notaPdfFile && !project.urlNotaPdf))) {\r\n                setError(\"Al subir el Documento 2, debe completar toda la información de entrega (fecha, nota y PDF de la nota).\");\r\n                return;\r\n            }\r\n            \r\n            setLoading(true);\r\n            setError('');\r\n\r\n            try {\r\n                const doc1Url = await uploadFile(documento1File, `proyectos/${project.id}/documento1/${documento1File?.name}`);\r\n                const doc2Url = await uploadFile(documento2File, `proyectos/${project.id}/documento2/${documento2File?.name}`);\r\n                const notaUrl = await uploadFile(notaPdfFile, `notas_entrega/${project.id}/${notaPdfFile?.name}`);\r\n\r\n                const updatePayload = {};\r\n\r\n                // Añadir nuevos archivos al payload\r\n                if (doc1Url) updatePayload.urlDocumento1 = doc1Url;\r\n                if (doc2Url) updatePayload.urlDocumento2 = doc2Url;\r\n                if (notaUrl) updatePayload.urlNotaPdf = notaUrl;\r\n                \r\n                // Añadir siempre la información del formulario de entrega al payload\r\n                updatePayload.fechaEntrega = formData.fechaEntrega ? Timestamp.fromDate(new Date(formData.fechaEntrega)) : null;\r\n                updatePayload.notaEntrega = formData.notaEntrega;\r\n\r\n                // Si se sube el documento 2, se finaliza el proyecto\r\n                if (documento2File) {\r\n                    updatePayload.estado = 'Terminado';\r\n                }\r\n                \r\n                if (Object.keys(updatePayload).length > 0) {\r\n                    const projectRef = doc(db, \"proyectos\", project.id);\r\n                    await updateDoc(projectRef, updatePayload);\r\n                }\r\n                \r\n                onFinalized();\r\n                onClose();\r\n\r\n            } catch(err) {\r\n                setError(`Error al guardar: ${err.message}`);\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        return (\r\n            <div className=\"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4\">\r\n                <div className=\"bg-white p-6 rounded-lg shadow-xl w-full max-w-lg\">\r\n                    <h3 className=\"text-lg font-bold mb-4\">Gestionar Documentos y Entrega: {project.npu}</h3>\r\n                    \r\n                    <div className=\"p-4 border rounded-lg mb-4\">\r\n                        <h4 className=\"font-semibold text-gray-800\">Documento 1 (Intermedio)</h4>\r\n                        {project.urlDocumento1 ? (\r\n                            <div className=\"mt-2 text-sm\">✓ Ya subido. <a href={project.urlDocumento1} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600\">Ver documento</a></div>\r\n                        ) : (\r\n                            <input type=\"file\" accept=\".pdf\" onChange={handleFileChange(setDocumento1File)} className=\"mt-2 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:font-semibold file:bg-gray-50 file:text-gray-700 hover:file:bg-gray-100\"/>\r\n                        )}\r\n                    </div>\r\n\r\n                    <div className=\"p-4 border rounded-lg mb-4\">\r\n                        <h4 className=\"font-semibold text-gray-800\">Documento 2 (Final)</h4>\r\n                        <p className=\"text-xs text-gray-500\">Subir este documento marcará el proyecto como \"Terminado\".</p>\r\n                        {project.urlDocumento2 ? (\r\n                            <div className=\"mt-2 text-sm\">✓ Ya subido. <a href={project.urlDocumento2} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600\">Ver documento</a></div>\r\n                        ) : (\r\n                            <input type=\"file\" accept=\".pdf\" onChange={handleFileChange(setDocumento2File)} className=\"mt-2 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:font-semibold file:bg-gray-50 file:text-gray-700 hover:file:bg-gray-100\"/>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* La sección de entrega ahora es siempre visible */}\r\n                    <div className=\"p-4 border border-gray-300 bg-gray-50 rounded-lg space-y-4\">\r\n                        <h4 className=\"font-semibold text-gray-800\">Información de Entrega</h4>\r\n                        <p className=\"text-xs text-gray-500\">Esta información se puede añadir en cualquier momento, pero es obligatoria al finalizar.</p>\r\n                        <div><label className=\"block text-sm font-medium\">Fecha de Entrega</label><input type=\"date\" name=\"fechaEntrega\" value={formData.fechaEntrega} onChange={handleChange} className=\"mt-1 block w-full px-3 py-2 border rounded-md\"/></div>\r\n                        <div><label className=\"block text-sm font-medium\">Número de Nota de Entrega</label><input type=\"text\" name=\"notaEntrega\" value={formData.notaEntrega} onChange={handleChange} className=\"mt-1 block w-full px-3 py-2 border rounded-md\"/></div>\r\n                        <div><label className=\"block text-sm font-medium\">PDF de la Nota de Entrega</label>\r\n                            {project.urlNotaPdf && !notaPdfFile && <div className=\"text-sm mt-1\">✓ Ya hay un PDF subido. <a href={project.urlNotaPdf} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-blue-600\">Ver nota</a></div>}\r\n                            <input type=\"file\" accept=\".pdf\" onChange={handleFileChange(setNotaPdfFile)} className=\"mt-1 block w-full text-sm\"/>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {loading && uploadProgress > 0 && <div className=\"w-full bg-gray-200 rounded-full h-2.5 mt-4\"><div className=\"bg-blue-600 h-2.5 rounded-full\" style={{width: `${uploadProgress}%`}}></div></div>}\r\n                    <Alert message={error} type=\"error\" onClose={() => setError('')} />\r\n                    <div className=\"mt-6 flex justify-end space-x-3\">\r\n                        <button onClick={onClose} disabled={loading} className=\"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded disabled:bg-gray-200\">Cancelar</button>\r\n                        <button onClick={handleSave} disabled={loading} className=\"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded disabled:bg-gray-400\">{loading ? 'Guardando...' : 'Guardar Cambios'}</button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    };\r\n\r\n    const [modalProject, setModalProject] = useState(null);\r\n\r\n    const formatDate = (timestamp) => {\r\n        if (!timestamp) return '---';\r\n        return new Date(timestamp.seconds * 1000).toLocaleDateString('es-MX');\r\n    };\r\n\r\n    const handleActivateProject = async (projectId) => {\r\n        const projectRef = doc(db, \"proyectos\", projectId);\r\n        await updateDoc(projectRef, { estado: 'Activo' });\r\n        onUpdateProject();\r\n    };\r\n\r\n    const handleDeleteProject = async (projectId, projectNpu) => {\r\n        if (window.confirm(`¿Estás seguro de que quieres borrar el proyecto ${projectNpu}?\\n\\nEsta acción no se puede deshacer.`)) {\r\n            try {\r\n                await deleteDoc(doc(db, \"proyectos\", projectId));\r\n            } catch (error) {\r\n                console.error(\"Error al borrar el proyecto: \", error);\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <div className=\"overflow-x-auto bg-white rounded-lg shadow\">\r\n                <table className=\"min-w-full divide-y divide-gray-200\">\r\n                    <thead className=\"bg-gray-50\">\r\n                        <tr>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">NPU</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Cliente</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Servicio</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Fecha Apertura</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Estado</th>\r\n                            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">Acciones</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\r\n                        {projects.map(project => (\r\n                            <tr key={project.id}>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">{project.npu}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">{project.clienteNombre}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">{project.servicioNombre}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">{formatDate(project.fechaApertura)}</td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap\">\r\n                                    <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${\r\n                                        project.estado === 'Activo' ? 'bg-orange-100 text-orange-800' :\r\n                                        project.estado === 'Terminado' ? 'bg-green-100 text-green-800' :\r\n                                        'bg-gray-100 text-gray-800'\r\n                                    }`}>\r\n                                        {project.estado}\r\n                                    </span>\r\n                                </td>\r\n                                <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\r\n                                    <div className=\"flex items-center space-x-4\">\r\n                                        {project.estado === 'Cotización' && <button onClick={() => handleActivateProject(project.id)} className=\"text-green-600 hover:text-green-900\">Activar</button>}\r\n                                        {project.estado === 'Activo' && <button onClick={() => setModalProject(project)} className=\"text-indigo-600 hover:text-indigo-900\">Gestionar</button>}\r\n                                        {project.estado === 'Terminado' && <span className=\"text-gray-400\">Finalizado</span>}\r\n                                        {project.estado !== 'Terminado' && <button onClick={() => handleDeleteProject(project.id, project.npu)} className=\"text-red-600 hover:text-red-900\">Borrar</button>}\r\n                                    </div>\r\n                                </td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n            {modalProject && <ManageDeliveryModal project={modalProject} onClose={() => setModalProject(null)} onFinalized={onUpdateProject} />}\r\n        </>\r\n    );\r\n};\r\n\r\n\r\n// --- Componentes de Cliente (Actualizados) ---\r\n\r\n// **NUEVO CÓDIGO ROBUSTO PARA PDFFlipbookViewer**\r\nconst PDFFlipbookViewer = ({ pdfUrl, onClose }) => {\r\n    const flipbookRef = React.useRef(null);\r\n    const [statusMessage, setStatusMessage] = useState(\"Iniciando visor...\");\r\n    const [isError, setIsError] = useState(false);\r\n\r\n    useEffect(() => {\r\n        let isMounted = true;\r\n\r\n        const loadScript = (src) => {\r\n            return new Promise((resolve, reject) => {\r\n                const script = document.createElement('script');\r\n                script.src = src;\r\n                script.async = true;\r\n                script.onload = resolve;\r\n                script.onerror = reject;\r\n                script.id = src; // Asignar un ID para poder encontrarlo y removerlo\r\n                document.body.appendChild(script);\r\n            });\r\n        };\r\n\r\n        const cleanup = () => {\r\n             // Limpiar scripts\r\n            const scriptIds = [\r\n                \"https://code.jquery.com/jquery-3.7.1.min.js\",\r\n                \"https://cdn.jsdelivr.net/npm/turn.js@4.1.0/turn.min.js\",\r\n                \"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js\"\r\n            ];\r\n            scriptIds.forEach(id => {\r\n                const scriptEl = document.getElementById(id);\r\n                if (scriptEl) document.body.removeChild(scriptEl);\r\n            });\r\n            // Destruir instancia de turn.js\r\n            if (window.$ && flipbookRef.current && window.$(flipbookRef.current).turn('instance')) {\r\n                window.$(flipbookRef.current).turn('destroy');\r\n            }\r\n        };\r\n\r\n        const initializeViewer = async () => {\r\n            if (!isMounted) return;\r\n            try {\r\n                // 1. Cargar las librerías en orden\r\n                setStatusMessage(\"Cargando componentes (1/3)...\");\r\n                await loadScript(\"https://code.jquery.com/jquery-3.7.1.min.js\");\r\n                if (!isMounted) return;\r\n\r\n                setStatusMessage(\"Cargando componentes (2/3)...\");\r\n                await loadScript(\"https://cdn.jsdelivr.net/npm/turn.js@4.1.0/turn.min.js\");\r\n                if (!isMounted) return;\r\n\r\n                setStatusMessage(\"Cargando componentes (3/3)...\");\r\n                await loadScript(\"https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js\");\r\n                if (!isMounted) return;\r\n\r\n                // 2. Ahora que todo está cargado, procesar el PDF\r\n                setStatusMessage(\"Configurando worker de PDF...\");\r\n                const pdfjsLib = window['pdfjs-dist/build/pdf'];\r\n                pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js`;\r\n\r\n                if (!isMounted) return;\r\n                setStatusMessage(\"Descargando documento PDF...\");\r\n                const loadingTask = pdfjsLib.getDocument({ url: pdfUrl });\r\n                const pdf = await loadingTask.promise;\r\n\r\n                if (!isMounted) return;\r\n                setStatusMessage(`Procesando ${pdf.numPages} páginas...`);\r\n                const flipbookEl = flipbookRef.current;\r\n                flipbookEl.innerHTML = '';\r\n\r\n                const pagePromises = [];\r\n                for (let num = 1; num <= pdf.numPages; num++) {\r\n                    pagePromises.push(\r\n                        pdf.getPage(num).then(page => {\r\n                            const viewport = page.getViewport({ scale: 1.5 });\r\n                            const canvas = document.createElement('canvas');\r\n                            // **LÍNEA CORREGIDA**\r\n                            const context = canvas.getContext('2d');\r\n                            canvas.height = viewport.height;\r\n                            canvas.width = viewport.width;\r\n                            const pageDiv = document.createElement('div');\r\n                            pageDiv.appendChild(canvas);\r\n                            flipbookEl.appendChild(pageDiv);\r\n                            return page.render({ canvasContext: context, viewport: viewport }).promise;\r\n                        })\r\n                    );\r\n                }\r\n                \r\n                await Promise.all(pagePromises);\r\n\r\n                if (!isMounted) return;\r\n                setStatusMessage(\"Creando libro interactivo...\");\r\n                window.$(flipbookEl).turn({\r\n                    width: flipbookEl.children[0].children[0].width,\r\n                    height: flipbookEl.children[0].children[0].height,\r\n                    autoCenter: true,\r\n                    elevation: 50,\r\n                    duration: 800,\r\n                });\r\n                \r\n                if (isMounted) {\r\n                    setStatusMessage(\"\"); // Éxito\r\n                }\r\n\r\n            } catch (error) {\r\n                console.error(\"Error en el visor de PDF:\", error);\r\n                if (isMounted) {\r\n                    setStatusMessage(\"Error: No se pudo cargar el libro interactivo.\");\r\n                    setIsError(true);\r\n                }\r\n            }\r\n        };\r\n\r\n        initializeViewer();\r\n\r\n        return () => {\r\n            isMounted = false;\r\n            cleanup();\r\n        };\r\n\r\n    }, [pdfUrl]);\r\n\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-75 flex justify-center items-center z-50\">\r\n            <div className=\"bg-white rounded-lg shadow-xl w-full h-full max-w-6xl max-h-[90vh] flex flex-col p-4\">\r\n                <button onClick={onClose} className=\"self-end text-gray-600 hover:text-gray-900 text-3xl font-light leading-none z-10\">&times;</button>\r\n                <div className=\"flex-grow flex items-center justify-center relative -mt-10\">\r\n                    {statusMessage && (\r\n                        <div className={`text-center font-semibold ${isError ? 'text-red-600' : 'text-gray-700'}`}>\r\n                            {statusMessage}\r\n                            {isError && <p className=\"text-sm font-normal mt-2\">Puedes cerrar esta ventana y volver a intentarlo. Si el error persiste, el archivo podría estar dañado.</p>}\r\n                        </div>\r\n                    )}\r\n                    <div ref={flipbookRef} style={{ display: statusMessage ? 'none' : 'block', width: '100%', height: '100%' }}>\r\n                        {/* Las páginas del PDF se insertarán aquí por el script */}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\n\r\nconst ClientProjectsList = ({ projects }) => {\r\n    const [pdfToView, setPdfToView] = useState(null);\r\n\r\n    const formatDate = (timestamp) => {\r\n        if (!timestamp) return '---';\r\n        return new Date(timestamp.seconds * 1000).toLocaleDateString('es-MX');\r\n    };\r\n    \r\n    const getStatusClass = (estado) => {\r\n        switch(estado) {\r\n            case 'Activo': return 'bg-orange-100 text-orange-800';\r\n            case 'Terminado': return 'bg-green-100 text-green-800';\r\n            default: return 'bg-gray-100 text-gray-800';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <div className=\"bg-white rounded-lg shadow overflow-hidden\">\r\n                <div className=\"hidden md:flex bg-gray-50 border-b border-gray-200\">\r\n                    <div className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider flex-1\">Servicio</div>\r\n                    <div className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-40\">Fecha Apertura</div>\r\n                    <div className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-40\">Estado</div>\r\n                    <div className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-56\">Acciones</div>\r\n                </div>\r\n                <ul className=\"divide-y divide-gray-200\">\r\n                    {projects.map(project => (\r\n                        <li key={project.id} className=\"p-4 md:px-6 md:py-4 flex flex-col md:flex-row md:items-center\">\r\n                            <div className=\"flex-1 mb-4 md:mb-0\">\r\n                                <div className=\"text-sm font-medium text-gray-900\">{project.servicioNombre}</div>\r\n                                <div className=\"text-sm text-gray-500 md:hidden mt-2\"><span className=\"font-bold\">Fecha:</span> {formatDate(project.fechaApertura)}</div>\r\n                            </div>\r\n                            <div className=\"w-full md:w-40 mb-4 md:mb-0\">\r\n                                <div className=\"text-sm text-gray-500 hidden md:block\">{formatDate(project.fechaApertura)}</div>\r\n                            </div>\r\n                            <div className=\"w-full md:w-40 mb-4 md:mb-0\">\r\n                                <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusClass(project.estado)}`}>{project.estado}</span>\r\n                            </div>\r\n                            <div className=\"w-full md:w-56 flex items-center space-x-4\">\r\n                                {project.urlDocumento1 && <button onClick={() => setPdfToView(project.urlDocumento1)} className=\"text-sm font-medium text-blue-600 hover:text-blue-900\">Ver Doc. 1</button>}\r\n                                {project.urlDocumento2 && <button onClick={() => setPdfToView(project.urlDocumento2)} className=\"text-sm font-medium text-blue-600 hover:text-blue-900\">Ver Doc. 2</button>}\r\n                                {project.urlNotaPdf && <a href={project.urlNotaPdf} target=\"_blank\" rel=\"noopener noreferrer\" download className=\"text-sm font-medium text-red-600 hover:text-red-900\">Descargar Nota</a>}\r\n                                {(project.estado === 'Activo' && !project.urlDocumento1) && <span className=\"text-sm text-gray-400\">En proceso</span>}\r\n                            </div>\r\n                        </li>\r\n                    ))}\r\n                </ul>\r\n            </div>\r\n            {pdfToView && <PDFFlipbookViewer pdfUrl={pdfToView} onClose={() => setPdfToView(null)} />}\r\n        </>\r\n    );\r\n};\r\n\r\n\r\n// --- Componente Principal y de Autenticación ---\r\n\r\nconst Dashboard = ({ user, userData }) => {\r\n    const [projects, setProjects] = useState([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [view, setView] = useState('projects'); \r\n\r\n    useEffect(() => {\r\n        if (!user || !userData) { setLoading(false); return; }\r\n        let q;\r\n        if (userData.rol === 'empleado') {\r\n            q = query(collection(db, \"proyectos\"), orderBy(\"fechaApertura\", \"desc\"));\r\n        } else {\r\n            q = query(collection(db, \"proyectos\"), where(\"clienteId\", \"==\", user.uid), where(\"estado\", \"in\", [\"Activo\", \"Terminado\"]), orderBy(\"fechaApertura\", \"desc\"));\r\n        }\r\n        const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n            const projectsData = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\r\n            setProjects(projectsData);\r\n            setLoading(false);\r\n        }, (error) => {\r\n            console.error(\"Error fetching projects: \", error);\r\n            if (error.code === 'failed-precondition') console.error(\"IMPORTANTE: Se requiere un índice compuesto en Firestore. Ve a la URL en la consola para crearlo.\");\r\n            setLoading(false);\r\n        });\r\n        return () => unsubscribe();\r\n    }, [user, userData]);\r\n\r\n    const EmployeeView = () => (\r\n         <>\r\n            <div className=\"mb-6 border-b border-gray-200\"><nav className=\"-mb-px flex space-x-8\"><button onClick={() => setView('projects')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'projects' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>Proyectos</button><button onClick={() => setView('users')} className={`whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ${view === 'users' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'}`}>Usuarios</button></nav></div>\r\n            {view === 'projects' && ( <> <NewProjectForm onProjectAdded={() => {}} /> <h2 className=\"text-2xl font-bold text-gray-800 my-6\">Todos los Proyectos</h2> <ProjectsTable projects={projects} onUpdateProject={() => {}} /> </> )}\r\n            {view === 'users' && <UserManagement onUserAdded={() => {}} />}\r\n         </>\r\n    );\r\n\r\n    return (\r\n        <div className=\"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8\">\r\n            <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">{userData.rol === 'empleado' ? 'Panel de Administración' : `Proyectos de ${userData.nombreCompleto}`}</h1>\r\n            {loading ? <p>Cargando proyectos...</p> : (\r\n                userData.rol === 'empleado' ? <EmployeeView /> : <ClientProjectsList projects={projects} />\r\n            )}\r\n            {!loading && projects.length === 0 && <p className=\"text-center text-gray-500 mt-8\">No hay proyectos para mostrar.</p>}\r\n        </div>\r\n    );\r\n};\r\n\r\nconst AuthPage = () => {\r\n    const [email, setEmail] = useState('');\r\n    const [password, setPassword] = useState('');\r\n    const [error, setError] = useState('');\r\n\r\n    const handleLogin = async (e) => {\r\n        e.preventDefault();\r\n        setError('');\r\n        try {\r\n            await signInWithEmailAndPassword(auth, email, password);\r\n        } catch (err) {\r\n            setError(\"Email o contraseña incorrectos.\");\r\n        }\r\n    };\r\n    \r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-gray-100\">\r\n            <div className=\"max-w-md w-full bg-white p-8 rounded-xl shadow-lg\">\r\n                <h2 className=\"text-3xl font-bold text-center text-gray-800 mb-6\">Iniciar Sesión</h2>\r\n                <form onSubmit={handleLogin} className=\"space-y-6\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700\">Email</label>\r\n                        <input type=\"email\" value={email} onChange={(e) => setEmail(e.target.value)} required className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                    </div>\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-gray-700\">Contraseña</label>\r\n                        <input type=\"password\" value={password} onChange={(e) => setPassword(e.target.value)} required className=\"mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm\"/>\r\n                    </div>\r\n                    {error && <p className=\"text-red-500 text-sm text-center\">{error}</p>}\r\n                    <button type=\"submit\" className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg\">Entrar</button>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\nexport default function App() {\r\n    const [user, setUser] = useState(null);\r\n    const [userData, setUserData] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = onAuthStateChanged(auth, async (currentUser) => {\r\n            if (currentUser) {\r\n                const userDocRef = doc(db, \"usuarios\", currentUser.uid);\r\n                const userDoc = await getDoc(userDocRef);\r\n                if (userDoc.exists()) {\r\n                    setUserData(userDoc.data());\r\n                    setUser(currentUser);\r\n                } else { signOut(auth); }\r\n            } else {\r\n                setUser(null);\r\n                setUserData(null);\r\n            }\r\n            setLoading(false);\r\n        });\r\n        return () => unsubscribe();\r\n    }, []);\r\n\r\n    if (loading) {\r\n        return <div className=\"min-h-screen flex items-center justify-center bg-gray-50 text-gray-700\">Cargando...</div>;\r\n    }\r\n    \r\n    return (\r\n        <div className=\"bg-gray-50 min-h-screen font-sans\">\r\n             <Header user={user} userData={userData}/>\r\n             <main>\r\n                {user && userData ? <Dashboard user={user} userData={userData} /> : <AuthPage />}\r\n             </main>\r\n        </div>\r\n    );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}